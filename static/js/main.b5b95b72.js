/*! For license information please see main.b5b95b72.js.LICENSE.txt */
(()=>{var __webpack_modules__={4839:(e,t,i)=>{"use strict";var n=i(5043),r=i(6749);function a(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var n=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,n.get?n:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var s,o=a(n),l=a(r);t.UJ=void 0,(s=t.UJ||(t.UJ={}))[s.Text=1]="Text",s[s.Link=2]="Link",s[s.FreeText=3]="FreeText",s[s.Line=4]="Line",s[s.Square=5]="Square",s[s.Circle=6]="Circle",s[s.Polygon=7]="Polygon",s[s.Polyline=8]="Polyline",s[s.Highlight=9]="Highlight",s[s.Underline=10]="Underline",s[s.Squiggly=11]="Squiggly",s[s.StrikeOut=12]="StrikeOut",s[s.Stamp=13]="Stamp",s[s.Caret=14]="Caret",s[s.Ink=15]="Ink",s[s.Popup=16]="Popup",s[s.FileAttachment=17]="FileAttachment";var c=function(e,t){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},c(e,t)};function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var d,u=function(){return u=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},u.apply(this,arguments)};t.z4=void 0,(d=t.z4||(t.z4={})).RightToLeft="RTL",d.LeftToRight="LTR";var p,f=o.createContext({currentTheme:"light",direction:t.z4.LeftToRight,setCurrentTheme:function(){}}),m=function(e){var t=[];return Object.keys(e).forEach((function(i){i&&e[i]&&t.push(i)})),t.join(" ")},g="undefined"!=typeof window?o.useLayoutEffect:o.useEffect,v=function(e){var t=o.useRef(null),i=e.once,n=e.threshold,r=e.onVisibilityChanged;return g((function(){var e=t.current;if(e){var a=new IntersectionObserver((function(t){t.forEach((function(t){var n=t.isIntersecting,s=t.intersectionRatio;r({isVisible:n,ratio:s}),n&&i&&(a.unobserve(e),a.disconnect())}))}),{threshold:n||0});return a.observe(e),function(){a.unobserve(e),a.disconnect()}}}),[]),t},y=function(e){var i=e.children,n=e.ignoreDirection,r=void 0!==n&&n,a=e.size,s=void 0===a?24:a,l=o.useContext(f).direction,c=!r&&l===t.z4.RightToLeft,h="".concat(s||24,"px");return o.createElement("svg",{"aria-hidden":"true",className:m({"rpv-core__icon":!0,"rpv-core__icon--rtl":c}),focusable:"false",height:h,viewBox:"0 0 24 24",width:h},i)},b=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M23.5,0.499l-16.5,23l-6.5-6.5"}))},x=function(e){var i=e.children,n=e.testId,r=e.onClick,a=o.useContext(f).direction===t.z4.RightToLeft,s=n?{"data-testid":n}:{};return o.createElement("button",u({className:m({"rpv-core__primary-button":!0,"rpv-core__primary-button--rtl":a}),type:"button",onClick:r},s),i)},w=function(e){var t=e.size,i=void 0===t?"4rem":t,n=e.testId,r=o.useState(!1),a=r[0],s=r[1],l=n?{"data-testid":n}:{},c=v({onVisibilityChanged:function(e){s(e.isVisible)}});return o.createElement("div",u({},l,{className:m({"rpv-core__spinner":!0,"rpv-core__spinner--animating":a}),ref:c,style:{height:i,width:i}}))},_=function(e){var i=e.ariaLabel,n=void 0===i?"":i,r=e.autoFocus,a=void 0!==r&&r,s=e.placeholder,l=void 0===s?"":s,c=e.testId,h=e.type,d=void 0===h?"text":h,p=e.value,v=void 0===p?"":p,y=e.onChange,b=e.onKeyDown,x=void 0===b?function(){}:b,w=o.useContext(f).direction,_=o.useRef(),S=w===t.z4.RightToLeft,A={ref:_,"data-testid":"","aria-label":n,className:m({"rpv-core__textbox":!0,"rpv-core__textbox--rtl":S}),placeholder:l,value:v,onChange:function(e){return y(e.target.value)},onKeyDown:x};return c&&(A["data-testid"]=c),g((function(){if(a){var e=_.current;if(e){var t=window.scrollX,i=window.scrollY;e.focus(),window.scrollTo(t,i)}}}),[]),"text"===d?o.createElement("input",u({type:"text"},A)):o.createElement("input",u({type:"password"},A))};!function(e){e[e.ExitFullScreen=0]="ExitFullScreen",e[e.FullScreenChange=1]="FullScreenChange",e[e.FullScreenElement=2]="FullScreenElement",e[e.FullScreenEnabled=3]="FullScreenEnabled",e[e.RequestFullScreen=4]="RequestFullScreen"}(p||(p={}));var S,A={ExitFullScreen:"exitFullscreen",FullScreenChange:"fullscreenchange",FullScreenElement:"fullscreenElement",FullScreenEnabled:"fullscreenEnabled",RequestFullScreen:"requestFullscreen"},E={ExitFullScreen:"webkitExitFullscreen",FullScreenChange:"webkitfullscreenchange",FullScreenElement:"webkitFullscreenElement",FullScreenEnabled:"webkitFullscreenEnabled",RequestFullScreen:"webkitRequestFullscreen"},C={ExitFullScreen:"msExitFullscreen",FullScreenChange:"msFullscreenChange",FullScreenElement:"msFullscreenElement",FullScreenEnabled:"msFullscreenEnabled",RequestFullScreen:"msRequestFullscreen"},M="undefined"!=typeof window,P=M&&(p.FullScreenEnabled in document&&A||E.FullScreenEnabled in document&&E||C.FullScreenEnabled in document&&C)||A,T=function(){return M&&P.FullScreenEnabled in document&&!0===document[P.FullScreenEnabled]},D=function(e){return M?e[P.ExitFullScreen]():Promise.resolve({})},R=function(){return M?document[P.FullScreenElement]:null},O=function(e,t){var i=o.useRef(),n=function(){i.current&&clearTimeout(i.current)};return o.useEffect((function(){return function(){return n()}}),[]),o.useCallback((function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];n(),i.current=setTimeout((function(){e.apply(void 0,r)}),t)}),[e,t])},I=function(){var e=o.useRef(!1);return o.useEffect((function(){return e.current=!0,function(){e.current=!1}}),[]),e},k=function(e){var t=o.useRef(e);return o.useEffect((function(){t.current=e}),[e]),t.current};!function(e){e.NotRenderedYet="NotRenderedYet",e.Rendering="Rendering",e.Rendered="Rendered"}(S||(S={}));var L,F=-9999,B=function(e){var t=e.doc,i=t.numPages,n=t.loadingTask.docId,r=o.useMemo((function(){return Array(i).fill(null).map((function(e,t){return{pageIndex:t,renderStatus:S.NotRenderedYet,visibility:F}}))}),[n]),a=o.useRef({currentRenderingPage:-1,startRange:0,endRange:i-1,visibilities:r}),s=function(e,t){a.current.visibilities[e].visibility=t};return{getHighestPriorityPage:function(){var e=a.current.visibilities.slice(a.current.startRange,a.current.endRange+1).filter((function(e){return e.visibility>F}));if(!e.length)return-1;for(var t=e[0].pageIndex,n=e[e.length-1].pageIndex,r=e.length,s=0;s<r;s++){if(e[s].renderStatus===S.Rendering)return-1;if(e[s].renderStatus===S.NotRenderedYet)return e[s].pageIndex}return n+1<i&&a.current.visibilities[n+1].renderStatus!==S.Rendered?n+1:t-1>=0&&a.current.visibilities[t-1].renderStatus!==S.Rendered?t-1:-1},isInRange:function(e){return e>=a.current.startRange&&e<=a.current.endRange},markNotRendered:function(){for(var e=0;e<i;e++)a.current.visibilities[e].renderStatus=S.NotRenderedYet},markRendered:function(e){a.current.visibilities[e].renderStatus=S.Rendered},markRendering:function(e){-1!==a.current.currentRenderingPage&&a.current.currentRenderingPage!==e&&a.current.visibilities[a.current.currentRenderingPage].renderStatus===S.Rendering&&(a.current.visibilities[a.current.currentRenderingPage].renderStatus=S.NotRenderedYet),a.current.visibilities[e].renderStatus=S.Rendering,a.current.currentRenderingPage=e},setOutOfRange:function(e){s(e,F)},setRange:function(e,t){a.current.startRange=e,a.current.endRange=t;for(var n=0;n<i;n++)(n<e||n>t)&&(a.current.visibilities[n].visibility=F,a.current.visibilities[n].renderStatus=S.NotRenderedYet)},setVisibility:s}},N={core:{askingPassword:{requirePasswordToOpen:"This document requires a password to open",submit:"Submit"},wrongPassword:{tryAgain:"The password is wrong. Please try again"},pageLabel:"Page {{pageIndex}}"}},z=o.createContext({l10n:N,setL10n:function(){}}),U=0,j=function(){return U++},V=function(e,t,i){var n=function(e){var n=t.current;if(n){var r=e.target;if(r instanceof Element&&r.shadowRoot){var a=e.composedPath();a.length>0&&!n.contains(a[0])&&i()}else n.contains(r)||i()}};o.useEffect((function(){if(e){var t={capture:!0};return document.addEventListener("click",n,t),function(){document.removeEventListener("click",n,t)}}}),[])},G=function(e){var t=function(t){"Escape"===t.key&&e()};o.useEffect((function(){return document.addEventListener("keyup",t),function(){document.removeEventListener("keyup",t)}}),[])},H=function(e){var i=e.ariaControlsSuffix,n=e.children,r=e.closeOnClickOutside,a=e.closeOnEscape,s=e.onToggle,l=o.useRef(),c=o.useContext(f).direction===t.z4.RightToLeft;return o.useEffect((function(){var e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",function(){document.body.style.overflow=e}}),[]),G((function(){l.current&&a&&s()})),V(r,l,s),g((function(){var e=l.current;if(e){var t=.75*document.body.clientHeight;e.getBoundingClientRect().height>=t&&(e.style.overflow="auto",e.style.maxHeight="".concat(t,"px"))}}),[]),o.createElement("div",{"aria-modal":"true",className:m({"rpv-core__modal-body":!0,"rpv-core__modal-body--rtl":c}),id:"rpv-core__modal-body-".concat(i),ref:l,role:"dialog",tabIndex:-1},n)},W=function(e){var t=e.children;return o.createElement("div",{className:"rpv-core__modal-overlay"},t)};t.$K=void 0,(L=t.$K||(t.$K={})).Close="Close",L.Open="Open",L.Toggle="Toggle";var q,X=function(e){var i=o.useState(e),n=i[0],r=i[1];return{opened:n,toggle:function(e){switch(e){case t.$K.Close:r(!1);break;case t.$K.Open:r(!0);break;case t.$K.Toggle:default:r((function(e){return!e}))}}}},Y=function(e){var t=e.content,i=e.isOpened,n=void 0!==i&&i,r=e.target,a=X(n),s=a.opened,l=a.toggle;return o.createElement(o.Fragment,null,r&&r(l,s),s&&t(l))};t.yX=void 0,(q=t.yX||(t.yX={})).TopLeft="TOP_LEFT",q.TopCenter="TOP_CENTER",q.TopRight="TOP_RIGHT",q.RightTop="RIGHT_TOP",q.RightCenter="RIGHT_CENTER",q.RightBottom="RIGHT_BOTTOM",q.BottomLeft="BOTTOM_LEFT",q.BottomCenter="BOTTOM_CENTER",q.BottomRight="BOTTOM_RIGHT",q.LeftTop="LEFT_TOP",q.LeftCenter="LEFT_CENTER",q.LeftBottom="LEFT_BOTTOM";var Q,K,Z,J,$,ee,te,ie,ne=function(e,i,n,r,a){g((function(){var s=i.current,o=e.current,l=n.current;if(o&&s&&l){var c=l.getBoundingClientRect(),h=function(e,i,n,r){var a=i.getBoundingClientRect(),s=e.getBoundingClientRect(),o=s.height,l=s.width,c=0,h=0;switch(n){case t.yX.TopLeft:c=a.top-o,h=a.left;break;case t.yX.TopCenter:c=a.top-o,h=a.left+a.width/2-l/2;break;case t.yX.TopRight:c=a.top-o,h=a.left+a.width-l;break;case t.yX.RightTop:c=a.top,h=a.left+a.width;break;case t.yX.RightCenter:c=a.top+a.height/2-o/2,h=a.left+a.width;break;case t.yX.RightBottom:c=a.top+a.height-o,h=a.left+a.width;break;case t.yX.BottomLeft:c=a.top+a.height,h=a.left;break;case t.yX.BottomCenter:c=a.top+a.height,h=a.left+a.width/2-l/2;break;case t.yX.BottomRight:c=a.top+a.height,h=a.left+a.width-l;break;case t.yX.LeftTop:c=a.top,h=a.left-l;break;case t.yX.LeftCenter:c=a.top+a.height/2-o/2,h=a.left-l;break;case t.yX.LeftBottom:c=a.top+a.height-o,h=a.left-l}return{left:h+(r.left||0),top:c+(r.top||0)}}(o,s,r,a),d=h.top,u=h.left;o.style.top="".concat(d-c.top,"px"),o.style.left="".concat(u-c.left,"px")}}),[])},re=function(e){var i,n=e.customClassName,r=e.position;return o.createElement("div",{className:m((i={"rpv-core__arrow":!0,"rpv-core__arrow--tl":r===t.yX.TopLeft,"rpv-core__arrow--tc":r===t.yX.TopCenter,"rpv-core__arrow--tr":r===t.yX.TopRight,"rpv-core__arrow--rt":r===t.yX.RightTop,"rpv-core__arrow--rc":r===t.yX.RightCenter,"rpv-core__arrow--rb":r===t.yX.RightBottom,"rpv-core__arrow--bl":r===t.yX.BottomLeft,"rpv-core__arrow--bc":r===t.yX.BottomCenter,"rpv-core__arrow--br":r===t.yX.BottomRight,"rpv-core__arrow--lt":r===t.yX.LeftTop,"rpv-core__arrow--lc":r===t.yX.LeftCenter,"rpv-core__arrow--lb":r===t.yX.LeftBottom},i["".concat(n)]=""!==n,i))})},ae=function(e){var i=e.ariaControlsSuffix,n=e.children,r=e.closeOnClickOutside,a=e.offset,s=e.position,l=e.targetRef,c=e.onClose,h=o.useRef(),d=o.useRef(),u=o.useRef(),p=o.useContext(f).direction===t.z4.RightToLeft;V(r,h,c),ne(h,l,u,s,a),g((function(){var e=d.current;if(e){var t=.75*document.body.clientHeight;e.getBoundingClientRect().height>=t&&(e.style.overflow="auto",e.style.maxHeight="".concat(t,"px"))}}),[]);var v="rpv-core__popover-body-inner-".concat(i);return o.createElement(o.Fragment,null,o.createElement("div",{ref:u,style:{left:0,position:"absolute",top:0}}),o.createElement("div",{"aria-describedby":v,className:m({"rpv-core__popover-body":!0,"rpv-core__popover-body--rtl":p}),id:"rpv-core__popover-body-".concat(i),ref:h,role:"dialog",tabIndex:-1},o.createElement(re,{customClassName:"rpv-core__popover-body-arrow",position:s}),o.createElement("div",{id:v,ref:d},n)))},se=function(e){var t=e.closeOnEscape,i=e.onClose,n=o.useRef();return G((function(){n.current&&t&&i()})),o.createElement("div",{className:"rpv-core__popover-overlay",ref:n})},oe=function(e){var i=e.ariaControlsSuffix,n=e.children,r=e.contentRef,a=e.offset,s=e.position,l=e.targetRef,c=o.useRef(),h=o.useContext(f).direction===t.z4.RightToLeft;return ne(r,l,c,s,a),o.createElement(o.Fragment,null,o.createElement("div",{ref:c,style:{left:0,position:"absolute",top:0}}),o.createElement("div",{className:m({"rpv-core__tooltip-body":!0,"rpv-core__tooltip-body--rtl":h}),id:"rpv-core__tooltip-body-".concat(i),ref:r,role:"tooltip"},o.createElement(re,{customClassName:"rpv-core__tooltip-body-arrow",position:s}),o.createElement("div",{className:"rpv-core__tooltip-body-content"},n)))};t.HG=void 0,(Q=t.HG||(t.HG={})).Normal="Normal",Q.Entering="Entering",Q.Entered="Entered",Q.EnteredCompletely="EnteredCompletely",Q.Exitting="Exitting",Q.Exited="Exited",t._8=void 0,(K=t._8||(t._8={}))[K.PreRender=0]="PreRender",K[K.DidRender=1]="DidRender",t.bH=void 0,(Z=t.bH||(t.bH={})).Attachments="UseAttachments",Z.Bookmarks="UseOutlines",Z.ContentGroup="UseOC",Z.Default="UserNone",Z.FullScreen="FullScreen",Z.Thumbnails="UseThumbs",t.a9=void 0,(J=t.a9||(t.a9={})).RequiredPassword="RequiredPassword",J.WrongPassword="WrongPassword",t.pT=void 0,($=t.pT||(t.pT={})).Backward="Backward",$.Forward="Forward",t.VT=void 0,(ee=t.VT||(t.VT={})).Page="Page",ee.Horizontal="Horizontal",ee.Vertical="Vertical",ee.Wrapped="Wrapped",t.dD=void 0,(te=t.dD||(t.dD={})).ActualSize="ActualSize",te.PageFit="PageFit",te.PageWidth="PageWidth",t.nE=void 0,(ie=t.nE||(t.nE={})).DualPage="DualPage",ie.DualPageWithCover="DualPageWithCover",ie.SinglePage="SinglePage";var le,ce=function(e,t){return e.reduce((function(e,i,n){return n%t?e[e.length-1].push(i):e.push([i]),e}),[])},he=function(e,i){switch(i[1].name){case"XYZ":return{bottomOffset:function(e,t){return null===i[3]?t:i[3]},leftOffset:function(e,t){return null===i[2]?0:i[2]},pageIndex:e,scaleTo:i[4]};case"Fit":case"FitB":return{bottomOffset:0,leftOffset:0,pageIndex:e,scaleTo:t.dD.PageFit};case"FitH":case"FitBH":return{bottomOffset:i[2],leftOffset:0,pageIndex:e,scaleTo:t.dD.PageWidth};default:return{bottomOffset:0,leftOffset:0,pageIndex:e,scaleTo:1}}},de=new Map,ue=new Map,pe=function(e,t){return"".concat(e.loadingTask.docId,"___").concat(t.num,"R").concat(0===t.gen?"":t.gen)},fe=function(e,t,i){de.set(pe(e,t),i)},me=function(e,t){if(!e)return Promise.reject("The document is not loaded yet");var i="".concat(e.loadingTask.docId,"___").concat(t),n=ue.get(i);return n?Promise.resolve(n):new Promise((function(n,r){e.getPage(t+1).then((function(r){ue.set(i,r),r.ref&&fe(e,r.ref,t),n(r)}))}))},ge=function(e,t){return new Promise((function(i){new Promise((function(i){"string"==typeof t?e.getDestination(t).then((function(e){i(e)})):i(t)})).then((function(n){if("object"==typeof n[0]&&null!==n[0]){var r=n[0],a=function(e,t){var i=pe(e,t);return de.has(i)?de.get(i):null}(e,r);null===a?e.getPageIndex(r).then((function(n){fe(e,r,n),ge(e,t).then((function(e){return i(e)}))})):i(he(a,n))}else{var s=he(n[0],n);i(s)}}))}))};!function(e){e[e.Solid=1]="Solid",e[e.Dashed=2]="Dashed",e[e.Beveled=3]="Beveled",e[e.Inset=4]="Inset",e[e.Underline=5]="Underline"}(le||(le={}));var ve,ye=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"),be=function(e,t,i,n){var r=parseInt(e,10);return r>=t&&r<=i?r:n},xe=function(e){return e.contentsObj?e.contentsObj.str:e.contents||""},we=function(e){return e.titleObj?e.titleObj.str:e.title||""},_e=function(e){var i=e.annotation,n=o.useContext(f).direction,r=we(i),a=xe(i),s=n===t.z4.RightToLeft,l=o.useRef(),c="";if(i.modificationDate){var h=function(e){var t=ye.exec(e);if(!t)return null;var i=parseInt(t[1],10),n=be(t[2],1,12,1)-1,r=be(t[3],1,31,1),a=be(t[4],0,23,0),s=be(t[5],0,59,0),o=be(t[6],0,59,0),l=t[7]||"Z",c=be(t[8],0,23,0),h=be(t[9],0,59,0);switch(l){case"-":a+=c,s+=h;break;case"+":a-=c,s-=h}return new Date(Date.UTC(i,n,r,a,s,o))}(i.modificationDate);c=h?"".concat(h.toLocaleDateString(),", ").concat(h.toLocaleTimeString()):""}return o.useLayoutEffect((function(){if(l.current){var e=document.querySelector('[data-annotation-id="'.concat(i.id,'"]'));if(e){var t=e;return t.style.zIndex+=1,function(){t.style.zIndex="".concat(parseInt(t.style.zIndex,10)-1)}}}}),[]),o.createElement("div",{ref:l,className:m({"rpv-core__annotation-popup-wrapper":!0,"rpv-core__annotation-popup-wrapper--rtl":s}),style:{top:i.annotationType===t.UJ.Popup?"":"100%"}},r&&o.createElement(o.Fragment,null,o.createElement("div",{className:m({"rpv-core__annotation-popup-title":!0,"rpv-core__annotation-popup-title--ltr":!s,"rpv-core__annotation-popup-title--rtl":s})},r),o.createElement("div",{className:"rpv-core__annotation-popup-date"},c)),a&&o.createElement("div",{className:"rpv-core__annotation-popup-content"},a.split("\n").map((function(e,t){return o.createElement(o.Fragment,{key:t},e,o.createElement("br",null))}))))};!function(e){e.Click="Click",e.Hover="Hover"}(ve||(ve={}));var Se,Ae=function(e){var i,n=e.annotation,r=e.children,a=e.ignoreBorder,s=e.hasPopup,l=e.isRenderable,c=e.page,h=e.viewport,d=n.rect,u=function(){var e=X(!1),i=e.opened,n=e.toggle,r=o.useState(ve.Hover),a=r[0],s=r[1];return{opened:i,closeOnHover:function(){a===ve.Hover&&n(t.$K.Close)},openOnHover:function(){a===ve.Hover&&n(t.$K.Open)},toggleOnClick:function(){switch(a){case ve.Click:i&&s(ve.Hover),n(t.$K.Toggle);break;case ve.Hover:s(ve.Click),n(t.$K.Open)}}}}(),p=u.closeOnHover,f=u.opened,m=u.openOnHover,g=u.toggleOnClick,v=(i=[d[0],c.view[3]+c.view[1]-d[1],d[2],c.view[3]+c.view[1]-d[3]],[Math.min(i[0],i[2]),Math.min(i[1],i[3]),Math.max(i[0],i[2]),Math.max(i[1],i[3])]),y=d[2]-d[0],b=d[3]-d[1],x={borderColor:"",borderRadius:"",borderStyle:"",borderWidth:""};if(!a&&n.borderStyle.width>0){switch(n.borderStyle.style){case le.Dashed:x.borderStyle="dashed";break;case le.Solid:x.borderStyle="solid";break;case le.Underline:x=Object.assign({borderBottomStyle:"solid"},x);case le.Beveled:case le.Inset:}var w=n.borderStyle.width;x.borderWidth="".concat(w,"px"),n.borderStyle.style!==le.Underline&&(y-=2*w,b-=2*w);var _=n.borderStyle,S=_.horizontalCornerRadius,A=_.verticalCornerRadius;(S>0||A>0)&&(x.borderRadius="".concat(S,"px / ").concat(A,"px")),n.color?x.borderColor="rgb(".concat(0|n.color[0],", ").concat(0|n.color[1],", ").concat(0|n.color[2],")"):x.borderWidth="0"}return o.createElement(o.Fragment,null,l&&r({popup:{opened:f,closeOnHover:p,openOnHover:m,toggleOnClick:g},slot:{attrs:{style:Object.assign({height:"".concat(b,"px"),left:"".concat(v[0],"px"),top:"".concat(v[1],"px"),transform:"matrix(".concat(h.transform.join(","),")"),transformOrigin:"-".concat(v[0],"px -").concat(v[1],"px"),width:"".concat(y,"px")},x)},children:o.createElement(o.Fragment,null,s&&f&&o.createElement(_e,{annotation:n}))}}))},Ee=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s);return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--caret","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},Ce=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s),c=t.rect,h=c[2]-c[0],d=c[3]-c[1],p=t.borderStyle.width;return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--circle","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),o.createElement("svg",{height:"".concat(d,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(h," ").concat(d),width:"".concat(h,"px")},o.createElement("circle",{cy:d/2,fill:"none",rx:h/2-p/2,ry:d/2-p/2,stroke:"transparent",strokeWidth:p||1})),e.slot.children)}))},Me=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=we(t),a=xe(t),s=!(!1!==t.hasPopup||!r&&!a),l=function(){var e,i,n,r,a=t.file;a&&(e=a.filename,n="string"==typeof(i=a.content)?"":URL.createObjectURL(new Blob([i],{type:""})),(r=document.createElement("a")).style.display="none",r.href=n||e,r.setAttribute("download",function(e){var t=e.split("/").pop();return t?t.split("#")[0].split("?")[0]:e}(e)),document.body.appendChild(r),r.click(),document.body.removeChild(r),n&&URL.revokeObjectURL(n))};return o.createElement(Ae,{annotation:t,hasPopup:s,ignoreBorder:!0,isRenderable:!0,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--file-attachment","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onDoubleClick:l,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},Pe=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s);return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--free-text","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},Te=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=we(t),a=xe(t),s=!(!r&&!a),l=!t.parentType||-1!==["Circle","Ink","Line","Polygon","PolyLine","Square"].indexOf(t.parentType);return g((function(){if(t.parentId){var e=document.querySelector('[data-annotation-id="'.concat(t.parentId,'"]')),i=document.querySelector('[data-annotation-id="'.concat(t.id,'"]'));if(e&&i){var n=parseFloat(e.style.left),r=parseFloat(e.style.top)+parseFloat(e.style.height);i.style.left="".concat(n,"px"),i.style.top="".concat(r,"px"),i.style.transformOrigin="-".concat(n,"px -").concat(r,"px")}}}),[]),o.createElement(Ae,{annotation:t,hasPopup:l,ignoreBorder:!1,isRenderable:s,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--popup","data-annotation-id":t.id}),o.createElement(_e,{annotation:t}))}))},De=function(e){var i=e.annotation,n=e.childAnnotation,r=e.page,a=e.viewport,s=!1===i.hasPopup,l=we(i),c=xe(i),h=!!(i.hasPopup||l||c);if(i.quadPoints&&i.quadPoints.length>0){var d=i.quadPoints.map((function(e){return Object.assign({},i,{rect:[e[2].x,e[2].y,e[1].x,e[1].y],quadPoints:[]})}));return o.createElement(o.Fragment,null,d.map((function(e,t){return o.createElement(De,{key:t,annotation:e,childAnnotation:n,page:r,viewport:a})})))}return o.createElement(Ae,{annotation:i,hasPopup:s,ignoreBorder:!0,isRenderable:h,page:r,viewport:a},(function(e){return o.createElement(o.Fragment,null,o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--highlight","data-annotation-id":i.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children),n&&n.annotationType===t.UJ.Popup&&e.popup.opened&&o.createElement(Te,{annotation:n,page:r,viewport:a}))}))},Re=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s),c=t.rect,h=c[2]-c[0],d=c[3]-c[1],p=t.borderStyle.width;return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--ink","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),t.inkLists&&t.inkLists.length&&o.createElement("svg",{height:"".concat(d,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(h," ").concat(d),width:"".concat(h,"px")},t.inkLists.map((function(e,t){return o.createElement("polyline",{key:t,fill:"none",stroke:"transparent",strokeWidth:p||1,points:e.map((function(e){return"".concat(e.x-c[0],",").concat(c[3]-e.y)})).join(" ")})}))),e.slot.children)}))},Oe=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s),c=t.rect,h=c[2]-c[0],d=c[3]-c[1],p=t.borderStyle.width;return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--line","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),o.createElement("svg",{height:"".concat(d,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(h," ").concat(d),width:"".concat(h,"px")},o.createElement("line",{stroke:"transparent",strokeWidth:p||1,x1:c[2]-t.lineCoordinates[0],x2:c[2]-t.lineCoordinates[2],y1:c[3]-t.lineCoordinates[1],y2:c[3]-t.lineCoordinates[3]})),e.slot.children)}))},Ie=/^([^\w]*)(javascript|data|vbscript)/im,ke=/&#(\w+)(^\w|;)?/g,Le=/[\u0000-\u001F\u007F-\u009F\u2000-\u200D\uFEFF]/gim,Fe=/^([^:]+):/gm,Be=function(e){var t,i=e.annotation,n=e.annotationContainerRef,r=e.doc,a=e.outlines,s=e.page,l=e.pageIndex,c=e.scale,h=e.viewport,d=e.onExecuteNamedAction,p=e.onJumpFromLinkAnnotation,f=e.onJumpToDest,m=o.useRef(),g=a&&a.length&&i.dest&&"string"==typeof i.dest?null===(t=a.find((function(e){return e.dest===i.dest})))||void 0===t?void 0:t.title:"",v=!!(i.url||i.dest||i.action||i.unsafeUrl),y={};if(i.url||i.unsafeUrl){var b=function(e,t){void 0===t&&(t="about:blank");var i,n=(i=e||"",i.replace(ke,(function(e,t){return String.fromCharCode(t)}))).replace(Le,"").trim();if(!n)return t;var r=n[0];if("."===r||"/"===r)return n;var a=n.match(Fe);if(!a)return n;var s=a[0];return Ie.test(s)?t:n}(i.url||i.unsafeUrl,"");b?y={"data-target":"external",href:b,rel:"noopener noreferrer nofollow",target:i.newWindow?"_blank":"",title:b}:v=!1}else y={href:"","data-annotation-link":i.id,onClick:function(e){e.preventDefault(),i.action?d(i.action):ge(r,i.dest).then((function(e){var t=m.current,i=n.current;if(t&&i){var r=t.getBoundingClientRect();i.style.setProperty("height","100%"),i.style.setProperty("width","100%");var a=i.getBoundingClientRect();i.style.removeProperty("height"),i.style.removeProperty("width");var s=(r.left-a.left)/c,o=(a.bottom-r.bottom+r.height)/c;p({bottomOffset:o,label:g,leftOffset:s,pageIndex:l})}f(e)}))}};return g&&(y=Object.assign({},y,{title:g,"aria-label":g})),o.createElement(Ae,{annotation:i,hasPopup:!1,ignoreBorder:!1,isRenderable:v,page:s,viewport:h},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--link","data-annotation-id":i.id,"data-testid":"core__annotation--link-".concat(i.id)}),o.createElement("a",u({ref:m},y)))}))},Ne=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s),c=t.rect,h=c[2]-c[0],d=c[3]-c[1],p=t.borderStyle.width;return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--polygon","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),t.vertices&&t.vertices.length&&o.createElement("svg",{height:"".concat(d,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(h," ").concat(d),width:"".concat(h,"px")},o.createElement("polygon",{fill:"none",stroke:"transparent",strokeWidth:p||1,points:t.vertices.map((function(e){return"".concat(e.x-c[0],",").concat(c[3]-e.y)})).join(" ")})),e.slot.children)}))},ze=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s),c=t.rect,h=c[2]-c[0],d=c[3]-c[1],p=t.borderStyle.width;return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--polyline","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),t.vertices&&t.vertices.length&&o.createElement("svg",{height:"".concat(d,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(h," ").concat(d),width:"".concat(h,"px")},o.createElement("polyline",{fill:"none",stroke:"transparent",strokeWidth:p||1,points:t.vertices.map((function(e){return"".concat(e.x-c[0],",").concat(c[3]-e.y)})).join(" ")})),e.slot.children)}))},Ue=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s),c=t.rect,h=c[2]-c[0],d=c[3]-c[1],p=t.borderStyle.width;return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--square","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),o.createElement("svg",{height:"".concat(d,"px"),preserveAspectRatio:"none",version:"1.1",viewBox:"0 0 ".concat(h," ").concat(d),width:"".concat(h,"px")},o.createElement("rect",{height:d-p,fill:"none",stroke:"transparent",strokeWidth:p||1,x:p/2,y:p/2,width:h-p})),e.slot.children)}))},je=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s);return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--squiggly","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},Ve=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s);return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--stamp","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},Ge=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s);return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--strike-out","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},He=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M.5,16.5a1,1,0,0,0,1,1h2v4l4-4h15a1,1,0,0,0,1-1V3.5a1,1,0,0,0-1-1H1.5a1,1,0,0,0-1,1Z"}),o.createElement("path",{d:"M7.25,9.75A.25.25,0,1,1,7,10a.25.25,0,0,1,.25-.25"}),o.createElement("path",{d:"M12,9.75a.25.25,0,1,1-.25.25A.25.25,0,0,1,12,9.75"}),o.createElement("path",{d:"M16.75,9.75a.25.25,0,1,1-.25.25.25.25,0,0,1,.25-.25"}))},We=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M0.500 12.001 A11.500 11.500 0 1 0 23.500 12.001 A11.500 11.500 0 1 0 0.500 12.001 Z"}),o.createElement("path",{d:"M6.000 12.001 A6.000 6.000 0 1 0 18.000 12.001 A6.000 6.000 0 1 0 6.000 12.001 Z"}),o.createElement("path",{d:"M21.423 5.406L17.415 9.414"}),o.createElement("path",{d:"M14.587 6.585L18.607 2.565"}),o.createElement("path",{d:"M5.405 21.424L9.413 17.416"}),o.createElement("path",{d:"M6.585 14.588L2.577 18.596"}),o.createElement("path",{d:"M18.602 21.419L14.595 17.412"}),o.createElement("path",{d:"M17.419 14.58L21.428 18.589"}),o.createElement("path",{d:"M2.582 5.399L6.588 9.406"}),o.createElement("path",{d:"M9.421 6.581L5.412 2.572"}))},qe=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M4.000 18.500 A1.500 1.500 0 1 0 7.000 18.500 A1.500 1.500 0 1 0 4.000 18.500 Z"}),o.createElement("path",{d:"M20.5.5l-9.782,9.783a7,7,0,1,0,3,3L17,10h1.5V8.5L19,8h1.5V6.5L21,6h1.5V4.5l1-1V.5Z"}))},Xe=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M2.000 2.500 L22.000 2.500 L22.000 23.500 L2.000 23.500 Z"}),o.createElement("path",{d:"M6 4.5L6 0.5"}),o.createElement("path",{d:"M18 4.5L18 0.5"}),o.createElement("path",{d:"M10 4.5L10 0.5"}),o.createElement("path",{d:"M14 4.5L14 0.5"}))},Ye=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M17.5 0.498L17.5 23.498"}),o.createElement("path",{d:"M10.5 0.498L10.5 23.498"}),o.createElement("path",{d:"M23.5.5H6.5a6,6,0,0,0,0,12h4"}))},Qe=function(){return o.createElement(y,{size:16},o.createElement("path",{d:"M2.5 22.995L12 6.005 21.5 22.995 2.5 22.995z"}))},Ke=function(e){var i=e.annotation,n=e.childAnnotation,r=e.page,a=e.viewport,s=!1===i.hasPopup,l=we(i),c=xe(i),h=!!(i.hasPopup||l||c),d=i.name?i.name.toLowerCase():"";return o.createElement(Ae,{annotation:i,hasPopup:s,ignoreBorder:!1,isRenderable:h,page:r,viewport:a},(function(e){return o.createElement(o.Fragment,null,o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--text","data-annotation-id":i.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),d&&o.createElement("div",{className:"rpv-core__annotation-text-icon"},"check"===d&&o.createElement(b,null),"comment"===d&&o.createElement(He,null),"help"===d&&o.createElement(We,null),"insert"===d&&o.createElement(Qe,null),"key"===d&&o.createElement(qe,null),"note"===d&&o.createElement(Xe,null),("newparagraph"===d||"paragraph"===d)&&o.createElement(Ye,null)),e.slot.children),n&&n.annotationType===t.UJ.Popup&&e.popup.opened&&o.createElement(Te,{annotation:n,page:r,viewport:a}))}))},Ze=function(e){var t=e.annotation,i=e.page,n=e.viewport,r=!1===t.hasPopup,a=we(t),s=xe(t),l=!!(t.hasPopup||a||s);return o.createElement(Ae,{annotation:t,hasPopup:r,ignoreBorder:!0,isRenderable:l,page:i,viewport:n},(function(e){return o.createElement("div",u({},e.slot.attrs,{className:"rpv-core__annotation rpv-core__annotation--underline","data-annotation-id":t.id,onClick:e.popup.toggleOnClick,onMouseEnter:e.popup.openOnHover,onMouseLeave:e.popup.closeOnHover}),e.slot.children)}))},Je=function(e){var i=e.annotations,n=e.doc,r=e.outlines,a=e.page,s=e.pageIndex,l=e.plugins,c=e.rotation,h=e.scale,d=e.onExecuteNamedAction,u=e.onJumpFromLinkAnnotation,p=e.onJumpToDest,f=o.useRef(),m=a.getViewport({rotation:c,scale:h}).clone({dontFlip:!0}),v=i.filter((function(e){return!e.parentId}));return g((function(){var e=f.current;e&&l.forEach((function(t){t.onAnnotationLayerRender&&t.onAnnotationLayerRender({annotations:v,container:e,pageIndex:s,rotation:c,scale:h})}))}),[]),o.createElement("div",{ref:f,className:"rpv-core__annotation-layer","data-testid":"core__annotation-layer-".concat(s)},v.map((function(e){var l=i.find((function(t){return t.parentId===e.id}));switch(e.annotationType){case t.UJ.Caret:return o.createElement(Ee,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Circle:return o.createElement(Ce,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.FileAttachment:return o.createElement(Me,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.FreeText:return o.createElement(Pe,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Highlight:return o.createElement(De,{key:e.id,annotation:e,childAnnotation:l,page:a,viewport:m});case t.UJ.Ink:return o.createElement(Re,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Line:return o.createElement(Oe,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Link:return o.createElement(Be,{key:e.id,annotation:e,annotationContainerRef:f,doc:n,outlines:r,page:a,pageIndex:s,scale:h,viewport:m,onExecuteNamedAction:d,onJumpFromLinkAnnotation:u,onJumpToDest:p});case t.UJ.Polygon:return o.createElement(Ne,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Polyline:return o.createElement(ze,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Popup:return o.createElement(Te,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Square:return o.createElement(Ue,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Squiggly:return o.createElement(je,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Stamp:return o.createElement(Ve,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.StrikeOut:return o.createElement(Ge,{key:e.id,annotation:e,page:a,viewport:m});case t.UJ.Text:return o.createElement(Ke,{key:e.id,annotation:e,childAnnotation:l,page:a,viewport:m});case t.UJ.Underline:return o.createElement(Ze,{key:e.id,annotation:e,page:a,viewport:m});default:return o.createElement(o.Fragment,{key:e.id})}})))},$e=function(e){var t=e.page,i=e.renderAnnotations,n=I(),r=o.useState({loading:!0,annotations:[]}),a=r[0],s=r[1];return o.useEffect((function(){t.getAnnotations({intent:"display"}).then((function(e){n.current&&s({loading:!1,annotations:e})}))}),[]),a.loading?o.createElement(o.Fragment,null):i(a.annotations)},et=function(e){var t=e.doc,i=e.outlines,n=e.page,r=e.pageIndex,a=e.plugins,s=e.rotation,l=e.scale,c=e.onExecuteNamedAction,h=e.onJumpFromLinkAnnotation,d=e.onJumpToDest;return o.createElement($e,{page:n,renderAnnotations:function(e){return o.createElement(Je,{annotations:e,doc:t,outlines:i,page:n,pageIndex:r,plugins:a,rotation:s,scale:l,onExecuteNamedAction:c,onJumpFromLinkAnnotation:h,onJumpToDest:d})}})},tt=function(e,t){var i=e%t;return 0===i?e:Math.floor(e-i)},it=function(e){var i=e.canvasLayerRef,n=e.height,r=e.page,a=e.pageIndex,s=e.plugins,l=e.rotation,c=e.scale,h=e.width,d=e.onRenderCanvasCompleted,u=o.useRef();return g((function(){var e=u.current;e&&e.cancel();var n=i.current;n.removeAttribute("data-testid"),s.forEach((function(e){e.onCanvasLayerRender&&e.onCanvasLayerRender({ele:n,pageIndex:a,rotation:l,scale:c,status:t._8.PreRender})}));var o=r.getViewport({rotation:l,scale:c}),h=window.devicePixelRatio||1,p=Math.sqrt(16777216/(o.width*o.height)),f=h>p;f?n.style.transform="scale(1, 1)":n.style.removeProperty("transform");var m=Math.min(p,h),g=function(e,t){var i,n;if(Math.floor(e)===e)return[e,1];var r=1/e;if(r>8)return[1,8];if(Math.floor(r)===r)return[1,r];for(var a=e>1?r:e,s=0,o=1,l=1,c=1;;){var h=s+l,d=o+c;if(d>8)break;a<=h/d?(l=(i=[h,d])[0],c=i[1]):(s=(n=[h,d])[0],o=n[1])}return a<(s/o+l/c)/2?a===e?[s,o]:[o,s]:a===e?[l,c]:[c,l]}(m),v=g[0],y=g[1];n.width=tt(o.width*m,v),n.height=tt(o.height*m,v),n.style.width="".concat(tt(o.width,y),"px"),n.style.height="".concat(tt(o.height,y),"px"),n.hidden=!0;var b=n.getContext("2d",{alpha:!1}),x=f||1!==h?[m,0,0,m,0,0]:null;return u.current=r.render({canvasContext:b,transform:x,viewport:o}),u.current.promise.then((function(){n.hidden=!1,n.setAttribute("data-testid","core__canvas-layer-".concat(a)),s.forEach((function(e){e.onCanvasLayerRender&&e.onCanvasLayerRender({ele:n,pageIndex:a,rotation:l,scale:c,status:t._8.DidRender})})),d()}),(function(){d()})),function(){n&&(n.width=0,n.height=0)}}),[]),o.createElement("div",{className:"rpv-core__canvas-layer",style:{height:"".concat(n,"px"),width:"".concat(h,"px")}},o.createElement("canvas",{ref:i}))},nt=function(e){var t=e.height,i=e.page,n=e.rotation,r=e.scale,a=e.width,s=o.useRef();return g((function(){var e=s.current,o=i.getViewport({rotation:n,scale:r});i.getOperatorList().then((function(n){!function(){var e=s.current;e&&(e.innerHTML="")}(),new l.SVGGraphics(i.commonObjs,i.objs).getSVG(n,o).then((function(i){i.style.height="".concat(t,"px"),i.style.width="".concat(a,"px"),e.appendChild(i)}))}))}),[]),o.createElement("div",{className:"rpv-core__svg-layer",ref:s})},rt=function(e){var i=e.containerRef,n=e.page,r=e.pageIndex,a=e.plugins,s=e.rotation,c=e.scale,h=e.onRenderTextCompleted,d=o.useRef(),u=function(){var e=i.current;e&&([].slice.call(e.querySelectorAll(".rpv-core__text-layer-text")).forEach((function(t){return e.removeChild(t)})),[].slice.call(e.querySelectorAll('br[role="presentation"]')).forEach((function(t){return e.removeChild(t)})))};return g((function(){var e=d.current;e&&e.cancel();var o=i.current;if(o){o.removeAttribute("data-testid");var p=n.getViewport({rotation:s,scale:c});return a.forEach((function(e){e.onTextLayerRender&&e.onTextLayerRender({ele:o,pageIndex:r,scale:c,status:t._8.PreRender})})),n.getTextContent().then((function(e){u(),d.current=l.renderTextLayer({container:o,textContent:e,textContentSource:e,viewport:p}),d.current.promise.then((function(){o.setAttribute("data-testid","core__text-layer-".concat(r)),[].slice.call(o.children).forEach((function(e){e.classList.contains("rpv-core__text-layer-text--not")||e.classList.add("rpv-core__text-layer-text")})),a.forEach((function(e){e.onTextLayerRender&&e.onTextLayerRender({ele:o,pageIndex:r,scale:c,status:t._8.DidRender})})),h()}),(function(){o.removeAttribute("data-testid"),h()}))})),function(){var e;u(),null===(e=d.current)||void 0===e||e.cancel()}}}),[]),o.createElement("div",{className:"rpv-core__text-layer",ref:i})},at=function(e){var i=e.doc,n=e.measureRef,r=e.outlines,a=e.pageIndex,s=e.pageRotation,l=e.pageSize,c=e.plugins,h=e.renderPage,d=e.renderQueueKey,u=e.rotation,p=e.scale,f=e.shouldRender,g=e.viewMode,v=e.onExecuteNamedAction,y=e.onJumpFromLinkAnnotation,b=e.onJumpToDest,x=e.onRenderCompleted,_=e.onRotatePage,S=I(),A=o.useState(null),E=A[0],C=A[1],M=o.useState(!1),P=M[0],T=M[1],D=o.useState(!1),R=D[0],O=D[1],k=o.useRef(),L=o.useRef(),F=Math.abs(u+s)%180==0,B=l.pageWidth*p,N=l.pageHeight*p,z=F?B:N,U=F?N:B,j=(l.rotation+u+s)%360,V=o.useRef(0),G=h||function(e){return o.createElement(o.Fragment,null,e.canvasLayer.children,e.textLayer.children,e.annotationLayer.children)};return o.useEffect((function(){C(null),T(!1),O(!1)}),[s,u,p]),o.useEffect((function(){f&&S.current&&!E&&me(i,a).then((function(e){S.current&&(V.current=d,C(e))}))}),[f,E]),o.useEffect((function(){P&&R&&(d!==V.current?(C(null),T(!1),O(!1)):x(a))}),[P,R]),o.createElement("div",{className:m({"rpv-core__page-layer":!0,"rpv-core__page-layer--dual":g===t.nE.DualPage,"rpv-core__page-layer--dual-cover":g===t.nE.DualPageWithCover,"rpv-core__page-layer--single":g===t.nE.SinglePage}),"data-testid":"core__page-layer-".concat(a),ref:n,style:{height:"".concat(U,"px"),width:"".concat(z,"px")}},E?o.createElement(o.Fragment,null,G({annotationLayer:{attrs:{},children:o.createElement(et,{doc:i,outlines:r,page:E,pageIndex:a,plugins:c,rotation:j,scale:p,onExecuteNamedAction:v,onJumpFromLinkAnnotation:y,onJumpToDest:b})},canvasLayer:{attrs:{},children:o.createElement(it,{canvasLayerRef:k,height:U,page:E,pageIndex:a,plugins:c,rotation:j,scale:p,width:z,onRenderCanvasCompleted:function(){S.current&&T(!0)}})},canvasLayerRendered:P,doc:i,height:U,pageIndex:a,rotation:j,scale:p,svgLayer:{attrs:{},children:o.createElement(nt,{height:U,page:E,rotation:j,scale:p,width:z})},textLayer:{attrs:{},children:o.createElement(rt,{containerRef:L,page:E,pageIndex:a,plugins:c,rotation:j,scale:p,onRenderTextCompleted:function(){S.current&&O(!0)}})},textLayerRendered:R,width:z,markRendered:x,onRotatePage:function(e){return _(a,e)}}),c.map((function(e,t){return e.renderPageLayer?o.createElement(o.Fragment,{key:t},e.renderPageLayer({canvasLayerRef:k,canvasLayerRendered:P,doc:i,height:U,pageIndex:a,rotation:j,scale:p,textLayerRef:L,textLayerRendered:R,width:z})):o.createElement(o.Fragment,{key:t})}))):o.createElement(w,{testId:"core__page-layer-loading-".concat(a)}))},st=function(e,t){var i=t.rect;return e.height!==i.height||e.width!==i.width?i:e};!function(e){e.Horizontal="Horizontal",e.Vertical="Vertical",e.Both="Both"}(Se||(Se={}));var ot=function(e){return 1-Math.pow(1-e,4)},lt=1e-4,ct={left:0,top:0},ht={capture:!1,passive:!0},dt=function(e,t,i){return Math.max(e,Math.min(i,t))},ut=function(e,i){if(i!==t.nE.DualPageWithCover)return 0;if(!function(e){var t=e.length;if(1===t)return!1;for(var i=1;i<t;i++)if(e[i].height!==e[0].height||e[i].width!==e[0].width)return!0;return!1}(e))return 2*e[0].width;var n=ce(e.slice(1),2).map((function(e){return 2===e.length?e[0].width+e[1].width:e[0].width})),r=[e[0].width].concat(n);return Math.max.apply(Math,r)},pt={left:0,top:0},ft={left:0,top:0},mt={left:0,top:0},gt={left:0,top:0},vt={height:0,width:0},yt={left:0,top:0},bt="data-virtual-index",xt=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1],wt=function(e){var i=e.enableSmoothScroll,n=e.isRtl,r=e.numberOfItems,a=e.parentRef,s=e.setRenderRange,l=e.sizes,c=e.scrollMode,h=e.viewMode,d=o.useState(!1),p=d[0],f=d[1],m=o.useCallback((function(e){return f(e)}),[]),v=o.useRef(c);v.current=c;var y=o.useRef(h);y.current=h;var b=c===t.VT.Wrapped||h===t.nE.DualPageWithCover||h===t.nE.DualPage?Se.Both:c===t.VT.Horizontal?Se.Horizontal:Se.Vertical,x=function(e){var t=e.elementRef,i=e.enableSmoothScroll,n=e.isRtl,r=e.scrollDirection,a=e.onSmoothScroll,s=o.useState(ct),l=s[0],c=s[1],h=o.useState(t.current),d=h[0],u=h[1],p=n?-1:1,f=o.useRef(r);f.current=r;var m=o.useRef(ct),v=o.useRef(!0),y=o.useCallback((function(){v.current=!0,i&&c(m.current),a(!1)}),[]),b=o.useCallback((function(){if(d){switch(f.current){case Se.Horizontal:m.current={left:p*d.scrollLeft,top:0};break;case Se.Both:m.current={left:p*d.scrollLeft,top:d.scrollTop};break;case Se.Vertical:default:m.current={left:0,top:d.scrollTop}}i&&!v.current||c(m.current)}}),[d]);g((function(){u(t.current)})),g((function(){if(d)return d.addEventListener("scroll",b,ht),function(){d.removeEventListener("scroll",b,ht)}}),[d]);var x=o.useCallback((function(e,i){var n=t.current;if(!n)return Promise.resolve();var r={left:0,top:0};switch(f.current){case Se.Horizontal:r.left=p*e.left;break;case Se.Both:r.left=p*e.left,r.top=e.top;break;case Se.Vertical:default:r.top=e.top}return i?(v.current=!1,a(!0),new Promise((function(e,t){!function(e,t,i,n,r,a){void 0===r&&(r=function(e){return e}),void 0===a&&(a=function(){});var s=0,o=0,l=!1;switch(t){case Se.Horizontal:o=e.scrollLeft,s=0;case Se.Both:o=e.scrollLeft,s=e.scrollTop;break;case Se.Vertical:default:o=0,s=e.scrollTop}var c=function(){l||(l=!0,e.scrollLeft=i.left,e.scrollTop=i.top,a())};if(Math.abs(s-i.top)<=lt&&t===Se.Vertical)c();else if(Math.abs(o-i.left)<=lt&&t===Se.Horizontal)c();else{var h,d=-1,u=o-i.left,p=s-i.top,f=function(n){-1===d&&(d=n);var a=n-d,m=Math.min(a/400,1),g=r(m),v={left:o-u*g,top:s-p*g};switch(t){case Se.Horizontal:e.scrollLeft=v.left;break;case Se.Both:e.scrollLeft=v.left,e.scrollTop=v.top;break;case Se.Vertical:default:e.scrollTop=v.top}Math.abs(v.top-i.top)<=lt&&Math.abs(v.left-i.left)<=lt&&!l&&(window.cancelAnimationFrame(h),c()),a<400?h=window.requestAnimationFrame(f):window.cancelAnimationFrame(h)};h=window.requestAnimationFrame(f)}}(n,f.current,r,0,ot,(function(){y(),e()}))}))):new Promise((function(e,t){switch(f.current){case Se.Horizontal:n.scrollLeft=r.left;break;case Se.Both:n.scrollLeft=r.left,n.scrollTop=r.top;break;case Se.Vertical:default:n.scrollTop=r.top}e()}))}),[t]);return{scrollOffset:l,scrollTo:x}}({elementRef:a,enableSmoothScroll:i,isRtl:n,scrollDirection:b,onSmoothScroll:m}),w=x.scrollOffset,_=x.scrollTo,S=function(e){var t=e.elementRef,i=o.useState(t.current),n=i[0],r=i[1],a=o.useRef(!1),s=o.useReducer(st,{height:0,width:0}),l=s[0],c=s[1];return g((function(){t.current!==n&&r(t.current)})),g((function(){if(n&&!a.current){a.current=!0;var e=n.getBoundingClientRect(),t=e.height,i=e.width;c({rect:{height:t,width:i}})}}),[n]),o.useEffect((function(){if(n){var e=new ResizeObserver((function(e,t){e.forEach((function(e){if(e.target===n){var t=e.contentRect,i=t.height,r=t.width;c({rect:{height:i,width:r}})}}))}));return e.observe(n),function(){e.unobserve(n)}}}),[n]),l}({elementRef:a}),A=o.useRef({scrollOffset:yt,measurements:[]});A.current.scrollOffset=w;var E=o.useMemo((function(){return Array(r).fill(-1)}),[]),C=o.useState(E),M=C[0],P=C[1],T=o.useMemo((function(){var e=new IntersectionObserver((function(e){e.forEach((function(e){var t=e.isIntersecting?e.intersectionRatio:-1,i=e.target.getAttribute(bt);if(i){var n=parseInt(i,10);0<=n&&n<r&&P((function(e){return e[n]=t,function(e,t,i){if(i||2===arguments.length)for(var n,r=0,a=t.length;r<a;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))}([],e,!0)}))}}))}),{threshold:xt});return e}),[]),D=o.useMemo((function(){return c===t.VT.Page&&h===t.nE.SinglePage?function(e,t,i){for(var n=[],r=0;r<e;r++){var a={height:Math.max(t.height,i[r].height),width:Math.max(t.width,i[r].width)},s=0===r?gt:n[r-1].end,o={left:s.left+a.width,top:s.top+a.height};n[r]={index:r,start:s,size:a,end:o,visibility:-1}}return n}(r,S,l):h===t.nE.DualPageWithCover?function(e,i,n,r){for(var a=[],s=0,o=0,l=mt,c=0;c<e;c++){var h=0===c?{height:r===t.VT.Page?Math.max(i.height,n[c].height):n[c].height,width:r===t.VT.Page?Math.max(i.width,n[c].width):n[c].width}:{height:r===t.VT.Page?Math.max(i.height,n[c].height):n[c].height,width:Math.max(i.width/2,n[c].width)};r===t.VT.Page?l=0===c?mt:{left:c%2==0?h.width:0,top:Math.floor((c-1)/2)*h.height+a[0].end.top}:0===c?(l=mt,s=n[0].height,o=0):c%2==1?(l={left:0,top:s+=o},o=c===e-1?n[c].height:Math.max(n[c].height,n[c+1].height)):l={left:a[c-1].end.left,top:s};var d={left:l.left+h.width,top:l.top+h.height};a[c]={index:c,start:l,size:h,end:d,visibility:-1}}return a}(r,S,l,c):h===t.nE.DualPage?function(e,i,n,r){for(var a=[],s=0,o=0,l=ft,c=0;c<e;c++){var h={height:r===t.VT.Page?Math.max(i.height,n[c].height):n[c].height,width:Math.max(i.width/2,n[c].width)};r===t.VT.Page?l={left:c%2==0?0:h.width,top:Math.floor(c/2)*h.height}:c%2==0?(l={left:0,top:s+=o},o=c===e-1?n[c].height:Math.max(n[c].height,n[c+1].height)):l={left:a[c-1].end.left,top:s};var d={left:l.left+h.width,top:l.top+h.height};a[c]={index:c,start:l,size:h,end:d,visibility:-1}}return a}(r,S,l,c):function(e,i,n,r){for(var a=[],s=0,o={left:0,top:0},l=0,c=pt,h=0;h<e;h++){var d=n[h];if(0===h)s=d.width,o={left:0,top:0},l=d.height;else switch(r){case t.VT.Wrapped:(s+=d.width)<i.width?(c={left:a[h-1].end.left,top:o.top},l=Math.max(l,d.height)):(s=d.width,o={left:(c={left:o.left,top:o.top+l}).left,top:c.top},l=d.height);break;case t.VT.Horizontal:case t.VT.Vertical:default:c=a[h-1].end}var u={left:c.left+d.width,top:c.top+d.height};a[h]={index:h,start:c,size:d,end:u,visibility:-1}}return a}(r,S,l,c)}),[c,l,h,S]),R=D[r-1]?{height:D[r-1].end.top,width:D[r-1].end.left}:vt;A.current.measurements=D;var O=o.useMemo((function(){var e=function(e,t,i,n){var r=0;switch(e){case Se.Horizontal:r=n.left;break;case Se.Vertical:default:r=n.top}var a=t.length-1,s=function(e,t,i,n){for(;e<=t;){var r=(e+t)/2|0,a=n(r);if(a<i)e=r+1;else{if(!(a>i))return r;t=r-1}}return e>0?e-1:0}(0,a,r,(function(i){switch(e){case Se.Horizontal:return t[i].start.left;case Se.Both:case Se.Vertical:default:return t[i].start.top}}));if(e===Se.Both)for(var o=t[s].start.top;s-1>=0&&t[s-1].start.top===o&&t[s-1].start.left>=n.left;)s--;for(var l=s;l<=a;){var c={top:t[l].start.top-n.top,left:t[l].start.left-n.left},h={height:i.height-c.top,width:i.width-c.left};if(e===Se.Horizontal&&h.width<0)break;if(e===Se.Vertical&&h.height<0)break;if(e===Se.Both&&(h.width<0||h.height<0))break;l++}return{start:s,end:l}}(b,D,S,w),i=e.start,n=e.end,a=i+M.slice(dt(0,r,i),dt(0,r,n)).reduce((function(e,t,i,n){return t>n[e]?i:e}),0),o=a=dt(0,r-1,a),l=s({endPage:n,numPages:r,startPage:i}),c=l.startPage,d=l.endPage;switch(c=Math.max(c,0),d=Math.min(d,r-1),h){case t.nE.DualPageWithCover:a>0&&(o=a%2==1?a:a-1),c=0===c?0:c%2==1?c:c-1,r-(d=d%2==1?d-1:d)<=2&&(d=r-1);break;case t.nE.DualPage:o=a%2==0?a:a-1,c=c%2==0?c:c-1,d=d%2==1?d:d-1;break;case t.nE.SinglePage:default:o=a}return{startPage:c,endPage:d,maxVisbilityIndex:o}}),[D,S,w,h,M]),I=O.startPage,k=O.endPage,L=O.maxVisbilityIndex,F=o.useMemo((function(){for(var e=[],t=function(t){var i=D[t],n=u(u({},i),{visibility:void 0!==M[t]?M[t]:-1,measureRef:function(e){e&&(e.setAttribute(bt,"".concat(t)),T.observe(e))}});e.push(n)},i=I;i<=k;i++)t(i);return e}),[I,k,M,D]),B=o.useCallback((function(e,n){var a=A.current.measurements[dt(0,r-1,e)],s=v.current===t.VT.Page?yt:n;return a?_({left:s.left+a.start.left,top:s.top+a.start.top},i):Promise.resolve()}),[_,i]),N=o.useCallback((function(e,i){var n=A.current.measurements,r=n[e].start,a=n.find((function(e){return e.start.top-r.top>1e-12}));if(!a)return Promise.resolve();var s=a.index;switch(y.current){case t.nE.DualPage:s=s%2==0?s:s+1;break;case t.nE.DualPageWithCover:s=s%2==1?s:s+1}return B(s,i)}),[]),z=o.useCallback((function(e,i){for(var n=A.current.measurements,a=n[e].start,s=e,o=!1,l=r-1;l>=0;l--)if(a.top-n[l].start.top>1e-12){o=!0,s=n[l].index;break}if(!o)return Promise.resolve();switch(y.current){case t.nE.DualPage:s=s%2==0?s:s-1;break;case t.nE.DualPageWithCover:s=s%2==0?s-1:s}return s===e&&(s=e-1),B(s,i)}),[]),U=o.useCallback((function(e,i){if(y.current===t.nE.DualPageWithCover||y.current===t.nE.DualPage)return N(e,i);switch(v.current){case t.VT.Wrapped:return N(e,i);case t.VT.Horizontal:case t.VT.Vertical:default:return B(e+1,i)}}),[]),j=o.useCallback((function(e,i){if(y.current===t.nE.DualPageWithCover||y.current===t.nE.DualPage)return z(e,i);switch(v.current){case t.VT.Wrapped:return z(e,i);case t.VT.Horizontal:case t.VT.Vertical:default:return B(e-1,i)}}),[]),V=o.useCallback((function(){return function(e,i){switch(i){case t.VT.Horizontal:return{position:"relative",height:"100%",width:"".concat(e.width,"px")};case t.VT.Vertical:default:return{position:"relative",height:"".concat(e.height,"px"),width:"100%"}}}(R,v.current)}),[R]),G=o.useCallback((function(e){return function(e,i,n){return n!==t.VT.Page?{}:{height:"".concat(i.height,"px"),width:"100%",position:"absolute",top:0,transform:"translateY(".concat(e.start.top,"px)")}}(e,S,v.current)}),[S]),H=o.useCallback((function(e){return function(e,i,n,r,a){var s,o,l,c,h,d,u,p=i?"right":"left",f=i?-1:1,m=n.length,g=e.start.left*f,v=e.size,y=v.height,b=v.width;if(r===t.nE.DualPageWithCover){var x=a===t.VT.Page?0:e.start.top;return 0===e.index||m%2==0&&e.index===m-1?((s={height:"".concat(y,"px"),minWidth:"".concat(ut(n,r),"px"),width:"100%"})[p]=0,s.position="absolute",s.top=0,s.transform="translate(".concat(g,"px, ").concat(x,"px)"),s):((o={height:"".concat(y,"px"),width:"".concat(b,"px")})[p]=0,o.position="absolute",o.top=0,o.transform="translate(".concat(g,"px, ").concat(x,"px)"),o)}if(r===t.nE.DualPage)return(l={height:"".concat(y,"px"),width:"".concat(b,"px")})[p]=0,l.position="absolute",l.top=0,l.transform="translate(".concat(g,"px, ").concat(a===t.VT.Page?0:e.start.top,"px)"),l;switch(a){case t.VT.Horizontal:return(c={height:"100%",width:"".concat(b,"px")})[p]=0,c.position="absolute",c.top=0,c.transform="translateX(".concat(g,"px)"),c;case t.VT.Page:return(h={height:"".concat(y,"px"),width:"".concat(b,"px")})[p]=0,h.position="absolute",h.top=0,h;case t.VT.Wrapped:return(d={height:"".concat(y,"px"),width:"".concat(b,"px")})[p]=0,d.position="absolute",d.top=0,d.transform="translate(".concat(g,"px, ").concat(e.start.top,"px)"),d;case t.VT.Vertical:default:return(u={height:"".concat(y,"px"),width:"100%"})[p]=0,u.position="absolute",u.top=0,u.transform="translateY(".concat(e.start.top,"px)"),u}}(e,n,l,y.current,v.current)}),[n,l]),W=o.useCallback((function(e,i){var n=A.current,a=n.measurements,s=n.scrollOffset,o=a[dt(0,r-1,i)];if(o){var l=v.current===t.VT.Page?{left:o.start.left,top:o.start.top}:{left:s.left*e,top:s.top*e};return _(l,!1)}return Promise.resolve()}),[]);return o.useEffect((function(){return function(){T.disconnect()}}),[]),{boundingClientRect:S,isSmoothScrolling:p,startPage:I,endPage:k,maxVisbilityIndex:L,virtualItems:F,getContainerStyles:V,getItemContainerStyles:G,getItemStyles:H,scrollToItem:B,scrollToNextItem:U,scrollToPreviousItem:j,zoom:W}},_t=function(e,i,n,r,a,s){var o=n;switch(!0){case a===t.nE.DualPageWithCover&&s>=3:case a===t.nE.DualPage&&s>=3:o=2*n;break;default:o=n}switch(r){case t.dD.ActualSize:return 1;case t.dD.PageFit:return Math.min((e.clientWidth-17)/o,(e.clientHeight-16)/i);case t.dD.PageWidth:return(e.clientWidth-17)/o}},St=function(e){var t=[];return e.map((function(e){t=t.concat(e).concat(function(e){var t=[];return e.items&&e.items.length>0&&(t=t.concat(St(e.items))),t}(e))})),t},At={capture:!1,passive:!0},Et={height:0,width:0},Ct={height:0,width:0},Mt=function(e){var i=e.getCurrentPage,n=e.getCurrentScrollMode,r=e.jumpToPage,a=e.targetRef,s=o.useState(t.HG.Normal),l=s[0],c=s[1],h=function(){var e=o.useState(Et),t=e[0],i=e[1],n=O((function(){i({height:window.innerHeight,width:window.innerWidth})}),100);return g((function(){return window.addEventListener("resize",n,At),function(){window.removeEventListener("resize",n,At)}}),[]),t}(),d=o.useState(Ct),u=d[0],p=d[1],f=o.useRef(Ct),m=o.useRef(i()),v=o.useRef(Ct),y=o.useState(a.current),b=y[0],x=y[1],w=o.useRef();g((function(){a.current!==b&&x(a.current)}),[]),g((function(){if(b){var e=new ResizeObserver((function(e){e.forEach((function(e){var t=e.target.getBoundingClientRect(),i=t.height,n=t.width;p({height:i,width:n})}))}));return e.observe(b),function(){e.unobserve(b),e.disconnect()}}}),[b]);var _=o.useCallback((function(e){var i=R();return i&&i!==e?(c(t.HG.Normal),D(i)):Promise.resolve()}),[]),S=o.useCallback((function(e){e&&T()&&(x(e),_(e).then((function(){w.current=e,c(t.HG.Entering),function(e){M&&e[P.RequestFullScreen]()}(e)})))}),[]),A=o.useCallback((function(){R()&&(c(t.HG.Exitting),D(document))}),[]),E=o.useCallback((function(){b&&R()!==b&&c(t.HG.Exitting)}),[b]);return o.useEffect((function(){switch(l){case t.HG.Entering:w.current&&(w.current.style.backgroundColor="var(--rpv-core__full-screen-target-background-color)"),m.current=i(),f.current={height:window.innerHeight,width:window.innerWidth};break;case t.HG.Entered:n()===t.VT.Page?r(m.current).then((function(){c(t.HG.EnteredCompletely)})):c(t.HG.EnteredCompletely);break;case t.HG.Exitting:w.current&&(w.current.style.backgroundColor="",w.current=null),m.current=i();break;case t.HG.Exited:c(t.HG.Normal),n()===t.VT.Page&&r(m.current)}}),[l]),o.useEffect((function(){if(l!==t.HG.Normal)return l===t.HG.Entering&&h.height===u.height&&h.width===u.width&&h.height>0&&h.width>0&&(0===v.current.height||h.height==v.current.height)?(v.current={height:window.innerHeight,width:window.innerWidth},void c(t.HG.Entered)):void(l===t.HG.Exitting&&f.current.height===h.height&&f.current.width===h.width&&h.height>0&&h.width>0&&c(t.HG.Exited))}),[l,h,u]),o.useEffect((function(){var e;return e=E,M&&document.addEventListener(P.FullScreenChange,e),function(){!function(e){M&&document.removeEventListener(P.FullScreenChange,e)}(E)}}),[b]),{enterFullScreenMode:S,exitFullScreenMode:A,fullScreenMode:l}},Pt={buildPageStyles:function(){return{}},transformSize:function(e){return e.size}},Tt={left:0,top:0},Dt=function(e){var i=e.currentFile,n=e.defaultScale,r=e.doc,a=e.enableSmoothScroll,s=e.initialPage,l=e.initialRotation,c=e.initialScale,h=e.pageLayout,d=e.pageSizes,p=e.plugins,v=e.renderPage,y=e.scrollMode,b=e.setRenderRange,x=e.viewMode,w=e.viewerState,_=e.onDocumentLoad,S=e.onOpenFile,A=e.onPageChange,E=e.onRotate,C=e.onRotatePage,M=e.onZoom,P=r.numPages,T=r.loadingTask.docId,D=o.useContext(z).l10n,R=o.useContext(f),L=R.direction===t.z4.RightToLeft,F=o.useRef(),N=o.useRef(),U=o.useState(s),j=U[0],V=U[1],G=o.useRef(null),H=function(e){var t,i=e.getCurrentPage,n=(t=o.useRef([]),o.useEffect((function(){return function(){t.current=[]}}),[]),{push:function(e){var i=t.current;i.length+1>50&&i.shift(),i.push(e),t.current=i},map:function(e){return t.current.map((function(t){return e(t)}))},pop:function(){var e=t.current;if(0===e.length)return null;var i=e.pop();return t.current=e,i}}),r=function(e){var t=o.useRef([]);return o.useEffect((function(){return function(){t.current=[]}}),[]),{dequeue:function(){var e=t.current;if(0===e.length)return null;var i=e.shift();return t.current=e,i||null},enqueue:function(e){var i=t.current;i.length+1>50&&i.pop(),t.current=[e].concat(i)},map:function(e){return t.current.map((function(t){return e(t)}))}}}(),a=function(){var e=r.dequeue();return e&&n.push(e),e&&e.pageIndex===i()?a():e},s=function(){var e=n.pop();return e&&r.enqueue(e),e&&e.pageIndex===i()?s():e},l=o.useCallback((function(e){n.push(e)}),[]);return{getNextDestination:a,getPreviousDestination:s,markVisitedDestination:l}}({getCurrentPage:function(){return ye.current.pageIndex}}),W=o.useState(l),q=W[0],X=W[1],Y=k(q),Q=o.useState(!1),K=Q[0],Z=Q[1],J=o.useState(new Map),$=J[0],ee=J[1],te=o.useState(y),ie=te[0],ne=te[1],re=k(ie),ae=o.useState(x),se=ae[0],oe=ae[1],le=k(se),he=function(e){var t=I(),i=o.useState([]),n=i[0],r=i[1];return o.useEffect((function(){e.getOutline().then((function(e){if(t.current&&null!==e){var i=St(e);r(i)}}))}),[]),n}(r),pe=o.useState(c),fe=pe[0],ge=pe[1],ve=k(fe),ye=o.useRef(w),be=o.useRef("string"==typeof n?n:null),xe=o.useRef(-1),we=o.useRef(-1),_e=o.useRef(s),Se=Mt({getCurrentPage:function(){return ye.current.pageIndex},getCurrentScrollMode:function(){return ye.current.scrollMode},jumpToPage:function(e){return He(e)},targetRef:N}),Ae=o.useState(-1),Ee=Ae[0],Ce=Ae[1],Me=o.useState(0),Pe=Me[0],Te=Me[1],De=B({doc:r});o.useEffect((function(){return function(){de.clear(),ue.clear()}}),[T]);var Re=o.useMemo((function(){return Object.assign({},Pt,h)}),[]),Oe=o.useMemo((function(){return Array(P).fill(0).map((function(e,t){var i=[d[t].pageHeight,d[t].pageWidth],n=Math.abs(q)%180==0?{height:i[0],width:i[1]}:{height:i[1],width:i[0]},r={height:n.height*fe,width:n.width*fe};return Re.transformSize({numPages:P,pageIndex:t,size:r})}))}),[q,fe]),Ie=wt({enableSmoothScroll:a,isRtl:L,numberOfItems:P,parentRef:N,scrollMode:ie,setRenderRange:b,sizes:Oe,viewMode:se}),ke=O((function(){!be.current||ye.current.fullScreenMode!==t.HG.Normal||s>0&&_e.current===s||Ze(be.current)}),200);!function(e){var t=e.targetRef,i=e.onResize;g((function(){var e=new ResizeObserver((function(e){e.forEach((function(e){i(e.target)}))})),n=t.current;if(n)return e.observe(n),function(){e.unobserve(n)}}),[])}({targetRef:N,onResize:ke});var Le=function(e){var t=e;p.forEach((function(e){e.onViewerStateChange&&(t=e.onViewerStateChange(t))})),ye.current=t},Fe=function(){return N.current},Be=function(){return ye.current},Ne=o.useCallback((function(e){H.markVisitedDestination(e)}),[]),ze=o.useCallback((function(e){var i=e.pageIndex,n=e.bottomOffset,a=e.leftOffset,s=e.scaleTo,o=N.current,l=ye.current;return o&&l?new Promise((function(e,c){me(r,i).then((function(r){var c=r.getViewport({scale:1}),h=0,u=("function"==typeof n?n(c.width,c.height):n)||0,p=("function"==typeof a?a(c.width,c.height):a)||0,f=l.scale;switch(s){case t.dD.PageFit:h=0,p=0,Ze(t.dD.PageFit);break;case t.dD.PageWidth:f=_t(o,d[i].pageHeight,d[i].pageWidth,t.dD.PageWidth,x,P),h=(c.height-u)*f,p*=f,Ze(f);break;default:h=(c.height-u)*f,p*=f}switch(l.scrollMode){case t.VT.Horizontal:Ie.scrollToItem(i,{left:p,top:0}).then((function(){e()}));break;case t.VT.Vertical:default:Ie.scrollToItem(i,{left:0,top:h}).then((function(){e()}))}}))})):Promise.resolve()}),[]),Ue=o.useCallback((function(e){return H.markVisitedDestination(e),ze(e)}),[]),je=o.useCallback((function(){var e=H.getNextDestination();return e?ze(e):Promise.resolve()}),[]),Ve=o.useCallback((function(){var e=H.getPreviousDestination();return e?ze(e):Promise.resolve()}),[]),Ge=o.useCallback((function(){return Ie.scrollToNextItem(ye.current.pageIndex,Tt)}),[]),He=o.useCallback((function(e){return 0<=e&&e<P?Ie.scrollToItem(e,Tt):Promise.resolve()}),[]),We=o.useCallback((function(){return Ie.scrollToPreviousItem(ye.current.pageIndex,Tt)}),[]),qe=o.useCallback((function(e){var t,i;"pdf"===(t=e.name,i=t.split(/\./).pop(),i?i.toLowerCase():"").toLowerCase()&&new Promise((function(t){var i=new FileReader;i.readAsArrayBuffer(e),i.onload=function(){var e=new Uint8Array(i.result);t(e)}})).then((function(t){S(e.name,t)}))}),[S]),Xe=o.useCallback((function(e){var i=e===t.pT.Backward?-90:90,n=ye.current.rotation,a=360===n||-360===n?i:n+i;De.markNotRendered(),X(a),Le(u(u({},ye.current),{rotation:a})),E({direction:e,doc:r,rotation:a})}),[]),Ye=o.useCallback((function(e,i){var n=i===t.pT.Backward?-90:90,a=ye.current.pagesRotation,s=(a.has(e)?a.get(e):l)+n,o=a.set(e,s);ee(o),Z((function(e){return!e})),Le(u(u({},ye.current),{pagesRotation:o,rotatedPage:e})),C({direction:i,doc:r,pageIndex:e,rotation:s}),De.markRendering(e),Ce(e)}),[]),Qe=o.useCallback((function(e){Le(u(u({},ye.current),{scrollMode:e})),ne(e)}),[]),Ke=o.useCallback((function(e){Le(u(u({},ye.current),{viewMode:e})),oe(e)}),[]),Ze=o.useCallback((function(e){var t=N.current,i=ye.current.pageIndex;if(!(i<0||i>=P)){var n=d[i].pageHeight,a=d[i].pageWidth,s=t?"string"==typeof e?_t(t,n,a,e,ye.current.viewMode,P):e:1;be.current="string"==typeof e?e:null,s!==ye.current.scale&&(Te((function(e){return e+1})),De.markNotRendered(),ge(s),M({doc:r,scale:s}),Le(u(u({},ye.current),{scale:s})))}}),[]),Je=o.useCallback((function(e){Se.enterFullScreenMode(e)}),[]),$e=o.useCallback((function(){Se.exitFullScreenMode()}),[]);o.useEffect((function(){Le(u(u({},ye.current),{fullScreenMode:Se.fullScreenMode}))}),[Se.fullScreenMode]),o.useEffect((function(){var e={enterFullScreenMode:Je,exitFullScreenMode:$e,getPagesContainer:Fe,getViewerState:Be,jumpToDestination:Ue,jumpToNextDestination:je,jumpToPreviousDestination:Ve,jumpToNextPage:Ge,jumpToPreviousPage:We,jumpToPage:He,openFile:qe,rotate:Xe,rotatePage:Ye,setViewerState:Le,switchScrollMode:Qe,switchViewMode:Ke,zoom:Ze};return p.forEach((function(t){t.install&&t.install(e)})),function(){p.forEach((function(t){t.uninstall&&t.uninstall(e)}))}}),[T]),o.useEffect((function(){_({doc:r,file:i}),p.forEach((function(e){e.onDocumentLoad&&e.onDocumentLoad({doc:r,file:i})}))}),[T]);var et,tt,it,nt=Ie.boundingClientRect;et=function(){s&&He(s)},tt=nt.height>0&&nt.width>0,it=o.useRef(!1),g((function(){tt&&!it.current&&(it.current=!0,et())}),[et,tt]),g((function(){var e=ye.current.pageIndex;e>-1&&re!==ie&&Ie.scrollToItem(e,Tt).then((function(){Se.fullScreenMode===t.HG.EnteredCompletely&&(a||De.markNotRendered(),xe.current=-1)}))}),[ie]),g((function(){var e=ye.current.pageIndex;e>-1&&Y!==q&&Ie.scrollToItem(e,Tt)}),[q]),g((function(){0!=ve&&ve!=ye.current.scale&&Ie.zoom(ye.current.scale/ve,ye.current.pageIndex).then((function(){Se.fullScreenMode===t.HG.EnteredCompletely&&(we.current=-1)}))}),[fe]),g((function(){if(le!==ye.current.viewMode){var e=Ie.startPage,t=Ie.endPage,i=Ie.virtualItems;De.markNotRendered(),De.setRange(e,t);for(var n=function(e){var t=i.find((function(t){return t.index===e}));t&&De.setVisibility(e,t.visibility)},r=e;r<=t;r++)n(r);st()}}),[se]),g((function(){var e=ye.current.pageIndex;e>-1&&le!==se&&Ie.scrollToItem(e,Tt)}),[se]),g((function(){var e=ye.current.pageIndex;e>0&&e===s&&_e.current===s&&be.current&&(_e.current=-1,Ze(be.current))}),[j]),o.useEffect((function(){Ie.isSmoothScrolling||null!==G.current&&G.current===j||(G.current=j,A({currentPage:j,doc:r}))}),[j,Ie.isSmoothScrolling]),o.useEffect((function(){Se.fullScreenMode===t.HG.Entering&&ye.current.scrollMode===t.VT.Page&&(xe.current=ye.current.pageIndex),Se.fullScreenMode===t.HG.EnteredCompletely&&ye.current.scrollMode===t.VT.Page&&a&&(xe.current=-1),Se.fullScreenMode===t.HG.EnteredCompletely&&be.current&&(we.current=ye.current.pageIndex,Ze(be.current))}),[Se.fullScreenMode]),o.useEffect((function(){if(Se.fullScreenMode!==t.HG.Entering&&Se.fullScreenMode!==t.HG.Exitting&&!Ie.isSmoothScrolling){var e=Ie.startPage,i=Ie.endPage,n=Ie.maxVisbilityIndex,r=Ie.virtualItems,a=n,s=Se.fullScreenMode===t.HG.Entered||Se.fullScreenMode===t.HG.EnteredCompletely;if(!(s&&a!==xe.current&&xe.current>-1||s&&a!==we.current&&we.current>-1)){V(a),Le(u(u({},ye.current),{pageIndex:a})),De.setRange(e,i);for(var o=function(e){var t=r.find((function(t){return t.index===e}));t&&De.setVisibility(e,t.visibility)},l=e;l<=i;l++)o(l);st()}}}),[Ie.startPage,Ie.endPage,Ie.isSmoothScrolling,Ie.maxVisbilityIndex,Se.fullScreenMode,K,q,fe]);var rt=o.useCallback((function(e){De.markRendered(e),st()}),[Pe]),st=function(){var e=De.getHighestPriorityPage();e>-1&&De.isInRange(e)&&(De.markRendering(e),Ce(e))},ot=function(e){var t=j-1,i=j+1;switch(e){case"FirstPage":He(0);break;case"LastPage":He(P-1);break;case"NextPage":i<P&&He(i);break;case"PrevPage":t>=0&&He(t)}},lt=o.useCallback((function(){var e=Ie.virtualItems,i=[];switch(se){case t.nE.DualPage:i=ce(e,2);break;case t.nE.DualPageWithCover:e.length&&(i=0===e[0].index?[[e[0]]].concat(ce(e.slice(1),2)):ce(e,2));break;case t.nE.SinglePage:default:i=ce(e,1)}var n=D&&D.core?D.core.pageLabel:"Page {{pageIndex}}",a={attrs:{className:"rpv-core__inner-container","data-testid":"core__inner-container",ref:F,style:{height:"100%"}},children:o.createElement(o.Fragment,null),subSlot:{attrs:{"data-testid":"core__inner-pages",className:m({"rpv-core__inner-pages":!0,"rpv-core__inner-pages--horizontal":ie===t.VT.Horizontal,"rpv-core__inner-pages--rtl":L,"rpv-core__inner-pages--single":ie===t.VT.Page,"rpv-core__inner-pages--vertical":ie===t.VT.Vertical,"rpv-core__inner-pages--wrapped":ie===t.VT.Wrapped}),ref:N,style:{height:"100%",position:"relative"}},children:o.createElement("div",{"data-testid":"core__inner-current-page-".concat(j),style:Object.assign({"--scale-factor":fe},Ie.getContainerStyles())},i.map((function(e){return o.createElement("div",{className:m({"rpv-core__inner-page-container":!0,"rpv-core__inner-page-container--single":ie===t.VT.Page}),style:Ie.getItemContainerStyles(e[0]),key:"".concat(e[0].index,"-").concat(se)},e.map((function(e){var i=se===t.nE.DualPageWithCover&&(0===e.index||P%2==0&&e.index===P-1);return o.createElement("div",{"aria-label":n.replace("{{pageIndex}}","".concat(e.index+1)),className:m({"rpv-core__inner-page":!0,"rpv-core__inner-page--dual-even":se===t.nE.DualPage&&e.index%2==0,"rpv-core__inner-page--dual-odd":se===t.nE.DualPage&&e.index%2==1,"rpv-core__inner-page--dual-cover":i,"rpv-core__inner-page--dual-cover-even":se===t.nE.DualPageWithCover&&!i&&e.index%2==0,"rpv-core__inner-page--dual-cover-odd":se===t.nE.DualPageWithCover&&!i&&e.index%2==1,"rpv-core__inner-page--single":se===t.nE.SinglePage&&ie===t.VT.Page}),role:"region",key:"".concat(e.index,"-").concat(se),style:Object.assign({},Ie.getItemStyles(e),Re.buildPageStyles({numPages:P,pageIndex:e.index,scrollMode:ie,viewMode:se}))},o.createElement(at,{doc:r,measureRef:e.measureRef,outlines:he,pageIndex:e.index,pageRotation:$.has(e.index)?$.get(e.index):0,pageSize:d[e.index],plugins:p,renderPage:v,renderQueueKey:Pe,rotation:q,scale:fe,shouldRender:Ee===e.index,viewMode:se,onExecuteNamedAction:ot,onJumpFromLinkAnnotation:Ne,onJumpToDest:Ue,onRenderCompleted:rt,onRotatePage:Ye}))})))})))}};return p.forEach((function(e){e.renderViewer&&(a=e.renderViewer({containerRef:F,doc:r,pagesContainerRef:N,pagesRotation:$,pageSizes:d,rotation:q,slot:a,themeContext:R,jumpToPage:He,openFile:qe,rotate:Xe,rotatePage:Ye,switchScrollMode:Qe,switchViewMode:Ke,zoom:Ze}))})),a}),[p,Ie]),ct=o.useCallback((function(e){return o.createElement("div",u({},e.attrs,{style:e.attrs&&e.attrs.style?e.attrs.style:{}}),e.children,e.subSlot&&ct(e.subSlot))}),[]);return ct(lt())},Rt=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.3,1.5,1.7,1.9,2.1,2.4,2.7,3,3.3,3.7,4.1,4.6,5.1,5.7,6.3,7,7.7,8.5,9.4,10],Ot=function(e){var i=e.defaultScale,n=e.doc,r=e.render,a=e.scrollMode,s=e.viewMode,l=o.useRef(),c=o.useState({pageSizes:[],scale:0}),h=c[0],d=c[1];return o.useLayoutEffect((function(){var e=Array(n.numPages).fill(0).map((function(e,t){return new Promise((function(e,i){me(n,t).then((function(t){var i=t.getViewport({scale:1});e({pageHeight:i.height,pageWidth:i.width,rotation:i.rotation})}))}))}));Promise.all(e).then((function(e){var r=l.current;if(r&&0!==e.length){var o=e[0].pageWidth,c=e[0].pageHeight,h=r.parentElement,u=(h.clientWidth-45)/o,p=(h.clientHeight-45)/c,f=u;switch(a){case t.VT.Horizontal:f=Math.min(u,p);break;case t.VT.Vertical:default:f=u}var m,g,v=i?"string"==typeof i?_t(h,c,o,i,s,n.numPages):i:(m=f,-1===(g=Rt.findIndex((function(e){return e>=m})))||0===g?m:Rt[g-1]);d({pageSizes:e,scale:v})}}))}),[n.loadingTask.docId]),0===h.pageSizes.length||0===h.scale?o.createElement("div",{className:"rpv-core__page-size-calculator","data-testid":"core__page-size-calculating",ref:l},o.createElement(w,null)):r(h.pageSizes,h.scale)},It=function(){},kt=function(e){function t(t,i){var n=e.call(this)||this;return n.verifyPassword=t,n.passwordStatus=i,n}return h(t,e),t}(It),Lt=function(e){var i=e.passwordStatus,n=e.renderProtectedView,r=e.verifyPassword,a=e.onDocumentAskPassword,s=o.useContext(z).l10n,l=o.useState(""),c=l[0],h=l[1],d=o.useContext(f).direction===t.z4.RightToLeft,u=function(){return r(c)};return o.useEffect((function(){a&&a({verifyPassword:r})}),[]),n?n({passwordStatus:i,verifyPassword:r}):o.createElement("div",{className:"rpv-core__asking-password-wrapper"},o.createElement("div",{className:m({"rpv-core__asking-password":!0,"rpv-core__asking-password--rtl":d})},o.createElement("div",{className:"rpv-core__asking-password-message"},i===t.a9.RequiredPassword&&s.core.askingPassword.requirePasswordToOpen,i===t.a9.WrongPassword&&s.core.wrongPassword.tryAgain),o.createElement("div",{className:"rpv-core__asking-password-body"},o.createElement("div",{className:m({"rpv-core__asking-password-input":!0,"rpv-core__asking-password-input--ltr":!d,"rpv-core__asking-password-input--rtl":d})},o.createElement(_,{testId:"core__asking-password-input",type:"password",value:c,onChange:h,onKeyDown:function(e){"Enter"===e.key&&u()}})),o.createElement(x,{onClick:u},s.core.askingPassword.submit))))},Ft=function(e){function t(t){var i=e.call(this)||this;return i.doc=t,i}return h(t,e),t}(It),Bt=function(e){function t(t){var i=e.call(this)||this;return i.error=t,i}return h(t,e),t}(It),Nt=function(e){function t(t){var i=e.call(this)||this;return i.percentages=t,i}return h(t,e),t}(It),zt=function(e){var i=e.characterMap,n=e.file,r=e.httpHeaders,a=e.render,s=e.renderError,c=e.renderLoader,h=e.renderProtectedView,d=e.transformGetDocumentParams,u=e.withCredentials,p=e.onDocumentAskPassword,g=o.useContext(f).direction===t.z4.RightToLeft,v=o.useState(new Nt(0)),y=v[0],b=v[1],x=o.useRef(""),_=I();return o.useEffect((function(){x.current="",b(new Nt(0));var e=new l.PDFWorker({name:"PDFWorker_".concat(Date.now())}),a=Object.assign({httpHeaders:r,withCredentials:u,worker:e},"string"==typeof n?{url:n}:{data:n},i?{cMapUrl:i.url,cMapPacked:i.isCompressed}:{}),s=d?d(a):a,o=l.getDocument(s);return o.onPassword=function(e,i){switch(i){case l.PasswordResponses.NEED_PASSWORD:_.current&&b(new kt(e,t.a9.RequiredPassword));break;case l.PasswordResponses.INCORRECT_PASSWORD:_.current&&b(new kt(e,t.a9.WrongPassword))}},o.onProgress=function(e){var t=e.total>0?Math.min(100,100*e.loaded/e.total):100;_.current&&""===x.current&&b(new Nt(t))},o.promise.then((function(e){x.current=e.loadingTask.docId,_.current&&b(new Ft(e))}),(function(t){return _.current&&!e.destroyed&&b(new Bt({message:t.message||"Cannot load document",name:t.name}))})),function(){o.destroy(),e.destroy()}}),[n]),y instanceof kt?o.createElement(Lt,{passwordStatus:y.passwordStatus,renderProtectedView:h,verifyPassword:y.verifyPassword,onDocumentAskPassword:p}):y instanceof Ft?a(y.doc):y instanceof Bt?s?s(y.error):o.createElement("div",{className:m({"rpv-core__doc-error":!0,"rpv-core__doc-error--rtl":g})},o.createElement("div",{className:"rpv-core__doc-error-text"},y.error.message)):o.createElement("div",{"data-testid":"core__doc-loading",className:m({"rpv-core__doc-loading":!0,"rpv-core__doc-loading--rtl":g})},c?c(y.percentages):o.createElement(w,null))},Ut=function(e){return{startPage:e.startPage-3,endPage:e.endPage+3}};t.Viewer=function(e){var i=e.characterMap,n=e.defaultScale,r=e.enableSmoothScroll,a=void 0===r||r,s=e.fileUrl,l=e.httpHeaders,c=void 0===l?{}:l,h=e.initialPage,d=void 0===h?0:h,u=e.pageLayout,p=e.initialRotation,m=void 0===p?0:p,g=e.localization,y=e.plugins,b=void 0===y?[]:y,x=e.renderError,w=e.renderLoader,_=e.renderPage,S=e.renderProtectedView,A=e.scrollMode,E=void 0===A?t.VT.Vertical:A,C=e.setRenderRange,M=void 0===C?Ut:C,P=e.transformGetDocumentParams,T=e.theme,D=void 0===T?{direction:t.z4.LeftToRight,theme:"light"}:T,R=e.viewMode,O=void 0===R?t.nE.SinglePage:R,I=e.withCredentials,L=void 0!==I&&I,F=e.onDocumentAskPassword,B=e.onDocumentLoad,U=void 0===B?function(){}:B,j=e.onPageChange,V=void 0===j?function(){}:j,G=e.onRotate,H=void 0===G?function(){}:G,W=e.onRotatePage,q=void 0===W?function(){}:W,X=e.onSwitchTheme,Y=void 0===X?function(){}:X,Q=e.onZoom,K=void 0===Q?function(){}:Q,Z=o.useState({data:s,name:"string"==typeof s?s:"",shouldLoad:!1}),J=Z[0],$=Z[1],ee=function(e,t){$({data:t,name:e,shouldLoad:!0})},te=o.useState(!1),ie=te[0],ne=te[1],re=k(J);o.useEffect((function(){var e,t,i,n;e=re.data,n=typeof(t=s),"string"===(i=typeof e)&&"string"===n&&e===t||"object"===i&&"object"===n&&e.length===t.length&&e.every((function(e,i){return e===t[i]}))||$({data:s,name:"string"==typeof s?s:"",shouldLoad:ie})}),[s,ie]);var ae=v({onVisibilityChanged:function(e){ne(e.isVisible),e.isVisible&&$((function(e){return Object.assign({},e,{shouldLoad:!0})}))}}),se="string"==typeof D?{direction:t.z4.LeftToRight,theme:D}:D,oe=o.useState(g||N),le=oe[0],ce=oe[1],he={l10n:le,setL10n:ce},de=Object.assign({},{direction:se.direction},function(e,t){var i=o.useMemo((function(){return"auto"===e?"undefined"!=typeof window&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e}),[]),n=o.useState(i),r=n[0],a=n[1],s=k(r);return o.useEffect((function(){if("auto"===e){var t=window.matchMedia("(prefers-color-scheme: dark)"),i=function(e){a(e.matches?"dark":"light")};return t.addEventListener("change",i),function(){return t.removeEventListener("change",i)}}}),[]),o.useEffect((function(){r!==s&&t&&t(r)}),[r]),o.useEffect((function(){e!==r&&a(e)}),[e]),{currentTheme:r,setCurrentTheme:a}}(se.theme||"light",Y));return o.useEffect((function(){g&&ce(g)}),[g]),o.createElement(z.Provider,{value:he},o.createElement(f.Provider,{value:de},o.createElement("div",{ref:ae,className:"rpv-core__viewer rpv-core__viewer--".concat(de.currentTheme),"data-testid":"core__viewer",style:{height:"100%",width:"100%"}},J.shouldLoad&&o.createElement(zt,{characterMap:i,file:J.data,httpHeaders:c,render:function(e){return o.createElement(Ot,{defaultScale:n,doc:e,render:function(i,r){return o.createElement(Dt,{currentFile:{data:J.data,name:J.name},defaultScale:n,doc:e,enableSmoothScroll:a,initialPage:d,initialRotation:m,initialScale:r,pageLayout:u,pageSizes:i,plugins:b,renderPage:_,scrollMode:E,setRenderRange:M,viewMode:O,viewerState:{file:J,fullScreenMode:t.HG.Normal,pageIndex:-1,pageHeight:i[0].pageHeight,pageWidth:i[0].pageWidth,pagesRotation:new Map,rotation:m,scale:r,scrollMode:E,viewMode:O},onDocumentLoad:U,onOpenFile:ee,onPageChange:V,onRotate:H,onRotatePage:q,onZoom:K})},scrollMode:E,viewMode:O})},renderError:x,renderLoader:w,renderProtectedView:S,transformGetDocumentParams:P,withCredentials:L,onDocumentAskPassword:F}))))},t.Worker=function(e){var t=e.children,i=e.workerUrl;return l.GlobalWorkerOptions.workerSrc=i,o.createElement(o.Fragment,null,t)}},3237:(e,t,i)=>{"use strict";e.exports=i(4839)},2740:e=>{"use strict";e.exports=function(e,t,i,n,r,a,s,o){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[i,n,r,a,s,o],h=0;(l=new Error(t.replace(/%s/g,(function(){return c[h++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}}},6749:(module,__unused_webpack_exports,__webpack_require__)=>{var _defineProperty=__webpack_require__(3693).default,_classPrivateMethodInitSpec=__webpack_require__(3312).default,_assertClassBrand=__webpack_require__(1756).default,_classPrivateFieldInitSpec=__webpack_require__(2459).default,_classPrivateFieldSet=__webpack_require__(7088).default,_classPrivateFieldGet=__webpack_require__(6668).default,factory;globalThis,factory=()=>(()=>{"use strict";var __webpack_modules__=[,(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerbosityLevel=t.Util=t.UnknownErrorException=t.UnexpectedResponseException=t.UNSUPPORTED_FEATURES=t.TextRenderingMode=t.RenderingIntentFlag=t.PermissionFlag=t.PasswordResponses=t.PasswordException=t.PageActionEventType=t.OPS=t.MissingPDFException=t.LINE_FACTOR=t.LINE_DESCENT_FACTOR=t.InvalidPDFException=t.ImageKind=t.IDENTITY_MATRIX=t.FormatError=t.FeatureTest=t.FONT_IDENTITY_MATRIX=t.DocumentActionEventType=t.CMapCompressionType=t.BaseException=t.BASELINE_FACTOR=t.AnnotationType=t.AnnotationStateModelType=t.AnnotationReviewState=t.AnnotationReplyType=t.AnnotationMode=t.AnnotationMarkedState=t.AnnotationFlag=t.AnnotationFieldFlag=t.AnnotationEditorType=t.AnnotationEditorPrefix=t.AnnotationEditorParamsType=t.AnnotationBorderStyleType=t.AnnotationActionEventType=t.AbortException=void 0,t.assert=function(e,t){e||s(t)},t.bytesToString=function(e){"object"===typeof e&&null!==e&&void 0!==e.length||s("Invalid argument for bytesToString");const t=e.length,i=8192;if(t<i)return String.fromCharCode.apply(null,e);const n=[];for(let r=0;r<t;r+=i){const a=Math.min(r+i,t),s=e.subarray(r,a);n.push(String.fromCharCode.apply(null,s))}return n.join("")},t.createPromiseCapability=function(){const e=Object.create(null);let t=!1;return Object.defineProperty(e,"settled",{get:()=>t}),e.promise=new Promise((function(i,n){e.resolve=function(e){t=!0,i(e)},e.reject=function(e){t=!0,n(e)}})),e},t.createValidAbsoluteUrl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e)return null;try{if(i&&"string"===typeof e){if(i.addDefaultProtocol&&e.startsWith("www.")){const t=e.match(/\./g);t&&t.length>=2&&(e="http://".concat(e))}if(i.tryConvertEncoding)try{e=p(e)}catch(n){}}const r=t?new URL(e,t):new URL(e);if(function(e){if(!e)return!1;switch(e.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(r))return r}catch(n){}return null},t.getModificationDate=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date;return[e.getUTCFullYear().toString(),(e.getUTCMonth()+1).toString().padStart(2,"0"),e.getUTCDate().toString().padStart(2,"0"),e.getUTCHours().toString().padStart(2,"0"),e.getUTCMinutes().toString().padStart(2,"0"),e.getUTCSeconds().toString().padStart(2,"0")].join("")},t.getVerbosityLevel=function(){return r},t.info=function(e){r>=n.INFOS&&console.log("Info: ".concat(e))},t.isArrayBuffer=function(e){return"object"===typeof e&&null!==e&&void 0!==e.byteLength},t.isArrayEqual=function(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0},t.objectFromMap=function(e){const t=Object.create(null);for(const[i,n]of e)t[i]=n;return t},t.objectSize=function(e){return Object.keys(e).length},t.setVerbosityLevel=function(e){Number.isInteger(e)&&(r=e)},t.shadow=o,t.string32=function(e){return String.fromCharCode(e>>24&255,e>>16&255,e>>8&255,255&e)},t.stringToBytes=c,t.stringToPDFString=function(e){if(e[0]>="\xef"){let t;if("\xfe"===e[0]&&"\xff"===e[1]?t="utf-16be":"\xff"===e[0]&&"\xfe"===e[1]?t="utf-16le":"\xef"===e[0]&&"\xbb"===e[1]&&"\xbf"===e[2]&&(t="utf-8"),t)try{const i=new TextDecoder(t,{fatal:!0}),n=c(e);return i.decode(n)}catch(i){a('stringToPDFString: "'.concat(i,'".'))}}const t=[];for(let n=0,r=e.length;n<r;n++){const i=u[e.charCodeAt(n)];t.push(i?String.fromCharCode(i):e.charAt(n))}return t.join("")},t.stringToUTF8String=p,t.unreachable=s,t.utf8StringToString=function(e){return unescape(encodeURIComponent(e))},t.warn=a,t.IDENTITY_MATRIX=[1,0,0,1,0,0],t.FONT_IDENTITY_MATRIX=[.001,0,0,.001,0,0],t.LINE_FACTOR=1.35,t.LINE_DESCENT_FACTOR=.35;const i=.35/1.35;t.BASELINE_FACTOR=i,t.RenderingIntentFlag={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},t.AnnotationMode={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},t.AnnotationEditorPrefix="pdfjs_internal_editor_",t.AnnotationEditorType={DISABLE:-1,NONE:0,FREETEXT:3,INK:15},t.AnnotationEditorParamsType={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13},t.PermissionFlag={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},t.TextRenderingMode={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},t.ImageKind={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},t.AnnotationType={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},t.AnnotationStateModelType={MARKED:"Marked",REVIEW:"Review"},t.AnnotationMarkedState={MARKED:"Marked",UNMARKED:"Unmarked"},t.AnnotationReviewState={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"},t.AnnotationReplyType={GROUP:"Group",REPLY:"R"},t.AnnotationFlag={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512},t.AnnotationFieldFlag={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864},t.AnnotationBorderStyleType={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},t.AnnotationActionEventType={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"},t.DocumentActionEventType={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"},t.PageActionEventType={O:"PageOpen",C:"PageClose"};const n={ERRORS:0,WARNINGS:1,INFOS:5};t.VerbosityLevel=n,t.CMapCompressionType={NONE:0,BINARY:1},t.OPS={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},t.UNSUPPORTED_FEATURES={forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"},t.PasswordResponses={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let r=n.WARNINGS;function a(e){r>=n.WARNINGS&&console.log("Warning: ".concat(e))}function s(e){throw new Error(e)}function o(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(e,t,{value:i,enumerable:!n,configurable:!0,writable:!1}),i}const l=function(){function e(t,i){this.constructor===e&&s("Cannot initialize BaseException."),this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e}();function c(e){"string"!==typeof e&&s("Invalid argument for stringToBytes");const t=e.length,i=new Uint8Array(t);for(let n=0;n<t;++n)i[n]=255&e.charCodeAt(n);return i}t.BaseException=l,t.PasswordException=class extends l{constructor(e,t){super(e,"PasswordException"),this.code=t}},t.UnknownErrorException=class extends l{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}},t.InvalidPDFException=class extends l{constructor(e){super(e,"InvalidPDFException")}},t.MissingPDFException=class extends l{constructor(e){super(e,"MissingPDFException")}},t.UnexpectedResponseException=class extends l{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}},t.FormatError=class extends l{constructor(e){super(e,"FormatError")}},t.AbortException=class extends l{constructor(e){super(e,"AbortException")}},t.FeatureTest=class{static get isLittleEndian(){return o(this,"isLittleEndian",function(){const e=new Uint8Array(4);return e[0]=1,1===new Uint32Array(e.buffer,0,1)[0]}())}static get isEvalSupported(){return o(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(e){return!1}}())}static get isOffscreenCanvasSupported(){return o(this,"isOffscreenCanvasSupported","undefined"!==typeof OffscreenCanvas)}static get platform(){return"undefined"===typeof navigator?o(this,"platform",{isWin:!1,isMac:!1}):o(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}};const h=[...Array(256).keys()].map((e=>e.toString(16).padStart(2,"0")));class d{static makeHexColor(e,t,i){return"#".concat(h[e]).concat(h[t]).concat(h[i])}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[1],t[1]=i),t[0]*=e[0],t[1]*=e[0],e[3]<0&&(i=t[2],t[2]=t[3],t[3]=i),t[2]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[2],t[2]=i,i=t[1],t[1]=t[3],t[3]=i,e[1]<0&&(i=t[2],t[2]=t[3],t[3]=i),t[2]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[1],t[1]=i),t[0]*=e[2],t[1]*=e[2]),t[0]+=e[4],t[1]+=e[4],t[2]+=e[5],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){return[e[0]*t[0]+e[1]*t[2]+t[4],e[0]*t[1]+e[1]*t[3]+t[5]]}static applyInverseTransform(e,t){const i=t[0]*t[3]-t[1]*t[2];return[(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/i,(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/i]}static getAxialAlignedBoundingBox(e,t){const i=d.applyTransform(e,t),n=d.applyTransform(e.slice(2,4),t),r=d.applyTransform([e[0],e[3]],t),a=d.applyTransform([e[2],e[1]],t);return[Math.min(i[0],n[0],r[0],a[0]),Math.min(i[1],n[1],r[1],a[1]),Math.max(i[0],n[0],r[0],a[0]),Math.max(i[1],n[1],r[1],a[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],i=e[0]*t[0]+e[1]*t[2],n=e[0]*t[1]+e[1]*t[3],r=e[2]*t[0]+e[3]*t[2],a=e[2]*t[1]+e[3]*t[3],s=(i+a)/2,o=Math.sqrt((i+a)**2-4*(i*a-r*n))/2,l=s+o||1,c=s-o||1;return[Math.sqrt(l),Math.sqrt(c)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),n=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>n)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>a?null:[i,r,n,a]}static bezierBoundingBox(e,t,i,n,r,a,s,o){const l=[],c=[[],[]];let h,d,u,p,f,m,g,v;for(let w=0;w<2;++w)if(0===w?(d=6*e-12*i+6*r,h=-3*e+9*i-9*r+3*s,u=3*i-3*e):(d=6*t-12*n+6*a,h=-3*t+9*n-9*a+3*o,u=3*n-3*t),Math.abs(h)<1e-12){if(Math.abs(d)<1e-12)continue;p=-u/d,0<p&&p<1&&l.push(p)}else g=d*d-4*u*h,v=Math.sqrt(g),g<0||(f=(-d+v)/(2*h),0<f&&f<1&&l.push(f),m=(-d-v)/(2*h),0<m&&m<1&&l.push(m));let y,b=l.length;const x=b;for(;b--;)p=l[b],y=1-p,c[0][b]=y*y*y*e+3*y*y*p*i+3*y*p*p*r+p*p*p*s,c[1][b]=y*y*y*t+3*y*y*p*n+3*y*p*p*a+p*p*p*o;return c[0][x]=e,c[1][x]=t,c[0][x+1]=s,c[1][x+1]=o,c[0].length=c[1].length=x+2,[Math.min(...c[0]),Math.min(...c[1]),Math.max(...c[0]),Math.max(...c[1])]}}t.Util=d;const u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function p(e){return decodeURIComponent(escape(e))}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory,createPDFNetworkStream;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:e,NodeCMapReaderFactory:t,NodeStandardFontDataFactory:i}=__w_pdfjs_require__(20);exports.DefaultCanvasFactory=DefaultCanvasFactory=e,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=t,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=i}if(_is_node.isNodeJS){const{PDFNodeStream:e}=__w_pdfjs_require__(21);createPDFNetworkStream=t=>new e(t)}else{const{PDFNetworkStream:e}=__w_pdfjs_require__(24),{PDFFetchStream:t}=__w_pdfjs_require__(25);createPDFNetworkStream=i=>(0,_display_utils.isValidFetchUrl)(i.url)?new t(i):new e(i)}function getDocument(e){var t,i;if("string"===typeof e||e instanceof URL)e={url:e};else if((0,_util.isArrayBuffer)(e))e={data:e};else if(e instanceof PDFDataRangeTransport)(0,_display_utils.deprecated)("`PDFDataRangeTransport`-instance, please use a parameter object with `range`-property instead."),e={range:e};else if("object"!==typeof e)throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!e.url&&!e.data&&!e.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const n=new PDFDocumentLoadingTask,r=e.url?getUrlProp(e.url):null,a=e.data?getDataProp(e.data):null,s=e.httpHeaders||null,o=!0===e.withCredentials,l=null!==(t=e.password)&&void 0!==t?t:null,c=e.range instanceof PDFDataRangeTransport?e.range:null,h=Number.isInteger(e.rangeChunkSize)&&e.rangeChunkSize>0?e.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let d=e.worker instanceof PDFWorker?e.worker:null;const u=e.verbosity,p="string"!==typeof e.docBaseUrl||(0,_display_utils.isDataScheme)(e.docBaseUrl)?null:e.docBaseUrl,f="string"===typeof e.cMapUrl?e.cMapUrl:null,m=!1!==e.cMapPacked,g=e.CMapReaderFactory||DefaultCMapReaderFactory,v="string"===typeof e.standardFontDataUrl?e.standardFontDataUrl:null,y=e.StandardFontDataFactory||DefaultStandardFontDataFactory,b=!0!==e.stopAtErrors,x=Number.isInteger(e.maxImageSize)&&e.maxImageSize>-1?e.maxImageSize:-1,w=!1!==e.isEvalSupported,_="boolean"===typeof e.isOffscreenCanvasSupported?e.isOffscreenCanvasSupported:!_is_node.isNodeJS,S="boolean"===typeof e.disableFontFace?e.disableFontFace:_is_node.isNodeJS,A=!0===e.fontExtraProperties,E=!0===e.enableXfa,C=e.ownerDocument||globalThis.document,M=!0===e.disableRange,P=!0===e.disableStream,T=!0===e.disableAutoFetch,D=!0===e.pdfBug,R=c?c.length:null!==(i=e.length)&&void 0!==i?i:NaN,O="boolean"===typeof e.useSystemFonts?e.useSystemFonts:!_is_node.isNodeJS&&!S,I="boolean"===typeof e.useWorkerFetch?e.useWorkerFetch:g===_display_utils.DOMCMapReaderFactory&&y===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(f,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(v,document.baseURI);(0,_util.setVerbosityLevel)(u);const k=I?null:{cMapReaderFactory:new g({baseUrl:f,isCompressed:m}),standardFontDataFactory:new y({baseUrl:v})};if(!d){const e={verbosity:u,port:_worker_options.GlobalWorkerOptions.workerPort};d=e.port?PDFWorker.fromPort(e):new PDFWorker(e),n._worker=d}const L=n.docId,F={docId:L,apiVersion:"3.4.120",data:a,password:l,disableAutoFetch:T,rangeChunkSize:h,length:R,docBaseUrl:p,enableXfa:E,evaluatorOptions:{maxImageSize:x,disableFontFace:S,ignoreErrors:b,isEvalSupported:w,isOffscreenCanvasSupported:_,fontExtraProperties:A,useSystemFonts:O,cMapUrl:I?f:null,standardFontDataUrl:I?v:null}},B={ignoreErrors:b,isEvalSupported:w,disableFontFace:S,fontExtraProperties:A,enableXfa:E,ownerDocument:C,disableAutoFetch:T,pdfBug:D,styleElement:null};return d.promise.then((function(){if(n.destroyed)throw new Error("Loading aborted");const e=_fetchDocument(d,F),t=new Promise((function(e){let t;c?t=new _transport_stream.PDFDataTransportStream({length:R,initialData:c.initialData,progressiveDone:c.progressiveDone,contentDispositionFilename:c.contentDispositionFilename,disableRange:M,disableStream:P},c):a||(t=createPDFNetworkStream({url:r,length:R,httpHeaders:s,withCredentials:o,rangeChunkSize:h,disableRange:M,disableStream:P})),e(t)}));return Promise.all([e,t]).then((function(e){let[t,i]=e;if(n.destroyed)throw new Error("Loading aborted");const r=new _message_handler.MessageHandler(L,t,d.port),a=new WorkerTransport(r,n,i,B,k);n._transport=a,r.send("Ready",null)}))})).catch(n._capability.reject),n}async function _fetchDocument(e,t){if(e.destroyed)throw new Error("Worker was destroyed");const i=await e.messageHandler.sendWithPromise("GetDocRequest",t,t.data?[t.data.buffer]:null);if(e.destroyed)throw new Error("Worker was destroyed");return i}function getUrlProp(e){if(e instanceof URL)return e.href;try{return new URL(e,window.location).href}catch(t){if(_is_node.isNodeJS&&"string"===typeof e)return e}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(e){if(_is_node.isNodeJS&&"undefined"!==typeof Buffer&&e instanceof Buffer)return(0,_display_utils.deprecated)("Please provide binary data as `Uint8Array`, rather than `Buffer`."),new Uint8Array(e);if(e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength)return e;if("string"===typeof e)return(0,_util.stringToBytes)(e);if("object"===typeof e&&!isNaN(null===e||void 0===e?void 0:e.length)||(0,_util.isArrayBuffer)(e))return new Uint8Array(e);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}var _onUnsupportedFeature=new WeakMap;class PDFDocumentLoadingTask{constructor(){var e,t;_classPrivateFieldInitSpec(this,_onUnsupportedFeature,null),this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId="d".concat((_docId._=(e=_docId._,t=e++,e),t)),this.destroyed=!1,this.onPassword=null,this.onProgress=null}get onUnsupportedFeature(){return _classPrivateFieldGet(_onUnsupportedFeature,this)}set onUnsupportedFeature(e){(0,_display_utils.deprecated)("The PDFDocumentLoadingTask onUnsupportedFeature property will be removed in the future."),_classPrivateFieldSet(_onUnsupportedFeature,this,e)}get promise(){return this._capability.promise}async destroy(){var e;this.destroyed=!0,await(null===(e=this._transport)||void 0===e?void 0:e.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}var _docId={_:0};exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then((()=>{for(const i of this._progressListeners)i(e,t)}))}onDataProgressiveRead(e){this._readyCapability.promise.then((()=>{for(const t of this._progressiveReadListeners)t(e)}))}onDataProgressiveDone(){this._readyCapability.promise.then((()=>{for(const e of this._progressiveDoneListeners)e()}))}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._pageIndex=e,this._pageInfo=t,this._ownerDocument=n,this._transport=i,this._stats=r?new _display_utils.StatTimer:null,this._pdfBug=r,this.commonObjs=i.commonObjs,this.objs=new PDFObjects,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport(){let{scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:n=0,dontFlip:r=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:i,offsetY:n,dontFlip:r})}getAnnotations(){let{intent:e="display"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return(null===(e=this._transport._htmlForXfa)||void 0===e?void 0:e.children[this._pageIndex])||null}render(e){var t,i;let{canvasContext:n,viewport:r,intent:a="display",annotationMode:s=_util.AnnotationMode.ENABLE,transform:o=null,canvasFactory:l=null,background:c=null,optionalContentConfigPromise:h=null,annotationCanvasMap:d=null,pageColors:u=null,printAnnotationStorage:p=null}=e;null===(t=this._stats)||void 0===t||t.time("Overall");const f=this._transport.getRenderingIntent(a,s,p);this.pendingCleanup=!1,h||(h=this._transport.getOptionalContentConfig());let m=this._intentStates.get(f.cacheKey);m||(m=Object.create(null),this._intentStates.set(f.cacheKey,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);const g=l||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),v=!!(f.renderingIntent&_util.RenderingIntentFlag.PRINT);var y;m.displayReadyCapability||(m.displayReadyCapability=(0,_util.createPromiseCapability)(),m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(y=this._stats)||void 0===y||y.time("Page Request"),this._pumpOperatorList(f));const b=e=>{var t,i;m.renderTasks.delete(x),(this.cleanupAfterRender||v)&&(this.pendingCleanup=!0),this._tryCleanup(),e?(x.capability.reject(e),this._abortOperatorList({intentState:m,reason:e instanceof Error?e:new Error(e)})):x.capability.resolve(),null===(t=this._stats)||void 0===t||t.timeEnd("Rendering"),null===(i=this._stats)||void 0===i||i.timeEnd("Overall")},x=new InternalRenderTask({callback:b,params:{canvasContext:n,viewport:r,transform:o,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:g,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:u});((i=m).renderTasks||(i.renderTasks=new Set)).add(x);const w=x.task;return Promise.all([m.displayReadyCapability.promise,h]).then((e=>{var t;let[i,n]=e;this.pendingCleanup?b():(null===(t=this._stats)||void 0===t||t.time("Rendering"),x.initializeGraphics({transparency:i,optionalContentConfig:n}),x.operatorListChanged())})).catch(b),w}getOperatorList(){let{intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:i=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=this._transport.getRenderingIntent(e,t,i,!0);let r,a=this._intentStates.get(n.cacheKey);var s,o;return a||(a=Object.create(null),this._intentStates.set(n.cacheKey,a)),a.opListReadCapability||(r=Object.create(null),r.operatorListChanged=function(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(r))},a.opListReadCapability=(0,_util.createPromiseCapability)(),((s=a).renderTasks||(s.renderTasks=new Set)).add(r),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(o=this._stats)||void 0===o||o.time("Page Request"),this._pumpOperatorList(n)),a.opListReadCapability.promise}streamTextContent(){let{disableCombineTextItems:e=!1,includeMarkedContent:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:!0!==e,includeMarkedContent:!0===t},{highWaterMark:100,size:e=>e.items.length})}getTextContent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((e=>_xfa_text.XfaText.textContent(e)));const t=this.streamTextContent(e);return new Promise((function(e,i){const n=t.getReader(),r={items:[],styles:Object.create(null)};!function t(){n.read().then((function(i){let{value:n,done:a}=i;a?e(r):(Object.assign(r.styles,n.styles),r.items.push(...n.items),t())}),i)}()}))}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.pendingCleanup=!1,Promise.all(e)}cleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.pendingCleanup)return!1;for(const{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),e&&this._stats&&(this._stats=new _display_utils.StatTimer),this.pendingCleanup=!1,!0}_startRenderPage(e,t){var i,n;const r=this._intentStates.get(t);r&&(null===(i=this._stats)||void 0===i||i.timeEnd("Page Request"),null===(n=r.displayReadyCapability)||void 0===n||n.resolve(e))}_renderPageChunk(e,t){for(let i=0,n=e.length;i<n;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList(e){let{renderingIntent:t,cacheKey:i,annotationStorageMap:n}=e;const r=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:i,annotationStorage:n}).getReader(),a=this._intentStates.get(i);a.streamReader=r;const s=()=>{r.read().then((e=>{let{value:t,done:i}=e;i?a.streamReader=null:this._transport.destroyed||(this._renderPageChunk(t,a),s())}),(e=>{if(a.streamReader=null,!this._transport.destroyed){if(a.operatorList){a.operatorList.lastChunk=!0;for(const e of a.renderTasks)e.operatorListChanged();this._tryCleanup()}if(a.displayReadyCapability)a.displayReadyCapability.reject(e);else{if(!a.opListReadCapability)throw e;a.opListReadCapability.reject(e)}}}))};s()}_abortOperatorList(e){let{intentState:t,reason:i,force:n=!1}=e;if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!n){if(t.renderTasks.size>0)return;if(i instanceof _display_utils.RenderingCancelledException){let e=RENDERING_CANCELLED_TIMEOUT;return i.extraDelay>0&&i.extraDelay<1e3&&(e+=i.extraDelay),void(t.streamReaderCancelTimeout=setTimeout((()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:i,force:!0})}),e))}}if(t.streamReader.cancel(new _util.AbortException(i.message)).catch((()=>{})),t.streamReader=null,!this._transport.destroyed){for(const[e,i]of this._intentStates)if(i===t){this._intentStates.delete(e);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;var _listeners=new WeakMap,_deferred=new WeakMap;class LoopbackPort{constructor(){_classPrivateFieldInitSpec(this,_listeners,new Set),_classPrivateFieldInitSpec(this,_deferred,Promise.resolve())}postMessage(e,t){const i={data:structuredClone(e,t)};_classPrivateFieldGet(_deferred,this).then((()=>{for(const e of _classPrivateFieldGet(_listeners,this))e.call(this,i)}))}addEventListener(e,t){_classPrivateFieldGet(_listeners,this).add(t)}removeEventListener(e,t){_classPrivateFieldGet(_listeners,this).delete(t)}terminate(){_classPrivateFieldGet(_listeners,this).clear()}}exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};if(exports.PDFWorkerUtil=PDFWorkerUtil,_is_node.isNodeJS)PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if("object"===typeof document){var _document;const e=null===(_document=document)||void 0===_document||null===(_document=_document.currentScript)||void 0===_document?void 0:_document.src;e&&(PDFWorkerUtil.fallbackWorkerSrc=e.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(e,t){let i;try{if(i=new URL(e),!i.origin||"null"===i.origin)return!1}catch(r){return!1}const n=new URL(t,i);return i.origin===n.origin},PDFWorkerUtil.createCDNWrapper=function(e){const t='importScripts("'.concat(e,'");');return URL.createObjectURL(new Blob([t]))};class PDFWorker{constructor(){let{name:e=null,port:t=null,verbosity:i=(0,_util.getVerbosityLevel)()}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t&&_workerPorts._.has(t))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=e,this.destroyed=!1,this.verbosity=i,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,t)return _workerPorts._.set(t,this),void this._initializeFromPort(t);this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new _message_handler.MessageHandler("main","worker",e),this._messageHandler.on("ready",(function(){})),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:t}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,t)||(t=PDFWorkerUtil.createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t),i=new _message_handler.MessageHandler("main","worker",e),n=()=>{e.removeEventListener("error",r),i.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},r=()=>{this._webWorker||n()};e.addEventListener("error",r),i.on("test",(t=>{e.removeEventListener("error",r),this.destroyed?n():t?(this._messageHandler=i,this._port=e,this._webWorker=e,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),i.destroy(),e.terminate())})),i.on("ready",(t=>{if(e.removeEventListener("error",r),this.destroyed)n();else try{a()}catch(i){this._setupFakeWorker()}}));const a=()=>{const e=new Uint8Array;i.send("test",e,[e.buffer])};return void a()}catch(e){(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then((e=>{if(this.destroyed)return void this._readyCapability.reject(new Error("Worker was destroyed"));const t=new LoopbackPort;this._port=t;const i="fake".concat(PDFWorkerUtil.fakeWorkerId++),n=new _message_handler.MessageHandler(i+"_worker",i,t);e.setup(n,t);const r=new _message_handler.MessageHandler(i,i+"_worker",t);this._messageHandler=r,this._readyCapability.resolve(),r.send("configure",{verbosity:this.verbosity})})).catch((e=>{this._readyCapability.reject(new Error('Setting up fake worker failed: "'.concat(e.message,'".')))}))}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),_workerPorts._.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){if(null===e||void 0===e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return _assertClassBrand(PDFWorker,this,_workerPorts)._.has(e.port)?_assertClassBrand(PDFWorker,this,_workerPorts)._.get(e.port):new PDFWorker(e)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(null!==PDFWorkerUtil.fallbackWorkerSrc)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{var e;return(null===(e=globalThis.pdfjsWorker)||void 0===e?void 0:e.WorkerMessageHandler)||null}catch(t){return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}var _workerPorts={_:new WeakMap};exports.PDFWorker=PDFWorker;var _methodPromises=new WeakMap,_pageCache=new WeakMap,_pagePromises=new WeakMap,_WorkerTransport_brand=new WeakSet;class WorkerTransport{constructor(e,t,i,n,r){_classPrivateMethodInitSpec(this,_WorkerTransport_brand),_classPrivateFieldInitSpec(this,_methodPromises,new Map),_classPrivateFieldInitSpec(this,_pageCache,new Map),_classPrivateFieldInitSpec(this,_pagePromises,new Map),this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this._params=n,this.cMapReaderFactory=null===r||void 0===r?void 0:r.cMapReaderFactory,this.standardFontDataFactory=null===r||void 0===r?void 0:r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_util.AnnotationMode.ENABLE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=_util.RenderingIntentFlag.DISPLAY,a=null;switch(e){case"any":r=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":r=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)("getRenderingIntent - invalid intent: ".concat(e))}switch(t){case _util.AnnotationMode.DISABLE:r+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:r+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:r+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,a=(r&_util.RenderingIntentFlag.PRINT&&i instanceof _annotation_storage.PrintAnnotationStorage?i:this.annotationStorage).serializable;break;default:(0,_util.warn)("getRenderingIntent - invalid annotationMode: ".concat(t))}return n&&(r+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:r,cacheKey:"".concat(r,"_").concat(_annotation_storage.AnnotationStorage.getHash(a)),annotationStorageMap:a}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of _classPrivateFieldGet(_pageCache,this).values())e.push(i._destroy());_classPrivateFieldGet(_pageCache,this).clear(),_classPrivateFieldGet(_pagePromises,this).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then((()=>{this.commonObjs.clear(),this.fontLoader.clear(),_classPrivateFieldGet(_methodPromises,this).clear(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=e=>{this._lastProgress={loaded:e.loaded,total:e.total}},t.onPull=()=>{this._fullReader.read().then((function(e){let{value:i,done:n}=e;n?t.close():((0,_util.assert)(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(i),1,[i]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{this._fullReader.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}})),e.on("ReaderHeadersReady",(e=>{const i=(0,_util.createPromiseCapability)(),n=this._fullReader;return n.headersReady.then((()=>{var e;n.isStreamingSupported&&n.isRangeSupported||(this._lastProgress&&(null===(e=t.onProgress)||void 0===e||e.call(t,this._lastProgress)),n.onProgress=e=>{var i;null===(i=t.onProgress)||void 0===i||i.call(t,{loaded:e.loaded,total:e.total})});i.resolve({isStreamingSupported:n.isStreamingSupported,isRangeSupported:n.isRangeSupported,contentLength:n.contentLength})}),i.reject),i.promise})),e.on("GetRangeReader",((e,t)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const i=this._networkStream.getRangeReader(e.begin,e.end);i?(t.onPull=()=>{i.read().then((function(e){let{value:i,done:n}=e;n?t.close():((0,_util.assert)(i instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),t.enqueue(new Uint8Array(i),1,[i]))})).catch((e=>{t.error(e)}))},t.onCancel=e=>{i.cancel(e),t.ready.catch((e=>{if(!this.destroyed)throw e}))}):t.close()})),e.on("GetDoc",(e=>{let{pdfInfo:i}=e;this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(i,this))})),e.on("DocException",(function(e){let i;switch(e.name){case"PasswordException":i=new _util.PasswordException(e.message,e.code);break;case"InvalidPDFException":i=new _util.InvalidPDFException(e.message);break;case"MissingPDFException":i=new _util.MissingPDFException(e.message);break;case"UnexpectedResponseException":i=new _util.UnexpectedResponseException(e.message,e.status);break;case"UnknownErrorException":i=new _util.UnknownErrorException(e.message,e.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(i)})),e.on("PasswordRequest",(e=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){const n=e=>{e instanceof Error?this._passwordCapability.reject(e):this._passwordCapability.resolve({password:e})};try{t.onPassword(n,e.code)}catch(i){this._passwordCapability.reject(i)}}else this._passwordCapability.reject(new _util.PasswordException(e.message,e.code));return this._passwordCapability.promise})),e.on("DataLoaded",(e=>{var i;null===(i=t.onProgress)||void 0===i||i.call(t,{loaded:e.length,total:e.length}),this.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(e=>{this.destroyed||_classPrivateFieldGet(_pageCache,this).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(t=>{var i;let[n,r,a]=t;if(!this.destroyed&&!this.commonObjs.has(n))switch(r){case"Font":const t=this._params;if("error"in a){const e=a.error;(0,_util.warn)("Error during font loading: ".concat(e)),this.commonObjs.resolve(n,e);break}let s=null;t.pdfBug&&null!==(i=globalThis.FontInspector)&&void 0!==i&&i.enabled&&(s={registerFont(e,t){globalThis.FontInspector.fontAdded(e,t)}});const o=new _font_loader.FontFaceObject(a,{isEvalSupported:t.isEvalSupported,disableFontFace:t.disableFontFace,ignoreErrors:t.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:s});this.fontLoader.bind(o).catch((t=>e.sendWithPromise("FontFallback",{id:n}))).finally((()=>{!t.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(n,o)}));break;case"FontPath":case"Image":this.commonObjs.resolve(n,a);break;default:throw new Error("Got unknown common object type ".concat(r))}})),e.on("obj",(e=>{let[t,i,n,r]=e;if(this.destroyed)return;const a=_classPrivateFieldGet(_pageCache,this).get(i);if(!a.objs.has(t))switch(n){case"Image":a.objs.resolve(t,r);const e=8e6;if(r){let t;if(r.bitmap){const{width:e,height:i}=r;t=e*i*4}else{var s;t=(null===(s=r.data)||void 0===s?void 0:s.length)||0}t>e&&(a.cleanupAfterRender=!0)}break;case"Pattern":a.objs.resolve(t,r);break;default:throw new Error("Got unknown object type ".concat(n))}})),e.on("DocProgress",(e=>{var i;this.destroyed||null===(i=t.onProgress)||void 0===i||i.call(t,{loaded:e.loaded,total:e.total})})),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(e):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.")))),e.on("FetchStandardFontData",(e=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(e):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter."))))}_onUnsupportedFeature(e){var t,i;let{featureId:n}=e;this.destroyed||null===(t=(i=this.loadingTask).onUnsupportedFeature)||void 0===t||t.call(i,n)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var e,t;return this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:null!==(e=null===(t=this._fullReader)||void 0===t?void 0:t.filename)&&void 0!==e?e:null}).finally((()=>{this.annotationStorage.resetModified()}))}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=_classPrivateFieldGet(_pagePromises,this).get(t);if(i)return i;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then((e=>{if(this.destroyed)throw new Error("Transport destroyed");const i=new PDFPageProxy(t,e,this,this._params.ownerDocument,this._params.pdfBug);return _classPrivateFieldGet(_pageCache,this).set(t,i),i}));return _classPrivateFieldGet(_pagePromises,this).set(t,n),n}getPageIndex(e){return"object"!==typeof e||null===e||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return _assertClassBrand(_WorkerTransport_brand,this,_cacheSimpleMethod).call(this,"GetFieldObjects")}hasJSActions(){return _assertClassBrand(_WorkerTransport_brand,this,_cacheSimpleMethod).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return"string"!==typeof e?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then((e=>new _optional_content_config.OptionalContentConfig(e)))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=_classPrivateFieldGet(_methodPromises,this).get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then((e=>{var t,i,n,r;return{info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:null!==(t=null===(i=this._fullReader)||void 0===i?void 0:i.filename)&&void 0!==t?t:null,contentLength:null!==(n=null===(r=this._fullReader)||void 0===r?void 0:r.contentLength)&&void 0!==n?n:null}}));return _classPrivateFieldGet(_methodPromises,this).set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of _classPrivateFieldGet(_pageCache,this).values())if(!e.cleanup())throw new Error("startCleanup: Page ".concat(e.pageNumber," is currently rendering."));this.commonObjs.clear(),e||this.fontLoader.clear(),_classPrivateFieldGet(_methodPromises,this).clear()}}get loadingParams(){const{disableAutoFetch:e,enableXfa:t}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e,enableXfa:t})}}function _cacheSimpleMethod(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=_classPrivateFieldGet(_methodPromises,this).get(e);if(i)return i;const n=this.messageHandler.sendWithPromise(e,t);return _classPrivateFieldGet(_methodPromises,this).set(e,n),n}var _objs=new WeakMap,_PDFObjects_brand=new WeakSet;class PDFObjects{constructor(){_classPrivateMethodInitSpec(this,_PDFObjects_brand),_classPrivateFieldInitSpec(this,_objs,Object.create(null))}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t){const i=_assertClassBrand(_PDFObjects_brand,this,_ensureObj).call(this,e);return i.capability.promise.then((()=>t(i.data))),null}const i=_classPrivateFieldGet(_objs,this)[e];if(null===i||void 0===i||!i.capability.settled)throw new Error("Requesting object that isn't resolved yet ".concat(e,"."));return i.data}has(e){const t=_classPrivateFieldGet(_objs,this)[e];return(null===t||void 0===t?void 0:t.capability.settled)||!1}resolve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=_assertClassBrand(_PDFObjects_brand,this,_ensureObj).call(this,e);i.data=t,i.capability.resolve()}clear(){for(const t in _classPrivateFieldGet(_objs,this)){var e;const{data:i}=_classPrivateFieldGet(_objs,this)[t];null===i||void 0===i||null===(e=i.bitmap)||void 0===e||e.close()}_classPrivateFieldSet(_objs,this,Object.create(null))}}function _ensureObj(e){const t=_classPrivateFieldGet(_objs,this)[e];return t||(_classPrivateFieldGet(_objs,this)[e]={capability:(0,_util.createPromiseCapability)(),data:null})}var _internalRenderTask=new WeakMap;class RenderTask{constructor(e){_classPrivateFieldInitSpec(this,_internalRenderTask,null),_classPrivateFieldSet(_internalRenderTask,this,e),this.onContinue=null}get promise(){return _classPrivateFieldGet(_internalRenderTask,this).capability.promise}cancel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;_classPrivateFieldGet(_internalRenderTask,this).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=_classPrivateFieldGet(_internalRenderTask,this).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=_classPrivateFieldGet(_internalRenderTask,this);return e.form||e.canvas&&(null===t||void 0===t?void 0:t.size)>0}}exports.RenderTask=RenderTask;class InternalRenderTask{constructor(e){let{callback:t,params:i,objs:n,commonObjs:r,annotationCanvasMap:a,operatorList:s,pageIndex:o,canvasFactory:l,useRequestAnimationFrame:c=!1,pdfBug:h=!1,pageColors:d=null}=e;this.callback=t,this.params=i,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=s,this._pageIndex=o,this.canvasFactory=l,this._pdfBug=h,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===c&&"undefined"!==typeof window,this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=i.canvasContext.canvas}get completed(){return this.capability.promise.catch((function(){}))}initializeGraphics(e){var t,i;let{transparency:n=!1,optionalContentConfig:r}=e;if(this.cancelled)return;if(this._canvas){if(_canvasInUse._.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");_canvasInUse._.add(this._canvas)}this._pdfBug&&null!==(t=globalThis.StepperManager)&&void 0!==t&&t.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:a,viewport:s,transform:o,background:l}=this.params;this.gfx=new _canvas.CanvasGraphics(a,this.commonObjs,this.objs,this.canvasFactory,{optionalContentConfig:r},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:s,transparency:n,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,null===(i=this.graphicsReadyCallback)||void 0===i||i.call(this)}cancel(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,null===(e=this.gfx)||void 0===e||e.endDrawing(),this._canvas&&_canvasInUse._.delete(this._canvas),this.callback(t||new _display_utils.RenderingCancelledException("Rendering cancelled, page ".concat(this._pageIndex+1),"canvas",i))}operatorListChanged(){var e;this.graphicsReady?(null===(e=this.stepper)||void 0===e||e.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame((()=>{this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&_canvasInUse._.delete(this._canvas),this.callback())))}}var _canvasInUse={_:new WeakSet};const version="3.4.120";exports.version=version;const build="af6414988";exports.build=build},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PrintAnnotationStorage=t.AnnotationStorage=void 0;var n=i(1),r=i(4),a=i(8),s=new WeakMap,o=new WeakMap,l=new WeakSet;class c{constructor(){_classPrivateMethodInitSpec(this,l),_classPrivateFieldInitSpec(this,s,!1),_classPrivateFieldInitSpec(this,o,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=_classPrivateFieldGet(o,this).get(e);return void 0===i?t:Object.assign(t,i)}getRawValue(e){return _classPrivateFieldGet(o,this).get(e)}remove(e){if(_classPrivateFieldGet(o,this).delete(e),0===_classPrivateFieldGet(o,this).size&&this.resetModified(),"function"===typeof this.onAnnotationEditor){for(const e of _classPrivateFieldGet(o,this).values())if(e instanceof r.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=_classPrivateFieldGet(o,this).get(e);let n=!1;if(void 0!==i)for(const[r,a]of Object.entries(t))i[r]!==a&&(n=!0,i[r]=a);else n=!0,_classPrivateFieldGet(o,this).set(e,t);n&&_assertClassBrand(l,this,h).call(this),t instanceof r.AnnotationEditor&&"function"===typeof this.onAnnotationEditor&&this.onAnnotationEditor(t.constructor._type)}has(e){return _classPrivateFieldGet(o,this).has(e)}getAll(){return _classPrivateFieldGet(o,this).size>0?(0,n.objectFromMap)(_classPrivateFieldGet(o,this)):null}setAll(e){for(const[t,i]of Object.entries(e))this.setValue(t,i)}get size(){return _classPrivateFieldGet(o,this).size}resetModified(){_classPrivateFieldGet(s,this)&&(_classPrivateFieldSet(s,this,!1),"function"===typeof this.onResetModified&&this.onResetModified())}get print(){return new u(this)}get serializable(){if(0===_classPrivateFieldGet(o,this).size)return null;const e=new Map;for(const[t,i]of _classPrivateFieldGet(o,this)){const n=i instanceof r.AnnotationEditor?i.serialize():i;n&&e.set(t,n)}return e}static getHash(e){if(!e)return"";const t=new a.MurmurHash3_64;for(const[i,n]of e)t.update("".concat(i,":").concat(JSON.stringify(n)));return t.hexdigest()}}function h(){_classPrivateFieldGet(s,this)||(_classPrivateFieldSet(s,this,!0),"function"===typeof this.onSetModified&&this.onSetModified())}t.AnnotationStorage=c;var d=new WeakMap;class u extends c{constructor(e){super(),_classPrivateFieldInitSpec(this,d,null),_classPrivateFieldSet(d,this,structuredClone(e.serializable))}get print(){(0,n.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return _classPrivateFieldGet(d,this)}}t.PrintAnnotationStorage=u},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditor=void 0;var n=i(5),r=i(1),a=new WeakMap,s=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap;class d{constructor(e){_classPrivateFieldInitSpec(this,a,this.focusin.bind(this)),_classPrivateFieldInitSpec(this,s,this.focusout.bind(this)),_classPrivateFieldInitSpec(this,o,!1),_classPrivateFieldInitSpec(this,l,!1),_classPrivateFieldInitSpec(this,c,!1),_defineProperty(this,"_uiManager",null),_classPrivateFieldInitSpec(this,h,d._zIndex++),this.constructor===d&&(0,r.unreachable)("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager;const{rotation:t,rawDims:{pageWidth:i,pageHeight:n,pageX:u,pageY:p}}=this.parent.viewport;this.rotation=t,this.pageDimensions=[i,n],this.pageTranslation=[u,p];const[f,m]=this.parentDimensions;this.x=e.x/f,this.y=e.y/m,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,r.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=_classPrivateFieldGet(h,this)}setParent(e){null!==e&&(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions),this.parent=e}focusin(e){_classPrivateFieldGet(o,this)?_classPrivateFieldSet(o,this,!1):this.parent.setSelected(this)}focusout(e){var t;if(!this.isAttachedToDOM)return;const i=e.relatedTarget;null!==i&&void 0!==i&&i.closest("#".concat(this.id))||(e.preventDefault(),null!==(t=this.parent)&&void 0!==t&&t.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(e){const t=this.parent.div.getBoundingClientRect();this.startX=e.clientX-t.x,this.startY=e.clientY-t.y,e.dataTransfer.setData("text/plain",this.id),e.dataTransfer.effectAllowed="move"}setAt(e,t,i,n){const[r,a]=this.parentDimensions;[i,n]=this.screenToPageTranslation(i,n),this.x=(e+i)/r,this.y=(t+n)/a,this.div.style.left="".concat(100*this.x,"%"),this.div.style.top="".concat(100*this.y,"%")}translate(e,t){const[i,n]=this.parentDimensions;[e,t]=this.screenToPageTranslation(e,t),this.x+=e/i,this.y+=t/n,this.div.style.left="".concat(100*this.x,"%"),this.div.style.top="".concat(100*this.y,"%")}screenToPageTranslation(e,t){switch(this.parentRotation){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return this._uiManager.viewParameters.rotation}get parentDimensions(){const{realScale:e}=this._uiManager.viewParameters,[t,i]=this.pageDimensions;return[t*e,i*e]}setDims(e,t){const[i,n]=this.parentDimensions;this.div.style.width="".concat(100*e/i,"%"),this.div.style.height="".concat(100*t/n,"%")}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,n=i.endsWith("%"),r=t.endsWith("%");if(n&&r)return;const[a,s]=this.parentDimensions;n||(e.width="".concat(100*parseFloat(i)/a,"%")),r||(e.height="".concat(100*parseFloat(t)/s,"%"))}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",_classPrivateFieldGet(a,this)),this.div.addEventListener("focusout",_classPrivateFieldGet(s,this));const[e,t]=this.getInitialTranslation();return this.translate(e,t),(0,n.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(e){const{isMac:t}=r.FeatureTest.platform;0!==e.button||e.ctrlKey&&t?e.preventDefault():(e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this),_classPrivateFieldSet(o,this,!0))}getRect(e,t){const i=this.parentScale,[n,r]=this.pageDimensions,[a,s]=this.pageTranslation,o=e/i,l=t/i,c=this.x*n,h=this.y*r,d=this.width*n,u=this.height*r;switch(this.rotation){case 0:return[c+o+a,r-h-l-u+s,c+o+d+a,r-h-l+s];case 90:return[c+l+a,r-h+o+s,c+l+u+a,r-h+o+d+s];case 180:return[c-o-d+a,r-h+l+s,c-o+a,r-h+l+u+s];case 270:return[c-l-u+a,r-h-o-d+s,c-l+a,r-h-o+s];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,n,r,a]=e,s=r-i,o=a-n;switch(this.rotation){case 0:return[i,t-a,s,o];case 90:return[i,t-n,o,s];case 180:return[r,t-n,s,o];case 270:return[r,t-a,o,s];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){_classPrivateFieldSet(c,this,!0)}disableEditMode(){_classPrivateFieldSet(c,this,!1)}isInEditMode(){return _classPrivateFieldGet(c,this)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var e;null===(e=this.div)||void 0===e||e.addEventListener("focusin",_classPrivateFieldGet(a,this))}serialize(){(0,r.unreachable)("An editor must be serializable")}static deserialize(e,t,i){const n=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i});n.rotation=e.rotation;const[r,a]=n.pageDimensions,[s,o,l,c]=n.getRectInCurrentCoords(e.rect,a);return n.x=s/r,n.y=o/a,n.width=l/r,n.height=c/a,n}remove(){this.div.removeEventListener("focusin",_classPrivateFieldGet(a,this)),this.div.removeEventListener("focusout",_classPrivateFieldGet(s,this)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var e;null===(e=this.div)||void 0===e||e.classList.add("selectedEditor")}unselect(){var e;null===(e=this.div)||void 0===e||e.classList.remove("selectedEditor")}updateParams(e,t){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return _classPrivateFieldGet(l,this)}set isEditing(e){_classPrivateFieldSet(l,this,e),e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}_defineProperty(d,"_colorManager",new n.ColorManager),_defineProperty(d,"_zIndex",1),t.AnnotationEditor=d},(e,t,i)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardManager=t.CommandManager=t.ColorManager=t.AnnotationEditorUIManager=void 0,t.bindEvents=function(e,t,i){for(const n of i)t.addEventListener(n,e[n].bind(e))},t.opacityToHex=function(e){return Math.round(Math.min(255,Math.max(1,255*e))).toString(16).padStart(2,"0")};var r=i(1),a=i(6),s=new WeakMap;class o{constructor(){_classPrivateFieldInitSpec(this,s,0)}getId(){var e,t;return"".concat(r.AnnotationEditorPrefix).concat((_classPrivateFieldSet(s,this,(e=_classPrivateFieldGet(s,this),t=e++,e)),t))}}var l=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap;class u{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;_classPrivateFieldInitSpec(this,l,[]),_classPrivateFieldInitSpec(this,c,!1),_classPrivateFieldInitSpec(this,h,void 0),_classPrivateFieldInitSpec(this,d,-1),_classPrivateFieldSet(h,this,e)}add(e){let{cmd:t,undo:i,mustExec:n,type:r=NaN,overwriteIfSameType:a=!1,keepUndo:s=!1}=e;if(n&&t(),_classPrivateFieldGet(c,this))return;const o={cmd:t,undo:i,type:r};if(-1===_classPrivateFieldGet(d,this))return _classPrivateFieldGet(l,this).length>0&&(_classPrivateFieldGet(l,this).length=0),_classPrivateFieldSet(d,this,0),void _classPrivateFieldGet(l,this).push(o);if(a&&_classPrivateFieldGet(l,this)[_classPrivateFieldGet(d,this)].type===r)return s&&(o.undo=_classPrivateFieldGet(l,this)[_classPrivateFieldGet(d,this)].undo),void(_classPrivateFieldGet(l,this)[_classPrivateFieldGet(d,this)]=o);const u=_classPrivateFieldGet(d,this)+1;u===_classPrivateFieldGet(h,this)?_classPrivateFieldGet(l,this).splice(0,1):(_classPrivateFieldSet(d,this,u),u<_classPrivateFieldGet(l,this).length&&_classPrivateFieldGet(l,this).splice(u)),_classPrivateFieldGet(l,this).push(o)}undo(){-1!==_classPrivateFieldGet(d,this)&&(_classPrivateFieldSet(c,this,!0),_classPrivateFieldGet(l,this)[_classPrivateFieldGet(d,this)].undo(),_classPrivateFieldSet(c,this,!1),_classPrivateFieldSet(d,this,_classPrivateFieldGet(d,this)-1))}redo(){_classPrivateFieldGet(d,this)<_classPrivateFieldGet(l,this).length-1&&(_classPrivateFieldSet(d,this,_classPrivateFieldGet(d,this)+1),_classPrivateFieldSet(c,this,!0),_classPrivateFieldGet(l,this)[_classPrivateFieldGet(d,this)].cmd(),_classPrivateFieldSet(c,this,!1))}hasSomethingToUndo(){return-1!==_classPrivateFieldGet(d,this)}hasSomethingToRedo(){return _classPrivateFieldGet(d,this)<_classPrivateFieldGet(l,this).length-1}destroy(){_classPrivateFieldSet(l,this,null)}}t.CommandManager=u;var p=new WeakSet;class f{constructor(e){_classPrivateMethodInitSpec(this,p),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=r.FeatureTest.platform;for(const[i,n]of e)for(const e of i){const i=e.startsWith("mac+");t&&i?(this.callbacks.set(e.slice(4),n),this.allKeys.add(e.split("+").at(-1))):t||i||(this.callbacks.set(e,n),this.allKeys.add(e.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(_assertClassBrand(p,this,m).call(this,t));i&&(i.bind(e)(),t.stopPropagation(),t.preventDefault())}}function m(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}t.KeyboardManager=f;class g{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return(0,a.getColorValues)(e),(0,r.shadow)(this,"_colors",e)}convert(e){const t=(0,a.getRGB)(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,n]of this._colors)if(n.every(((e,i)=>e===t[i])))return g._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?r.Util.makeHexColor(...t):e}}_defineProperty(g,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),t.ColorManager=g;var v=new WeakMap,y=new WeakMap,b=new WeakMap,x=new WeakMap,w=new WeakMap,_=new WeakMap,S=new WeakMap,A=new WeakMap,E=new WeakMap,C=new WeakMap,M=new WeakMap,P=new WeakMap,T=new WeakMap,D=new WeakMap,R=new WeakMap,O=new WeakMap,I=new WeakMap,k=new WeakMap,L=new WeakMap,F=new WeakMap,B=new WeakMap,N=new WeakMap,z=new WeakMap,U=new WeakSet;class j{constructor(e,t,i){_classPrivateMethodInitSpec(this,U),_classPrivateFieldInitSpec(this,v,null),_classPrivateFieldInitSpec(this,y,new Map),_classPrivateFieldInitSpec(this,b,new Map),_classPrivateFieldInitSpec(this,x,null),_classPrivateFieldInitSpec(this,w,new u),_classPrivateFieldInitSpec(this,_,0),_classPrivateFieldInitSpec(this,S,null),_classPrivateFieldInitSpec(this,A,new Set),_classPrivateFieldInitSpec(this,E,null),_classPrivateFieldInitSpec(this,C,new o),_classPrivateFieldInitSpec(this,M,!1),_classPrivateFieldInitSpec(this,P,r.AnnotationEditorType.NONE),_classPrivateFieldInitSpec(this,T,new Set),_classPrivateFieldInitSpec(this,D,this.copy.bind(this)),_classPrivateFieldInitSpec(this,R,this.cut.bind(this)),_classPrivateFieldInitSpec(this,O,this.paste.bind(this)),_classPrivateFieldInitSpec(this,I,this.keydown.bind(this)),_classPrivateFieldInitSpec(this,k,this.onEditingAction.bind(this)),_classPrivateFieldInitSpec(this,L,this.onPageChanging.bind(this)),_classPrivateFieldInitSpec(this,F,this.onScaleChanging.bind(this)),_classPrivateFieldInitSpec(this,B,this.onRotationChanging.bind(this)),_classPrivateFieldInitSpec(this,N,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1}),_classPrivateFieldInitSpec(this,z,null),_classPrivateFieldSet(z,this,e),_classPrivateFieldSet(E,this,t),_classPrivateFieldGet(E,this)._on("editingaction",_classPrivateFieldGet(k,this)),_classPrivateFieldGet(E,this)._on("pagechanging",_classPrivateFieldGet(L,this)),_classPrivateFieldGet(E,this)._on("scalechanging",_classPrivateFieldGet(F,this)),_classPrivateFieldGet(E,this)._on("rotationchanging",_classPrivateFieldGet(B,this)),_classPrivateFieldSet(x,this,i),this.viewParameters={realScale:a.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){_assertClassBrand(U,this,G).call(this),_classPrivateFieldGet(E,this)._off("editingaction",_classPrivateFieldGet(k,this)),_classPrivateFieldGet(E,this)._off("pagechanging",_classPrivateFieldGet(L,this)),_classPrivateFieldGet(E,this)._off("scalechanging",_classPrivateFieldGet(F,this)),_classPrivateFieldGet(E,this)._off("rotationchanging",_classPrivateFieldGet(B,this));for(const e of _classPrivateFieldGet(b,this).values())e.destroy();_classPrivateFieldGet(b,this).clear(),_classPrivateFieldGet(y,this).clear(),_classPrivateFieldGet(A,this).clear(),_classPrivateFieldSet(v,this,null),_classPrivateFieldGet(T,this).clear(),_classPrivateFieldGet(w,this).destroy()}onPageChanging(e){let{pageNumber:t}=e;_classPrivateFieldSet(_,this,t-1)}focusMainContainer(){_classPrivateFieldGet(z,this).focus()}addShouldRescale(e){_classPrivateFieldGet(A,this).add(e)}removeShouldRescale(e){_classPrivateFieldGet(A,this).delete(e)}onScaleChanging(e){let{scale:t}=e;this.commitOrRemove(),this.viewParameters.realScale=t*a.PixelsPerInch.PDF_TO_CSS_UNITS;for(const i of _classPrivateFieldGet(A,this))i.onScaleChanging()}onRotationChanging(e){let{pagesRotation:t}=e;this.commitOrRemove(),this.viewParameters.rotation=t}addToAnnotationStorage(e){e.isEmpty()||!_classPrivateFieldGet(x,this)||_classPrivateFieldGet(x,this).has(e.id)||_classPrivateFieldGet(x,this).setValue(e.id,e)}copy(e){if(e.preventDefault(),_classPrivateFieldGet(v,this)&&_classPrivateFieldGet(v,this).commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of _classPrivateFieldGet(T,this))i.isEmpty()||t.push(i.serialize());0!==t.length&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();let t=e.clipboardData.getData("application/pdfjs");if(!t)return;try{t=JSON.parse(t)}catch(n){return void(0,r.warn)('paste: "'.concat(n.message,'".'))}if(!Array.isArray(t))return;this.unselectAll();const i=_classPrivateFieldGet(b,this).get(_classPrivateFieldGet(_,this));try{const e=[];for(const a of t){const t=i.deserialize(a);if(!t)return;e.push(t)}const n=()=>{for(const t of e)_assertClassBrand(U,this,K).call(this,t);_assertClassBrand(U,this,J).call(this,e)},r=()=>{for(const t of e)t.remove()};this.addCommands({cmd:n,undo:r,mustExec:!0})}catch(n){(0,r.warn)('paste: "'.concat(n.message,'".'))}}keydown(e){var t;null!==(t=this.getActive())&&void 0!==t&&t.shouldGetKeyboardEvents()||j._keyboardManager.exec(this,e)}onEditingAction(e){["undo","redo","delete","selectAll"].includes(e.name)&&this[e.name]()}setEditingState(e){e?(_assertClassBrand(U,this,V).call(this),_assertClassBrand(U,this,H).call(this),_assertClassBrand(U,this,q).call(this,{isEditing:_classPrivateFieldGet(P,this)!==r.AnnotationEditorType.NONE,isEmpty:_assertClassBrand(U,this,Z).call(this),hasSomethingToUndo:_classPrivateFieldGet(w,this).hasSomethingToUndo(),hasSomethingToRedo:_classPrivateFieldGet(w,this).hasSomethingToRedo(),hasSelectedEditor:!1})):(_assertClassBrand(U,this,G).call(this),_assertClassBrand(U,this,W).call(this),_assertClassBrand(U,this,q).call(this,{isEditing:!1}))}registerEditorTypes(e){if(!_classPrivateFieldGet(S,this)){_classPrivateFieldSet(S,this,e);for(const e of _classPrivateFieldGet(S,this))_assertClassBrand(U,this,X).call(this,e.defaultPropertiesToUpdate)}}getId(){return _classPrivateFieldGet(C,this).getId()}get currentLayer(){return _classPrivateFieldGet(b,this).get(_classPrivateFieldGet(_,this))}get currentPageIndex(){return _classPrivateFieldGet(_,this)}addLayer(e){_classPrivateFieldGet(b,this).set(e.pageIndex,e),_classPrivateFieldGet(M,this)?e.enable():e.disable()}removeLayer(e){_classPrivateFieldGet(b,this).delete(e.pageIndex)}updateMode(e){if(_classPrivateFieldSet(P,this,e),e===r.AnnotationEditorType.NONE)this.setEditingState(!1),_assertClassBrand(U,this,Q).call(this);else{this.setEditingState(!0),_assertClassBrand(U,this,Y).call(this);for(const t of _classPrivateFieldGet(b,this).values())t.updateMode(e)}}updateToolbar(e){e!==_classPrivateFieldGet(P,this)&&_classPrivateFieldGet(E,this).dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){if(_classPrivateFieldGet(S,this)){for(const i of _classPrivateFieldGet(T,this))i.updateParams(e,t);for(const i of _classPrivateFieldGet(S,this))i.updateDefaultParams(e,t)}}getEditors(e){const t=[];for(const i of _classPrivateFieldGet(y,this).values())i.pageIndex===e&&t.push(i);return t}getEditor(e){return _classPrivateFieldGet(y,this).get(e)}addEditor(e){_classPrivateFieldGet(y,this).set(e.id,e)}removeEditor(e){var t;_classPrivateFieldGet(y,this).delete(e.id),this.unselect(e),null===(t=_classPrivateFieldGet(x,this))||void 0===t||t.remove(e.id)}setActiveEditor(e){_classPrivateFieldGet(v,this)!==e&&(_classPrivateFieldSet(v,this,e),e&&_assertClassBrand(U,this,X).call(this,e.propertiesToUpdate))}toggleSelected(e){if(_classPrivateFieldGet(T,this).has(e))return _classPrivateFieldGet(T,this).delete(e),e.unselect(),void _assertClassBrand(U,this,q).call(this,{hasSelectedEditor:this.hasSelection});_classPrivateFieldGet(T,this).add(e),e.select(),_assertClassBrand(U,this,X).call(this,e.propertiesToUpdate),_assertClassBrand(U,this,q).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const t of _classPrivateFieldGet(T,this))t!==e&&t.unselect();_classPrivateFieldGet(T,this).clear(),_classPrivateFieldGet(T,this).add(e),e.select(),_assertClassBrand(U,this,X).call(this,e.propertiesToUpdate),_assertClassBrand(U,this,q).call(this,{hasSelectedEditor:!0})}isSelected(e){return _classPrivateFieldGet(T,this).has(e)}unselect(e){e.unselect(),_classPrivateFieldGet(T,this).delete(e),_assertClassBrand(U,this,q).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==_classPrivateFieldGet(T,this).size}undo(){_classPrivateFieldGet(w,this).undo(),_assertClassBrand(U,this,q).call(this,{hasSomethingToUndo:_classPrivateFieldGet(w,this).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:_assertClassBrand(U,this,Z).call(this)})}redo(){_classPrivateFieldGet(w,this).redo(),_assertClassBrand(U,this,q).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:_classPrivateFieldGet(w,this).hasSomethingToRedo(),isEmpty:_assertClassBrand(U,this,Z).call(this)})}addCommands(e){_classPrivateFieldGet(w,this).add(e),_assertClassBrand(U,this,q).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:_assertClassBrand(U,this,Z).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[..._classPrivateFieldGet(T,this)];this.addCommands({cmd:()=>{for(const t of e)t.remove()},undo:()=>{for(const t of e)_assertClassBrand(U,this,K).call(this,t)},mustExec:!0})}commitOrRemove(){var e;null===(e=_classPrivateFieldGet(v,this))||void 0===e||e.commitOrRemove()}selectAll(){for(const e of _classPrivateFieldGet(T,this))e.commit();_assertClassBrand(U,this,J).call(this,_classPrivateFieldGet(y,this).values())}unselectAll(){if(_classPrivateFieldGet(v,this))_classPrivateFieldGet(v,this).commitOrRemove();else if(0!==_classPrivateFieldGet(T,this).size){for(const e of _classPrivateFieldGet(T,this))e.unselect();_classPrivateFieldGet(T,this).clear(),_assertClassBrand(U,this,q).call(this,{hasSelectedEditor:!1})}}isActive(e){return _classPrivateFieldGet(v,this)===e}getActive(){return _classPrivateFieldGet(v,this)}getMode(){return _classPrivateFieldGet(P,this)}}function V(){_classPrivateFieldGet(z,this).addEventListener("keydown",_classPrivateFieldGet(I,this))}function G(){_classPrivateFieldGet(z,this).removeEventListener("keydown",_classPrivateFieldGet(I,this))}function H(){document.addEventListener("copy",_classPrivateFieldGet(D,this)),document.addEventListener("cut",_classPrivateFieldGet(R,this)),document.addEventListener("paste",_classPrivateFieldGet(O,this))}function W(){document.removeEventListener("copy",_classPrivateFieldGet(D,this)),document.removeEventListener("cut",_classPrivateFieldGet(R,this)),document.removeEventListener("paste",_classPrivateFieldGet(O,this))}function q(e){Object.entries(e).some((e=>{let[t,i]=e;return _classPrivateFieldGet(N,this)[t]!==i}))&&_classPrivateFieldGet(E,this).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(_classPrivateFieldGet(N,this),e)})}function X(e){_classPrivateFieldGet(E,this).dispatch("annotationeditorparamschanged",{source:this,details:e})}function Y(){if(!_classPrivateFieldGet(M,this)){_classPrivateFieldSet(M,this,!0);for(const e of _classPrivateFieldGet(b,this).values())e.enable()}}function Q(){if(this.unselectAll(),_classPrivateFieldGet(M,this)){_classPrivateFieldSet(M,this,!1);for(const e of _classPrivateFieldGet(b,this).values())e.disable()}}function K(e){const t=_classPrivateFieldGet(b,this).get(e.pageIndex);t?t.addOrRebuild(e):this.addEditor(e)}function Z(){if(0===_classPrivateFieldGet(y,this).size)return!0;if(1===_classPrivateFieldGet(y,this).size)for(const e of _classPrivateFieldGet(y,this).values())return e.isEmpty();return!1}function J(e){_classPrivateFieldGet(T,this).clear();for(const t of e)t.isEmpty()||(_classPrivateFieldGet(T,this).add(t),t.select());_assertClassBrand(U,this,q).call(this,{hasSelectedEditor:!0})}_defineProperty(j,"_keyboardManager",new f([[["ctrl+a","mac+meta+a"],(n=j).prototype.selectAll],[["ctrl+z","mac+meta+z"],n.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],n.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],n.prototype.delete],[["Escape","mac+Escape"],n.prototype.unselectAll]])),t.AnnotationEditorUIManager=j},(e,t,i)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.StatTimer=t.RenderingCancelledException=t.PixelsPerInch=t.PageViewport=t.PDFDateString=t.DOMStandardFontDataFactory=t.DOMSVGFactory=t.DOMCanvasFactory=t.DOMCMapReaderFactory=t.AnnotationPrefix=void 0,t.deprecated=function(e){console.log("Deprecated API usage: "+e)},t.getColorValues=function(e){const t=document.createElement("span");t.style.visibility="hidden",document.body.append(t);for(const i of e.keys()){t.style.color=i;const n=window.getComputedStyle(t).color;e.set(i,v(n))}t.remove()},t.getCurrentTransform=function(e){const{a:t,b:i,c:n,d:r,e:a,f:s}=e.getTransform();return[t,i,n,r,a,s]},t.getCurrentTransformInverse=function(e){const{a:t,b:i,c:n,d:r,e:a,f:s}=e.getTransform().invertSelf();return[t,i,n,r,a,s]},t.getFilenameFromUrl=function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||([e]=e.split(/[#?]/,1)),e.substring(e.lastIndexOf("/")+1)},t.getPdfFilenameFromUrl=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!==typeof e)return t;if(f(e))return(0,a.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const i=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,n=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(e);let r=i.exec(n[1])||i.exec(n[2])||i.exec(n[3]);if(r&&(r=r[0],r.includes("%")))try{r=i.exec(decodeURIComponent(r))[0]}catch(s){}return r||t},t.getRGB=v,t.getXfaPageViewport=function(e,t){let{scale:i=1,rotation:n=0}=t;const{width:r,height:a}=e.attributes.style,s=[0,0,parseInt(r),parseInt(a)];return new u({viewBox:s,scale:i,rotation:n})},t.isDataScheme=f,t.isPdfFile=function(e){return"string"===typeof e&&/\.pdf$/i.test(e)},t.isValidFetchUrl=m,t.loadScript=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(((i,n)=>{const r=document.createElement("script");r.src=e,r.onload=function(e){t&&r.remove(),i(e)},r.onerror=function(){n(new Error("Cannot load script at: ".concat(r.src)))},(document.head||document.documentElement).append(r)}))},t.setLayerDimensions=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(t instanceof u){const{pageWidth:n,pageHeight:r}=t.rawDims,{style:a}=e,s="calc(var(--scale-factor) * ".concat(n,"px)"),o="calc(var(--scale-factor) * ".concat(r,"px)");i&&t.rotation%180!==0?(a.width=o,a.height=s):(a.width=s,a.height=o)}n&&e.setAttribute("data-main-rotation",t.rotation)};var r=i(7),a=i(1);t.AnnotationPrefix="pdfjs_internal_id_";class s{}n=s,_defineProperty(s,"CSS",96),_defineProperty(s,"PDF",72),_defineProperty(s,"PDF_TO_CSS_UNITS",n.CSS/n.PDF),t.PixelsPerInch=s;class o extends r.BaseCanvasFactory{constructor(){let{ownerDocument:e=globalThis.document}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(m(e,document.baseURI)){const i=await fetch(e);if(!i.ok)throw new Error(i.statusText);return t?new Uint8Array(await i.arrayBuffer()):(0,a.stringToBytes)(await i.text())}return new Promise(((i,n)=>{const r=new XMLHttpRequest;r.open("GET",e,!0),t&&(r.responseType="arraybuffer"),r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(200===r.status||0===r.status){let e;if(t&&r.response?e=new Uint8Array(r.response):!t&&r.responseText&&(e=(0,a.stringToBytes)(r.responseText)),e)return void i(e)}n(new Error(r.statusText))}},r.send(null)}))}t.DOMCanvasFactory=o;class c extends r.BaseCMapReaderFactory{_fetchData(e,t){return l(e,this.isCompressed).then((e=>({cMapData:e,compressionType:t})))}}t.DOMCMapReaderFactory=c;class h extends r.BaseStandardFontDataFactory{_fetchData(e){return l(e,!0)}}t.DOMStandardFontDataFactory=h;class d extends r.BaseSVGFactory{_createSVG(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}}t.DOMSVGFactory=d;class u{constructor(e){let{viewBox:t,scale:i,rotation:n,offsetX:r=0,offsetY:a=0,dontFlip:s=!1}=e;this.viewBox=t,this.scale=i,this.rotation=n,this.offsetX=r,this.offsetY=a;const o=(t[2]+t[0])/2,l=(t[3]+t[1])/2;let c,h,d,u,p,f,m,g;switch(n%=360,n<0&&(n+=360),n){case 180:c=-1,h=0,d=0,u=1;break;case 90:c=0,h=1,d=1,u=0;break;case 270:c=0,h=-1,d=-1,u=0;break;case 0:c=1,h=0,d=0,u=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}s&&(d=-d,u=-u),0===c?(p=Math.abs(l-t[1])*i+r,f=Math.abs(o-t[0])*i+a,m=(t[3]-t[1])*i,g=(t[2]-t[0])*i):(p=Math.abs(o-t[0])*i+r,f=Math.abs(l-t[1])*i+a,m=(t[2]-t[0])*i,g=(t[3]-t[1])*i),this.transform=[c*i,h*i,d*i,u*i,p-c*i*o-d*i*l,f-h*i*o-u*i*l],this.width=m,this.height=g}get rawDims(){const{viewBox:e}=this;return(0,a.shadow)(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone(){let{scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:n=this.offsetY,dontFlip:r=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new u({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:i,offsetY:n,dontFlip:r})}convertToViewportPoint(e,t){return a.Util.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=a.Util.applyTransform([e[0],e[1]],this.transform),i=a.Util.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){return a.Util.applyInverseTransform([e,t],this.transform)}}t.PageViewport=u;class p extends a.BaseException{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(e,"RenderingCancelledException"),this.type=t,this.extraDelay=i}}function f(e){const t=e.length;let i=0;for(;i<t&&""===e[i].trim();)i++;return"data:"===e.substring(i,i+5).toLowerCase()}function m(e,t){try{const{protocol:i}=t?new URL(e,t):new URL(e);return"http:"===i||"https:"===i}catch(i){return!1}}let g;function v(e){if(e.startsWith("#")){const t=parseInt(e.slice(1),16);return[(16711680&t)>>16,(65280&t)>>8,255&t]}return e.startsWith("rgb(")?e.slice(4,-1).split(",").map((e=>parseInt(e))):e.startsWith("rgba(")?e.slice(5,-1).split(",").map((e=>parseInt(e))).slice(0,3):((0,a.warn)('Not a valid color format: "'.concat(e,'"')),[0,0,0])}t.RenderingCancelledException=p,t.StatTimer=class{constructor(){_defineProperty(this,"started",Object.create(null)),_defineProperty(this,"times",[])}time(e){e in this.started&&(0,a.warn)("Timer is already running for ".concat(e)),this.started[e]=Date.now()}timeEnd(e){e in this.started||(0,a.warn)("Timer has not been started for ".concat(e)),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:n,end:r}of this.times)e.push("".concat(i.padEnd(t)," ").concat(r-n,"ms\n"));return e.join("")}},t.PDFDateString=class{static toDateObject(e){if(!e||"string"!==typeof e)return null;g||(g=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=g.exec(e);if(!t)return null;const i=parseInt(t[1],10);let n=parseInt(t[2],10);n=n>=1&&n<=12?n-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let s=parseInt(t[5],10);s=s>=0&&s<=59?s:0;let o=parseInt(t[6],10);o=o>=0&&o<=59?o:0;const l=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,"-"===l?(a+=c,s+=h):"+"===l&&(a-=c,s-=h),new Date(Date.UTC(i,n,r,a,s,o))}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseStandardFontDataFactory=t.BaseSVGFactory=t.BaseCanvasFactory=t.BaseCMapReaderFactory=void 0;var n=i(1);class r{constructor(){this.constructor===r&&(0,n.unreachable)("Cannot initialize BaseCanvasFactory.")}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d")}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){(0,n.unreachable)("Abstract method `_createCanvas` called.")}}t.BaseCanvasFactory=r;class a{constructor(e){let{baseUrl:t=null,isCompressed:i=!0}=e;this.constructor===a&&(0,n.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=t,this.isCompressed=i}async fetch(e){let{name:t}=e;if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!t)throw new Error("CMap name must be specified.");const i=this.baseUrl+t+(this.isCompressed?".bcmap":""),r=this.isCompressed?n.CMapCompressionType.BINARY:n.CMapCompressionType.NONE;return this._fetchData(i,r).catch((e=>{throw new Error("Unable to load ".concat(this.isCompressed?"binary ":"","CMap at: ").concat(i))}))}_fetchData(e,t){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseCMapReaderFactory=a;class s{constructor(e){let{baseUrl:t=null}=e;this.constructor===s&&(0,n.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=t}async fetch(e){let{filename:t}=e;if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!t)throw new Error("Font filename must be specified.");const i="".concat(this.baseUrl).concat(t);return this._fetchData(i).catch((e=>{throw new Error("Unable to load font data at: ".concat(i))}))}_fetchData(e){(0,n.unreachable)("Abstract method `_fetchData` called.")}}t.BaseStandardFontDataFactory=s;class o{constructor(){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseSVGFactory.")}create(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),i||(n.setAttribute("width","".concat(e,"px")),n.setAttribute("height","".concat(t,"px"))),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox","0 0 ".concat(e," ").concat(t)),n}createElement(e){if("string"!==typeof e)throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){(0,n.unreachable)("Abstract method `_createSVG` called.")}}t.BaseSVGFactory=o},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MurmurHash3_64=void 0;var n=i(1);const r=3285377520,a=4294901760,s=65535;t.MurmurHash3_64=class{constructor(e){this.h1=e?4294967295&e:r,this.h2=e?4294967295&e:r}update(e){let t,i;if("string"===typeof e){t=new Uint8Array(2*e.length),i=0;for(let n=0,r=e.length;n<r;n++){const r=e.charCodeAt(n);r<=255?t[i++]=r:(t[i++]=r>>>8,t[i++]=255&r)}}else{if(!(0,n.isArrayBuffer)(e))throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");t=e.slice(),i=t.byteLength}const r=i>>2,o=i-4*r,l=new Uint32Array(t.buffer,0,r);let c=0,h=0,d=this.h1,u=this.h2;const p=3432918353,f=461845907,m=11601,g=13715;for(let n=0;n<r;n++)1&n?(c=l[n],c=c*p&a|c*m&s,c=c<<15|c>>>17,c=c*f&a|c*g&s,d^=c,d=d<<13|d>>>19,d=5*d+3864292196):(h=l[n],h=h*p&a|h*m&s,h=h<<15|h>>>17,h=h*f&a|h*g&s,u^=h,u=u<<13|u>>>19,u=5*u+3864292196);switch(c=0,o){case 3:c^=t[4*r+2]<<16;case 2:c^=t[4*r+1]<<8;case 1:c^=t[4*r],c=c*p&a|c*m&s,c=c<<15|c>>>17,c=c*f&a|c*g&s,1&r?d^=c:u^=c}this.h1=d,this.h2=u}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=3981806797*e&a|36045*e&s,t=4283543511*t&a|(2950163797*(t<<16|e>>>16)&a)>>>16,e^=t>>>1,e=444984403*e&a|60499*e&s,t=3301882366*t&a|(3120437893*(t<<16|e>>>16)&a)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FontLoader=t.FontFaceObject=void 0;var n=i(1),r=i(10);t.FontLoader=class{constructor(e){let{onUnsupportedFeature:t,ownerDocument:i=globalThis.document,styleElement:n=null}=e;this._onUnsupportedFeature=t,this._document=i,this.nativeFontFaces=[],this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.push(e),this._document.fonts.add(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(e){if(e.attached||e.missingFile)return;if(e.attached=!0,this.isFontLoadingAPISupported){const t=e.createNativeFontFace();if(t){this.addNativeFontFace(t);try{await t.loaded}catch(i){throw this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,n.warn)("Failed to load font '".concat(t.family,"': '").concat(i,"'.")),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise((t=>{const i=this._queueLoadingCallback(t);this._prepareFontLoadEvent(e,i)}))}}get isFontLoadingAPISupported(){var e;const t=!(null===(e=this._document)||void 0===e||!e.fonts);return(0,n.shadow)(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){let e=!1;return(r.isNodeJS||"undefined"!==typeof navigator&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),(0,n.shadow)(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){const{loadingRequests:t}=this,i={done:!1,complete:function(){for((0,n.assert)(!i.done,"completeRequest() cannot be called twice."),i.done=!0;t.length>0&&t[0].done;){const e=t.shift();setTimeout(e.callback,0)}},callback:e};return t.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,n.shadow)(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(e,t){return e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|255&e.charCodeAt(t+3)}function r(e,t,i,n){return e.substring(0,t)+n+e.substring(t+i)}let a,s;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let c=0;const h="lt".concat(Date.now()).concat(this.loadTestFontId++);let d=this._loadTestFont;d=r(d,976,h.length,h);const u=1482184792;let p=i(d,16);for(a=0,s=h.length-3;a<s;a+=4)p=p-u+i(h,a)|0;a<h.length&&(p=p-u+i(h+"XXX",a)|0),d=r(d,16,4,(0,n.string32)(p));const f="url(data:font/opentype;base64,".concat(btoa(d),");"),m='@font-face {font-family:"'.concat(h,'";src:').concat(f,"}");this.insertRule(m);const g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(const n of[e.loadedName,h]){const e=this._document.createElement("span");e.textContent="Hi",e.style.fontFamily=n,g.append(e)}this._document.body.append(g),function e(t,i){if(++c>30)return(0,n.warn)("Load test font never loaded."),void i();l.font="30px "+t,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?i():setTimeout(e.bind(null,t,i))}(h,(()=>{g.remove(),t.complete()}))}},t.FontFaceObject=class{constructor(e,t){let{isEvalSupported:i=!0,disableFontFace:n=!1,ignoreErrors:r=!1,onUnsupportedFeature:a,fontRegistry:s=null}=t;this.compiledGlyphs=Object.create(null);for(const o in e)this[o]=e[o];this.isEvalSupported=!1!==i,this.disableFontFace=!0===n,this.ignoreErrors=!0===r,this._onUnsupportedFeature=a,this.fontRegistry=s}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(this.cssFontInfo){const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}else t=new FontFace(this.loadedName,this.data,{});return null===(e=this.fontRegistry)||void 0===e||e.registerFont(this),t}createFontFaceRule(){var e;if(!this.data||this.disableFontFace)return null;const t=(0,n.bytesToString)(this.data),i="url(data:".concat(this.mimetype,";base64,").concat(btoa(t),");");let r;if(this.cssFontInfo){let e="font-weight: ".concat(this.cssFontInfo.fontWeight,";");this.cssFontInfo.italicAngle&&(e+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")),r='@font-face {font-family:"'.concat(this.cssFontInfo.fontFamily,'";').concat(e,"src:").concat(i,"}")}else r='@font-face {font-family:"'.concat(this.loadedName,'";src:').concat(i,"}");return null===(e=this.fontRegistry)||void 0===e||e.registerFont(this,i),r}getPathGenerator(e,t){if(void 0!==this.compiledGlyphs[t])return this.compiledGlyphs[t];let i;try{i=e.get(this.loadedName+"_path_"+t)}catch(r){if(!this.ignoreErrors)throw r;return this._onUnsupportedFeature({featureId:n.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,n.warn)('getPathGenerator - ignoring character: "'.concat(r,'".')),this.compiledGlyphs[t]=function(e,t){}}if(this.isEvalSupported&&n.FeatureTest.isEvalSupported){const e=[];for(const t of i){const i=void 0!==t.args?t.args.join(","):"";e.push("c.",t.cmd,"(",i,");\n")}return this.compiledGlyphs[t]=new Function("c","size",e.join(""))}return this.compiledGlyphs[t]=function(e,t){for(const n of i)"scale"===n.cmd&&(n.args=[t,-t]),e[n.cmd].apply(e,n.args)}}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNodeJS=void 0;const i="object"===typeof process&&process+""==="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type);t.isNodeJS=i},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasGraphics=void 0;var n=i(1),r=i(6),a=i(12),s=i(13);const o=4096,l=16;class c{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let n;return void 0!==this.cache[e]?(n=this.cache[e],this.canvasFactory.reset(n,t,i)):(n=this.canvasFactory.create(t,i),this.cache[e]=n),n}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function h(e,t,i,n,a,s,o,l,c,h){const[d,u,p,f,m,g]=(0,r.getCurrentTransform)(e);if(0===u&&0===p){const r=o*d+m,v=Math.round(r),y=l*f+g,b=Math.round(y),x=(o+c)*d+m,w=Math.abs(Math.round(x)-v)||1,_=(l+h)*f+g,S=Math.abs(Math.round(_)-b)||1;return e.setTransform(Math.sign(d),0,0,Math.sign(f),v,b),e.drawImage(t,i,n,a,s,0,0,w,S),e.setTransform(d,u,p,f,m,g),[w,S]}if(0===d&&0===f){const r=l*p+m,v=Math.round(r),y=o*u+g,b=Math.round(y),x=(l+h)*p+m,w=Math.abs(Math.round(x)-v)||1,_=(o+c)*u+g,S=Math.abs(Math.round(_)-b)||1;return e.setTransform(0,Math.sign(u),Math.sign(p),0,v,b),e.drawImage(t,i,n,a,s,0,0,S,w),e.setTransform(d,u,p,f,m,g),[S,w]}return e.drawImage(t,i,n,a,s,o,l,c,h),[Math.hypot(d,u)*c,Math.hypot(p,f)*h]}class d{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,i){[t,i]=n.Util.applyTransform([t,i],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,i),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,i)}updateRectMinMax(e,t){const i=n.Util.applyTransform(t,e),r=n.Util.applyTransform(t.slice(2),e);this.minX=Math.min(this.minX,i[0],r[0]),this.minY=Math.min(this.minY,i[1],r[1]),this.maxX=Math.max(this.maxX,i[0],r[0]),this.maxY=Math.max(this.maxY,i[1],r[1])}updateScalingPathMinMax(e,t){n.Util.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.maxX=Math.max(this.maxX,t[1]),this.minY=Math.min(this.minY,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,i,r,a,s,o,l,c,h){const d=n.Util.bezierBoundingBox(t,i,r,a,s,o,l,c);if(h)return h[0]=Math.min(h[0],d[0],d[2]),h[1]=Math.max(h[1],d[0],d[2]),h[2]=Math.min(h[2],d[1],d[3]),void(h[3]=Math.max(h[3],d[1],d[3]));this.updateRectMinMax(e,d)}getPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.PathType.FILL,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=[this.minX,this.minY,this.maxX,this.maxY];if(e===a.PathType.STROKE){t||(0,n.unreachable)("Stroke bounding box must include transform.");const e=n.Util.singularValueDecompose2dScale(t),r=e[0]*this.lineWidth/2,a=e[1]*this.lineWidth/2;i[0]-=r,i[1]-=a,i[2]+=r,i[3]+=a}return i}updateClipFromPath(){const e=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.PathType.FILL,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return n.Util.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("undefined"!==typeof ImageData&&t instanceof ImageData)return void e.putImageData(t,0,0);const r=t.height,a=t.width,s=r%l,o=(r-s)/l,c=0===s?o:o+1,h=e.createImageData(a,l);let d,u=0;const p=t.data,f=h.data;let m,g,v,y,b,x,w,_;if(i)switch(i.length){case 1:b=i[0],x=i[0],w=i[0],_=i[0];break;case 4:b=i[0],x=i[1],w=i[2],_=i[3]}if(t.kind===n.ImageKind.GRAYSCALE_1BPP){const t=p.byteLength,i=new Uint32Array(f.buffer,0,f.byteLength>>2),r=i.length,y=a+7>>3;let b=4294967295,x=n.FeatureTest.isLittleEndian?4278190080:255;for(_&&255===_[0]&&0===_[255]&&([b,x]=[x,b]),m=0;m<c;m++){for(v=m<o?l:s,d=0,g=0;g<v;g++){const e=t-u;let n=0;const r=e>y?a:8*e-7,s=-8&r;let o=0,l=0;for(;n<s;n+=8)l=p[u++],i[d++]=128&l?b:x,i[d++]=64&l?b:x,i[d++]=32&l?b:x,i[d++]=16&l?b:x,i[d++]=8&l?b:x,i[d++]=4&l?b:x,i[d++]=2&l?b:x,i[d++]=1&l?b:x;for(;n<r;n++)0===o&&(l=p[u++],o=128),i[d++]=l&o?b:x,o>>=1}for(;d<r;)i[d++]=0;e.putImageData(h,0,m*l)}}else if(t.kind===n.ImageKind.RGBA_32BPP){const t=!!(b||x||w);for(g=0,y=a*l*4,m=0;m<o;m++){if(f.set(p.subarray(u,u+y)),u+=y,t)for(let e=0;e<y;e+=4)b&&(f[e+0]=b[f[e+0]]),x&&(f[e+1]=x[f[e+1]]),w&&(f[e+2]=w[f[e+2]]);e.putImageData(h,0,g),g+=l}if(m<c){if(y=a*s*4,f.set(p.subarray(u,u+y)),t)for(let e=0;e<y;e+=4)b&&(f[e+0]=b[f[e+0]]),x&&(f[e+1]=x[f[e+1]]),w&&(f[e+2]=w[f[e+2]]);e.putImageData(h,0,g)}}else{if(t.kind!==n.ImageKind.RGB_24BPP)throw new Error("bad image kind: ".concat(t.kind));{const t=!!(b||x||w);for(v=l,y=a*v,m=0;m<c;m++){for(m>=o&&(v=s,y=a*v),d=0,g=y;g--;)f[d++]=p[u++],f[d++]=p[u++],f[d++]=p[u++],f[d++]=255;if(t)for(let e=0;e<d;e+=4)b&&(f[e+0]=b[f[e+0]]),x&&(f[e+1]=x[f[e+1]]),w&&(f[e+2]=w[f[e+2]]);e.putImageData(h,0,m*l)}}}}function p(e,t){if(t.bitmap)return void e.drawImage(t.bitmap,0,0);const i=t.height,n=t.width,r=i%l,a=(i-r)/l,o=0===r?a:a+1,c=e.createImageData(n,l);let h=0;const d=t.data,u=c.data;for(let p=0;p<o;p++){const t=p<a?l:r;({srcPos:h}=(0,s.applyMaskImageData)({src:d,srcPos:h,dest:u,width:n,height:t})),e.putImageData(c,0,p*l)}}function f(e,t){const i=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(const n of i)void 0!==e[n]&&(t[n]=e[n]);void 0!==e.setLineDash&&(t.setLineDash(e.getLineDash()),t.lineDashOffset=e.lineDashOffset)}function m(e,t){e.strokeStyle=e.fillStyle=t||"#000000",e.fillRule="nonzero",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.globalCompositeOperation="source-over",e.font="10px sans-serif",void 0!==e.setLineDash&&(e.setLineDash([]),e.lineDashOffset=0)}function g(e,t,i,n){const r=e.length;for(let a=3;a<r;a+=4){const r=e[a];if(0===r)e[a-3]=t,e[a-2]=i,e[a-1]=n;else if(r<255){const s=255-r;e[a-3]=e[a-3]*r+t*s>>8,e[a-2]=e[a-2]*r+i*s>>8,e[a-1]=e[a-1]*r+n*s>>8}}}function v(e,t,i){const n=e.length,r=1/255;for(let a=3;a<n;a+=4){const n=i?i[e[a]]:e[a];t[a]=t[a]*n*r|0}}function y(e,t,i){const n=e.length;for(let r=3;r<n;r+=4){const n=77*e[r-3]+152*e[r-2]+28*e[r-1];t[r]=i?t[r]*i[n>>8]>>8:t[r]*n>>16}}function b(e,t,i,n){const r=n[0],a=n[1],s=n[2]-r,o=n[3]-a;0!==s&&0!==o&&(function(e,t,i,n,r,a,s,o,l,c,h){const d=!!a,u=d?a[0]:0,p=d?a[1]:0,f=d?a[2]:0;let m;m="Luminosity"===r?y:v;const b=Math.min(n,Math.ceil(1048576/i));for(let v=0;v<n;v+=b){const r=Math.min(b,n-v),a=e.getImageData(o-c,v+(l-h),i,r),y=t.getImageData(o,v+l,i,r);d&&g(a.data,u,p,f),m(a.data,y.data,s),t.putImageData(y,o,v+l)}}(t.context,i,s,o,t.subtype,t.backdrop,t.transferMap,r,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}function x(e,t){const i=n.Util.singularValueDecompose2dScale(e);i[0]=Math.fround(i[0]),i[1]=Math.fround(i[1]);const a=Math.fround((globalThis.devicePixelRatio||1)*r.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==t?t:i[0]<=a||i[1]<=a}const w=["butt","round","square"],_=["miter","round","bevel"],S={},A={};var E=new WeakSet;class C{constructor(e,t,i,n,r,a,s){let{optionalContentConfig:o,markedContentStack:l=null}=r;_classPrivateMethodInitSpec(this,E),this.ctx=e,this.current=new d(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new c(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=a,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=(null===s||void 0===s?void 0:s.background)||null,this.foregroundColor=(null===s||void 0===s?void 0:s.foreground)||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing(e){let{transform:t,viewport:i,transparency:n=!1,background:a=null}=e;const s=this.ctx.canvas.width,o=this.ctx.canvas.height,l=a||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;const e=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;const t=this.backgroundColor=this.ctx.fillStyle;let i=!0,n=l;if(this.ctx.fillStyle=l,n=this.ctx.fillStyle,i="string"===typeof n&&/^#[0-9A-Fa-f]{6}$/.test(n),"#000000"===e&&"#ffffff"===t||e===t||!i)this.foregroundColor=this.backgroundColor=null;else{const[i,a,s]=(0,r.getRGB)(n),o=e=>(e/=255)<=.03928?e/12.92:((e+.055)/1.055)**2.4,l=Math.round(.2126*o(i)+.7152*o(a)+.0722*o(s));this.selectColor=(i,n,r)=>{const a=.2126*o(i)+.7152*o(n)+.0722*o(r);return Math.round(a)===l?t:e}}}if(this.ctx.fillStyle=this.backgroundColor||l,this.ctx.fillRect(0,0,s,o),this.ctx.restore(),n){const e=this.cachedCanvases.getCanvas("transparent",s,o);this.compositeCtx=this.ctx,this.transparentCanvas=e.canvas,this.ctx=e.context,this.ctx.save(),this.ctx.transform(...(0,r.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),m(this.ctx,this.foregroundColor),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...i.transform),this.viewportScale=i.scale,this.baseTransform=(0,r.getCurrentTransform)(this.ctx)}executeOperatorList(e,t,i,r){const a=e.argsArray,s=e.fnArray;let o=t||0;const l=a.length;if(l===o)return o;const c=l-o>10&&"function"===typeof i,h=c?Date.now()+15:0;let d=0;const u=this.commonObjs,p=this.objs;let f;for(;;){if(void 0!==r&&o===r.nextBreakPoint)return r.breakIt(o,i),o;if(f=s[o],f!==n.OPS.dependency)this[f].apply(this,a[o]);else for(const e of a[o]){const t=e.startsWith("g_")?u:p;if(!t.has(e))return t.get(e,i),o}if(o++,o===l)return o;if(c&&++d>10){if(Date.now()>h)return i(),o;d=0}}}endDrawing(){_assertClassBrand(E,this,M).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())"undefined"!==typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear()}_scaleImage(e,t){const i=e.width,n=e.height;let r,a,s=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=i,c=n,h="prescale1";for(;s>2&&l>1||o>2&&c>1;){let t=l,i=c;s>2&&l>1&&(t=Math.ceil(l/2),s/=l/t),o>2&&c>1&&(i=Math.ceil(c/2),o/=c/i),r=this.cachedCanvases.getCanvas(h,t,i),a=r.context,a.clearRect(0,0,t,i),a.drawImage(e,0,0,l,c,0,0,t,i),e=r.canvas,l=t,c=i,h="prescale1"===h?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:s}=e,o=this.current.fillColor,l=this.current.patternFill,c=(0,r.getCurrentTransform)(t);let d,u,f,m;if((e.bitmap||e.data)&&e.count>1){const t=e.bitmap||e.data.buffer;u=JSON.stringify(l?c:[c.slice(0,4),o]),d=this._cachedBitmapsMap.get(t),d||(d=new Map,this._cachedBitmapsMap.set(t,d));const i=d.get(u);if(i&&!l)return{canvas:i,offsetX:Math.round(Math.min(c[0],c[2])+c[4]),offsetY:Math.round(Math.min(c[1],c[3])+c[5])};f=i}f||(m=this.cachedCanvases.getCanvas("maskCanvas",i,s),p(m.context,e));let g=n.Util.transform(c,[1/i,0,0,-1/s,0,0]);g=n.Util.transform(g,[1,0,0,1,0,-s]);const v=n.Util.applyTransform([0,0],g),y=n.Util.applyTransform([i,s],g),b=n.Util.normalizeRect([v[0],v[1],y[0],y[1]]),w=Math.round(b[2]-b[0])||1,_=Math.round(b[3]-b[1])||1,S=this.cachedCanvases.getCanvas("fillCanvas",w,_),A=S.context,E=Math.min(v[0],y[0]),C=Math.min(v[1],y[1]);A.translate(-E,-C),A.transform(...g),f||(f=this._scaleImage(m.canvas,(0,r.getCurrentTransformInverse)(A)),f=f.img,d&&l&&d.set(u,f)),A.imageSmoothingEnabled=x((0,r.getCurrentTransform)(A),e.interpolate),h(A,f,0,0,f.width,f.height,0,0,i,s),A.globalCompositeOperation="source-in";const M=n.Util.transform((0,r.getCurrentTransformInverse)(A),[1,0,0,1,-E,-C]);return A.fillStyle=l?o.getPattern(t,this,M,a.PathType.FILL):o,A.fillRect(0,0,i,s),d&&!l&&(this.cachedCanvases.delete("fillCanvas"),d.set(u,S.canvas)),{canvas:S.canvas,offsetX:Math.round(E),offsetY:Math.round(C)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=w[e]}setLineJoin(e){this.ctx.lineJoin=_[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;void 0!==i.setLineDash&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.current.fillAlpha=i,this.ctx.globalAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=i}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx,this.ctx=n.context;const a=this.ctx;a.setTransform(...(0,r.getCurrentTransform)(this.suspendedCtx)),f(this.suspendedCtx,a),function(e,t){if(e._removeMirroring)throw new Error("Context is already forwarding operations.");e.__originalSave=e.save,e.__originalRestore=e.restore,e.__originalRotate=e.rotate,e.__originalScale=e.scale,e.__originalTranslate=e.translate,e.__originalTransform=e.transform,e.__originalSetTransform=e.setTransform,e.__originalResetTransform=e.resetTransform,e.__originalClip=e.clip,e.__originalMoveTo=e.moveTo,e.__originalLineTo=e.lineTo,e.__originalBezierCurveTo=e.bezierCurveTo,e.__originalRect=e.rect,e.__originalClosePath=e.closePath,e.__originalBeginPath=e.beginPath,e._removeMirroring=()=>{e.save=e.__originalSave,e.restore=e.__originalRestore,e.rotate=e.__originalRotate,e.scale=e.__originalScale,e.translate=e.__originalTranslate,e.transform=e.__originalTransform,e.setTransform=e.__originalSetTransform,e.resetTransform=e.__originalResetTransform,e.clip=e.__originalClip,e.moveTo=e.__originalMoveTo,e.lineTo=e.__originalLineTo,e.bezierCurveTo=e.__originalBezierCurveTo,e.rect=e.__originalRect,e.closePath=e.__originalClosePath,e.beginPath=e.__originalBeginPath,delete e._removeMirroring},e.save=function(){t.save(),this.__originalSave()},e.restore=function(){t.restore(),this.__originalRestore()},e.translate=function(e,i){t.translate(e,i),this.__originalTranslate(e,i)},e.scale=function(e,i){t.scale(e,i),this.__originalScale(e,i)},e.transform=function(e,i,n,r,a,s){t.transform(e,i,n,r,a,s),this.__originalTransform(e,i,n,r,a,s)},e.setTransform=function(e,i,n,r,a,s){t.setTransform(e,i,n,r,a,s),this.__originalSetTransform(e,i,n,r,a,s)},e.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},e.rotate=function(e){t.rotate(e),this.__originalRotate(e)},e.clip=function(e){t.clip(e),this.__originalClip(e)},e.moveTo=function(e,i){t.moveTo(e,i),this.__originalMoveTo(e,i)},e.lineTo=function(e,i){t.lineTo(e,i),this.__originalLineTo(e,i)},e.bezierCurveTo=function(e,i,n,r,a,s){t.bezierCurveTo(e,i,n,r,a,s),this.__originalBezierCurveTo(e,i,n,r,a,s)},e.rect=function(e,i,n,r){t.rect(e,i,n,r),this.__originalRect(e,i,n,r)},e.closePath=function(){t.closePath(),this.__originalClosePath()},e.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),f(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask;b(this.suspendedCtx,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(f(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),f(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(e,t,i,n,r,a){this.ctx.transform(e,t,i,n,r,a),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){const a=this.ctx,s=this.current;let o,l,c=s.x,h=s.y;const d=(0,r.getCurrentTransform)(a),u=0===d[0]&&0===d[3]||0===d[1]&&0===d[2],p=u?i.slice(0):null;for(let r=0,f=0,m=e.length;r<m;r++)switch(0|e[r]){case n.OPS.rectangle:c=t[f++],h=t[f++];const e=t[f++],i=t[f++],r=c+e,m=h+i;a.moveTo(c,h),0===e||0===i?a.lineTo(r,m):(a.lineTo(r,h),a.lineTo(r,m),a.lineTo(c,m)),u||s.updateRectMinMax(d,[c,h,r,m]),a.closePath();break;case n.OPS.moveTo:c=t[f++],h=t[f++],a.moveTo(c,h),u||s.updatePathMinMax(d,c,h);break;case n.OPS.lineTo:c=t[f++],h=t[f++],a.lineTo(c,h),u||s.updatePathMinMax(d,c,h);break;case n.OPS.curveTo:o=c,l=h,c=t[f+4],h=t[f+5],a.bezierCurveTo(t[f],t[f+1],t[f+2],t[f+3],c,h),s.updateCurvePathMinMax(d,o,l,t[f],t[f+1],t[f+2],t[f+3],c,h,p),f+=6;break;case n.OPS.curveTo2:o=c,l=h,a.bezierCurveTo(c,h,t[f],t[f+1],t[f+2],t[f+3]),s.updateCurvePathMinMax(d,o,l,c,h,t[f],t[f+1],t[f+2],t[f+3],p),c=t[f+2],h=t[f+3],f+=4;break;case n.OPS.curveTo3:o=c,l=h,c=t[f+2],h=t[f+3],a.bezierCurveTo(t[f],t[f+1],c,h,c,h),s.updateCurvePathMinMax(d,o,l,t[f],t[f+1],c,h,c,h,p),f+=4;break;case n.OPS.closePath:a.closePath()}u&&s.updateScalingPathMinMax(d,p),s.setCurrentPoint(c,h)}closePath(){this.ctx.closePath()}stroke(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.ctx,i=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"===typeof i&&null!==i&&void 0!==i&&i.getPattern?(t.save(),t.strokeStyle=i.getPattern(t,this,(0,r.getCurrentTransformInverse)(t),a.PathType.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.ctx,i=this.current.fillColor;let n=!1;this.current.patternFill&&(t.save(),t.fillStyle=i.getPattern(t,this,(0,r.getCurrentTransformInverse)(t),a.PathType.FILL),n=!0);const s=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==s&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),n&&t.restore(),e&&this.consumePath(s)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=S}eoClip(){this.pendingClip=A}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(void 0!==e){t.save(),t.beginPath();for(const i of e)t.setTransform(...i.transform),t.translate(i.x,i.y),i.addToPath(t,i.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}else t.beginPath()}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const i=this.commonObjs.get(e),r=this.current;if(!i)throw new Error("Can't find font for ".concat(e));if(r.fontMatrix=i.fontMatrix||n.FONT_IDENTITY_MATRIX,0!==r.fontMatrix[0]&&0!==r.fontMatrix[3]||(0,n.warn)("Invalid font matrix for font "+e),t<0?(t=-t,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const a=i.loadedName||"sans-serif";let s="normal";i.black?s="900":i.bold&&(s="bold");const o=i.italic?"italic":"normal",l='"'.concat(a,'", ').concat(i.fallbackName);let c=t;t<16?c=16:t>100&&(c=100),this.current.fontSizeScale=t/c,this.ctx.font="".concat(o," ").concat(s," ").concat(c,"px ").concat(l)}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,i,n,r,a){this.current.textMatrix=[e,t,i,n,r,a],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,i,a){const s=this.ctx,o=this.current,l=o.font,c=o.textRenderingMode,h=o.fontSize/o.fontSizeScale,d=c&n.TextRenderingMode.FILL_STROKE_MASK,u=!!(c&n.TextRenderingMode.ADD_TO_PATH_FLAG),p=o.patternFill&&!l.missingFile;let f;(l.disableFontFace||u||p)&&(f=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||p?(s.save(),s.translate(t,i),s.beginPath(),f(s,h),a&&s.setTransform(...a),d!==n.TextRenderingMode.FILL&&d!==n.TextRenderingMode.FILL_STROKE||s.fill(),d!==n.TextRenderingMode.STROKE&&d!==n.TextRenderingMode.FILL_STROKE||s.stroke(),s.restore()):(d!==n.TextRenderingMode.FILL&&d!==n.TextRenderingMode.FILL_STROKE||s.fillText(e,t,i),d!==n.TextRenderingMode.STROKE&&d!==n.TextRenderingMode.FILL_STROKE||s.strokeText(e,t,i)),u&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,r.getCurrentTransform)(s),x:t,y:i,fontSize:h,addToPath:f})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let n=3;n<t.length;n+=4)if(t[n]>0&&t[n]<255){i=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(0===s)return;const o=this.ctx,l=t.fontSizeScale,c=t.charSpacing,h=t.wordSpacing,d=t.fontDirection,u=t.textHScale*d,p=e.length,f=i.vertical,m=f?1:-1,g=i.defaultVMetrics,v=s*t.fontMatrix[0],y=t.textRenderingMode===n.TextRenderingMode.FILL&&!i.disableFontFace&&!t.patternFill;let b;if(o.save(),o.transform(...t.textMatrix),o.translate(t.x,t.y+t.textRise),d>0?o.scale(u,-1):o.scale(u,1),t.patternFill){o.save();const e=t.fillColor.getPattern(o,this,(0,r.getCurrentTransformInverse)(o),a.PathType.FILL);b=(0,r.getCurrentTransform)(o),o.restore(),o.fillStyle=e}let x=t.lineWidth;const w=t.textMatrixScale;if(0===w||0===x){const e=t.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;e!==n.TextRenderingMode.STROKE&&e!==n.TextRenderingMode.FILL_STROKE||(x=this.getSinglePixelWidth())}else x/=w;if(1!==l&&(o.scale(l,l),x/=l),o.lineWidth=x,i.isInvalidPDFjsFont){const i=[];let n=0;for(const t of e)i.push(t.unicode),n+=t.width;return o.fillText(i.join(""),0,0),t.x+=n*v*u,o.restore(),void this.compose()}let _,S=0;for(_=0;_<p;++_){const t=e[_];if("number"===typeof t){S+=m*t*s/1e3;continue}let n=!1;const r=(t.isSpace?h:0)+c,a=t.fontChar,u=t.accent;let p,x,w,A=t.width;if(f){const e=t.vmetric||g,i=-(t.vmetric?e[1]:.5*A)*v,n=e[2]*v;A=e?-e[0]:A,p=i/l,x=(S+n)/l}else p=S/l,x=0;if(i.remeasure&&A>0){const e=1e3*o.measureText(a).width/s*l;if(A<e&&this.isFontSubpixelAAEnabled){const t=A/e;n=!0,o.save(),o.scale(t,1),p/=t}else A!==e&&(p+=(A-e)/2e3*s/l)}if(this.contentVisible&&(t.isInFont||i.missingFile))if(y&&!u)o.fillText(a,p,x);else if(this.paintChar(a,p,x,b),u){const e=p+s*u.offset.x/l,t=x-s*u.offset.y/l;this.paintChar(u.fontChar,e,t,b)}w=f?A*v-r*d:A*v+r*d,S+=w,n&&o.restore()}f?t.y-=S:t.x+=S*u,o.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,r=i.font,a=i.fontSize,s=i.fontDirection,o=r.vertical?1:-1,l=i.charSpacing,c=i.wordSpacing,h=i.textHScale*s,d=i.fontMatrix||n.FONT_IDENTITY_MATRIX,u=e.length;let p,f,m,g;if(i.textRenderingMode!==n.TextRenderingMode.INVISIBLE&&0!==a){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...i.textMatrix),t.translate(i.x,i.y),t.scale(h,s),p=0;p<u;++p){if(f=e[p],"number"===typeof f){g=o*f*a/1e3,this.ctx.translate(g,0),i.x+=g*h;continue}const s=(f.isSpace?c:0)+l,u=r.charProcOperatorList[f.operatorListId];u?(this.contentVisible&&(this.processingType3=f,this.save(),t.scale(a,a),t.transform(...d),this.executeOperatorList(u),this.restore()),m=n.Util.applyTransform([f.width,0],d)[0]*a+s,t.translate(m,0),i.x+=m*h):(0,n.warn)('Type3 character "'.concat(f.operatorListId,'" is not available.'))}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,n,r,a){this.ctx.rect(i,n,r-i,a-n),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if("TilingPattern"===e[0]){const i=e[1],n=this.baseTransform||(0,r.getCurrentTransform)(this.ctx),s={createCanvasGraphics:e=>new C(e,this.commonObjs,this.objs,this.canvasFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new a.TilingPattern(e,i,this.ctx,s,n)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,i){var r;const a=(null===(r=this.selectColor)||void 0===r?void 0:r.call(this,e,t,i))||n.Util.makeHexColor(e,t,i);this.ctx.strokeStyle=a,this.current.strokeColor=a}setFillRGBColor(e,t,i){var r;const a=(null===(r=this.selectColor)||void 0===r?void 0:r.call(this,e,t,i))||n.Util.makeHexColor(e,t,i);this.ctx.fillStyle=a,this.current.fillColor=a,this.current.patternFill=!1}_getPattern(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(e)?t=this.cachedPatterns.get(e):(t=(0,a.getShadingPattern)(this.objs.get(e)),this.cachedPatterns.set(e,t)),i&&(t.matrix=i),t}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,(0,r.getCurrentTransformInverse)(t),a.PathType.SHADING);const s=(0,r.getCurrentTransformInverse)(t);if(s){const e=t.canvas,i=e.width,r=e.height,a=n.Util.applyTransform([0,0],s),o=n.Util.applyTransform([0,r],s),l=n.Util.applyTransform([i,0],s),c=n.Util.applyTransform([i,r],s),h=Math.min(a[0],o[0],l[0],c[0]),d=Math.min(a[1],o[1],l[1],c[1]),u=Math.max(a[0],o[0],l[0],c[0]),p=Math.max(a[1],o[1],l[1],c[1]);this.ctx.fillRect(h,d,u-h,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(e)&&6===e.length&&this.transform(...e),this.baseTransform=(0,r.getCurrentTransform)(this.ctx),t)){const e=t[2]-t[0],i=t[3]-t[1];this.ctx.rect(t[0],t[1],e,i),this.current.updateRectMinMax((0,r.getCurrentTransform)(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||(0,n.info)("TODO: Support non-isolated groups."),e.knockout&&(0,n.warn)("Knockout groups not supported.");const i=(0,r.getCurrentTransform)(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let a=n.Util.getAxialAlignedBoundingBox(e.bbox,(0,r.getCurrentTransform)(t));const s=[0,0,t.canvas.width,t.canvas.height];a=n.Util.intersect(a,s)||[0,0,0,0];const l=Math.floor(a[0]),c=Math.floor(a[1]);let h=Math.max(Math.ceil(a[2])-l,1),d=Math.max(Math.ceil(a[3])-c,1),u=1,p=1;h>o&&(u=h/o,h=o),d>o&&(p=d/o,d=o),this.current.startNewPathAndClipBox([0,0,h,d]);let m="groupAt"+this.groupLevel;e.smask&&(m+="_smask_"+this.smaskCounter++%2);const g=this.cachedCanvases.getCanvas(m,h,d),v=g.context;v.scale(1/u,1/p),v.translate(-l,-c),v.transform(...i),e.smask?this.smaskStack.push({canvas:g.canvas,context:v,offsetX:l,offsetY:c,scaleX:u,scaleY:p,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(l,c),t.scale(u,p),t.save()),f(t,v),this.ctx=v,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const e=(0,r.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...e);const i=n.Util.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],e);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(i)}}beginAnnotation(e,t,i,a,s){if(_assertClassBrand(E,this,M).call(this),m(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(t)&&4===t.length){const a=t[2]-t[0],o=t[3]-t[1];if(s&&this.annotationCanvasMap){(i=i.slice())[4]-=t[0],i[5]-=t[1],(t=t.slice())[0]=t[1]=0,t[2]=a,t[3]=o;const[s,l]=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(this.ctx)),{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),d=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.setTransform(s,0,0,-l,0,o*l),m(this.ctx,this.foregroundColor)}else m(this.ctx,this.foregroundColor),this.ctx.rect(t[0],t[1],a,o),this.ctx.clip(),this.endPath()}this.current=new d(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...a)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;(e=this.getObject(e.data,e)).count=t;const i=this.ctx,n=this.processingType3;if(n&&(void 0===n.compiled&&(n.compiled=function(e){const{width:t,height:i}=e;if(t>1e3||i>1e3)return null;const n=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),r=t+1;let a,s,o,l=new Uint8Array(r*(i+1));const c=t+7&-8;let h=new Uint8Array(c*i),d=0;for(const m of e.data){let e=128;for(;e>0;)h[d++]=m&e?0:255,e>>=1}let u=0;for(d=0,0!==h[d]&&(l[0]=1,++u),s=1;s<t;s++)h[d]!==h[d+1]&&(l[s]=h[d]?2:1,++u),d++;for(0!==h[d]&&(l[s]=2,++u),a=1;a<i;a++){d=a*c,o=a*r,h[d-c]!==h[d]&&(l[o]=h[d]?1:8,++u);let e=(h[d]?4:0)+(h[d-c]?8:0);for(s=1;s<t;s++)e=(e>>2)+(h[d+1]?4:0)+(h[d-c+1]?8:0),n[e]&&(l[o+s]=n[e],++u),d++;if(h[d-c]!==h[d]&&(l[o+s]=h[d]?2:4,++u),u>1e3)return null}for(d=c*(i-1),o=a*r,0!==h[d]&&(l[o]=8,++u),s=1;s<t;s++)h[d]!==h[d+1]&&(l[o+s]=h[d]?4:8,++u),d++;if(0!==h[d]&&(l[o+s]=4,++u),u>1e3)return null;const p=new Int32Array([0,r,-1,0,-r,0,0,0,1]),f=new Path2D;for(a=0;u&&a<=i;a++){let e=a*r;const i=e+t;for(;e<i&&!l[e];)e++;if(e===i)continue;f.moveTo(e%r,a);const n=e;let s=l[e];do{const t=p[s];do{e+=t}while(!l[e]);const i=l[e];5!==i&&10!==i?(s=i,l[e]=0):(s=i&51*s>>4,l[e]&=s>>2|s<<2),f.lineTo(e%r,e/r|0),l[e]||--u}while(n!==e);--a}return h=null,l=null,function(e){e.save(),e.scale(1/t,-1/i),e.translate(0,-i),e.fill(f),e.beginPath(),e.restore()}}(e)),n.compiled))return void n.compiled(i);const r=this._createMaskCanvas(e),a=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(a,r.offsetX,r.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0;if(!this.contentVisible)return;e=this.getObject(e.data,e);const l=this.ctx;l.save();const c=(0,r.getCurrentTransform)(l);l.transform(t,i,a,s,0,0);const h=this._createMaskCanvas(e);l.setTransform(1,0,0,1,h.offsetX-c[4],h.offsetY-c[5]);for(let r=0,d=o.length;r<d;r+=2){const e=n.Util.transform(c,[t,i,a,s,o[r],o[r+1]]),[d,u]=n.Util.applyTransform([0,0],e);l.drawImage(h.canvas,d,u)}l.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,n=this.current.patternFill;for(const s of e){const{data:e,width:o,height:l,transform:c}=s,d=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=d.context;u.save(),p(u,this.getObject(e,s)),u.globalCompositeOperation="source-in",u.fillStyle=n?i.getPattern(u,this,(0,r.getCurrentTransformInverse)(t),a.PathType.FILL):i,u.fillRect(0,0,o,l),u.restore(),t.save(),t.transform(...c),t.scale(1,-1),h(t,d.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,n.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(e,t,i,r){if(!this.contentVisible)return;const a=this.getObject(e);if(!a)return void(0,n.warn)("Dependent image isn't ready yet");const s=a.width,o=a.height,l=[];for(let n=0,c=r.length;n<c;n+=2)l.push({transform:[t,0,0,i,r[n],r[n+1]],x:0,y:0,w:s,h:o});this.paintInlineImageXObjectGroup(a,l)}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,n=this.ctx;let a;if(this.save(),n.scale(1/t,-1/i),"function"===typeof HTMLElement&&e instanceof HTMLElement||!e.data)a=e;else{const n=this.cachedCanvases.getCanvas("inlineImage",t,i);u(n.context,e,this.current.transferMaps),a=n.canvas}const s=this._scaleImage(a,(0,r.getCurrentTransformInverse)(n));n.imageSmoothingEnabled=x((0,r.getCurrentTransform)(n),e.interpolate),h(n,s.img,0,0,s.paintWidth,s.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx,n=e.width,r=e.height,a=this.cachedCanvases.getCanvas("inlineImage",n,r);u(a.context,e,this.current.transferMaps);for(const s of t)i.save(),i.transform(...s.transform),i.scale(1,-1),h(i,a.canvas,s.x,s.y,s.w,s.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){"OC"===e?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(t||(this.pendingClip===A?i.clip("evenodd"):i.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),i.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=(0,r.getCurrentTransform)(this.ctx);if(0===e[1]&&0===e[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),n=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,n)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:e}=this.current,t=(0,r.getCurrentTransform)(this.ctx);let i,n;if(0===t[1]&&0===t[2]){const r=Math.abs(t[0]),a=Math.abs(t[3]);if(0===e)i=1/r,n=1/a;else{const t=r*e,s=a*e;i=t<1?1/t:1,n=s<1?1/s:1}}else{const r=Math.abs(t[0]*t[3]-t[2]*t[1]),a=Math.hypot(t[0],t[1]),s=Math.hypot(t[2],t[3]);if(0===e)i=s/r,n=a/r;else{const t=e*r;i=s>t?s/t:1,n=a>t?a/t:1}}this._cachedScaleForStroking=[i,n]}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:i}=this.current,[n,a]=this.getScaleForStroking();if(t.lineWidth=i||1,1===n&&1===a)return void t.stroke();let s,o,l;e&&(s=(0,r.getCurrentTransform)(t),o=t.getLineDash().slice(),l=t.lineDashOffset),t.scale(n,a);const c=Math.max(n,a);t.setLineDash(t.getLineDash().map((e=>e/c))),t.lineDashOffset/=c,t.stroke(),e&&(t.setTransform(...s),t.setLineDash(o),t.lineDashOffset=l)}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}function M(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}t.CanvasGraphics=C;for(const P in n.OPS)void 0!==C.prototype[P]&&(C.prototype[n.OPS[P]]=C.prototype[P])},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TilingPattern=t.PathType=void 0,t.getShadingPattern=function(e){switch(e[0]){case"RadialAxial":return new l(e);case"Mesh":return new d(e);case"Dummy":return new u}throw new Error("Unknown IR type: ".concat(e[0]))};var n=i(1),r=i(6);const a={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function s(e,t){if(!t)return;const i=t[2]-t[0],n=t[3]-t[1],r=new Path2D;r.rect(t[0],t[1],i,n),e.clip(r)}t.PathType=a;class o{constructor(){this.constructor===o&&(0,n.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,n.unreachable)("Abstract method `getPattern` called.")}}class l extends o{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;"axial"===this._type?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,o){let l;if(o===a.STROKE||o===a.FILL){const a=t.current.getClippedPathBoundingBox(o,(0,r.getCurrentTransform)(e))||[0,0,0,0],c=Math.ceil(a[2]-a[0])||1,h=Math.ceil(a[3]-a[1])||1,d=t.cachedCanvases.getCanvas("pattern",c,h,!0),u=d.context;u.clearRect(0,0,u.canvas.width,u.canvas.height),u.beginPath(),u.rect(0,0,u.canvas.width,u.canvas.height),u.translate(-a[0],-a[1]),i=n.Util.transform(i,[1,0,0,1,a[0],a[1]]),u.transform(...t.baseTransform),this.matrix&&u.transform(...this.matrix),s(u,this._bbox),u.fillStyle=this._createGradient(u),u.fill(),l=e.createPattern(d.canvas,"no-repeat");const p=new DOMMatrix(i);l.setTransform(p)}else s(e,this._bbox),l=this._createGradient(e);return l}}function c(e,t,i,n,r,a,s,o){const l=t.coords,c=t.colors,h=e.data,d=4*e.width;let u;l[i+1]>l[n+1]&&(u=i,i=n,n=u,u=a,a=s,s=u),l[n+1]>l[r+1]&&(u=n,n=r,r=u,u=s,s=o,o=u),l[i+1]>l[n+1]&&(u=i,i=n,n=u,u=a,a=s,s=u);const p=(l[i]+t.offsetX)*t.scaleX,f=(l[i+1]+t.offsetY)*t.scaleY,m=(l[n]+t.offsetX)*t.scaleX,g=(l[n+1]+t.offsetY)*t.scaleY,v=(l[r]+t.offsetX)*t.scaleX,y=(l[r+1]+t.offsetY)*t.scaleY;if(f>=y)return;const b=c[a],x=c[a+1],w=c[a+2],_=c[s],S=c[s+1],A=c[s+2],E=c[o],C=c[o+1],M=c[o+2],P=Math.round(f),T=Math.round(y);let D,R,O,I,k,L,F,B;for(let N=P;N<=T;N++){if(N<g){let e;e=N<f?0:(f-N)/(f-g),D=p-(p-m)*e,R=b-(b-_)*e,O=x-(x-S)*e,I=w-(w-A)*e}else{let e;e=N>y?1:g===y?0:(g-N)/(g-y),D=m-(m-v)*e,R=_-(_-E)*e,O=S-(S-C)*e,I=A-(A-M)*e}let e;e=N<f?0:N>y?1:(f-N)/(f-y),k=p-(p-v)*e,L=b-(b-E)*e,F=x-(x-C)*e,B=w-(w-M)*e;const t=Math.round(Math.min(D,k)),i=Math.round(Math.max(D,k));let n=d*N+4*t;for(let r=t;r<=i;r++)e=(D-r)/(D-k),e<0?e=0:e>1&&(e=1),h[n++]=R-(R-L)*e|0,h[n++]=O-(O-F)*e|0,h[n++]=I-(I-B)*e|0,h[n++]=255}}function h(e,t,i){const n=t.coords,r=t.colors;let a,s;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(n.length/o)-1,h=o-1;for(a=0;a<l;a++){let t=a*o;for(let a=0;a<h;a++,t++)c(e,i,n[t],n[t+1],n[t+o],r[t],r[t+1],r[t+o]),c(e,i,n[t+o+1],n[t+1],n[t+o],r[t+o+1],r[t+1],r[t+o])}break;case"triangles":for(a=0,s=n.length;a<s;a+=3)c(e,i,n[a],n[a+1],n[a+2],r[a],r[a+1],r[a+2]);break;default:throw new Error("illegal figure")}}class d extends o{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,i){const n=Math.floor(this._bounds[0]),r=Math.floor(this._bounds[1]),a=Math.ceil(this._bounds[2])-n,s=Math.ceil(this._bounds[3])-r,o=Math.min(Math.ceil(Math.abs(a*e[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*e[1]*1.1)),3e3),c=a/o,d=s/l,u={coords:this._coords,colors:this._colors,offsetX:-n,offsetY:-r,scaleX:1/c,scaleY:1/d},p=o+4,f=l+4,m=i.getCanvas("mesh",p,f,!1),g=m.context,v=g.createImageData(o,l);if(t){const e=v.data;for(let i=0,n=e.length;i<n;i+=4)e[i]=t[0],e[i+1]=t[1],e[i+2]=t[2],e[i+3]=255}for(const y of this._figures)h(v,y,u);return g.putImageData(v,2,2),{canvas:m.canvas,offsetX:n-2*c,offsetY:r-2*d,scaleX:c,scaleY:d}}getPattern(e,t,i,o){let l;if(s(e,this._bbox),o===a.SHADING)l=n.Util.singularValueDecompose2dScale((0,r.getCurrentTransform)(e));else if(l=n.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){const e=n.Util.singularValueDecompose2dScale(this.matrix);l=[l[0]*e[0],l[1]*e[1]]}const c=this._createMeshCanvas(l,o===a.SHADING?null:this._background,t.cachedCanvases);return o!==a.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(c.offsetX,c.offsetY),e.scale(c.scaleX,c.scaleY),e.createPattern(c.canvas,"no-repeat")}}class u extends o{getPattern(){return"hotpink"}}const p=1,f=2;class m{static get MAX_PATTERN_SIZE(){return(0,n.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(e,t,i,n,r){this.operatorList=e[2],this.matrix=e[3]||[1,0,0,1,0,0],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=i,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e){const t=this.operatorList,i=this.bbox,a=this.xstep,s=this.ystep,o=this.paintType,l=this.tilingType,c=this.color,h=this.canvasGraphicsFactory;(0,n.info)("TilingType: "+l);const d=i[0],u=i[1],p=i[2],f=i[3],m=n.Util.singularValueDecompose2dScale(this.matrix),g=n.Util.singularValueDecompose2dScale(this.baseTransform),v=[m[0]*g[0],m[1]*g[1]],y=this.getSizeAndScale(a,this.ctx.canvas.width,v[0]),b=this.getSizeAndScale(s,this.ctx.canvas.height,v[1]),x=e.cachedCanvases.getCanvas("pattern",y.size,b.size,!0),w=x.context,_=h.createCanvasGraphics(w);_.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(_,o,c);let S=d,A=u,E=p,C=f;return d<0&&(S=0,E+=Math.abs(d)),u<0&&(A=0,C+=Math.abs(u)),w.translate(-y.scale*S,-b.scale*A),_.transform(y.scale,0,0,b.scale,0,0),w.save(),this.clipBbox(_,S,A,E,C),_.baseTransform=(0,r.getCurrentTransform)(_.ctx),_.executeOperatorList(t),_.endDrawing(),{canvas:x.canvas,scaleX:y.scale,scaleY:b.scale,offsetX:S,offsetY:A}}getSizeAndScale(e,t,i){e=Math.abs(e);const n=Math.max(m.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*i);return r>=n?r=n:i=r/e,{scale:i,size:r}}clipBbox(e,t,i,n,a){const s=n-t,o=a-i;e.ctx.rect(t,i,s,o),e.current.updateRectMinMax((0,r.getCurrentTransform)(e.ctx),[t,i,n,a]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const r=e.ctx,a=e.current;switch(t){case p:const e=this.ctx;r.fillStyle=e.fillStyle,r.strokeStyle=e.strokeStyle,a.fillColor=e.fillStyle,a.strokeColor=e.strokeStyle;break;case f:const s=n.Util.makeHexColor(i[0],i[1],i[2]);r.fillStyle=s,r.strokeStyle=s,a.fillColor=s,a.strokeColor=s;break;default:throw new n.FormatError("Unsupported paint type: ".concat(t))}}getPattern(e,t,i,r){let s=i;r!==a.SHADING&&(s=n.Util.transform(s,t.baseTransform),this.matrix&&(s=n.Util.transform(s,this.matrix)));const o=this.createPatternCanvas(t);let l=new DOMMatrix(s);l=l.translate(o.offsetX,o.offsetY),l=l.scale(1/o.scaleX,1/o.scaleY);const c=e.createPattern(o.canvas,"repeat");return c.setTransform(l),c}}t.TilingPattern=m},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyMaskImageData=function(e){let{src:t,srcPos:i=0,dest:r,destPos:a=0,width:s,height:o,inverseDecode:l=!1}=e;const c=n.FeatureTest.isLittleEndian?4278190080:255,[h,d]=l?[0,c]:[c,0],u=s>>3,p=7&s,f=t.length;r=new Uint32Array(r.buffer);for(let n=0;n<o;n++){for(const n=i+u;i<n;i++){const e=i<f?t[i]:255;r[a++]=128&e?d:h,r[a++]=64&e?d:h,r[a++]=32&e?d:h,r[a++]=16&e?d:h,r[a++]=8&e?d:h,r[a++]=4&e?d:h,r[a++]=2&e?d:h,r[a++]=1&e?d:h}if(0===p)continue;const e=i<f?t[i++]:255;for(let t=0;t<p;t++)r[a++]=e&1<<7-t?d:h}return{srcPos:i,destPos:a}};var n=i(1)},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GlobalWorkerOptions=void 0;const i=Object.create(null);t.GlobalWorkerOptions=i,i.workerPort=null,i.workerSrc=""},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var n=i(1);const r=1,a=2,s=1,o=2,l=3,c=4,h=5,d=6,u=7,p=8;function f(e){switch(e instanceof Error||"object"===typeof e&&null!==e||(0,n.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),e.name){case"AbortException":return new n.AbortException(e.message);case"MissingPDFException":return new n.MissingPDFException(e.message);case"PasswordException":return new n.PasswordException(e.message,e.code);case"UnexpectedResponseException":return new n.UnexpectedResponseException(e.message,e.status);case"UnknownErrorException":return new n.UnknownErrorException(e.message,e.details);default:return new n.UnknownErrorException(e.message,e.toString())}}t.MessageHandler=class{constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=e=>{const t=e.data;if(t.targetName!==this.sourceName)return;if(t.stream)return void this._processStreamMessage(t);if(t.callback){const e=t.callbackId,i=this.callbackCapabilities[e];if(!i)throw new Error("Cannot resolve callback ".concat(e));if(delete this.callbackCapabilities[e],t.callback===r)i.resolve(t.data);else{if(t.callback!==a)throw new Error("Unexpected callback case");i.reject(f(t.reason))}return}const n=this.actionHandler[t.action];if(!n)throw new Error("Unknown action from worker: ".concat(t.action));if(t.callbackId){const e=this.sourceName,s=t.sourceName;new Promise((function(e){e(n(t.data))})).then((function(n){i.postMessage({sourceName:e,targetName:s,callback:r,callbackId:t.callbackId,data:n})}),(function(n){i.postMessage({sourceName:e,targetName:s,callback:a,callbackId:t.callbackId,reason:f(n)})}))}else t.streamId?this._createStreamSink(t):n(t.data)},i.addEventListener("message",this._onComObjOnMessage)}on(e,t){const i=this.actionHandler;if(i[e])throw new Error('There is already an actionName called "'.concat(e,'"'));i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const r=this.callbackId++,a=(0,n.createPromiseCapability)();this.callbackCapabilities[r]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},i)}catch(s){a.reject(s)}return a.promise}sendWithStream(e,t,i,r){const a=this.streamId++,o=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:i=>{const s=(0,n.createPromiseCapability)();return this.streamControllers[a]={controller:i,startCall:s,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:l,action:e,streamId:a,data:t,desiredSize:i.desiredSize},r),s.promise},pull:e=>{const t=(0,n.createPromiseCapability)();return this.streamControllers[a].pullCall=t,c.postMessage({sourceName:o,targetName:l,stream:d,streamId:a,desiredSize:e.desiredSize}),t.promise},cancel:e=>{(0,n.assert)(e instanceof Error,"cancel must have a valid reason");const t=(0,n.createPromiseCapability)();return this.streamControllers[a].cancelCall=t,this.streamControllers[a].isClosed=!0,c.postMessage({sourceName:o,targetName:l,stream:s,streamId:a,reason:f(e)}),t.promise}},i)}_createStreamSink(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,a=this.comObj,s=this,o=this.actionHandler[e.action],d={enqueue(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2?arguments[2]:void 0;if(this.isCancelled)return;const l=this.desiredSize;this.desiredSize-=s,l>0&&this.desiredSize<=0&&(this.sinkCapability=(0,n.createPromiseCapability)(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:i,targetName:r,stream:c,streamId:t,chunk:e},o)},close(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:r,stream:l,streamId:t}),delete s.streamSinks[t])},error(e){(0,n.assert)(e instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:r,stream:h,streamId:t,reason:f(e)}))},sinkCapability:(0,n.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,new Promise((function(t){t(o(e.data,d))})).then((function(){a.postMessage({sourceName:i,targetName:r,stream:p,streamId:t,success:!0})}),(function(e){a.postMessage({sourceName:i,targetName:r,stream:p,streamId:t,reason:f(e)})}))}_processStreamMessage(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,a=this.comObj,m=this.streamControllers[t],g=this.streamSinks[t];switch(e.stream){case p:e.success?m.startCall.resolve():m.startCall.reject(f(e.reason));break;case u:e.success?m.pullCall.resolve():m.pullCall.reject(f(e.reason));break;case d:if(!g){a.postMessage({sourceName:i,targetName:r,stream:u,streamId:t,success:!0});break}g.desiredSize<=0&&e.desiredSize>0&&g.sinkCapability.resolve(),g.desiredSize=e.desiredSize,new Promise((function(e){e(g.onPull&&g.onPull())})).then((function(){a.postMessage({sourceName:i,targetName:r,stream:u,streamId:t,success:!0})}),(function(e){a.postMessage({sourceName:i,targetName:r,stream:u,streamId:t,reason:f(e)})}));break;case c:if((0,n.assert)(m,"enqueue should have stream controller"),m.isClosed)break;m.controller.enqueue(e.chunk);break;case l:if((0,n.assert)(m,"close should have stream controller"),m.isClosed)break;m.isClosed=!0,m.controller.close(),this._deleteStreamController(m,t);break;case h:(0,n.assert)(m,"error should have stream controller"),m.controller.error(f(e.reason)),this._deleteStreamController(m,t);break;case o:e.success?m.cancelCall.resolve():m.cancelCall.reject(f(e.reason)),this._deleteStreamController(m,t);break;case s:if(!g)break;new Promise((function(t){t(g.onCancel&&g.onCancel(f(e.reason)))})).then((function(){a.postMessage({sourceName:i,targetName:r,stream:o,streamId:t,success:!0})}),(function(e){a.postMessage({sourceName:i,targetName:r,stream:o,streamId:t,reason:f(e)})})),g.sinkCapability.reject(f(e.reason)),g.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(e,t){await Promise.allSettled([e.startCall&&e.startCall.promise,e.pullCall&&e.pullCall.promise,e.cancelCall&&e.cancelCall.promise]),delete this.streamControllers[t]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=i(1),r=new WeakMap,a=new WeakMap;t.Metadata=class{constructor(e){let{parsedData:t,rawData:i}=e;_classPrivateFieldInitSpec(this,r,void 0),_classPrivateFieldInitSpec(this,a,void 0),_classPrivateFieldSet(r,this,t),_classPrivateFieldSet(a,this,i)}getRaw(){return _classPrivateFieldGet(a,this)}get(e){var t;return null!==(t=_classPrivateFieldGet(r,this).get(e))&&void 0!==t?t:null}getAll(){return(0,n.objectFromMap)(_classPrivateFieldGet(r,this))}has(e){return _classPrivateFieldGet(r,this).has(e)}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionalContentConfig=void 0;var n=i(1),r=i(8);const a=Symbol("INTERNAL");var s=new WeakMap;class o{constructor(e,t){_classPrivateFieldInitSpec(this,s,!0),this.name=e,this.intent=t}get visible(){return _classPrivateFieldGet(s,this)}_setVisible(e,t){e!==a&&(0,n.unreachable)("Internal method `_setVisible` called."),_classPrivateFieldSet(s,this,t)}}var l=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,u=new WeakSet;function p(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let r=1;r<t;r++){const t=e[r];let a;if(Array.isArray(t))a=_assertClassBrand(u,this,p).call(this,t);else{if(!_classPrivateFieldGet(c,this).has(t))return(0,n.warn)("Optional content group not found: ".concat(t)),!0;a=_classPrivateFieldGet(c,this).get(t).visible}switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return"And"===i}t.OptionalContentConfig=class{constructor(e){if(_classPrivateMethodInitSpec(this,u),_classPrivateFieldInitSpec(this,l,null),_classPrivateFieldInitSpec(this,c,new Map),_classPrivateFieldInitSpec(this,h,null),_classPrivateFieldInitSpec(this,d,null),this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,_classPrivateFieldSet(d,this,e.order);for(const t of e.groups)_classPrivateFieldGet(c,this).set(t.id,new o(t.name,t.intent));if("OFF"===e.baseState)for(const e of _classPrivateFieldGet(c,this).values())e._setVisible(a,!1);for(const t of e.on)_classPrivateFieldGet(c,this).get(t)._setVisible(a,!0);for(const t of e.off)_classPrivateFieldGet(c,this).get(t)._setVisible(a,!1);_classPrivateFieldSet(h,this,this.getHash())}}isVisible(e){if(0===_classPrivateFieldGet(c,this).size)return!0;if(!e)return(0,n.warn)("Optional content group not defined."),!0;if("OCG"===e.type)return _classPrivateFieldGet(c,this).has(e.id)?_classPrivateFieldGet(c,this).get(e.id).visible:((0,n.warn)("Optional content group not found: ".concat(e.id)),!0);if("OCMD"===e.type){if(e.expression)return _assertClassBrand(u,this,p).call(this,e.expression);if(!e.policy||"AnyOn"===e.policy){for(const t of e.ids){if(!_classPrivateFieldGet(c,this).has(t))return(0,n.warn)("Optional content group not found: ".concat(t)),!0;if(_classPrivateFieldGet(c,this).get(t).visible)return!0}return!1}if("AllOn"===e.policy){for(const t of e.ids){if(!_classPrivateFieldGet(c,this).has(t))return(0,n.warn)("Optional content group not found: ".concat(t)),!0;if(!_classPrivateFieldGet(c,this).get(t).visible)return!1}return!0}if("AnyOff"===e.policy){for(const t of e.ids){if(!_classPrivateFieldGet(c,this).has(t))return(0,n.warn)("Optional content group not found: ".concat(t)),!0;if(!_classPrivateFieldGet(c,this).get(t).visible)return!0}return!1}if("AllOff"===e.policy){for(const t of e.ids){if(!_classPrivateFieldGet(c,this).has(t))return(0,n.warn)("Optional content group not found: ".concat(t)),!0;if(_classPrivateFieldGet(c,this).get(t).visible)return!1}return!0}return(0,n.warn)("Unknown optional content policy ".concat(e.policy,".")),!0}return(0,n.warn)("Unknown group type ".concat(e.type,".")),!0}setVisibility(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];_classPrivateFieldGet(c,this).has(e)?(_classPrivateFieldGet(c,this).get(e)._setVisible(a,!!t),_classPrivateFieldSet(l,this,null)):(0,n.warn)("Optional content group not found: ".concat(e))}get hasInitialVisibility(){return this.getHash()===_classPrivateFieldGet(h,this)}getOrder(){return _classPrivateFieldGet(c,this).size?_classPrivateFieldGet(d,this)?_classPrivateFieldGet(d,this).slice():[..._classPrivateFieldGet(c,this).keys()]:null}getGroups(){return _classPrivateFieldGet(c,this).size>0?(0,n.objectFromMap)(_classPrivateFieldGet(c,this)):null}getGroup(e){return _classPrivateFieldGet(c,this).get(e)||null}getHash(){if(null!==_classPrivateFieldGet(l,this))return _classPrivateFieldGet(l,this);const e=new r.MurmurHash3_64;for(const[t,i]of _classPrivateFieldGet(c,this))e.update("".concat(t,":").concat(i.visible));return _classPrivateFieldSet(l,this,e.hexdigest())}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFDataTransportStream=void 0;var n=i(1),r=i(6);t.PDFDataTransportStream=class{constructor(e,t){let{length:i,initialData:r,progressiveDone:a=!1,contentDispositionFilename:s=null,disableRange:o=!1,disableStream:l=!1}=e;if((0,n.assert)(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=s,(null===r||void 0===r?void 0:r.length)>0){const e=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(e)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!l,this._isRangeSupported=!o,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener(((e,t)=>{this._onReceiveData({begin:e,chunk:t})})),this._pdfDataRangeTransport.addProgressListener(((e,t)=>{this._onProgress({loaded:e,total:t})})),this._pdfDataRangeTransport.addProgressiveReadListener((e=>{this._onReceiveData({chunk:e})})),this._pdfDataRangeTransport.addProgressiveDoneListener((()=>{this._onProgressiveDone()})),this._pdfDataRangeTransport.transportReady()}_onReceiveData(e){let{begin:t,chunk:i}=e;const r=i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer;if(void 0===t)this._fullRequestReader?this._fullRequestReader._enqueue(r):this._queuedChunks.push(r);else{const e=this._rangeReaders.some((function(e){return e._begin===t&&(e._enqueue(r),!0)}));(0,n.assert)(e,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}_onProgress(e){var t,i,n,r;void 0===e.total?null===(t=this._rangeReaders[0])||void 0===t||null===(i=t.onProgress)||void 0===i||i.call(t,{loaded:e.loaded}):null===(n=this._fullRequestReader)||void 0===n||null===(r=n.onProgress)||void 0===r||r.call(n,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;null===(e=this._fullRequestReader)||void 0===e||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){(0,n.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new a(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new s(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const i of this._rangeReaders.slice(0))i.cancel(e);this._pdfDataRangeTransport.abort()}};class a{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._stream=e,this._done=i||!1,this._filename=(0,r.isPdfFile)(n)?n:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class s{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(0===this._requests.length)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaText=void 0;class i{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};return function e(n){var r;if(!n)return;let a=null;const s=n.name;if("#text"===s)a=n.value;else{if(!i.shouldBuildText(s))return;null!==n&&void 0!==n&&null!==(r=n.attributes)&&void 0!==r&&r.textContent?a=n.attributes.textContent:n.value&&(a=n.value)}if(null!==a&&t.push({str:a}),n.children)for(const t of n.children)e(t)}(e),n}static shouldBuildText(e){return!("textarea"===e||"input"===e||"option"===e||"select"===e)}}t.XfaText=i},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NodeStandardFontDataFactory=t.NodeCanvasFactory=t.NodeCMapReaderFactory=void 0;var n=i(7);const r=function(e){return new Promise(((t,i)=>{__webpack_require__(5618).readFile(e,((e,n)=>{!e&&n?t(new Uint8Array(n)):i(new Error(e))}))}))};class a extends n.BaseCanvasFactory{_createCanvas(e,t){return __webpack_require__(7640).createCanvas(e,t)}}t.NodeCanvasFactory=a;class s extends n.BaseCMapReaderFactory{_fetchData(e,t){return r(e).then((e=>({cMapData:e,compressionType:t})))}}t.NodeCMapReaderFactory=s;class o extends n.BaseStandardFontDataFactory{_fetchData(e){return r(e)}}t.NodeStandardFontDataFactory=o},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNodeStream=void 0;var n=i(1),r=i(22);const a=__webpack_require__(5618),s=__webpack_require__(7492),o=__webpack_require__(1815),l=__webpack_require__(6671),c=/^file:\/\/\/[a-zA-Z]:\//;t.PDFNodeStream=class{constructor(e){this.source=e,this.url=function(e){const t=l.parse(e);return"file:"===t.protocol||t.host?t:/^[a-z]:[/\\]/i.test(e)?l.parse("file:///".concat(e)):(t.host||(t.protocol="file:"),t)}(e.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new m(this):new p(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=this.isFsUrl?new g(this,e,t):new f(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}};class h{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)(),this._headersCapability=(0,n.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return null===t?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=t.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new n.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class d{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,n.createPromiseCapability)();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return null===t?(this._readCapability=(0,n.createPromiseCapability)(),this.read()):(this._loaded+=t.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(e){this._readableStream?this._readableStream.destroy(e):this._error(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",(()=>{this._readCapability.resolve()})),e.on("end",(()=>{e.destroy(),this._done=!0,this._readCapability.resolve()})),e.on("error",(e=>{this._error(e)})),this._storedError&&this._readableStream.destroy(this._storedError)}}function u(e,t){return{protocol:e.protocol,auth:e.auth,host:e.hostname,port:e.port,path:e.path,method:"GET",headers:t}}class p extends h{constructor(e){super(e);const t=t=>{if(404===t.statusCode){const e=new n.MissingPDFException('Missing PDF "'.concat(this._url,'".'));return this._storedError=e,void this._headersCapability.reject(e)}this._headersCapability.resolve(),this._setReadableStream(t);const i=e=>this._readableStream.headers[e.toLowerCase()],{allowRangeRequests:a,suggestedLength:s}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:i,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=s||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(i)};this._request=null,"http:"===this._url.protocol?this._request=s.request(u(this._url,e.httpHeaders),t):this._request=o.request(u(this._url,e.httpHeaders),t),this._request.on("error",(e=>{this._storedError=e,this._headersCapability.reject(e)})),this._request.end()}}class f extends d{constructor(e,t,i){super(e),this._httpHeaders={};for(const n in e.httpHeaders){const t=e.httpHeaders[n];void 0!==t&&(this._httpHeaders[n]=t)}this._httpHeaders.Range="bytes=".concat(t,"-").concat(i-1);const r=e=>{if(404!==e.statusCode)this._setReadableStream(e);else{const e=new n.MissingPDFException('Missing PDF "'.concat(this._url,'".'));this._storedError=e}};this._request=null,"http:"===this._url.protocol?this._request=s.request(u(this._url,this._httpHeaders),r):this._request=o.request(u(this._url,this._httpHeaders),r),this._request.on("error",(e=>{this._storedError=e})),this._request.end()}}class m extends h{constructor(e){super(e);let t=decodeURIComponent(this._url.path);c.test(this._url.href)&&(t=t.replace(/^\//,"")),a.lstat(t,((e,i)=>{if(e)return"ENOENT"===e.code&&(e=new n.MissingPDFException('Missing PDF "'.concat(t,'".'))),this._storedError=e,void this._headersCapability.reject(e);this._contentLength=i.size,this._setReadableStream(a.createReadStream(t)),this._headersCapability.resolve()}))}}class g extends d{constructor(e,t,i){super(e);let n=decodeURIComponent(this._url.path);c.test(this._url.href)&&(n=n.replace(/^\//,"")),this._setReadableStream(a.createReadStream(n,{start:t,end:i-1}))}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createResponseStatusError=function(e,t){return 404===e||0===e&&t.startsWith("file:")?new n.MissingPDFException('Missing PDF "'+t+'".'):new n.UnexpectedResponseException("Unexpected server response (".concat(e,') while retrieving PDF "').concat(t,'".'),e)},t.extractFilenameFromHeader=function(e){const t=e("Content-Disposition");if(t){let e=(0,r.getFilenameFromContentDispositionHeader)(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch(i){}if((0,a.isPdfFile)(e))return e}return null},t.validateRangeRequestCapabilities=function(e){let{getResponseHeader:t,isHttp:i,rangeChunkSize:n,disableRange:r}=e;const a={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(t("Content-Length"),10);return Number.isInteger(s)?(a.suggestedLength=s,s<=2*n||r||!i||"bytes"!==t("Accept-Ranges")||"identity"!==(t("Content-Encoding")||"identity")||(a.allowRangeRequests=!0),a):a},t.validateResponseStatus=function(e){return 200===e||206===e};var n=i(1),r=i(23),a=i(6)},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFilenameFromContentDispositionHeader=function(e){let t=!0,i=r("filename\\*","i").exec(e);if(i){i=i[1];let e=o(i);return e=unescape(e),e=l(e),e=c(e),s(e)}if(i=function(e){const t=[];let i;const n=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(i=n.exec(e));){let[,e,n,r]=i;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[n,r]}const a=[];for(let r=0;r<t.length&&r in t;++r){let[e,i]=t[r];i=o(i),e&&(i=unescape(i),0===r&&(i=l(i))),a.push(i)}return a.join("")}(e),i)return s(c(i));if(i=r("filename","i").exec(e),i){i=i[1];let e=o(i);return e=c(e),s(e)}function r(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function a(e,i){if(e){if(!/^[\x00-\xFF]+$/.test(i))return i;try{const r=new TextDecoder(e,{fatal:!0}),a=(0,n.stringToBytes)(i);i=r.decode(a),t=!1}catch(r){}}return i}function s(e){return t&&/[\x80-\xff]/.test(e)&&(e=a("utf-8",e),t&&(e=a("iso-8859-1",e))),e}function o(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const i=t[e].indexOf('"');-1!==i&&(t[e]=t[e].slice(0,i),t.length=e+1),t[e]=t[e].replace(/\\(.)/g,"$1")}e=t.join('"')}return e}function l(e){const t=e.indexOf("'");return-1===t?e:a(e.slice(0,t),e.slice(t+1).replace(/^[^']*'/,""))}function c(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,i,n){if("q"===i||"Q"===i)return a(t,n=(n=n.replace(/_/g," ")).replace(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})));try{n=atob(n)}catch(r){}return a(t,n)}))}return""};var n=i(1)},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFNetworkStream=void 0;var n=i(1),r=i(22);class a{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.getXhr=t.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,i){const n={begin:e,end:t};for(const r in i)n[r]=i[r];return this.request(n)}requestFull(e){return this.request(e)}request(e){const t=this.getXhr(),i=this.currXhrId++,n=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const r in this.httpHeaders){const e=this.httpHeaders[r];void 0!==e&&t.setRequestHeader(r,e)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range","bytes=".concat(e.begin,"-").concat(e.end-1)),n.expectedStatus=206):n.expectedStatus=200,t.responseType="arraybuffer",e.onError&&(t.onerror=function(i){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),n.onHeadersReceived=e.onHeadersReceived,n.onDone=e.onDone,n.onError=e.onError,n.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){var i;const n=this.pendingRequests[e];n&&(null===(i=n.onProgress)||void 0===i||i.call(n,t))}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const r=i.xhr;if(r.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),4!==r.readyState)return;if(!(e in this.pendingRequests))return;var a;if(delete this.pendingRequests[e],0===r.status&&this.isHttp)return void(null===(a=i.onError)||void 0===a||a.call(i,r.status));const s=r.status||200;var o;if((200!==s||206!==i.expectedStatus)&&s!==i.expectedStatus)return void(null===(o=i.onError)||void 0===o||o.call(i,r.status));const l=function(e){const t=e.response;return"string"!==typeof t?t:(0,n.stringToBytes)(t).buffer}(r);if(206===s){const e=r.getResponseHeader("Content-Range"),t=/bytes (\d+)-(\d+)\/(\d+)/.exec(e);i.onDone({begin:parseInt(t[1],10),chunk:l})}else if(l)i.onDone({begin:0,chunk:l});else{var c;null===(c=i.onError)||void 0===c||c.call(i,r.status)}}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}t.PDFNetworkStream=class{constructor(e){this._source=e,this._manager=new a(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new s(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new o(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}};class s{constructor(e,t){this._manager=e;const i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(i),this._headersReceivedCapability=(0,n.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),i=e=>t.getResponseHeader(e),{allowRangeRequests:n,suggestedLength:a}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=(0,r.createResponseStatusError)(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class o{constructor(e,t,i){this._manager=e;const n={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,i,n),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var e;null===(e=this.onClosed)||void 0===e||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=(0,r.createResponseStatusError)(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||null===(t=this.onProgress)||void 0===t||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const e=(0,n.createPromiseCapability)();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PDFFetchStream=void 0;var n=i(1),r=i(22);function a(e,t,i){return{method:"GET",headers:e,signal:i.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function s(e){const t=new Headers;for(const i in e){const n=e[i];void 0!==n&&t.append(i,n)}return t}function o(e){return e instanceof Uint8Array?e.buffer:e instanceof ArrayBuffer?e:((0,n.warn)("getArrayBuffer - unexpected data format: ".concat(e)),new Uint8Array(e).buffer)}t.PDFFetchStream=class{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e,t;return null!==(e=null===(t=this._fullRequestReader)||void 0===t?void 0:t._loaded)&&void 0!==e?e:0}getFullReader(){return(0,n.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new l(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new c(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){var t;null===(t=this._fullRequestReader)||void 0===t||t.cancel(e);for(const i of this._rangeRequestReaders.slice(0))i.cancel(e)}};class l{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=(0,n.createPromiseCapability)(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=s(this._stream.httpHeaders);const i=t.url;fetch(i,a(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,r.validateResponseStatus)(e.status))throw(0,r.createResponseStatusError)(e.status,i);this._reader=e.body.getReader(),this._headersCapability.resolve();const t=t=>e.headers.get(t),{allowRangeRequests:a,suggestedLength:s}=(0,r.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=a,this._contentLength=s||this._contentLength,this._filename=(0,r.extractFilenameFromHeader)(t),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new n.AbortException("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;await this._headersCapability.promise;const{value:t,done:i}=await this._reader.read();return i?{value:t,done:i}:(this._loaded+=t.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),{value:o(t),done:!1})}cancel(e){var t;null===(t=this._reader)||void 0===t||t.cancel(e),this._abortController.abort()}}class c{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const o=e.source;this._withCredentials=o.withCredentials||!1,this._readCapability=(0,n.createPromiseCapability)(),this._isStreamingSupported=!o.disableStream,this._abortController=new AbortController,this._headers=s(this._stream.httpHeaders),this._headers.append("Range","bytes=".concat(t,"-").concat(i-1));const l=o.url;fetch(l,a(this._headers,this._withCredentials,this._abortController)).then((e=>{if(!(0,r.validateResponseStatus)(e.status))throw(0,r.createResponseStatusError)(e.status,l);this._readCapability.resolve(),this._reader=e.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var e;await this._readCapability.promise;const{value:t,done:i}=await this._reader.read();return i?{value:t,done:i}:(this._loaded+=t.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),{value:o(t),done:!1})}cancel(e){var t;null===(t=this._reader)||void 0===t||t.cancel(e),this._abortController.abort()}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextLayerRenderTask=void 0,t.renderTextLayer=function(e){e.textContentSource||!e.textContent&&!e.textContentStream||((0,r.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),e.textContentSource=e.textContent||e.textContentStream);const t=new d(e);return t._render(),t},t.updateTextLayer=function(e){let{container:t,viewport:i,textDivs:n,textDivProperties:a,isOffscreenCanvasSupported:s,mustRotate:o=!0,mustRescale:c=!0}=e;if(o&&(0,r.setLayerDimensions)(t,{rotation:i.rotation}),c){const e=l(0,s),t={prevFontSize:null,prevFontFamily:null,div:null,scale:i.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:e};for(const i of n)t.properties=a.get(i),t.div=i,h(t)}};var n=i(1),r=i(6);const a=30,s=.8,o=new Map;function l(e,t){let i;if(t&&n.FeatureTest.isOffscreenCanvasSupported)i=new OffscreenCanvas(e,e).getContext("2d",{alpha:!1});else{const t=document.createElement("canvas");t.width=t.height=e,i=t.getContext("2d",{alpha:!1})}return i}function c(e,t,i){const r=document.createElement("span"),c={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};e._textDivs.push(r);const h=n.Util.transform(e._transform,t.transform);let d=Math.atan2(h[1],h[0]);const u=i[t.fontName];u.vertical&&(d+=Math.PI/2);const p=Math.hypot(h[2],h[3]),f=p*function(e,t){const i=o.get(e);if(i)return i;const n=l(a,t);n.font="".concat(a,"px ").concat(e);const r=n.measureText("");let c=r.fontBoundingBoxAscent,h=Math.abs(r.fontBoundingBoxDescent);if(c){const t=c/(c+h);return o.set(e,t),n.canvas.width=n.canvas.height=0,t}n.strokeStyle="red",n.clearRect(0,0,a,a),n.strokeText("g",0,0);let d=n.getImageData(0,0,a,a).data;h=0;for(let s=d.length-1-3;s>=0;s-=4)if(d[s]>0){h=Math.ceil(s/4/a);break}n.clearRect(0,0,a,a),n.strokeText("A",0,a),d=n.getImageData(0,0,a,a).data,c=0;for(let s=0,o=d.length;s<o;s+=4)if(d[s]>0){c=a-Math.floor(s/4/a);break}if(n.canvas.width=n.canvas.height=0,c){const t=c/(c+h);return o.set(e,t),t}return o.set(e,s),s}(u.fontFamily,e._isOffscreenCanvasSupported);let m,g;0===d?(m=h[4],g=h[5]-f):(m=h[4]+f*Math.sin(d),g=h[5]-f*Math.cos(d));const v="calc(var(--scale-factor)*",y=r.style;e._container===e._rootContainer?(y.left="".concat((100*m/e._pageWidth).toFixed(2),"%"),y.top="".concat((100*g/e._pageHeight).toFixed(2),"%")):(y.left="".concat(v).concat(m.toFixed(2),"px)"),y.top="".concat(v).concat(g.toFixed(2),"px)")),y.fontSize="".concat(v).concat(p.toFixed(2),"px)"),y.fontFamily=u.fontFamily,c.fontSize=p,r.setAttribute("role","presentation"),r.textContent=t.str,r.dir=t.dir,e._fontInspectorEnabled&&(r.dataset.fontName=t.fontName),0!==d&&(c.angle=d*(180/Math.PI));let b=!1;if(t.str.length>1)b=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){const e=Math.abs(t.transform[0]),i=Math.abs(t.transform[3]);e!==i&&Math.max(e,i)/Math.min(e,i)>1.5&&(b=!0)}b&&(c.canvasWidth=u.vertical?t.height:t.width),e._textDivProperties.set(r,c),e._isReadableStream&&e._layoutText(r)}function h(e){const{div:t,scale:i,properties:n,ctx:r,prevFontSize:a,prevFontFamily:s}=e,{style:o}=t;let l="";if(0!==n.canvasWidth&&n.hasText){const{fontFamily:c}=o,{canvasWidth:h,fontSize:d}=n;a===d&&s===c||(r.font="".concat(d*i,"px ").concat(c),e.prevFontSize=d,e.prevFontFamily=c);const{width:u}=r.measureText(t.textContent);u>0&&(l="scaleX(".concat(h*i/u,")"))}0!==n.angle&&(l="rotate(".concat(n.angle,"deg) ").concat(l)),l.length>0&&(o.transform=l)}class d{constructor(e){var t;let{textContentSource:i,container:a,viewport:s,textDivs:o,textDivProperties:c,textContentItemsStr:h,isOffscreenCanvasSupported:d}=e;this._textContentSource=i,this._isReadableStream=i instanceof ReadableStream,this._container=this._rootContainer=a,this._textDivs=o||[],this._textContentItemsStr=h||[],this._isOffscreenCanvasSupported=d,this._fontInspectorEnabled=!(null===(t=globalThis.FontInspector)||void 0===t||!t.enabled),this._reader=null,this._textDivProperties=c||new WeakMap,this._canceled=!1,this._capability=(0,n.createPromiseCapability)(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:s.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:l(0,d)};const{pageWidth:u,pageHeight:p,pageX:f,pageY:m}=s.rawDims;this._transform=[1,0,0,-1,-f,m+p],this._pageWidth=u,this._pageHeight=p,(0,r.setLayerDimensions)(a,s),this._capability.promise.finally((()=>{this._layoutTextParams=null})).catch((()=>{}))}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new n.AbortException("TextLayer task cancelled.")).catch((()=>{})),this._reader=null),this._capability.reject(new n.AbortException("TextLayer task cancelled."))}_processItems(e,t){for(const i of e)if(void 0!==i.str)this._textContentItemsStr.push(i.str),c(this,i,t);else if("beginMarkedContentProps"===i.type||"beginMarkedContent"===i.type){const e=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==i.id&&this._container.setAttribute("id","".concat(i.id)),e.append(this._container)}else"endMarkedContent"===i.type&&(this._container=this._container.parentNode)}_layoutText(e){const t=this._layoutTextParams.properties=this._textDivProperties.get(e);if(this._layoutTextParams.div=e,h(this._layoutTextParams),t.hasText&&this._container.append(e),t.hasEOL){const e=document.createElement("br");e.setAttribute("role","presentation"),this._container.append(e)}}_render(){const e=(0,n.createPromiseCapability)();let t=Object.create(null);if(this._isReadableStream){const i=()=>{this._reader.read().then((n=>{let{value:r,done:a}=n;a?e.resolve():(Object.assign(t,r.styles),this._processItems(r.items,t),i())}),e.reject)};this._reader=this._textContentSource.getReader(),i()}else{if(!this._textContentSource)throw new Error('No "textContentSource" parameter specified.');{const{items:t,styles:i}=this._textContentSource;this._processItems(t,i),e.resolve()}}e.promise.then((()=>{t=null,function(e){if(e._canceled)return;const t=e._textDivs,i=e._capability;if(t.length>1e5)i.resolve();else{if(!e._isReadableStream)for(const i of t)e._layoutText(i);i.resolve()}}(this)}),this._capability.reject)}}t.TextLayerRenderTask=d},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationEditorLayer=void 0;var n=i(1),r=i(5),a=i(28),s=i(29),o=i(6),l=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakSet;class v{constructor(e){_classPrivateMethodInitSpec(this,g),_classPrivateFieldInitSpec(this,l,void 0),_classPrivateFieldInitSpec(this,c,!1),_classPrivateFieldInitSpec(this,h,this.pointerup.bind(this)),_classPrivateFieldInitSpec(this,d,this.pointerdown.bind(this)),_classPrivateFieldInitSpec(this,u,new Map),_classPrivateFieldInitSpec(this,p,!1),_classPrivateFieldInitSpec(this,f,!1),_classPrivateFieldInitSpec(this,m,void 0),v._initialized||(v._initialized=!0,a.FreeTextEditor.initialize(e.l10n),s.InkEditor.initialize(e.l10n)),e.uiManager.registerEditorTypes([a.FreeTextEditor,s.InkEditor]),_classPrivateFieldSet(m,this,e.uiManager),this.pageIndex=e.pageIndex,this.div=e.div,_classPrivateFieldSet(l,this,e.accessibilityManager),_classPrivateFieldGet(m,this).addLayer(this)}get isEmpty(){return 0===_classPrivateFieldGet(u,this).size}updateToolbar(e){_classPrivateFieldGet(m,this).updateToolbar(e)}updateMode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_classPrivateFieldGet(m,this).getMode();_assertClassBrand(g,this,w).call(this),e===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),_classPrivateFieldGet(m,this).unselectAll(),e!==n.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",e===n.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",e===n.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(e){if(e||_classPrivateFieldGet(m,this).getMode()===n.AnnotationEditorType.INK){if(!e)for(const e of _classPrivateFieldGet(u,this).values())if(e.isEmpty())return void e.setInBackground();_assertClassBrand(g,this,x).call(this,{offsetX:0,offsetY:0}).setInBackground()}}setEditingState(e){_classPrivateFieldGet(m,this).setEditingState(e)}addCommands(e){_classPrivateFieldGet(m,this).addCommands(e)}enable(){this.div.style.pointerEvents="auto";for(const e of _classPrivateFieldGet(u,this).values())e.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const e of _classPrivateFieldGet(u,this).values())e.disableEditing();_assertClassBrand(g,this,w).call(this),this.isEmpty&&(this.div.hidden=!0)}setActiveEditor(e){_classPrivateFieldGet(m,this).getActive()!==e&&_classPrivateFieldGet(m,this).setActiveEditor(e)}enableClick(){this.div.addEventListener("pointerdown",_classPrivateFieldGet(d,this)),this.div.addEventListener("pointerup",_classPrivateFieldGet(h,this))}disableClick(){this.div.removeEventListener("pointerdown",_classPrivateFieldGet(d,this)),this.div.removeEventListener("pointerup",_classPrivateFieldGet(h,this))}attach(e){_classPrivateFieldGet(u,this).set(e.id,e)}detach(e){var t;_classPrivateFieldGet(u,this).delete(e.id),null===(t=_classPrivateFieldGet(l,this))||void 0===t||t.removePointerInTextLayer(e.contentDiv)}remove(e){_classPrivateFieldGet(m,this).removeEditor(e),this.detach(e),e.div.style.display="none",setTimeout((()=>{e.div.style.display="",e.div.remove(),e.isAttachedToDOM=!1,document.activeElement===document.body&&_classPrivateFieldGet(m,this).focusMainContainer()}),0),_classPrivateFieldGet(f,this)||this.addInkEditorIfNeeded(!1)}add(e){if(_assertClassBrand(g,this,y).call(this,e),_classPrivateFieldGet(m,this).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}this.moveEditorInDOM(e),e.onceAdded(),_classPrivateFieldGet(m,this).addToAnnotationStorage(e)}moveEditorInDOM(e){var t;null===(t=_classPrivateFieldGet(l,this))||void 0===t||t.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?e.rebuild():this.add(e)}addANewEditor(e){this.addCommands({cmd:()=>{this.addOrRebuild(e)},undo:()=>{e.remove()},mustExec:!0})}addUndoableEditor(e){this.addCommands({cmd:()=>{this.addOrRebuild(e)},undo:()=>{e.remove()},mustExec:!1})}getNextId(){return _classPrivateFieldGet(m,this).getId()}deserialize(e){switch(e.annotationType){case n.AnnotationEditorType.FREETEXT:return a.FreeTextEditor.deserialize(e,this,_classPrivateFieldGet(m,this));case n.AnnotationEditorType.INK:return s.InkEditor.deserialize(e,this,_classPrivateFieldGet(m,this))}return null}setSelected(e){_classPrivateFieldGet(m,this).setSelected(e)}toggleSelected(e){_classPrivateFieldGet(m,this).toggleSelected(e)}isSelected(e){return _classPrivateFieldGet(m,this).isSelected(e)}unselect(e){_classPrivateFieldGet(m,this).unselect(e)}pointerup(e){const{isMac:t}=n.FeatureTest.platform;0!==e.button||e.ctrlKey&&t||e.target===this.div&&_classPrivateFieldGet(p,this)&&(_classPrivateFieldSet(p,this,!1),_classPrivateFieldGet(c,this)?_assertClassBrand(g,this,x).call(this,e):_classPrivateFieldSet(c,this,!0))}pointerdown(e){const{isMac:t}=n.FeatureTest.platform;if(0!==e.button||e.ctrlKey&&t)return;if(e.target!==this.div)return;_classPrivateFieldSet(p,this,!0);const i=_classPrivateFieldGet(m,this).getActive();_classPrivateFieldSet(c,this,!i||i.isEmpty())}drop(e){const t=e.dataTransfer.getData("text/plain"),i=_classPrivateFieldGet(m,this).getEditor(t);if(!i)return;e.preventDefault(),e.dataTransfer.dropEffect="move",_assertClassBrand(g,this,y).call(this,i);const n=this.div.getBoundingClientRect(),r=e.clientX-n.x,a=e.clientY-n.y;i.translate(r-i.startX,a-i.startY),this.moveEditorInDOM(i),i.div.focus()}dragover(e){e.preventDefault()}destroy(){var e;(null===(e=_classPrivateFieldGet(m,this).getActive())||void 0===e?void 0:e.parent)===this&&_classPrivateFieldGet(m,this).setActiveEditor(null);for(const i of _classPrivateFieldGet(u,this).values()){var t;null===(t=_classPrivateFieldGet(l,this))||void 0===t||t.removePointerInTextLayer(i.contentDiv),i.setParent(null),i.isAttachedToDOM=!1,i.div.remove()}this.div=null,_classPrivateFieldGet(u,this).clear(),_classPrivateFieldGet(m,this).removeLayer(this)}render(e){let{viewport:t}=e;this.viewport=t,(0,o.setLayerDimensions)(this.div,t),(0,r.bindEvents)(this,this.div,["dragover","drop"]);for(const i of _classPrivateFieldGet(m,this).getEditors(this.pageIndex))this.add(i);this.updateMode()}update(e){let{viewport:t}=e;_classPrivateFieldGet(m,this).commitOrRemove(),this.viewport=t,(0,o.setLayerDimensions)(this.div,{rotation:t.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}}function y(e){var t;e.parent!==this&&(this.attach(e),null===(t=e.parent)||void 0===t||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}function b(e){switch(_classPrivateFieldGet(m,this).getMode()){case n.AnnotationEditorType.FREETEXT:return new a.FreeTextEditor(e);case n.AnnotationEditorType.INK:return new s.InkEditor(e)}return null}function x(e){const t=this.getNextId(),i=_assertClassBrand(g,this,b).call(this,{parent:this,id:t,x:e.offsetX,y:e.offsetY,uiManager:_classPrivateFieldGet(m,this)});return i&&this.add(i),i}function w(){_classPrivateFieldSet(f,this,!0);for(const e of _classPrivateFieldGet(u,this).values())e.isEmpty()&&e.remove();_classPrivateFieldSet(f,this,!1)}_defineProperty(v,"_initialized",!1),t.AnnotationEditorLayer=v},(e,t,i)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.FreeTextEditor=void 0;var r=i(1),a=i(5),s=i(4),o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakSet;class v extends s.AnnotationEditor{constructor(e){super({...e,name:"freeTextEditor"}),_classPrivateMethodInitSpec(this,g),_classPrivateFieldInitSpec(this,o,this.editorDivBlur.bind(this)),_classPrivateFieldInitSpec(this,l,this.editorDivFocus.bind(this)),_classPrivateFieldInitSpec(this,c,this.editorDivInput.bind(this)),_classPrivateFieldInitSpec(this,h,this.editorDivKeydown.bind(this)),_classPrivateFieldInitSpec(this,d,void 0),_classPrivateFieldInitSpec(this,u,""),_classPrivateFieldInitSpec(this,p,"".concat(this.id,"-editor")),_classPrivateFieldInitSpec(this,f,!1),_classPrivateFieldInitSpec(this,m,void 0),_classPrivateFieldSet(d,this,e.color||v._defaultColor||s.AnnotationEditor._defaultLineColor),_classPrivateFieldSet(m,this,e.fontSize||v._defaultFontSize)}static initialize(e){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map((t=>[t,e.get(t)])));const t=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(t.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case r.AnnotationEditorParamsType.FREETEXT_SIZE:v._defaultFontSize=t;break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:v._defaultColor=t}}updateParams(e,t){switch(e){case r.AnnotationEditorParamsType.FREETEXT_SIZE:_assertClassBrand(g,this,y).call(this,t);break;case r.AnnotationEditorParamsType.FREETEXT_COLOR:_assertClassBrand(g,this,b).call(this,t)}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,v._defaultFontSize],[r.AnnotationEditorParamsType.FREETEXT_COLOR,v._defaultColor||s.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[r.AnnotationEditorParamsType.FREETEXT_SIZE,_classPrivateFieldGet(m,this)],[r.AnnotationEditorParamsType.FREETEXT_COLOR,_classPrivateFieldGet(d,this)]]}getInitialTranslation(){const e=this.parentScale;return[-v._internalPadding*e,-(v._internalPadding+_classPrivateFieldGet(m,this))*e]}rebuild(){super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(r.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",_classPrivateFieldGet(h,this)),this.editorDiv.addEventListener("focus",_classPrivateFieldGet(l,this)),this.editorDiv.addEventListener("blur",_classPrivateFieldGet(o,this)),this.editorDiv.addEventListener("input",_classPrivateFieldGet(c,this)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",_classPrivateFieldGet(p,this)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",_classPrivateFieldGet(h,this)),this.editorDiv.removeEventListener("focus",_classPrivateFieldGet(l,this)),this.editorDiv.removeEventListener("blur",_classPrivateFieldGet(o,this)),this.editorDiv.removeEventListener("input",_classPrivateFieldGet(c,this)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(e){super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){this.isInEditMode()&&(super.commit(),_classPrivateFieldGet(f,this)||(_classPrivateFieldSet(f,this,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),_classPrivateFieldSet(u,this,_assertClassBrand(g,this,x).call(this).trimEnd()),_assertClassBrand(g,this,w).call(this))}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(e){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&"Enter"===e.key&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(e){v._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",_classPrivateFieldGet(p,this)),this.enableEditing(),v._l10nPromise.get("editor_free_text2_aria_label").then((e=>{var t;return null===(t=this.editorDiv)||void 0===t?void 0:t.setAttribute("aria-label",e)})),v._l10nPromise.get("free_text2_default_content").then((e=>{var t;return null===(t=this.editorDiv)||void 0===t?void 0:t.setAttribute("default-content",e)})),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize="calc(".concat(_classPrivateFieldGet(m,this),"px * var(--scale-factor))"),i.color=_classPrivateFieldGet(d,this),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,a.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[i,n]=this.parentDimensions;this.setAt(e*i,t*n,this.width*i,this.height*n);for(const e of _classPrivateFieldGet(u,this).split("\n")){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(e,t,i){const n=super.deserialize(e,t,i);return _classPrivateFieldSet(m,n,e.fontSize),_classPrivateFieldSet(d,n,r.Util.makeHexColor(...e.color)),_classPrivateFieldSet(u,n,e.value),n}serialize(){if(this.isEmpty())return null;const e=v._internalPadding*this.parentScale,t=this.getRect(e,e),i=s.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:_classPrivateFieldGet(d,this));return{annotationType:r.AnnotationEditorType.FREETEXT,color:i,fontSize:_classPrivateFieldGet(m,this),value:_classPrivateFieldGet(u,this),pageIndex:this.pageIndex,rect:t,rotation:this.rotation}}}function y(e){const t=e=>{this.editorDiv.style.fontSize="calc(".concat(e,"px * var(--scale-factor))"),this.translate(0,-(e-_classPrivateFieldGet(m,this))*this.parentScale),_classPrivateFieldSet(m,this,e),_assertClassBrand(g,this,w).call(this)},i=_classPrivateFieldGet(m,this);this.addCommands({cmd:()=>{t(e)},undo:()=>{t(i)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function b(e){const t=_classPrivateFieldGet(d,this);this.addCommands({cmd:()=>{_classPrivateFieldSet(d,this,this.editorDiv.style.color=e)},undo:()=>{_classPrivateFieldSet(d,this,this.editorDiv.style.color=t)},mustExec:!0,type:r.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function x(){const e=this.editorDiv.getElementsByTagName("div");if(0===e.length)return this.editorDiv.innerText;const t=[];for(const i of e)t.push(i.innerText.replace(/\r\n?|\n/,""));return t.join("\n")}function w(){const[e,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:e,div:t}=this,n=t.style.display;t.style.display="hidden",e.div.append(this.div),i=t.getBoundingClientRect(),t.remove(),t.style.display=n}this.width=i.width/e,this.height=i.height/t}n=v,_defineProperty(v,"_freeTextDefaultContent",""),_defineProperty(v,"_l10nPromise",void 0),_defineProperty(v,"_internalPadding",0),_defineProperty(v,"_defaultColor",null),_defineProperty(v,"_defaultFontSize",10),_defineProperty(v,"_keyboardManager",new a.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.prototype.commitOrRemove]])),_defineProperty(v,"_type","freetext"),t.FreeTextEditor=v},(e,t,i)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.InkEditor=void 0,Object.defineProperty(t,"fitCurve",{enumerable:!0,get:function(){return s.fitCurve}});var r=i(1),a=i(4),s=i(30),o=i(5);const l=16,c=100;var h=new WeakMap,d=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,y=new WeakMap,b=new WeakMap,x=new WeakMap,w=new WeakMap,_=new WeakMap,S=new WeakMap,A=new WeakSet;class E extends a.AnnotationEditor{constructor(e){super({...e,name:"inkEditor"}),_classPrivateMethodInitSpec(this,A),_classPrivateFieldInitSpec(this,h,0),_classPrivateFieldInitSpec(this,d,0),_classPrivateFieldInitSpec(this,u,0),_classPrivateFieldInitSpec(this,p,this.canvasPointermove.bind(this)),_classPrivateFieldInitSpec(this,f,this.canvasPointerleave.bind(this)),_classPrivateFieldInitSpec(this,m,this.canvasPointerup.bind(this)),_classPrivateFieldInitSpec(this,g,this.canvasPointerdown.bind(this)),_classPrivateFieldInitSpec(this,v,!1),_classPrivateFieldInitSpec(this,y,!1),_classPrivateFieldInitSpec(this,b,null),_classPrivateFieldInitSpec(this,x,null),_classPrivateFieldInitSpec(this,w,0),_classPrivateFieldInitSpec(this,_,0),_classPrivateFieldInitSpec(this,S,null),this.color=e.color||null,this.thickness=e.thickness||null,this.opacity=e.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(e){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map((t=>[t,e.get(t)])))}static updateDefaultParams(e,t){switch(e){case r.AnnotationEditorParamsType.INK_THICKNESS:E._defaultThickness=t;break;case r.AnnotationEditorParamsType.INK_COLOR:E._defaultColor=t;break;case r.AnnotationEditorParamsType.INK_OPACITY:E._defaultOpacity=t/100}}updateParams(e,t){switch(e){case r.AnnotationEditorParamsType.INK_THICKNESS:_assertClassBrand(A,this,C).call(this,t);break;case r.AnnotationEditorParamsType.INK_COLOR:_assertClassBrand(A,this,M).call(this,t);break;case r.AnnotationEditorParamsType.INK_OPACITY:_assertClassBrand(A,this,P).call(this,t)}}static get defaultPropertiesToUpdate(){return[[r.AnnotationEditorParamsType.INK_THICKNESS,E._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,E._defaultColor||a.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*E._defaultOpacity)]]}get propertiesToUpdate(){var e;return[[r.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||E._defaultThickness],[r.AnnotationEditorParamsType.INK_COLOR,this.color||E._defaultColor||a.AnnotationEditor._defaultLineColor],[r.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(null!==(e=this.opacity)&&void 0!==e?e:E._defaultOpacity))]]}rebuild(){super.rebuild(),null!==this.div&&(this.canvas||(_assertClassBrand(A,this,F).call(this),_assertClassBrand(A,this,B).call(this)),this.isAttachedToDOM||(this.parent.add(this),_assertClassBrand(A,this,N).call(this)),_assertClassBrand(A,this,X).call(this))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,_classPrivateFieldGet(x,this).disconnect(),_classPrivateFieldSet(x,this,null),super.remove())}setParent(e){!this.parent&&e?this._uiManager.removeShouldRescale(this):this.parent&&null===e&&this._uiManager.addShouldRescale(this),super.setParent(e)}onScaleChanging(){const[e,t]=this.parentDimensions,i=this.width*e,n=this.height*t;this.setDimensions(i,n)}enableEditMode(){_classPrivateFieldGet(v,this)||null===this.canvas||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",_classPrivateFieldGet(g,this)),this.canvas.addEventListener("pointerup",_classPrivateFieldGet(m,this)))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",_classPrivateFieldGet(g,this)),this.canvas.removeEventListener("pointerup",_classPrivateFieldGet(m,this)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}commit(){_classPrivateFieldGet(v,this)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),_classPrivateFieldSet(v,this,!0),this.div.classList.add("disabled"),_assertClassBrand(A,this,X).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(e){super.focusin(e),this.enableEditMode()}canvasPointerdown(e){0===e.button&&this.isInEditMode()&&!_classPrivateFieldGet(v,this)&&(this.setInForeground(),"mouse"!==e.type&&this.div.focus(),e.stopPropagation(),this.canvas.addEventListener("pointerleave",_classPrivateFieldGet(f,this)),this.canvas.addEventListener("pointermove",_classPrivateFieldGet(p,this)),_assertClassBrand(A,this,R).call(this,e.offsetX,e.offsetY))}canvasPointermove(e){e.stopPropagation(),_assertClassBrand(A,this,O).call(this,e.offsetX,e.offsetY)}canvasPointerup(e){0===e.button&&this.isInEditMode()&&0!==this.currentPath.length&&(e.stopPropagation(),_assertClassBrand(A,this,L).call(this,e),this.setInBackground())}canvasPointerleave(e){_assertClassBrand(A,this,L).call(this,e),this.setInBackground()}render(){if(this.div)return this.div;let e,t;this.width&&(e=this.x,t=this.y),super.render(),E._l10nPromise.get("editor_ink2_aria_label").then((e=>{var t;return null===(t=this.div)||void 0===t?void 0:t.setAttribute("aria-label",e)}));const[i,n,r,a]=_assertClassBrand(A,this,T).call(this);if(this.setAt(i,n,0,0),this.setDims(r,a),_assertClassBrand(A,this,F).call(this),this.width){const[i,n]=this.parentDimensions;this.setAt(e*i,t*n,this.width*i,this.height*n),_classPrivateFieldSet(y,this,!0),_assertClassBrand(A,this,N).call(this),this.setDims(this.width*i,this.height*n),_assertClassBrand(A,this,k).call(this),_assertClassBrand(A,this,Y).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return _assertClassBrand(A,this,B).call(this),this.div}setDimensions(e,t){const i=Math.round(e),n=Math.round(t);if(_classPrivateFieldGet(w,this)===i&&_classPrivateFieldGet(_,this)===n)return;_classPrivateFieldSet(w,this,i),_classPrivateFieldSet(_,this,n),this.canvas.style.visibility="hidden",_classPrivateFieldGet(h,this)&&Math.abs(_classPrivateFieldGet(h,this)-e/t)>.01&&(t=Math.ceil(e/_classPrivateFieldGet(h,this)),this.setDims(e,t));const[r,a]=this.parentDimensions;this.width=e/r,this.height=t/a,_classPrivateFieldGet(v,this)&&_assertClassBrand(A,this,z).call(this,e,t),_assertClassBrand(A,this,N).call(this),_assertClassBrand(A,this,k).call(this),this.canvas.style.visibility="visible"}static deserialize(e,t,i){const n=super.deserialize(e,t,i);n.thickness=e.thickness,n.color=r.Util.makeHexColor(...e.color),n.opacity=e.opacity;const[a,s]=n.pageDimensions,o=n.width*a,c=n.height*s,p=n.parentScale,f=e.thickness/2;_classPrivateFieldSet(h,n,o/c),_classPrivateFieldSet(v,n,!0),_classPrivateFieldSet(w,n,Math.round(o)),_classPrivateFieldSet(_,n,Math.round(c));for(const{bezier:r}of e.paths){const e=[];n.paths.push(e);let t=p*(r[0]-f),i=p*(c-r[1]-f);for(let n=2,s=r.length;n<s;n+=6){const a=p*(r[n]-f),s=p*(c-r[n+1]-f),o=p*(r[n+2]-f),l=p*(c-r[n+3]-f),h=p*(r[n+4]-f),d=p*(c-r[n+5]-f);e.push([[t,i],[a,s],[o,l],[h,d]]),t=h,i=d}const a=_assertClassBrand(E,this,j).call(this,e);n.bezierPath2D.push(a)}const m=_assertClassBrand(A,n,W).call(n);return _classPrivateFieldSet(u,n,Math.max(l,m[2]-m[0])),_classPrivateFieldSet(d,n,Math.max(l,m[3]-m[1])),_assertClassBrand(A,n,z).call(n,o,c),n}serialize(){if(this.isEmpty())return null;const e=this.getRect(0,0),t=this.rotation%180===0?e[3]-e[1]:e[2]-e[0],i=a.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:r.AnnotationEditorType.INK,color:i,thickness:this.thickness,opacity:this.opacity,paths:_assertClassBrand(A,this,V).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:e,rotation:this.rotation}}}function C(e){const t=this.thickness;this.addCommands({cmd:()=>{this.thickness=e,_assertClassBrand(A,this,X).call(this)},undo:()=>{this.thickness=t,_assertClassBrand(A,this,X).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}function M(e){const t=this.color;this.addCommands({cmd:()=>{this.color=e,_assertClassBrand(A,this,k).call(this)},undo:()=>{this.color=t,_assertClassBrand(A,this,k).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function P(e){e/=100;const t=this.opacity;this.addCommands({cmd:()=>{this.opacity=e,_assertClassBrand(A,this,k).call(this)},undo:()=>{this.opacity=t,_assertClassBrand(A,this,k).call(this)},mustExec:!0,type:r.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}function T(){const{parentRotation:e,parentDimensions:[t,i]}=this;switch(e){case 90:return[0,i,i,t];case 180:return[t,i,t,i];case 270:return[t,0,i,t];default:return[0,0,t,i]}}function D(){const{ctx:e,color:t,opacity:i,thickness:n,parentScale:r,scaleFactor:a}=this;e.lineWidth=n*r/a,e.lineCap="round",e.lineJoin="round",e.miterLimit=10,e.strokeStyle="".concat(t).concat((0,o.opacityToHex)(i))}function R(e,t){var i;this.isEditing=!0,_classPrivateFieldGet(y,this)||(_classPrivateFieldSet(y,this,!0),_assertClassBrand(A,this,N).call(this),this.thickness||(this.thickness=n._defaultThickness),this.color||(this.color=n._defaultColor||a.AnnotationEditor._defaultLineColor),null!==(i=this.opacity)&&void 0!==i||(this.opacity=n._defaultOpacity)),this.currentPath.push([e,t]),_classPrivateFieldSet(b,this,null),_assertClassBrand(A,this,D).call(this),this.ctx.beginPath(),this.ctx.moveTo(e,t),_classPrivateFieldSet(S,this,(()=>{_classPrivateFieldGet(S,this)&&(_classPrivateFieldGet(b,this)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):_assertClassBrand(A,this,k).call(this),this.ctx.lineTo(..._classPrivateFieldGet(b,this)),_classPrivateFieldSet(b,this,null),this.ctx.stroke()),window.requestAnimationFrame(_classPrivateFieldGet(S,this)))})),window.requestAnimationFrame(_classPrivateFieldGet(S,this))}function O(e,t){const[i,n]=this.currentPath.at(-1);e===i&&t===n||(this.currentPath.push([e,t]),_classPrivateFieldSet(b,this,[e,t]))}function I(e,t){this.ctx.closePath(),_classPrivateFieldSet(S,this,null),e=Math.min(Math.max(e,0),this.canvas.width),t=Math.min(Math.max(t,0),this.canvas.height);const[i,r]=this.currentPath.at(-1);let a;if(e===i&&t===r||this.currentPath.push([e,t]),1!==this.currentPath.length)a=(0,s.fitCurve)(this.currentPath,30,null);else{const i=[e,t];a=[[i,i.slice(),i.slice(),i]]}const o=j.call(n,a);this.currentPath.length=0,this.addCommands({cmd:()=>{this.paths.push(a),this.bezierPath2D.push(o),this.rebuild()},undo:()=>{this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(_assertClassBrand(A,this,F).call(this),_assertClassBrand(A,this,B).call(this)),_assertClassBrand(A,this,X).call(this))},mustExec:!0})}function k(){if(this.isEmpty())return void _assertClassBrand(A,this,U).call(this);_assertClassBrand(A,this,D).call(this);const{canvas:e,ctx:t}=this;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),_assertClassBrand(A,this,U).call(this);for(const i of this.bezierPath2D)t.stroke(i)}function L(e){_assertClassBrand(A,this,I).call(this,e.offsetX,e.offsetY),this.canvas.removeEventListener("pointerleave",_classPrivateFieldGet(f,this)),this.canvas.removeEventListener("pointermove",_classPrivateFieldGet(p,this)),this.addToAnnotationStorage()}function F(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",n._l10nPromise.get("editor_ink_canvas_aria_label").then((e=>{var t;return null===(t=this.canvas)||void 0===t?void 0:t.setAttribute("aria-label",e)})),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}function B(){let e=null;_classPrivateFieldSet(x,this,new ResizeObserver((t=>{const i=t[0].contentRect;i.width&&i.height&&(null!==e&&clearTimeout(e),e=setTimeout((()=>{this.fixDims(),e=null}),c),this.setDimensions(i.width,i.height))}))),_classPrivateFieldGet(x,this).observe(this.div)}function N(){if(!_classPrivateFieldGet(y,this))return;const[e,t]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*e),this.canvas.height=Math.ceil(this.height*t),_assertClassBrand(A,this,U).call(this)}function z(e,t){const i=_assertClassBrand(A,this,q).call(this),n=(e-i)/_classPrivateFieldGet(u,this),r=(t-i)/_classPrivateFieldGet(d,this);this.scaleFactor=Math.min(n,r)}function U(){const e=_assertClassBrand(A,this,q).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+e,this.translationY*this.scaleFactor+e)}function j(e){const t=new Path2D;for(let i=0,n=e.length;i<n;i++){const[n,r,a,s]=e[i];0===i&&t.moveTo(...n),t.bezierCurveTo(r[0],r[1],a[0],a[1],s[0],s[1])}return t}function V(e,t,i,n){const r=[],a=this.thickness/2;let s,o;for(const l of this.paths){s=[],o=[];for(let r=0,c=l.length;r<c;r++){const[c,h,d,u]=l[r],p=e*(c[0]+t)+a,f=n-e*(c[1]+i)-a,m=e*(h[0]+t)+a,g=n-e*(h[1]+i)-a,v=e*(d[0]+t)+a,y=n-e*(d[1]+i)-a,b=e*(u[0]+t)+a,x=n-e*(u[1]+i)-a;0===r&&(s.push(p,f),o.push(p,f)),s.push(m,g,v,y,b,x),_assertClassBrand(A,this,G).call(this,p,f,m,g,v,y,b,x,4,o)}r.push({bezier:s,points:o})}return r}function G(e,t,i,n,r,a,s,o,l,c){if(_assertClassBrand(A,this,H).call(this,e,t,i,n,r,a,s,o))c.push(s,o);else{for(let h=1;h<l-1;h++){const d=h/l,u=1-d;let p=d*e+u*i,f=d*t+u*n,m=d*i+u*r,g=d*n+u*a;p=d*p+u*m,f=d*f+u*g,m=d*m+u*(d*r+u*s),g=d*g+u*(d*a+u*o),p=d*p+u*m,f=d*f+u*g,c.push(p,f)}c.push(s,o)}}function H(e,t,i,n,r,a,s,o){const l=(3*i-2*e-s)**2,c=(3*n-2*t-o)**2,h=(3*r-e-2*s)**2,d=(3*a-t-2*o)**2;return Math.max(l,h)+Math.max(c,d)<=10}function W(){let e=1/0,t=-1/0,i=1/0,n=-1/0;for(const a of this.paths)for(const[s,o,l,c]of a){const a=r.Util.bezierBoundingBox(...s,...o,...l,...c);e=Math.min(e,a[0]),i=Math.min(i,a[1]),t=Math.max(t,a[2]),n=Math.max(n,a[3])}return[e,i,t,n]}function q(){return _classPrivateFieldGet(v,this)?Math.ceil(this.thickness*this.parentScale):0}function X(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return;if(!_classPrivateFieldGet(v,this))return void _assertClassBrand(A,this,k).call(this);const t=_assertClassBrand(A,this,W).call(this),i=_assertClassBrand(A,this,q).call(this);_classPrivateFieldSet(u,this,Math.max(l,t[2]-t[0])),_classPrivateFieldSet(d,this,Math.max(l,t[3]-t[1]));const n=Math.ceil(i+_classPrivateFieldGet(u,this)*this.scaleFactor),r=Math.ceil(i+_classPrivateFieldGet(d,this)*this.scaleFactor),[a,s]=this.parentDimensions;this.width=n/a,this.height=r/s,_classPrivateFieldSet(h,this,n/r),_assertClassBrand(A,this,Y).call(this);const o=this.translationX,c=this.translationY;this.translationX=-t[0],this.translationY=-t[1],_assertClassBrand(A,this,N).call(this),_assertClassBrand(A,this,k).call(this),_classPrivateFieldSet(w,this,n),_classPrivateFieldSet(_,this,r),this.setDims(n,r);const p=e?i/this.scaleFactor/2:0;this.translate(o-this.translationX-p,c-this.translationY-p)}function Y(){const{style:e}=this.div;_classPrivateFieldGet(h,this)>=1?(e.minHeight="".concat(l,"px"),e.minWidth="".concat(Math.round(_classPrivateFieldGet(h,this)*l),"px")):(e.minWidth="".concat(l,"px"),e.minHeight="".concat(Math.round(l/_classPrivateFieldGet(h,this)),"px"))}n=E,_defineProperty(E,"_defaultColor",null),_defineProperty(E,"_defaultOpacity",1),_defineProperty(E,"_defaultThickness",1),_defineProperty(E,"_l10nPromise",void 0),_defineProperty(E,"_type","ink"),t.InkEditor=E},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fitCurve=void 0;const n=i(31);t.fitCurve=n},e=>{function t(e,r,a,s,o){var c,h,d,u,p,f,m,g,v,y,b,x,w;if(2===e.length)return x=l.vectorLen(l.subtract(e[0],e[1]))/3,[c=[e[0],l.addArrays(e[0],l.mulItems(r,x)),l.addArrays(e[1],l.mulItems(a,x)),e[1]]];if(h=function(e){var t,i,n,r=[];return e.forEach(((e,a)=>{t=a?i+l.vectorLen(l.subtract(e,n)):0,r.push(t),i=t,n=e})),r=r.map((e=>e/i))}(e),[c,u,f]=i(e,h,h,r,a,o),0===u||u<s)return[c];if(u<s*s)for(d=h,p=u,m=f,w=0;w<20;w++){if(d=n(c,e,d),[c,u,f]=i(e,h,d,r,a,o),u<s)return[c];if(f===m){let e=u/p;if(e>.9999&&e<1.0001)break}p=u,m=f}return b=[],(g=l.subtract(e[f-1],e[f+1])).every((e=>0===e))&&(g=l.subtract(e[f-1],e[f]),[g[0],g[1]]=[-g[1],g[0]]),v=l.normalize(g),y=l.mulItems(v,-1),b=(b=b.concat(t(e.slice(0,f+1),r,v,s,o))).concat(t(e.slice(f),y,a,s,o))}function i(e,t,i,n,r,o){var h,d,u;return h=function(e,t,i,n){var r,a,s,o,h,d,u,p,f,m,g,v,y,b,x,w,_,S=e[0],A=e[e.length-1];for(r=[S,null,null,A],a=l.zeros_Xx2x2(t.length),y=0,b=t.length;y<b;y++)_=1-(w=t[y]),(s=a[y])[0]=l.mulItems(i,3*w*(_*_)),s[1]=l.mulItems(n,3*_*(w*w));for(o=[[0,0],[0,0]],h=[0,0],y=0,b=e.length;y<b;y++)w=t[y],s=a[y],o[0][0]+=l.dot(s[0],s[0]),o[0][1]+=l.dot(s[0],s[1]),o[1][0]+=l.dot(s[0],s[1]),o[1][1]+=l.dot(s[1],s[1]),x=l.subtract(e[y],c.q([S,S,A,A],w)),h[0]+=l.dot(s[0],x),h[1]+=l.dot(s[1],x);return d=o[0][0]*o[1][1]-o[1][0]*o[0][1],u=o[0][0]*h[1]-o[1][0]*h[0],p=h[0]*o[1][1]-h[1]*o[0][1],f=0===d?0:p/d,m=0===d?0:u/d,v=l.vectorLen(l.subtract(S,A)),f<(g=1e-6*v)||m<g?(r[1]=l.addArrays(S,l.mulItems(i,v/3)),r[2]=l.addArrays(A,l.mulItems(n,v/3))):(r[1]=l.addArrays(S,l.mulItems(i,f)),r[2]=l.addArrays(A,l.mulItems(n,m))),r}(e,i,n,r),[d,u]=function(e,t,i){var n,r,o,h,d,u,p,f;r=0,o=Math.floor(e.length/2);const m=a(t,10);for(d=0,u=e.length;d<u;d++)p=e[d],f=s(0,i[d],m,10),(n=(h=l.subtract(c.q(t,f),p))[0]*h[0]+h[1]*h[1])>r&&(r=n,o=d);return[r,o]}(e,h,t),o&&o({bez:h,points:e,params:t,maxErr:d,maxPoint:u}),[h,d,u]}function n(e,t,i){return i.map(((i,n)=>r(e,t[n],i)))}function r(e,t,i){var n=l.subtract(c.q(e,i),t),r=c.qprime(e,i),a=l.mulMatrix(n,r),s=l.sum(l.squareItems(r))+2*l.mulMatrix(n,c.qprimeprime(e,i));return 0===s?i:i-a/s}var a=function(e,t){for(var i,n=[0],r=e[0],a=0,s=1;s<=t;s++)i=c.q(e,s/t),a+=l.vectorLen(l.subtract(i,r)),n.push(a),r=i;return n=n.map((e=>e/a))};function s(e,t,i,n){if(t<0)return 0;if(t>1)return 1;for(var r,a,s,o,l=1;l<=n;l++)if(t<=i[l]){s=(l-1)/n,a=l/n,o=(t-(r=i[l-1]))/(i[l]-r)*(a-s)+s;break}return o}function o(e,t){return l.normalize(l.subtract(e,t))}class l{static zeros_Xx2x2(e){for(var t=[];e--;)t.push([0,0]);return t}static mulItems(e,t){return e.map((e=>e*t))}static mulMatrix(e,t){return e.reduce(((e,i,n)=>e+i*t[n]),0)}static subtract(e,t){return e.map(((e,i)=>e-t[i]))}static addArrays(e,t){return e.map(((e,i)=>e+t[i]))}static addItems(e,t){return e.map((e=>e+t))}static sum(e){return e.reduce(((e,t)=>e+t))}static dot(e,t){return l.mulMatrix(e,t)}static vectorLen(e){return Math.hypot(...e)}static divItems(e,t){return e.map((e=>e/t))}static squareItems(e){return e.map((e=>e*e))}static normalize(e){return this.divItems(e,this.vectorLen(e))}}class c{static q(e,t){var i=1-t,n=l.mulItems(e[0],i*i*i),r=l.mulItems(e[1],3*i*i*t),a=l.mulItems(e[2],3*i*t*t),s=l.mulItems(e[3],t*t*t);return l.addArrays(l.addArrays(n,r),l.addArrays(a,s))}static qprime(e,t){var i=1-t,n=l.mulItems(l.subtract(e[1],e[0]),3*i*i),r=l.mulItems(l.subtract(e[2],e[1]),6*i*t),a=l.mulItems(l.subtract(e[3],e[2]),3*t*t);return l.addArrays(l.addArrays(n,r),a)}static qprimeprime(e,t){return l.addArrays(l.mulItems(l.addArrays(l.subtract(e[2],l.mulItems(e[1],2)),e[0]),6*(1-t)),l.mulItems(l.addArrays(l.subtract(e[3],l.mulItems(e[2],2)),e[1]),6*t))}}e.exports=function(e,i,n){if(!Array.isArray(e))throw new TypeError("First argument should be an array");if(e.forEach((t=>{if(!Array.isArray(t)||t.some((e=>"number"!==typeof e))||t.length!==e[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")})),(e=e.filter(((t,i)=>0===i||!t.every(((t,n)=>t===e[i-1][n]))))).length<2)return[];const r=e.length,a=o(e[1],e[0]),s=o(e[r-2],e[r-1]);return t(e,a,s,i,n)},e.exports.fitCubic=t,e.exports.createTangent=o},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationLayer=void 0;var n=i(1),r=i(6),a=i(3),s=i(33),o=i(34);const l=1e3,c=new WeakSet;function h(e){return{width:e[2]-e[0],height:e[3]-e[1]}}class d{static create(e){switch(e.data.annotationType){case n.AnnotationType.LINK:return new f(e);case n.AnnotationType.TEXT:return new v(e);case n.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new b(e);case"Btn":return e.data.radioButton?new w(e):e.data.checkBox?new x(e):new _(e);case"Ch":return new S(e)}return new y(e);case n.AnnotationType.POPUP:return new A(e);case n.AnnotationType.FREETEXT:return new C(e);case n.AnnotationType.LINE:return new M(e);case n.AnnotationType.SQUARE:return new P(e);case n.AnnotationType.CIRCLE:return new T(e);case n.AnnotationType.POLYLINE:return new D(e);case n.AnnotationType.CARET:return new O(e);case n.AnnotationType.INK:return new I(e);case n.AnnotationType.POLYGON:return new R(e);case n.AnnotationType.HIGHLIGHT:return new k(e);case n.AnnotationType.UNDERLINE:return new L(e);case n.AnnotationType.SQUIGGLY:return new F(e);case n.AnnotationType.STRIKEOUT:return new B(e);case n.AnnotationType.STAMP:return new N(e);case n.AnnotationType.FILEATTACHMENT:return new z(e);default:return new u(e)}}}class u{constructor(e){let{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,t&&(this.container=this._createContainer(i)),n&&(this.quadrilaterals=this._createQuadrilaterals(i))}_createContainer(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{data:t,page:i,viewport:r}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",t.id);const{pageWidth:s,pageHeight:o,pageX:l,pageY:c}=r.rawDims,{width:d,height:u}=h(t.rect),p=n.Util.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]);if(!e&&t.borderStyle.width>0){a.style.borderWidth="".concat(t.borderStyle.width,"px");const e=t.borderStyle.horizontalCornerRadius,i=t.borderStyle.verticalCornerRadius;if(e>0||i>0){const t="calc(".concat(e,"px * var(--scale-factor)) / calc(").concat(i,"px * var(--scale-factor))");a.style.borderRadius=t}else if(this instanceof w){const e="calc(".concat(d,"px * var(--scale-factor)) / calc(").concat(u,"px * var(--scale-factor))");a.style.borderRadius=e}switch(t.borderStyle.style){case n.AnnotationBorderStyleType.SOLID:a.style.borderStyle="solid";break;case n.AnnotationBorderStyleType.DASHED:a.style.borderStyle="dashed";break;case n.AnnotationBorderStyleType.BEVELED:(0,n.warn)("Unimplemented border style: beveled");break;case n.AnnotationBorderStyleType.INSET:(0,n.warn)("Unimplemented border style: inset");break;case n.AnnotationBorderStyleType.UNDERLINE:a.style.borderBottomStyle="solid"}const r=t.borderColor||null;r?a.style.borderColor=n.Util.makeHexColor(0|r[0],0|r[1],0|r[2]):a.style.borderWidth=0}a.style.left="".concat(100*(p[0]-l)/s,"%"),a.style.top="".concat(100*(p[1]-c)/o,"%");const{rotation:f}=t;return t.hasOwnCanvas||0===f?(a.style.width="".concat(100*d/s,"%"),a.style.height="".concat(100*u/o,"%")):this.setRotation(f,a),a}setRotation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;const{pageWidth:i,pageHeight:n}=this.viewport.rawDims,{width:r,height:a}=h(this.data.rect);let s,o;e%180===0?(s=100*r/i,o=100*a/n):(s=100*a/i,o=100*r/n),t.style.width="".concat(s,"%"),t.style.height="".concat(o,"%"),t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(e,t,i)=>{const n=i.detail[e];i.target.style[t]=s.ColorConverters["".concat(n[0],"_HTML")](n.slice(1))};return(0,n.shadow)(this,"_commonActions",{display:e=>{const t=e.detail.display%2===1;this.container.style.visibility=t?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:t,print:0===e.detail.display||3===e.detail.display})},print:e=>{this.annotationStorage.setValue(this.data.id,{print:e.detail.print})},hidden:e=>{this.container.style.visibility=e.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:e.detail.hidden})},focus:e=>{setTimeout((()=>e.target.focus({preventScroll:!1})),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.detail.readonly?e.target.setAttribute("readonly",""):e.target.removeAttribute("readonly")},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:e=>{const t=e.detail.rotation;this.setRotation(t),this.annotationStorage.setValue(this.data.id,{rotation:t})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const n of Object.keys(t.detail)){const r=e[n]||i[n];null===r||void 0===r||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[n,r]of Object.entries(t)){const a=i[n];a&&(a({detail:{[n]:r},target:e}),delete t[n])}}_createQuadrilaterals(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.data.quadPoints)return null;const t=[],i=this.data.rect;for(const n of this.data.quadPoints)this.data.rect=[n[2].x,n[2].y,n[1].x,n[1].y],t.push(this._createContainer(e));return this.data.rect=i,t}_createPopup(e,t){let i=this.container;this.quadrilaterals&&(e=e||this.quadrilaterals,i=this.quadrilaterals[0]),e||((e=document.createElement("div")).className="popupTriggerArea",i.append(e));const n=new E({container:i,trigger:e,color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,hideWrapper:!0}).render();n.style.left="100%",i.append(n)}_renderQuadrilaterals(e){for(const t of this.quadrilaterals)t.className=e;return this.quadrilaterals}render(){(0,n.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:e,id:a,exportValues:s}of r){if(-1===e)continue;if(a===t)continue;const r="string"===typeof s?s:null,o=document.querySelector('[data-element-id="'.concat(a,'"]'));!o||c.has(o)?i.push({id:a,exportValue:r,domElement:o}):(0,n.warn)("_getElementsByName - element not allowed: ".concat(a))}return i}for(const n of document.getElementsByName(e)){const{exportValue:e}=n,r=n.getAttribute("data-element-id");r!==t&&c.has(n)&&i.push({id:r,exportValue:e,domElement:n})}return i}}var p=new WeakSet;class f extends u{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(e,{isRenderable:!0,ignoreBorder:!(null===t||void 0===t||!t.ignoreBorder),createQuadrilaterals:!0}),_classPrivateMethodInitSpec(this,p),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let n=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(i,e.action),n=!0):e.attachment?(this._bindAttachment(i,e.attachment),n=!0):e.setOCGState?(_assertClassBrand(p,this,g).call(this,i,e.setOCGState),n=!0):e.dest?(this._bindLink(i,e.dest),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),n=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map(((e,t)=>{const n=0===t?i:i.cloneNode();return e.append(n),e})):(this.container.className="linkAnnotation",n&&this.container.append(i),this.container)}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||""===t)&&_assertClassBrand(p,this,m).call(this)}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),_assertClassBrand(p,this,m).call(this)}_bindAttachment(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>{var e;return null===(e=this.downloadManager)||void 0===e||e.openOrDownloadData(this.container,t.content,t.filename),!1},_assertClassBrand(p,this,m).call(this)}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(t.actions)){const r=i.get(n);r&&(e[r]=()=>{var e;return null===(e=this.linkService.eventBus)||void 0===e||e.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:n}}),!1})}e.onclick||(e.onclick=()=>!1),_assertClassBrand(p,this,m).call(this)}_bindResetFormAction(e,t){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),_assertClassBrand(p,this,m).call(this),!this._fieldObjects)return(0,n.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(i||(e.onclick=()=>!1));e.onclick=()=>{null===i||void 0===i||i();const{fields:e,refs:r,include:a}=t,s=[];if(0!==e.length||0!==r.length){const t=new Set(r);for(const i of e){const e=this._fieldObjects[i]||[];for(const{id:i}of e)t.add(i)}for(const e of Object.values(this._fieldObjects))for(const i of e)t.has(i.id)===a&&s.push(i)}else for(const t of Object.values(this._fieldObjects))s.push(...t);const o=this.annotationStorage,l=[];for(const t of s){const{id:e}=t;switch(l.push(e),t.type){case"text":{const i=t.defaultValue||"";o.setValue(e,{value:i});break}case"checkbox":case"radiobutton":{const i=t.defaultValue===t.exportValues;o.setValue(e,{value:i});break}case"combobox":case"listbox":{const i=t.defaultValue||"";o.setValue(e,{value:i});break}default:continue}const i=document.querySelector('[data-element-id="'.concat(e,'"]'));i&&(c.has(i)?i.dispatchEvent(new Event("resetform")):(0,n.warn)("_bindResetFormAction - element not allowed: ".concat(e)))}var h;return this.enableScripting&&(null===(h=this.linkService.eventBus)||void 0===h||h.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:l,name:"ResetForm"}})),!1}}}function m(){this.container.setAttribute("data-internal-link","")}function g(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),_assertClassBrand(p,this,m).call(this)}class v extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str)})}render(){this.container.className="textAnnotation";const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(e,this.data),this.container.append(e),this.container}}class y extends u{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(e){const{isWin:t,isMac:i}=n.FeatureTest.platform;return t&&e.ctrlKey||i&&e.metaKey}_setEventListener(e,t,i,n){t.includes("mouse")?e.addEventListener(t,(e=>{var t;null===(t=this.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(e),shift:e.shiftKey,modifier:this._getKeyModifier(e)}})})):e.addEventListener(t,(e=>{var t;null===(t=this.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(e)}})}))}_setEventListeners(e,t,i){for(const[r,a]of t){var n;("Action"===a||null!==(n=this.data.actions)&&void 0!==n&&n[a])&&this._setEventListener(e,r,a,i)}}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=null===t?"transparent":n.Util.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||9,a=e.style;let s;const o=e=>Math.round(10*e)/10;if(this.data.multiLine){const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2),t=e/(Math.round(e/(n.LINE_FACTOR*r))||1);s=Math.min(r,o(t/n.LINE_FACTOR))}else{const e=Math.abs(this.data.rect[3]-this.data.rect[1]-2);s=Math.min(r,o(e/n.LINE_FACTOR))}a.fontSize="calc(".concat(s,"px * var(--scale-factor))"),a.color=n.Util.makeHexColor(i[0],i[1],i[2]),null!==this.data.textAlignment&&(a.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class b extends y{constructor(e){super(e,{isRenderable:e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue})}setPropertyOnSiblings(e,t,i,n){const r=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=i),r.setValue(a.id,{[n]:i})}render(){const e=this.annotationStorage,t=this.data.id;this.container.className="textWidgetAnnotation";let i=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let a=r.formattedValue||r.value||"";const s=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;s&&a.length>s&&(a=a.slice(0,s));const o={userValue:a,formattedValue:null,lastCommittedValue:null,commitKey:1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=a,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type="text",i.setAttribute("value",a),this.data.doNotScroll&&(i.style.overflowX="hidden")),c.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=l,this._setRequired(i,this.data.required),s&&(i.maxLength=s),i.addEventListener("input",(n=>{e.setValue(t,{value:n.target.value}),this.setPropertyOnSiblings(i,"value",n.target.value,"value")})),i.addEventListener("resetform",(e=>{var t;const n=null!==(t=this.data.defaultFieldValue)&&void 0!==t?t:"";i.value=o.userValue=n,o.formattedValue=null}));let h=e=>{const{formattedValue:t}=o;null!==t&&void 0!==t&&(e.target.value=t),e.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var n;i.addEventListener("focus",(e=>{const{target:t}=e;o.userValue&&(t.value=o.userValue),o.lastCommittedValue=t.value,o.commitKey=1})),i.addEventListener("updatefromsandbox",(i=>{const n={value(i){var n;o.userValue=null!==(n=i.detail.value)&&void 0!==n?n:"",e.setValue(t,{value:o.userValue.toString()}),i.target.value=o.userValue},formattedValue(i){const{formattedValue:n}=i.detail;o.formattedValue=n,null!==n&&void 0!==n&&i.target!==document.activeElement&&(i.target.value=n),e.setValue(t,{formattedValue:n})},selRange(e){e.target.setSelectionRange(...e.detail.selRange)},charLimit:i=>{var n;const{charLimit:r}=i.detail,{target:a}=i;if(0===r)return void a.removeAttribute("maxLength");a.setAttribute("maxLength",r);let s=o.userValue;!s||s.length<=r||(s=s.slice(0,r),a.value=o.userValue=s,e.setValue(t,{value:s}),null===(n=this.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:s,willCommit:!0,commitKey:1,selStart:a.selectionStart,selEnd:a.selectionEnd}}))}};this._dispatchEventFromSandbox(n,i)})),i.addEventListener("keydown",(e=>{var i;o.commitKey=1;let n=-1;if("Escape"===e.key?n=0:"Enter"!==e.key||this.data.multiLine?"Tab"===e.key&&(o.commitKey=3):n=2,-1===n)return;const{value:r}=e.target;o.lastCommittedValue!==r&&(o.lastCommittedValue=r,o.userValue=r,null===(i=this.linkService.eventBus)||void 0===i||i.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:r,willCommit:!0,commitKey:n,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}));const r=h;h=null,i.addEventListener("blur",(e=>{if(!e.relatedTarget)return;const{value:i}=e.target;var n;o.userValue=i,o.lastCommittedValue!==i&&(null===(n=this.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:i,willCommit:!0,commitKey:o.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}})),r(e)})),null!==(n=this.data.actions)&&void 0!==n&&n.Keystroke&&i.addEventListener("beforeinput",(e=>{var i;o.lastCommittedValue=null;const{data:n,target:r}=e,{value:a,selectionStart:s,selectionEnd:l}=r;let c=s,h=l;switch(e.inputType){case"deleteWordBackward":{const e=a.substring(0,s).match(/\w*[^\w]*$/);e&&(c-=e[0].length);break}case"deleteWordForward":{const e=a.substring(s).match(/^[^\w]*\w*/);e&&(h+=e[0].length);break}case"deleteContentBackward":s===l&&(c-=1);break;case"deleteContentForward":s===l&&(h+=1)}e.preventDefault(),null===(i=this.linkService.eventBus)||void 0===i||i.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:a,change:n||"",willCommit:!1,selStart:c,selEnd:h}})})),this._setEventListeners(i,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.value))}if(h&&i.addEventListener("blur",h),this.data.comb){const e=(this.data.rect[2]-this.data.rect[0])/s;i.classList.add("comb"),i.style.letterSpacing="calc(".concat(e,"px * var(--scale-factor) - 1ch)")}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell";return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class x extends y{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let n=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;"string"===typeof n&&(n="Off"!==n,e.setValue(i,{value:n})),this.container.className="buttonWidgetAnnotation checkBox";const r=document.createElement("input");return c.add(r),r.setAttribute("data-element-id",i),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,n&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=l,r.addEventListener("change",(n=>{const{name:r,checked:a}=n.target;for(const s of this._getElementsByName(r,i)){const i=a&&s.exportValue===t.exportValue;s.domElement&&(s.domElement.checked=i),e.setValue(s.id,{value:i})}e.setValue(i,{value:a})})),r.addEventListener("resetform",(e=>{const i=t.defaultFieldValue||"Off";e.target.checked=i===t.exportValue})),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",(t=>{const n={value(t){t.target.checked="Off"!==t.detail.value,e.setValue(i,{value:t.target.checked})}};this._dispatchEventFromSandbox(n,t)})),this._setEventListeners(r,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class w extends y{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";const e=this.annotationStorage,t=this.data,i=t.id;let n=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;"string"===typeof n&&(n=n!==t.buttonValue,e.setValue(i,{value:n}));const r=document.createElement("input");if(c.add(r),r.setAttribute("data-element-id",i),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,n&&r.setAttribute("checked",!0),r.tabIndex=l,r.addEventListener("change",(t=>{const{name:n,checked:r}=t.target;for(const a of this._getElementsByName(n,i))e.setValue(a.id,{value:!1});e.setValue(i,{value:r})})),r.addEventListener("resetform",(e=>{const i=t.defaultFieldValue;e.target.checked=null!==i&&void 0!==i&&i===t.buttonValue})),this.enableScripting&&this.hasJSActions){const n=t.buttonValue;r.addEventListener("updatefromsandbox",(t=>{const r={value:t=>{const r=n===t.detail.value;for(const n of this._getElementsByName(t.target.name)){const t=r&&n.id===i;n.domElement&&(n.domElement.checked=t),e.setValue(n.id,{value:t})}}};this._dispatchEventFromSandbox(r,t)})),this._setEventListeners(r,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(e=>e.target.checked))}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class _ extends f{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(e.title=this.data.alternativeText);const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",(e=>{this._dispatchEventFromSandbox({},e)}))),e}}class S extends y{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.className="choiceWidgetAnnotation";const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),n=document.createElement("select");c.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=l;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",(e=>{const t=this.data.defaultFieldValue;for(const i of n.options)i.selected=i.value===t}));for(const l of this.data.options){const e=document.createElement("option");e.textContent=l.displayValue,e.value=l.exportValue,i.value.includes(l.exportValue)&&(e.setAttribute("selected",!0),r=!1),n.append(e)}let a=null;if(r){const e=document.createElement("option");e.value=" ",e.setAttribute("hidden",!0),e.setAttribute("selected",!0),n.prepend(e),a=()=>{e.remove(),n.removeEventListener("input",a),a=null},n.addEventListener("input",a)}const s=e=>{const t=e?"value":"textContent",{options:i,multiple:r}=n;return r?Array.prototype.filter.call(i,(e=>e.selected)).map((e=>e[t])):-1===i.selectedIndex?null:i[i.selectedIndex][t]};let o=s(!1);const h=e=>{const t=e.target.options;return Array.prototype.map.call(t,(e=>({displayValue:e.textContent,exportValue:e.value})))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",(i=>{const r={value(i){var r;null===(r=a)||void 0===r||r();const l=i.detail.value,c=new Set(Array.isArray(l)?l:[l]);for(const e of n.options)e.selected=c.has(e.value);e.setValue(t,{value:s(!0)}),o=s(!1)},multipleSelection(e){n.multiple=!0},remove(i){const r=n.options,a=i.detail.remove;r[a].selected=!1,n.remove(a),r.length>0&&-1===Array.prototype.findIndex.call(r,(e=>e.selected))&&(r[0].selected=!0),e.setValue(t,{value:s(!0),items:h(i)}),o=s(!1)},clear(i){for(;0!==n.length;)n.remove(0);e.setValue(t,{value:null,items:[]}),o=s(!1)},insert(i){const{index:r,displayValue:a,exportValue:l}=i.detail.insert,c=n.children[r],d=document.createElement("option");d.textContent=a,d.value=l,c?c.before(d):n.append(d),e.setValue(t,{value:s(!0),items:h(i)}),o=s(!1)},items(i){const{items:r}=i.detail;for(;0!==n.length;)n.remove(0);for(const e of r){const{displayValue:t,exportValue:i}=e,r=document.createElement("option");r.textContent=t,r.value=i,n.append(r)}n.options.length>0&&(n.options[0].selected=!0),e.setValue(t,{value:s(!0),items:h(i)}),o=s(!1)},indices(i){const n=new Set(i.detail.indices);for(const e of i.target.options)e.selected=n.has(e.index);e.setValue(t,{value:s(!0)}),o=s(!1)},editable(e){e.target.disabled=!e.detail.editable}};this._dispatchEventFromSandbox(r,i)})),n.addEventListener("input",(i=>{var n;const r=s(!0);e.setValue(t,{value:r}),i.preventDefault(),null===(n=this.linkService.eventBus)||void 0===n||n.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:o,changeEx:r,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(n,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(e=>e.target.value))):n.addEventListener("input",(function(i){e.setValue(t,{value:s(!0)})})),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class A extends u{constructor(e){var t,i,n;const{data:r}=e;super(e,{isRenderable:!A.IGNORE_TYPES.has(r.parentType)&&!!(null!==(t=r.titleObj)&&void 0!==t&&t.str||null!==(i=r.contentsObj)&&void 0!==i&&i.str||null!==(n=r.richText)&&void 0!==n&&n.str)})}render(){this.container.className="popupAnnotation";const e=this.layer.querySelectorAll('[data-annotation-id="'.concat(this.data.parentId,'"]'));if(0===e.length)return this.container;const t=new E({container:this.container,trigger:Array.from(e),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),i=this.page,r=n.Util.normalizeRect([this.data.parentRect[0],i.view[3]-this.data.parentRect[1]+i.view[1],this.data.parentRect[2],i.view[3]-this.data.parentRect[3]+i.view[1]]),a=r[0]+this.data.parentRect[2]-this.data.parentRect[0],s=r[1],{pageWidth:o,pageHeight:l,pageX:c,pageY:h}=this.viewport.rawDims;return this.container.style.left="".concat(100*(a-c)/o,"%"),this.container.style.top="".concat(100*(s-h)/l,"%"),this.container.append(t.render()),this.container}}_defineProperty(A,"IGNORE_TYPES",new Set(["Line","Square","Circle","PolyLine","Polygon","Ink"]));class E{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.titleObj=e.titleObj,this.modificationDate=e.modificationDate,this.contentsObj=e.contentsObj,this.richText=e.richText,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){var e,t;const i=document.createElement("div");i.className="popupWrapper",this.hideElement=this.hideWrapper?i:this.container,this.hideElement.hidden=!0;const a=document.createElement("div");a.className="popup";const s=this.color;if(s){const e=.7*(255-s[0])+s[0],t=.7*(255-s[1])+s[1],i=.7*(255-s[2])+s[2];a.style.backgroundColor=n.Util.makeHexColor(0|e,0|t,0|i)}const l=document.createElement("h1");l.dir=this.titleObj.dir,l.textContent=this.titleObj.str,a.append(l);const c=r.PDFDateString.toDateObject(this.modificationDate);if(c){const e=document.createElement("span");e.className="popupDate",e.textContent="{{date}}, {{time}}",e.dataset.l10nId="annotation_date_string",e.dataset.l10nArgs=JSON.stringify({date:c.toLocaleDateString(),time:c.toLocaleTimeString()}),a.append(e)}if(null===(e=this.richText)||void 0===e||!e.str||null!==(t=this.contentsObj)&&void 0!==t&&t.str&&this.contentsObj.str!==this.richText.str){const e=this._formatContents(this.contentsObj);a.append(e)}else o.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:a}),a.lastChild.className="richText popupContent";Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const n of this.trigger)n.addEventListener("click",this._toggle.bind(this)),n.addEventListener("mouseover",this._show.bind(this,!1)),n.addEventListener("mouseout",this._hide.bind(this,!1));return a.addEventListener("click",this._hide.bind(this,!0)),i.append(a),i}_formatContents(e){let{str:t,dir:i}=e;const n=document.createElement("p");n.className="popupContent",n.dir=i;const r=t.split(/(?:\r\n?|\n)/);for(let a=0,s=r.length;a<s;++a){const e=r[a];n.append(document.createTextNode(e)),a<s-1&&n.append(document.createElement("br"))}return n}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.pinned=!1),this.hideElement.hidden||this.pinned||(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class C extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0}),this.textContent=e.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){const e=document.createElement("div");e.className="annotationTextContent",e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class M extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0})}render(){this.container.className="lineAnnotation";const e=this.data,{width:t,height:i}=h(e.rect),n=this.svgFactory.create(t,i,!0),r=this.svgFactory.createElement("svg:line");return r.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),r.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),r.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),r.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),r.setAttribute("stroke-width",e.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),this._createPopup(r,e),this.container}}class P extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0})}render(){this.container.className="squareAnnotation";const e=this.data,{width:t,height:i}=h(e.rect),n=this.svgFactory.create(t,i,!0),r=e.borderStyle.width,a=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",r/2),a.setAttribute("y",r/2),a.setAttribute("width",t-r),a.setAttribute("height",i-r),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),this._createPopup(a,e),this.container}}class T extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0})}render(){this.container.className="circleAnnotation";const e=this.data,{width:t,height:i}=h(e.rect),n=this.svgFactory.create(t,i,!0),r=e.borderStyle.width,a=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",t/2),a.setAttribute("cy",i/2),a.setAttribute("rx",t/2-r/2),a.setAttribute("ry",i/2-r/2),a.setAttribute("stroke-width",r||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),this._createPopup(a,e),this.container}}class D extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,{width:t,height:i}=h(e.rect),n=this.svgFactory.create(t,i,!0);let r=[];for(const s of e.vertices){const t=s.x-e.rect[0],i=e.rect[3]-s.y;r.push(t+","+i)}r=r.join(" ");const a=this.svgFactory.createElement(this.svgElementName);return a.setAttribute("points",r),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),this._createPopup(a,e),this.container}}class R extends D{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class O extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class I extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;const e=this.data,{width:t,height:i}=h(e.rect),n=this.svgFactory.create(t,i,!0);for(const r of e.inkLists){let t=[];for(const n of r){const i=n.x-e.rect[0],r=e.rect[3]-n.y;t.push("".concat(i,",").concat(r))}t=t.join(" ");const i=this.svgFactory.createElement(this.svgElementName);i.setAttribute("points",t),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),this._createPopup(i,e),n.append(i)}return this.container.append(n),this.container}}class k extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class L extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class F extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class B extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class N extends u{constructor(e){var t,i,n;super(e,{isRenderable:!!(e.data.hasPopup||null!==(t=e.data.titleObj)&&void 0!==t&&t.str||null!==(i=e.data.contentsObj)&&void 0!==i&&i.str||null!==(n=e.data.richText)&&void 0!==n&&n.str),ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class z extends u{constructor(e){var t;super(e,{isRenderable:!0});const{filename:i,content:n}=this.data.file;this.filename=(0,r.getFilenameFromUrl)(i,!0),this.content=n,null===(t=this.linkService.eventBus)||void 0===t||t.dispatch("fileattachmentannotation",{source:this,filename:i,content:n})}render(){var e,t;let i;return this.container.className="fileAttachmentAnnotation",this.data.hasAppearance?i=document.createElement("div"):(i=document.createElement("img"),i.src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(this.data.name)?"paperclip":"pushpin",".svg")),i.className="popupTriggerArea",i.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(null!==(e=this.data.titleObj)&&void 0!==e&&e.str||null!==(t=this.data.contentsObj)&&void 0!==t&&t.str||this.data.richText)&&this._createPopup(i,this.data),this.container.append(i),this.container}_download(){var e;null===(e=this.downloadManager)||void 0===e||e.openOrDownloadData(this.container,this.content,this.filename)}}class U{static render(e){const{annotations:t,div:i,viewport:s,accessibilityManager:o}=e;(0,r.setLayerDimensions)(i,s);const l={data:null,layer:i,page:e.page,viewport:s,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new r.DOMSVGFactory,annotationStorage:e.annotationStorage||new a.AnnotationStorage,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects};let c=0;for(const r of t){if(r.annotationType!==n.AnnotationType.POPUP){const{width:e,height:t}=h(r.rect);if(e<=0||t<=0)continue}l.data=r;const e=d.create(l);if(!e.isRenderable)continue;const t=e.render();if(r.hidden&&(t.style.visibility="hidden"),Array.isArray(t))for(const n of t)n.style.zIndex=c++,j.call(U,n,r.id,i,o);else t.style.zIndex=c++,e instanceof A?i.prepend(t):j.call(U,t,r.id,i,o)}_assertClassBrand(U,this,V).call(this,i,e.annotationCanvasMap)}static update(e){const{annotationCanvasMap:t,div:i,viewport:n}=e;(0,r.setLayerDimensions)(i,{rotation:n.rotation}),_assertClassBrand(U,this,V).call(this,i,t),i.hidden=!1}}function j(e,t,i,n){const a=e.firstChild||e;a.id="".concat(r.AnnotationPrefix).concat(t),i.append(e),null===n||void 0===n||n.moveElementInDOM(i,e,a,!1)}function V(e,t){if(t){for(const[i,n]of t){const t=e.querySelector('[data-annotation-id="'.concat(i,'"]'));if(!t)continue;const{firstChild:r}=t;r?"CANVAS"===r.nodeName?r.replaceWith(n):r.before(n):t.append(n)}t.clear()}}t.AnnotationLayer=U},(e,t)=>{function i(e){return Math.floor(255*Math.max(0,Math.min(1,e))).toString(16).padStart(2,"0")}Object.defineProperty(t,"__esModule",{value:!0}),t.ColorConverters=void 0,t.ColorConverters=class{static CMYK_G(e){let[t,i,n,r]=e;return["G",1-Math.min(1,.3*t+.59*n+.11*i+r)]}static G_CMYK(e){let[t]=e;return["CMYK",0,0,0,1-t]}static G_RGB(e){let[t]=e;return["RGB",t,t,t]}static G_HTML(e){let[t]=e;const n=i(t);return"#".concat(n).concat(n).concat(n)}static RGB_G(e){let[t,i,n]=e;return["G",.3*t+.59*i+.11*n]}static RGB_HTML(e){let[t,n,r]=e;const a=i(t),s=i(n),o=i(r);return"#".concat(a).concat(s).concat(o)}static T_HTML(){return"#00000000"}static CMYK_RGB(e){let[t,i,n,r]=e;return["RGB",1-Math.min(1,t+r),1-Math.min(1,n+r),1-Math.min(1,i+r)]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK(e){let[t,i,n]=e;const r=1-t,a=1-i,s=1-n;return["CMYK",r,a,s,Math.min(r,a,s)]}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XfaLayer=void 0;var n=i(19);t.XfaLayer=class{static setupStorage(e,t,i,n,r){const a=n.getValue(t,{value:null});switch(i.name){case"textarea":if(null!==a.value&&(e.textContent=a.value),"print"===r)break;e.addEventListener("input",(e=>{n.setValue(t,{value:e.target.value})}));break;case"input":if("radio"===i.attributes.type||"checkbox"===i.attributes.type){if(a.value===i.attributes.xfaOn?e.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&e.removeAttribute("checked"),"print"===r)break;e.addEventListener("change",(e=>{n.setValue(t,{value:e.target.checked?e.target.getAttribute("xfaOn"):e.target.getAttribute("xfaOff")})}))}else{if(null!==a.value&&e.setAttribute("value",a.value),"print"===r)break;e.addEventListener("input",(e=>{n.setValue(t,{value:e.target.value})}))}break;case"select":if(null!==a.value)for(const e of i.children)e.attributes.value===a.value&&(e.attributes.selected=!0);e.addEventListener("input",(e=>{const i=e.target.options,r=-1===i.selectedIndex?"":i[i.selectedIndex].value;n.setValue(t,{value:r})}))}}static setAttributes(e){let{html:t,element:i,storage:n=null,intent:r,linkService:a}=e;const{attributes:s}=i,o=t instanceof HTMLAnchorElement;"radio"===s.type&&(s.name="".concat(s.name,"-").concat(r));for(const[l,c]of Object.entries(s))if(null!==c&&void 0!==c)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!o||"href"!==l&&"newWindow"!==l)&&t.setAttribute(l,c)}o&&a.addLinkAttributes(t,s.href,s.newWindow),n&&s.dataId&&this.setupStorage(t,s.dataId,i,n)}static render(e){const t=e.annotationStorage,i=e.linkService,r=e.xfaHtml,a=e.intent||"display",s=document.createElement(r.name);r.attributes&&this.setAttributes({html:s,element:r,intent:a,linkService:i});const o=[[r,-1,s]],l=e.div;if(l.append(s),e.viewport){const t="matrix(".concat(e.viewport.transform.join(","),")");l.style.transform=t}"richText"!==a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];for(;o.length>0;){var h;const[e,r,s]=o.at(-1);if(r+1===e.children.length){o.pop();continue}const l=e.children[++o.at(-1)[1]];if(null===l)continue;const{name:d}=l;if("#text"===d){const e=document.createTextNode(l.value);c.push(e),s.append(e);continue}let u;if(u=null!==l&&void 0!==l&&null!==(h=l.attributes)&&void 0!==h&&h.xmlns?document.createElementNS(l.attributes.xmlns,d):document.createElement(d),s.append(u),l.attributes&&this.setAttributes({html:u,element:l,storage:t,intent:a,linkService:i}),l.children&&l.children.length>0)o.push([l,-1,u]);else if(l.value){const e=document.createTextNode(l.value);n.XfaText.shouldBuildText(d)&&c.push(e),u.append(e)}}for(const n of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))n.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t="matrix(".concat(e.viewport.transform.join(","),")");e.div.style.transform=t,e.div.hidden=!1}}},(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SVGGraphics=void 0;var n=i(6),r=i(1),a=i(10);let s=class{constructor(){(0,r.unreachable)("Not implemented: SVGGraphics")}};t.SVGGraphics=s;{const o={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},l="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/1999/xlink",h=["butt","round","square"],d=["miter","round","bevel"],u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(URL.createObjectURL&&"undefined"!==typeof Blob&&!i)return URL.createObjectURL(new Blob([e],{type:t}));const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r="data:".concat(t,";base64,");for(let a=0,s=e.length;a<s;a+=3){const t=255&e[a],i=255&e[a+1],o=255&e[a+2];r+=n[t>>2]+n[(3&t)<<4|i>>4]+n[a+1<s?(15&i)<<2|o>>6:64]+n[a+2<s?63&o:64]}return r},p=function(){const e=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Int32Array(256);for(let r=0;r<256;r++){let e=r;for(let t=0;t<8;t++)e=1&e?3988292384^e>>1&2147483647:e>>1&2147483647;t[r]=e}function i(e,i,n,r){let a=r;const s=i.length;n[a]=s>>24&255,n[a+1]=s>>16&255,n[a+2]=s>>8&255,n[a+3]=255&s,a+=4,n[a]=255&e.charCodeAt(0),n[a+1]=255&e.charCodeAt(1),n[a+2]=255&e.charCodeAt(2),n[a+3]=255&e.charCodeAt(3),a+=4,n.set(i,a),a+=i.length;const o=function(e,i,n){let r=-1;for(let a=i;a<n;a++){const i=255&(r^e[a]);r=r>>>8^t[i]}return~r}(n,r+4,a);n[a]=o>>24&255,n[a+1]=o>>16&255,n[a+2]=o>>8&255,n[a+3]=255&o}function n(e){let t=e.length;const i=65535,n=Math.ceil(t/i),r=new Uint8Array(2+t+5*n+4);let a=0;r[a++]=120,r[a++]=156;let s=0;for(;t>i;)r[a++]=0,r[a++]=255,r[a++]=255,r[a++]=0,r[a++]=0,r.set(e.subarray(s,s+i),a),a+=i,s+=i,t-=i;r[a++]=1,r[a++]=255&t,r[a++]=t>>8&255,r[a++]=255&~t,r[a++]=(65535&~t)>>8&255,r.set(e.subarray(s),a),a+=e.length-s;const o=function(e,t,i){let n=1,r=0;for(let a=t;a<i;++a)n=(n+(255&e[a]))%65521,r=(r+n)%65521;return r<<16|n}(e,0,e.length);return r[a++]=o>>24&255,r[a++]=o>>16&255,r[a++]=o>>8&255,r[a++]=255&o,r}function s(t,s,o,l){const c=t.width,h=t.height;let d,p,f;const m=t.data;switch(s){case r.ImageKind.GRAYSCALE_1BPP:p=0,d=1,f=c+7>>3;break;case r.ImageKind.RGB_24BPP:p=2,d=8,f=3*c;break;case r.ImageKind.RGBA_32BPP:p=6,d=8,f=4*c;break;default:throw new Error("invalid format")}const g=new Uint8Array((1+f)*h);let v=0,y=0;for(let e=0;e<h;++e)g[v++]=0,g.set(m.subarray(y,y+f),v),y+=f,v+=f;if(s===r.ImageKind.GRAYSCALE_1BPP&&l){v=0;for(let e=0;e<h;e++){v++;for(let e=0;e<f;e++)g[v++]^=255}}const b=new Uint8Array([c>>24&255,c>>16&255,c>>8&255,255&c,h>>24&255,h>>16&255,h>>8&255,255&h,d,p,0,0,0]),x=function(e){if(!a.isNodeJS)return n(e);try{let t;t=parseInt(process.versions.node)>=8?e:Buffer.from(e);const i=__webpack_require__(2787).deflateSync(t,{level:9});return i instanceof Uint8Array?i:new Uint8Array(i)}catch(t){(0,r.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+t)}return n(e)}(g),w=e.length+36+b.length+x.length,_=new Uint8Array(w);let S=0;return _.set(e,S),S+=e.length,i("IHDR",b,_,S),S+=12+b.length,i("IDATA",x,_,S),S+=12+x.length,i("IEND",new Uint8Array(0),_,S),u(_,"image/png",o)}return function(e,t,i){return s(e,void 0===e.kind?r.ImageKind.GRAYSCALE_1BPP:e.kind,t,i)}}();class f{constructor(){this.fontSizeScale=1,this.fontWeight=o.fontWeight,this.fontSize=0,this.textMatrix=r.IDENTITY_MATRIX,this.fontMatrix=r.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=r.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=o.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(e,t){this.x=e,this.y=t}}function m(e){let t=[];const i=[];for(const n of e)"save"!==n.fn?"restore"===n.fn?t=i.pop():t.push(n):(t.push({fnId:92,fn:"group",items:[]}),i.push(t),t=t.at(-1).items);return t}function g(e){if(Number.isInteger(e))return e.toString();const t=e.toFixed(10);let i=t.length-1;if("0"!==t[i])return t;do{i--}while("0"===t[i]);return t.substring(0,"."===t[i]?i:i+1)}function v(e){if(0===e[4]&&0===e[5]){if(0===e[1]&&0===e[2])return 1===e[0]&&1===e[3]?"":"scale(".concat(g(e[0])," ").concat(g(e[3]),")");if(e[0]===e[3]&&e[1]===-e[2]){const t=180*Math.acos(e[0])/Math.PI;return"rotate(".concat(g(t),")")}}else if(1===e[0]&&0===e[1]&&0===e[2]&&1===e[3])return"translate(".concat(g(e[4])," ").concat(g(e[5]),")");return"matrix(".concat(g(e[0])," ").concat(g(e[1])," ").concat(g(e[2])," ").concat(g(e[3])," ").concat(g(e[4])," ")+"".concat(g(e[5]),")")}let y=0,b=0,x=0;t.SVGGraphics=s=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,n.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new n.DOMSVGFactory,this.current=new f,this.transformMatrix=r.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=e,this.objs=t,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!i,this._operatorIdMapping=[];for(const n in r.OPS)this._operatorIdMapping[r.OPS[n]]=n}getObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"===typeof e?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}save(){this.transformStack.push(this.transformMatrix);const e=this.current;this.extraStack.push(e),this.current=e.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(e){this.save(),this.executeOpTree(e),this.restore()}loadDependencies(e){const t=e.fnArray,i=e.argsArray;for(let n=0,a=t.length;n<a;n++)if(t[n]===r.OPS.dependency)for(const e of i[n]){const t=e.startsWith("g_")?this.commonObjs:this.objs,i=new Promise((i=>{t.get(e,i)}));this.current.dependencies.push(i)}return Promise.all(this.current.dependencies)}transform(e,t,i,n,a,s){const o=[e,t,i,n,a,s];this.transformMatrix=r.Util.transform(this.transformMatrix,o),this.tgrp=null}getSVG(e,t){this.viewport=t;const i=this._initialize(t);return this.loadDependencies(e).then((()=>(this.transformMatrix=r.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(e)),i)))}convertOpList(e){const t=this._operatorIdMapping,i=e.argsArray,n=e.fnArray,r=[];for(let a=0,s=n.length;a<s;a++){const e=n[a];r.push({fnId:e,fn:t[e],args:i[a]})}return m(r)}executeOpTree(e){for(const t of e){const e=t.fn,i=t.fnId,n=t.args;switch(0|i){case r.OPS.beginText:this.beginText();break;case r.OPS.dependency:break;case r.OPS.setLeading:this.setLeading(n);break;case r.OPS.setLeadingMoveText:this.setLeadingMoveText(n[0],n[1]);break;case r.OPS.setFont:this.setFont(n);break;case r.OPS.showText:case r.OPS.showSpacedText:this.showText(n[0]);break;case r.OPS.endText:this.endText();break;case r.OPS.moveText:this.moveText(n[0],n[1]);break;case r.OPS.setCharSpacing:this.setCharSpacing(n[0]);break;case r.OPS.setWordSpacing:this.setWordSpacing(n[0]);break;case r.OPS.setHScale:this.setHScale(n[0]);break;case r.OPS.setTextMatrix:this.setTextMatrix(n[0],n[1],n[2],n[3],n[4],n[5]);break;case r.OPS.setTextRise:this.setTextRise(n[0]);break;case r.OPS.setTextRenderingMode:this.setTextRenderingMode(n[0]);break;case r.OPS.setLineWidth:this.setLineWidth(n[0]);break;case r.OPS.setLineJoin:this.setLineJoin(n[0]);break;case r.OPS.setLineCap:this.setLineCap(n[0]);break;case r.OPS.setMiterLimit:this.setMiterLimit(n[0]);break;case r.OPS.setFillRGBColor:this.setFillRGBColor(n[0],n[1],n[2]);break;case r.OPS.setStrokeRGBColor:this.setStrokeRGBColor(n[0],n[1],n[2]);break;case r.OPS.setStrokeColorN:this.setStrokeColorN(n);break;case r.OPS.setFillColorN:this.setFillColorN(n);break;case r.OPS.shadingFill:this.shadingFill(n[0]);break;case r.OPS.setDash:this.setDash(n[0],n[1]);break;case r.OPS.setRenderingIntent:this.setRenderingIntent(n[0]);break;case r.OPS.setFlatness:this.setFlatness(n[0]);break;case r.OPS.setGState:this.setGState(n[0]);break;case r.OPS.fill:this.fill();break;case r.OPS.eoFill:this.eoFill();break;case r.OPS.stroke:this.stroke();break;case r.OPS.fillStroke:this.fillStroke();break;case r.OPS.eoFillStroke:this.eoFillStroke();break;case r.OPS.clip:this.clip("nonzero");break;case r.OPS.eoClip:this.clip("evenodd");break;case r.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case r.OPS.paintImageXObject:this.paintImageXObject(n[0]);break;case r.OPS.paintInlineImageXObject:this.paintInlineImageXObject(n[0]);break;case r.OPS.paintImageMaskXObject:this.paintImageMaskXObject(n[0]);break;case r.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(n[0],n[1]);break;case r.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case r.OPS.closePath:this.closePath();break;case r.OPS.closeStroke:this.closeStroke();break;case r.OPS.closeFillStroke:this.closeFillStroke();break;case r.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case r.OPS.nextLine:this.nextLine();break;case r.OPS.transform:this.transform(n[0],n[1],n[2],n[3],n[4],n[5]);break;case r.OPS.constructPath:this.constructPath(n[0],n[1]);break;case r.OPS.endPath:this.endPath();break;case 92:this.group(t.items);break;default:(0,r.warn)("Unimplemented operator ".concat(e))}}}setWordSpacing(e){this.current.wordSpacing=e}setCharSpacing(e){this.current.charSpacing=e}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(e,t,i,n,r,a){const s=this.current;s.textMatrix=s.lineMatrix=[e,t,i,n,r,a],s.textMatrixScale=Math.hypot(e,t),s.x=s.lineX=0,s.y=s.lineY=0,s.xcoords=[],s.ycoords=[],s.tspan=this.svgFactory.createElement("svg:tspan"),s.tspan.setAttributeNS(null,"font-family",s.fontFamily),s.tspan.setAttributeNS(null,"font-size","".concat(g(s.fontSize),"px")),s.tspan.setAttributeNS(null,"y",g(-s.y)),s.txtElement=this.svgFactory.createElement("svg:text"),s.txtElement.append(s.tspan)}beginText(){const e=this.current;e.x=e.lineX=0,e.y=e.lineY=0,e.textMatrix=r.IDENTITY_MATRIX,e.lineMatrix=r.IDENTITY_MATRIX,e.textMatrixScale=1,e.tspan=this.svgFactory.createElement("svg:tspan"),e.txtElement=this.svgFactory.createElement("svg:text"),e.txtgrp=this.svgFactory.createElement("svg:g"),e.xcoords=[],e.ycoords=[]}moveText(e,t){const i=this.current;i.x=i.lineX+=e,i.y=i.lineY+=t,i.xcoords=[],i.ycoords=[],i.tspan=this.svgFactory.createElement("svg:tspan"),i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size","".concat(g(i.fontSize),"px")),i.tspan.setAttributeNS(null,"y",g(-i.y))}showText(e){const t=this.current,i=t.font,n=t.fontSize;if(0===n)return;const a=t.fontSizeScale,s=t.charSpacing,c=t.wordSpacing,h=t.fontDirection,d=t.textHScale*h,u=i.vertical,p=u?1:-1,f=i.defaultVMetrics,m=n*t.fontMatrix[0];let y=0;for(const r of e){if(null===r){y+=h*c;continue}if("number"===typeof r){y+=p*r*n/1e3;continue}const e=(r.isSpace?c:0)+s,o=r.fontChar;let l,d,g,v=r.width;if(u){let e;const t=r.vmetric||f;e=r.vmetric?t[1]:.5*v,e=-e*m;const i=t[2]*m;v=t?-t[0]:v,l=e/a,d=(y+i)/a}else l=y/a,d=0;(r.isInFont||i.missingFile)&&(t.xcoords.push(t.x+l),u&&t.ycoords.push(-t.y+d),t.tspan.textContent+=o),g=u?v*m-e*h:v*m+e*h,y+=g}t.tspan.setAttributeNS(null,"x",t.xcoords.map(g).join(" ")),u?t.tspan.setAttributeNS(null,"y",t.ycoords.map(g).join(" ")):t.tspan.setAttributeNS(null,"y",g(-t.y)),u?t.y-=y:t.x+=y*d,t.tspan.setAttributeNS(null,"font-family",t.fontFamily),t.tspan.setAttributeNS(null,"font-size","".concat(g(t.fontSize),"px")),t.fontStyle!==o.fontStyle&&t.tspan.setAttributeNS(null,"font-style",t.fontStyle),t.fontWeight!==o.fontWeight&&t.tspan.setAttributeNS(null,"font-weight",t.fontWeight);const b=t.textRenderingMode&r.TextRenderingMode.FILL_STROKE_MASK;if(b===r.TextRenderingMode.FILL||b===r.TextRenderingMode.FILL_STROKE?(t.fillColor!==o.fillColor&&t.tspan.setAttributeNS(null,"fill",t.fillColor),t.fillAlpha<1&&t.tspan.setAttributeNS(null,"fill-opacity",t.fillAlpha)):t.textRenderingMode===r.TextRenderingMode.ADD_TO_PATH?t.tspan.setAttributeNS(null,"fill","transparent"):t.tspan.setAttributeNS(null,"fill","none"),b===r.TextRenderingMode.STROKE||b===r.TextRenderingMode.FILL_STROKE){const e=1/(t.textMatrixScale||1);this._setStrokeAttributes(t.tspan,e)}let x=t.textMatrix;0!==t.textRise&&(x=x.slice(),x[5]+=t.textRise),t.txtElement.setAttributeNS(null,"transform","".concat(v(x)," scale(").concat(g(d),", -1)")),t.txtElement.setAttributeNS(l,"xml:space","preserve"),t.txtElement.append(t.tspan),t.txtgrp.append(t.txtElement),this._ensureTransformGroup().append(t.txtElement)}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}addFontStyle(e){if(!e.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const t=u(e.data,e.mimetype,this.forceDataSchema);this.cssStyle.textContent+='@font-face { font-family: "'.concat(e.loadedName,'";')+" src: url(".concat(t,"); }\n")}setFont(e){const t=this.current,i=this.commonObjs.get(e[0]);let n=e[1];t.font=i,!this.embedFonts||i.missingFile||this.embeddedFonts[i.loadedName]||(this.addFontStyle(i),this.embeddedFonts[i.loadedName]=i),t.fontMatrix=i.fontMatrix||r.FONT_IDENTITY_MATRIX;let a="normal";i.black?a="900":i.bold&&(a="bold");const s=i.italic?"italic":"normal";n<0?(n=-n,t.fontDirection=-1):t.fontDirection=1,t.fontSize=n,t.fontFamily=i.loadedName,t.fontWeight=a,t.fontStyle=s,t.tspan=this.svgFactory.createElement("svg:tspan"),t.tspan.setAttributeNS(null,"y",g(-t.y)),t.xcoords=[],t.ycoords=[]}endText(){var e;const t=this.current;t.textRenderingMode&r.TextRenderingMode.ADD_TO_PATH_FLAG&&null!==(e=t.txtElement)&&void 0!==e&&e.hasChildNodes()&&(t.element=t.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(e){e>0&&(this.current.lineWidth=e)}setLineCap(e){this.current.lineCap=h[e]}setLineJoin(e){this.current.lineJoin=d[e]}setMiterLimit(e){this.current.miterLimit=e}setStrokeAlpha(e){this.current.strokeAlpha=e}setStrokeRGBColor(e,t,i){this.current.strokeColor=r.Util.makeHexColor(e,t,i)}setFillAlpha(e){this.current.fillAlpha=e}setFillRGBColor(e,t,i){this.current.fillColor=r.Util.makeHexColor(e,t,i),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(e){this.current.strokeColor=this._makeColorN_Pattern(e)}setFillColorN(e){this.current.fillColor=this._makeColorN_Pattern(e)}shadingFill(e){const t=this.viewport.width,i=this.viewport.height,n=r.Util.inverseTransform(this.transformMatrix),a=r.Util.applyTransform([0,0],n),s=r.Util.applyTransform([0,i],n),o=r.Util.applyTransform([t,0],n),l=r.Util.applyTransform([t,i],n),c=Math.min(a[0],s[0],o[0],l[0]),h=Math.min(a[1],s[1],o[1],l[1]),d=Math.max(a[0],s[0],o[0],l[0]),u=Math.max(a[1],s[1],o[1],l[1]),p=this.svgFactory.createElement("svg:rect");p.setAttributeNS(null,"x",c),p.setAttributeNS(null,"y",h),p.setAttributeNS(null,"width",d-c),p.setAttributeNS(null,"height",u-h),p.setAttributeNS(null,"fill",this._makeShadingPattern(e)),this.current.fillAlpha<1&&p.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(p)}_makeColorN_Pattern(e){return"TilingPattern"===e[0]?this._makeTilingPattern(e):this._makeShadingPattern(e)}_makeTilingPattern(e){const t=e[1],i=e[2],n=e[3]||r.IDENTITY_MATRIX,[a,s,o,l]=e[4],c=e[5],h=e[6],d=e[7],u="shading".concat(x++),[p,f,m,g]=r.Util.normalizeRect([...r.Util.applyTransform([a,s],n),...r.Util.applyTransform([o,l],n)]),[v,y]=r.Util.singularValueDecompose2dScale(n),b=c*v,w=h*y,_=this.svgFactory.createElement("svg:pattern");_.setAttributeNS(null,"id",u),_.setAttributeNS(null,"patternUnits","userSpaceOnUse"),_.setAttributeNS(null,"width",b),_.setAttributeNS(null,"height",w),_.setAttributeNS(null,"x","".concat(p)),_.setAttributeNS(null,"y","".concat(f));const S=this.svg,A=this.transformMatrix,E=this.current.fillColor,C=this.current.strokeColor,M=this.svgFactory.create(m-p,g-f);if(this.svg=M,this.transformMatrix=n,2===d){const e=r.Util.makeHexColor(...t);this.current.fillColor=e,this.current.strokeColor=e}return this.executeOpTree(this.convertOpList(i)),this.svg=S,this.transformMatrix=A,this.current.fillColor=E,this.current.strokeColor=C,_.append(M.childNodes[0]),this.defs.append(_),"url(#".concat(u,")")}_makeShadingPattern(e){switch("string"===typeof e&&(e=this.objs.get(e)),e[0]){case"RadialAxial":const t="shading".concat(x++),i=e[3];let n;switch(e[1]){case"axial":const i=e[4],r=e[5];n=this.svgFactory.createElement("svg:linearGradient"),n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),n.setAttributeNS(null,"x1",i[0]),n.setAttributeNS(null,"y1",i[1]),n.setAttributeNS(null,"x2",r[0]),n.setAttributeNS(null,"y2",r[1]);break;case"radial":const a=e[4],s=e[5],o=e[6],l=e[7];n=this.svgFactory.createElement("svg:radialGradient"),n.setAttributeNS(null,"id",t),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),n.setAttributeNS(null,"cx",s[0]),n.setAttributeNS(null,"cy",s[1]),n.setAttributeNS(null,"r",l),n.setAttributeNS(null,"fx",a[0]),n.setAttributeNS(null,"fy",a[1]),n.setAttributeNS(null,"fr",o);break;default:throw new Error("Unknown RadialAxial type: ".concat(e[1]))}for(const e of i){const t=this.svgFactory.createElement("svg:stop");t.setAttributeNS(null,"offset",e[0]),t.setAttributeNS(null,"stop-color",e[1]),n.append(t)}return this.defs.append(n),"url(#".concat(t,")");case"Mesh":return(0,r.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error("Unknown IR type: ".concat(e[0]))}}setDash(e,t){this.current.dashArray=e,this.current.dashPhase=t}constructPath(e,t){const i=this.current;let n=i.x,a=i.y,s=[],o=0;for(const l of e)switch(0|l){case r.OPS.rectangle:n=t[o++],a=t[o++];const e=n+t[o++],i=a+t[o++];s.push("M",g(n),g(a),"L",g(e),g(a),"L",g(e),g(i),"L",g(n),g(i),"Z");break;case r.OPS.moveTo:n=t[o++],a=t[o++],s.push("M",g(n),g(a));break;case r.OPS.lineTo:n=t[o++],a=t[o++],s.push("L",g(n),g(a));break;case r.OPS.curveTo:n=t[o+4],a=t[o+5],s.push("C",g(t[o]),g(t[o+1]),g(t[o+2]),g(t[o+3]),g(n),g(a)),o+=6;break;case r.OPS.curveTo2:s.push("C",g(n),g(a),g(t[o]),g(t[o+1]),g(t[o+2]),g(t[o+3])),n=t[o+2],a=t[o+3],o+=4;break;case r.OPS.curveTo3:n=t[o+2],a=t[o+3],s.push("C",g(t[o]),g(t[o+1]),g(n),g(a),g(n),g(a)),o+=4;break;case r.OPS.closePath:s.push("Z")}s=s.join(" "),i.path&&e.length>0&&e[0]!==r.OPS.rectangle&&e[0]!==r.OPS.moveTo?s=i.path.getAttributeNS(null,"d")+s:(i.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(i.path)),i.path.setAttributeNS(null,"d",s),i.path.setAttributeNS(null,"fill","none"),i.element=i.path,i.setCurrentPoint(n,a)}endPath(){const e=this.current;if(e.path=null,!this.pendingClip)return;if(!e.element)return void(this.pendingClip=null);const t="clippath".concat(y++),i=this.svgFactory.createElement("svg:clipPath");i.setAttributeNS(null,"id",t),i.setAttributeNS(null,"transform",v(this.transformMatrix));const n=e.element.cloneNode(!0);if("evenodd"===this.pendingClip?n.setAttributeNS(null,"clip-rule","evenodd"):n.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,i.append(n),this.defs.append(i),e.activeClipUrl){e.clipGroup=null;for(const e of this.extraStack)e.clipGroup=null;i.setAttributeNS(null,"clip-path",e.activeClipUrl)}e.activeClipUrl="url(#".concat(t,")"),this.tgrp=null}clip(e){this.pendingClip=e}closePath(){const e=this.current;if(e.path){const t="".concat(e.path.getAttributeNS(null,"d"),"Z");e.path.setAttributeNS(null,"d",t)}}setLeading(e){this.current.leading=-e}setTextRise(e){this.current.textRise=e}setTextRenderingMode(e){this.current.textRenderingMode=e}setHScale(e){this.current.textHScale=e/100}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i);break;case"CA":this.setStrokeAlpha(i);break;case"ca":this.setFillAlpha(i);break;default:(0,r.warn)("Unimplemented graphic state operator ".concat(t))}}fill(){const e=this.current;e.element&&(e.element.setAttributeNS(null,"fill",e.fillColor),e.element.setAttributeNS(null,"fill-opacity",e.fillAlpha),this.endPath())}stroke(){const e=this.current;e.element&&(this._setStrokeAttributes(e.element),e.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const i=this.current;let n=i.dashArray;1!==t&&n.length>0&&(n=n.map((function(e){return t*e}))),e.setAttributeNS(null,"stroke",i.strokeColor),e.setAttributeNS(null,"stroke-opacity",i.strokeAlpha),e.setAttributeNS(null,"stroke-miterlimit",g(i.miterLimit)),e.setAttributeNS(null,"stroke-linecap",i.lineCap),e.setAttributeNS(null,"stroke-linejoin",i.lineJoin),e.setAttributeNS(null,"stroke-width",g(t*i.lineWidth)+"px"),e.setAttributeNS(null,"stroke-dasharray",n.map(g).join(" ")),e.setAttributeNS(null,"stroke-dashoffset",g(t*i.dashPhase)+"px")}eoFill(){var e;null===(e=this.current.element)||void 0===e||e.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var e;null===(e=this.current.element)||void 0===e||e.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(e)}paintImageXObject(e){const t=this.getObject(e);t?this.paintInlineImageXObject(t):(0,r.warn)("Dependent image with object ID ".concat(e," is not ready yet"))}paintInlineImageXObject(e,t){const i=e.width,n=e.height,r=p(e,this.forceDataSchema,!!t),a=this.svgFactory.createElement("svg:rect");a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y","0"),a.setAttributeNS(null,"width",g(i)),a.setAttributeNS(null,"height",g(n)),this.current.element=a,this.clip("nonzero");const s=this.svgFactory.createElement("svg:image");s.setAttributeNS(c,"xlink:href",r),s.setAttributeNS(null,"x","0"),s.setAttributeNS(null,"y",g(-n)),s.setAttributeNS(null,"width",g(i)+"px"),s.setAttributeNS(null,"height",g(n)+"px"),s.setAttributeNS(null,"transform","scale(".concat(g(1/i)," ").concat(g(-1/n),")")),t?t.append(s):this._ensureTransformGroup().append(s)}paintImageMaskXObject(e){const t=this.getObject(e.data,e);if(t.bitmap)return void(0,r.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");const i=this.current,n=t.width,a=t.height,s=i.fillColor;i.maskId="mask".concat(b++);const o=this.svgFactory.createElement("svg:mask");o.setAttributeNS(null,"id",i.maskId);const l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width",g(n)),l.setAttributeNS(null,"height",g(a)),l.setAttributeNS(null,"fill",s),l.setAttributeNS(null,"mask","url(#".concat(i.maskId,")")),this.defs.append(o),this._ensureTransformGroup().append(l),this.paintInlineImageXObject(t,o)}paintFormXObjectBegin(e,t){if(Array.isArray(e)&&6===e.length&&this.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t){const e=t[2]-t[0],i=t[3]-t[1],n=this.svgFactory.createElement("svg:rect");n.setAttributeNS(null,"x",t[0]),n.setAttributeNS(null,"y",t[1]),n.setAttributeNS(null,"width",g(e)),n.setAttributeNS(null,"height",g(i)),this.current.element=n,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(e){const t=this.svgFactory.create(e.width,e.height),i=this.svgFactory.createElement("svg:defs");t.append(i),this.defs=i;const n=this.svgFactory.createElement("svg:g");return n.setAttributeNS(null,"transform",v(e.transform)),t.append(n),this.svg=n,t}_ensureClipGroup(){if(!this.current.clipGroup){const e=this.svgFactory.createElement("svg:g");e.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(e),this.current.clipGroup=e}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",v(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}}],__webpack_module_cache__={};function __w_pdfjs_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__w_pdfjs_require__),i.exports}var __nested_webpack_exports__={};return(()=>{var e=__nested_webpack_exports__;Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"AbortException",{enumerable:!0,get:function(){return t.AbortException}}),Object.defineProperty(e,"AnnotationEditorLayer",{enumerable:!0,get:function(){return a.AnnotationEditorLayer}}),Object.defineProperty(e,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return t.AnnotationEditorParamsType}}),Object.defineProperty(e,"AnnotationEditorType",{enumerable:!0,get:function(){return t.AnnotationEditorType}}),Object.defineProperty(e,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return s.AnnotationEditorUIManager}}),Object.defineProperty(e,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(e,"AnnotationMode",{enumerable:!0,get:function(){return t.AnnotationMode}}),Object.defineProperty(e,"CMapCompressionType",{enumerable:!0,get:function(){return t.CMapCompressionType}}),Object.defineProperty(e,"FeatureTest",{enumerable:!0,get:function(){return t.FeatureTest}}),Object.defineProperty(e,"GlobalWorkerOptions",{enumerable:!0,get:function(){return l.GlobalWorkerOptions}}),Object.defineProperty(e,"InvalidPDFException",{enumerable:!0,get:function(){return t.InvalidPDFException}}),Object.defineProperty(e,"MissingPDFException",{enumerable:!0,get:function(){return t.MissingPDFException}}),Object.defineProperty(e,"OPS",{enumerable:!0,get:function(){return t.OPS}}),Object.defineProperty(e,"PDFDataRangeTransport",{enumerable:!0,get:function(){return i.PDFDataRangeTransport}}),Object.defineProperty(e,"PDFDateString",{enumerable:!0,get:function(){return n.PDFDateString}}),Object.defineProperty(e,"PDFWorker",{enumerable:!0,get:function(){return i.PDFWorker}}),Object.defineProperty(e,"PasswordResponses",{enumerable:!0,get:function(){return t.PasswordResponses}}),Object.defineProperty(e,"PermissionFlag",{enumerable:!0,get:function(){return t.PermissionFlag}}),Object.defineProperty(e,"PixelsPerInch",{enumerable:!0,get:function(){return n.PixelsPerInch}}),Object.defineProperty(e,"RenderingCancelledException",{enumerable:!0,get:function(){return n.RenderingCancelledException}}),Object.defineProperty(e,"SVGGraphics",{enumerable:!0,get:function(){return c.SVGGraphics}}),Object.defineProperty(e,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return t.UNSUPPORTED_FEATURES}}),Object.defineProperty(e,"UnexpectedResponseException",{enumerable:!0,get:function(){return t.UnexpectedResponseException}}),Object.defineProperty(e,"Util",{enumerable:!0,get:function(){return t.Util}}),Object.defineProperty(e,"VerbosityLevel",{enumerable:!0,get:function(){return t.VerbosityLevel}}),Object.defineProperty(e,"XfaLayer",{enumerable:!0,get:function(){return h.XfaLayer}}),Object.defineProperty(e,"build",{enumerable:!0,get:function(){return i.build}}),Object.defineProperty(e,"createPromiseCapability",{enumerable:!0,get:function(){return t.createPromiseCapability}}),Object.defineProperty(e,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return t.createValidAbsoluteUrl}}),Object.defineProperty(e,"getDocument",{enumerable:!0,get:function(){return i.getDocument}}),Object.defineProperty(e,"getFilenameFromUrl",{enumerable:!0,get:function(){return n.getFilenameFromUrl}}),Object.defineProperty(e,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return n.getPdfFilenameFromUrl}}),Object.defineProperty(e,"getXfaPageViewport",{enumerable:!0,get:function(){return n.getXfaPageViewport}}),Object.defineProperty(e,"isDataScheme",{enumerable:!0,get:function(){return n.isDataScheme}}),Object.defineProperty(e,"isPdfFile",{enumerable:!0,get:function(){return n.isPdfFile}}),Object.defineProperty(e,"loadScript",{enumerable:!0,get:function(){return n.loadScript}}),Object.defineProperty(e,"renderTextLayer",{enumerable:!0,get:function(){return r.renderTextLayer}}),Object.defineProperty(e,"setLayerDimensions",{enumerable:!0,get:function(){return n.setLayerDimensions}}),Object.defineProperty(e,"shadow",{enumerable:!0,get:function(){return t.shadow}}),Object.defineProperty(e,"updateTextLayer",{enumerable:!0,get:function(){return r.updateTextLayer}}),Object.defineProperty(e,"version",{enumerable:!0,get:function(){return i.version}});var t=__w_pdfjs_require__(1),i=__w_pdfjs_require__(2),n=__w_pdfjs_require__(6),r=__w_pdfjs_require__(26),a=__w_pdfjs_require__(27),s=__w_pdfjs_require__(5),o=__w_pdfjs_require__(32),l=__w_pdfjs_require__(14),c=__w_pdfjs_require__(35),h=__w_pdfjs_require__(34)})(),__nested_webpack_exports__})(),module.exports=factory()},1497:(e,t,i)=>{"use strict";var n=i(3218);function r(){}function a(){}a.resetWarningCache=r,e.exports=function(){function e(e,t,i,r,a,s){if(s!==n){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:r};return i.PropTypes=i,i}},5173:(e,t,i)=>{e.exports=i(1497)()},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},2730:(e,t,i)=>{"use strict";var n=i(5043),r=i(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)s.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,i,n,r,a,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=s}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,i,n){var r=g.hasOwnProperty(t)?g[t]:null;(null!==r?0!==r.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,n){if(null===t||"undefined"===typeof t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,r,n)&&(i=null),n||null===r?function(e){return!!d.call(f,e)||!d.call(p,e)&&(u.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):r.mustUseProperty?e[r.propertyName]=null===i?3!==r.type&&"":i:(t=r.attributeName,n=r.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(r=r.type)||4===r&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),_=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),M=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),O=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var I=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var k=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=k&&e[k]||e["@@iterator"])?e:null}var F,B=Object.assign;function N(e){if(void 0===F)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var z=!1;function U(e,t){if(!e||z)return"";z=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),a=n.stack.split("\n"),s=r.length-1,o=a.length-1;1<=s&&0<=o&&r[s]!==a[o];)o--;for(;1<=s&&0<=o;s--,o--)if(r[s]!==a[o]){if(1!==s||1!==o)do{if(s--,0>--o||r[s]!==a[o]){var l="\n"+r[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=o);break}}}finally{z=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?N(e):""}function j(e){switch(e.tag){case 5:return N(e.type);case 16:return N("Lazy");case 13:return N("Suspense");case 19:return N("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case _:return"Portal";case E:return"Profiler";case A:return"StrictMode";case T:return"Suspense";case D:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case M:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case P:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case O:t=e._payload,e=e._init;try{return V(e(t))}catch(i){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===A?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function W(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=W(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var r=i.get,a=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){n=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=W(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var i=t.checked;return B({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function K(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=H(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var i=H(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&Y(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,n){if(e=e.options,t){t={};for(var r=0;r<i.length;r++)t["$"+i[r]]=!0;for(i=0;i<e.length;i++)r=t.hasOwnProperty("$"+e[i].value),e[i].selected!==r&&(e[i].selected=r),r&&n&&(e[i].defaultSelected=!0)}else{for(i=""+H(i),t=null,r=0;r<e.length;r++){if(e[r].value===i)return e[r].selected=!0,void(n&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return B({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(a(92));if(te(i)){if(1<i.length)throw Error(a(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:H(i)}}function ae(e,t){var i=H(t.value),n=H(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,he,de=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function ue(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),r=me(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,r):e[i]=r}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var ve=B({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,Se=null,Ae=null;function Ee(e){if(e=br(e)){if("function"!==typeof _e)throw Error(a(280));var t=e.stateNode;t&&(t=wr(t),_e(e.stateNode,e.type,t))}}function Ce(e){Se?Ae?Ae.push(e):Ae=[e]:Se=e}function Me(){if(Se){var e=Se,t=Ae;if(Ae=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Pe(e,t){return e(t)}function Te(){}var De=!1;function Re(e,t,i){if(De)return e(t,i);De=!0;try{return Pe(e,t,i)}finally{De=!1,(null!==Se||null!==Ae)&&(Te(),Me())}}function Oe(e,t){var i=e.stateNode;if(null===i)return null;var n=wr(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(a(231,t,typeof i));return i}var Ie=!1;if(h)try{var ke={};Object.defineProperty(ke,"passive",{get:function(){Ie=!0}}),window.addEventListener("test",ke,ke),window.removeEventListener("test",ke,ke)}catch(he){Ie=!1}function Le(e,t,i,n,r,a,s,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var Fe=!1,Be=null,Ne=!1,ze=null,Ue={onError:function(e){Fe=!0,Be=e}};function je(e,t,i,n,r,a,s,o,l){Fe=!1,Be=null,Le.apply(Ue,arguments)}function Ve(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ve(e)!==e)throw Error(a(188))}function We(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(a(188));return t!==e?null:e}for(var i=e,n=t;;){var r=i.return;if(null===r)break;var s=r.alternate;if(null===s){if(null!==(n=r.return)){i=n;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===i)return He(r),e;if(s===n)return He(r),t;s=s.sibling}throw Error(a(188))}if(i.return!==n.return)i=r,n=s;else{for(var o=!1,l=r.child;l;){if(l===i){o=!0,i=r,n=s;break}if(l===n){o=!0,n=r,i=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===i){o=!0,i=s,n=r;break}if(l===n){o=!0,n=s,i=r;break}l=l.sibling}if(!o)throw Error(a(189))}}if(i.alternate!==n)throw Error(a(190))}if(3!==i.tag)throw Error(a(188));return i.stateNode.current===i?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Xe=r.unstable_scheduleCallback,Ye=r.unstable_cancelCallback,Qe=r.unstable_shouldYield,Ke=r.unstable_requestPaint,Ze=r.unstable_now,Je=r.unstable_getCurrentPriorityLevel,$e=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,it=r.unstable_LowPriority,nt=r.unstable_IdlePriority,rt=null,at=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ht=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var i=e.pendingLanes;if(0===i)return 0;var n=0,r=e.suspendedLanes,a=e.pingedLanes,s=268435455&i;if(0!==s){var o=s&~r;0!==o?n=dt(o):0!==(a&=s)&&(n=dt(a))}else 0!==(s=i&~r)?n=dt(s):0!==a&&(n=dt(a));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&r)&&((r=n&-n)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&n)&&(n|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)r=1<<(i=31-st(t)),n|=e[i],t&=~r;return n}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function vt(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=i}function yt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var n=31-st(i),r=1<<n;r&t|e[n]&t&&(e[n]|=t),i&=~r}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,_t,St,At,Et,Ct=!1,Mt=[],Pt=null,Tt=null,Dt=null,Rt=new Map,Ot=new Map,It=[],kt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Pt=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Dt=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function Ft(e,t,i,n,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:i,eventSystemFlags:n,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=br(t))&&_t(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Bt(e){var t=yr(e.target);if(null!==t){var i=Ve(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ge(i)))return e.blockedOn=t,void Et(e.priority,(function(){St(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Nt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=br(i))&&_t(t),e.blockedOn=i,!1;var n=new(i=e.nativeEvent).constructor(i.type,i);xe=n,i.target.dispatchEvent(n),xe=null,t.shift()}return!0}function zt(e,t,i){Nt(e)&&i.delete(t)}function Ut(){Ct=!1,null!==Pt&&Nt(Pt)&&(Pt=null),null!==Tt&&Nt(Tt)&&(Tt=null),null!==Dt&&Nt(Dt)&&(Dt=null),Rt.forEach(zt),Ot.forEach(zt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ut)))}function Vt(e){function t(t){return jt(t,e)}if(0<Mt.length){jt(Mt[0],e);for(var i=1;i<Mt.length;i++){var n=Mt[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Pt&&jt(Pt,e),null!==Tt&&jt(Tt,e),null!==Dt&&jt(Dt,e),Rt.forEach(t),Ot.forEach(t),i=0;i<It.length;i++)(n=It[i]).blockedOn===e&&(n.blockedOn=null);for(;0<It.length&&null===(i=It[0]).blockedOn;)Bt(i),null===i.blockedOn&&It.shift()}var Gt=x.ReactCurrentBatchConfig,Ht=!0;function Wt(e,t,i,n){var r=bt,a=Gt.transition;Gt.transition=null;try{bt=1,Xt(e,t,i,n)}finally{bt=r,Gt.transition=a}}function qt(e,t,i,n){var r=bt,a=Gt.transition;Gt.transition=null;try{bt=4,Xt(e,t,i,n)}finally{bt=r,Gt.transition=a}}function Xt(e,t,i,n){if(Ht){var r=Qt(e,t,i,n);if(null===r)Hn(e,t,n,Yt,i),Lt(e,n);else if(function(e,t,i,n,r){switch(t){case"focusin":return Pt=Ft(Pt,e,t,i,n,r),!0;case"dragenter":return Tt=Ft(Tt,e,t,i,n,r),!0;case"mouseover":return Dt=Ft(Dt,e,t,i,n,r),!0;case"pointerover":var a=r.pointerId;return Rt.set(a,Ft(Rt.get(a)||null,e,t,i,n,r)),!0;case"gotpointercapture":return a=r.pointerId,Ot.set(a,Ft(Ot.get(a)||null,e,t,i,n,r)),!0}return!1}(r,e,t,i,n))n.stopPropagation();else if(Lt(e,n),4&t&&-1<kt.indexOf(e)){for(;null!==r;){var a=br(r);if(null!==a&&wt(a),null===(a=Qt(e,t,i,n))&&Hn(e,t,n,Yt,i),a===r)break;r=a}null!==r&&n.stopPropagation()}else Hn(e,t,n,null,i)}}var Yt=null;function Qt(e,t,i,n){if(Yt=null,null!==(e=yr(e=we(n))))if(null===(t=Ve(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Kt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case it:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Zt=null,Jt=null,$t=null;function ei(){if($t)return $t;var e,t,i=Jt,n=i.length,r="value"in Zt?Zt.value:Zt.textContent,a=r.length;for(e=0;e<n&&i[e]===r[e];e++);var s=n-e;for(t=1;t<=s&&i[n-t]===r[a-t];t++);return $t=r.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ni(){return!1}function ri(e){function t(t,i,n,r,a){for(var s in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(r):r[s]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?ii:ni,this.isPropagationStopped=ni,this}return B(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var ai,si,oi,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ri(li),hi=B({},li,{view:0,detail:0}),di=ri(hi),ui=B({},hi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ai,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==oi&&(oi&&"mousemove"===e.type?(ai=e.screenX-oi.screenX,si=e.screenY-oi.screenY):si=ai=0,oi=e),ai)},movementY:function(e){return"movementY"in e?e.movementY:si}}),pi=ri(ui),fi=ri(B({},ui,{dataTransfer:0})),mi=ri(B({},hi,{relatedTarget:0})),gi=ri(B({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),vi=B({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yi=ri(vi),bi=ri(B({},li,{data:0})),xi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Si(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_i[e])&&!!t[e]}function Ai(){return Si}var Ei=B({},hi,{key:function(e){if(e.key){var t=xi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ai,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Ci=ri(Ei),Mi=ri(B({},ui,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pi=ri(B({},hi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ai})),Ti=ri(B({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Di=B({},ui,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Ri=ri(Di),Oi=[9,13,27,32],Ii=h&&"CompositionEvent"in window,ki=null;h&&"documentMode"in document&&(ki=document.documentMode);var Li=h&&"TextEvent"in window&&!ki,Fi=h&&(!Ii||ki&&8<ki&&11>=ki),Bi=String.fromCharCode(32),Ni=!1;function zi(e,t){switch(e){case"keyup":return-1!==Oi.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ui(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var ji=!1;var Vi={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Vi[e.type]:"textarea"===t}function Hi(e,t,i,n){Ce(n),0<(t=qn(t,"onChange")).length&&(i=new ci("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Wi=null,qi=null;function Xi(e){Nn(e,0)}function Yi(e){if(X(xr(e)))return e}function Qi(e,t){if("change"===e)return t}var Ki=!1;if(h){var Zi;if(h){var Ji="oninput"in document;if(!Ji){var $i=document.createElement("div");$i.setAttribute("oninput","return;"),Ji="function"===typeof $i.oninput}Zi=Ji}else Zi=!1;Ki=Zi&&(!document.documentMode||9<document.documentMode)}function en(){Wi&&(Wi.detachEvent("onpropertychange",tn),qi=Wi=null)}function tn(e){if("value"===e.propertyName&&Yi(qi)){var t=[];Hi(t,qi,e,we(e)),Re(Xi,t)}}function nn(e,t,i){"focusin"===e?(en(),qi=i,(Wi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function rn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yi(qi)}function an(e,t){if("click"===e)return Yi(t)}function sn(e,t){if("input"===e||"change"===e)return Yi(t)}var on="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(on(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!d.call(t,r)||!on(e[r],t[r]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hn(e,t){var i,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function dn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function un(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(n){i=!1}if(!i)break;t=Y((e=t.contentWindow).document)}return t}function pn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fn(e){var t=un(),i=e.focusedElem,n=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&dn(i.ownerDocument.documentElement,i)){if(null!==n&&pn(i))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=i.textContent.length,a=Math.min(n.start,r);n=void 0===n.end?a:Math.min(n.end,r),!e.extend&&a>n&&(r=n,n=a,a=r),r=hn(i,a);var s=hn(i,n);r&&s&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>n?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mn=h&&"documentMode"in document&&11>=document.documentMode,gn=null,vn=null,yn=null,bn=!1;function xn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;bn||null==gn||gn!==Y(n)||("selectionStart"in(n=gn)&&pn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=qn(vn,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=gn)))}function wn(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var _n={animationend:wn("Animation","AnimationEnd"),animationiteration:wn("Animation","AnimationIteration"),animationstart:wn("Animation","AnimationStart"),transitionend:wn("Transition","TransitionEnd")},Sn={},An={};function En(e){if(Sn[e])return Sn[e];if(!_n[e])return e;var t,i=_n[e];for(t in i)if(i.hasOwnProperty(t)&&t in An)return Sn[e]=i[t];return e}h&&(An=document.createElement("div").style,"AnimationEvent"in window||(delete _n.animationend.animation,delete _n.animationiteration.animation,delete _n.animationstart.animation),"TransitionEvent"in window||delete _n.transitionend.transition);var Cn=En("animationend"),Mn=En("animationiteration"),Pn=En("animationstart"),Tn=En("transitionend"),Dn=new Map,Rn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function On(e,t){Dn.set(e,t),l(t,[e])}for(var In=0;In<Rn.length;In++){var kn=Rn[In];On(kn.toLowerCase(),"on"+(kn[0].toUpperCase()+kn.slice(1)))}On(Cn,"onAnimationEnd"),On(Mn,"onAnimationIteration"),On(Pn,"onAnimationStart"),On("dblclick","onDoubleClick"),On("focusin","onFocus"),On("focusout","onBlur"),On(Tn,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ln="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ln));function Bn(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,r,s,o,l,c){if(je.apply(this,arguments),Fe){if(!Fe)throw Error(a(198));var h=Be;Fe=!1,Be=null,Ne||(Ne=!0,ze=h)}}(n,t,void 0,e),e.currentTarget=null}function Nn(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var n=e[i],r=n.event;n=n.listeners;e:{var a=void 0;if(t)for(var s=n.length-1;0<=s;s--){var o=n[s],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==a&&r.isPropagationStopped())break e;Bn(r,o,c),a=l}else for(s=0;s<n.length;s++){if(l=(o=n[s]).instance,c=o.currentTarget,o=o.listener,l!==a&&r.isPropagationStopped())break e;Bn(r,o,c),a=l}}}if(Ne)throw e=ze,Ne=!1,ze=null,e}function zn(e,t){var i=t[mr];void 0===i&&(i=t[mr]=new Set);var n=e+"__bubble";i.has(n)||(Gn(t,e,2,!1),i.add(n))}function Un(e,t,i){var n=0;t&&(n|=4),Gn(i,e,n,t)}var jn="_reactListening"+Math.random().toString(36).slice(2);function Vn(e){if(!e[jn]){e[jn]=!0,s.forEach((function(t){"selectionchange"!==t&&(Fn.has(t)||Un(t,!1,e),Un(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[jn]||(t[jn]=!0,Un("selectionchange",!1,t))}}function Gn(e,t,i,n){switch(Kt(t)){case 1:var r=Wt;break;case 4:r=qt;break;default:r=Xt}i=r.bind(null,t,i,e),r=void 0,!Ie||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),n?void 0!==r?e.addEventListener(t,i,{capture:!0,passive:r}):e.addEventListener(t,i,!0):void 0!==r?e.addEventListener(t,i,{passive:r}):e.addEventListener(t,i,!1)}function Hn(e,t,i,n,r){var a=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var s=n.tag;if(3===s||4===s){var o=n.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===s)for(s=n.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===r||8===l.nodeType&&l.parentNode===r))return;s=s.return}for(;null!==o;){if(null===(s=yr(o)))return;if(5===(l=s.tag)||6===l){n=a=s;continue e}o=o.parentNode}}n=n.return}Re((function(){var n=a,r=we(i),s=[];e:{var o=Dn.get(e);if(void 0!==o){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Ci;break;case"focusin":c="focus",l=mi;break;case"focusout":c="blur",l=mi;break;case"beforeblur":case"afterblur":l=mi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pi;break;case Cn:case Mn:case Pn:l=gi;break;case Tn:l=Ti;break;case"scroll":l=di;break;case"wheel":l=Ri;break;case"copy":case"cut":case"paste":l=yi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Mi}var h=0!==(4&t),d=!h&&"scroll"===e,u=h?null!==o?o+"Capture":null:o;h=[];for(var p,f=n;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==u&&(null!=(m=Oe(f,u))&&h.push(Wn(f,m,p)))),d)break;f=f.return}0<h.length&&(o=new l(o,c,null,i,r),s.push({event:o,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||i===xe||!(c=i.relatedTarget||i.fromElement)||!yr(c)&&!c[fr])&&(l||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?yr(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(h=pi,m="onMouseLeave",u="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(h=Mi,m="onPointerLeave",u="onPointerEnter",f="pointer"),d=null==l?o:xr(l),p=null==c?o:xr(c),(o=new h(m,f+"leave",l,i,r)).target=d,o.relatedTarget=p,m=null,yr(r)===n&&((h=new h(u,f+"enter",c,i,r)).target=p,h.relatedTarget=d,m=h),d=m,l&&c)e:{for(u=c,f=0,p=h=l;p;p=Xn(p))f++;for(p=0,m=u;m;m=Xn(m))p++;for(;0<f-p;)h=Xn(h),f--;for(;0<p-f;)u=Xn(u),p--;for(;f--;){if(h===u||null!==u&&h===u.alternate)break e;h=Xn(h),u=Xn(u)}h=null}else h=null;null!==l&&Yn(s,o,l,h,!1),null!==c&&null!==d&&Yn(s,d,c,h,!0)}if("select"===(l=(o=n?xr(n):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Qi;else if(Gi(o))if(Ki)g=sn;else{g=rn;var v=nn}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=an);switch(g&&(g=g(e,n))?Hi(s,g,i,r):(v&&v(e,o,n),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=n?xr(n):window,e){case"focusin":(Gi(v)||"true"===v.contentEditable)&&(gn=v,vn=n,yn=null);break;case"focusout":yn=vn=gn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,xn(s,i,r);break;case"selectionchange":if(mn)break;case"keydown":case"keyup":xn(s,i,r)}var y;if(Ii)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else ji?zi(e,i)&&(b="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(b="onCompositionStart");b&&(Fi&&"ko"!==i.locale&&(ji||"onCompositionStart"!==b?"onCompositionEnd"===b&&ji&&(y=ei()):(Jt="value"in(Zt=r)?Zt.value:Zt.textContent,ji=!0)),0<(v=qn(n,b)).length&&(b=new bi(b,e,null,i,r),s.push({event:b,listeners:v}),y?b.data=y:null!==(y=Ui(i))&&(b.data=y))),(y=Li?function(e,t){switch(e){case"compositionend":return Ui(t);case"keypress":return 32!==t.which?null:(Ni=!0,Bi);case"textInput":return(e=t.data)===Bi&&Ni?null:e;default:return null}}(e,i):function(e,t){if(ji)return"compositionend"===e||!Ii&&zi(e,t)?(e=ei(),$t=Jt=Zt=null,ji=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(n=qn(n,"onBeforeInput")).length&&(r=new bi("onBeforeInput","beforeinput",null,i,r),s.push({event:r,listeners:n}),r.data=y))}Nn(s,t)}))}function Wn(e,t,i){return{instance:e,listener:t,currentTarget:i}}function qn(e,t){for(var i=t+"Capture",n=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Oe(e,i))&&n.unshift(Wn(e,a,r)),null!=(a=Oe(e,t))&&n.push(Wn(e,a,r))),e=e.return}return n}function Xn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yn(e,t,i,n,r){for(var a=t._reactName,s=[];null!==i&&i!==n;){var o=i,l=o.alternate,c=o.stateNode;if(null!==l&&l===n)break;5===o.tag&&null!==c&&(o=c,r?null!=(l=Oe(i,a))&&s.unshift(Wn(i,l,o)):r||null!=(l=Oe(i,a))&&s.push(Wn(i,l,o))),i=i.return}0!==s.length&&e.push({event:t,listeners:s})}var Qn=/\r\n?/g,Kn=/\u0000|\uFFFD/g;function Zn(e){return("string"===typeof e?e:""+e).replace(Qn,"\n").replace(Kn,"")}function Jn(e,t,i){if(t=Zn(t),Zn(e)!==t&&i)throw Error(a(425))}function $n(){}var er=null,tr=null;function ir(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var nr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,sr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(e){return ar.resolve(null).then(e).catch(or)}:nr;function or(e){setTimeout((function(){throw e}))}function lr(e,t){var i=t,n=0;do{var r=i.nextSibling;if(e.removeChild(i),r&&8===r.nodeType)if("/$"===(i=r.data)){if(0===n)return e.removeChild(r),void Vt(t);n--}else"$"!==i&&"$?"!==i&&"$!"!==i||n++;i=r}while(i);Vt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var dr=Math.random().toString(36).slice(2),ur="__reactFiber$"+dr,pr="__reactProps$"+dr,fr="__reactContainer$"+dr,mr="__reactEvents$"+dr,gr="__reactListeners$"+dr,vr="__reactHandles$"+dr;function yr(e){var t=e[ur];if(t)return t;for(var i=e.parentNode;i;){if(t=i[fr]||i[ur]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=hr(e);null!==e;){if(i=e[ur])return i;e=hr(e)}return t}i=(e=i).parentNode}return null}function br(e){return!(e=e[ur]||e[fr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function wr(e){return e[pr]||null}var _r=[],Sr=-1;function Ar(e){return{current:e}}function Er(e){0>Sr||(e.current=_r[Sr],_r[Sr]=null,Sr--)}function Cr(e,t){Sr++,_r[Sr]=e.current,e.current=t}var Mr={},Pr=Ar(Mr),Tr=Ar(!1),Dr=Mr;function Rr(e,t){var i=e.type.contextTypes;if(!i)return Mr;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in i)a[r]=t[r];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Or(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ir(){Er(Tr),Er(Pr)}function kr(e,t,i){if(Pr.current!==Mr)throw Error(a(168));Cr(Pr,t),Cr(Tr,i)}function Lr(e,t,i){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in t))throw Error(a(108,G(e)||"Unknown",r));return B({},i,n)}function Fr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Mr,Dr=Pr.current,Cr(Pr,e),Cr(Tr,Tr.current),!0}function Br(e,t,i){var n=e.stateNode;if(!n)throw Error(a(169));i?(e=Lr(e,t,Dr),n.__reactInternalMemoizedMergedChildContext=e,Er(Tr),Er(Pr),Cr(Pr,e)):Er(Tr),Cr(Tr,i)}var Nr=null,zr=!1,Ur=!1;function jr(e){null===Nr?Nr=[e]:Nr.push(e)}function Vr(){if(!Ur&&null!==Nr){Ur=!0;var e=0,t=bt;try{var i=Nr;for(bt=1;e<i.length;e++){var n=i[e];do{n=n(!0)}while(null!==n)}Nr=null,zr=!1}catch(r){throw null!==Nr&&(Nr=Nr.slice(e+1)),Xe($e,Vr),r}finally{bt=t,Ur=!1}}return null}var Gr=[],Hr=0,Wr=null,qr=0,Xr=[],Yr=0,Qr=null,Kr=1,Zr="";function Jr(e,t){Gr[Hr++]=qr,Gr[Hr++]=Wr,Wr=e,qr=t}function $r(e,t,i){Xr[Yr++]=Kr,Xr[Yr++]=Zr,Xr[Yr++]=Qr,Qr=e;var n=Kr;e=Zr;var r=32-st(n)-1;n&=~(1<<r),i+=1;var a=32-st(t)+r;if(30<a){var s=r-r%5;a=(n&(1<<s)-1).toString(32),n>>=s,r-=s,Kr=1<<32-st(t)+r|i<<r|n,Zr=a+e}else Kr=1<<a|i<<r|n,Zr=e}function ea(e){null!==e.return&&(Jr(e,1),$r(e,1,0))}function ta(e){for(;e===Wr;)Wr=Gr[--Hr],Gr[Hr]=null,qr=Gr[--Hr],Gr[Hr]=null;for(;e===Qr;)Qr=Xr[--Yr],Xr[Yr]=null,Zr=Xr[--Yr],Xr[Yr]=null,Kr=Xr[--Yr],Xr[Yr]=null}var ia=null,na=null,ra=!1,aa=null;function sa(e,t){var i=Rc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function oa(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ia=e,na=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ia=e,na=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Qr?{id:Kr,overflow:Zr}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=Rc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,ia=e,na=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(ra){var t=na;if(t){var i=t;if(!oa(e,t)){if(la(e))throw Error(a(418));t=cr(i.nextSibling);var n=ia;t&&oa(e,t)?sa(n,i):(e.flags=-4097&e.flags|2,ra=!1,ia=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,ia=e}}}function ha(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ia=e}function da(e){if(e!==ia)return!1;if(!ra)return ha(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ir(e.type,e.memoizedProps)),t&&(t=na)){if(la(e))throw ua(),Error(a(418));for(;t;)sa(e,t),t=cr(t.nextSibling)}if(ha(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){na=cr(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}na=null}}else na=ia?cr(e.stateNode.nextSibling):null;return!0}function ua(){for(var e=na;e;)e=cr(e.nextSibling)}function pa(){na=ia=null,ra=!1}function fa(e){null===aa?aa=[e]:aa.push(e)}var ma=x.ReactCurrentBatchConfig;function ga(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(a(309));var n=i.stateNode}if(!n)throw Error(a(147,e));var r=n,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=r.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(a(284));if(!i._owner)throw Error(a(290,e))}return e}function va(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ya(e){return(0,e._init)(e._payload)}function ba(e){function t(t,i){if(e){var n=t.deletions;null===n?(t.deletions=[i],t.flags|=16):n.push(i)}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Ic(e,t)).index=0,e.sibling=null,e}function s(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags|=2,i):n:(t.flags|=2,i):(t.flags|=1048576,i)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Bc(i,e.mode,n)).return=e,t):((t=r(t,i)).return=e,t)}function c(e,t,i,n){var a=i.type;return a===S?d(e,t,i.props.children,n,i.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===O&&ya(a)===t.type)?((n=r(t,i.props)).ref=ga(e,t,i),n.return=e,n):((n=kc(i.type,i.key,i.props,null,e.mode,n)).ref=ga(e,t,i),n.return=e,n)}function h(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Nc(i,e.mode,n)).return=e,t):((t=r(t,i.children||[])).return=e,t)}function d(e,t,i,n,a){return null===t||7!==t.tag?((t=Lc(i,e.mode,n,a)).return=e,t):((t=r(t,i)).return=e,t)}function u(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Bc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(i=kc(t.type,t.key,t.props,null,e.mode,i)).ref=ga(e,null,t),i.return=e,i;case _:return(t=Nc(t,e.mode,i)).return=e,t;case O:return u(e,(0,t._init)(t._payload),i)}if(te(t)||L(t))return(t=Lc(t,e.mode,i,null)).return=e,t;va(e,t)}return null}function p(e,t,i,n){var r=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==r?null:l(e,t,""+i,n);if("object"===typeof i&&null!==i){switch(i.$$typeof){case w:return i.key===r?c(e,t,i,n):null;case _:return i.key===r?h(e,t,i,n):null;case O:return p(e,t,(r=i._init)(i._payload),n)}if(te(i)||L(i))return null!==r?null:d(e,t,i,n,null);va(e,i)}return null}function f(e,t,i,n,r){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(i)||null,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return c(t,e=e.get(null===n.key?i:n.key)||null,n,r);case _:return h(t,e=e.get(null===n.key?i:n.key)||null,n,r);case O:return f(e,t,i,(0,n._init)(n._payload),r)}if(te(n)||L(n))return d(t,e=e.get(i)||null,n,r,null);va(t,n)}return null}function m(r,a,o,l){for(var c=null,h=null,d=a,m=a=0,g=null;null!==d&&m<o.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(r,d,o[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(r,d),a=s(v,a,m),null===h?c=v:h.sibling=v,h=v,d=g}if(m===o.length)return i(r,d),ra&&Jr(r,m),c;if(null===d){for(;m<o.length;m++)null!==(d=u(r,o[m],l))&&(a=s(d,a,m),null===h?c=d:h.sibling=d,h=d);return ra&&Jr(r,m),c}for(d=n(r,d);m<o.length;m++)null!==(g=f(d,r,m,o[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),a=s(g,a,m),null===h?c=g:h.sibling=g,h=g);return e&&d.forEach((function(e){return t(r,e)})),ra&&Jr(r,m),c}function g(r,o,l,c){var h=L(l);if("function"!==typeof h)throw Error(a(150));if(null==(l=h.call(l)))throw Error(a(151));for(var d=h=null,m=o,g=o=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var b=p(r,m,y.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(r,m),o=s(b,o,g),null===d?h=b:d.sibling=b,d=b,m=v}if(y.done)return i(r,m),ra&&Jr(r,g),h;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=u(r,y.value,c))&&(o=s(y,o,g),null===d?h=y:d.sibling=y,d=y);return ra&&Jr(r,g),h}for(m=n(r,m);!y.done;g++,y=l.next())null!==(y=f(m,r,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),o=s(y,o,g),null===d?h=y:d.sibling=y,d=y);return e&&m.forEach((function(e){return t(r,e)})),ra&&Jr(r,g),h}return function e(n,a,s,l){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case w:e:{for(var c=s.key,h=a;null!==h;){if(h.key===c){if((c=s.type)===S){if(7===h.tag){i(n,h.sibling),(a=r(h,s.props.children)).return=n,n=a;break e}}else if(h.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===O&&ya(c)===h.type){i(n,h.sibling),(a=r(h,s.props)).ref=ga(n,h,s),a.return=n,n=a;break e}i(n,h);break}t(n,h),h=h.sibling}s.type===S?((a=Lc(s.props.children,n.mode,l,s.key)).return=n,n=a):((l=kc(s.type,s.key,s.props,null,n.mode,l)).ref=ga(n,a,s),l.return=n,n=l)}return o(n);case _:e:{for(h=s.key;null!==a;){if(a.key===h){if(4===a.tag&&a.stateNode.containerInfo===s.containerInfo&&a.stateNode.implementation===s.implementation){i(n,a.sibling),(a=r(a,s.children||[])).return=n,n=a;break e}i(n,a);break}t(n,a),a=a.sibling}(a=Nc(s,n.mode,l)).return=n,n=a}return o(n);case O:return e(n,a,(h=s._init)(s._payload),l)}if(te(s))return m(n,a,s,l);if(L(s))return g(n,a,s,l);va(n,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==a&&6===a.tag?(i(n,a.sibling),(a=r(a,s)).return=n,n=a):(i(n,a),(a=Bc(s,n.mode,l)).return=n,n=a),o(n)):i(n,a)}}var xa=ba(!0),wa=ba(!1),_a=Ar(null),Sa=null,Aa=null,Ea=null;function Ca(){Ea=Aa=Sa=null}function Ma(e){var t=_a.current;Er(_a),e._currentValue=t}function Pa(e,t,i){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===i)break;e=e.return}}function Ta(e,t){Sa=e,Ea=Aa=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(bo=!0),e.firstContext=null)}function Da(e){var t=e._currentValue;if(Ea!==e)if(e={context:e,memoizedValue:t,next:null},null===Aa){if(null===Sa)throw Error(a(308));Aa=e,Sa.dependencies={lanes:0,firstContext:e}}else Aa=Aa.next=e;return t}var Ra=null;function Oa(e){null===Ra?Ra=[e]:Ra.push(e)}function Ia(e,t,i,n){var r=t.interleaved;return null===r?(i.next=i,Oa(t)):(i.next=r.next,r.next=i),t.interleaved=i,ka(e,n)}function ka(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var La=!1;function Fa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ba(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Na(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function za(e,t,i){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Pl)){var r=n.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),n.pending=t,ka(e,i)}return null===(r=n.interleaved)?(t.next=t,Oa(n)):(t.next=r.next,r.next=t),n.interleaved=t,ka(e,i)}function Ua(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}function ja(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var r=null,a=null;if(null!==(i=i.firstBaseUpdate)){do{var s={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===a?r=a=s:a=a.next=s,i=i.next}while(null!==i);null===a?r=a=t:a=a.next=t}else r=a=t;return i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Va(e,t,i,n){var r=e.updateQueue;La=!1;var a=r.firstBaseUpdate,s=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var l=o,c=l.next;l.next=null,null===s?a=c:s.next=c,s=l;var h=e.alternate;null!==h&&((o=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===o?h.firstBaseUpdate=c:o.next=c,h.lastBaseUpdate=l))}if(null!==a){var d=r.baseState;for(s=0,h=c=l=null,o=a;;){var u=o.lane,p=o.eventTime;if((n&u)===u){null!==h&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(u=t,p=i,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,u);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(u="function"===typeof(f=m.payload)?f.call(p,d,u):f)||void 0===u)break e;d=B({},d,u);break e;case 2:La=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(u=r.effects)?r.effects=[o]:u.push(o))}else p={eventTime:p,lane:u,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=p,l=d):h=h.next=p,s|=u;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(u=o).next,u.next=null,r.lastBaseUpdate=u,r.shared.pending=null}}if(null===h&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=h,null!==(t=r.shared.interleaved)){r=t;do{s|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);Fl|=s,e.lanes=s,e.memoizedState=d}}function Ga(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],r=n.callback;if(null!==r){if(n.callback=null,n=i,"function"!==typeof r)throw Error(a(191,r));r.call(n)}}}var Ha={},Wa=Ar(Ha),qa=Ar(Ha),Xa=Ar(Ha);function Ya(e){if(e===Ha)throw Error(a(174));return e}function Qa(e,t){switch(Cr(Xa,t),Cr(qa,e),Cr(Wa,Ha),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Er(Wa),Cr(Wa,t)}function Ka(){Er(Wa),Er(qa),Er(Xa)}function Za(e){Ya(Xa.current);var t=Ya(Wa.current),i=le(t,e.type);t!==i&&(Cr(qa,e),Cr(Wa,i))}function Ja(e){qa.current===e&&(Er(Wa),Er(qa))}var $a=Ar(0);function es(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ts=[];function is(){for(var e=0;e<ts.length;e++)ts[e]._workInProgressVersionPrimary=null;ts.length=0}var ns=x.ReactCurrentDispatcher,rs=x.ReactCurrentBatchConfig,as=0,ss=null,os=null,ls=null,cs=!1,hs=!1,ds=0,us=0;function ps(){throw Error(a(321))}function fs(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!on(e[i],t[i]))return!1;return!0}function ms(e,t,i,n,r,s){if(as=s,ss=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ns.current=null===e||null===e.memoizedState?Js:$s,e=i(n,r),hs){s=0;do{if(hs=!1,ds=0,25<=s)throw Error(a(301));s+=1,ls=os=null,t.updateQueue=null,ns.current=eo,e=i(n,r)}while(hs)}if(ns.current=Zs,t=null!==os&&null!==os.next,as=0,ls=os=ss=null,cs=!1,t)throw Error(a(300));return e}function gs(){var e=0!==ds;return ds=0,e}function vs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ls?ss.memoizedState=ls=e:ls=ls.next=e,ls}function ys(){if(null===os){var e=ss.alternate;e=null!==e?e.memoizedState:null}else e=os.next;var t=null===ls?ss.memoizedState:ls.next;if(null!==t)ls=t,os=e;else{if(null===e)throw Error(a(310));e={memoizedState:(os=e).memoizedState,baseState:os.baseState,baseQueue:os.baseQueue,queue:os.queue,next:null},null===ls?ss.memoizedState=ls=e:ls=ls.next=e}return ls}function bs(e,t){return"function"===typeof t?t(e):t}function xs(e){var t=ys(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var n=os,r=n.baseQueue,s=i.pending;if(null!==s){if(null!==r){var o=r.next;r.next=s.next,s.next=o}n.baseQueue=r=s,i.pending=null}if(null!==r){s=r.next,n=n.baseState;var l=o=null,c=null,h=s;do{var d=h.lane;if((as&d)===d)null!==c&&(c=c.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),n=h.hasEagerState?h.eagerState:e(n,h.action);else{var u={lane:d,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===c?(l=c=u,o=n):c=c.next=u,ss.lanes|=d,Fl|=d}h=h.next}while(null!==h&&h!==s);null===c?o=n:c.next=l,on(n,t.memoizedState)||(bo=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=c,i.lastRenderedState=n}if(null!==(e=i.interleaved)){r=e;do{s=r.lane,ss.lanes|=s,Fl|=s,r=r.next}while(r!==e)}else null===r&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function ws(e){var t=ys(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var n=i.dispatch,r=i.pending,s=t.memoizedState;if(null!==r){i.pending=null;var o=r=r.next;do{s=e(s,o.action),o=o.next}while(o!==r);on(s,t.memoizedState)||(bo=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),i.lastRenderedState=s}return[s,n]}function _s(){}function Ss(e,t){var i=ss,n=ys(),r=t(),s=!on(n.memoizedState,r);if(s&&(n.memoizedState=r,bo=!0),n=n.queue,Ls(Cs.bind(null,i,n,e),[e]),n.getSnapshot!==t||s||null!==ls&&1&ls.memoizedState.tag){if(i.flags|=2048,Ds(9,Es.bind(null,i,n,r,t),void 0,null),null===Tl)throw Error(a(349));0!==(30&as)||As(i,t,r)}return r}function As(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=ss.updateQueue)?(t={lastEffect:null,stores:null},ss.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Es(e,t,i,n){t.value=i,t.getSnapshot=n,Ms(t)&&Ps(e)}function Cs(e,t,i){return i((function(){Ms(t)&&Ps(e)}))}function Ms(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!on(e,i)}catch(n){return!0}}function Ps(e){var t=ka(e,1);null!==t&&ic(t,e,1,-1)}function Ts(e){var t=vs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bs,lastRenderedState:e},t.queue=e,e=e.dispatch=Xs.bind(null,ss,e),[t.memoizedState,e]}function Ds(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=ss.updateQueue)?(t={lastEffect:null,stores:null},ss.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function Rs(){return ys().memoizedState}function Os(e,t,i,n){var r=vs();ss.flags|=e,r.memoizedState=Ds(1|t,i,void 0,void 0===n?null:n)}function Is(e,t,i,n){var r=ys();n=void 0===n?null:n;var a=void 0;if(null!==os){var s=os.memoizedState;if(a=s.destroy,null!==n&&fs(n,s.deps))return void(r.memoizedState=Ds(t,i,a,n))}ss.flags|=e,r.memoizedState=Ds(1|t,i,a,n)}function ks(e,t){return Os(8390656,8,e,t)}function Ls(e,t){return Is(2048,8,e,t)}function Fs(e,t){return Is(4,2,e,t)}function Bs(e,t){return Is(4,4,e,t)}function Ns(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function zs(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Is(4,4,Ns.bind(null,t,e),i)}function Us(){}function js(e,t){var i=ys();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&fs(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Vs(e,t){var i=ys();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&fs(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Gs(e,t,i){return 0===(21&as)?(e.baseState&&(e.baseState=!1,bo=!0),e.memoizedState=i):(on(i,t)||(i=mt(),ss.lanes|=i,Fl|=i,e.baseState=!0),t)}function Hs(e,t){var i=bt;bt=0!==i&&4>i?i:4,e(!0);var n=rs.transition;rs.transition={};try{e(!1),t()}finally{bt=i,rs.transition=n}}function Ws(){return ys().memoizedState}function qs(e,t,i){var n=tc(e);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},Ys(e))Qs(t,i);else if(null!==(i=Ia(e,t,i,n))){ic(i,e,n,ec()),Ks(i,t,n)}}function Xs(e,t,i){var n=tc(e),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(Ys(e))Qs(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var s=t.lastRenderedState,o=a(s,i);if(r.hasEagerState=!0,r.eagerState=o,on(o,s)){var l=t.interleaved;return null===l?(r.next=r,Oa(t)):(r.next=l.next,l.next=r),void(t.interleaved=r)}}catch(c){}null!==(i=Ia(e,t,r,n))&&(ic(i,e,n,r=ec()),Ks(i,t,n))}}function Ys(e){var t=e.alternate;return e===ss||null!==t&&t===ss}function Qs(e,t){hs=cs=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Ks(e,t,i){if(0!==(4194240&i)){var n=t.lanes;i|=n&=e.pendingLanes,t.lanes=i,yt(e,i)}}var Zs={readContext:Da,useCallback:ps,useContext:ps,useEffect:ps,useImperativeHandle:ps,useInsertionEffect:ps,useLayoutEffect:ps,useMemo:ps,useReducer:ps,useRef:ps,useState:ps,useDebugValue:ps,useDeferredValue:ps,useTransition:ps,useMutableSource:ps,useSyncExternalStore:ps,useId:ps,unstable_isNewReconciler:!1},Js={readContext:Da,useCallback:function(e,t){return vs().memoizedState=[e,void 0===t?null:t],e},useContext:Da,useEffect:ks,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Os(4194308,4,Ns.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Os(4194308,4,e,t)},useInsertionEffect:function(e,t){return Os(4,2,e,t)},useMemo:function(e,t){var i=vs();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=vs();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=qs.bind(null,ss,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},vs().memoizedState=e},useState:Ts,useDebugValue:Us,useDeferredValue:function(e){return vs().memoizedState=e},useTransition:function(){var e=Ts(!1),t=e[0];return e=Hs.bind(null,e[1]),vs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var n=ss,r=vs();if(ra){if(void 0===i)throw Error(a(407));i=i()}else{if(i=t(),null===Tl)throw Error(a(349));0!==(30&as)||As(n,t,i)}r.memoizedState=i;var s={value:i,getSnapshot:t};return r.queue=s,ks(Cs.bind(null,n,s,e),[e]),n.flags|=2048,Ds(9,Es.bind(null,n,s,i,t),void 0,null),i},useId:function(){var e=vs(),t=Tl.identifierPrefix;if(ra){var i=Zr;t=":"+t+"R"+(i=(Kr&~(1<<32-st(Kr)-1)).toString(32)+i),0<(i=ds++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=us++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$s={readContext:Da,useCallback:js,useContext:Da,useEffect:Ls,useImperativeHandle:zs,useInsertionEffect:Fs,useLayoutEffect:Bs,useMemo:Vs,useReducer:xs,useRef:Rs,useState:function(){return xs(bs)},useDebugValue:Us,useDeferredValue:function(e){return Gs(ys(),os.memoizedState,e)},useTransition:function(){return[xs(bs)[0],ys().memoizedState]},useMutableSource:_s,useSyncExternalStore:Ss,useId:Ws,unstable_isNewReconciler:!1},eo={readContext:Da,useCallback:js,useContext:Da,useEffect:Ls,useImperativeHandle:zs,useInsertionEffect:Fs,useLayoutEffect:Bs,useMemo:Vs,useReducer:ws,useRef:Rs,useState:function(){return ws(bs)},useDebugValue:Us,useDeferredValue:function(e){var t=ys();return null===os?t.memoizedState=e:Gs(t,os.memoizedState,e)},useTransition:function(){return[ws(bs)[0],ys().memoizedState]},useMutableSource:_s,useSyncExternalStore:Ss,useId:Ws,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var i in t=B({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function io(e,t,i,n){i=null===(i=i(n,t=e.memoizedState))||void 0===i?t:B({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var no={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=ec(),r=tc(e),a=Na(n,r);a.payload=t,void 0!==i&&null!==i&&(a.callback=i),null!==(t=za(e,a,r))&&(ic(t,e,r,n),Ua(t,e,r))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=ec(),r=tc(e),a=Na(n,r);a.tag=1,a.payload=t,void 0!==i&&null!==i&&(a.callback=i),null!==(t=za(e,a,r))&&(ic(t,e,r,n),Ua(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ec(),n=tc(e),r=Na(i,n);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=za(e,r,n))&&(ic(t,e,n,i),Ua(t,e,n))}};function ro(e,t,i,n,r,a,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,a,s):!t.prototype||!t.prototype.isPureReactComponent||(!ln(i,n)||!ln(r,a))}function ao(e,t,i){var n=!1,r=Mr,a=t.contextType;return"object"===typeof a&&null!==a?a=Da(a):(r=Or(t)?Dr:Pr.current,a=(n=null!==(n=t.contextTypes)&&void 0!==n)?Rr(e,r):Mr),t=new t(i,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=no,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function so(e,t,i,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&no.enqueueReplaceState(t,t.state,null)}function oo(e,t,i,n){var r=e.stateNode;r.props=i,r.state=e.memoizedState,r.refs={},Fa(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Da(a):(a=Or(t)?Dr:Pr.current,r.context=Rr(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(io(e,t,a,i),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&no.enqueueReplaceState(r,r.state,null),Va(e,i,r,n),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var i="",n=t;do{i+=j(n),n=n.return}while(n);var r=i}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function ho(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var uo="function"===typeof WeakMap?WeakMap:Map;function po(e,t,i){(i=Na(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Hl||(Hl=!0,Wl=n),ho(0,t)},i}function fo(e,t,i){(i=Na(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var r=t.value;i.payload=function(){return n(r)},i.callback=function(){ho(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(i.callback=function(){ho(0,t),"function"!==typeof n&&(null===ql?ql=new Set([this]):ql.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function mo(e,t,i){var n=e.pingCache;if(null===n){n=e.pingCache=new uo;var r=new Set;n.set(t,r)}else void 0===(r=n.get(t))&&(r=new Set,n.set(t,r));r.has(i)||(r.add(i),e=Ec.bind(null,e,t,i),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,i,n,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=Na(-1,1)).tag=2,za(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var yo=x.ReactCurrentOwner,bo=!1;function xo(e,t,i,n){t.child=null===e?wa(t,null,i,n):xa(t,e.child,i,n)}function wo(e,t,i,n,r){i=i.render;var a=t.ref;return Ta(t,r),n=ms(e,t,i,n,a,r),i=gs(),null===e||bo?(ra&&i&&ea(t),t.flags|=1,xo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function _o(e,t,i,n,r){if(null===e){var a=i.type;return"function"!==typeof a||Oc(a)||void 0!==a.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=kc(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,So(e,t,a,n,r))}if(a=e.child,0===(e.lanes&r)){var s=a.memoizedProps;if((i=null!==(i=i.compare)?i:ln)(s,n)&&e.ref===t.ref)return Ho(e,t,r)}return t.flags|=1,(e=Ic(a,n)).ref=t.ref,e.return=t,t.child=e}function So(e,t,i,n,r){if(null!==e){var a=e.memoizedProps;if(ln(a,n)&&e.ref===t.ref){if(bo=!1,t.pendingProps=n=a,0===(e.lanes&r))return t.lanes=e.lanes,Ho(e,t,r);0!==(131072&e.flags)&&(bo=!0)}}return Co(e,t,i,n,r)}function Ao(e,t,i){var n=t.pendingProps,r=n.children,a=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(Il,Ol),Ol|=i;else{if(0===(1073741824&i))return e=null!==a?a.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Cr(Il,Ol),Ol|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==a?a.baseLanes:i,Cr(Il,Ol),Ol|=n}else null!==a?(n=a.baseLanes|i,t.memoizedState=null):n=i,Cr(Il,Ol),Ol|=n;return xo(e,t,r,i),t.child}function Eo(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Co(e,t,i,n,r){var a=Or(i)?Dr:Pr.current;return a=Rr(t,a),Ta(t,r),i=ms(e,t,i,n,a,r),n=gs(),null===e||bo?(ra&&n&&ea(t),t.flags|=1,xo(e,t,i,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,Ho(e,t,r))}function Mo(e,t,i,n,r){if(Or(i)){var a=!0;Fr(t)}else a=!1;if(Ta(t,r),null===t.stateNode)Go(e,t),ao(t,i,n),oo(t,i,n,r),n=!0;else if(null===e){var s=t.stateNode,o=t.memoizedProps;s.props=o;var l=s.context,c=i.contextType;"object"===typeof c&&null!==c?c=Da(c):c=Rr(t,c=Or(i)?Dr:Pr.current);var h=i.getDerivedStateFromProps,d="function"===typeof h||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==n||l!==c)&&so(t,s,n,c),La=!1;var u=t.memoizedState;s.state=u,Va(t,n,s,r),l=t.memoizedState,o!==n||u!==l||Tr.current||La?("function"===typeof h&&(io(t,i,h,n),l=t.memoizedState),(o=La||ro(t,i,o,n,u,l,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),s.props=n,s.state=l,s.context=c,n=o):("function"===typeof s.componentDidMount&&(t.flags|=4194308),n=!1)}else{s=t.stateNode,Ba(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),s.props=c,d=t.pendingProps,u=s.context,"object"===typeof(l=i.contextType)&&null!==l?l=Da(l):l=Rr(t,l=Or(i)?Dr:Pr.current);var p=i.getDerivedStateFromProps;(h="function"===typeof p||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==d||u!==l)&&so(t,s,n,l),La=!1,u=t.memoizedState,s.state=u,Va(t,n,s,r);var f=t.memoizedState;o!==d||u!==f||Tr.current||La?("function"===typeof p&&(io(t,i,p,n),f=t.memoizedState),(c=La||ro(t,i,c,n,u,f,l)||!1)?(h||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(n,f,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,f,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),s.props=n,s.state=f,s.context=l,n=c):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&u===e.memoizedState||(t.flags|=1024),n=!1)}return Po(e,t,i,n,a,r)}function Po(e,t,i,n,r,a){Eo(e,t);var s=0!==(128&t.flags);if(!n&&!s)return r&&Br(t,i,!1),Ho(e,t,a);n=t.stateNode,yo.current=t;var o=s&&"function"!==typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&s?(t.child=xa(t,e.child,null,a),t.child=xa(t,null,o,a)):xo(e,t,o,a),t.memoizedState=n.state,r&&Br(t,i,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?kr(0,t.pendingContext,t.pendingContext!==t.context):t.context&&kr(0,t.context,!1),Qa(e,t.containerInfo)}function Do(e,t,i,n,r){return pa(),fa(r),t.flags|=256,xo(e,t,i,n),t.child}var Ro,Oo,Io,ko,Lo={dehydrated:null,treeContext:null,retryLane:0};function Fo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Bo(e,t,i){var n,r=t.pendingProps,s=$a.current,o=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&s)),n?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Cr($a,1&s),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=r.children,e=r.fallback,o?(r=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Fc(l,r,0,null),e=Lc(e,r,i,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Fo(i),t.memoizedState=Lo,e):No(t,l));if(null!==(s=e.memoizedState)&&null!==(n=s.dehydrated))return function(e,t,i,n,r,s,o){if(i)return 256&t.flags?(t.flags&=-257,zo(e,t,o,n=co(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=n.fallback,r=t.mode,n=Fc({mode:"visible",children:n.children},r,0,null),(s=Lc(s,r,o,null)).flags|=2,n.return=t,s.return=t,n.sibling=s,t.child=n,0!==(1&t.mode)&&xa(t,e.child,null,o),t.child.memoizedState=Fo(o),t.memoizedState=Lo,s);if(0===(1&t.mode))return zo(e,t,o,null);if("$!"===r.data){if(n=r.nextSibling&&r.nextSibling.dataset)var l=n.dgst;return n=l,zo(e,t,o,n=co(s=Error(a(419)),n,void 0))}if(l=0!==(o&e.childLanes),bo||l){if(null!==(n=Tl)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(n.suspendedLanes|o))?0:r)&&r!==s.retryLane&&(s.retryLane=r,ka(e,r),ic(n,e,r,-1))}return mc(),zo(e,t,o,n=co(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Mc.bind(null,e),r._reactRetry=t,null):(e=s.treeContext,na=cr(r.nextSibling),ia=t,ra=!0,aa=null,null!==e&&(Xr[Yr++]=Kr,Xr[Yr++]=Zr,Xr[Yr++]=Qr,Kr=e.id,Zr=e.overflow,Qr=t),t=No(t,n.children),t.flags|=4096,t)}(e,t,l,r,n,s,i);if(o){o=r.fallback,l=t.mode,n=(s=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&l)&&t.child!==s?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Ic(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==n?o=Ic(n,o):(o=Lc(o,l,i,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,l=null===(l=e.child.memoizedState)?Fo(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~i,t.memoizedState=Lo,r}return e=(o=e.child).sibling,r=Ic(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=i),r.return=t,r.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=r,t.memoizedState=null,r}function No(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function zo(e,t,i,n){return null!==n&&fa(n),xa(t,e.child,null,i),(e=No(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Uo(e,t,i){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Pa(e.return,t,i)}function jo(e,t,i,n,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=i,a.tailMode=r)}function Vo(e,t,i){var n=t.pendingProps,r=n.revealOrder,a=n.tail;if(xo(e,t,n.children,i),0!==(2&(n=$a.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Uo(e,i,t);else if(19===e.tag)Uo(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Cr($a,n),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(i=t.child,r=null;null!==i;)null!==(e=i.alternate)&&null===es(e)&&(r=i),i=i.sibling;null===(i=r)?(r=t.child,t.child=null):(r=i.sibling,i.sibling=null),jo(t,!1,r,i,a);break;case"backwards":for(i=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===es(e)){t.child=r;break}e=r.sibling,r.sibling=i,i=r,r=e}jo(t,!0,i,null,a);break;case"together":jo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Go(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ho(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(i=Ic(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Ic(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Wo(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function qo(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,n=0;if(t)for(var r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=14680064&r.subtreeFlags,n|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=n,e.childLanes=i,t}function Xo(e,t,i){var n=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qo(t),null;case 1:case 17:return Or(t.type)&&Ir(),qo(t),null;case 3:return n=t.stateNode,Ka(),Er(Tr),Er(Pr),is(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(da(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(sc(aa),aa=null))),Oo(e,t),qo(t),null;case 5:Ja(t);var r=Ya(Xa.current);if(i=t.type,null!==e&&null!=t.stateNode)Io(e,t,i,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(a(166));return qo(t),null}if(e=Ya(Wa.current),da(t)){n=t.stateNode,i=t.type;var s=t.memoizedProps;switch(n[ur]=t,n[pr]=s,e=0!==(1&t.mode),i){case"dialog":zn("cancel",n),zn("close",n);break;case"iframe":case"object":case"embed":zn("load",n);break;case"video":case"audio":for(r=0;r<Ln.length;r++)zn(Ln[r],n);break;case"source":zn("error",n);break;case"img":case"image":case"link":zn("error",n),zn("load",n);break;case"details":zn("toggle",n);break;case"input":K(n,s),zn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},zn("invalid",n);break;case"textarea":re(n,s),zn("invalid",n)}for(var l in ye(i,s),r=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==s.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Jn(n.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zn("scroll",n)}switch(i){case"input":q(n),$(n,s,!0);break;case"textarea":q(n),se(n);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(n.onclick=$n)}n=r,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(i,{is:n.is}):(e=l.createElement(i),"select"===i&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,i),e[ur]=t,e[pr]=n,Ro(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(i,n),i){case"dialog":zn("cancel",e),zn("close",e),r=n;break;case"iframe":case"object":case"embed":zn("load",e),r=n;break;case"video":case"audio":for(r=0;r<Ln.length;r++)zn(Ln[r],e);r=n;break;case"source":zn("error",e),r=n;break;case"img":case"image":case"link":zn("error",e),zn("load",e),r=n;break;case"details":zn("toggle",e),r=n;break;case"input":K(e,n),r=Q(e,n),zn("invalid",e);break;case"option":default:r=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=B({},n,{value:void 0}),zn("invalid",e);break;case"textarea":re(e,n),r=ne(e,n),zn("invalid",e)}for(s in ye(i,r),c=r)if(c.hasOwnProperty(s)){var h=c[s];"style"===s?ge(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&de(e,h):"children"===s?"string"===typeof h?("textarea"!==i||""!==h)&&ue(e,h):"number"===typeof h&&ue(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(o.hasOwnProperty(s)?null!=h&&"onScroll"===s&&zn("scroll",e):null!=h&&b(e,s,h,l))}switch(i){case"input":q(e),$(e,n,!1);break;case"textarea":q(e),se(e);break;case"option":null!=n.value&&e.setAttribute("value",""+H(n.value));break;case"select":e.multiple=!!n.multiple,null!=(s=n.value)?ie(e,!!n.multiple,s,!1):null!=n.defaultValue&&ie(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=$n)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return qo(t),null;case 6:if(e&&null!=t.stateNode)ko(e,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(a(166));if(i=Ya(Xa.current),Ya(Wa.current),da(t)){if(n=t.stateNode,i=t.memoizedProps,n[ur]=t,(s=n.nodeValue!==i)&&null!==(e=ia))switch(e.tag){case 3:Jn(n.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jn(n.nodeValue,i,0!==(1&e.mode))}s&&(t.flags|=4)}else(n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[ur]=t,t.stateNode=n}return qo(t),null;case 13:if(Er($a),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==na&&0!==(1&t.mode)&&0===(128&t.flags))ua(),pa(),t.flags|=98560,s=!1;else if(s=da(t),null!==n&&null!==n.dehydrated){if(null===e){if(!s)throw Error(a(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(a(317));s[ur]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;qo(t),s=!1}else null!==aa&&(sc(aa),aa=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$a.current)?0===kl&&(kl=3):mc())),null!==t.updateQueue&&(t.flags|=4),qo(t),null);case 4:return Ka(),Oo(e,t),null===e&&Vn(t.stateNode.containerInfo),qo(t),null;case 10:return Ma(t.type._context),qo(t),null;case 19:if(Er($a),null===(s=t.memoizedState))return qo(t),null;if(n=0!==(128&t.flags),null===(l=s.rendering))if(n)Wo(s,!1);else{if(0!==kl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=es(e))){for(t.flags|=128,Wo(s,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=i,i=t.child;null!==i;)e=n,(s=i).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Cr($a,1&$a.current|2),t.child}e=e.sibling}null!==s.tail&&Ze()>Vl&&(t.flags|=128,n=!0,Wo(s,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=es(l))){if(t.flags|=128,n=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Wo(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!ra)return qo(t),null}else 2*Ze()-s.renderingStartTime>Vl&&1073741824!==i&&(t.flags|=128,n=!0,Wo(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=s.last)?i.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ze(),t.sibling=null,i=$a.current,Cr($a,n?1&i|2:1&i),t):(qo(t),null);case 22:case 23:return dc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&Ol)&&(qo(t),6&t.subtreeFlags&&(t.flags|=8192)):qo(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Yo(e,t){switch(ta(t),t.tag){case 1:return Or(t.type)&&Ir(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ka(),Er(Tr),Er(Pr),is(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ja(t),null;case 13:if(Er($a),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Er($a),null;case 4:return Ka(),null;case 10:return Ma(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Ro=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Oo=function(){},Io=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,Ya(Wa.current);var a,s=null;switch(i){case"input":r=Q(e,r),n=Q(e,n),s=[];break;case"select":r=B({},r,{value:void 0}),n=B({},n,{value:void 0}),s=[];break;case"textarea":r=ne(e,r),n=ne(e,n),s=[];break;default:"function"!==typeof r.onClick&&"function"===typeof n.onClick&&(e.onclick=$n)}for(h in ye(i,n),i=null,r)if(!n.hasOwnProperty(h)&&r.hasOwnProperty(h)&&null!=r[h])if("style"===h){var l=r[h];for(a in l)l.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(o.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in n){var c=n[h];if(l=null!=r?r[h]:void 0,n.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(i||(i={}),i[a]=c[a])}else i||(s||(s=[]),s.push(h,i)),i=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(o.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&zn("scroll",e),s||l===c||(s=[])):(s=s||[]).push(h,c))}i&&(s=s||[]).push("style",i);var h=s;(t.updateQueue=h)&&(t.flags|=4)}},ko=function(e,t,i,n){i!==n&&(t.flags|=4)};var Qo=!1,Ko=!1,Zo="function"===typeof WeakSet?WeakSet:Set,Jo=null;function $o(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(n){Ac(e,t,n)}else i.current=null}function el(e,t,i){try{i()}catch(n){Ac(e,t,n)}}var tl=!1;function il(e,t,i){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&el(t,i,a)}r=r.next}while(r!==n)}}function nl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var n=i.create;i.destroy=n()}i=i.next}while(i!==t)}}function rl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ur],delete t[pr],delete t[mr],delete t[gr],delete t[vr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=$n));else if(4!==n&&null!==(e=e.child))for(ll(e,t,i),e=e.sibling;null!==e;)ll(e,t,i),e=e.sibling}function cl(e,t,i){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}var hl=null,dl=!1;function ul(e,t,i){for(i=i.child;null!==i;)pl(e,t,i),i=i.sibling}function pl(e,t,i){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,i)}catch(o){}switch(i.tag){case 5:Ko||$o(i,t);case 6:var n=hl,r=dl;hl=null,ul(e,t,i),dl=r,null!==(hl=n)&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):hl.removeChild(i.stateNode));break;case 18:null!==hl&&(dl?(e=hl,i=i.stateNode,8===e.nodeType?lr(e.parentNode,i):1===e.nodeType&&lr(e,i),Vt(e)):lr(hl,i.stateNode));break;case 4:n=hl,r=dl,hl=i.stateNode.containerInfo,dl=!0,ul(e,t,i),hl=n,dl=r;break;case 0:case 11:case 14:case 15:if(!Ko&&(null!==(n=i.updateQueue)&&null!==(n=n.lastEffect))){r=n=n.next;do{var a=r,s=a.destroy;a=a.tag,void 0!==s&&(0!==(2&a)||0!==(4&a))&&el(i,t,s),r=r.next}while(r!==n)}ul(e,t,i);break;case 1:if(!Ko&&($o(i,t),"function"===typeof(n=i.stateNode).componentWillUnmount))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(o){Ac(i,t,o)}ul(e,t,i);break;case 21:ul(e,t,i);break;case 22:1&i.mode?(Ko=(n=Ko)||null!==i.memoizedState,ul(e,t,i),Ko=n):ul(e,t,i);break;default:ul(e,t,i)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Zo),t.forEach((function(t){var n=Pc.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function ml(e,t){var i=t.deletions;if(null!==i)for(var n=0;n<i.length;n++){var r=i[n];try{var s=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(a(160));pl(s,o,r),hl=null,dl=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(h){Ac(r,t,h)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var i=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&n){try{il(3,e,e.return),nl(3,e)}catch(g){Ac(e,e.return,g)}try{il(5,e,e.return)}catch(g){Ac(e,e.return,g)}}break;case 1:ml(t,e),vl(e),512&n&&null!==i&&$o(i,i.return);break;case 5:if(ml(t,e),vl(e),512&n&&null!==i&&$o(i,i.return),32&e.flags){var r=e.stateNode;try{ue(r,"")}catch(g){Ac(e,e.return,g)}}if(4&n&&null!=(r=e.stateNode)){var s=e.memoizedProps,o=null!==i?i.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&Z(r,s),be(l,o);var h=be(l,s);for(o=0;o<c.length;o+=2){var d=c[o],u=c[o+1];"style"===d?ge(r,u):"dangerouslySetInnerHTML"===d?de(r,u):"children"===d?ue(r,u):b(r,d,u,h)}switch(l){case"input":J(r,s);break;case"textarea":ae(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var f=s.value;null!=f?ie(r,!!s.multiple,f,!1):p!==!!s.multiple&&(null!=s.defaultValue?ie(r,!!s.multiple,s.defaultValue,!0):ie(r,!!s.multiple,s.multiple?[]:"",!1))}r[pr]=s}catch(g){Ac(e,e.return,g)}}break;case 6:if(ml(t,e),vl(e),4&n){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,s=e.memoizedProps;try{r.nodeValue=s}catch(g){Ac(e,e.return,g)}}break;case 3:if(ml(t,e),vl(e),4&n&&null!==i&&i.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){Ac(e,e.return,g)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(r=e.child).flags&&(s=null!==r.memoizedState,r.stateNode.isHidden=s,!s||null!==r.alternate&&null!==r.alternate.memoizedState||(jl=Ze())),4&n&&fl(e);break;case 22:if(d=null!==i&&null!==i.memoizedState,1&e.mode?(Ko=(h=Ko)||d,ml(t,e),Ko=h):ml(t,e),vl(e),8192&n){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!d&&0!==(1&e.mode))for(Jo=e,d=e.child;null!==d;){for(u=Jo=d;null!==Jo;){switch(f=(p=Jo).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:$o(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){n=p,i=p.return;try{t=n,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Ac(n,i,g)}}break;case 5:$o(p,p.return);break;case 22:if(null!==p.memoizedState){wl(u);continue}}null!==f?(f.return=p,Jo=f):wl(u)}d=d.sibling}e:for(d=null,u=e;;){if(5===u.tag){if(null===d){d=u;try{r=u.stateNode,h?"function"===typeof(s=r.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=u.stateNode,o=void 0!==(c=u.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(g){Ac(e,e.return,g)}}}else if(6===u.tag){if(null===d)try{u.stateNode.nodeValue=h?"":u.memoizedProps}catch(g){Ac(e,e.return,g)}}else if((22!==u.tag&&23!==u.tag||null===u.memoizedState||u===e)&&null!==u.child){u.child.return=u,u=u.child;continue}if(u===e)break e;for(;null===u.sibling;){if(null===u.return||u.return===e)break e;d===u&&(d=null),u=u.return}d===u&&(d=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:ml(t,e),vl(e),4&n&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(sl(i)){var n=i;break e}i=i.return}throw Error(a(160))}switch(n.tag){case 5:var r=n.stateNode;32&n.flags&&(ue(r,""),n.flags&=-33),cl(e,ol(e),r);break;case 3:case 4:var s=n.stateNode.containerInfo;ll(e,ol(e),s);break;default:throw Error(a(161))}}catch(o){Ac(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,i){Jo=e,bl(e,t,i)}function bl(e,t,i){for(var n=0!==(1&e.mode);null!==Jo;){var r=Jo,a=r.child;if(22===r.tag&&n){var s=null!==r.memoizedState||Qo;if(!s){var o=r.alternate,l=null!==o&&null!==o.memoizedState||Ko;o=Qo;var c=Ko;if(Qo=s,(Ko=l)&&!c)for(Jo=r;null!==Jo;)l=(s=Jo).child,22===s.tag&&null!==s.memoizedState?_l(r):null!==l?(l.return=s,Jo=l):_l(r);for(;null!==a;)Jo=a,bl(a,t,i),a=a.sibling;Jo=r,Qo=o,Ko=c}xl(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,Jo=a):xl(e)}}function xl(e){for(;null!==Jo;){var t=Jo;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ko||nl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Ko)if(null===i)n.componentDidMount();else{var r=t.elementType===t.type?i.memoizedProps:to(t.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Ga(t,s,n);break;case 3:var o=t.updateQueue;if(null!==o){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Ga(t,o,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var d=h.memoizedState;if(null!==d){var u=d.dehydrated;null!==u&&Vt(u)}}}break;default:throw Error(a(163))}Ko||512&t.flags&&rl(t)}catch(p){Ac(t,t.return,p)}}if(t===e){Jo=null;break}if(null!==(i=t.sibling)){i.return=t.return,Jo=i;break}Jo=t.return}}function wl(e){for(;null!==Jo;){var t=Jo;if(t===e){Jo=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Jo=i;break}Jo=t.return}}function _l(e){for(;null!==Jo;){var t=Jo;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{nl(4,t)}catch(l){Ac(t,i,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var r=t.return;try{n.componentDidMount()}catch(l){Ac(t,r,l)}}var a=t.return;try{rl(t)}catch(l){Ac(t,a,l)}break;case 5:var s=t.return;try{rl(t)}catch(l){Ac(t,s,l)}}}catch(l){Ac(t,t.return,l)}if(t===e){Jo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Jo=o;break}Jo=t.return}}var Sl,Al=Math.ceil,El=x.ReactCurrentDispatcher,Cl=x.ReactCurrentOwner,Ml=x.ReactCurrentBatchConfig,Pl=0,Tl=null,Dl=null,Rl=0,Ol=0,Il=Ar(0),kl=0,Ll=null,Fl=0,Bl=0,Nl=0,zl=null,Ul=null,jl=0,Vl=1/0,Gl=null,Hl=!1,Wl=null,ql=null,Xl=!1,Yl=null,Ql=0,Kl=0,Zl=null,Jl=-1,$l=0;function ec(){return 0!==(6&Pl)?Ze():-1!==Jl?Jl:Jl=Ze()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Pl)&&0!==Rl?Rl&-Rl:null!==ma.transition?(0===$l&&($l=mt()),$l):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Kt(e.type)}function ic(e,t,i,n){if(50<Kl)throw Kl=0,Zl=null,Error(a(185));vt(e,i,n),0!==(2&Pl)&&e===Tl||(e===Tl&&(0===(2&Pl)&&(Bl|=i),4===kl&&oc(e,Rl)),nc(e,n),1===i&&0===Pl&&0===(1&t.mode)&&(Vl=Ze()+500,zr&&Vr()))}function nc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,n=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var s=31-st(a),o=1<<s,l=r[s];-1===l?0!==(o&i)&&0===(o&n)||(r[s]=pt(o,t)):l<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var n=ut(e,e===Tl?Rl:0);if(0===n)null!==i&&Ye(i),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=i&&Ye(i),1===t)0===e.tag?function(e){zr=!0,jr(e)}(lc.bind(null,e)):jr(lc.bind(null,e)),sr((function(){0===(6&Pl)&&Vr()})),i=null;else{switch(xt(n)){case 1:i=$e;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=nt}i=Tc(i,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function rc(e,t){if(Jl=-1,$l=0,0!==(6&Pl))throw Error(a(327));var i=e.callbackNode;if(_c()&&e.callbackNode!==i)return null;var n=ut(e,e===Tl?Rl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=gc(e,n);else{t=n;var r=Pl;Pl|=2;var s=fc();for(Tl===e&&Rl===t||(Gl=null,Vl=Ze()+500,uc(e,t));;)try{yc();break}catch(l){pc(e,l)}Ca(),El.current=s,Pl=r,null!==Dl?t=0:(Tl=null,Rl=0,t=kl)}if(0!==t){if(2===t&&(0!==(r=ft(e))&&(n=r,t=ac(e,r))),1===t)throw i=Ll,uc(e,0),oc(e,n),nc(e,Ze()),i;if(6===t)oc(e,n);else{if(r=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var n=0;n<i.length;n++){var r=i[n],a=r.getSnapshot;r=r.value;try{if(!on(a(),r))return!1}catch(o){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=gc(e,n))&&(0!==(s=ft(e))&&(n=s,t=ac(e,s))),1===t))throw i=Ll,uc(e,0),oc(e,n),nc(e,Ze()),i;switch(e.finishedWork=r,e.finishedLanes=n,t){case 0:case 1:throw Error(a(345));case 2:case 5:wc(e,Ul,Gl);break;case 3:if(oc(e,n),(130023424&n)===n&&10<(t=jl+500-Ze())){if(0!==ut(e,0))break;if(((r=e.suspendedLanes)&n)!==n){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=nr(wc.bind(null,e,Ul,Gl),t);break}wc(e,Ul,Gl);break;case 4:if(oc(e,n),(4194240&n)===n)break;for(t=e.eventTimes,r=-1;0<n;){var o=31-st(n);s=1<<o,(o=t[o])>r&&(r=o),n&=~s}if(n=r,10<(n=(120>(n=Ze()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Al(n/1960))-n)){e.timeoutHandle=nr(wc.bind(null,e,Ul,Gl),n);break}wc(e,Ul,Gl);break;default:throw Error(a(329))}}}return nc(e,Ze()),e.callbackNode===i?rc.bind(null,e):null}function ac(e,t){var i=zl;return e.current.memoizedState.isDehydrated&&(uc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=i,null!==t&&sc(t)),e}function sc(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function oc(e,t){for(t&=~Nl,t&=~Bl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-st(t),n=1<<i;e[i]=-1,t&=~n}}function lc(e){if(0!==(6&Pl))throw Error(a(327));_c();var t=ut(e,0);if(0===(1&t))return nc(e,Ze()),null;var i=gc(e,t);if(0!==e.tag&&2===i){var n=ft(e);0!==n&&(t=n,i=ac(e,n))}if(1===i)throw i=Ll,uc(e,0),oc(e,t),nc(e,Ze()),i;if(6===i)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Ul,Gl),nc(e,Ze()),null}function cc(e,t){var i=Pl;Pl|=1;try{return e(t)}finally{0===(Pl=i)&&(Vl=Ze()+500,zr&&Vr())}}function hc(e){null!==Yl&&0===Yl.tag&&0===(6&Pl)&&_c();var t=Pl;Pl|=1;var i=Ml.transition,n=bt;try{if(Ml.transition=null,bt=1,e)return e()}finally{bt=n,Ml.transition=i,0===(6&(Pl=t))&&Vr()}}function dc(){Ol=Il.current,Er(Il)}function uc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,rr(i)),null!==Dl)for(i=Dl.return;null!==i;){var n=i;switch(ta(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Ir();break;case 3:Ka(),Er(Tr),Er(Pr),is();break;case 5:Ja(n);break;case 4:Ka();break;case 13:case 19:Er($a);break;case 10:Ma(n.type._context);break;case 22:case 23:dc()}i=i.return}if(Tl=e,Dl=e=Ic(e.current,null),Rl=Ol=t,kl=0,Ll=null,Nl=Bl=Fl=0,Ul=zl=null,null!==Ra){for(t=0;t<Ra.length;t++)if(null!==(n=(i=Ra[t]).interleaved)){i.interleaved=null;var r=n.next,a=i.pending;if(null!==a){var s=a.next;a.next=r,n.next=s}i.pending=n}Ra=null}return e}function pc(e,t){for(;;){var i=Dl;try{if(Ca(),ns.current=Zs,cs){for(var n=ss.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}cs=!1}if(as=0,ls=os=ss=null,hs=!1,ds=0,Cl.current=null,null===i||null===i.return){kl=1,Ll=t,Dl=null;break}e:{var s=e,o=i.return,l=i,c=t;if(t=Rl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var h=c,d=l,u=d.tag;if(0===(1&d.mode)&&(0===u||11===u||15===u)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=go(o);if(null!==f){f.flags&=-257,vo(f,o,l,0,t),1&f.mode&&mo(s,h,t),c=h;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){mo(s,h,t),mc();break e}c=Error(a(426))}else if(ra&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),fa(lo(c,l));break e}}s=c=lo(c,l),4!==kl&&(kl=2),null===zl?zl=[s]:zl.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,ja(s,po(0,c,t));break e;case 1:l=c;var y=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===ql||!ql.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,ja(s,fo(s,l,t));break e}}s=s.return}while(null!==s)}xc(i)}catch(x){t=x,Dl===i&&null!==i&&(Dl=i=i.return);continue}break}}function fc(){var e=El.current;return El.current=Zs,null===e?Zs:e}function mc(){0!==kl&&3!==kl&&2!==kl||(kl=4),null===Tl||0===(268435455&Fl)&&0===(268435455&Bl)||oc(Tl,Rl)}function gc(e,t){var i=Pl;Pl|=2;var n=fc();for(Tl===e&&Rl===t||(Gl=null,uc(e,t));;)try{vc();break}catch(r){pc(e,r)}if(Ca(),Pl=i,El.current=n,null!==Dl)throw Error(a(261));return Tl=null,Rl=0,kl}function vc(){for(;null!==Dl;)bc(Dl)}function yc(){for(;null!==Dl&&!Qe();)bc(Dl)}function bc(e){var t=Sl(e.alternate,e,Ol);e.memoizedProps=e.pendingProps,null===t?xc(e):Dl=t,Cl.current=null}function xc(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=Xo(i,t,Ol)))return void(Dl=i)}else{if(null!==(i=Yo(i,t)))return i.flags&=32767,void(Dl=i);if(null===e)return kl=6,void(Dl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Dl=t);Dl=t=e}while(null!==t);0===kl&&(kl=5)}function wc(e,t,i){var n=bt,r=Ml.transition;try{Ml.transition=null,bt=1,function(e,t,i,n){do{_c()}while(null!==Yl);if(0!==(6&Pl))throw Error(a(327));i=e.finishedWork;var r=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<i;){var r=31-st(i),a=1<<r;t[r]=0,n[r]=-1,e[r]=-1,i&=~a}}(e,s),e===Tl&&(Dl=Tl=null,Rl=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||Xl||(Xl=!0,Tc(tt,(function(){return _c(),null}))),s=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||s){s=Ml.transition,Ml.transition=null;var o=bt;bt=1;var l=Pl;Pl|=4,Cl.current=null,function(e,t){if(er=Ht,pn(e=un())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(n&&0!==n.rangeCount){i=n.anchorNode;var r=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{i.nodeType,s.nodeType}catch(w){i=null;break e}var o=0,l=-1,c=-1,h=0,d=0,u=e,p=null;t:for(;;){for(var f;u!==i||0!==r&&3!==u.nodeType||(l=o+r),u!==s||0!==n&&3!==u.nodeType||(c=o+n),3===u.nodeType&&(o+=u.nodeValue.length),null!==(f=u.firstChild);)p=u,u=f;for(;;){if(u===e)break t;if(p===i&&++h===r&&(l=o),p===s&&++d===n&&(c=o),null!==(f=u.nextSibling))break;p=(u=p).parentNode}u=f}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(tr={focusedElem:e,selectionRange:i},Ht=!1,Jo=t;null!==Jo;)if(e=(t=Jo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Jo=e;else for(;null!==Jo;){t=Jo;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(w){Ac(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Jo=e;break}Jo=t.return}m=tl,tl=!1}(e,i),gl(i,e),fn(tr),Ht=!!er,tr=er=null,e.current=i,yl(i,e,r),Ke(),Pl=l,bt=o,Ml.transition=s}else e.current=i;if(Xl&&(Xl=!1,Yl=e,Ql=r),s=e.pendingLanes,0===s&&(ql=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),nc(e,Ze()),null!==t)for(n=e.onRecoverableError,i=0;i<t.length;i++)r=t[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(Hl)throw Hl=!1,e=Wl,Wl=null,e;0!==(1&Ql)&&0!==e.tag&&_c(),s=e.pendingLanes,0!==(1&s)?e===Zl?Kl++:(Kl=0,Zl=e):Kl=0,Vr()}(e,t,i,n)}finally{Ml.transition=r,bt=n}return null}function _c(){if(null!==Yl){var e=xt(Ql),t=Ml.transition,i=bt;try{if(Ml.transition=null,bt=16>e?16:e,null===Yl)var n=!1;else{if(e=Yl,Yl=null,Ql=0,0!==(6&Pl))throw Error(a(331));var r=Pl;for(Pl|=4,Jo=e.current;null!==Jo;){var s=Jo,o=s.child;if(0!==(16&Jo.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var h=l[c];for(Jo=h;null!==Jo;){var d=Jo;switch(d.tag){case 0:case 11:case 15:il(8,d,s)}var u=d.child;if(null!==u)u.return=d,Jo=u;else for(;null!==Jo;){var p=(d=Jo).sibling,f=d.return;if(al(d),d===h){Jo=null;break}if(null!==p){p.return=f,Jo=p;break}Jo=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Jo=s}}if(0!==(2064&s.subtreeFlags)&&null!==o)o.return=s,Jo=o;else e:for(;null!==Jo;){if(0!==(2048&(s=Jo).flags))switch(s.tag){case 0:case 11:case 15:il(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,Jo=y;break e}Jo=s.return}}var b=e.current;for(Jo=b;null!==Jo;){var x=(o=Jo).child;if(0!==(2064&o.subtreeFlags)&&null!==x)x.return=o,Jo=x;else e:for(o=b;null!==Jo;){if(0!==(2048&(l=Jo).flags))try{switch(l.tag){case 0:case 11:case 15:nl(9,l)}}catch(_){Ac(l,l.return,_)}if(l===o){Jo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Jo=w;break e}Jo=l.return}}if(Pl=r,Vr(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(_){}n=!0}return n}finally{bt=i,Ml.transition=t}}return!1}function Sc(e,t,i){e=za(e,t=po(0,t=lo(i,t),1),1),t=ec(),null!==e&&(vt(e,1,t),nc(e,t))}function Ac(e,t,i){if(3===e.tag)Sc(e,e,i);else for(;null!==t;){if(3===t.tag){Sc(t,e,i);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===ql||!ql.has(n))){t=za(t,e=fo(t,e=lo(i,e),1),1),e=ec(),null!==t&&(vt(t,1,e),nc(t,e));break}}t=t.return}}function Ec(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&i,Tl===e&&(Rl&i)===i&&(4===kl||3===kl&&(130023424&Rl)===Rl&&500>Ze()-jl?uc(e,0):Nl|=i),nc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var i=ec();null!==(e=ka(e,t))&&(vt(e,t,i),nc(e,i))}function Mc(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Cc(e,i)}function Pc(e,t){var i=0;switch(e.tag){case 13:var n=e.stateNode,r=e.memoizedState;null!==r&&(i=r.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(a(314))}null!==n&&n.delete(t),Cc(e,i)}function Tc(e,t){return Xe(e,t)}function Dc(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,i,n){return new Dc(e,t,i,n)}function Oc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Ic(e,t){var i=e.alternate;return null===i?((i=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function kc(e,t,i,n,r,s){var o=2;if(n=e,"function"===typeof e)Oc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case S:return Lc(i.children,r,s,t);case A:o=8,r|=8;break;case E:return(e=Rc(12,i,t,2|r)).elementType=E,e.lanes=s,e;case T:return(e=Rc(13,i,t,r)).elementType=T,e.lanes=s,e;case D:return(e=Rc(19,i,t,r)).elementType=D,e.lanes=s,e;case I:return Fc(i,r,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:o=10;break e;case M:o=9;break e;case P:o=11;break e;case R:o=14;break e;case O:o=16,n=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Rc(o,i,t,r)).elementType=e,t.type=n,t.lanes=s,t}function Lc(e,t,i,n){return(e=Rc(7,e,n,t)).lanes=i,e}function Fc(e,t,i,n){return(e=Rc(22,e,n,t)).elementType=I,e.lanes=i,e.stateNode={isHidden:!1},e}function Bc(e,t,i){return(e=Rc(6,e,null,t)).lanes=i,e}function Nc(e,t,i){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,i,n,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Uc(e,t,i,n,r,a,s,o,l){return e=new zc(e,t,i,o,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Rc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fa(a),e}function jc(e){if(!e)return Mr;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Or(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var i=e.type;if(Or(i))return Lr(e,i,t)}return t}function Vc(e,t,i,n,r,a,s,o,l){return(e=Uc(i,n,!0,e,0,a,0,o,l)).context=jc(null),i=e.current,(a=Na(n=ec(),r=tc(i))).callback=void 0!==t&&null!==t?t:null,za(i,a,r),e.current.lanes=r,vt(e,r,n),nc(e,n),e}function Gc(e,t,i,n){var r=t.current,a=ec(),s=tc(r);return i=jc(i),null===t.context?t.context=i:t.pendingContext=i,(t=Na(a,s)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=za(r,t,s))&&(ic(e,r,s,a),Ua(e,r,s)),s}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function qc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}Sl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Tr.current)bo=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return bo=!1,function(e,t,i){switch(t.tag){case 3:To(t),pa();break;case 5:Za(t);break;case 1:Or(t.type)&&Fr(t);break;case 4:Qa(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,r=t.memoizedProps.value;Cr(_a,n._currentValue),n._currentValue=r;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Cr($a,1&$a.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Bo(e,t,i):(Cr($a,1&$a.current),null!==(e=Ho(e,t,i))?e.sibling:null);Cr($a,1&$a.current);break;case 19:if(n=0!==(i&t.childLanes),0!==(128&e.flags)){if(n)return Vo(e,t,i);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),Cr($a,$a.current),n)break;return null;case 22:case 23:return t.lanes=0,Ao(e,t,i)}return Ho(e,t,i)}(e,t,i);bo=0!==(131072&e.flags)}else bo=!1,ra&&0!==(1048576&t.flags)&&$r(t,qr,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Go(e,t),e=t.pendingProps;var r=Rr(t,Pr.current);Ta(t,i),r=ms(null,t,n,e,r,i);var s=gs();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Or(n)?(s=!0,Fr(t)):s=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,Fa(t),r.updater=no,t.stateNode=r,r._reactInternals=t,oo(t,n,e,i),t=Po(null,t,n,!0,s,i)):(t.tag=0,ra&&s&&ea(t),xo(null,t,r,i),t=t.child),t;case 16:n=t.elementType;e:{switch(Go(e,t),e=t.pendingProps,n=(r=n._init)(n._payload),t.type=n,r=t.tag=function(e){if("function"===typeof e)return Oc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===P)return 11;if(e===R)return 14}return 2}(n),e=to(n,e),r){case 0:t=Co(null,t,n,e,i);break e;case 1:t=Mo(null,t,n,e,i);break e;case 11:t=wo(null,t,n,e,i);break e;case 14:t=_o(null,t,n,to(n.type,e),i);break e}throw Error(a(306,n,""))}return t;case 0:return n=t.type,r=t.pendingProps,Co(e,t,n,r=t.elementType===n?r:to(n,r),i);case 1:return n=t.type,r=t.pendingProps,Mo(e,t,n,r=t.elementType===n?r:to(n,r),i);case 3:e:{if(To(t),null===e)throw Error(a(387));n=t.pendingProps,r=(s=t.memoizedState).element,Ba(e,t),Va(t,n,null,i);var o=t.memoizedState;if(n=o.element,s.isDehydrated){if(s={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Do(e,t,n,i,r=lo(Error(a(423)),t));break e}if(n!==r){t=Do(e,t,n,i,r=lo(Error(a(424)),t));break e}for(na=cr(t.stateNode.containerInfo.firstChild),ia=t,ra=!0,aa=null,i=wa(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(pa(),n===r){t=Ho(e,t,i);break e}xo(e,t,n,i)}t=t.child}return t;case 5:return Za(t),null===e&&ca(t),n=t.type,r=t.pendingProps,s=null!==e?e.memoizedProps:null,o=r.children,ir(n,r)?o=null:null!==s&&ir(n,s)&&(t.flags|=32),Eo(e,t),xo(e,t,o,i),t.child;case 6:return null===e&&ca(t),null;case 13:return Bo(e,t,i);case 4:return Qa(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=xa(t,null,n,i):xo(e,t,n,i),t.child;case 11:return n=t.type,r=t.pendingProps,wo(e,t,n,r=t.elementType===n?r:to(n,r),i);case 7:return xo(e,t,t.pendingProps,i),t.child;case 8:case 12:return xo(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(n=t.type._context,r=t.pendingProps,s=t.memoizedProps,o=r.value,Cr(_a,n._currentValue),n._currentValue=o,null!==s)if(on(s.value,o)){if(s.children===r.children&&!Tr.current){t=Ho(e,t,i);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===s.tag){(c=Na(-1,i&-i)).tag=2;var h=s.updateQueue;if(null!==h){var d=(h=h.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),h.pending=c}}s.lanes|=i,null!==(c=s.alternate)&&(c.lanes|=i),Pa(s.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=i,null!==(l=o.alternate)&&(l.lanes|=i),Pa(o,i,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}xo(e,t,r.children,i),t=t.child}return t;case 9:return r=t.type,n=t.pendingProps.children,Ta(t,i),n=n(r=Da(r)),t.flags|=1,xo(e,t,n,i),t.child;case 14:return r=to(n=t.type,t.pendingProps),_o(e,t,n,r=to(n.type,r),i);case 15:return So(e,t,t.type,t.pendingProps,i);case 17:return n=t.type,r=t.pendingProps,r=t.elementType===n?r:to(n,r),Go(e,t),t.tag=1,Or(n)?(e=!0,Fr(t)):e=!1,Ta(t,i),ao(t,n,r),oo(t,n,r,i),Po(null,t,n,!0,e,i);case 19:return Vo(e,t,i);case 22:return Ao(e,t,i)}throw Error(a(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Kc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Jc(){}function $c(e,t,i,n,r){var a=i._reactRootContainer;if(a){var s=a;if("function"===typeof r){var o=r;r=function(){var e=Hc(s);o.call(e)}}Gc(t,s,e,r)}else s=function(e,t,i,n,r){if(r){if("function"===typeof n){var a=n;n=function(){var e=Hc(s);a.call(e)}}var s=Vc(t,n,e,0,null,!1,0,"",Jc);return e._reactRootContainer=s,e[fr]=s.current,Vn(8===e.nodeType?e.parentNode:e),hc(),s}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof n){var o=n;n=function(){var e=Hc(l);o.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Jc);return e._reactRootContainer=l,e[fr]=l.current,Vn(8===e.nodeType?e.parentNode:e),hc((function(){Gc(t,l,i,n)})),l}(i,t,e,r,n);return Hc(s)}Qc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Gc(e,t,null,null)},Qc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Gc(null,e,null,null)})),t[fr]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=At();e={blockedOn:null,target:e,priority:t};for(var i=0;i<It.length&&0!==t&&t<It[i].priority;i++);It.splice(i,0,e),0===i&&Bt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=dt(t.pendingLanes);0!==i&&(yt(t,1|i),nc(t,Ze()),0===(6&Pl)&&(Vl=Ze()+500,Vr()))}break;case 13:hc((function(){var t=ka(e,1);if(null!==t){var i=ec();ic(t,e,1,i)}})),qc(e,1)}},_t=function(e){if(13===e.tag){var t=ka(e,134217728);if(null!==t)ic(t,e,134217728,ec());qc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),i=ka(e,t);if(null!==i)ic(i,e,t,ec());qc(e,t)}},At=function(){return bt},Et=function(e,t){var i=bt;try{return bt=e,t()}finally{bt=i}},_e=function(e,t,i){switch(t){case"input":if(J(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var r=wr(n);if(!r)throw Error(a(90));X(n),J(n,r)}}}break;case"textarea":ae(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Pe=cc,Te=hc;var eh={usingClientEntryPoint:!1,Events:[br,xr,wr,Ce,Me,cc]},th={findFiberByHostInstance:yr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ih={bundleType:th.bundleType,version:th.version,rendererPackageName:th.rendererPackageName,rendererConfig:th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=We(e))?null:e.stateNode},findFiberByHostInstance:th.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var nh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nh.isDisabled&&nh.supportsFiber)try{rt=nh.inject(ih),at=nh}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eh,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Kc(t))throw Error(a(200));return function(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Kc(e))throw Error(a(299));var i=!1,n="",r=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Uc(e,1,!1,null,0,i,0,n,r),e[fr]=t.current,Vn(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=We(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,i){if(!Zc(t))throw Error(a(200));return $c(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Kc(e))throw Error(a(405));var n=null!=i&&i.hydratedSources||null,r=!1,s="",o=Xc;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(r=!0),void 0!==i.identifierPrefix&&(s=i.identifierPrefix),void 0!==i.onRecoverableError&&(o=i.onRecoverableError)),t=Vc(t,null,e,1,null!=i?i:null,r,0,s,o),e[fr]=t.current,Vn(e),n)for(e=0;e<n.length;e++)r=(r=(i=n[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,r]:t.mutableSourceEagerHydrationData.push(i,r);return new Qc(t)},t.render=function(e,t,i){if(!Zc(t))throw Error(a(200));return $c(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(a(40));return!!e._reactRootContainer&&(hc((function(){$c(null,null,e,!1,(function(){e._reactRootContainer=null,e[fr]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,n){if(!Zc(i))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return $c(e,t,i,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,i)=>{"use strict";var n=i(7950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},7950:(e,t,i)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(2730)},1153:(e,t,i)=>{"use strict";var n=i(5043),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,a={},c=null,h=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)s.call(t,n)&&!l.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:h,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},4202:(e,t)=>{"use strict";var i=Symbol.for("react.element"),n=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function y(){}function b(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var x=b.prototype=new y;x.constructor=b,m(x,v.prototype),x.isPureReactComponent=!0;var w=Array.isArray,_=Object.prototype.hasOwnProperty,S={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,n){var r,a={},s=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(s=""+t.key),t)_.call(t,r)&&!A.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:i,type:e,key:s,ref:o,props:a,_owner:S.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var M=/\/+/g;function P(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function T(e,t,r,a,s){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case n:l=!0}}if(l)return s=s(l=e),e=""===a?"."+P(l,0):a,w(s)?(r="",null!=e&&(r=e.replace(M,"$&/")+"/"),T(s,t,r,"",(function(e){return e}))):null!=s&&(C(s)&&(s=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,r+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(M,"$&/")+"/")+e)),t.push(s)),1;if(l=0,a=""===a?".":a+":",w(e))for(var c=0;c<e.length;c++){var h=a+P(o=e[c],c);l+=T(o,t,r,h,s)}else if(h=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof h)for(e=h.call(e),c=0;!(o=e.next()).done;)l+=T(o=o.value,t,r,h=a+P(o,c++),s);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function D(e,t,i){if(null==e)return e;var n=[],r=0;return T(e,n,"","",(function(e){return t.call(i,e,r++)})),n}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var O={current:null},I={transition:null},k={ReactCurrentDispatcher:O,ReactCurrentBatchConfig:I,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:D,forEach:function(e,t,i){D(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return D(e,(function(){t++})),t},toArray:function(e){return D(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=r,t.Profiler=s,t.PureComponent=b,t.StrictMode=a,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k,t.act=L,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=m({},e.props),a=e.key,s=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,o=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!A.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];r.children=l}return{$$typeof:i,type:e.type,key:a,ref:s,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:u,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=I.transition;I.transition={};try{e()}finally{I.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return O.current.useCallback(e,t)},t.useContext=function(e){return O.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return O.current.useDeferredValue(e)},t.useEffect=function(e,t){return O.current.useEffect(e,t)},t.useId=function(){return O.current.useId()},t.useImperativeHandle=function(e,t,i){return O.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return O.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return O.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return O.current.useMemo(e,t)},t.useReducer=function(e,t,i){return O.current.useReducer(e,t,i)},t.useRef=function(e){return O.current.useRef(e)},t.useState=function(e){return O.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return O.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return O.current.useTransition()},t.version="18.3.1"},5043:(e,t,i)=>{"use strict";e.exports=i(4202)},579:(e,t,i)=>{"use strict";e.exports=i(1153)},7234:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var n=i-1>>>1,r=e[n];if(!(0<a(r,t)))break e;e[n]=t,e[i]=r,i=n}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,r=e.length,s=r>>>1;n<s;){var o=2*(n+1)-1,l=e[o],c=o+1,h=e[c];if(0>a(l,i))c<r&&0>a(h,l)?(e[n]=h,e[c]=i,n=c):(e[n]=l,e[o]=i,n=o);else{if(!(c<r&&0>a(h,i)))break e;e[n]=h,e[c]=i,n=c}}}return t}function a(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],h=[],d=1,u=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=n(h);null!==t;){if(null===t.callback)r(h);else{if(!(t.startTime<=e))break;r(h),t.sortIndex=t.expirationTime,i(c,t)}t=n(h)}}function w(e){if(g=!1,x(e),!m)if(null!==n(c))m=!0,I(_);else{var t=n(h);null!==t&&k(w,t.startTime-e)}}function _(e,i){m=!1,g&&(g=!1,y(C),C=-1),f=!0;var a=p;try{for(x(i),u=n(c);null!==u&&(!(u.expirationTime>i)||e&&!T());){var s=u.callback;if("function"===typeof s){u.callback=null,p=u.priorityLevel;var o=s(u.expirationTime<=i);i=t.unstable_now(),"function"===typeof o?u.callback=o:u===n(c)&&r(c),x(i)}else r(c);u=n(c)}if(null!==u)var l=!0;else{var d=n(h);null!==d&&k(w,d.startTime-i),l=!1}return l}finally{u=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,A=!1,E=null,C=-1,M=5,P=-1;function T(){return!(t.unstable_now()-P<M)}function D(){if(null!==E){var e=t.unstable_now();P=e;var i=!0;try{i=E(!0,e)}finally{i?S():(A=!1,E=null)}}else A=!1}if("function"===typeof b)S=function(){b(D)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,O=R.port2;R.port1.onmessage=D,S=function(){O.postMessage(null)}}else S=function(){v(D,0)};function I(e){E=e,A||(A=!0,S())}function k(e,i){C=v((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,I(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,r,a){var s=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?s+a:s:a=s,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:r,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>s?(e.sortIndex=a,i(h,e),null===n(c)&&e===n(h)&&(g?(y(C),C=-1):g=!0,k(w,a-s))):(e.sortIndex=o,i(c,e),m||f||(m=!0,I(_))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},8853:(e,t,i)=>{"use strict";e.exports=i(7234)},6440:e=>{"use strict";var t=function(){};e.exports=t},7640:()=>{},5618:()=>{},7492:()=>{},1815:()=>{},6671:()=>{},2787:()=>{},1756:e=>{e.exports=function(e,t,i){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:i;throw new TypeError("Private element is not present on this object")},e.exports.__esModule=!0,e.exports.default=e.exports},7101:e=>{e.exports=function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")},e.exports.__esModule=!0,e.exports.default=e.exports},6668:(e,t,i)=>{var n=i(1756);e.exports=function(e,t){return e.get(n(e,t))},e.exports.__esModule=!0,e.exports.default=e.exports},2459:(e,t,i)=>{var n=i(7101);e.exports=function(e,t,i){n(e,t),t.set(e,i)},e.exports.__esModule=!0,e.exports.default=e.exports},7088:(e,t,i)=>{var n=i(1756);e.exports=function(e,t,i){return e.set(n(e,t),i),i},e.exports.__esModule=!0,e.exports.default=e.exports},3312:(e,t,i)=>{var n=i(7101);e.exports=function(e,t){n(e,t),t.add(e)},e.exports.__esModule=!0,e.exports.default=e.exports},3693:(e,t,i)=>{var n=i(7736);e.exports=function(e,t,i){return(t=n(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},e.exports.__esModule=!0,e.exports.default=e.exports},9045:(e,t,i)=>{var n=i(3738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7736:(e,t,i)=>{var n=i(3738).default,r=i(9045);e.exports=function(e){var t=r(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function t(i){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(i)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},8139:(e,t)=>{var i;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e="",t=0;t<arguments.length;t++){var i=arguments[t];i&&(e=s(e,a(i)))}return e}function a(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return r.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var i in e)n.call(e,i)&&e[i]&&(t=s(t,i));return t}function s(e,t){return t?e?e+" "+t:e+t:e}e.exports?(r.default=r,e.exports=r):void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)}()}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;__webpack_require__.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"===typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"===typeof i.then)return i}var r=Object.create(null);__webpack_require__.r(r);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&n&&i;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,__webpack_require__.d(r,a),r}})(),__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,i)=>(__webpack_require__.f[i](e,t),t)),[])),__webpack_require__.u=e=>"static/js/"+e+"."+{23:"553becf0",160:"9a2e83e1",208:"5fb7cec0",293:"1c1ee6b4",453:"ace21015",516:"7b54cb79",519:"897d1653",917:"8bce74f9",946:"52eb8c8b"}[e]+".chunk.js",__webpack_require__.miniCssF=e=>{},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="portfolio:";__webpack_require__.l=(i,n,r,a)=>{if(e[i])e[i].push(n);else{var s,o;if(void 0!==r)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var h=l[c];if(h.getAttribute("src")==i||h.getAttribute("data-webpack")==t+r){s=h;break}}s||(o=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,__webpack_require__.nc&&s.setAttribute("nonce",__webpack_require__.nc),s.setAttribute("data-webpack",t+r),s.src=i),e[i]=[n];var d=(t,n)=>{s.onerror=s.onload=null,clearTimeout(u);var r=e[i];if(delete e[i],s.parentNode&&s.parentNode.removeChild(s),r&&r.forEach((e=>e(n))),t)return t(n)},u=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),o&&document.head.appendChild(s)}}})(),__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/portfolio/",(()=>{var e={792:0};__webpack_require__.f.j=(t,i)=>{var n=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise(((i,r)=>n=e[t]=[i,r]));i.push(n[2]=r);var a=__webpack_require__.p+__webpack_require__.u(t),s=new Error;__webpack_require__.l(a,(i=>{if(__webpack_require__.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;s.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",s.name="ChunkLoadError",s.type=r,s.request=a,n[1](s)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,r,a=i[0],s=i[1],o=i[2],l=0;if(a.some((t=>0!==e[t]))){for(n in s)__webpack_require__.o(s,n)&&(__webpack_require__.m[n]=s[n]);if(o)o(__webpack_require__)}for(t&&t(i);l<a.length;l++)r=a[l],__webpack_require__.o(e,r)&&e[r]&&e[r][0](),e[r]=0},i=self.webpackChunkportfolio=self.webpackChunkportfolio||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var __webpack_exports__={};(()=>{"use strict";var e,t=__webpack_require__(5043),i=__webpack_require__.t(t,2),n=__webpack_require__(4391),r=__webpack_require__(7950),a=__webpack_require__.t(r,2);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},s.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const o="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(GA){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function d(e,t,i,n){return void 0===i&&(i=null),s({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?p(t):t,{state:i,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function u(e){let{pathname:t="/",search:i="",hash:n=""}=e;return i&&"?"!==i&&(t+="?"===i.charAt(0)?i:"?"+i),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function p(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function f(t,i,n,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:c=!1}=r,p=a.history,f=e.Pop,m=null,g=v();function v(){return(p.state||{idx:null}).idx}function y(){f=e.Pop;let t=v(),i=null==t?null:t-g;g=t,m&&m({action:f,location:x.location,delta:i})}function b(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,i="string"===typeof e?e:u(e);return i=i.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+i),new URL(i,t)}null==g&&(g=0,p.replaceState(s({},p.state,{idx:g}),""));let x={get action(){return f},get location(){return t(a,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(o,y),m=e,()=>{a.removeEventListener(o,y),m=null}},createHref:e=>i(a,e),createURL:b,encodeLocation(e){let t=b(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,i){f=e.Push;let r=d(x.location,t,i);n&&n(r,t),g=v()+1;let s=h(r,g),o=x.createHref(r);try{p.pushState(s,"",o)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;a.location.assign(o)}c&&m&&m({action:f,location:x.location,delta:1})},replace:function(t,i){f=e.Replace;let r=d(x.location,t,i);n&&n(r,t),g=v();let a=h(r,g),s=x.createHref(r);p.replaceState(a,"",s),c&&m&&m({action:f,location:x.location,delta:0})},go:e=>p.go(e)};return x}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function g(e,t,i){void 0===i&&(i="/");let n=D(("string"===typeof t?p(t):t).pathname||"/",i);if(null==n)return null;let r=v(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let i=e.length===t.length&&e.slice(0,-1).every(((e,i)=>e===t[i]));return i?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(r);let a=null;for(let s=0;null==a&&s<r.length;++s){let e=T(n);a=M(r[s],e)}return a}function v(e,t,i,n){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===n&&(n="");let r=(e,r,a)=>{let s={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};s.relativePath.startsWith("/")&&(l(s.relativePath.startsWith(n),'Absolute route path "'+s.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(n.length));let o=L([n,s.relativePath]),c=i.concat(s);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),v(e.children,t,c,o)),(null!=e.path||e.index)&&t.push({path:o,score:C(o,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var i;if(""!==e.path&&null!=(i=e.path)&&i.includes("?"))for(let n of y(e.path))r(e,t,n);else r(e,t)})),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[i,...n]=t,r=i.endsWith("?"),a=i.replace(/\?$/,"");if(0===n.length)return r?[a,""]:[a];let s=y(n.join("/")),o=[];return o.push(...s.map((e=>""===e?a:[a,e].join("/")))),r&&o.push(...s),o.map((t=>e.startsWith("/")&&""===t?"/":t))}const b=/^:[\w-]+$/,x=3,w=2,_=1,S=10,A=-2,E=e=>"*"===e;function C(e,t){let i=e.split("/"),n=i.length;return i.some(E)&&(n+=A),t&&(n+=w),i.filter((e=>!E(e))).reduce(((e,t)=>e+(b.test(t)?x:""===t?_:S)),n)}function M(e,t){let{routesMeta:i}=e,n={},r="/",a=[];for(let s=0;s<i.length;++s){let e=i[s],o=s===i.length-1,l="/"===r?t:t.slice(r.length)||"/",c=P({path:e.relativePath,caseSensitive:e.caseSensitive,end:o},l);if(!c)return null;Object.assign(n,c.params);let h=e.route;a.push({params:n,pathname:L([r,c.pathname]),pathnameBase:F(L([r,c.pathnameBase])),route:h}),"/"!==c.pathnameBase&&(r=L([r,c.pathnameBase]))}return a}function P(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[i,n]=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,i)=>(n.push({paramName:t,isOptional:null!=i}),i?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(n.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let a=new RegExp(r,t?void 0:"i");return[a,n]}(e.path,e.caseSensitive,e.end),r=t.match(i);if(!r)return null;let a=r[0],s=a.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:n.reduce(((e,t,i)=>{let{paramName:n,isOptional:r}=t;if("*"===n){let e=o[i]||"";s=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[i];return e[n]=r&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:a,pathnameBase:s,pattern:e}}function T(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function D(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,n=e.charAt(i);return n&&"/"!==n?null:e.slice(i)||"/"}function R(e,t,i,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+i+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function O(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function I(e,t){let i=O(e);return t?i.map(((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)):i.map((e=>e.pathnameBase))}function k(e,t,i,n){let r;void 0===n&&(n=!1),"string"===typeof e?r=p(e):(r=s({},e),l(!r.pathname||!r.pathname.includes("?"),R("?","pathname","search",r)),l(!r.pathname||!r.pathname.includes("#"),R("#","pathname","hash",r)),l(!r.search||!r.search.includes("#"),R("#","search","hash",r)));let a,o=""===e||""===r.pathname,c=o?"/":r.pathname;if(null==c)a=i;else{let e=t.length-1;if(!n&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}a=e>=0?t[e]:"/"}let h=function(e,t){void 0===t&&(t="/");let{pathname:i,search:n="",hash:r=""}="string"===typeof e?p(e):e,a=i?i.startsWith("/")?i:function(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?i.length>1&&i.pop():"."!==e&&i.push(e)})),i.length>1?i.join("/"):"/"}(i,t):t;return{pathname:a,search:B(n),hash:N(r)}}(r,a),d=c&&"/"!==c&&c.endsWith("/"),u=(o||"."===c)&&i.endsWith("/");return h.pathname.endsWith("/")||!d&&!u||(h.pathname+="/"),h}const L=e=>e.join("/").replace(/\/\/+/g,"/"),F=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),B=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",N=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function z(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const U=["post","put","patch","delete"],j=(new Set(U),["get",...U]);new Set(j),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},V.apply(this,arguments)}const G=t.createContext(null);const H=t.createContext(null);const W=t.createContext(null);const q=t.createContext(null);const X=t.createContext({outlet:null,matches:[],isDataRoute:!1});const Y=t.createContext(null);function Q(){return null!=t.useContext(q)}function K(){return Q()||l(!1),t.useContext(q).location}function Z(e){t.useContext(W).static||t.useLayoutEffect(e)}function J(){let{isDataRoute:e}=t.useContext(X);return e?function(){let{router:e}=le(se.UseNavigateStable),i=he(oe.UseNavigateStable),n=t.useRef(!1);Z((()=>{n.current=!0}));let r=t.useCallback((function(t,r){void 0===r&&(r={}),n.current&&("number"===typeof t?e.navigate(t):e.navigate(t,V({fromRouteId:i},r)))}),[e,i]);return r}():function(){Q()||l(!1);let e=t.useContext(G),{basename:i,future:n,navigator:r}=t.useContext(W),{matches:a}=t.useContext(X),{pathname:s}=K(),o=JSON.stringify(I(a,n.v7_relativeSplatPath)),c=t.useRef(!1);Z((()=>{c.current=!0}));let h=t.useCallback((function(t,n){if(void 0===n&&(n={}),!c.current)return;if("number"===typeof t)return void r.go(t);let a=k(t,JSON.parse(o),s,"path"===n.relative);null==e&&"/"!==i&&(a.pathname="/"===a.pathname?i:L([i,a.pathname])),(n.replace?r.replace:r.push)(a,n.state,n)}),[i,r,o,s,e]);return h}()}function $(e,i){let{relative:n}=void 0===i?{}:i,{future:r}=t.useContext(W),{matches:a}=t.useContext(X),{pathname:s}=K(),o=JSON.stringify(I(a,r.v7_relativeSplatPath));return t.useMemo((()=>k(e,JSON.parse(o),s,"path"===n)),[e,o,s,n])}function ee(i,n,r,a){Q()||l(!1);let{navigator:s}=t.useContext(W),{matches:o}=t.useContext(X),c=o[o.length-1],h=c?c.params:{},d=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let u,f=K();if(n){var m;let e="string"===typeof n?p(n):n;"/"===d||(null==(m=e.pathname)?void 0:m.startsWith(d))||l(!1),u=e}else u=f;let v=u.pathname||"/",y=v;if("/"!==d){let e=d.replace(/^\//,"").split("/");y="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=g(i,{pathname:y});let x=ae(b&&b.map((e=>Object.assign({},e,{params:Object.assign({},h,e.params),pathname:L([d,s.encodeLocation?s.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:L([d,s.encodeLocation?s.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),o,r,a);return n&&x?t.createElement(q.Provider,{value:{location:V({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:e.Pop}},x):x}function te(){let e=function(){var e;let i=t.useContext(Y),n=ce(oe.UseRouteError),r=he(oe.UseRouteError);if(void 0!==i)return i;return null==(e=n.errors)?void 0:e[r]}(),i=z(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},i),n?t.createElement("pre",{style:a},n):null,null)}const ie=t.createElement(te,null);class ne extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(X.Provider,{value:this.props.routeContext},t.createElement(Y.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function re(e){let{routeContext:i,match:n,children:r}=e,a=t.useContext(G);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),t.createElement(X.Provider,{value:i},r)}function ae(e,i,n,r){var a;if(void 0===i&&(i=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var s;if(null==(s=n)||!s.errors)return null;e=n.matches}let o=e,c=null==(a=n)?void 0:a.errors;if(null!=c){let e=o.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||l(!1),o=o.slice(0,Math.min(o.length,e+1))}let h=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=t),e.route.id){let{loaderData:t,errors:i}=n,r=e.route.loader&&void 0===t[e.route.id]&&(!i||void 0===i[e.route.id]);if(e.route.lazy||r){h=!0,o=d>=0?o.slice(0,d+1):[o[0]];break}}}return o.reduceRight(((e,r,a)=>{let s,l=!1,u=null,p=null;var f;n&&(s=c&&r.route.id?c[r.route.id]:void 0,u=r.route.errorElement||ie,h&&(d<0&&0===a?(f="route-fallback",!1||de[f]||(de[f]=!0),l=!0,p=null):d===a&&(l=!0,p=r.route.hydrateFallbackElement||null)));let m=i.concat(o.slice(0,a+1)),g=()=>{let i;return i=s?u:l?p:r.route.Component?t.createElement(r.route.Component,null):r.route.element?r.route.element:e,t.createElement(re,{match:r,routeContext:{outlet:e,matches:m,isDataRoute:null!=n},children:i})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===a)?t.createElement(ne,{location:n.location,revalidation:n.revalidation,component:u,error:s,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var se=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(se||{}),oe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(oe||{});function le(e){let i=t.useContext(G);return i||l(!1),i}function ce(e){let i=t.useContext(H);return i||l(!1),i}function he(e){let i=function(e){let i=t.useContext(X);return i||l(!1),i}(),n=i.matches[i.matches.length-1];return n.route.id||l(!1),n.route.id}const de={};i.startTransition;function ue(e){l(!1)}function pe(i){let{basename:n="/",children:r=null,location:a,navigationType:s=e.Pop,navigator:o,static:c=!1,future:h}=i;Q()&&l(!1);let d=n.replace(/^\/*/,"/"),u=t.useMemo((()=>({basename:d,navigator:o,static:c,future:V({v7_relativeSplatPath:!1},h)})),[d,h,o,c]);"string"===typeof a&&(a=p(a));let{pathname:f="/",search:m="",hash:g="",state:v=null,key:y="default"}=a,b=t.useMemo((()=>{let e=D(f,d);return null==e?null:{location:{pathname:e,search:m,hash:g,state:v,key:y},navigationType:s}}),[d,f,m,g,v,y,s]);return null==b?null:t.createElement(W.Provider,{value:u},t.createElement(q.Provider,{children:r,value:b}))}function fe(e){let{children:t,location:i}=e;return ee(me(t),i)}new Promise((()=>{}));t.Component;function me(e,i){void 0===i&&(i=[]);let n=[];return t.Children.forEach(e,((e,r)=>{if(!t.isValidElement(e))return;let a=[...i,r];if(e.type===t.Fragment)return void n.push.apply(n,me(e.props.children,a));e.type!==ue&&l(!1),e.props.index&&e.props.children&&l(!1);let s={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=me(e.props.children,a)),n.push(s)})),n}function ge(){return ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ge.apply(this,arguments)}function ve(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const ye=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(GA){}new Map;const be=i.startTransition;a.flushSync,i.useId;function xe(e){let{basename:i,children:n,future:r,window:a}=e,s=t.useRef();null==s.current&&(s.current=function(e){return void 0===e&&(e={}),f((function(e,t){let{pathname:i,search:n,hash:r}=e.location;return d("",{pathname:i,search:n,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:u(t)}),null,e)}({window:a,v5Compat:!0}));let o=s.current,[l,c]=t.useState({action:o.action,location:o.location}),{v7_startTransition:h}=r||{},p=t.useCallback((e=>{h&&be?be((()=>c(e))):c(e)}),[c,h]);return t.useLayoutEffect((()=>o.listen(p)),[o,p]),t.createElement(pe,{basename:i,children:n,location:l.location,navigationType:l.action,navigator:o,future:r})}const we="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,_e=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Se=t.forwardRef((function(e,i){let n,{onClick:r,relative:a,reloadDocument:s,replace:o,state:c,target:h,to:d,preventScrollReset:p,unstable_viewTransition:f}=e,m=ve(e,ye),{basename:g}=t.useContext(W),v=!1;if("string"===typeof d&&_e.test(d)&&(n=d,we))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),i=D(t.pathname,g);t.origin===e.origin&&null!=i?d=i+t.search+t.hash:v=!0}catch(GA){}let y=function(e,i){let{relative:n}=void 0===i?{}:i;Q()||l(!1);let{basename:r,navigator:a}=t.useContext(W),{hash:s,pathname:o,search:c}=$(e,{relative:n}),h=o;return"/"!==r&&(h="/"===o?r:L([r,o])),a.createHref({pathname:h,search:c,hash:s})}(d,{relative:a}),b=function(e,i){let{target:n,replace:r,state:a,preventScrollReset:s,relative:o,unstable_viewTransition:l}=void 0===i?{}:i,c=J(),h=K(),d=$(e,{relative:o});return t.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let i=void 0!==r?r:u(h)===u(d);c(e,{replace:i,state:a,preventScrollReset:s,relative:o,unstable_viewTransition:l})}}),[h,c,d,r,a,n,e,s,o,l])}(d,{replace:o,state:c,target:h,preventScrollReset:p,relative:a,unstable_viewTransition:f});return t.createElement("a",ge({},m,{href:n||y,onClick:v||s?r:function(e){r&&r(e),e.defaultPrevented||b(e)},ref:i,target:h}))}));var Ae,Ee;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ae||(Ae={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ee||(Ee={}));var Ce=__webpack_require__(8139),Me=__webpack_require__.n(Ce),Pe=__webpack_require__(579);const Te=["xxl","xl","lg","md","sm","xs"],De="xs",Re=t.createContext({prefixes:{},breakpoints:Te,minBreakpoint:De}),{Consumer:Oe,Provider:Ie}=Re;function ke(e,i){const{prefixes:n}=(0,t.useContext)(Re);return e||n[i]||i}function Le(){const{breakpoints:e}=(0,t.useContext)(Re);return e}function Fe(){const{minBreakpoint:e}=(0,t.useContext)(Re);return e}const Be=t.forwardRef(((e,t)=>{let{bsPrefix:i,fluid:n=!1,as:r="div",className:a,...s}=e;const o=ke(i,"container"),l="string"===typeof n?"-".concat(n):"-fluid";return(0,Pe.jsx)(r,{ref:t,...s,className:Me()(a,n?"".concat(o).concat(l):o)})}));Be.displayName="Container";const Ne=Be,ze=t.forwardRef(((e,t)=>{let{bsPrefix:i,className:n,as:r="div",...a}=e;const s=ke(i,"row"),o=Le(),l=Fe(),c="".concat(s,"-cols"),h=[];return o.forEach((e=>{const t=a[e];let i;delete a[e],null!=t&&"object"===typeof t?({cols:i}=t):i=t;const n=e!==l?"-".concat(e):"";null!=i&&h.push("".concat(c).concat(n,"-").concat(i))})),(0,Pe.jsx)(r,{ref:t,...a,className:Me()(n,s,...h)})}));ze.displayName="Row";const Ue=ze;const je=t.forwardRef(((e,t)=>{const[{className:i,...n},{as:r="div",bsPrefix:a,spans:s}]=function(e){let{as:t,bsPrefix:i,className:n,...r}=e;i=ke(i,"col");const a=Le(),s=Fe(),o=[],l=[];return a.forEach((e=>{const t=r[e];let n,a,c;delete r[e],"object"===typeof t&&null!=t?({span:n,offset:a,order:c}=t):n=t;const h=e!==s?"-".concat(e):"";n&&o.push(!0===n?"".concat(i).concat(h):"".concat(i).concat(h,"-").concat(n)),null!=c&&l.push("order".concat(h,"-").concat(c)),null!=a&&l.push("offset".concat(h,"-").concat(a))})),[{...r,className:Me()(n,...o,...l)},{as:t,bsPrefix:i,spans:o}]}(e);return(0,Pe.jsx)(r,{...n,ref:t,className:Me()(i,!s.length&&a)})}));je.displayName="Col";const Ve=je;function Ge(){return Ge=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},Ge.apply(this,arguments)}function He(e,t){if(null==e)return{};var i={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;i[n]=e[n]}return i}__webpack_require__(2740);function We(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function qe(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}function Xe(e,i){return Object.keys(i).reduce((function(n,r){var a,s=n,o=s[We(r)],l=s[r],c=He(s,[We(r),r].map(qe)),h=i[r],d=function(e,i,n){var r=(0,t.useRef)(void 0!==e),a=(0,t.useState)(i),s=a[0],o=a[1],l=void 0!==e,c=r.current;return r.current=l,!l&&c&&s!==i&&o(i),[l?e:s,(0,t.useCallback)((function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];n&&n.apply(void 0,[e].concat(i)),o(e)}),[n])]}(l,o,e[h]),u=d[0],p=d[1];return Ge({},c,((a={})[r]=u,a[h]=p,a))}),e)}function Ye(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!==e&&void 0!==e&&this.setState(e)}function Qe(e){this.setState(function(t){var i=this.constructor.getDerivedStateFromProps(e,t);return null!==i&&void 0!==i?i:null}.bind(this))}function Ke(e,t){try{var i=this.props,n=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(i,n)}finally{this.props=i,this.state=n}}Ye.__suppressDeprecationWarning=!0,Qe.__suppressDeprecationWarning=!0,Ke.__suppressDeprecationWarning=!0;function Ze(e){return e&&e.ownerDocument||document}function Je(e,t){return function(e){var t=Ze(e);return t&&t.defaultView||window}(e).getComputedStyle(e,t)}var $e=/([A-Z])/g;var et=/^ms-/;function tt(e){return function(e){return e.replace($e,"-$1").toLowerCase()}(e).replace(et,"-ms-")}var it=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;const nt=function(e,t){var i="",n="";if("string"===typeof t)return e.style.getPropertyValue(tt(t))||Je(e).getPropertyValue(tt(t));Object.keys(t).forEach((function(r){var a=t[r];a||0===a?!function(e){return!(!e||!it.test(e))}(r)?i+=tt(r)+": "+a+";":n+=r+"("+a+") ":e.style.removeProperty(tt(r))})),n&&(i+="transform: "+n+";"),e.style.cssText+=";"+i};function rt(e,t){return rt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rt(e,t)}const at=!1,st=t.createContext(null);var ot="unmounted",lt="exited",ct="entering",ht="entered",dt="exiting",ut=function(e){var i,n;function a(t,i){var n;n=e.call(this,t,i)||this;var r,a=i&&!i.isMounting?t.enter:t.appear;return n.appearStatus=null,t.in?a?(r=lt,n.appearStatus=ct):r=ht:r=t.unmountOnExit||t.mountOnEnter?ot:lt,n.state={status:r},n.nextCallback=null,n}n=e,(i=a).prototype=Object.create(n.prototype),i.prototype.constructor=i,rt(i,n),a.getDerivedStateFromProps=function(e,t){return e.in&&t.status===ot?{status:lt}:null};var s=a.prototype;return s.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},s.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==ct&&i!==ht&&(t=ct):i!==ct&&i!==ht||(t=dt)}this.updateStatus(!1,t)},s.componentWillUnmount=function(){this.cancelNextCallback()},s.getTimeouts=function(){var e,t,i,n=this.props.timeout;return e=t=i=n,null!=n&&"number"!==typeof n&&(e=n.exit,t=n.enter,i=void 0!==n.appear?n.appear:t),{exit:e,enter:t,appear:i}},s.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===ct){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:r.findDOMNode(this);i&&function(e){e.scrollTop}(i)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===lt&&this.setState({status:ot})},s.performEnter=function(e){var t=this,i=this.props.enter,n=this.context?this.context.isMounting:e,a=this.props.nodeRef?[n]:[r.findDOMNode(this),n],s=a[0],o=a[1],l=this.getTimeouts(),c=n?l.appear:l.enter;!e&&!i||at?this.safeSetState({status:ht},(function(){t.props.onEntered(s)})):(this.props.onEnter(s,o),this.safeSetState({status:ct},(function(){t.props.onEntering(s,o),t.onTransitionEnd(c,(function(){t.safeSetState({status:ht},(function(){t.props.onEntered(s,o)}))}))})))},s.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),n=this.props.nodeRef?void 0:r.findDOMNode(this);t&&!at?(this.props.onExit(n),this.safeSetState({status:dt},(function(){e.props.onExiting(n),e.onTransitionEnd(i.exit,(function(){e.safeSetState({status:lt},(function(){e.props.onExited(n)}))}))}))):this.safeSetState({status:lt},(function(){e.props.onExited(n)}))},s.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},s.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},s.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(n){i&&(i=!1,t.nextCallback=null,e(n))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},s.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:r.findDOMNode(this),n=null==e&&!this.props.addEndListener;if(i&&!n){if(this.props.addEndListener){var a=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],s=a[0],o=a[1];this.props.addEndListener(s,o)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},s.render=function(){var e=this.state.status;if(e===ot)return null;var i=this.props,n=i.children,r=(i.in,i.mountOnEnter,i.unmountOnExit,i.appear,i.enter,i.exit,i.timeout,i.addEndListener,i.onEnter,i.onEntering,i.onEntered,i.onExit,i.onExiting,i.onExited,i.nodeRef,He(i,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return t.createElement(st.Provider,{value:null},"function"===typeof n?n(e,r):t.cloneElement(t.Children.only(n),r))},a}(t.Component);function pt(){}ut.contextType=st,ut.propTypes={},ut.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:pt,onEntering:pt,onEntered:pt,onExit:pt,onExiting:pt,onExited:pt},ut.UNMOUNTED=ot,ut.EXITED=lt,ut.ENTERING=ct,ut.ENTERED=ht,ut.EXITING=dt;const ft=ut,mt=!("undefined"===typeof window||!window.document||!window.document.createElement);var gt=!1,vt=!1;try{var yt={get passive(){return gt=!0},get once(){return vt=gt=!0}};mt&&(window.addEventListener("test",yt,yt),window.removeEventListener("test",yt,!0))}catch(GA){}const bt=function(e,t,i,n){if(n&&"boolean"!==typeof n&&!vt){var r=n.once,a=n.capture,s=i;!vt&&r&&(s=i.__once||function e(n){this.removeEventListener(t,e,a),i.call(this,n)},i.__once=s),e.addEventListener(t,s,gt?n:a)}e.addEventListener(t,i,n)};const xt=function(e,t,i,n){var r=n&&"boolean"!==typeof n?n.capture:n;e.removeEventListener(t,i,r),i.__once&&e.removeEventListener(t,i.__once,r)};const wt=function(e,t,i,n){return bt(e,t,i,n),function(){xt(e,t,i,n)}};function _t(e,t,i){void 0===i&&(i=5);var n=!1,r=setTimeout((function(){n||function(e,t,i,n){if(void 0===i&&(i=!1),void 0===n&&(n=!0),e){var r=document.createEvent("HTMLEvents");r.initEvent(t,i,n),e.dispatchEvent(r)}}(e,"transitionend",!0)}),t+i),a=wt(e,"transitionend",(function(){n=!0}),{once:!0});return function(){clearTimeout(r),a()}}function St(e,t,i,n){null==i&&(i=function(e){var t=nt(e,"transitionDuration")||"",i=-1===t.indexOf("ms")?1e3:1;return parseFloat(t)*i}(e)||0);var r=_t(e,i,n),a=wt(e,"transitionend",t);return function(){r(),a()}}function At(e,t){const i=nt(e,t)||"",n=-1===i.indexOf("ms")?1e3:1;return parseFloat(i)*n}function Et(e,t){const i=At(e,"transitionDuration"),n=At(e,"transitionDelay"),r=St(e,(i=>{i.target===e&&(r(),t(i))}),i+n)}const Ct=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t.filter((e=>null!=e)).reduce(((e,t)=>{if("function"!==typeof t)throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return null===e?t:function(){for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];e.apply(this,n),t.apply(this,n)}}),null)};function Mt(e){e.offsetHeight}const Pt=e=>e&&"function"!==typeof e?t=>{e.current=t}:e;const Tt=function(e,i){return(0,t.useMemo)((()=>function(e,t){const i=Pt(e),n=Pt(t);return e=>{i&&i(e),n&&n(e)}}(e,i)),[e,i])};const Dt=t.forwardRef(((e,i)=>{let{onEnter:n,onEntering:a,onEntered:s,onExit:o,onExiting:l,onExited:c,addEndListener:h,children:d,childRef:u,...p}=e;const f=(0,t.useRef)(null),m=Tt(f,u),g=e=>{var t;m((t=e)&&"setState"in t?r.findDOMNode(t):null!=t?t:null)},v=e=>t=>{e&&f.current&&e(f.current,t)},y=(0,t.useCallback)(v(n),[n]),b=(0,t.useCallback)(v(a),[a]),x=(0,t.useCallback)(v(s),[s]),w=(0,t.useCallback)(v(o),[o]),_=(0,t.useCallback)(v(l),[l]),S=(0,t.useCallback)(v(c),[c]),A=(0,t.useCallback)(v(h),[h]);return(0,Pe.jsx)(ft,{ref:i,...p,onEnter:y,onEntered:x,onEntering:b,onExit:w,onExited:S,onExiting:_,addEndListener:A,nodeRef:f,children:"function"===typeof d?(e,t)=>d(e,{...t,ref:g}):t.cloneElement(d,{ref:g})})})),Rt=Dt,Ot={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function It(e,t){const i=t["offset".concat(e[0].toUpperCase()).concat(e.slice(1))],n=Ot[e];return i+parseInt(nt(t,n[0]),10)+parseInt(nt(t,n[1]),10)}const kt={[lt]:"collapse",[dt]:"collapsing",[ct]:"collapsing",[ht]:"collapse show"},Lt=t.forwardRef(((e,i)=>{let{onEnter:n,onEntering:r,onEntered:a,onExit:s,onExiting:o,className:l,children:c,dimension:h="height",in:d=!1,timeout:u=300,mountOnEnter:p=!1,unmountOnExit:f=!1,appear:m=!1,getDimensionValue:g=It,...v}=e;const y="function"===typeof h?h():h,b=(0,t.useMemo)((()=>Ct((e=>{e.style[y]="0"}),n)),[y,n]),x=(0,t.useMemo)((()=>Ct((e=>{const t="scroll".concat(y[0].toUpperCase()).concat(y.slice(1));e.style[y]="".concat(e[t],"px")}),r)),[y,r]),w=(0,t.useMemo)((()=>Ct((e=>{e.style[y]=null}),a)),[y,a]),_=(0,t.useMemo)((()=>Ct((e=>{e.style[y]="".concat(g(y,e),"px"),Mt(e)}),s)),[s,g,y]),S=(0,t.useMemo)((()=>Ct((e=>{e.style[y]=null}),o)),[y,o]);return(0,Pe.jsx)(Rt,{ref:i,addEndListener:Et,...v,"aria-expanded":v.role?d:null,onEnter:b,onEntering:x,onEntered:w,onExit:_,onExiting:S,childRef:c.ref,in:d,timeout:u,mountOnEnter:p,unmountOnExit:f,appear:m,children:(e,i)=>t.cloneElement(c,{...i,className:Me()(l,c.props.className,kt[e],"width"===y&&"collapse-horizontal")})})})),Ft=Lt;function Bt(e,t){return Array.isArray(e)?e.includes(t):e===t}const Nt=t.createContext({});Nt.displayName="AccordionContext";const zt=Nt,Ut=t.forwardRef(((e,i)=>{let{as:n="div",bsPrefix:r,className:a,children:s,eventKey:o,...l}=e;const{activeEventKey:c}=(0,t.useContext)(zt);return r=ke(r,"accordion-collapse"),(0,Pe.jsx)(Ft,{ref:i,in:Bt(c,o),...l,className:Me()(a,r),children:(0,Pe.jsx)(n,{children:t.Children.only(s)})})}));Ut.displayName="AccordionCollapse";const jt=Ut,Vt=t.createContext({eventKey:""});Vt.displayName="AccordionItemContext";const Gt=Vt,Ht=t.forwardRef(((e,i)=>{let{as:n="div",bsPrefix:r,className:a,onEnter:s,onEntering:o,onEntered:l,onExit:c,onExiting:h,onExited:d,...u}=e;r=ke(r,"accordion-body");const{eventKey:p}=(0,t.useContext)(Gt);return(0,Pe.jsx)(jt,{eventKey:p,onEnter:s,onEntering:o,onEntered:l,onExit:c,onExiting:h,onExited:d,children:(0,Pe.jsx)(n,{ref:i,...u,className:Me()(a,r)})})}));Ht.displayName="AccordionBody";const Wt=Ht;const qt=t.forwardRef(((e,i)=>{let{as:n="button",bsPrefix:r,className:a,onClick:s,...o}=e;r=ke(r,"accordion-button");const{eventKey:l}=(0,t.useContext)(Gt),c=function(e,i){const{activeEventKey:n,onSelect:r,alwaysOpen:a}=(0,t.useContext)(zt);return t=>{let s=e===n?null:e;a&&(s=Array.isArray(n)?n.includes(e)?n.filter((t=>t!==e)):[...n,e]:[e]),null==r||r(s,t),null==i||i(t)}}(l,s),{activeEventKey:h}=(0,t.useContext)(zt);return"button"===n&&(o.type="button"),(0,Pe.jsx)(n,{ref:i,onClick:c,...o,"aria-expanded":Array.isArray(h)?h.includes(l):l===h,className:Me()(a,r,!Bt(h,l)&&"collapsed")})}));qt.displayName="AccordionButton";const Xt=qt,Yt=t.forwardRef(((e,t)=>{let{as:i="h2",bsPrefix:n,className:r,children:a,onClick:s,...o}=e;return n=ke(n,"accordion-header"),(0,Pe.jsx)(i,{ref:t,...o,className:Me()(r,n),children:(0,Pe.jsx)(Xt,{onClick:s,children:a})})}));Yt.displayName="AccordionHeader";const Qt=Yt,Kt=t.forwardRef(((e,i)=>{let{as:n="div",bsPrefix:r,className:a,eventKey:s,...o}=e;r=ke(r,"accordion-item");const l=(0,t.useMemo)((()=>({eventKey:s})),[s]);return(0,Pe.jsx)(Gt.Provider,{value:l,children:(0,Pe.jsx)(n,{ref:i,...o,className:Me()(a,r)})})}));Kt.displayName="AccordionItem";const Zt=Kt,Jt=t.forwardRef(((e,i)=>{const{as:n="div",activeKey:r,bsPrefix:a,className:s,onSelect:o,flush:l,alwaysOpen:c,...h}=Xe(e,{activeKey:"onSelect"}),d=ke(a,"accordion"),u=(0,t.useMemo)((()=>({activeEventKey:r,onSelect:o,alwaysOpen:c})),[r,o,c]);return(0,Pe.jsx)(zt.Provider,{value:u,children:(0,Pe.jsx)(n,{ref:i,...h,className:Me()(s,d,l&&"".concat(d,"-flush"))})})}));Jt.displayName="Accordion";const $t=Object.assign(Jt,{Button:Xt,Collapse:jt,Item:Zt,Header:Qt,Body:Wt}),ei=["as","disabled"];function ti(e){let{tagName:t,disabled:i,href:n,target:r,rel:a,role:s,onClick:o,tabIndex:l=0,type:c}=e;t||(t=null!=n||null!=r||null!=a?"a":"button");const h={tagName:t};if("button"===t)return[{type:c||"button",disabled:i},h];const d=e=>{(i||"a"===t&&function(e){return!e||"#"===e.trim()}(n))&&e.preventDefault(),i?e.stopPropagation():null==o||o(e)};return"a"===t&&(n||(n="#"),i&&(n=void 0)),[{role:null!=s?s:"button",disabled:void 0,tabIndex:i?void 0:l,href:n,target:"a"===t?r:void 0,"aria-disabled":i||void 0,rel:"a"===t?a:void 0,onClick:d,onKeyDown:e=>{" "===e.key&&(e.preventDefault(),d(e))}},h]}const ii=t.forwardRef(((e,t)=>{let{as:i,disabled:n}=e,r=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,ei);const[a,{tagName:s}]=ti(Object.assign({tagName:i,disabled:n},r));return(0,Pe.jsx)(s,Object.assign({},r,a,{ref:t}))}));ii.displayName="Button";const ni=t.forwardRef(((e,t)=>{let{as:i,bsPrefix:n,variant:r="primary",size:a,active:s=!1,disabled:o=!1,className:l,...c}=e;const h=ke(n,"btn"),[d,{tagName:u}]=ti({tagName:i,disabled:o,...c}),p=u;return(0,Pe.jsx)(p,{...d,...c,ref:t,disabled:o,className:Me()(l,h,s&&"active",r&&"".concat(h,"-").concat(r),a&&"".concat(h,"-").concat(a),c.href&&o&&"disabled")})}));ni.displayName="Button";const ri=ni;var ai={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},si=t.createContext&&t.createContext(ai),oi=["attr","size","title"];function li(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;i[n]=e[n]}return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function ci(){return ci=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},ci.apply(this,arguments)}function hi(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function di(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?hi(Object(i),!0).forEach((function(t){ui(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):hi(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function ui(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function pi(e){return e&&e.map(((e,i)=>t.createElement(e.tag,di({key:i},e.attr),pi(e.child))))}function fi(e){return i=>t.createElement(mi,ci({attr:di({},e.attr)},i),pi(e.child))}function mi(e){var i=i=>{var n,{attr:r,size:a,title:s}=e,o=li(e,oi),l=a||i.size||"1em";return i.className&&(n=i.className),e.className&&(n=(n?n+" ":"")+e.className),t.createElement("svg",ci({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,r,o,{className:n,style:di(di({color:e.color||i.color},i.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),s&&t.createElement("title",null,s),e.children)};return void 0!==si?t.createElement(si.Consumer,null,(e=>i(e))):i(ai)}function gi(e){return fi({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M333.5,201.4c0-22.1-15.6-34.3-43-34.3h-50.4v71.2h42.5C315.4,238.2,333.5,225,333.5,201.4z M517,188.6 c-9.5-30.9-10.9-68.8-9.8-98.1c1.1-30.5-22.7-58.5-54.7-58.5H123.7c-32.1,0-55.8,28.1-54.7,58.5c1,29.3-0.3,67.2-9.8,98.1 c-9.6,31-25.7,50.6-52.2,53.1v28.5c26.4,2.5,42.6,22.1,52.2,53.1c9.5,30.9,10.9,68.8,9.8,98.1c-1.1,30.5,22.7,58.5,54.7,58.5h328.7 c32.1,0,55.8-28.1,54.7-58.5c-1-29.3,0.3-67.2,9.8-98.1c9.6-31,25.7-50.6,52.1-53.1v-28.5C542.7,239.2,526.5,219.6,517,188.6z M300.2,375.1h-97.9V136.8h97.4c43.3,0,71.7,23.4,71.7,59.4c0,25.3-19.1,47.9-43.5,51.8v1.3c33.2,3.6,55.5,26.6,55.5,58.3 C383.4,349.7,352.1,375.1,300.2,375.1z M290.2,266.4h-50.1v78.4h52.3c34.2,0,52.3-13.7,52.3-39.5 C344.7,279.6,326.1,266.4,290.2,266.4z"},child:[]}]})(e)}function vi(e){return fi({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 32l34.9 395.8L192 480l157.1-52.2L384 32H0zm313.1 80l-4.8 47.3L193 208.6l-.3.1h111.5l-12.8 146.6-98.2 28.7-98.8-29.2-6.4-73.9h48.9l3.2 38.3 52.6 13.3 54.7-15.4 3.7-61.6-166.3-.5v-.1l-.2.1-3.6-46.3L193.1 162l6.5-2.7H76.7L70.9 112h242.2z"},child:[]}]})(e)}function yi(e){return fi({tag:"svg",attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(e)}function bi(e){return fi({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 32l34.9 395.8L191.5 480l157.6-52.2L384 32H0zm308.2 127.9H124.4l4.1 49.4h175.6l-13.6 148.4-97.9 27v.3h-1.1l-98.7-27.3-6-75.8h47.7L138 320l53.5 14.5 53.7-14.5 6-62.2H84.3L71.5 112.2h241.1l-4.4 47.7z"},child:[]}]})(e)}function xi(e){return fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 32v448h448V32H0zm243.8 349.4c0 43.6-25.6 63.5-62.9 63.5-33.7 0-53.2-17.4-63.2-38.5l34.3-20.7c6.6 11.7 12.6 21.6 27.1 21.6 13.8 0 22.6-5.4 22.6-26.5V237.7h42.1v143.7zm99.6 63.5c-39.1 0-64.4-18.6-76.7-43l34.3-19.8c9 14.7 20.8 25.6 41.5 25.6 17.4 0 28.6-8.7 28.6-20.8 0-14.4-11.4-19.5-30.7-28l-10.5-4.5c-30.4-12.9-50.5-29.2-50.5-63.5 0-31.6 24.1-55.6 61.6-55.6 26.8 0 46 9.3 59.8 33.7L368 290c-7.2-12.9-15-18-27.1-18-12.3 0-20.1 7.8-20.1 18 0 12.6 7.8 17.7 25.9 25.6l10.5 4.5c35.8 15.3 55.9 31 55.9 66.2 0 37.8-29.8 58.6-69.7 58.6z"},child:[]}]})(e)}function wi(e){return fi({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"},child:[]}]})(e)}function _i(e){return fi({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M14.448 16.2394C13.8809 17.0412 13.2933 17.7714 12.7015 18.4146C14.3738 20.0375 15.9291 20.7975 16.792 20.2993C17.6549 19.8011 17.7744 18.0742 17.2051 15.8145C16.3521 16.0054 15.426 16.1492 14.448 16.2394ZM13.138 16.3265C12.7641 16.342 12.3845 16.3499 12.0003 16.3499C11.6161 16.3499 11.2365 16.342 10.8627 16.3265C11.2394 16.8188 11.6208 17.2749 12.0003 17.6905C12.3798 17.2749 12.7612 16.8188 13.138 16.3265ZM18.1787 8.43278C20.8434 9.19718 22.5837 10.4672 22.5837 11.9999C22.5837 13.5325 20.8434 14.8026 18.1787 15.567C18.8491 18.2569 18.6193 20.399 17.292 21.1653C15.9647 21.9316 13.9947 21.0595 12.0003 19.134C10.006 21.0595 8.03596 21.9316 6.70866 21.1653C5.38136 20.399 5.15158 18.2569 5.82195 15.567C3.15724 14.8026 1.41699 13.5325 1.41699 11.9999C1.41699 10.4672 3.15724 9.19718 5.82195 8.43278C5.15158 5.74288 5.38136 3.60075 6.70866 2.83443C8.03596 2.06811 10.006 2.94019 12.0003 4.86569C13.9947 2.94019 15.9647 2.06811 17.292 2.83443C18.6193 3.60075 18.8491 5.74288 18.1787 8.43278ZM17.2051 8.18527C17.7744 5.92558 17.6549 4.19865 16.792 3.70046C15.9291 3.20226 14.3738 3.96221 12.7015 5.58509C13.2933 6.2283 13.8809 6.95849 14.448 7.76031C15.426 7.85054 16.3521 7.99432 17.2051 8.18527ZM6.79554 15.8145C6.22624 18.0742 6.34577 19.8011 7.20866 20.2993C8.07155 20.7975 9.62688 20.0375 11.2992 18.4146C10.7073 17.7714 10.1197 17.0412 9.55262 16.2394C8.57467 16.1492 7.6485 16.0054 6.79554 15.8145ZM10.8627 7.67324C11.2365 7.65776 11.6161 7.64987 12.0003 7.64987C12.3845 7.64987 12.7641 7.65776 13.138 7.67324C12.7612 7.18096 12.3798 6.7248 12.0003 6.30922C11.6208 6.7248 11.2394 7.18096 10.8627 7.67324ZM9.55262 7.76031C10.1197 6.95849 10.7073 6.2283 11.2992 5.58509C9.62688 3.96221 8.07155 3.20226 7.20866 3.70046C6.34577 4.19865 6.22624 5.92558 6.79554 8.18527C7.6485 7.99432 8.57467 7.85054 9.55262 7.76031ZM13.8939 15.2797C14.2395 14.7728 14.5772 14.2366 14.9015 13.6749C15.2258 13.1131 15.5213 12.5526 15.7875 11.9999C15.5213 11.4471 15.2258 10.8866 14.9015 10.3249C14.5772 9.76311 14.2395 9.22694 13.8939 8.72005C13.2821 8.6742 12.649 8.64987 12.0003 8.64987C11.3517 8.64987 10.7185 8.6742 10.1067 8.72005C9.76112 9.22694 9.42347 9.76311 9.09914 10.3249C8.77481 10.8866 8.4793 11.4471 8.21312 11.9999C8.4793 12.5526 8.77481 13.1131 9.09914 13.6749C9.42347 14.2366 9.76112 14.7728 10.1067 15.2797C10.7185 15.3255 11.3517 15.3499 12.0003 15.3499C12.649 15.3499 13.2821 15.3255 13.8939 15.2797ZM15.1785 15.1484C15.7932 15.0683 16.3789 14.9661 16.9286 14.8452C16.7584 14.3087 16.5541 13.7504 16.3161 13.178C16.1426 13.5095 15.9596 13.8421 15.7675 14.1749C15.5754 14.5076 15.3788 14.8324 15.1785 15.1484ZM8.82218 8.85133C8.20747 8.93147 7.62174 9.03367 7.07208 9.15454C7.24223 9.691 7.44659 10.2494 7.68454 10.8218C7.85806 10.4903 8.04101 10.1576 8.23311 9.82487C8.42522 9.49212 8.62185 9.16736 8.82218 8.85133ZM7.07208 14.8452C7.62174 14.9661 8.20747 15.0683 8.82218 15.1484C8.62185 14.8324 8.42522 14.5076 8.23311 14.1749C8.04101 13.8421 7.85806 13.5095 7.68454 13.178C7.44659 13.7504 7.24223 14.3087 7.07208 14.8452ZM6.09439 14.6C6.35551 13.7659 6.69407 12.8919 7.10491 11.9999C6.69407 11.1078 6.35551 10.2339 6.09439 9.39969C3.85279 10.0365 2.41699 11.0035 2.41699 11.9999C2.41699 12.9962 3.85279 13.9632 6.09439 14.6ZM16.9286 9.15454C16.3789 9.03367 15.7932 8.93147 15.1785 8.85133C15.3788 9.16736 15.5754 9.49212 15.7675 9.82487C15.9596 10.1576 16.1426 10.4903 16.3161 10.8218C16.5541 10.2494 16.7584 9.691 16.9286 9.15454ZM17.9063 9.39969C17.6451 10.2339 17.3066 11.1078 16.8957 11.9999C17.3066 12.8919 17.6451 13.7659 17.9063 14.6C20.1479 13.9632 21.5837 12.9962 21.5837 11.9999C21.5837 11.0035 20.1479 10.0365 17.9063 9.39969ZM12.0003 13.879C10.9625 13.879 10.1212 13.0377 10.1212 11.9999C10.1212 10.962 10.9625 10.1207 12.0003 10.1207C13.0382 10.1207 13.8795 10.962 13.8795 11.9999C13.8795 13.0377 13.0382 13.879 12.0003 13.879Z"},child:[]}]})(e)}const Si=e=>{let{text:i,delay:n}=e;const[r,a]=(0,t.useState)(""),[s,o]=(0,t.useState)(0);return(0,t.useEffect)((()=>{if(s<i.length){const e=setTimeout((()=>{a((e=>e+i[s])),o((e=>e+1))}),n);return()=>clearTimeout(e)}}),[s,n,i]),(0,Pe.jsx)("span",{children:r})},Ai=__webpack_require__.p+"static/media/MIT-bus-stops-giphy.fe50b381a9532af00904.gif",Ei=__webpack_require__.p+"static/media/pacMan factory- giphy.eff71d025db174af3c0f.gif",Ci=__webpack_require__.p+"static/media/giphy-eyes.e6f19f9c432b5ec02d35.gif",Mi=__webpack_require__.p+"static/media/numberRun-giphy.fb117e31adb5b4a2dd25.gif",Pi=__webpack_require__.p+"static/media/skull.6a2c3533cffda8d38bda.png",Ti=(0,Pe.jsxs)("ul",{children:[(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Reading:"})," ",(0,Pe.jsxs)("p",{children:[" ","I'm especially drawn books by credible doctors who explore the biology and psychology of people."," "]})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Traveling:"})," ",(0,Pe.jsxs)("p",{children:["A decent hostel with wifi and I am good to go! A hotel works too, if you read that incorrectly."," "]})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Anime: "}),(0,Pe.jsx)("p",{children:"I'm no otaku, but I do know enough to know what that means."})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Concerts: "}),(0,Pe.jsx)("p",{children:" Seedy bars with rising talent is my jam. "})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Skincare: "})," ",(0,Pe.jsx)("p",{children:" I try, most days. "})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Rock climbing: "})," ",(0,Pe.jsx)("p",{children:"I'm decent because I'm terrified of heights and don't want to fall."})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Gardening: "}),(0,Pe.jsx)("p",{children:"It's really just an excuse to play in the dirt. "})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Animals: "}),(0,Pe.jsx)("p",{children:"My cat and bird can do tricks. What can your pet do? "})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Hiking: "}),(0,Pe.jsx)("p",{children:"Especially with friends!"})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Car Detailing: "}),(0,Pe.jsxs)("p",{children:["Just ",(0,Pe.jsx)("i",{children:"my"})," car."," "]})]})]}),Di=()=>{const[e,i]=(0,t.useState)(!1);(0,t.useEffect)((()=>{e&&new Promise((e=>setTimeout(e,5500))).then((()=>{i(!1)}))}),[e]);return(0,Pe.jsxs)(Ne,{id:"particle",children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("h1",{id:"typeEffect",children:(0,Pe.jsx)(Si,{text:"About Me",delay:200})}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ne,{children:[(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsx)(Ve,{sm:{span:1,offset:0}}),(0,Pe.jsxs)(Ve,{md:{span:8,offset:1},children:[(0,Pe.jsx)("p",{id:"aboutMeBlurb",children:"I love travel, jokes, food, learning, and enjoying the company of myself and others."}),(0,Pe.jsxs)("span",{children:[(0,Pe.jsx)(ri,{href:"reviews",children:"REVIEWS"})," ",(0,Pe.jsx)(ri,{href:"hire",children:"HIRE"})]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]})]}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsxs)(Ve,{lg:{offset:1},className:"about",children:[(0,Pe.jsx)("p",{children:" Get to know some of my interests!"}),(0,Pe.jsxs)("ul",{children:[(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Coffee:"})," ",(0,Pe.jsxs)("p",{children:["I better know how to make a decent cup of coffee. I worked in the industry for almost a decade."," "]})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Languages:"})," ",(0,Pe.jsxs)("p",{children:["I want to be a polygot, but I lack the confidence to speak! My approximate CEFR/ or general levels are as follows:",(0,Pe.jsxs)("ul",{children:[(0,Pe.jsx)("li",{children:"French: ~A2 (everyday topics) to ~B1 (complex ideas)."}),(0,Pe.jsx)("li",{children:"Spanish: ~A1 (basic interactions) to ~A2 (everday topics)."}),(0,Pe.jsx)("li",{children:"Japanese: ~A1 (basic interactions)."}),(0,Pe.jsx)("li",{children:"Arabic: Reading, writing, essential phrases, and grammar concepts."}),(0,Pe.jsx)("li",{children:"Portuguese: Essential phrases, simple grammar."})]})]})]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("b",{children:"Coding: "}),(0,Pe.jsx)("p",{children:"Q: What do cats and programmers have in common?"}),(0,Pe.jsxs)("p",{children:["A:"," ",(0,Pe.jsx)(ri,{variant:"primary",disabled:e,onClick:e?null:()=>i(!0),children:e?"When either one is unusually happy and excited, it is because they found a bug.":"Click to see the answer"})]})]})]}),Ti]}),(0,Pe.jsxs)(Ve,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("img",{alt:"Skull with roses",src:Pi})]})]})}),(0,Pe.jsx)(Ve,{sm:{span:1,offset:1}})]}),(0,Pe.jsx)(Ue,{children:(0,Pe.jsx)(Ve,{md:{span:9,offset:1}})})]})};var Ri=__webpack_require__(3237);const Oi=__webpack_require__.p+"static/media/NadiaAyad.8acbd474f7fc58d66e5c.pdf",Ii=()=>(0,Pe.jsxs)(Ne,{children:[(0,Pe.jsx)("h1",{id:"typeEffect",children:(0,Pe.jsx)(Si,{text:"Hire Me",delay:100})}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(Ri.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js",children:(0,Pe.jsx)(Ri.Viewer,{fileUrl:Oi})}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(ri,{href:Oi,download:"Nadia_Ayad",children:"Download"})," ",(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]});const ki=__webpack_require__.p+"static/media/bright-yellowstar-svgrepo-com.0ecef33edacdd7f8072667d84e578b94.svg",Li=e=>{let{review:t}=e;return(0,Pe.jsxs)(Ne,{className:"review-details-test",children:[(0,Pe.jsx)(Ue,{children:(0,Pe.jsx)("h2",{children:t.title})}),(0,Pe.jsx)(Ue,{children:(0,Pe.jsx)("p",{children:t.body})})]})};var Fi=__webpack_require__(5173),Bi=__webpack_require__.n(Fi);const Ni={type:Bi().string,tooltip:Bi().bool,as:Bi().elementType},zi=t.forwardRef(((e,t)=>{let{as:i="div",className:n,type:r="valid",tooltip:a=!1,...s}=e;return(0,Pe.jsx)(i,{...s,ref:t,className:Me()(n,"".concat(r,"-").concat(a?"tooltip":"feedback"))})}));zi.displayName="Feedback",zi.propTypes=Ni;const Ui=zi,ji=t.createContext({}),Vi=t.forwardRef(((e,i)=>{let{id:n,bsPrefix:r,className:a,type:s="checkbox",isValid:o=!1,isInvalid:l=!1,as:c="input",...h}=e;const{controlId:d}=(0,t.useContext)(ji);return r=ke(r,"form-check-input"),(0,Pe.jsx)(c,{...h,ref:i,type:s,id:n||d,className:Me()(a,r,o&&"is-valid",l&&"is-invalid")})}));Vi.displayName="FormCheckInput";const Gi=Vi,Hi=t.forwardRef(((e,i)=>{let{bsPrefix:n,className:r,htmlFor:a,...s}=e;const{controlId:o}=(0,t.useContext)(ji);return n=ke(n,"form-check-label"),(0,Pe.jsx)("label",{...s,ref:i,htmlFor:a||o,className:Me()(r,n)})}));Hi.displayName="FormCheckLabel";const Wi=Hi;const qi=t.forwardRef(((e,i)=>{let{id:n,bsPrefix:r,bsSwitchPrefix:a,inline:s=!1,reverse:o=!1,disabled:l=!1,isValid:c=!1,isInvalid:h=!1,feedbackTooltip:d=!1,feedback:u,feedbackType:p,className:f,style:m,title:g="",type:v="checkbox",label:y,children:b,as:x="input",...w}=e;r=ke(r,"form-check"),a=ke(a,"form-switch");const{controlId:_}=(0,t.useContext)(ji),S=(0,t.useMemo)((()=>({controlId:n||_})),[_,n]),A=!b&&null!=y&&!1!==y||function(e,i){return t.Children.toArray(e).some((e=>t.isValidElement(e)&&e.type===i))}(b,Wi),E=(0,Pe.jsx)(Gi,{...w,type:"switch"===v?"checkbox":v,ref:i,isValid:c,isInvalid:h,disabled:l,as:x});return(0,Pe.jsx)(ji.Provider,{value:S,children:(0,Pe.jsx)("div",{style:m,className:Me()(f,A&&r,s&&"".concat(r,"-inline"),o&&"".concat(r,"-reverse"),"switch"===v&&a),children:b||(0,Pe.jsxs)(Pe.Fragment,{children:[E,A&&(0,Pe.jsx)(Wi,{title:g,children:y}),u&&(0,Pe.jsx)(Ui,{type:p,tooltip:d,children:u})]})})})}));qi.displayName="FormCheck";const Xi=Object.assign(qi,{Input:Gi,Label:Wi});__webpack_require__(6440);const Yi=t.forwardRef(((e,i)=>{let{bsPrefix:n,type:r,size:a,htmlSize:s,id:o,className:l,isValid:c=!1,isInvalid:h=!1,plaintext:d,readOnly:u,as:p="input",...f}=e;const{controlId:m}=(0,t.useContext)(ji);return n=ke(n,"form-control"),(0,Pe.jsx)(p,{...f,type:r,size:s,ref:i,readOnly:u,id:o||m,className:Me()(l,d?"".concat(n,"-plaintext"):n,a&&"".concat(n,"-").concat(a),"color"===r&&"".concat(n,"-color"),c&&"is-valid",h&&"is-invalid")})}));Yi.displayName="FormControl";const Qi=Object.assign(Yi,{Feedback:Ui}),Ki=t.forwardRef(((e,t)=>{let{className:i,bsPrefix:n,as:r="div",...a}=e;return n=ke(n,"form-floating"),(0,Pe.jsx)(r,{ref:t,className:Me()(i,n),...a})}));Ki.displayName="FormFloating";const Zi=Ki,Ji=t.forwardRef(((e,i)=>{let{controlId:n,as:r="div",...a}=e;const s=(0,t.useMemo)((()=>({controlId:n})),[n]);return(0,Pe.jsx)(ji.Provider,{value:s,children:(0,Pe.jsx)(r,{...a,ref:i})})}));Ji.displayName="FormGroup";const $i=Ji,en=t.forwardRef(((e,i)=>{let{as:n="label",bsPrefix:r,column:a=!1,visuallyHidden:s=!1,className:o,htmlFor:l,...c}=e;const{controlId:h}=(0,t.useContext)(ji);r=ke(r,"form-label");let d="col-form-label";"string"===typeof a&&(d="".concat(d," ").concat(d,"-").concat(a));const u=Me()(o,r,s&&"visually-hidden",a&&d);return l=l||h,a?(0,Pe.jsx)(Ve,{ref:i,as:"label",className:u,htmlFor:l,...c}):(0,Pe.jsx)(n,{ref:i,className:u,htmlFor:l,...c})}));en.displayName="FormLabel";const tn=en,nn=t.forwardRef(((e,i)=>{let{bsPrefix:n,className:r,id:a,...s}=e;const{controlId:o}=(0,t.useContext)(ji);return n=ke(n,"form-range"),(0,Pe.jsx)("input",{...s,type:"range",ref:i,className:Me()(r,n),id:a||o})}));nn.displayName="FormRange";const rn=nn,an=t.forwardRef(((e,i)=>{let{bsPrefix:n,size:r,htmlSize:a,className:s,isValid:o=!1,isInvalid:l=!1,id:c,...h}=e;const{controlId:d}=(0,t.useContext)(ji);return n=ke(n,"form-select"),(0,Pe.jsx)("select",{...h,size:a,ref:i,className:Me()(s,n,r&&"".concat(n,"-").concat(r),o&&"is-valid",l&&"is-invalid"),id:c||d})}));an.displayName="FormSelect";const sn=an,on=t.forwardRef(((e,t)=>{let{bsPrefix:i,className:n,as:r="small",muted:a,...s}=e;return i=ke(i,"form-text"),(0,Pe.jsx)(r,{...s,ref:t,className:Me()(n,i,a&&"text-muted")})}));on.displayName="FormText";const ln=on,cn=t.forwardRef(((e,t)=>(0,Pe.jsx)(Xi,{...e,ref:t,type:"switch"})));cn.displayName="Switch";const hn=Object.assign(cn,{Input:Xi.Input,Label:Xi.Label}),dn=t.forwardRef(((e,t)=>{let{bsPrefix:i,className:n,children:r,controlId:a,label:s,...o}=e;return i=ke(i,"form-floating"),(0,Pe.jsxs)($i,{ref:t,className:Me()(n,i),controlId:a,...o,children:[r,(0,Pe.jsx)("label",{htmlFor:a,children:s})]})}));dn.displayName="FloatingLabel";const un=dn,pn={_ref:Bi().any,validated:Bi().bool,as:Bi().elementType},fn=t.forwardRef(((e,t)=>{let{className:i,validated:n,as:r="form",...a}=e;return(0,Pe.jsx)(r,{...a,ref:t,className:Me()(i,n&&"was-validated")})}));fn.displayName="Form",fn.propTypes=pn;const mn=Object.assign(fn,{Group:$i,Control:Qi,Floating:Zi,Check:Xi,Switch:hn,Label:tn,Text:ln,Range:rn,Select:sn,FloatingLabel:un}),gn=()=>{const[e,i]=(0,t.useState)(""),[n,r]=(0,t.useState)(),[a,s]=(0,t.useState)(),[o,l]=(0,t.useState)(null);return(0,Pe.jsxs)(Ne,{className:"create-review",children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("h2",{children:" Create a review! "}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(mn,{onSubmit:async t=>{t.preventDefault();const c={title:e,author:n,body:a},h=await fetch("/api/reviews/",{method:"POST",body:JSON.stringify(c),headers:{"Content-Type":"application/json"}}),d=await h.json();h.ok||(l(d.error),console.log(o)),h.ok&&(l(null),console.log("Review was added!",d),i(""),r(""),s(""))},children:[(0,Pe.jsx)(mn.Label,{children:(0,Pe.jsx)("h3",{children:"Title:"})}),(0,Pe.jsx)(mn.Control,{required:!0,type:"text",name:"title",value:e,onChange:e=>i(e.target.value),placeholder:"Required."}),(0,Pe.jsx)(mn.Control.Feedback,{type:"invalid",children:"Required."}),(0,Pe.jsx)(mn.Label,{children:(0,Pe.jsx)("h3",{children:"Author:"})}),(0,Pe.jsx)(mn.Control,{required:!0,type:"text",name:"author",value:n,onChange:e=>r(e.target.value),placeholder:"Required. Your name will not be displayed, but please let me know who you are!"}),(0,Pe.jsx)(mn.Control.Feedback,{type:"invalid",children:"Required."}),(0,Pe.jsxs)(mn.Group,{className:"mb-3",controlId:"body",children:[(0,Pe.jsx)(mn.Label,{children:(0,Pe.jsx)("h3",{children:"Review:"})}),(0,Pe.jsx)(mn.Control,{required:!0,type:"text",name:"body",value:a,onChange:e=>s(e.target.value),as:"textarea",rows:5,placeholder:"What do you have to say?"}),(0,Pe.jsx)(mn.Control.Feedback,{type:"invalid",children:"Required."})]}),(0,Pe.jsx)(ri,{onClick:()=>{setTimeout((function(){window.location.reload()}),3e3)},variant:"outline-primary",type:"submit",children:"Submit"}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]}),(0,Pe.jsx)("small",{children:(0,Pe.jsx)("b",{children:"*Inappropriate comments will be removed."})}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]}),o&&(0,Pe.jsxs)("div",{className:"error",children:[" ",o]})]})},vn=()=>{const[e,i]=(0,t.useState)([]);return(0,t.useEffect)((()=>{(async()=>{const e=await fetch("/api/reviews/"),t=await e.json();e.ok&&i(t),e.ok||console.error()})()}),[]),(0,Pe.jsxs)(Ne,{children:[(0,Pe.jsx)("h1",{id:"typeEffect",children:(0,Pe.jsx)(Si,{text:"Reviews",delay:100})}),(0,Pe.jsx)("img",{src:ki,alt:"star",style:{height:55,width:55}}),(0,Pe.jsx)("img",{src:ki,alt:"star",style:{height:55,width:55}}),(0,Pe.jsx)("img",{src:ki,alt:"star",style:{height:55,width:55}}),(0,Pe.jsx)("img",{src:ki,alt:"star",style:{height:55,width:55}}),(0,Pe.jsx)("img",{src:ki,alt:"star",style:{height:55,width:55}}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(Ne,{className:"review-list-test",children:e&&e.map((e=>(0,Pe.jsx)(Ne,{className:"view-review",children:(0,Pe.jsx)(Li,{review:e})},e._id)))}),(0,Pe.jsx)(gn,{})]})},yn=e=>{const[i,n]=(0,t.useState)([{}]),[r,a]=(0,t.useState)(!0),[s,o]=(0,t.useState)(null);return(0,t.useEffect)((()=>{const t=new AbortController;return fetch(e,{signal:t.signal}).then((e=>{if(!e.ok)throw Error("fetch failed");return e.json()})).then((e=>{n(e),a(!1),o(null)})).catch((e=>{"Abort.Error"===e.name?console.log("fetch aborted"):(a(!1),o(e.message))})),()=>t.abort()}),[e]),{data:i,pending:r,error:s}};function bn(){const{data:e}=yn("https://api.github.com/users/knayad/repos?sort=created&direction=desc&page=1&per_page=6");return(0,Pe.jsxs)(Ne,{className:"projects",children:[(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsxs)("h2",{children:["This uses GitHub's API to pull some recently created repositories."," "]})," "]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("h3",{children:(0,Pe.jsx)("b",{children:"Project Name"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("h3",{children:(0,Pe.jsx)("b",{children:"Main Language"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("h3",{children:(0,Pe.jsx)("b",{children:"Description"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("h3",{children:(0,Pe.jsx)("b",{children:"Link"})})})]}),(0,Pe.jsx)("br",{}),e.map((e=>(0,Pe.jsxs)(Ue,{className:"project-row",children:[(0,Pe.jsx)(Ve,{children:e.name}),(0,Pe.jsx)(Ve,{children:e.language}),(0,Pe.jsx)(Ve,{children:e.description}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:e.html_url,onClick:window.open(),children:e.name})}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]},e.name))),(0,Pe.jsx)("br",{})]})}const xn=()=>(0,Pe.jsxs)(Ne,{children:[(0,Pe.jsx)("h1",{id:"typeEffect",children:(0,Pe.jsx)(Si,{text:"Repositories",delay:150})}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(bn,{})]});const wn=function(){return(0,Pe.jsxs)($t,{defaultActiveKey:"0",flush:!0,children:[(0,Pe.jsxs)($t.Item,{eventKey:"0",children:[(0,Pe.jsx)($t.Header,{children:(0,Pe.jsx)("h1",{className:"homeH1",children:(0,Pe.jsx)(Si,{text:"SKILLS & TOOLS",delay:150})})}),(0,Pe.jsxs)($t.Body,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{className:"skillIconG2P",children:[(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/javascript",children:(0,Pe.jsx)(xi,{title:"JavaScript"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/CSS",children:(0,Pe.jsx)(vi,{title:"CSS"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/HTML",children:(0,Pe.jsx)(bi,{title:"HTML"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://www.python.org/",children:(0,Pe.jsx)(wi,{title:"Python"})})})]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{className:"skillIconP2G",children:[(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://react.dev/",children:(0,Pe.jsx)(_i,{title:"React"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://getbootstrap.com/docs/5.3/getting-started/introduction/",children:(0,Pe.jsx)(gi,{title:"Bootstrap"})})}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://www.python.org/",children:(0,Pe.jsx)(yi,{title:"GitHub"})})})]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]})]}),(0,Pe.jsxs)($t.Item,{eventKey:"1",children:[(0,Pe.jsxs)($t.Header,{children:[" ",(0,Pe.jsx)("h1",{className:"homeH1",children:(0,Pe.jsx)(Si,{text:"PROJECTS",delay:150})})]}),(0,Pe.jsxs)($t.Body,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(Ve,{className:"projectGIFS",children:(0,Pe.jsx)("a",{href:"https://github.com/knayad/basicAnimationToMaps",target:"_blank",rel:"noreferrer",children:(0,Pe.jsx)("img",{src:Ai,alt:"bus route map"})})}),(0,Pe.jsx)(Ve,{children:" "}),(0,Pe.jsxs)(Ve,{children:[" ",(0,Pe.jsx)("a",{href:"https://github.com/knayad/following-eyes",target:"_blank",rel:"noreferrer",children:(0,Pe.jsx)("img",{src:Ci,alt:"eyes Giphy"})})]})]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://github.com/knayad/numberRun",target:"_blank",rel:"noreferrer",children:(0,Pe.jsx)("img",{src:Mi,alt:"number run"})})}),(0,Pe.jsx)(Ve,{children:" "}),(0,Pe.jsx)(Ve,{children:(0,Pe.jsx)("a",{href:"https://github.com/knayad/pacManFactory",target:"_blank",rel:"noreferrer",children:(0,Pe.jsx)("img",{src:Ei,alt:"pacMan"})})})]}),(0,Pe.jsx)(ri,{variant:"success",size:"sm",href:"repos",children:"MORE PROJECTS..."})]})]}),(0,Pe.jsxs)($t.Item,{eventKey:"2",children:[(0,Pe.jsxs)($t.Header,{children:[" ",(0,Pe.jsx)("h1",{className:"homeH1",children:(0,Pe.jsx)(Si,{text:"HIRE ME",delay:150})})]}),(0,Pe.jsx)($t.Body,{children:(0,Pe.jsx)(Ii,{})})]}),(0,Pe.jsxs)($t.Item,{eventKey:"3",children:[(0,Pe.jsxs)($t.Header,{children:[" ",(0,Pe.jsx)("h1",{className:"homeH1",children:(0,Pe.jsx)(Si,{text:"ABOUT ME",delay:150})})]}),(0,Pe.jsx)($t.Body,{children:(0,Pe.jsx)(Di,{})})]}),(0,Pe.jsxs)($t.Item,{eventKey:"4",children:[(0,Pe.jsxs)($t.Header,{children:[" ",(0,Pe.jsx)("h1",{className:"homeH1",children:(0,Pe.jsx)(Si,{text:"REVIEWS",delay:150})})]}),(0,Pe.jsx)($t.Body,{children:(0,Pe.jsx)(vn,{})})]}),(0,Pe.jsxs)($t.Item,{eventKey:"5",children:[(0,Pe.jsx)($t.Header,{children:(0,Pe.jsx)("h1",{className:"homeH1",children:(0,Pe.jsx)(Si,{text:"REPOSITORIES",delay:150})})}),(0,Pe.jsx)($t.Body,{children:(0,Pe.jsx)(xn,{})})]})]})};var _n;function Sn(e){if((!_n&&0!==_n||e)&&mt){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),_n=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return _n}const An=function(e){const i=(0,t.useRef)(e);return(0,t.useEffect)((()=>{i.current=e}),[e]),i};function En(e){const i=An(e);return(0,t.useCallback)((function(){return i.current&&i.current(...arguments)}),[i])}function Cn(e){const i=function(e){const i=(0,t.useRef)(e);return i.current=e,i}(e);(0,t.useEffect)((()=>()=>i.current()),[])}function Mn(e){void 0===e&&(e=Ze());try{var t=e.activeElement;return t&&t.nodeName?t:null}catch(GA){return e.body}}function Pn(e,t){return e.contains?e.contains(t):e.compareDocumentPosition?e===t||!!(16&e.compareDocumentPosition(t)):void 0}const Tn=(Dn="modal-open","".concat("data-rr-ui-").concat(Dn));var Dn;const Rn=class{constructor(){let{ownerDocument:e,handleContainerOverflow:t=!0,isRTL:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.handleContainerOverflow=t,this.isRTL=i,this.modals=[],this.ownerDocument=e}getScrollbarWidth(){return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document;const t=e.defaultView;return Math.abs(t.innerWidth-e.documentElement.clientWidth)}(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(e){}removeModalAttributes(e){}setContainerStyle(e){const t={overflow:"hidden"},i=this.isRTL?"paddingLeft":"paddingRight",n=this.getElement();e.style={overflow:n.style.overflow,[i]:n.style[i]},e.scrollBarWidth&&(t[i]="".concat(parseInt(nt(n,i)||"0",10)+e.scrollBarWidth,"px")),n.setAttribute(Tn,""),nt(n,t)}reset(){[...this.modals].forEach((e=>this.remove(e)))}removeContainerStyle(e){const t=this.getElement();t.removeAttribute(Tn),Object.assign(t.style,e.style)}add(e){let t=this.modals.indexOf(e);return-1!==t?t:(t=this.modals.length,this.modals.push(e),this.setModalAttributes(e),0!==t||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),t)}remove(e){const t=this.modals.indexOf(e);-1!==t&&(this.modals.splice(t,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(e))}isTopModal(e){return!!this.modals.length&&this.modals[this.modals.length-1]===e}},On=(0,t.createContext)(mt?window:void 0);On.Provider;function In(){return(0,t.useContext)(On)}const kn=(e,t)=>mt?null==e?(t||Ze()).body:("function"===typeof e&&(e=e()),e&&"current"in e&&(e=e.current),e&&("nodeType"in e||e.getBoundingClientRect)?e:null):null;const Ln="undefined"!==typeof __webpack_require__.g&&__webpack_require__.g.navigator&&"ReactNative"===__webpack_require__.g.navigator.product,Fn="undefined"!==typeof document||Ln?t.useLayoutEffect:t.useEffect;const Bn=function(e){let{children:i,in:n,onExited:r,mountOnEnter:a,unmountOnExit:s}=e;const o=(0,t.useRef)(null),l=(0,t.useRef)(n),c=En(r);(0,t.useEffect)((()=>{n?l.current=!0:c(o.current)}),[n,c]);const h=Tt(o,i.ref),d=(0,t.cloneElement)(i,{ref:h});return n?d:s||!l.current&&a?null:d},Nn=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function zn(e){let{onEnter:i,onEntering:n,onEntered:r,onExit:a,onExiting:s,onExited:o,addEndListener:l,children:c}=e,h=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,Nn);const d=(0,t.useRef)(null),u=Tt(d,"function"===typeof c?null:c.ref),p=e=>t=>{e&&d.current&&e(d.current,t)},f=(0,t.useCallback)(p(i),[i]),m=(0,t.useCallback)(p(n),[n]),g=(0,t.useCallback)(p(r),[r]),v=(0,t.useCallback)(p(a),[a]),y=(0,t.useCallback)(p(s),[s]),b=(0,t.useCallback)(p(o),[o]),x=(0,t.useCallback)(p(l),[l]);return Object.assign({},h,{nodeRef:d},i&&{onEnter:f},n&&{onEntering:m},r&&{onEntered:g},a&&{onExit:v},s&&{onExiting:y},o&&{onExited:b},l&&{addEndListener:x},{children:"function"===typeof c?(e,t)=>c(e,Object.assign({},t,{ref:u})):(0,t.cloneElement)(c,{ref:u})})}const Un=["component"];const jn=t.forwardRef(((e,t)=>{let{component:i}=e;const n=zn(function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,Un));return(0,Pe.jsx)(i,Object.assign({ref:t},n))})),Vn=jn;function Gn(e){let{children:i,in:n,onExited:r,onEntered:a,transition:s}=e;const[o,l]=(0,t.useState)(!n);n&&o&&l(!1);const c=function(e){let{in:i,onTransition:n}=e;const r=(0,t.useRef)(null),a=(0,t.useRef)(!0),s=En(n);return Fn((()=>{if(!r.current)return;let e=!1;return s({in:i,element:r.current,initial:a.current,isStale:()=>e}),()=>{e=!0}}),[i,s]),Fn((()=>(a.current=!1,()=>{a.current=!0})),[]),r}({in:!!n,onTransition:e=>{Promise.resolve(s(e)).then((()=>{e.isStale()||(e.in?null==a||a(e.element,e.initial):(l(!0),null==r||r(e.element)))}),(t=>{throw e.in||l(!0),t}))}}),h=Tt(c,i.ref);return o&&!n?null:(0,t.cloneElement)(i,{ref:h})}function Hn(e,t,i){return e?(0,Pe.jsx)(Vn,Object.assign({},i,{component:e})):t?(0,Pe.jsx)(Gn,Object.assign({},i,{transition:t})):(0,Pe.jsx)(Bn,Object.assign({},i))}const Wn=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];let qn;function Xn(e){const i=In(),n=e||function(e){return qn||(qn=new Rn({ownerDocument:null==e?void 0:e.document})),qn}(i),r=(0,t.useRef)({dialog:null,backdrop:null});return Object.assign(r.current,{add:()=>n.add(r.current),remove:()=>n.remove(r.current),isTopModal:()=>n.isTopModal(r.current),setDialogRef:(0,t.useCallback)((e=>{r.current.dialog=e}),[]),setBackdropRef:(0,t.useCallback)((e=>{r.current.backdrop=e}),[])})}const Yn=(0,t.forwardRef)(((e,i)=>{let{show:n=!1,role:a="dialog",className:s,style:o,children:l,backdrop:c=!0,keyboard:h=!0,onBackdropClick:d,onEscapeKeyDown:u,transition:p,runTransition:f,backdropTransition:m,runBackdropTransition:g,autoFocus:v=!0,enforceFocus:y=!0,restoreFocus:b=!0,restoreFocusOptions:x,renderDialog:w,renderBackdrop:_=(e=>(0,Pe.jsx)("div",Object.assign({},e))),manager:S,container:A,onShow:E,onHide:C=(()=>{}),onExit:M,onExited:P,onExiting:T,onEnter:D,onEntering:R,onEntered:O}=e,I=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,Wn);const k=In(),L=function(e,i){const n=In(),[r,a]=(0,t.useState)((()=>kn(e,null==n?void 0:n.document)));if(!r){const t=kn(e);t&&a(t)}return(0,t.useEffect)((()=>{i&&r&&i(r)}),[i,r]),(0,t.useEffect)((()=>{const t=kn(e);t!==r&&a(t)}),[e,r]),r}(A),F=Xn(S),B=function(){const e=(0,t.useRef)(!0),i=(0,t.useRef)((()=>e.current));return(0,t.useEffect)((()=>(e.current=!0,()=>{e.current=!1})),[]),i.current}(),N=function(e){const i=(0,t.useRef)(null);return(0,t.useEffect)((()=>{i.current=e})),i.current}(n),[z,U]=(0,t.useState)(!n),j=(0,t.useRef)(null);(0,t.useImperativeHandle)(i,(()=>F),[F]),mt&&!N&&n&&(j.current=Mn(null==k?void 0:k.document)),n&&z&&U(!1);const V=En((()=>{if(F.add(),Y.current=wt(document,"keydown",q),X.current=wt(document,"focus",(()=>setTimeout(H)),!0),E&&E(),v){var e,t;const i=Mn(null!=(e=null==(t=F.dialog)?void 0:t.ownerDocument)?e:null==k?void 0:k.document);F.dialog&&i&&!Pn(F.dialog,i)&&(j.current=i,F.dialog.focus())}})),G=En((()=>{var e;(F.remove(),null==Y.current||Y.current(),null==X.current||X.current(),b)&&(null==(e=j.current)||null==e.focus||e.focus(x),j.current=null)}));(0,t.useEffect)((()=>{n&&L&&V()}),[n,L,V]),(0,t.useEffect)((()=>{z&&G()}),[z,G]),Cn((()=>{G()}));const H=En((()=>{if(!y||!B()||!F.isTopModal())return;const e=Mn(null==k?void 0:k.document);F.dialog&&e&&!Pn(F.dialog,e)&&F.dialog.focus()})),W=En((e=>{e.target===e.currentTarget&&(null==d||d(e),!0===c&&C())})),q=En((e=>{h&&function(e){return"Escape"===e.code||27===e.keyCode}(e)&&F.isTopModal()&&(null==u||u(e),e.defaultPrevented||C())})),X=(0,t.useRef)(),Y=(0,t.useRef)();if(!L)return null;const Q=Object.assign({role:a,ref:F.setDialogRef,"aria-modal":"dialog"===a||void 0},I,{style:o,className:s,tabIndex:-1});let K=w?w(Q):(0,Pe.jsx)("div",Object.assign({},Q,{children:t.cloneElement(l,{role:"document"})}));K=Hn(p,f,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!n,onExit:M,onExiting:T,onExited:function(){U(!0),null==P||P(...arguments)},onEnter:D,onEntering:R,onEntered:O,children:K});let Z=null;return c&&(Z=_({ref:F.setBackdropRef,onClick:W}),Z=Hn(m,g,{in:!!n,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:Z})),(0,Pe.jsx)(Pe.Fragment,{children:r.createPortal((0,Pe.jsxs)(Pe.Fragment,{children:[Z,K]}),L)})}));Yn.displayName="Modal";const Qn=Object.assign(Yn,{Manager:Rn});var Kn=Function.prototype.bind.call(Function.prototype.call,[].slice);function Zn(e,t){return Kn(e.querySelectorAll(t))}function Jn(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}const $n=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",er=".sticky-top",tr=".navbar-toggler";class ir extends Rn{adjustAndStore(e,t,i){const n=t.style[e];t.dataset[e]=n,nt(t,{[e]:"".concat(parseFloat(nt(t,e))+i,"px")})}restore(e,t){const i=t.dataset[e];void 0!==i&&(delete t.dataset[e],nt(t,{[e]:i}))}setContainerStyle(e){super.setContainerStyle(e);const t=this.getElement();var i,n;if(n="modal-open",(i=t).classList?i.classList.add(n):function(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}(i,n)||("string"===typeof i.className?i.className=i.className+" "+n:i.setAttribute("class",(i.className&&i.className.baseVal||"")+" "+n)),!e.scrollBarWidth)return;const r=this.isRTL?"paddingLeft":"paddingRight",a=this.isRTL?"marginLeft":"marginRight";Zn(t,$n).forEach((t=>this.adjustAndStore(r,t,e.scrollBarWidth))),Zn(t,er).forEach((t=>this.adjustAndStore(a,t,-e.scrollBarWidth))),Zn(t,tr).forEach((t=>this.adjustAndStore(a,t,e.scrollBarWidth)))}removeContainerStyle(e){super.removeContainerStyle(e);const t=this.getElement();var i,n;n="modal-open",(i=t).classList?i.classList.remove(n):"string"===typeof i.className?i.className=Jn(i.className,n):i.setAttribute("class",Jn(i.className&&i.className.baseVal||"",n));const r=this.isRTL?"paddingLeft":"paddingRight",a=this.isRTL?"marginLeft":"marginRight";Zn(t,$n).forEach((e=>this.restore(r,e))),Zn(t,er).forEach((e=>this.restore(a,e))),Zn(t,tr).forEach((e=>this.restore(a,e)))}}let nr;const rr={[ct]:"show",[ht]:"show"},ar=t.forwardRef(((e,i)=>{let{className:n,children:r,transitionClasses:a={},onEnter:s,...o}=e;const l={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,...o},c=(0,t.useCallback)(((e,t)=>{Mt(e),null==s||s(e,t)}),[s]);return(0,Pe.jsx)(Rt,{ref:i,addEndListener:Et,...l,onEnter:c,childRef:r.ref,children:(e,i)=>t.cloneElement(r,{...i,className:Me()("fade",n,r.props.className,rr[e],a[e])})})}));ar.displayName="Fade";const sr=ar,or=t.forwardRef(((e,t)=>{let{className:i,bsPrefix:n,as:r="div",...a}=e;return n=ke(n,"modal-body"),(0,Pe.jsx)(r,{ref:t,className:Me()(i,n),...a})}));or.displayName="ModalBody";const lr=or,cr=t.createContext({onHide(){}}),hr=t.forwardRef(((e,t)=>{let{bsPrefix:i,className:n,contentClassName:r,centered:a,size:s,fullscreen:o,children:l,scrollable:c,...h}=e;i=ke(i,"modal");const d="".concat(i,"-dialog"),u="string"===typeof o?"".concat(i,"-fullscreen-").concat(o):"".concat(i,"-fullscreen");return(0,Pe.jsx)("div",{...h,ref:t,className:Me()(d,n,s&&"".concat(i,"-").concat(s),a&&"".concat(d,"-centered"),c&&"".concat(d,"-scrollable"),o&&u),children:(0,Pe.jsx)("div",{className:Me()("".concat(i,"-content"),r),children:l})})}));hr.displayName="ModalDialog";const dr=hr,ur=t.forwardRef(((e,t)=>{let{className:i,bsPrefix:n,as:r="div",...a}=e;return n=ke(n,"modal-footer"),(0,Pe.jsx)(r,{ref:t,className:Me()(i,n),...a})}));ur.displayName="ModalFooter";const pr=ur,fr={"aria-label":Bi().string,onClick:Bi().func,variant:Bi().oneOf(["white"])},mr=t.forwardRef(((e,t)=>{let{className:i,variant:n,"aria-label":r="Close",...a}=e;return(0,Pe.jsx)("button",{ref:t,type:"button",className:Me()("btn-close",n&&"btn-close-".concat(n),i),"aria-label":r,...a})}));mr.displayName="CloseButton",mr.propTypes=fr;const gr=mr,vr=t.forwardRef(((e,i)=>{let{closeLabel:n="Close",closeVariant:r,closeButton:a=!1,onHide:s,children:o,...l}=e;const c=(0,t.useContext)(cr),h=En((()=>{null==c||c.onHide(),null==s||s()}));return(0,Pe.jsxs)("div",{ref:i,...l,children:[o,a&&(0,Pe.jsx)(gr,{"aria-label":n,variant:r,onClick:h})]})})),yr=vr,br=t.forwardRef(((e,t)=>{let{bsPrefix:i,className:n,closeLabel:r="Close",closeButton:a=!1,...s}=e;return i=ke(i,"modal-header"),(0,Pe.jsx)(yr,{ref:t,...s,className:Me()(n,i),closeLabel:r,closeButton:a})}));br.displayName="ModalHeader";const xr=br,wr=(_r="h4",t.forwardRef(((e,t)=>(0,Pe.jsx)("div",{...e,ref:t,className:Me()(e.className,_r)}))));var _r;const Sr=t.forwardRef(((e,t)=>{let{className:i,bsPrefix:n,as:r=wr,...a}=e;return n=ke(n,"modal-title"),(0,Pe.jsx)(r,{ref:t,className:Me()(i,n),...a})}));Sr.displayName="ModalTitle";const Ar=Sr;function Er(e){return(0,Pe.jsx)(sr,{...e,timeout:null})}function Cr(e){return(0,Pe.jsx)(sr,{...e,timeout:null})}const Mr=t.forwardRef(((e,i)=>{let{bsPrefix:n,className:r,style:a,dialogClassName:s,contentClassName:o,children:l,dialogAs:c=dr,"data-bs-theme":h,"aria-labelledby":d,"aria-describedby":u,"aria-label":p,show:f=!1,animation:m=!0,backdrop:g=!0,keyboard:v=!0,onEscapeKeyDown:y,onShow:b,onHide:x,container:w,autoFocus:_=!0,enforceFocus:S=!0,restoreFocus:A=!0,restoreFocusOptions:E,onEntered:C,onExit:M,onExiting:P,onEnter:T,onEntering:D,onExited:R,backdropClassName:O,manager:I,...k}=e;const[L,F]=(0,t.useState)({}),[B,N]=(0,t.useState)(!1),z=(0,t.useRef)(!1),U=(0,t.useRef)(!1),j=(0,t.useRef)(null),[V,G]=(0,t.useState)(null),H=Tt(i,G),W=En(x),q=function(){const{dir:e}=(0,t.useContext)(Re);return"rtl"===e}();n=ke(n,"modal");const X=(0,t.useMemo)((()=>({onHide:W})),[W]);function Y(){return I||function(e){return nr||(nr=new ir(e)),nr}({isRTL:q})}function Q(e){if(!mt)return;const t=Y().getScrollbarWidth()>0,i=e.scrollHeight>Ze(e).documentElement.clientHeight;F({paddingRight:t&&!i?Sn():void 0,paddingLeft:!t&&i?Sn():void 0})}const K=En((()=>{V&&Q(V.dialog)}));Cn((()=>{xt(window,"resize",K),null==j.current||j.current()}));const Z=()=>{z.current=!0},J=e=>{z.current&&V&&e.target===V.dialog&&(U.current=!0),z.current=!1},$=()=>{N(!0),j.current=St(V.dialog,(()=>{N(!1)}))},ee=e=>{"static"!==g?U.current||e.target!==e.currentTarget?U.current=!1:null==x||x():(e=>{e.target===e.currentTarget&&$()})(e)},te=(0,t.useCallback)((e=>(0,Pe.jsx)("div",{...e,className:Me()("".concat(n,"-backdrop"),O,!m&&"show")})),[m,O,n]),ie={...a,...L};ie.display="block";return(0,Pe.jsx)(cr.Provider,{value:X,children:(0,Pe.jsx)(Qn,{show:f,ref:H,backdrop:g,container:w,keyboard:!0,autoFocus:_,enforceFocus:S,restoreFocus:A,restoreFocusOptions:E,onEscapeKeyDown:e=>{v?null==y||y(e):(e.preventDefault(),"static"===g&&$())},onShow:b,onHide:x,onEnter:(e,t)=>{e&&Q(e),null==T||T(e,t)},onEntering:(e,t)=>{null==D||D(e,t),bt(window,"resize",K)},onEntered:C,onExit:e=>{null==j.current||j.current(),null==M||M(e)},onExiting:P,onExited:e=>{e&&(e.style.display=""),null==R||R(e),xt(window,"resize",K)},manager:Y(),transition:m?Er:void 0,backdropTransition:m?Cr:void 0,renderBackdrop:te,renderDialog:e=>(0,Pe.jsx)("div",{role:"dialog",...e,style:ie,className:Me()(r,n,B&&"".concat(n,"-static"),!m&&"show"),onClick:g?ee:void 0,onMouseUp:J,"data-bs-theme":h,"aria-label":p,"aria-labelledby":d,"aria-describedby":u,children:(0,Pe.jsx)(c,{...k,onMouseDown:Z,className:s,contentClassName:o,children:l})})})})}));Mr.displayName="Modal";const Pr=Object.assign(Mr,{Body:lr,Header:xr,Title:Ar,Footer:pr,Dialog:dr,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150});const Tr=function(){const[e,i]=(0,t.useState)(!0),n=()=>i(!1);return(0,Pe.jsxs)(Pe.Fragment,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)(ri,{variant:"primary",onClick:()=>i(!0),children:"Find out more about this site..."}),(0,Pe.jsxs)(Pr,{"aria-labelledby":"contained-modal-title-vcenter",centered:!0,show:e,onHide:n,backdrop:"static",keyboard:!1,children:[(0,Pe.jsx)(Pr.Header,{closeButton:!0,onClick:n,children:(0,Pe.jsx)(Pr.Title,{children:"Welcome!"})}),(0,Pe.jsxs)(Pr.Body,{children:[(0,Pe.jsx)("strong",{children:(0,Pe.jsx)("p",{children:" This website was made using the MERN stack."})}),(0,Pe.jsxs)("ul",{children:[(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"MongoDB:"})," is used to as the document database to pull and post reviews."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Express.js:"})," Node.js web framework."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"React.js:"})," used to build the frontend of the website using JavaScript."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Node.js:"})," JavaScript web server."]})]}),(0,Pe.jsx)("strong",{children:(0,Pe.jsx)("p",{children:" It also uses Spline, GitHub's API, and React Bootstrap."})}),(0,Pe.jsxs)("ul",{children:[(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"Spline:"})," a 3D design software that can create interactive models."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"GitHub's API: "}),"a REST API I used to pull and display repositories."]}),(0,Pe.jsxs)("li",{children:[(0,Pe.jsx)("strong",{children:"React Bootstrap:"})," a library that rebuilds Bootstrap components as true React components."]})]})]}),(0,Pe.jsx)(Pr.Footer,{children:(0,Pe.jsx)(ri,{variant:"primary",onClick:n,children:"Got it!"})})]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]})};var Dr=Object.create,Rr=Object.defineProperty,Or=Object.getOwnPropertyDescriptor,Ir=Object.getOwnPropertyNames,kr=Object.getPrototypeOf,Lr=Object.prototype.hasOwnProperty,Fr=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Br=(e,t,i)=>(i=null!=e?Dr(kr(e)):{},((e,t,i,n)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of Ir(t))!Lr.call(e,r)&&r!==i&&Rr(e,r,{get:()=>t[r],enumerable:!(n=Or(t,r))||n.enumerable});return e})(!t&&e&&e.__esModule?i:Rr(i,"default",{value:e,enumerable:!0}),e)),Nr=(e,t,i)=>(((e,t,i)=>{t in e?Rr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),zr=Fr(((e,t)=>{var i,n;i=e,n=function(){return e.importState=function(t){var i=new e;return i.importState(t),i},e;function e(){return function(e){var t=0,i=0,n=0,r=1;0==e.length&&(e=[+new Date]);var a=function(){var e=4022871197,t=function(t){t=t.toString();for(var i=0;i<t.length;i++){var n=.02519603282416938*(e+=t.charCodeAt(i));n-=e=n>>>0,e=(n*=e)>>>0,e+=4294967296*(n-=e)}return 2.3283064365386963e-10*(e>>>0)};return t.version="Mash 0.9",t}();t=a(" "),i=a(" "),n=a(" ");for(var s=0;s<e.length;s++)(t-=a(e[s]))<0&&(t+=1),(i-=a(e[s]))<0&&(i+=1),(n-=a(e[s]))<0&&(n+=1);a=null;var o=function(){var e=2091639*t+2.3283064365386963e-10*r;return t=i,i=n,n=e-(r=0|e)};return o.next=o,o.uint32=function(){return 4294967296*o()},o.fract53=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.version="Alea 0.9",o.args=e,o.exportState=function(){return[t,i,n,r]},o.importState=function(e){t=+e[0]||0,i=+e[1]||0,n=+e[2]||0,r=+e[3]||0},o}(Array.prototype.slice.call(arguments))}},"object"==typeof e?t.exports=n():"function"==typeof define&&define.amd?define(n):i.Alea=n()})),Ur=Fr(((e,t)=>{var i,n;i=e,n=function(e){e.SVD=function(e,t,i,n,r){if(t=void 0===t||t,i=void 0===i||i,r=1e-64/(n=n||Math.pow(2,-52)),!e)throw new TypeError("Matrix a is not defined");var a,s,o,l,c,h,d,u,p,f,m,g,v=e[0].length,y=e.length;if(y<v)throw new TypeError("Invalid matrix: m < n");for(var b=[],x=[],w=[],_="f"===t?y:v,S=f=d=0;S<y;S++)x[S]=new Array(_).fill(0);for(S=0;S<v;S++)w[S]=new Array(v).fill(0);var A,E=new Array(v).fill(0);for(S=0;S<y;S++)for(a=0;a<v;a++)x[S][a]=e[S][a];for(S=0;S<v;S++){for(b[S]=d,p=0,o=S+1,a=S;a<y;a++)p+=Math.pow(x[a][S],2);if(p<r)d=0;else for(u=(h=x[S][S])*(d=h<0?Math.sqrt(p):-Math.sqrt(p))-p,x[S][S]=h-d,a=o;a<v;a++){for(p=0,s=S;s<y;s++)p+=x[s][S]*x[s][a];for(h=p/u,s=S;s<y;s++)x[s][a]=x[s][a]+h*x[s][S]}for(E[S]=d,p=0,a=o;a<v;a++)p+=Math.pow(x[S][a],2);if(p<r)d=0;else{for(u=(h=x[S][S+1])*(d=h<0?Math.sqrt(p):-Math.sqrt(p))-p,x[S][S+1]=h-d,a=o;a<v;a++)b[a]=x[S][a]/u;for(a=o;a<y;a++){for(p=0,s=o;s<v;s++)p+=x[a][s]*x[S][s];for(s=o;s<v;s++)x[a][s]=x[a][s]+p*b[s]}}f<(m=Math.abs(E[S])+Math.abs(b[S]))&&(f=m)}if(i)for(S=v-1;0<=S;S--){if(0!==d){for(u=x[S][S+1]*d,a=o;a<v;a++)w[a][S]=x[S][a]/u;for(a=o;a<v;a++){for(p=0,s=o;s<v;s++)p+=x[S][s]*w[s][a];for(s=o;s<v;s++)w[s][a]=w[s][a]+p*w[s][S]}}for(a=o;a<v;a++)w[S][a]=0,w[a][S]=0;w[S][S]=1,d=b[S],o=S}if(t){if("f"===t)for(S=v;S<y;S++){for(a=v;a<y;a++)x[S][a]=0;x[S][S]=1}for(S=v-1;0<=S;S--){for(o=S+1,d=E[S],a=o;a<_;a++)x[S][a]=0;if(0!==d){for(u=x[S][S]*d,a=o;a<_;a++){for(p=0,s=o;s<y;s++)p+=x[s][S]*x[s][a];for(h=p/u,s=S;s<y;s++)x[s][a]=x[s][a]+h*x[s][S]}for(a=S;a<y;a++)x[a][S]=x[a][S]/d}else for(a=S;a<y;a++)x[a][S]=0;x[S][S]=x[S][S]+1}}for(n*=f,s=v-1;0<=s;s--)for(var C=0;C<50;C++){for(A=!1,o=s;0<=o;o--){if(Math.abs(b[o])<=n){A=!0;break}if(Math.abs(E[o-1])<=n)break}if(!A)for(c=0,l=o-(p=1),S=o;S<s+1&&(h=p*b[S],b[S]=c*b[S],!(Math.abs(h)<=n));S++)if(d=E[S],E[S]=Math.sqrt(h*h+d*d),c=d/(u=E[S]),p=-h/u,t)for(a=0;a<y;a++)m=x[a][l],g=x[a][S],x[a][l]=m*c+g*p,x[a][S]=-m*p+g*c;if(g=E[s],o===s){if(g<0&&(E[s]=-g,i))for(a=0;a<v;a++)w[a][s]=-w[a][s];break}for(f=E[o],h=(((m=E[s-1])-g)*(m+g)+((d=b[s-1])-(u=b[s]))*(d+u))/(2*u*m),d=Math.sqrt(h*h+1),h=((f-g)*(f+g)+u*(m/(h<0?h-d:h+d)-u))/f,S=o+(p=c=1);S<s+1;S++){if(d=b[S],m=E[S],u=p*d,d*=c,g=Math.sqrt(h*h+u*u),h=f*(c=h/(b[S-1]=g))+d*(p=u/g),d=-f*p+d*c,u=m*p,m*=c,i)for(a=0;a<v;a++)f=w[a][S-1],g=w[a][S],w[a][S-1]=f*c+g*p,w[a][S]=-f*p+g*c;if(g=Math.sqrt(h*h+u*u),h=(c=h/(E[S-1]=g))*d+(p=u/g)*m,f=-p*d+c*m,t)for(a=0;a<y;a++)m=x[a][S-1],g=x[a][S],x[a][S-1]=m*c+g*p,x[a][S]=-m*p+g*c}b[o]=0,b[s]=h,E[s]=f}for(S=0;S<v;S++)E[S]<n&&(E[S]=0);return{u:x,q:E,v:w}},e.VERSION="1.1.1",Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof e&&typeof t<"u"?n(e):"function"==typeof define&&define.amd?define(["exports"],n):n((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})),jr=Fr(((e,t)=>{var i,n;i=e,n=function(){var e=function(e,i){if(void 0===e&&(e=[]),void 0===i&&(i=t),this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,i=this.compare,n=t[e];e>0;){var r=e-1>>1,a=t[r];if(i(n,a)>=0)break;t[e]=a,e=r}t[e]=n},e.prototype._down=function(e){for(var t=this.data,i=this.compare,n=this.length>>1,r=t[e];e<n;){var a=1+(e<<1),s=t[a],o=a+1;if(o<this.length&&i(t[o],s)<0&&(a=o,s=t[o]),i(s,r)>=0)break;t[e]=s,e=a}t[e]=r},e},"object"==typeof e&&typeof t<"u"?t.exports=n():"function"==typeof define&&define.amd?define(n):(i=i||self).TinyQueue=n()})),Vr=Fr(((e,t)=>{var i=jr();function n(e,t,n){t=t||1;for(var s,o,l,c,h=0;h<e[0].length;h++){var d=e[0][h];(!h||d[0]<s)&&(s=d[0]),(!h||d[1]<o)&&(o=d[1]),(!h||d[0]>l)&&(l=d[0]),(!h||d[1]>c)&&(c=d[1])}var u=l-s,p=c-o,f=Math.min(u,p),m=f/2;if(0===f){var g=[s,o];return g.distance=0,g}for(var v=new i(void 0,r),y=s;y<l;y+=f)for(var b=o;b<c;b+=f)v.push(new a(y+m,b+m,m,e));var x=function(e){for(var t=0,i=0,n=0,r=e[0],s=0,o=r.length,l=o-1;s<o;l=s++){var c=r[s],h=r[l],d=c[0]*h[1]-h[0]*c[1];i+=(c[0]+h[0])*d,n+=(c[1]+h[1])*d,t+=3*d}return 0===t?new a(r[0][0],r[0][1],0,e):new a(i/t,n/t,0,e)}(e),w=new a(s+u/2,o+p/2,0,e);w.d>x.d&&(x=w);for(var _=v.length;v.length;){var S=v.pop();S.d>x.d&&(x=S,n&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,_)),!(S.max-x.d<=t)&&(m=S.h/2,v.push(new a(S.x-m,S.y-m,m,e)),v.push(new a(S.x+m,S.y-m,m,e)),v.push(new a(S.x-m,S.y+m,m,e)),v.push(new a(S.x+m,S.y+m,m,e)),_+=4)}n&&(console.log("num probes: "+_),console.log("best distance: "+x.d));var A=[x.x,x.y];return A.distance=x.d,A}function r(e,t){return t.max-e.max}function a(e,t,i,n){this.x=e,this.y=t,this.h=i,this.d=function(e,t,i){for(var n=!1,r=1/0,a=0;a<i.length;a++)for(var o=i[a],l=0,c=o.length,h=c-1;l<c;h=l++){var d=o[l],u=o[h];d[1]>t!=u[1]>t&&e<(u[0]-d[0])*(t-d[1])/(u[1]-d[1])+d[0]&&(n=!n),r=Math.min(r,s(e,t,d,u))}return 0===r?0:(n?1:-1)*Math.sqrt(r)}(e,t,n),this.max=this.d+this.h*Math.SQRT2}function s(e,t,i,n){var r=i[0],a=i[1],s=n[0]-r,o=n[1]-a;if(0!==s||0!==o){var l=((e-r)*s+(t-a)*o)/(s*s+o*o);l>1?(r=n[0],a=n[1]):l>0&&(r+=s*l,a+=o*l)}return(s=e-r)*s+(o=t-a)*o}i.default&&(i=i.default),t.exports=n,t.exports.default=n})),Gr=Fr(((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)},t.exports=e.default})),Hr=Fr(((e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()},t.exports=e.default})),Wr=Fr(((e,t)=>{function i(e,t,n,r){this.message=e,this.expected=t,this.found=n,this.location=r,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,i)}!function(e,t){function i(){this.constructor=e}i.prototype=t.prototype,e.prototype=new i}(i,Error),i.buildMessage=function(e,t){var i,n={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t,i="";for(t=0;t<e.parts.length;t++)i+=e.parts[t]instanceof Array?s(e.parts[t][0])+"-"+s(e.parts[t][1]):s(e.parts[t]);return"["+(e.inverted?"^":"")+i+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function s(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function o(e){return n[e.type](e)}return"Expected "+function(e){var t,i,n=new Array(e.length);for(t=0;t<e.length;t++)n[t]=o(e[t]);if(n.sort(),n.length>0){for(t=1,i=1;t<n.length;t++)n[t-1]!==n[t]&&(n[i]=n[t],i++);n.length=i}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+(((i=t)?'"'+a(i)+'"':"end of input")+" found.")},t.exports={SyntaxError:i,parse:function(e,t){t=void 0!==t?t:{};var n,r={},a={svg_path:ge},s=ge,o=function(e){if(!e)return[];for(var t=[],i=0;i<e.length;i++)t=t.concat.apply(t,e[i]);var n=t[0];return n&&"m"==n.code&&(delete n.relative,n.code="M"),t},l=function(e,t){return function(e,t){if(!t)return[e];for(var i=[e],n=0,r=t.length;n<r;n++)i[n+1]=t[n][1];return i}(e,t)},c=/^[Mm]/,h=de(["M","m"],!1,!1),d=function(e,t,i){var n=Ne(e,[t]);return i&&(n=n.concat(Ne("M"==e?"L":"l",i[1]))),n},u=/^[Zz]/,p=de(["Z","z"],!1,!1),f=function(){return Ne("Z")},m=/^[Ll]/,g=de(["L","l"],!1,!1),v=function(e,t){return Ne(e,t)},y=/^[Hh]/,b=de(["H","h"],!1,!1),x=function(e,t){return Ne(e,t.map((function(e){return{x:e}})))},w=/^[Vv]/,_=de(["V","v"],!1,!1),S=function(e,t){return Ne(e,t.map((function(e){return{y:e}})))},A=/^[Cc]/,E=de(["C","c"],!1,!1),C=function(e,t,i){return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,x:i.x,y:i.y}},M=/^[Ss]/,P=de(["S","s"],!1,!1),T=function(e,t){return{x2:e.x,y2:e.y,x:t.x,y:t.y}},D=/^[Qq]/,R=de(["Q","q"],!1,!1),O=function(e,t){return{x1:e.x,y1:e.y,x:t.x,y:t.y}},I=/^[Tt]/,k=de(["T","t"],!1,!1),L=/^[Aa]/,F=de(["A","a"],!1,!1),B=function(e,t,i,n,r,a){return{rx:e,ry:t,xAxisRotation:i,largeArc:n,sweep:r,x:a.x,y:a.y}},N=function(e,t){return{x:e,y:t}},z=function(e){return 1*e},U=function(e){return 1*e.join("")},j=/^[01]/,V=de(["0","1"],!1,!1),G=function(e){return"1"==e},H=function(){return""},W=",",q=he(",",!1),X=function(e){return e.join("")},Y=".",Q=he(".",!1),K=/^[eE]/,Z=de(["e","E"],!1,!1),J=/^[+\-]/,$=de(["+","-"],!1,!1),ee=/^[0-9]/,te=de([["0","9"]],!1,!1),ie=function(e){return e.join("")},ne=/^[ \t\n\r]/,re=de([" ","\t","\n","\r"],!1,!1),ae=0,se=[{line:1,column:1}],oe=0,le=[],ce=0;if("startRule"in t){if(!(t.startRule in a))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=a[t.startRule]}function he(e,t){return{type:"literal",text:e,ignoreCase:t}}function de(e,t,i){return{type:"class",parts:e,inverted:t,ignoreCase:i}}function ue(t){var i,n=se[t];if(n)return n;for(i=t-1;!se[i];)i--;for(n={line:(n=se[i]).line,column:n.column};i<t;)10===e.charCodeAt(i)?(n.line++,n.column=1):n.column++,i++;return se[t]=n,n}function pe(e,t){var i=ue(e),n=ue(t);return{start:{offset:e,line:i.line,column:i.column},end:{offset:t,line:n.line,column:n.column}}}function fe(e){ae<oe||(ae>oe&&(oe=ae,le=[]),le.push(e))}function me(e,t,n){return new i(i.buildMessage(e,t),e,t,n)}function ge(){var e,t,i,n,a;for(e=ae,t=[],i=Le();i!==r;)t.push(i),i=Le();if(t!==r)if(i=function(){var e,t,i,n,a,s;if(e=ae,t=ve(),t!==r){for(i=[],n=ae,a=[],s=Le();s!==r;)a.push(s),s=Le();for(a!==r?(s=ve())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;){for(i.push(n),n=ae,a=[],s=Le();s!==r;)a.push(s),s=Le();a!==r?(s=ve())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r)}i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}(),i===r&&(i=null),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(e,e=t=o(i)):(ae=e,e=r)}else ae=e,e=r;else ae=e,e=r;return e}function ve(){var t,i,n,a,s,o;if(t=ae,i=function(){var t,i,n,a,s,o,l;if(t=ae,c.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(h)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=Ee())!==r?(s=ae,(o=Te())===r&&(o=null),o!==r?(l=be())!==r?s=o=[o,l]:(ae=s,s=r):(ae=s,s=r),s===r&&(s=null),s!==r?(t,t=i=d(i,a,s)):(ae=t,t=r)):(ae=t,t=r):(ae=t,t=r)}else ae=t,t=r;return t}(),i!==r){for(n=[],a=ae,s=[],o=Le();o!==r;)s.push(o),o=Le();for(s!==r?(o=ye())!==r?a=s=[s,o]:(ae=a,a=r):(ae=a,a=r);a!==r;){for(n.push(a),a=ae,s=[],o=Le();o!==r;)s.push(o),o=Le();s!==r?(o=ye())!==r?a=s=[s,o]:(ae=a,a=r):(ae=a,a=r)}n!==r?(t,t=i=l(i,n)):(ae=t,t=r)}else ae=t,t=r;return t}function ye(){var t;return(t=function(){var t,i;return t=ae,u.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(p)),i!==r&&(t,i=f()),t=i,t}())===r&&(t=function(){var t,i,n,a;if(t=ae,m.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(g)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=be())!==r?(t,t=i=v(i,a)):(ae=t,t=r):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,y.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(b)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=xe())!==r?(t,t=i=x(i,a)):(ae=t,t=r):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,w.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(_)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=xe())!==r?(t,t=i=S(i,a)):(ae=t,t=r):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,A.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(E)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=function(){var e,t,i,n,a,s;if(e=ae,t=we(),t!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=we())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=we())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}(),a!==r?(t,t=i=v(i,a)):(ae=t,t=r)):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,M.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(P)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=function(){var e,t,i,n,a,s;if(e=ae,t=_e(),t!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=_e())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=_e())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}(),a!==r?(t,t=i=v(i,a)):(ae=t,t=r)):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,D.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(R)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=function(){var e,t,i,n,a,s;if(e=ae,t=Se(),t!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=Se())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=Se())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}(),a!==r?(t,t=i=v(i,a)):(ae=t,t=r)):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,I.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(k)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=function(){var e,t,i,n,a,s;if(e=ae,t=Ee(),t!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=Ee())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=Ee())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}(),a!==r?(t,t=i=v(i,a)):(ae=t,t=r)):(ae=t,t=r)}else ae=t,t=r;return t}(),t===r&&(t=function(){var t,i,n,a;if(t=ae,L.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(F)),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?(a=function(){var e,t,i,n,a,s;if(e=ae,t=Ae(),t!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=Ae())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=Ae())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}(),a!==r?(t,t=i=v(i,a)):(ae=t,t=r)):(ae=t,t=r)}else ae=t,t=r;return t}())))))))),t}function be(){var e,t,i,n,a,s;if(e=ae,(t=Ee())!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=Ee())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=Ee())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}function xe(){var e,t,i,n,a,s;if(e=ae,(t=Me())!==r){for(i=[],n=ae,(a=Te())===r&&(a=null),a!==r?(s=Me())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);n!==r;)i.push(n),n=ae,(a=Te())===r&&(a=null),a!==r?(s=Me())!==r?n=a=[a,s]:(ae=n,n=r):(ae=n,n=r);i!==r?(e,e=t=l(t,i)):(ae=e,e=r)}else ae=e,e=r;return e}function we(){var e,t,i,n,a,s;return e=ae,(t=Ee())!==r?((i=Te())===r&&(i=null),i!==r?(n=Ee())!==r?((a=Te())===r&&(a=null),a!==r?(s=Ee())!==r?(e,e=t=C(t,n,s)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r),e}function _e(){var e,t,i,n;return e=ae,(t=Ee())!==r?((i=Te())===r&&(i=null),i!==r?(n=Ee())!==r?(e,e=t=T(t,n)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r),e}function Se(){var e,t,i,n;return e=ae,(t=Ee())!==r?((i=Te())===r&&(i=null),i!==r?(n=Ee())!==r?(e,e=t=O(t,n)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r),e}function Ae(){var e,t,i,n,a,s,o,l,c,h,d;return e=ae,(t=Ce())!==r?((i=Te())===r&&(i=null),i!==r?(n=Ce())!==r?((a=Te())===r&&(a=null),a!==r?(s=Me())!==r?Te()!==r?(o=Pe())!==r?((l=Te())===r&&(l=null),l!==r?(c=Pe())!==r?((h=Te())===r&&(h=null),h!==r?(d=Ee())!==r?(e,e=t=B(t,n,s,o,c,d)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r):(ae=e,e=r):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r),e}function Ee(){var e,t,i,n;return e=ae,(t=Me())!==r?((i=Te())===r&&(i=null),i!==r?(n=Me())!==r?(e,e=t=N(t,n)):(ae=e,e=r):(ae=e,e=r)):(ae=e,e=r),e}function Ce(){var e,t;return e=ae,(t=Re())===r&&(t=ke()),t!==r&&(e,t=z(t)),e=t}function Me(){var e,t,i,n;return e=ae,t=ae,(i=Ie())===r&&(i=null),i!==r?(n=Re())!==r?t=i=[i,n]:(ae=t,t=r):(ae=t,t=r),t===r&&(t=ae,(i=Ie())===r&&(i=null),i!==r?(n=ke())!==r?t=i=[i,n]:(ae=t,t=r):(ae=t,t=r)),t!==r&&(e,t=U(t)),e=t}function Pe(){var t,i;return t=ae,j.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(V)),i!==r&&(t,i=G(i)),t=i}function Te(){var e,t,i,n,a;if(e=ae,t=[],(i=Le())!==r)for(;i!==r;)t.push(i),i=Le();else t=r;if(t!==r)if((i=De())===r&&(i=null),i!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?e=t=[t,i,n]:(ae=e,e=r)}else ae=e,e=r;else ae=e,e=r;if(e===r){if(e=ae,t=ae,(i=De())!==r){for(n=[],a=Le();a!==r;)n.push(a),a=Le();n!==r?t=i=[i,n]:(ae=t,t=r)}else ae=t,t=r;t!==r&&(e,t=H()),e=t}return e}function De(){var t;return 44===e.charCodeAt(ae)?(t=W,ae++):(t=r,0===ce&&fe(q)),t}function Re(){var t,i,n,a;return t=ae,i=ae,n=function(){var t,i,n,a,s;return t=ae,i=ae,n=ke(),n===r&&(n=null),n!==r?(46===e.charCodeAt(ae)?(a=Y,ae++):(a=r,0===ce&&fe(Q)),a!==r&&(s=ke())!==r?(n=[n,a,s],i=n):(ae=i,i=r)):(ae=i,i=r),i===r&&(i=ae,n=ke(),n!==r?(46===e.charCodeAt(ae)?(a=Y,ae++):(a=r,0===ce&&fe(Q)),a!==r?(n=[n,a],i=n):(ae=i,i=r)):(ae=i,i=r)),i!==r&&(t,i=X(i)),t=i,t}(),n!==r?((a=Oe())===r&&(a=null),a!==r?i=n=[n,a]:(ae=i,i=r)):(ae=i,i=r),i===r&&(i=ae,(n=ke())!==r?(a=Oe())!==r?i=n=[n,a]:(ae=i,i=r):(ae=i,i=r)),i!==r&&(t,i=X(i)),t=i}function Oe(){var t,i,n,a,s;return t=ae,i=ae,K.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=r,0===ce&&fe(Z)),n!==r?((a=Ie())===r&&(a=null),a!==r?(s=ke())!==r?i=n=[n,a,s]:(ae=i,i=r):(ae=i,i=r)):(ae=i,i=r),i!==r&&(t,i=X(i)),t=i}function Ie(){var t;return J.test(e.charAt(ae))?(t=e.charAt(ae),ae++):(t=r,0===ce&&fe($)),t}function ke(){var t,i,n;if(t=ae,i=[],ee.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=r,0===ce&&fe(te)),n!==r)for(;n!==r;)i.push(n),ee.test(e.charAt(ae))?(n=e.charAt(ae),ae++):(n=r,0===ce&&fe(te));else i=r;return i!==r&&(t,i=ie(i)),t=i}function Le(){var t,i;return t=ae,ne.test(e.charAt(ae))?(i=e.charAt(ae),ae++):(i=r,0===ce&&fe(re)),i!==r&&(t,i=H()),t=i}var Fe={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Be in Fe)Fe[Be.toUpperCase()]=Fe[Be];function Ne(e,t){t||(t=[{}]);for(var i=t.length;i--;){var n={code:e,command:Fe[e]};for(var r in e==e.toLowerCase()&&(n.relative=!0),t[i])n[r]=t[i][r];t[i]=n}return t}if((n=s())!==r&&ae===e.length)return n;throw n!==r&&ae<e.length&&fe({type:"end"}),me(le,oe<e.length?e.charAt(oe):null,oe<e.length?pe(oe,oe+1):pe(oe,oe))}}})),qr=Fr(((e,t)=>{var i=Wr().parse;i.parseSVG=i,i.makeAbsolute=function(e){var t,i={x:0,y:0},n={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return e.forEach((function(e){for(var r in"moveto"===e.command&&(t=e),e.x0=i.x,e.y0=i.y,n)r in e&&(e[r]+=e.relative?e[n[r]]:0);"x"in e||(e.x=i.x),"y"in e||(e.y=i.y),e.relative=!1,e.code=e.code.toUpperCase(),"closepath"==e.command&&(e.x=t.x,e.y=t.y),i=e})),e},t.exports=i})),Xr=Fr(((e,t)=>{t.exports=function(e,t){for(var i=e.split("."),n=t.split("."),r=0;r<3;r++){var a=Number(i[r]),s=Number(n[r]);if(a>s)return 1;if(s>a)return-1;if(!isNaN(a)&&isNaN(s))return 1;if(isNaN(a)&&!isNaN(s))return-1}return 0}})),Yr="149",Qr=0,Kr=1,Zr=2,Jr=3,$r=0,ea=1,ta=2,ia=1,na=2,ra=3,aa=0,sa=1,oa=2,la=0,ca=1,ha=2,da=3,ua=4,pa=5,fa=100,ma=101,ga=102,va=103,ya=104,ba=200,xa=201,wa=202,_a=203,Sa=204,Aa=205,Ea=206,Ca=207,Ma=208,Pa=209,Ta=210,Da=0,Ra=1,Oa=2,Ia=3,ka=4,La=5,Fa=6,Ba=7,Na=0,za=1,Ua=2,ja=0,Va=1,Ga=2,Ha=3,Wa=4,qa=5,Xa=301,Ya=302,Qa=303,Ka=304,Za=306,Ja=1e3,$a=1001,es=1002,ts=1003,is=1004,ns=1005,rs=1006,as=1007,ss=1008,os=1009,ls=1010,cs=1011,hs=1012,ds=1013,us=1014,ps=1015,fs=1016,ms=1017,gs=1018,vs=1020,ys=1021,bs=1023,xs=1024,ws=1025,_s=1026,Ss=1027,As=1028,Es=1029,Cs=1030,Ms=1031,Ps=1033,Ts=33776,Ds=33777,Rs=33778,Os=33779,Is=35840,ks=35841,Ls=35842,Fs=35843,Bs=36196,Ns=37492,zs=37496,Us=37808,js=37809,Vs=37810,Gs=37811,Hs=37812,Ws=37813,qs=37814,Xs=37815,Ys=37816,Qs=37817,Ks=37818,Zs=37819,Js=37820,$s=37821,eo=36492,to=36283,io=36284,no=36285,ro=36286,ao=2202,so=2300,oo=2301,lo=2302,co=2400,ho=2401,uo=2402,po=2500,fo=3e3,mo=3001,go=3200,vo=3201,yo=0,bo=1,xo="srgb",wo="srgb-linear",_o=7680,So=35044,Ao="300 es",Eo=1035,Co=class{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let i=this._listeners[e];if(void 0!==i){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}},Mo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Po=1234567,To=Math.PI/180,Do=180/Math.PI;function Ro(){let e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Mo[255&e]+Mo[e>>8&255]+Mo[e>>16&255]+Mo[e>>24&255]+"-"+Mo[255&t]+Mo[t>>8&255]+"-"+Mo[t>>16&15|64]+Mo[t>>24&255]+"-"+Mo[63&i|128]+Mo[i>>8&255]+"-"+Mo[i>>16&255]+Mo[i>>24&255]+Mo[255&n]+Mo[n>>8&255]+Mo[n>>16&255]+Mo[n>>24&255]).toLowerCase()}function Oo(e,t,i){return Math.max(t,Math.min(i,e))}function Io(e,t){return(e%t+t)%t}function ko(e,t,i){return(1-i)*e+i*t}function Lo(e){return 0===(e&e-1)&&0!==e}function Fo(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Bo(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function No(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function zo(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Uo=Object.freeze({__proto__:null,DEG2RAD:To,RAD2DEG:Do,ceilPowerOfTwo:Fo,clamp:Oo,damp:function(e,t,i,n){return ko(e,t,1-Math.exp(-i*n))},degToRad:function(e){return e*To},denormalize:No,euclideanModulo:Io,floorPowerOfTwo:Bo,generateUUID:Ro,inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},isPowerOfTwo:Lo,lerp:ko,mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},normalize:zo,pingpong:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Io(e,2*t)-t)},radToDeg:function(e){return e*Do},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},seededRandom:function(e){void 0!==e&&(Po=e);let t=Po+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},setQuaternionFromProperEuler:function(e,t,i,n,r){let a=Math.cos,s=Math.sin,o=a(i/2),l=s(i/2),c=a((t+n)/2),h=s((t+n)/2),d=a((t-n)/2),u=s((t-n)/2),p=a((n-t)/2),f=s((n-t)/2);switch(r){case"XYX":e.set(o*h,l*d,l*u,o*c);break;case"YZY":e.set(l*u,o*h,l*d,o*c);break;case"ZXZ":e.set(l*d,l*u,o*h,o*c);break;case"XZX":e.set(o*h,l*f,l*p,o*c);break;case"YXY":e.set(l*p,o*h,l*f,o*c);break;case"ZYZ":e.set(l*f,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}}),jo=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;jo.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let i=Math.cos(t),n=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*i-a*n+e.x,this.y=r*n+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Vo=class{constructor(){Vo.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,n,r,a,s,o,l){let c=this.elements;return c[0]=e,c[1]=n,c[2]=s,c[3]=t,c[4]=r,c[5]=o,c[6]=i,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[3],o=i[6],l=i[1],c=i[4],h=i[7],d=i[2],u=i[5],p=i[8],f=n[0],m=n[3],g=n[6],v=n[1],y=n[4],b=n[7],x=n[2],w=n[5],_=n[8];return r[0]=a*f+s*v+o*x,r[3]=a*m+s*y+o*w,r[6]=a*g+s*b+o*_,r[1]=l*f+c*v+h*x,r[4]=l*m+c*y+h*w,r[7]=l*g+c*b+h*_,r[2]=d*f+u*v+p*x,r[5]=d*m+u*y+p*w,r[8]=d*g+u*b+p*_,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-i*r*c+i*s*o+n*r*l-n*a*o}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=c*a-s*l,d=s*o-c*r,u=l*r-a*o,p=t*h+i*d+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);let f=1/p;return e[0]=h*f,e[1]=(n*l-c*i)*f,e[2]=(s*i-n*a)*f,e[3]=d*f,e[4]=(c*t-n*o)*f,e[5]=(n*r-s*t)*f,e[6]=u*f,e[7]=(i*o-l*t)*f,e[8]=(a*t-i*r)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,r,a,s){let o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*a+l*s)+a+e,-n*l,n*o,-n*(-l*a+o*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(Go.makeScale(e,t)),this}rotate(e){return this.premultiply(Go.makeRotation(-e)),this}translate(e,t){return this.premultiply(Go.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<9;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}},Go=new Vo;function Ho(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}var Wo={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function qo(e,t){return new Wo[e](t)}function Xo(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Yo(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Qo(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Ko={[xo]:{[wo]:Yo},[wo]:{[xo]:Qo}},Zo={legacyMode:!0,get workingColorSpace(){return wo},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,i){if(this.legacyMode||t===i||!t||!i)return e;if(Ko[t]&&void 0!==Ko[t][i]){let n=Ko[t][i];return e.r=n(e.r),e.g=n(e.g),e.b=n(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Jo={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$o={r:0,g:0,b:0},el={h:0,s:0,l:0},tl={h:0,s:0,l:0};function il(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function nl(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var rl=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xo;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Zo.toWorkingColorSpace(this,t),this}setRGB(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zo.workingColorSpace;return this.r=e,this.g=t,this.b=i,Zo.toWorkingColorSpace(this,n),this}setHSL(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zo.workingColorSpace;if(e=Io(e,1),t=Oo(t,0,1),i=Oo(i,0,1),0===t)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+t):i+t-i*t,r=2*i-n;this.r=il(r,n,e+1/3),this.g=il(r,n,e),this.b=il(r,n,e-1/3)}return Zo.toWorkingColorSpace(this,n),this}setStyle(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xo;function n(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e,r=t[1],a=t[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,Zo.toWorkingColorSpace(this,i),n(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,Zo.toWorkingColorSpace(this,i),n(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let t=parseFloat(e[1])/360,r=parseFloat(e[2])/100,a=parseFloat(e[3])/100;return n(e[4]),this.setHSL(t,r,a,i)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){let e=t[1],n=e.length;if(3===n)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,Zo.toWorkingColorSpace(this,i),this;if(6===n)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,Zo.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xo,i=Jo[e.toLowerCase()];return void 0!==i?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Yo(e.r),this.g=Yo(e.g),this.b=Yo(e.b),this}copyLinearToSRGB(e){return this.r=Qo(e.r),this.g=Qo(e.g),this.b=Qo(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xo;return Zo.fromWorkingColorSpace(nl(this,$o),e),Oo(255*$o.r,0,255)<<16^Oo(255*$o.g,0,255)<<8^Oo(255*$o.b,0,255)}getHexString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xo;return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zo.workingColorSpace;Zo.fromWorkingColorSpace(nl(this,$o),t);let i,n,r=$o.r,a=$o.g,s=$o.b,o=Math.max(r,a,s),l=Math.min(r,a,s),c=(l+o)/2;if(l===o)i=0,n=0;else{let e=o-l;switch(n=c<=.5?e/(o+l):e/(2-o-l),o){case r:i=(a-s)/e+(a<s?6:0);break;case a:i=(s-r)/e+2;break;case s:i=(r-a)/e+4}i/=6}return e.h=i,e.s=n,e.l=c,e}getRGB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zo.workingColorSpace;return Zo.fromWorkingColorSpace(nl(this,$o),t),e.r=$o.r,e.g=$o.g,e.b=$o.b,e}getStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xo;return Zo.fromWorkingColorSpace(nl(this,$o),e),e!==xo?"color(".concat(e," ").concat($o.r," ").concat($o.g," ").concat($o.b,")"):"rgb(".concat(255*$o.r|0,",").concat(255*$o.g|0,",").concat(255*$o.b|0,")")}offsetHSL(e,t,i){return this.getHSL(el),el.h+=e,el.s+=t,el.l+=i,this.setHSL(el.h,el.s,el.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(el),e.getHSL(tl);let i=ko(el.h,tl.h,t),n=ko(el.s,tl.s,t),r=ko(el.l,tl.l,t);return this.setHSL(i,n,r),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};rl.NAMES=Jo;var al,sl=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===al&&(al=Xo("canvas")),al.width=e.width,al.height=e.height;let i=al.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=al}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=Xo("canvas");t.width=e.width,t.height=e.height;let i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);let n=i.getImageData(0,0,e.width,e.height),r=n.data;for(let e=0;e<r.length;e++)r[e]=255*Yo(r[e]/255);return i.putImageData(n,0,0),t}if(e.data){let t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*Yo(t[e]/255)):t[e]=Yo(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},ol=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.isSource=!0,this.uuid=Ro(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];let i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)n[t].isDataTexture?e.push(ll(n[t].image)):e.push(ll(n[t]))}else e=ll(n);i.url=e}return t||(e.images[this.uuid]=i),i}};function ll(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?sl.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var cl=0,hl=class extends Co{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hl.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:hl.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:$a,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$a,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:rs,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ss,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:bs,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:os,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:hl.DEFAULT_ANISOTROPY,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:fo;super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:cl++}),this.uuid=Ro(),this.name="",this.source=new ol(e),this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=o,this.offset=new jo(0,0),this.repeat=new jo(1,1),this.center=new jo(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vo,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ja:e.x=e.x-Math.floor(e.x);break;case $a:e.x=e.x<0?0:1;break;case es:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case Ja:e.y=e.y-Math.floor(e.y);break;case $a:e.y=e.y<0?0:1;break;case es:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}};hl.DEFAULT_IMAGE=null,hl.DEFAULT_MAPPING=300,hl.DEFAULT_ANISOTROPY=1;var dl=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;dl.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*t+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*t+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*t+a[7]*i+a[11]*n+a[15]*r,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,r,a=e.elements,s=a[0],o=a[4],l=a[8],c=a[1],h=a[5],d=a[9],u=a[2],p=a[6],f=a[10];if(Math.abs(o-c)<.01&&Math.abs(l-u)<.01&&Math.abs(d-p)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+u)<.1&&Math.abs(d+p)<.1&&Math.abs(s+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let e=(s+1)/2,a=(h+1)/2,m=(f+1)/2,g=(o+c)/4,v=(l+u)/4,y=(d+p)/4;return e>a&&e>m?e<.01?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(e),n=g/i,r=v/i):a>m?a<.01?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(a),i=g/n,r=y/n):m<.01?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(m),i=v/r,n=y/r),this.set(i,n,r,t),this}let m=Math.sqrt((p-d)*(p-d)+(l-u)*(l-u)+(c-o)*(c-o));return Math.abs(m)<.001&&(m=1),this.x=(p-d)/m,this.y=(l-u)/m,this.z=(c-o)/m,this.w=Math.acos((s+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},ul=class extends Co{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new dl(0,0,e,t),this.scissorTest=!1,this.viewport=new dl(0,0,e,t);let n={width:e,height:t,depth:1};this.texture=new hl(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:rs,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;let t=Object.assign({},e.texture.image);return this.texture.source=new ol(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},pl=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=ts,this.minFilter=ts,this.wrapR=$a,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},fl=class extends ul{constructor(){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}),this.isWebGLMultipleRenderTargets=!0;let t=this.texture;this.texture=[];for(let i=0;i<e;i++)this.texture[i]=t.clone(),this.texture[i].isRenderTargetTexture=!0}setSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}},ml=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=n}static slerpFlat(e,t,i,n,r,a,s){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3],d=r[a+0],u=r[a+1],p=r[a+2],f=r[a+3];if(0===s)return e[t+0]=o,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===s)return e[t+0]=d,e[t+1]=u,e[t+2]=p,void(e[t+3]=f);if(h!==f||o!==d||l!==u||c!==p){let e=1-s,t=o*d+l*u+c*p+h*f,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){let r=Math.sqrt(n),a=Math.atan2(r,t*i);e=Math.sin(e*a)/r,s=Math.sin(s*a)/r}let r=s*i;if(o=o*e+d*r,l=l*e+u*r,c=c*e+p*r,h=h*e+f*r,e===1-s){let e=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=e,l*=e,c*=e,h*=e}}e[t]=o,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,n,r,a){let s=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[a],d=r[a+1],u=r[a+2],p=r[a+3];return e[t]=s*p+c*h+o*u-l*d,e[t+1]=o*p+c*d+l*h-s*u,e[t+2]=l*p+c*u+s*d-o*h,e[t+3]=c*p-s*h-o*d-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){let i=e._x,n=e._y,r=e._z,a=e._order,s=Math.cos,o=Math.sin,l=s(i/2),c=s(n/2),h=s(r/2),d=o(i/2),u=o(n/2),p=o(r/2);switch(a){case"XYZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"YXZ":this._x=d*c*h+l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"ZXY":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h-d*u*p;break;case"ZYX":this._x=d*c*h-l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h+d*u*p;break;case"YZX":this._x=d*c*h+l*u*p,this._y=l*u*h+d*c*p,this._z=l*c*p-d*u*h,this._w=l*c*h-d*u*p;break;case"XZY":this._x=d*c*h-l*u*p,this._y=l*u*h-d*c*p,this._z=l*c*p+d*u*h,this._w=l*c*h+d*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,i=t[0],n=t[4],r=t[8],a=t[1],s=t[5],o=t[9],l=t[2],c=t[6],h=t[10],d=i+s+h;if(d>0){let e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(c-o)*e,this._y=(r-l)*e,this._z=(a-n)*e}else if(i>s&&i>h){let e=2*Math.sqrt(1+i-s-h);this._w=(c-o)/e,this._x=.25*e,this._y=(n+a)/e,this._z=(r+l)/e}else if(s>h){let e=2*Math.sqrt(1+s-i-h);this._w=(r-l)/e,this._x=(n+a)/e,this._y=.25*e,this._z=(o+c)/e}else{let e=2*Math.sqrt(1+h-i-s);this._w=(a-n)/e,this._x=(r+l)/e,this._y=(o+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Oo(this.dot(e),-1,1)))}rotateTowards(e,t){let i=this.angleTo(e);if(0===i)return this;let n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let i=e._x,n=e._y,r=e._z,a=e._w,s=t._x,o=t._y,l=t._z,c=t._w;return this._x=i*c+a*s+n*l-r*o,this._y=n*c+a*o+r*s-i*l,this._z=r*c+a*l+i*o-n*s,this._w=a*c-i*s-n*o-r*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);let i=this._x,n=this._y,r=this._z,a=this._w,s=a*e._w+i*e._x+n*e._y+r*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;let o=1-s*s;if(o<=Number.EPSILON){let e=1-t;return this._w=e*a+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*r+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,s),h=Math.sin((1-t)*c)/l,d=Math.sin(t*c)/l;return this._w=a*h+this._w*d,this._x=i*h+this._x*d,this._y=n*h+this._y*d,this._z=r*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){let e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(r),i*Math.cos(r),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},gl=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;gl.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(yl.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(yl.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,i=this.y,n=this.z,r=e.elements,a=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*a,this}applyQuaternion(e){let t=this.x,i=this.y,n=this.z,r=e.x,a=e.y,s=e.z,o=e.w,l=o*t+a*n-s*i,c=o*i+s*t-r*n,h=o*n+r*i-a*t,d=-r*t-a*i-s*n;return this.x=l*o+d*-r+c*-s-h*-a,this.y=c*o+d*-a+h*-r-l*-s,this.z=h*o+d*-s+l*-a-c*-r,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){let i=e.x,n=e.y,r=e.z,a=t.x,s=t.y,o=t.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this}projectOnVector(e){let t=e.lengthSq();if(0===t)return this.set(0,0,0);let i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return vl.copy(this).projectOnVector(e),this.sub(vl)}reflect(e){return this.sub(vl.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;let i=this.dot(e)/t;return Math.acos(Oo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){let n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},vl=new gl,yl=new ml,bl=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl(-1/0,-1/0,-1/0);this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=e.length;o<l;o+=3){let l=e[o],c=e[o+1],h=e[o+2];l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>a&&(a=c),h>s&&(s=h)}return this.min.set(t,i,n),this.max.set(r,a,s),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=e.count;o<l;o++){let l=e.getX(o),c=e.getY(o),h=e.getZ(o);l<t&&(t=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>a&&(a=c),h>s&&(s=h)}return this.min.set(t,i,n),this.max.set(r,a,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=wl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);let i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){let t=i.attributes.position;for(let i=0,n=t.count;i<n;i++)wl.fromBufferAttribute(t,i).applyMatrix4(e.matrixWorld),this.expandByPoint(wl)}else null===i.boundingBox&&i.computeBoundingBox(),_l.copy(i.boundingBox),_l.applyMatrix4(e.matrixWorld),this.union(_l);let n=e.children;for(let r=0,a=n.length;r<a;r++)this.expandByObject(n[r],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,wl),wl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Tl),Dl.subVectors(this.max,Tl),Sl.subVectors(e.a,Tl),Al.subVectors(e.b,Tl),El.subVectors(e.c,Tl),Cl.subVectors(Al,Sl),Ml.subVectors(El,Al),Pl.subVectors(Sl,El);let t=[0,-Cl.z,Cl.y,0,-Ml.z,Ml.y,0,-Pl.z,Pl.y,Cl.z,0,-Cl.x,Ml.z,0,-Ml.x,Pl.z,0,-Pl.x,-Cl.y,Cl.x,0,-Ml.y,Ml.x,0,-Pl.y,Pl.x,0];return!(!Il(t,Sl,Al,El,Dl)||(t=[1,0,0,0,1,0,0,0,1],!Il(t,Sl,Al,El,Dl)))&&(Rl.crossVectors(Cl,Ml),t=[Rl.x,Rl.y,Rl.z],Il(t,Sl,Al,El,Dl))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return wl.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(wl).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(xl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),xl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),xl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),xl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),xl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),xl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),xl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),xl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(xl)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},xl=[new gl,new gl,new gl,new gl,new gl,new gl,new gl,new gl],wl=new gl,_l=new bl,Sl=new gl,Al=new gl,El=new gl,Cl=new gl,Ml=new gl,Pl=new gl,Tl=new gl,Dl=new gl,Rl=new gl,Ol=new gl;function Il(e,t,i,n,r){for(let a=0,s=e.length-3;a<=s;a+=3){Ol.fromArray(e,a);let s=r.x*Math.abs(Ol.x)+r.y*Math.abs(Ol.y)+r.z*Math.abs(Ol.z),o=t.dot(Ol),l=i.dot(Ol),c=n.dot(Ol);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>s)return!1}return!0}var kl=new bl,Ll=new gl,Fl=new gl,Bl=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let i=this.center;void 0!==t?i.copy(t):kl.setFromPoints(e).getCenter(i);let n=0;for(let r=0,a=e.length;r<a;r++)n=Math.max(n,i.distanceToSquared(e[r]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ll.subVectors(e,this.center);let t=Ll.lengthSq();if(t>this.radius*this.radius){let e=Math.sqrt(t),i=.5*(e-this.radius);this.center.addScaledVector(Ll,i/e),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Fl.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ll.copy(e.center).add(Fl)),this.expandByPoint(Ll.copy(e.center).sub(Fl))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}},Nl=new gl,zl=new gl,Ul=new gl,jl=new gl,Vl=new gl,Gl=new gl,Hl=new gl,Wl=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl(0,0,-1);this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Nl)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=Nl.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Nl.copy(this.direction).multiplyScalar(t).add(this.origin),Nl.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){zl.copy(e).add(t).multiplyScalar(.5),Ul.copy(t).sub(e).normalize(),jl.copy(this.origin).sub(zl);let r,a,s,o,l=.5*e.distanceTo(t),c=-this.direction.dot(Ul),h=jl.dot(this.direction),d=-jl.dot(Ul),u=jl.lengthSq(),p=Math.abs(1-c*c);if(p>0)if(r=c*d-h,a=c*h-d,o=l*p,r>=0)if(a>=-o)if(a<=o){let e=1/p;r*=e,a*=e,s=r*(r+c*a+2*h)+a*(c*r+a+2*d)+u}else a=l,r=Math.max(0,-(c*a+h)),s=-r*r+a*(a+2*d)+u;else a=-l,r=Math.max(0,-(c*a+h)),s=-r*r+a*(a+2*d)+u;else a<=-o?(r=Math.max(0,-(-c*l+h)),a=r>0?-l:Math.min(Math.max(-l,-d),l),s=-r*r+a*(a+2*d)+u):a<=o?(r=0,a=Math.min(Math.max(-l,-d),l),s=a*(a+2*d)+u):(r=Math.max(0,-(c*l+h)),a=r>0?l:Math.min(Math.max(-l,-d),l),s=-r*r+a*(a+2*d)+u);else a=c>0?-l:l,r=Math.max(0,-(c*a+h)),s=-r*r+a*(a+2*d)+u;return i&&i.copy(this.direction).multiplyScalar(r).add(this.origin),n&&n.copy(Ul).multiplyScalar(a).add(zl),s}intersectSphere(e,t){Nl.subVectors(e.center,this.origin);let i=Nl.dot(this.direction),n=Nl.dot(Nl)-i*i,r=e.radius*e.radius;if(n>r)return null;let a=Math.sqrt(r-n),s=i-a,o=i+a;return s<0&&o<0?null:s<0?this.at(o,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;let i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){let i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,r,a,s,o,l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(i=(e.min.x-d.x)*l,n=(e.max.x-d.x)*l):(i=(e.max.x-d.x)*l,n=(e.min.x-d.x)*l),c>=0?(r=(e.min.y-d.y)*c,a=(e.max.y-d.y)*c):(r=(e.max.y-d.y)*c,a=(e.min.y-d.y)*c),i>a||r>n||((r>i||isNaN(i))&&(i=r),(a<n||isNaN(n))&&(n=a),h>=0?(s=(e.min.z-d.z)*h,o=(e.max.z-d.z)*h):(s=(e.max.z-d.z)*h,o=(e.min.z-d.z)*h),i>o||s>n)||((s>i||i!==i)&&(i=s),(o<n||n!==n)&&(n=o),n<0)?null:this.at(i>=0?i:n,t)}intersectsBox(e){return null!==this.intersectBox(e,Nl)}intersectTriangle(e,t,i,n,r){Vl.subVectors(t,e),Gl.subVectors(i,e),Hl.crossVectors(Vl,Gl);let a,s=this.direction.dot(Hl);if(s>0){if(n)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}jl.subVectors(this.origin,e);let o=a*this.direction.dot(Gl.crossVectors(jl,Gl));if(o<0)return null;let l=a*this.direction.dot(Vl.cross(jl));if(l<0||o+l>s)return null;let c=-a*jl.dot(Hl);return c<0?null:this.at(c/s,r)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}},ql=class{constructor(){ql.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,n,r,a,s,o,l,c,h,d,u,p,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=d,g[3]=u,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ql).fromArray(this.elements)}copy(e){let t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){let t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,i=e.elements,n=1/Xl.setFromMatrixColumn(e,0).length(),r=1/Xl.setFromMatrixColumn(e,1).length(),a=1/Xl.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*r,t[5]=i[5]*r,t[6]=i[6]*r,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){let t=this.elements,i=e.x,n=e.y,r=e.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===e.order){let e=a*c,i=a*h,n=s*c,r=s*h;t[0]=o*c,t[4]=-o*h,t[8]=l,t[1]=i+n*l,t[5]=e-r*l,t[9]=-s*o,t[2]=r-e*l,t[6]=n+i*l,t[10]=a*o}else if("YXZ"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e+r*s,t[4]=n*s-i,t[8]=a*l,t[1]=a*h,t[5]=a*c,t[9]=-s,t[2]=i*s-n,t[6]=r+e*s,t[10]=a*o}else if("ZXY"===e.order){let e=o*c,i=o*h,n=l*c,r=l*h;t[0]=e-r*s,t[4]=-a*h,t[8]=n+i*s,t[1]=i+n*s,t[5]=a*c,t[9]=r-e*s,t[2]=-a*l,t[6]=s,t[10]=a*o}else if("ZYX"===e.order){let e=a*c,i=a*h,n=s*c,r=s*h;t[0]=o*c,t[4]=n*l-i,t[8]=e*l+r,t[1]=o*h,t[5]=r*l+e,t[9]=i*l-n,t[2]=-l,t[6]=s*o,t[10]=a*o}else if("YZX"===e.order){let e=a*o,i=a*l,n=s*o,r=s*l;t[0]=o*c,t[4]=r-e*h,t[8]=n*h+i,t[1]=h,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=i*h+n,t[10]=e-r*h}else if("XZY"===e.order){let e=a*o,i=a*l,n=s*o,r=s*l;t[0]=o*c,t[4]=-h,t[8]=l*c,t[1]=e*h+r,t[5]=a*c,t[9]=i*h-n,t[2]=n*h-i,t[6]=s*c,t[10]=r*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Ql,e,Kl)}lookAt(e,t,i){let n=this.elements;return $l.subVectors(e,t),0===$l.lengthSq()&&($l.z=1),$l.normalize(),Zl.crossVectors(i,$l),0===Zl.lengthSq()&&(1===Math.abs(i.z)?$l.x+=1e-4:$l.z+=1e-4,$l.normalize(),Zl.crossVectors(i,$l)),Zl.normalize(),Jl.crossVectors($l,Zl),n[0]=Zl.x,n[4]=Jl.x,n[8]=$l.x,n[1]=Zl.y,n[5]=Jl.y,n[9]=$l.y,n[2]=Zl.z,n[6]=Jl.z,n[10]=$l.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let i=e.elements,n=t.elements,r=this.elements,a=i[0],s=i[4],o=i[8],l=i[12],c=i[1],h=i[5],d=i[9],u=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],b=i[11],x=i[15],w=n[0],_=n[4],S=n[8],A=n[12],E=n[1],C=n[5],M=n[9],P=n[13],T=n[2],D=n[6],R=n[10],O=n[14],I=n[3],k=n[7],L=n[11],F=n[15];return r[0]=a*w+s*E+o*T+l*I,r[4]=a*_+s*C+o*D+l*k,r[8]=a*S+s*M+o*R+l*L,r[12]=a*A+s*P+o*O+l*F,r[1]=c*w+h*E+d*T+u*I,r[5]=c*_+h*C+d*D+u*k,r[9]=c*S+h*M+d*R+u*L,r[13]=c*A+h*P+d*O+u*F,r[2]=p*w+f*E+m*T+g*I,r[6]=p*_+f*C+m*D+g*k,r[10]=p*S+f*M+m*R+g*L,r[14]=p*A+f*P+m*O+g*F,r[3]=v*w+y*E+b*T+x*I,r[7]=v*_+y*C+b*D+x*k,r[11]=v*S+y*M+b*R+x*L,r[15]=v*A+y*P+b*O+x*F,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],a=e[1],s=e[5],o=e[9],l=e[13],c=e[2],h=e[6],d=e[10],u=e[14];return e[3]*(+r*o*h-n*l*h-r*s*d+i*l*d+n*s*u-i*o*u)+e[7]*(+t*o*u-t*l*d+r*a*d-n*a*u+n*l*c-r*o*c)+e[11]*(+t*l*h-t*s*u-r*a*h+i*a*u+r*s*c-i*l*c)+e[15]*(-n*s*c-t*o*h+t*s*d+n*a*h-i*a*d+i*o*c)}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(e,t,i){let n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){let e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],h=e[9],d=e[10],u=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*d*l+f*o*u-s*m*u-h*o*g+s*d*g,y=p*d*l-c*m*l-p*o*u+a*m*u+c*o*g-a*d*g,b=c*f*l-p*h*l+p*s*u-a*f*u-c*s*g+a*h*g,x=p*h*o-c*f*o-p*s*d+a*f*d+c*s*m-a*h*m,w=t*v+i*y+n*b+r*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let _=1/w;return e[0]=v*_,e[1]=(f*d*r-h*m*r-f*n*u+i*m*u+h*n*g-i*d*g)*_,e[2]=(s*m*r-f*o*r+f*n*l-i*m*l-s*n*g+i*o*g)*_,e[3]=(h*o*r-s*d*r-h*n*l+i*d*l+s*n*u-i*o*u)*_,e[4]=y*_,e[5]=(c*m*r-p*d*r+p*n*u-t*m*u-c*n*g+t*d*g)*_,e[6]=(p*o*r-a*m*r-p*n*l+t*m*l+a*n*g-t*o*g)*_,e[7]=(a*d*r-c*o*r+c*n*l-t*d*l-a*n*u+t*o*u)*_,e[8]=b*_,e[9]=(p*h*r-c*f*r-p*i*u+t*f*u+c*i*g-t*h*g)*_,e[10]=(a*f*r-p*s*r+p*i*l-t*f*l-a*i*g+t*s*g)*_,e[11]=(c*s*r-a*h*r-c*i*l+t*h*l+a*i*u-t*s*u)*_,e[12]=x*_,e[13]=(c*f*n-p*h*n+p*i*d-t*f*d-c*i*m+t*h*m)*_,e[14]=(p*s*n-a*f*n-p*i*o+t*f*o+a*i*m-t*s*m)*_,e[15]=(a*h*n-c*s*n+c*i*o-t*h*o-a*i*d+t*s*d)*_,this}scale(e){let t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let i=Math.cos(t),n=Math.sin(t),r=1-i,a=e.x,s=e.y,o=e.z,l=r*a,c=r*s;return this.set(l*a+i,l*s-n*o,l*o+n*s,0,l*s+n*o,c*s+i,c*o-n*a,0,l*o-n*s,c*o+n*a,r*o*o+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,r,a){return this.set(1,i,r,0,e,1,a,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){let n=this.elements,r=t._x,a=t._y,s=t._z,o=t._w,l=r+r,c=a+a,h=s+s,d=r*l,u=r*c,p=r*h,f=a*c,m=a*h,g=s*h,v=o*l,y=o*c,b=o*h,x=i.x,w=i.y,_=i.z;return n[0]=(1-(f+g))*x,n[1]=(u+b)*x,n[2]=(p-y)*x,n[3]=0,n[4]=(u-b)*w,n[5]=(1-(d+g))*w,n[6]=(m+v)*w,n[7]=0,n[8]=(p+y)*_,n[9]=(m-v)*_,n[10]=(1-(d+f))*_,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){let n=this.elements,r=Xl.set(n[0],n[1],n[2]).length(),a=Xl.set(n[4],n[5],n[6]).length(),s=Xl.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),e.x=n[12],e.y=n[13],e.z=n[14],Yl.copy(this);let o=1/r,l=1/a,c=1/s;return Yl.elements[0]*=o,Yl.elements[1]*=o,Yl.elements[2]*=o,Yl.elements[4]*=l,Yl.elements[5]*=l,Yl.elements[6]*=l,Yl.elements[8]*=c,Yl.elements[9]*=c,Yl.elements[10]*=c,t.setFromRotationMatrix(Yl),i.x=r,i.y=a,i.z=s,this}makePerspective(e,t,i,n,r,a){let s=this.elements,o=2*r/(t-e),l=2*r/(i-n),c=(t+e)/(t-e),h=(i+n)/(i-n),d=-(a+r)/(a-r),u=-2*a*r/(a-r);return s[0]=o,s[4]=0,s[8]=c,s[12]=0,s[1]=0,s[5]=l,s[9]=h,s[13]=0,s[2]=0,s[6]=0,s[10]=d,s[14]=u,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,i,n,r,a){let s=this.elements,o=1/(t-e),l=1/(i-n),c=1/(a-r),h=(t+e)*o,d=(i+n)*l,u=(a+r)*c;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-h,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-d,s[2]=0,s[6]=0,s[10]=-2*c,s[14]=-u,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){let t=this.elements,i=e.elements;for(let n=0;n<16;n++)if(t[n]!==i[n])return!1;return!0}fromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}},Xl=new gl,Yl=new ql,Ql=new gl(0,0,0),Kl=new gl(1,1,1),Zl=new gl,Jl=new gl,$l=new gl,ec=new ql,tc=new ml,ic=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ic.DEFAULT_ORDER;this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.elements,r=n[0],a=n[4],s=n[8],o=n[1],l=n[5],c=n[9],h=n[2],d=n[6],u=n[10];switch(t){case"XYZ":this._y=Math.asin(Oo(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-a,r)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Oo(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,u),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(Oo(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,u),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-Oo(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,u),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(Oo(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(s,u));break;case"XZY":this._z=Math.asin(-Oo(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return ec.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ec,t,i)}setFromVector3(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}reorder(e){return tc.setFromEuler(this),this.setFromQuaternion(tc,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};ic.DEFAULT_ORDER="XYZ";var nc=class{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return 0!==(this.mask&1<<e)}},rc=0,ac=new gl,sc=new ml,oc=new ql,lc=new gl,cc=new gl,hc=new gl,dc=new ml,uc=new gl(1,0,0),pc=new gl(0,1,0),fc=new gl(0,0,1),mc={type:"added"},gc={type:"removed"},vc=class extends Co{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:rc++}),this.uuid=Ro(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=vc.DEFAULT_UP.clone();let e=new gl,t=new ic,i=new ml,n=new gl(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ql},normalMatrix:{value:new Vo}}),this.matrix=new ql,this.matrixWorld=new ql,this.matrixAutoUpdate=vc.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=vc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new nc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return sc.setFromAxisAngle(e,t),this.quaternion.multiply(sc),this}rotateOnWorldAxis(e,t){return sc.setFromAxisAngle(e,t),this.quaternion.premultiply(sc),this}rotateX(e){return this.rotateOnAxis(uc,e)}rotateY(e){return this.rotateOnAxis(pc,e)}rotateZ(e){return this.rotateOnAxis(fc,e)}translateOnAxis(e,t){return ac.copy(e).applyQuaternion(this.quaternion),this.position.add(ac.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(uc,e)}translateY(e){return this.translateOnAxis(pc,e)}translateZ(e){return this.translateOnAxis(fc,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(oc.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?lc.copy(e):lc.set(e,t,i);let n=this.parent;this.updateWorldMatrix(!0,!1),cc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?oc.lookAt(cc,lc,this.up):oc.lookAt(lc,cc,this.up),this.quaternion.setFromRotationMatrix(oc),n&&(oc.extractRotation(n.matrixWorld),sc.setFromRotationMatrix(oc),this.quaternion.premultiply(sc.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(mc)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}let t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(gc)),this}removeFromParent(){let e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(gc)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),oc.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),oc.multiply(e.parent.matrixWorld)),e.applyMatrix4(oc),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){let n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getObjectsByProperty(e,t){let i=[];this[e]===t&&i.push(this);for(let n=0,r=this.children.length;n<r;n++){let r=this.children[n].getObjectsByProperty(e,t);r.length>0&&(i=i.concat(r))}return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cc,e,hc),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(cc,dc,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);let t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){let t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let i=0,n=t.length;i<n;i++){let n=t[i];(!0===n.matrixWorldAutoUpdate||!0===e)&&n.updateMatrixWorld(e)}}updateWorldMatrix(e,t){let i=this.parent;if(!0===e&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){let e=this.children;for(let t=0,i=e.length;t<i;t++){let i=e[t];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(e){let t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let n={};function r(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(e.geometries,this.geometry);let t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){let i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){let n=i[t];r(e.shapes,n)}else r(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){let t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(r(e.materials,this.material[i]));n.material=t}else n.material=r(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){let i=this.animations[t];n.animations.push(r(e.animations,i))}}if(t){let t=a(e.geometries),n=a(e.materials),r=a(e.textures),s=a(e.images),o=a(e.shapes),l=a(e.skeletons),c=a(e.animations),h=a(e.nodes);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),s.length>0&&(i.images=s),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function a(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let i=0;i<e.children.length;i++){let t=e.children[i];this.add(t.clone())}return this}};vc.DEFAULT_UP=new gl(0,1,0),vc.DEFAULT_MATRIX_AUTO_UPDATE=!0,vc.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var yc=new gl,bc=new gl,xc=new gl,wc=new gl,_c=new gl,Sc=new gl,Ac=new gl,Ec=new gl,Cc=new gl,Mc=new gl,Pc=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gl;this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),yc.subVectors(e,t),n.cross(yc);let r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(e,t,i,n,r){yc.subVectors(n,t),bc.subVectors(i,t),xc.subVectors(e,t);let a=yc.dot(yc),s=yc.dot(bc),o=yc.dot(xc),l=bc.dot(bc),c=bc.dot(xc),h=a*l-s*s;if(0===h)return r.set(-2,-1,-1);let d=1/h,u=(l*o-s*c)*d,p=(a*c-s*o)*d;return r.set(1-u-p,p,u)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,wc),wc.x>=0&&wc.y>=0&&wc.x+wc.y<=1}static getUV(e,t,i,n,r,a,s,o){return this.getBarycoord(e,t,i,n,wc),o.set(0,0),o.addScaledVector(r,wc.x),o.addScaledVector(a,wc.y),o.addScaledVector(s,wc.z),o}static isFrontFacing(e,t,i,n){return yc.subVectors(i,t),bc.subVectors(e,t),yc.cross(bc).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return yc.subVectors(this.c,this.b),bc.subVectors(this.a,this.b),.5*yc.cross(bc).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Pc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Pc.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,r){return Pc.getUV(e,this.a,this.b,this.c,t,i,n,r)}containsPoint(e){return Pc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Pc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let i,n,r=this.a,a=this.b,s=this.c;_c.subVectors(a,r),Sc.subVectors(s,r),Ec.subVectors(e,r);let o=_c.dot(Ec),l=Sc.dot(Ec);if(o<=0&&l<=0)return t.copy(r);Cc.subVectors(e,a);let c=_c.dot(Cc),h=Sc.dot(Cc);if(c>=0&&h<=c)return t.copy(a);let d=o*h-c*l;if(d<=0&&o>=0&&c<=0)return i=o/(o-c),t.copy(r).addScaledVector(_c,i);Mc.subVectors(e,s);let u=_c.dot(Mc),p=Sc.dot(Mc);if(p>=0&&u<=p)return t.copy(s);let f=u*l-o*p;if(f<=0&&l>=0&&p<=0)return n=l/(l-p),t.copy(r).addScaledVector(Sc,n);let m=c*p-u*h;if(m<=0&&h-c>=0&&u-p>=0)return Ac.subVectors(s,a),n=(h-c)/(h-c+(u-p)),t.copy(a).addScaledVector(Ac,n);let g=1/(m+f+d);return i=f*g,n=d*g,t.copy(r).addScaledVector(_c,i).addScaledVector(Sc,n)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},Tc=0,Dc=class extends Co{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Tc++}),this.uuid=Ro(),this.name="",this.type="Material",this.blending=ca,this.side=aa,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Sa,this.blendDst=Aa,this.blendEquation=fa,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Ia,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_o,this.stencilZFail=_o,this.stencilZPass=_o,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(let t in e){let i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}let n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){let t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){let t=[];for(let i in e){let n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ca&&(i.blending=this.blending),this.side!==aa&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.forceSinglePass&&(i.forceSinglePass=this.forceSinglePass),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),t){let t=n(e.textures),r=n(e.images);t.length>0&&(i.textures=t),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,i=null;if(null!==t){let e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}},Rc=class extends Dc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new rl(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Na,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}},Oc=new gl,Ic=new jo,kc=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=i,this.usage=So,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Ic.fromBufferAttribute(this,t),Ic.applyMatrix3(e),this.setXY(t,Ic.x,Ic.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)Oc.fromBufferAttribute(this,t),Oc.applyMatrix3(e),this.setXYZ(t,Oc.x,Oc.y,Oc.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)Oc.fromBufferAttribute(this,t),Oc.applyMatrix4(e),this.setXYZ(t,Oc.x,Oc.y,Oc.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Oc.fromBufferAttribute(this,t),Oc.applyNormalMatrix(e),this.setXYZ(t,Oc.x,Oc.y,Oc.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Oc.fromBufferAttribute(this,t),Oc.transformDirection(e),this.setXYZ(t,Oc.x,Oc.y,Oc.z);return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=No(t,this.array)),t}setX(e,t){return this.normalized&&(t=zo(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=No(t,this.array)),t}setY(e,t){return this.normalized&&(t=zo(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=No(t,this.array)),t}setZ(e,t){return this.normalized&&(t=zo(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=No(t,this.array)),t}setW(e,t){return this.normalized&&(t=zo(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=zo(t,this.array),i=zo(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.normalized&&(t=zo(t,this.array),i=zo(i,this.array),n=zo(n,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e*=this.itemSize,this.normalized&&(t=zo(t,this.array),i=zo(i,this.array),n=zo(n,this.array),r=zo(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=r,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==So&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},Lc=class extends kc{constructor(e,t,i){super(new Uint16Array(e),t,i)}},Fc=class extends kc{constructor(e,t,i){super(new Uint32Array(e),t,i)}},Bc=class extends kc{constructor(e,t,i){super(new Float32Array(e),t,i)}},Nc=0,zc=new ql,Uc=new vc,jc=new gl,Vc=new bl,Gc=new bl,Hc=new gl,Wc=class extends Co{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Nc++}),this.uuid=Ro(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Ho(e)?Fc:Lc)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);let i=this.attributes.normal;if(void 0!==i){let t=(new Vo).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}let n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return zc.makeRotationFromQuaternion(e),this.applyMatrix4(zc),this}rotateX(e){return zc.makeRotationX(e),this.applyMatrix4(zc),this}rotateY(e){return zc.makeRotationY(e),this.applyMatrix4(zc),this}rotateZ(e){return zc.makeRotationZ(e),this.applyMatrix4(zc),this}translate(e,t,i){return zc.makeTranslation(e,t,i),this.applyMatrix4(zc),this}scale(e,t,i){return zc.makeScale(e,t,i),this.applyMatrix4(zc),this}lookAt(e){return Uc.lookAt(e),Uc.updateMatrix(),this.applyMatrix4(Uc.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jc).negate(),this.translate(jc.x,jc.y,jc.z),this}setFromPoints(e){let t=[];for(let i=0,n=e.length;i<n;i++){let n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Bc(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new bl);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new gl(-1/0,-1/0,-1/0),new gl(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,n=t.length;i<n;i++){let e=t[i];Vc.setFromBufferAttribute(e),this.morphTargetsRelative?(Hc.addVectors(this.boundingBox.min,Vc.min),this.boundingBox.expandByPoint(Hc),Hc.addVectors(this.boundingBox.max,Vc.max),this.boundingBox.expandByPoint(Hc)):(this.boundingBox.expandByPoint(Vc.min),this.boundingBox.expandByPoint(Vc.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Bl);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new gl,1/0);if(e){let i=this.boundingSphere.center;if(Vc.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){let i=t[e];Gc.setFromBufferAttribute(i),this.morphTargetsRelative?(Hc.addVectors(Vc.min,Gc.min),Vc.expandByPoint(Hc),Hc.addVectors(Vc.max,Gc.max),Vc.expandByPoint(Hc)):(Vc.expandByPoint(Gc.min),Vc.expandByPoint(Gc.max))}Vc.getCenter(i);let n=0;for(let t=0,r=e.count;t<r;t++)Hc.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(Hc));if(t)for(let r=0,a=t.length;r<a;r++){let a=t[r],s=this.morphTargetsRelative;for(let t=0,r=a.count;t<r;t++)Hc.fromBufferAttribute(a,t),s&&(jc.fromBufferAttribute(e,t),Hc.add(jc)),n=Math.max(n,i.distanceToSquared(Hc))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");let i=e.array,n=t.position.array,r=t.normal.array,a=t.uv.array,s=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new kc(new Float32Array(4*s),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let E=0;E<s;E++)l[E]=new gl,c[E]=new gl;let h=new gl,d=new gl,u=new gl,p=new jo,f=new jo,m=new jo,g=new gl,v=new gl;function y(e,t,i){h.fromArray(n,3*e),d.fromArray(n,3*t),u.fromArray(n,3*i),p.fromArray(a,2*e),f.fromArray(a,2*t),m.fromArray(a,2*i),d.sub(h),u.sub(h),f.sub(p),m.sub(p);let r=1/(f.x*m.y-m.x*f.y);!isFinite(r)||(g.copy(d).multiplyScalar(m.y).addScaledVector(u,-f.y).multiplyScalar(r),v.copy(u).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(r),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let E=0,C=b.length;E<C;++E){let e=b[E],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)y(i[n+0],i[n+1],i[n+2])}let x=new gl,w=new gl,_=new gl,S=new gl;function A(e){_.fromArray(r,3*e),S.copy(_);let t=l[e];x.copy(t),x.sub(_.multiplyScalar(_.dot(t))).normalize(),w.crossVectors(S,t);let i=w.dot(c[e])<0?-1:1;o[4*e]=x.x,o[4*e+1]=x.y,o[4*e+2]=x.z,o[4*e+3]=i}for(let E=0,C=b.length;E<C;++E){let e=b[E],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)A(i[n+0]),A(i[n+1]),A(i[n+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new kc(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);let n=new gl,r=new gl,a=new gl,s=new gl,o=new gl,l=new gl,c=new gl,h=new gl;if(e)for(let d=0,u=e.count;d<u;d+=3){let u=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);n.fromBufferAttribute(t,u),r.fromBufferAttribute(t,p),a.fromBufferAttribute(t,f),c.subVectors(a,r),h.subVectors(n,r),c.cross(h),s.fromBufferAttribute(i,u),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,f),s.add(c),o.add(c),l.add(c),i.setXYZ(u,s.x,s.y,s.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,d=t.count;e<d;e+=3)n.fromBufferAttribute(t,e+0),r.fromBufferAttribute(t,e+1),a.fromBufferAttribute(t,e+2),c.subVectors(a,r),h.subVectors(n,r),c.cross(h),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Hc.fromBufferAttribute(e,t),Hc.normalize(),e.setXYZ(t,Hc.x,Hc.y,Hc.z)}toNonIndexed(){function e(e,t){let i=e.array,n=e.itemSize,r=e.normalized,a=new i.constructor(t.length*n),s=0,o=0;for(let l=0,c=t.length;l<c;l++){s=e.isInterleavedBufferAttribute?t[l]*e.data.stride+e.offset:t[l]*n;for(let e=0;e<n;e++)a[o++]=i[s++]}return new kc(a,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new Wc,i=this.index.array,n=this.attributes;for(let s in n){let r=e(n[s],i);t.setAttribute(s,r)}let r=this.morphAttributes;for(let s in r){let n=[],a=r[s];for(let t=0,r=a.length;t<r;t++){let r=e(a[t],i);n.push(r)}t.morphAttributes[s]=n}t.morphTargetsRelative=this.morphTargetsRelative;let a=this.groups;for(let s=0,o=a.length;s<o;s++){let e=a[s];t.addGroup(e.start,e.count,e.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};let t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let i=this.attributes;for(let o in i){let t=i[o];e.data.attributes[o]=t.toJSON(e.data)}let n={},r=!1;for(let o in this.morphAttributes){let t=this.morphAttributes[o],i=[];for(let n=0,r=t.length;n<r;n++){let r=t[n];i.push(r.toJSON(e.data))}i.length>0&&(n[o]=i,r=!0)}r&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);let a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));let s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let i=e.index;null!==i&&this.setIndex(i.clone(t));let n=e.attributes;for(let l in n){let e=n[l];this.setAttribute(l,e.clone(t))}let r=e.morphAttributes;for(let l in r){let e=[],i=r[l];for(let n=0,r=i.length;n<r;n++)e.push(i[n].clone(t));this.morphAttributes[l]=e}this.morphTargetsRelative=e.morphTargetsRelative;let a=e.groups;for(let l=0,c=a.length;l<c;l++){let e=a[l];this.addGroup(e.start,e.count,e.materialIndex)}let s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());let o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},qc=new ql,Xc=new Wl,Yc=new Bl,Qc=new gl,Kc=new gl,Zc=new gl,Jc=new gl,$c=new gl,eh=new jo,th=new jo,ih=new jo,nh=new gl,rh=new gl,ah=class extends vc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wc,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Rc;super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){let i=this.geometry,n=i.attributes.position,r=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(n,e);let s=this.morphTargetInfluences;if(r&&s){$c.set(0,0,0);for(let i=0,n=r.length;i<n;i++){let n=s[i],o=r[i];0!==n&&(Jc.fromBufferAttribute(o,e),a?$c.addScaledVector(Jc,n):$c.addScaledVector(Jc.sub(t),n))}t.add($c)}return this.isSkinnedMesh&&this.boneTransform(e,t),t}raycast(e,t){let i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n||(null===i.boundingSphere&&i.computeBoundingSphere(),Yc.copy(i.boundingSphere),Yc.applyMatrix4(r),!1===e.ray.intersectsSphere(Yc))||(qc.copy(r).invert(),Xc.copy(e.ray).applyMatrix4(qc),null!==i.boundingBox&&!1===Xc.intersectsBox(i.boundingBox)))return;let a,s=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,h=i.groups,d=i.drawRange;if(null!==s)if(Array.isArray(n))for(let u=0,p=h.length;u<p;u++){let i=h[u],r=n[i.materialIndex];for(let n=Math.max(i.start,d.start),o=Math.min(s.count,Math.min(i.start+i.count,d.start+d.count));n<o;n+=3){let o=s.getX(n),h=s.getX(n+1),d=s.getX(n+2);a=sh(this,r,e,Xc,l,c,o,h,d),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=i.materialIndex,t.push(a))}}else{for(let i=Math.max(0,d.start),r=Math.min(s.count,d.start+d.count);i<r;i+=3){let r=s.getX(i),o=s.getX(i+1),h=s.getX(i+2);a=sh(this,n,e,Xc,l,c,r,o,h),a&&(a.faceIndex=Math.floor(i/3),t.push(a))}}else if(void 0!==o)if(Array.isArray(n))for(let u=0,p=h.length;u<p;u++){let i=h[u],r=n[i.materialIndex];for(let n=Math.max(i.start,d.start),s=Math.min(o.count,Math.min(i.start+i.count,d.start+d.count));n<s;n+=3){a=sh(this,r,e,Xc,l,c,n,n+1,n+2),a&&(a.faceIndex=Math.floor(n/3),a.face.materialIndex=i.materialIndex,t.push(a))}}else{for(let i=Math.max(0,d.start),r=Math.min(o.count,d.start+d.count);i<r;i+=3){a=sh(this,n,e,Xc,l,c,i,i+1,i+2),a&&(a.faceIndex=Math.floor(i/3),t.push(a))}}}};function sh(e,t,i,n,r,a,s,o,l){e.getVertexPosition(s,Qc),e.getVertexPosition(o,Kc),e.getVertexPosition(l,Zc);let c=function(e,t,i,n,r,a,s,o){let l;if(l=t.side===sa?n.intersectTriangle(s,a,r,!0,o):n.intersectTriangle(r,a,s,t.side===aa,o),null===l)return null;rh.copy(o),rh.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(rh);return c<i.near||c>i.far?null:{distance:c,point:rh.clone(),object:e}}(e,t,i,n,Qc,Kc,Zc,nh);if(c){r&&(eh.fromBufferAttribute(r,s),th.fromBufferAttribute(r,o),ih.fromBufferAttribute(r,l),c.uv=Pc.getUV(nh,Qc,Kc,Zc,eh,th,ih,new jo)),a&&(eh.fromBufferAttribute(a,s),th.fromBufferAttribute(a,o),ih.fromBufferAttribute(a,l),c.uv2=Pc.getUV(nh,Qc,Kc,Zc,eh,th,ih,new jo));let e={a:s,b:o,c:l,normal:new gl,materialIndex:0};Pc.getNormal(Qc,Kc,Zc,e.normal),c.face=e}return c}var oh=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};let s=this;n=Math.floor(n),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],h=[],d=0,u=0;function p(e,t,i,n,r,a,p,f,m,g,v){let y=a/m,b=p/g,x=a/2,w=p/2,_=f/2,S=m+1,A=g+1,E=0,C=0,M=new gl;for(let s=0;s<A;s++){let a=s*b-w;for(let o=0;o<S;o++){let d=o*y-x;M[e]=d*n,M[t]=a*r,M[i]=_,l.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[i]=f>0?1:-1,c.push(M.x,M.y,M.z),h.push(o/m),h.push(1-s/g),E+=1}}for(let s=0;s<g;s++)for(let e=0;e<m;e++){let t=d+e+S*s,i=d+e+S*(s+1),n=d+(e+1)+S*(s+1),r=d+(e+1)+S*s;o.push(t,i,r),o.push(i,n,r),C+=6}s.addGroup(u,C,v),u+=C,d+=E}p("z","y","x",-1,-1,i,t,e,a,r,0),p("z","y","x",1,-1,i,t,-e,a,r,1),p("x","z","y",1,1,e,i,t,n,a,2),p("x","z","y",1,-1,e,i,-t,n,a,3),p("x","y","z",1,-1,e,t,i,n,r,4),p("x","y","z",-1,-1,e,t,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Bc(l,3)),this.setAttribute("normal",new Bc(c,3)),this.setAttribute("uv",new Bc(h,2))}static fromJSON(e){return new oh(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function lh(e){let t={};for(let i in e){t[i]={};for(let n in e[i]){let r=e[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?t[i][n]=r.clone():Array.isArray(r)?t[i][n]=r.slice():t[i][n]=r}}return t}function ch(e){let t={};for(let i=0;i<e.length;i++){let n=lh(e[i]);for(let e in n)t[e]=n[e]}return t}function hh(e){return null===e.getRenderTarget()&&e.outputEncoding===mo?xo:wo}var dh={clone:lh,merge:ch},uh=class extends Dc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=lh(e.uniforms),this.uniformsGroups=function(e){let t=[];for(let i=0;i<e.length;i++)t.push(e[i].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let n in this.uniforms){let i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let i={};for(let n in this.extensions)!0===this.extensions[n]&&(i[n]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}},ph=class extends vc{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ql,this.projectionMatrix=new ql,this.projectionMatrixInverse=new ql}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}},fh=class extends ph{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=2*Do*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(.5*To*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Do*Math.atan(Math.tan(.5*To*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,r,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(.5*To*this.fov)/this.zoom,i=2*t,n=this.aspect*i,r=-.5*n,a=this.view;if(null!==this.view&&this.view.enabled){let e=a.fullWidth,s=a.fullHeight;r+=a.offsetX*n/e,t-=a.offsetY*i/s,n*=a.width/e,i*=a.height/s}let s=this.filmOffset;0!==s&&(r+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}},mh=-90,gh=class extends vc{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;let n=new fh(mh,1,e,t);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(1,0,0),this.add(n);let r=new fh(mh,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(-1,0,0),this.add(r);let a=new fh(mh,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(0,1,0),this.add(a);let s=new fh(mh,1,e,t);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(0,-1,0),this.add(s);let o=new fh(mh,1,e,t);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new fh(mh,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();let i=this.renderTarget,[n,r,a,s,o,l]=this.children,c=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=ja,e.xr.enabled=!1;let u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,r),e.setRenderTarget(i,2),e.render(t,a),e.setRenderTarget(i,3),e.render(t,s),e.setRenderTarget(i,4),e.render(t,o),i.texture.generateMipmaps=u,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=d,i.texture.needsPMREMUpdate=!0}},vh=class extends hl{constructor(e,t,i,n,r,a,s,o,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:Xa,i,n,r,a,s,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}},yh=class extends ul{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,e,t),this.isWebGLCubeRenderTarget=!0;let i={width:e,height:e,depth:1},n=[i,i,i,i,i,i];this.texture=new vh(n,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:rs}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let i={tEquirect:{value:null}},n="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new oh(5,5,5),s=new uh({name:"CubemapFromEquirect",uniforms:lh(i),vertexShader:n,fragmentShader:r,side:sa,blending:la});s.uniforms.tEquirect.value=t;let o=new ah(a,s),l=t.minFilter;return t.minFilter===ss&&(t.minFilter=rs),new gh(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,n){let r=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,n);e.setRenderTarget(r)}},bh=new gl,xh=new gl,wh=new Vo,_h=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl(1,0,0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){let n=bh.subVectors(i,t).cross(xh.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let i=e.delta(bh),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;let r=-(e.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:t.copy(i).multiplyScalar(r).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let i=t||wh.getNormalMatrix(e),n=this.coplanarPoint(bh).applyMatrix4(e),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}},Sh=new Bl,Ah=new gl,Eh=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _h,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _h,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new _h,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new _h,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new _h,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new _h;this.planes=[e,t,i,n,r,a]}set(e,t,i,n,r,a){let s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this}copy(e){let t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){let t=this.planes,i=e.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],c=i[6],h=i[7],d=i[8],u=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-n,h-o,f-d,y-m).normalize(),t[1].setComponents(s+n,h+o,f+d,y+m).normalize(),t[2].setComponents(s+r,h+l,f+u,y+g).normalize(),t[3].setComponents(s-r,h-l,f-u,y-g).normalize(),t[4].setComponents(s-a,h-c,f-p,y-v).normalize(),t[5].setComponents(s+a,h+c,f+p,y+v).normalize(),this}intersectsObject(e){let t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Sh.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Sh)}intersectsSprite(e){return Sh.center.set(0,0,0),Sh.radius=.7071067811865476,Sh.applyMatrix4(e.matrixWorld),this.intersectsSphere(Sh)}intersectsSphere(e){let t=this.planes,i=e.center,n=-e.radius;for(let r=0;r<6;r++)if(t[r].distanceToPoint(i)<n)return!1;return!0}intersectsBox(e){let t=this.planes;for(let i=0;i<6;i++){let n=t[i];if(Ah.x=n.normal.x>0?e.max.x:e.min.x,Ah.y=n.normal.y>0?e.max.y:e.min.y,Ah.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(Ah)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}};function Ch(){let e=null,t=!1,i=null,n=null;function r(t,a){i(t,a),n=e.requestAnimationFrame(r)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(r),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function Mh(e,t){let i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);let i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,r){if(t.isGLBufferAttribute){let e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);let a=n.get(t);void 0===a?n.set(t,function(t,n){let r,a=t.array,s=t.usage,o=e.createBuffer();if(e.bindBuffer(n,o),e.bufferData(n,a,s),t.onUploadCallback(),a instanceof Float32Array)r=5126;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");r=5131}else r=5123;else if(a instanceof Int16Array)r=5122;else if(a instanceof Uint32Array)r=5125;else if(a instanceof Int32Array)r=5124;else if(a instanceof Int8Array)r=5120;else if(a instanceof Uint8Array)r=5121;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);r=5121}return{buffer:o,type:r,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,r)):a.version<t.version&&(function(t,n,r){let a=n.array,s=n.updateRange;e.bindBuffer(r,t),-1===s.count?e.bufferSubData(r,0,a):(i?e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):e.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1),n.onUploadCallback()}(a.buffer,t,r),a.version=t.version)}}}var Ph=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};let r=e/2,a=t/2,s=Math.floor(i),o=Math.floor(n),l=s+1,c=o+1,h=e/s,d=t/o,u=[],p=[],f=[],m=[];for(let g=0;g<c;g++){let e=g*d-a;for(let t=0;t<l;t++){let i=t*h-r;p.push(i,-e,0),f.push(0,0,1),m.push(t/s),m.push(1-g/o)}}for(let g=0;g<o;g++)for(let e=0;e<s;e++){let t=e+l*g,i=e+l*(g+1),n=e+1+l*(g+1),r=e+1+l*g;u.push(t,i,r),u.push(i,n,r)}this.setIndex(u),this.setAttribute("position",new Bc(p,3)),this.setAttribute("normal",new Bc(f,3)),this.setAttribute("uv",new Bc(m,2))}static fromJSON(e){return new Ph(e.width,e.height,e.widthSegments,e.heightSegments)}},Th={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Dh={common:{diffuse:{value:new rl(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vo},uv2Transform:{value:new Vo},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new jo(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new rl(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new rl(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vo}},sprite:{diffuse:{value:new rl(16777215)},opacity:{value:1},center:{value:new jo(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vo}}},Rh={basic:{uniforms:ch([Dh.common,Dh.specularmap,Dh.envmap,Dh.aomap,Dh.lightmap,Dh.fog]),vertexShader:Th.meshbasic_vert,fragmentShader:Th.meshbasic_frag},lambert:{uniforms:ch([Dh.common,Dh.specularmap,Dh.envmap,Dh.aomap,Dh.lightmap,Dh.emissivemap,Dh.bumpmap,Dh.normalmap,Dh.displacementmap,Dh.fog,Dh.lights,{emissive:{value:new rl(0)}}]),vertexShader:Th.meshlambert_vert,fragmentShader:Th.meshlambert_frag},phong:{uniforms:ch([Dh.common,Dh.specularmap,Dh.envmap,Dh.aomap,Dh.lightmap,Dh.emissivemap,Dh.bumpmap,Dh.normalmap,Dh.displacementmap,Dh.fog,Dh.lights,{emissive:{value:new rl(0)},specular:{value:new rl(1118481)},shininess:{value:30}}]),vertexShader:Th.meshphong_vert,fragmentShader:Th.meshphong_frag},standard:{uniforms:ch([Dh.common,Dh.envmap,Dh.aomap,Dh.lightmap,Dh.emissivemap,Dh.bumpmap,Dh.normalmap,Dh.displacementmap,Dh.roughnessmap,Dh.metalnessmap,Dh.fog,Dh.lights,{emissive:{value:new rl(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Th.meshphysical_vert,fragmentShader:Th.meshphysical_frag},toon:{uniforms:ch([Dh.common,Dh.aomap,Dh.lightmap,Dh.emissivemap,Dh.bumpmap,Dh.normalmap,Dh.displacementmap,Dh.gradientmap,Dh.fog,Dh.lights,{emissive:{value:new rl(0)}}]),vertexShader:Th.meshtoon_vert,fragmentShader:Th.meshtoon_frag},matcap:{uniforms:ch([Dh.common,Dh.bumpmap,Dh.normalmap,Dh.displacementmap,Dh.fog,{matcap:{value:null}}]),vertexShader:Th.meshmatcap_vert,fragmentShader:Th.meshmatcap_frag},points:{uniforms:ch([Dh.points,Dh.fog]),vertexShader:Th.points_vert,fragmentShader:Th.points_frag},dashed:{uniforms:ch([Dh.common,Dh.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Th.linedashed_vert,fragmentShader:Th.linedashed_frag},depth:{uniforms:ch([Dh.common,Dh.displacementmap]),vertexShader:Th.depth_vert,fragmentShader:Th.depth_frag},normal:{uniforms:ch([Dh.common,Dh.bumpmap,Dh.normalmap,Dh.displacementmap,{opacity:{value:1}}]),vertexShader:Th.meshnormal_vert,fragmentShader:Th.meshnormal_frag},sprite:{uniforms:ch([Dh.sprite,Dh.fog]),vertexShader:Th.sprite_vert,fragmentShader:Th.sprite_frag},background:{uniforms:{uvTransform:{value:new Vo},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Th.background_vert,fragmentShader:Th.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:Th.backgroundCube_vert,fragmentShader:Th.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Th.cube_vert,fragmentShader:Th.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Th.equirect_vert,fragmentShader:Th.equirect_frag},distanceRGBA:{uniforms:ch([Dh.common,Dh.displacementmap,{referencePosition:{value:new gl},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Th.distanceRGBA_vert,fragmentShader:Th.distanceRGBA_frag},shadow:{uniforms:ch([Dh.lights,Dh.fog,{color:{value:new rl(0)},opacity:{value:1}}]),vertexShader:Th.shadow_vert,fragmentShader:Th.shadow_frag}};Rh.physical={uniforms:ch([Rh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new jo(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new rl(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new jo},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new rl(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new rl(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Th.meshphysical_vert,fragmentShader:Th.meshphysical_frag};var Oh={r:0,b:0,g:0};function Ih(e,t,i,n,r,a,s){let o,l,c=new rl(0),h=!0===a?0:1,d=null,u=0,p=null;function f(t,i){t.getRGB(Oh,hh(e)),n.buffers.color.setClear(Oh.r,Oh.g,Oh.b,i,s)}return{getClearColor:function(){return c},setClearColor:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;c.set(e),h=t,f(c,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,f(c,h)},render:function(n,a){let s=!1,m=!0===a.isScene?a.background:null;m&&m.isTexture&&(m=(a.backgroundBlurriness>0?i:t).get(m));let g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?f(c,h):m&&m.isColor&&(f(m,1),s=!0),(e.autoClear||s)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===Za)?(void 0===l&&(l=new ah(new oh(1,1,1),new uh({name:"BackgroundCubeMaterial",uniforms:lh(Rh.backgroundCube.uniforms),vertexShader:Rh.backgroundCube.vertexShader,fragmentShader:Rh.backgroundCube.fragmentShader,side:sa,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=a.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,l.material.toneMapped=m.encoding!==mo,(d!==m||u!==m.version||p!==e.toneMapping)&&(l.material.needsUpdate=!0,d=m,u=m.version,p=e.toneMapping),l.layers.enableAll(),n.unshift(l,l.geometry,l.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new ah(new Ph(2,2),new uh({name:"BackgroundMaterial",uniforms:lh(Rh.background.uniforms),vertexShader:Rh.background.vertexShader,fragmentShader:Rh.background.fragmentShader,side:aa,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=m,o.material.uniforms.backgroundIntensity.value=a.backgroundIntensity,o.material.toneMapped=m.encoding!==mo,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),(d!==m||u!==m.version||p!==e.toneMapping)&&(o.material.needsUpdate=!0,d=m,u=m.version,p=e.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function kh(e,t,i,n){let r=e.getParameter(34921),a=n.isWebGL2?null:t.get("OES_vertex_array_object"),s=n.isWebGL2||null!==a,o={},l=p(null),c=l,h=!1;function d(t){return n.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function u(t){return n.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function p(e){let t=[],i=[],n=[];for(let a=0;a<r;a++)t[a]=0,i[a]=0,n[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function f(){let e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){g(e,0)}function g(i,r){let a=c.newAttributes,s=c.enabledAttributes,o=c.attributeDivisors;a[i]=1,0===s[i]&&(e.enableVertexAttribArray(i),s[i]=1),o[i]!==r&&((n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r)}function v(){let t=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function y(t,i,r,a,s,o){!0!==n.isWebGL2||5124!==r&&5125!==r?e.vertexAttribPointer(t,i,r,a,s,o):e.vertexAttribIPointer(t,i,r,s,o)}function b(){x(),h=!0,c!==l&&(c=l,d(c.object))}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,b,x){let w=!1;if(s){let t=function(t,i,r){let s=!0===r.wireframe,l=o[t.id];void 0===l&&(l={},o[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[s];return void 0===h&&(h=p(n.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),c[s]=h),h}(b,u,l);c!==t&&(c=t,d(c.object)),w=function(e,t,i,n){let r=c.attributes,a=t.attributes,s=0,o=i.getAttributes();for(let l in o)if(o[l].location>=0){let t=r[l],i=a[l];if(void 0===i&&("instanceMatrix"===l&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(i=e.instanceColor)),void 0===t||t.attribute!==i||i&&t.data!==i.data)return!0;s++}return c.attributesNum!==s||c.index!==n}(r,b,u,x),w&&function(e,t,i,n){let r={},a=t.attributes,s=0,o=i.getAttributes();for(let l in o)if(o[l].location>=0){let t=a[l];void 0===t&&("instanceMatrix"===l&&e.instanceMatrix&&(t=e.instanceMatrix),"instanceColor"===l&&e.instanceColor&&(t=e.instanceColor));let i={};i.attribute=t,t&&t.data&&(i.data=t.data),r[l]=i,s++}c.attributes=r,c.attributesNum=s,c.index=n}(r,b,u,x)}else{let e=!0===l.wireframe;(c.geometry!==b.id||c.program!==u.id||c.wireframe!==e)&&(c.geometry=b.id,c.program=u.id,c.wireframe=e,w=!0)}null!==x&&i.update(x,34963),(w||h)&&(h=!1,function(r,a,s,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;f();let l=o.attributes,c=s.getAttributes(),h=a.defaultAttributeValues;for(let t in c){let n=c[t];if(n.location>=0){let a=l[t];if(void 0===a&&("instanceMatrix"===t&&r.instanceMatrix&&(a=r.instanceMatrix),"instanceColor"===t&&r.instanceColor&&(a=r.instanceColor)),void 0!==a){let t=a.normalized,s=a.itemSize,l=i.get(a);if(void 0===l)continue;let c=l.buffer,h=l.type,d=l.bytesPerElement;if(a.isInterleavedBufferAttribute){let i=a.data,l=i.stride,u=a.offset;if(i.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)g(n.location+e,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)y(n.location+e,s/n.locationSize,h,t,l*d,(u+s/n.locationSize*e)*d)}else{if(a.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)g(n.location+e,a.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)y(n.location+e,s/n.locationSize,h,t,s*d,s/n.locationSize*e*d)}}else if(void 0!==h){let i=h[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n.location,i);break;case 3:e.vertexAttrib3fv(n.location,i);break;case 4:e.vertexAttrib4fv(n.location,i);break;default:e.vertexAttrib1fv(n.location,i)}}}}v()}(r,l,u,b),null!==x&&e.bindBuffer(34963,i.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){b();for(let e in o){let t=o[e];for(let e in t){let i=t[e];for(let e in i)u(i[e].object),delete i[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;let t=o[e.id];for(let i in t){let e=t[i];for(let t in e)u(e[t].object),delete e[t];delete t[i]}delete o[e.id]},releaseStatesOfProgram:function(e){for(let t in o){let i=o[t];if(void 0===i[e.id])continue;let n=i[e.id];for(let e in n)u(n[e].object),delete n[e];delete i[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:v}}function Lh(e,t,i,n){let r,a=n.isWebGL2;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r,1)},this.renderInstances=function(n,s,o){if(0===o)return;let l,c;if(a)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,n,s,o),i.update(s,r,o)}}function Fh(e,t,i){let n;function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext,s=void 0!==i.precision?i.precision:"highp",o=r(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);let l=a||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=e.getParameter(34930),d=e.getParameter(35660),u=e.getParameter(3379),p=e.getParameter(34076),f=e.getParameter(34921),m=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=d>0,b=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){let i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:d,maxTextureSize:u,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:a?e.getParameter(36183):0}}function Bh(e){let t=this,i=null,n=0,r=!1,a=!1,s=new _h,o=new Vo,l={value:null,needsUpdate:!1};function c(e,i,n,r){let a=null!==e?e.length:0,c=null;if(0!==a){if(c=l.value,!0!==r||null===c){let t=n+4*a,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<t)&&(c=new Float32Array(t));for(let i=0,l=n;i!==a;++i,l+=4)s.copy(e[i]).applyMatrix4(r,o),s.normal.toArray(c,l),c[l+3]=s.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){let i=0!==e.length||t||0!==n||r;return r=t,n=e.length,i},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1},this.setGlobalState=function(e,t){i=c(e,t,0)},this.setState=function(s,o,h){let d=s.clippingPlanes,u=s.clipIntersection,p=s.clipShadows,f=e.get(s);if(!r||null===d||0===d.length||a&&!p)a?c(null):(l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0);else{let e=a?0:n,t=4*e,r=f.clippingState||null;l.value=r,r=c(d,o,t,h);for(let n=0;n!==t;++n)r[n]=i[n];f.clippingState=r,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function Nh(e){let t=new WeakMap;function i(e,t){return t===Qa?e.mapping=Xa:t===Ka&&(e.mapping=Ya),e}function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){let a=r.mapping;if(a===Qa||a===Ka){if(t.has(r)){return i(t.get(r).texture,r.mapping)}{let a=r.image;if(a&&a.height>0){let s=new yh(a.height/2);return s.fromEquirectangularTexture(e,r),t.set(r,s),r.addEventListener("dispose",n),i(s.texture,r.mapping)}return null}}}return r},dispose:function(){t=new WeakMap}}}var zh=class extends ph{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=r,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2,r=i-e,a=i+e,s=n+t,o=n-t;if(null!==this.view&&this.view.enabled){let e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=e*this.view.offsetX,a=r+e*this.view.width,s-=t*this.view.offsetY,o=s-t*this.view.height}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}},Uh=[.125,.215,.35,.446,.526,.582],jh=20,Vh=new zh,Gh=new rl,Hh=null,Wh=(1+Math.sqrt(5))/2,qh=1/Wh,Xh=[new gl(1,1,1),new gl(-1,1,1),new gl(1,1,-1),new gl(-1,1,-1),new gl(0,Wh,qh),new gl(0,Wh,-qh),new gl(qh,0,Wh),new gl(-qh,0,Wh),new gl(Wh,qh,0),new gl(-Wh,qh,0)],Yh=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Hh=this._renderer.getRenderTarget(),this._setSize(256);let r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(e,i,n,r),t>0&&this._blur(r,0,0,t),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}fromCubemap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Jh(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Zh(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Hh),e.scissorTest=!1,Kh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Xa||e.mapping===Ya?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Hh=this._renderer.getRenderTarget();let i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:rs,minFilter:rs,generateMipmaps:!1,type:fs,format:bs,encoding:fo,depthBuffer:!1},n=Qh(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Qh(e,t,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){let t=[],i=[],n=[],r=e,a=e-4+1+Uh.length;for(let s=0;s<a;s++){let a=Math.pow(2,r);i.push(a);let o=1/a;s>e-4?o=Uh[s-e+4-1]:0===s&&(o=0),n.push(o);let l=1/(a-2),c=-l,h=1+l,d=[c,c,h,c,h,h,c,c,h,h,c,h],u=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*u),y=new Float32Array(m*p*u),b=new Float32Array(g*p*u);for(let e=0;e<u;e++){let t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];v.set(n,f*p*e),y.set(d,m*p*e);let r=[e,e,e,e,e,e];b.set(r,g*p*e)}let x=new Wc;x.setAttribute("position",new kc(v,f)),x.setAttribute("uv",new kc(y,m)),x.setAttribute("faceIndex",new kc(b,g)),t.push(x),r>4&&r--}return{lodPlanes:t,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(e,t,i){let n=new Float32Array(jh),r=new gl(0,1,0);return new uh({name:"SphericalGaussianBlur",defines:{n:jh,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:la,depthTest:!1,depthWrite:!1})}(n,e,t)}return n}_compileMaterial(e){let t=new ah(this._lodPlanes[0],e);this._renderer.compile(t,Vh)}_sceneToCubeUV(e,t,i,n){let r=new fh(90,1,t,i),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Gh),o.toneMapping=ja,o.autoClear=!1;let h=new Rc({name:"PMREM.Background",side:sa,depthWrite:!1,depthTest:!1}),d=new ah(new oh,h),u=!1,p=e.background;p?p.isColor&&(h.color.copy(p),e.background=null,u=!0):(h.color.copy(Gh),u=!0);for(let f=0;f<6;f++){let t=f%3;0===t?(r.up.set(0,a[f],0),r.lookAt(s[f],0,0)):1===t?(r.up.set(0,0,a[f]),r.lookAt(0,s[f],0)):(r.up.set(0,a[f],0),r.lookAt(0,0,s[f]));let i=this._cubeSize;Kh(n,t*i,f>2?i:0,i,i),o.setRenderTarget(n),u&&o.render(d,r),o.render(e,r)}d.geometry.dispose(),d.material.dispose(),o.toneMapping=c,o.autoClear=l,e.background=p}_textureToCubeUV(e,t){let i=this._renderer,n=e.mapping===Xa||e.mapping===Ya;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Jh()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Zh());let r=n?this._cubemapMaterial:this._equirectMaterial,a=new ah(this._lodPlanes[0],r);r.uniforms.envMap.value=e;let s=this._cubeSize;Kh(t,0,0,3*s,2*s),i.setRenderTarget(t),i.render(a,Vh)}_applyPMREM(e){let t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let n=1;n<this._lodPlanes.length;n++){let t=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),i=Xh[(n-1)%Xh.length];this._blur(e,n-1,n,t,i)}t.autoClear=i}_blur(e,t,i,n,r){let a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,n,"latitudinal",r),this._halfBlur(a,e,i,i,n,"longitudinal",r)}_halfBlur(e,t,i,n,r,a,s){let o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");let c=new ah(this._lodPlanes[n],l),h=l.uniforms,d=this._sizeLods[i]-1,u=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,p=r/u,f=isFinite(r)?1+Math.floor(3*p):jh;f>jh&&console.warn("sigmaRadians, ".concat(r,", is too large and will clip, as it requested ").concat(f," samples when the maximum is set to ").concat(jh));let m=[],g=0;for(let b=0;b<jh;++b){let e=b/p,t=Math.exp(-e*e/2);m.push(t),0===b?g+=t:b<f&&(g+=2*t)}for(let b=0;b<m.length;b++)m[b]=m[b]/g;h.envMap.value=e.texture,h.samples.value=f,h.weights.value=m,h.latitudinal.value="latitudinal"===a,s&&(h.poleAxis.value=s);let{_lodMax:v}=this;h.dTheta.value=u,h.mipInt.value=v-i;let y=this._sizeLods[n];Kh(t,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(c,Vh)}};function Qh(e,t,i){let n=new ul(e,t,i);return n.texture.mapping=Za,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Kh(e,t,i,n,r){e.viewport.set(t,i,n,r),e.scissor.set(t,i,n,r)}function Zh(){return new uh({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:la,depthTest:!1,depthWrite:!1})}function Jh(){return new uh({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:la,depthTest:!1,depthWrite:!1})}function $h(e){let t=new WeakMap,i=null;function n(e){let i=e.target;i.removeEventListener("dispose",n);let r=t.get(i);void 0!==r&&(t.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){let a=r.mapping,s=a===Qa||a===Ka,o=a===Xa||a===Ya;if(s||o){if(r.isRenderTargetTexture&&!0===r.needsPMREMUpdate){r.needsPMREMUpdate=!1;let n=t.get(r);return null===i&&(i=new Yh(e)),n=s?i.fromEquirectangular(r,n):i.fromCubemap(r,n),t.set(r,n),n.texture}if(t.has(r))return t.get(r).texture;{let a=r.image;if(s&&a&&a.height>0||o&&a&&function(e){let t=0,i=6;for(let n=0;n<i;n++)void 0!==e[n]&&t++;return t===i}(a)){null===i&&(i=new Yh(e));let a=s?i.fromEquirectangular(r):i.fromCubemap(r);return t.set(r,a),r.addEventListener("dispose",n),a.texture}return null}}}return r},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function ed(e){let t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(e){let t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function td(e,t,i,n){let r={},a=new WeakMap;function s(e){let o=e.target;null!==o.index&&t.remove(o.index);for(let i in o.attributes)t.remove(o.attributes[i]);o.removeEventListener("dispose",s),delete r[o.id];let l=a.get(o);l&&(t.remove(l),a.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(e){let i=[],n=e.index,r=e.attributes.position,s=0;if(null!==n){let e=n.array;s=n.version;for(let t=0,n=e.length;t<n;t+=3){let n=e[t+0],r=e[t+1],a=e[t+2];i.push(n,r,r,a,a,n)}}else{let e=r.array;s=r.version;for(let t=0,n=e.length/3-1;t<n;t+=3){let e=t+0,n=t+1,r=t+2;i.push(e,n,n,r,r,e)}}let o=new(Ho(i)?Fc:Lc)(i,1);o.version=s;let l=a.get(e);l&&t.remove(l),a.set(e,o)}return{get:function(e,t){return!0===r[t.id]||(t.addEventListener("dispose",s),r[t.id]=!0,i.memory.geometries++),t},update:function(e){let i=e.attributes;for(let r in i)t.update(i[r],34962);let n=e.morphAttributes;for(let r in n){let e=n[r];for(let i=0,n=e.length;i<n;i++)t.update(e[i],34962)}},getWireframeAttribute:function(e){let t=a.get(e);if(t){let i=e.index;null!==i&&t.version<i.version&&o(e)}else o(e);return a.get(e)}}}function id(e,t,i,n){let r,a,s,o=n.isWebGL2;this.setMode=function(e){r=e},this.setIndex=function(e){a=e.type,s=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,a,t*s),i.update(n,r,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,d;if(o)h=e,d="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[d](r,l,a,n*s,c),i.update(l,r,c)}}function nd(e){let t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function rd(e,t){return e[0]-t[0]}function ad(e,t){return Math.abs(t[1])-Math.abs(e[1])}function sd(e,t,i){let n={},r=new Float32Array(8),a=new WeakMap,s=new dl,o=[];for(let l=0;l<8;l++)o[l]=[l,0];return{update:function(l,c,h,d){let u=l.morphTargetInfluences;if(!0===t.isWebGL2){let n=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,r=void 0!==n?n.length:0,o=a.get(c);if(void 0===o||o.count!==r){let e=function(){v.dispose(),a.delete(c),c.removeEventListener("dispose",e)};void 0!==o&&o.texture.dispose();let i=void 0!==c.morphAttributes.position,n=void 0!==c.morphAttributes.normal,l=void 0!==c.morphAttributes.color,h=c.morphAttributes.position||[],d=c.morphAttributes.normal||[],u=c.morphAttributes.color||[],p=0;!0===i&&(p=1),!0===n&&(p=2),!0===l&&(p=3);let f=c.attributes.position.count*p,m=1;f>t.maxTextureSize&&(m=Math.ceil(f/t.maxTextureSize),f=t.maxTextureSize);let g=new Float32Array(f*m*4*r),v=new pl(g,f,m,r);v.type=ps,v.needsUpdate=!0;let y=4*p;for(let t=0;t<r;t++){let e=h[t],r=d[t],a=u[t],o=f*m*4*t;for(let t=0;t<e.count;t++){let c=t*y;!0===i&&(s.fromBufferAttribute(e,t),g[o+c+0]=s.x,g[o+c+1]=s.y,g[o+c+2]=s.z,g[o+c+3]=0),!0===n&&(s.fromBufferAttribute(r,t),g[o+c+4]=s.x,g[o+c+5]=s.y,g[o+c+6]=s.z,g[o+c+7]=0),!0===l&&(s.fromBufferAttribute(a,t),g[o+c+8]=s.x,g[o+c+9]=s.y,g[o+c+10]=s.z,g[o+c+11]=4===a.itemSize?s.w:1)}}o={count:r,texture:v,size:new jo(f,m)},a.set(c,o),c.addEventListener("dispose",e)}let l=0;for(let e=0;e<u.length;e++)l+=u[e];let h=c.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",h),d.getUniforms().setValue(e,"morphTargetInfluences",u),d.getUniforms().setValue(e,"morphTargetsTexture",o.texture,i),d.getUniforms().setValue(e,"morphTargetsTextureSize",o.size)}else{let t=void 0===u?0:u.length,i=n[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];n[c.id]=i}for(let e=0;e<t;e++){let t=i[e];t[0]=e,t[1]=u[e]}i.sort(ad);for(let e=0;e<8;e++)e<t&&i[e][1]?(o[e][0]=i[e][0],o[e][1]=i[e][1]):(o[e][0]=Number.MAX_SAFE_INTEGER,o[e][1]=0);o.sort(rd);let a=c.morphAttributes.position,s=c.morphAttributes.normal,l=0;for(let e=0;e<8;e++){let t=o[e],i=t[0],n=t[1];i!==Number.MAX_SAFE_INTEGER&&n?(a&&c.getAttribute("morphTarget"+e)!==a[i]&&c.setAttribute("morphTarget"+e,a[i]),s&&c.getAttribute("morphNormal"+e)!==s[i]&&c.setAttribute("morphNormal"+e,s[i]),r[e]=n,l+=n):(a&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),s&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),r[e]=0)}let h=c.morphTargetsRelative?1:1-l;d.getUniforms().setValue(e,"morphTargetBaseInfluence",h),d.getUniforms().setValue(e,"morphTargetInfluences",r)}}}}function od(e,t,i,n){let r=new WeakMap;function a(e){let t=e.target;t.removeEventListener("dispose",a),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){let s=n.render.frame,o=e.geometry,l=t.get(e,o);return r.get(l)!==s&&(t.update(l),r.set(l,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}var ld=new hl,cd=new pl,hd=new class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:n},this.magFilter=ts,this.minFilter=ts,this.wrapR=$a,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},dd=new vh,ud=[],pd=[],fd=new Float32Array(16),md=new Float32Array(9),gd=new Float32Array(4);function vd(e,t,i){let n=e[0];if(n<=0||n>0)return e;let r=t*i,a=ud[r];if(void 0===a&&(a=new Float32Array(r),ud[r]=a),0!==t){n.toArray(a,0);for(let n=1,r=0;n!==t;++n)r+=i,e[n].toArray(a,r)}return a}function yd(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function bd(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function xd(e,t){let i=pd[t];void 0===i&&(i=new Int32Array(t),pd[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function wd(e,t){let i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function _d(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(yd(i,t))return;e.uniform2fv(this.addr,t),bd(i,t)}}function Sd(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(yd(i,t))return;e.uniform3fv(this.addr,t),bd(i,t)}}function Ad(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(yd(i,t))return;e.uniform4fv(this.addr,t),bd(i,t)}}function Ed(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(yd(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),bd(i,t)}else{if(yd(i,n))return;gd.set(n),e.uniformMatrix2fv(this.addr,!1,gd),bd(i,n)}}function Cd(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(yd(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),bd(i,t)}else{if(yd(i,n))return;md.set(n),e.uniformMatrix3fv(this.addr,!1,md),bd(i,n)}}function Md(e,t){let i=this.cache,n=t.elements;if(void 0===n){if(yd(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),bd(i,t)}else{if(yd(i,n))return;fd.set(n),e.uniformMatrix4fv(this.addr,!1,fd),bd(i,n)}}function Pd(e,t){let i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function Td(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2i(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(yd(i,t))return;e.uniform2iv(this.addr,t),bd(i,t)}}function Dd(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3i(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(yd(i,t))return;e.uniform3iv(this.addr,t),bd(i,t)}}function Rd(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(yd(i,t))return;e.uniform4iv(this.addr,t),bd(i,t)}}function Od(e,t){let i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function Id(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2ui(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(yd(i,t))return;e.uniform2uiv(this.addr,t),bd(i,t)}}function kd(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3ui(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else{if(yd(i,t))return;e.uniform3uiv(this.addr,t),bd(i,t)}}function Ld(e,t){let i=this.cache;if(void 0!==t.x)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(yd(i,t))return;e.uniform4uiv(this.addr,t),bd(i,t)}}function Fd(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(t||ld,r)}function Bd(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(t||hd,r)}function Nd(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(t||dd,r)}function zd(e,t,i){let n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(e.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(t||cd,r)}function Ud(e,t){e.uniform1fv(this.addr,t)}function jd(e,t){let i=vd(t,this.size,2);e.uniform2fv(this.addr,i)}function Vd(e,t){let i=vd(t,this.size,3);e.uniform3fv(this.addr,i)}function Gd(e,t){let i=vd(t,this.size,4);e.uniform4fv(this.addr,i)}function Hd(e,t){let i=vd(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function Wd(e,t){let i=vd(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function qd(e,t){let i=vd(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Xd(e,t){e.uniform1iv(this.addr,t)}function Yd(e,t){e.uniform2iv(this.addr,t)}function Qd(e,t){e.uniform3iv(this.addr,t)}function Kd(e,t){e.uniform4iv(this.addr,t)}function Zd(e,t){e.uniform1uiv(this.addr,t)}function Jd(e,t){e.uniform2uiv(this.addr,t)}function $d(e,t){e.uniform3uiv(this.addr,t)}function eu(e,t){e.uniform4uiv(this.addr,t)}function tu(e,t,i){let n=this.cache,r=t.length,a=xd(i,r);yd(n,a)||(e.uniform1iv(this.addr,a),bd(n,a));for(let s=0;s!==r;++s)i.setTexture2D(t[s]||ld,a[s])}function iu(e,t,i){let n=this.cache,r=t.length,a=xd(i,r);yd(n,a)||(e.uniform1iv(this.addr,a),bd(n,a));for(let s=0;s!==r;++s)i.setTexture3D(t[s]||hd,a[s])}function nu(e,t,i){let n=this.cache,r=t.length,a=xd(i,r);yd(n,a)||(e.uniform1iv(this.addr,a),bd(n,a));for(let s=0;s!==r;++s)i.setTextureCube(t[s]||dd,a[s])}function ru(e,t,i){let n=this.cache,r=t.length,a=xd(i,r);yd(n,a)||(e.uniform1iv(this.addr,a),bd(n,a));for(let s=0;s!==r;++s)i.setTexture2DArray(t[s]||cd,a[s])}var au=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return wd;case 35664:return _d;case 35665:return Sd;case 35666:return Ad;case 35674:return Ed;case 35675:return Cd;case 35676:return Md;case 5124:case 35670:return Pd;case 35667:case 35671:return Td;case 35668:case 35672:return Dd;case 35669:case 35673:return Rd;case 5125:return Od;case 36294:return Id;case 36295:return kd;case 36296:return Ld;case 35678:case 36198:case 36298:case 36306:case 35682:return Fd;case 35679:case 36299:case 36307:return Bd;case 35680:case 36300:case 36308:case 36293:return Nd;case 36289:case 36303:case 36311:case 36292:return zd}}(t.type)}},su=class{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Ud;case 35664:return jd;case 35665:return Vd;case 35666:return Gd;case 35674:return Hd;case 35675:return Wd;case 35676:return qd;case 5124:case 35670:return Xd;case 35667:case 35671:return Yd;case 35668:case 35672:return Qd;case 35669:case 35673:return Kd;case 5125:return Zd;case 36294:return Jd;case 36295:return $d;case 36296:return eu;case 35678:case 36198:case 36298:case 36306:case 35682:return tu;case 35679:case 36299:case 36307:return iu;case 35680:case 36300:case 36308:case 36293:return nu;case 36289:case 36303:case 36311:case 36292:return ru}}(t.type)}},ou=class{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){let n=this.seq;for(let r=0,a=n.length;r!==a;++r){let a=n[r];a.setValue(e,t[a.id],i)}}},lu=/(\w+)(\])?(\[|\.)?/g;function cu(e,t){e.seq.push(t),e.map[t.id]=t}function hu(e,t,i){let n=e.name,r=n.length;for(lu.lastIndex=0;;){let a=lu.exec(n),s=lu.lastIndex,o=a[1],l="]"===a[2],c=a[3];if(l&&(o|=0),void 0===c||"["===c&&s+2===r){cu(i,void 0===c?new au(o,e,t):new su(o,e,t));break}{let e=i.map[o];void 0===e&&(e=new ou(o),cu(i,e)),i=e}}}var du=class{constructor(e,t){this.seq=[],this.map={};let i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){let i=e.getActiveUniform(t,n);hu(i,e.getUniformLocation(t,i.name),this)}}setValue(e,t,i,n){let r=this.map[t];void 0!==r&&r.setValue(e,i,n)}setOptional(e,t,i){let n=t[i];void 0!==n&&this.setValue(e,i,n)}static upload(e,t,i,n){for(let r=0,a=t.length;r!==a;++r){let a=t[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(e,s.value,n)}}static seqWithValue(e,t){let i=[];for(let n=0,r=e.length;n!==r;++n){let r=e[n];r.id in t&&i.push(r)}return i}};function uu(e,t,i){let n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}var pu=0;function fu(e,t,i){let n=e.getShaderParameter(t,35713),r=e.getShaderInfoLog(t).trim();if(n&&""===r)return"";let a=/ERROR: 0:(\d+)/.exec(r);if(a){let n=parseInt(a[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(e,t){let i=e.split("\n"),n=[],r=Math.max(t-6,0),a=Math.min(t+6,i.length);for(let s=r;s<a;s++){let e=s+1;n.push("".concat(e===t?">":" "," ").concat(e,": ").concat(i[s]))}return n.join("\n")}(e.getShaderSource(t),n)}return r}function mu(e,t){let i=function(e){switch(e){case fo:return["Linear","( value )"];case mo:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function gu(e,t){let i;switch(t){case Va:i="Linear";break;case Ga:i="Reinhard";break;case Ha:i="OptimizedCineon";break;case Wa:i="ACESFilmic";break;case qa:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function vu(e){return""!==e}function yu(e,t){let i=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function bu(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var xu=/^[ \t]*#include +<([\w\d./]+)>/gm;function wu(e){return e.replace(xu,_u)}function _u(e,t){let i=Th[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return wu(i)}var Su=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Au(e){return e.replace(Su,Eu)}function Eu(e,t,i,n){let r="";for(let a=parseInt(t);a<parseInt(i);a++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return r}function Cu(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Mu(e,t,i,n){let r,a,s=e.getContext(),o=i.defines,l=i.vertexShader,c=i.fragmentShader,h=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===ia?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===na?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===ra&&(t="SHADOWMAP_TYPE_VSM"),t}(i),d=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Xa:case Ya:t="ENVMAP_TYPE_CUBE";break;case Za:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),u=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Ya&&(t="ENVMAP_MODE_REFRACTION");return t}(i),p=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Na:t="ENVMAP_BLENDING_MULTIPLY";break;case za:t="ENVMAP_BLENDING_MIX";break;case Ua:t="ENVMAP_BLENDING_ADD"}return t}(i),f=function(e){let t=e.envMapCubeUVHeight;if(null===t)return null;let i=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),m=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(vu).join("\n")}(i),g=function(e){let t=[];for(let i in e){let n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(o),v=s.createProgram(),y=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(r=[g].filter(vu).join("\n"),r.length>0&&(r+="\n"),a=[m,g].filter(vu).join("\n"),a.length>0&&(a+="\n")):(r=[Cu(i),"#define SHADER_NAME "+i.shaderName,g,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(vu).join("\n"),a=[m,Cu(i),"#define SHADER_NAME "+i.shaderName,g,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+u:"",i.envMap?"#define "+p:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==ja?"#define TONE_MAPPING":"",i.toneMapping!==ja?Th.tonemapping_pars_fragment:"",i.toneMapping!==ja?gu("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Th.encodings_pars_fragment,mu("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(vu).join("\n")),l=wu(l),l=yu(l,i),l=bu(l,i),c=wu(c),c=yu(c,i),c=bu(c,i),l=Au(l),c=Au(c),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(y="#version 300 es\n",r=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,a=["#define varying in",i.glslVersion===Ao?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Ao?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);let b,x,w=y+a+c,_=uu(s,35633,y+r+l),S=uu(s,35632,w);if(s.attachShader(v,_),s.attachShader(v,S),void 0!==i.index0AttributeName?s.bindAttribLocation(v,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(v,0,"position"),s.linkProgram(v),e.debug.checkShaderErrors){let e=s.getProgramInfoLog(v).trim(),t=s.getShaderInfoLog(_).trim(),i=s.getShaderInfoLog(S).trim(),n=!0,o=!0;if(!1===s.getProgramParameter(v,35714)){n=!1;let t=fu(s,_,"vertex"),i=fu(s,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(v,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):(""===t||""===i)&&(o=!1);o&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:r},fragmentShader:{log:i,prefix:a}})}return s.deleteShader(_),s.deleteShader(S),this.getUniforms=function(){return void 0===b&&(b=new du(s,v)),b},this.getAttributes=function(){return void 0===x&&(x=function(e,t){let i={},n=e.getProgramParameter(t,35721);for(let r=0;r<n;r++){let n=e.getActiveAttrib(t,r),a=n.name,s=1;35674===n.type&&(s=2),35675===n.type&&(s=3),35676===n.type&&(s=4),i[a]={type:n.type,location:e.getAttribLocation(t,a),locationSize:s}}return i}(s,v)),x},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(v),this.program=void 0},this.name=i.shaderName,this.id=pu++,this.cacheKey=t,this.usedTimes=1,this.program=v,this.vertexShader=_,this.fragmentShader=S,this}var Pu=0,Tu=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,i=e.fragmentShader,n=this._getShaderStage(t),r=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return!1===a.has(n)&&(a.add(n),n.usedTimes++),!1===a.has(r)&&(a.add(r),r.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache,i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){let t=this.shaderCache,i=t.get(e);return void 0===i&&(i=new Du(e),t.set(e,i)),i}},Du=class{constructor(e){this.id=Pu++,this.code=e,this.usedTimes=0}};function Ru(e,t,i,n,r,a,s){let o=new nc,l=new Tu,c=[],h=r.isWebGL2,d=r.logarithmicDepthBuffer,u=r.vertexTextures,p=r.precision,f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,o,c,m,g){let v=m.fog,y=g.geometry,b=a.isMeshStandardMaterial?m.environment:null,x=(a.isMeshStandardMaterial?i:t).get(a.envMap||b),w=x&&x.mapping===Za?x.image.height:null,_=f[a.type];null!==a.precision&&(p=r.getMaxPrecision(a.precision),p!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",p,"instead."));let S,A,E,C,M=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,P=void 0!==M?M.length:0,T=0;if(void 0!==y.morphAttributes.position&&(T=1),void 0!==y.morphAttributes.normal&&(T=2),void 0!==y.morphAttributes.color&&(T=3),_){let e=Rh[_];S=e.vertexShader,A=e.fragmentShader}else S=a.vertexShader,A=a.fragmentShader,l.update(a),E=l.getVertexShaderID(a),C=l.getFragmentShaderID(a);let D=e.getRenderTarget(),R=a.alphaTest>0,O=a.clearcoat>0,I=a.iridescence>0;return{isWebGL2:h,shaderID:_,shaderName:a.type,vertexShader:S,fragmentShader:A,defines:a.defines,customVertexShaderID:E,customFragmentShaderID:C,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:p,instancing:!0===g.isInstancedMesh,instancingColor:!0===g.isInstancedMesh&&null!==g.instanceColor,supportsVertexTextures:u,outputEncoding:null===D?e.outputEncoding:!0===D.isXRRenderTarget?D.texture.encoding:fo,map:!!a.map,matcap:!!a.matcap,envMap:!!x,envMapMode:x&&x.mapping,envMapCubeUVHeight:w,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:a.normalMapType===bo,tangentSpaceNormalMap:a.normalMapType===yo,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===mo,clearcoat:O,clearcoatMap:O&&!!a.clearcoatMap,clearcoatRoughnessMap:O&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:O&&!!a.clearcoatNormalMap,iridescence:I,iridescenceMap:I&&!!a.iridescenceMap,iridescenceThicknessMap:I&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&a.blending===ca,alphaMap:!!a.alphaMap,alphaTest:R,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!y.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!a.map||!!a.bumpMap||!!a.normalMap||!!a.specularMap||!!a.alphaMap||!!a.emissiveMap||!!a.roughnessMap||!!a.metalnessMap||!!a.clearcoatMap||!!a.clearcoatRoughnessMap||!!a.clearcoatNormalMap||!!a.iridescenceMap||!!a.iridescenceThicknessMap||!!a.displacementMap||!!a.transmissionMap||!!a.thicknessMap||!!a.specularIntensityMap||!!a.specularColorMap||!!a.sheenColorMap||!!a.sheenRoughnessMap,uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap)&&!!a.displacementMap,fog:!!v,useFog:!0===a.fog,fogExp2:v&&v.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===g.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:P,morphTextureStride:T,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:ja,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:a.side===oa,flipSided:a.side===sa,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){let i=[];if(t.shaderID?i.push(t.shaderID):(i.push(t.customVertexShaderID),i.push(t.customFragmentShaderID)),void 0!==t.defines)for(let e in t.defines)i.push(e),i.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(i,t),function(e,t){o.disableAll(),t.isWebGL2&&o.enable(0),t.supportsVertexTextures&&o.enable(1),t.instancing&&o.enable(2),t.instancingColor&&o.enable(3),t.map&&o.enable(4),t.matcap&&o.enable(5),t.envMap&&o.enable(6),t.lightMap&&o.enable(7),t.aoMap&&o.enable(8),t.emissiveMap&&o.enable(9),t.bumpMap&&o.enable(10),t.normalMap&&o.enable(11),t.objectSpaceNormalMap&&o.enable(12),t.tangentSpaceNormalMap&&o.enable(13),t.clearcoat&&o.enable(14),t.clearcoatMap&&o.enable(15),t.clearcoatRoughnessMap&&o.enable(16),t.clearcoatNormalMap&&o.enable(17),t.iridescence&&o.enable(18),t.iridescenceMap&&o.enable(19),t.iridescenceThicknessMap&&o.enable(20),t.displacementMap&&o.enable(21),t.specularMap&&o.enable(22),t.roughnessMap&&o.enable(23),t.metalnessMap&&o.enable(24),t.gradientMap&&o.enable(25),t.alphaMap&&o.enable(26),t.alphaTest&&o.enable(27),t.vertexColors&&o.enable(28),t.vertexAlphas&&o.enable(29),t.vertexUvs&&o.enable(30),t.vertexTangents&&o.enable(31),t.uvsVertexOnly&&o.enable(32),e.push(o.mask),o.disableAll(),t.fog&&o.enable(0),t.useFog&&o.enable(1),t.flatShading&&o.enable(2),t.logarithmicDepthBuffer&&o.enable(3),t.skinning&&o.enable(4),t.morphTargets&&o.enable(5),t.morphNormals&&o.enable(6),t.morphColors&&o.enable(7),t.premultipliedAlpha&&o.enable(8),t.shadowMapEnabled&&o.enable(9),t.physicallyCorrectLights&&o.enable(10),t.doubleSided&&o.enable(11),t.flipSided&&o.enable(12),t.useDepthPacking&&o.enable(13),t.dithering&&o.enable(14),t.specularIntensityMap&&o.enable(15),t.specularColorMap&&o.enable(16),t.transmission&&o.enable(17),t.transmissionMap&&o.enable(18),t.thicknessMap&&o.enable(19),t.sheen&&o.enable(20),t.sheenColorMap&&o.enable(21),t.sheenRoughnessMap&&o.enable(22),t.decodeVideoTexture&&o.enable(23),t.opaque&&o.enable(24),e.push(o.mask)}(i,t),i.push(e.outputEncoding)),i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){let t,i=f[e.type];if(i){let e=Rh[i];t=dh.clone(e.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,i){let n;for(let e=0,r=c.length;e<r;e++){let t=c[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new Mu(e,i,t,a),c.push(n)),n},releaseProgram:function(e){if(0===--e.usedTimes){let t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Ou(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function Iu(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ku(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Lu(){let e=[],t=0,i=[],n=[],r=[];function a(i,n,r,a,s,o){let l=e[t];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:a,renderOrder:i.renderOrder,z:s,group:o},e[t]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=a,l.renderOrder=i.renderOrder,l.z=s,l.group=o),t++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){t=0,i.length=0,n.length=0,r.length=0},push:function(e,t,s,o,l,c){let h=a(e,t,s,o,l,c);s.transmission>0?n.push(h):!0===s.transparent?r.push(h):i.push(h)},unshift:function(e,t,s,o,l,c){let h=a(e,t,s,o,l,c);s.transmission>0?n.unshift(h):!0===s.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=t,n=e.length;i<n;i++){let t=e[i];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){i.length>1&&i.sort(e||Iu),n.length>1&&n.sort(t||ku),r.length>1&&r.sort(t||ku)}}}function Fu(){let e=new WeakMap;return{get:function(t,i){let n,r=e.get(t);return void 0===r?(n=new Lu,e.set(t,[n])):i>=r.length?(n=new Lu,r.push(n)):n=r[i],n},dispose:function(){e=new WeakMap}}}function Bu(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new gl,color:new rl};break;case"SpotLight":i={position:new gl,direction:new gl,color:new rl,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new gl,color:new rl,distance:0,decay:0};break;case"HemisphereLight":i={direction:new gl,skyColor:new rl,groundColor:new rl};break;case"RectAreaLight":i={color:new rl,position:new gl,halfWidth:new gl,halfHeight:new gl}}return e[t.id]=i,i}}}var Nu=0;function zu(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Uu(e,t){let i=new Bu,n=function(){let e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new jo};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new jo,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let l=0;l<9;l++)r.probe.push(new gl);let a=new gl,s=new ql,o=new ql;return{setup:function(a,s){let o=0,l=0,c=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let h=0,d=0,u=0,p=0,f=0,m=0,g=0,v=0,y=0,b=0;a.sort(zu);let x=!0!==s?Math.PI:1;for(let e=0,t=a.length;e<t;e++){let t=a[e],s=t.color,w=t.intensity,_=t.distance,S=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=s.r*w*x,l+=s.g*w*x,c+=s.b*w*x;else if(t.isLightProbe)for(let e=0;e<9;e++)r.probe[e].addScaledVector(t.sh.coefficients[e],w);else if(t.isDirectionalLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=S,r.directionalShadowMatrix[h]=t.shadow.matrix,m++}r.directional[h]=e,h++}else if(t.isSpotLight){let e=i.get(t);e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(w*x),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,r.spot[u]=e;let a=t.shadow;if(t.map&&(r.spotLightMap[y]=t.map,y++,a.updateMatrices(t),t.castShadow&&b++),r.spotLightMatrix[u]=a.matrix,t.castShadow){let e=n.get(t);e.shadowBias=a.bias,e.shadowNormalBias=a.normalBias,e.shadowRadius=a.radius,e.shadowMapSize=a.mapSize,r.spotShadow[u]=e,r.spotShadowMap[u]=S,v++}u++}else if(t.isRectAreaLight){let e=i.get(t);e.color.copy(s).multiplyScalar(w),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),r.rectArea[p]=e,p++}else if(t.isPointLight){let e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*x),e.distance=t.distance,e.decay=t.decay,t.castShadow){let e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,r.pointShadow[d]=i,r.pointShadowMap[d]=S,r.pointShadowMatrix[d]=t.shadow.matrix,g++}r.point[d]=e,d++}else if(t.isHemisphereLight){let e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(w*x),e.groundColor.copy(t.groundColor).multiplyScalar(w*x),r.hemi[f]=e,f++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Dh.LTC_FLOAT_1,r.rectAreaLTC2=Dh.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Dh.LTC_HALF_1,r.rectAreaLTC2=Dh.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;let w=r.hash;(w.directionalLength!==h||w.pointLength!==d||w.spotLength!==u||w.rectAreaLength!==p||w.hemiLength!==f||w.numDirectionalShadows!==m||w.numPointShadows!==g||w.numSpotShadows!==v||w.numSpotMaps!==y)&&(r.directional.length=h,r.spot.length=u,r.rectArea.length=p,r.point.length=d,r.hemi.length=f,r.directionalShadow.length=m,r.directionalShadowMap.length=m,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=m,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+y-b,r.spotLightMap.length=y,r.numSpotLightShadowsWithMaps=b,w.directionalLength=h,w.pointLength=d,w.spotLength=u,w.rectAreaLength=p,w.hemiLength=f,w.numDirectionalShadows=m,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,r.version=Nu++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,h=0,d=t.matrixWorldInverse;for(let u=0,p=e.length;u<p;u++){let t=e[u];if(t.isDirectionalLight){let e=r.directional[i];e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),i++}else if(t.isSpotLight){let e=r.spot[l];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(t.matrixWorld),a.setFromMatrixPosition(t.target.matrixWorld),e.direction.sub(a),e.direction.transformDirection(d),l++}else if(t.isRectAreaLight){let e=r.rectArea[c];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),o.identity(),s.copy(t.matrixWorld),s.premultiply(d),o.extractRotation(s),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),e.halfWidth.applyMatrix4(o),e.halfHeight.applyMatrix4(o),c++}else if(t.isPointLight){let e=r.point[n];e.position.setFromMatrixPosition(t.matrixWorld),e.position.applyMatrix4(d),n++}else if(t.isHemisphereLight){let e=r.hemi[h];e.direction.setFromMatrixPosition(t.matrixWorld),e.direction.transformDirection(d),h++}}},state:r}}function ju(e,t){let i=new Uu(e,t),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Vu(e,t){let i=new WeakMap;return{get:function(n){let r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=i.get(n);return void 0===s?(r=new ju(e,t),i.set(n,[r])):a>=s.length?(r=new ju(e,t),s.push(r)):r=s[a],r},dispose:function(){i=new WeakMap}}}var Gu=class extends Dc{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=go,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}},Hu=class extends Dc{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new gl,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}},Wu="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",qu="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}";function Xu(e,t,i){let n=new Eh,r=new jo,a=new jo,s=new dl,o=new Gu({depthPacking:vo}),l=new Hu,c={},h=i.maxTextureSize,d={[aa]:sa,[sa]:aa,[oa]:oa},u=new uh({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new jo},radius:{value:4}},vertexShader:Wu,fragmentShader:qu}),p=u.clone();p.defines.HORIZONTAL_PASS=1;let f=new Wc;f.setAttribute("position",new kc(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let m=new ah(f,u),g=this;function v(i,n){let a=t.update(m);u.defines.VSM_SAMPLES!==i.blurSamples&&(u.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,u.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new ul(r.x,r.y)),u.uniforms.shadow_pass.value=i.map.texture,u.uniforms.resolution.value=i.mapSize,u.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,a,u,m,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,a,p,m,null)}function y(t,i,n,r,a,s){let h=null,u=!0===n.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==u)h=u;else if(h=!0===n.isPointLight?l:o,e.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){let e=h.uuid,t=i.uuid,n=c[e];void 0===n&&(n={},c[e]=n);let r=n[t];void 0===r&&(r=h.clone(),n[t]=r),h=r}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=s===ra?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:d[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.map=i.map,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===n.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(n.matrixWorld),h.nearDistance=r,h.farDistance=a),h}function b(i,r,a,s,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&o===ra)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);let n=t.update(i),r=i.material;if(Array.isArray(r)){let t=n.groups;for(let l=0,c=t.length;l<c;l++){let c=t[l],h=r[c.materialIndex];if(h&&h.visible){let t=y(i,h,s,a.near,a.far,o);e.renderBufferDirect(a,null,n,t,i,c)}}}else if(r.visible){let t=y(i,r,s,a.near,a.far,o);e.renderBufferDirect(a,null,n,t,i,null)}}let l=i.children;for(let e=0,t=l.length;e<t;e++)b(l[e],r,a,s,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ia,this.render=function(t,i,o){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===t.length)return;let l=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),u=e.state;u.setBlending(la),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let p=0,f=t.length;p<f;p++){let l=t[p],c=l.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;r.copy(c.mapSize);let d=c.getFrameExtents();if(r.multiply(d),a.copy(c.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(a.x=Math.floor(h/d.x),r.x=a.x*d.x,c.mapSize.x=a.x),r.y>h&&(a.y=Math.floor(h/d.y),r.y=a.y*d.y,c.mapSize.y=a.y)),null===c.map){let e=this.type!==ra?{minFilter:ts,magFilter:ts}:{};c.map=new ul(r.x,r.y,e),c.map.texture.name=l.name+".shadowMap",c.camera.updateProjectionMatrix()}e.setRenderTarget(c.map),e.clear();let f=c.getViewportCount();for(let e=0;e<f;e++){let t=c.getViewport(e);s.set(a.x*t.x,a.y*t.y,a.x*t.z,a.y*t.w),u.viewport(s),c.updateMatrices(l,e),n=c.getFrustum(),b(i,o,c.camera,l,this.type)}!0!==c.isPointLightShadow&&this.type===ra&&v(c,o),c.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(l,c,d)}}function Yu(e,t,i){let n=i.isWebGL2;let r=new function(){let t=!1,i=new dl,n=null,r=new dl(0,0,0,0);return{setMask:function(i){n!==i&&!t&&(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,a,s,o){!0===o&&(t*=s,n*=s,a*=s),i.set(t,n,a,s),!1===r.equals(i)&&(e.clearColor(t,n,a,s),r.copy(i))},reset:function(){t=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let t=!1,i=null,n=null,r=null;return{setTest:function(e){e?U(2929):j(2929)},setMask:function(n){i!==n&&!t&&(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){switch(t){case Da:e.depthFunc(512);break;case Ra:e.depthFunc(519);break;case Oa:e.depthFunc(513);break;case Ia:e.depthFunc(515);break;case ka:e.depthFunc(514);break;case La:e.depthFunc(518);break;case Fa:e.depthFunc(516);break;case Ba:e.depthFunc(517);break;default:e.depthFunc(515)}n=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,i=null,n=null,r=null}}},s=new function(){let t=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,c=null;return{setTest:function(e){t||(e?U(2960):j(2960))},setMask:function(n){i!==n&&!t&&(e.stencilMask(n),i=n)},setFunc:function(t,i,s){(n!==t||r!==i||a!==s)&&(e.stencilFunc(t,i,s),n=t,r=i,a=s)},setOp:function(t,i,n){(s!==t||o!==i||l!==n)&&(e.stencilOp(t,i,n),s=t,o=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,c=null}}},o=new WeakMap,l=new WeakMap,c={},h={},d=new WeakMap,u=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,w=null,_=!1,S=null,A=null,E=null,C=null,M=null,P=e.getParameter(35661),T=!1,D=0,R=e.getParameter(7938);-1!==R.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(R)[1]),T=D>=1):-1!==R.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(R)[1]),T=D>=2);let O=null,I={},k=e.getParameter(3088),L=e.getParameter(2978),F=(new dl).fromArray(k),B=(new dl).fromArray(L);function N(t,i,n){let r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let s=0;s<n;s++)e.texImage2D(i+s,0,6408,1,1,0,6408,5121,r);return a}let z={};function U(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function j(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}z[3553]=N(3553,3553,1),z[34067]=N(34067,34069,6),r.setClear(0,0,0,1),a.setClear(1),s.setClear(0),U(2929),a.setFunc(Ia),W(!1),q(ea),U(2884),H(la);let V={[fa]:32774,[ma]:32778,[ga]:32779};if(n)V[va]=32775,V[ya]=32776;else{let e=t.get("EXT_blend_minmax");null!==e&&(V[va]=e.MIN_EXT,V[ya]=e.MAX_EXT)}let G={[ba]:0,[xa]:1,[wa]:768,[Sa]:770,[Ta]:776,[Ma]:774,[Ea]:772,[_a]:769,[Aa]:771,[Pa]:775,[Ca]:773};function H(t,i,n,r,a,s,o,l){if(t!==la){if(!1===f&&(U(3042),f=!0),t===pa)a=a||i,s=s||n,o=o||r,(i!==g||a!==b)&&(e.blendEquationSeparate(V[i],V[a]),g=i,b=a),(n!==v||r!==y||s!==x||o!==w)&&(e.blendFuncSeparate(G[n],G[r],G[s],G[o]),v=n,y=r,x=s,w=o),m=t,_=!1;else if(t!==m||l!==_){if((g!==fa||b!==fa)&&(e.blendEquation(32774),g=fa,b=fa),l)switch(t){case ca:e.blendFuncSeparate(1,771,1,771);break;case ha:e.blendFunc(1,1);break;case da:e.blendFuncSeparate(0,769,0,1);break;case ua:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case ca:e.blendFuncSeparate(770,771,1,771);break;case ha:e.blendFunc(770,1);break;case da:e.blendFuncSeparate(0,769,0,1);break;case ua:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}v=null,y=null,x=null,w=null,m=t,_=l}}else!0===f&&(j(3042),f=!1)}function W(t){S!==t&&(t?e.frontFace(2304):e.frontFace(2305),S=t)}function q(t){t!==$r?(U(2884),t!==A&&(t===ea?e.cullFace(1029):t===ta?e.cullFace(1028):e.cullFace(1032))):j(2884),A=t}function X(t,i,n){t?(U(32823),(C!==i||M!==n)&&(e.polygonOffset(i,n),C=i,M=n)):j(32823)}return{buffers:{color:r,depth:a,stencil:s},enable:U,disable:j,bindFramebuffer:function(t,i){return h[t]!==i&&(e.bindFramebuffer(t,i),h[t]=i,n&&(36009===t&&(h[36160]=i),36160===t&&(h[36009]=i)),!0)},drawBuffers:function(n,r){let a=u,s=!1;if(n)if(a=d.get(r),void 0===a&&(a=[],d.set(r,a)),n.isWebGLMultipleRenderTargets){let e=n.texture;if(a.length!==e.length||36064!==a[0]){for(let t=0,i=e.length;t<i;t++)a[t]=36064+t;a.length=e.length,s=!0}}else 36064!==a[0]&&(a[0]=36064,s=!0);else 1029!==a[0]&&(a[0]=1029,s=!0);s&&(i.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:H,setMaterial:function(e,t){e.side===oa?j(2884):U(2884);let i=e.side===sa;t&&(i=!i),W(i),e.blending===ca&&!1===e.transparent?H(la):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),r.setMask(e.colorWrite);let n=e.stencilWrite;s.setTest(n),n&&(s.setMask(e.stencilWriteMask),s.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),s.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),X(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?U(32926):j(32926)},setFlipSided:W,setCullFace:q,setLineWidth:function(t){t!==E&&(T&&e.lineWidth(t),E=t)},setPolygonOffset:X,setScissorTest:function(e){e?U(3089):j(3089)},activeTexture:function(t){void 0===t&&(t=33984+P-1),O!==t&&(e.activeTexture(t),O=t)},bindTexture:function(t,i,n){void 0===n&&(n=null===O?33984+P-1:O);let r=I[n];void 0===r&&(r={type:void 0,texture:void 0},I[n]=r),(r.type!==t||r.texture!==i)&&(O!==n&&(e.activeTexture(n),O=n),e.bindTexture(t,i||z[t]),r.type=t,r.texture=i)},unbindTexture:function(){let t=I[O];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(t,i){let n=l.get(i);void 0===n&&(n=new WeakMap,l.set(i,n));let r=n.get(t);void 0===r&&(r=e.getUniformBlockIndex(i,t.name),n.set(t,r))},uniformBlockBinding:function(t,i){let n=l.get(i).get(t);o.get(i)!==n&&(e.uniformBlockBinding(i,n,t.__bindingPointIndex),o.set(i,n))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===F.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),F.copy(t))},viewport:function(t){!1===B.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),B.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},O=null,I={},h={},d=new WeakMap,u=[],p=null,f=!1,m=null,g=null,v=null,y=null,b=null,x=null,w=null,_=!1,S=null,A=null,E=null,C=null,M=null,F.set(0,0,e.canvas.width,e.canvas.height),B.set(0,0,e.canvas.width,e.canvas.height),r.reset(),a.reset(),s.reset()}}}function Qu(e,t,i,n,r,a,s){let o,l=r.isWebGL2,c=r.maxTextures,h=r.maxCubemapSize,d=r.maxTextureSize,u=r.maxSamples,p=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),m=new WeakMap,g=new WeakMap,v=!1;try{v=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function y(e,t){return v?new OffscreenCanvas(e,t):Xo("canvas")}function b(e,t,i,n){let r=1;if((e.width>n||e.height>n)&&(r=n/Math.max(e.width,e.height)),r<1||!0===t){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let n=t?Bo:Math.floor,a=n(r*e.width),s=n(r*e.height);void 0===o&&(o=y(a,s));let l=i?y(a,s):o;return l.width=a,l.height=s,l.getContext("2d").drawImage(e,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+a+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function x(e){return Lo(e.width)&&Lo(e.height)}function w(e,t){return e.generateMipmaps&&t&&e.minFilter!==ts&&e.minFilter!==rs}function _(t){e.generateMipmap(t)}function S(i,n,r,a){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===r&&(o=33326),5131===r&&(o=33325),5121===r&&(o=33321)),33319===n&&(5126===r&&(o=33328),5131===r&&(o=33327),5121===r&&(o=33323)),6408===n&&(5126===r&&(o=34836),5131===r&&(o=34842),5121===r&&(o=a===mo&&!1===s?35907:32856),32819===r&&(o=32854),32820===r&&(o=32855)),(33325===o||33326===o||33327===o||33328===o||34842===o||34836===o)&&t.get("EXT_color_buffer_float"),o}function A(e,t,i){return!0===w(e,i)||e.isFramebufferTexture&&e.minFilter!==ts&&e.minFilter!==rs?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(e){return e===ts||e===is||e===ns?9728:9729}function C(e){let t=e.target;t.removeEventListener("dispose",C),function(e){let t=n.get(e);if(void 0===t.__webglInit)return;let i=e.source,r=g.get(i);if(r){let n=r[t.__cacheKey];n.usedTimes--,0===n.usedTimes&&P(e),0===Object.keys(r).length&&g.delete(i)}n.remove(e)}(t),t.isVideoTexture&&m.delete(t)}function M(t){let i=t.target;i.removeEventListener("dispose",M),function(t){let i=t.texture,r=n.get(t),a=n.get(i);if(void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),s.memory.textures--),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLCubeRenderTarget)for(let n=0;n<6;n++)e.deleteFramebuffer(r.__webglFramebuffer[n]),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer[n]);else{if(e.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&e.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&e.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let t=0;t<r.__webglColorRenderbuffer.length;t++)r.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(r.__webglColorRenderbuffer[t]);r.__webglDepthRenderbuffer&&e.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let o=0,l=i.length;o<l;o++){let t=n.get(i[o]);t.__webglTexture&&(e.deleteTexture(t.__webglTexture),s.memory.textures--),n.remove(i[o])}n.remove(i),n.remove(t)}(i)}function P(t){let i=n.get(t);e.deleteTexture(i.__webglTexture);let r=t.source;delete g.get(r)[i.__cacheKey],s.memory.textures--}let T=0;function D(e,t){let r=n.get(e);if(e.isVideoTexture&&function(e){let t=s.render.frame;m.get(e)!==t&&(m.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){let i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void L(r,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(3553,r.__webglTexture,33984+t)}let R={[Ja]:10497,[$a]:33071,[es]:33648},O={[ts]:9728,[is]:9984,[ns]:9986,[rs]:9729,[as]:9985,[ss]:9987};function I(i,a,s){if(s?(e.texParameteri(i,10242,R[a.wrapS]),e.texParameteri(i,10243,R[a.wrapT]),(32879===i||35866===i)&&e.texParameteri(i,32882,R[a.wrapR]),e.texParameteri(i,10240,O[a.magFilter]),e.texParameteri(i,10241,O[a.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),(32879===i||35866===i)&&e.texParameteri(i,32882,33071),(a.wrapS!==$a||a.wrapT!==$a)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,E(a.magFilter)),e.texParameteri(i,10241,E(a.minFilter)),a.minFilter!==ts&&a.minFilter!==rs&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){let s=t.get("EXT_texture_filter_anisotropic");if(a.magFilter===ts||a.minFilter!==ns&&a.minFilter!==ss||a.type===ps&&!1===t.has("OES_texture_float_linear")||!1===l&&a.type===fs&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(e.texParameterf(i,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function k(t,i){let n=!1;void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",C));let r=i.source,a=g.get(r);void 0===a&&(a={},g.set(r,a));let o=function(e){let t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(i);if(o!==t.__cacheKey){void 0===a[o]&&(a[o]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,n=!0),a[o].usedTimes++;let r=a[t.__cacheKey];void 0!==r&&(a[t.__cacheKey].usedTimes--,0===r.usedTimes&&P(i)),t.__cacheKey=o,t.__webglTexture=a[o].texture}return n}function L(t,r,s){let o=3553;(r.isDataArrayTexture||r.isCompressedArrayTexture)&&(o=35866),r.isData3DTexture&&(o=32879);let c=k(t,r),h=r.source;i.bindTexture(o,t.__webglTexture,33984+s);let u=n.get(h);if(h.version!==u.__version||!0===c){i.activeTexture(33984+s),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let t=function(e){return!l&&(e.wrapS!==$a||e.wrapT!==$a||e.minFilter!==ts&&e.minFilter!==rs)}(r)&&!1===x(r.image),n=b(r.image,t,!1,d);n=j(r,n);let p=x(n)||l,f=a.convert(r.format,r.encoding),m=a.convert(r.type),g=S(r.internalFormat,f,m,r.encoding,r.isVideoTexture);I(o,r,p);let v,y=r.mipmaps,E=l&&!0!==r.isVideoTexture,C=void 0===u.__version||!0===c,M=A(r,n,p);if(r.isDepthTexture)g=6402,l?g=r.type===ps?36012:r.type===us?33190:r.type===vs?35056:33189:r.type===ps&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===_s&&6402===g&&r.type!==hs&&r.type!==us&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=us,m=a.convert(r.type)),r.format===Ss&&6402===g&&(g=34041,r.type!==vs&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=vs,m=a.convert(r.type))),C&&(E?i.texStorage2D(3553,1,g,n.width,n.height):i.texImage2D(3553,0,g,n.width,n.height,0,f,m,null));else if(r.isDataTexture)if(y.length>0&&p){E&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],E?i.texSubImage2D(3553,e,0,0,v.width,v.height,f,m,v.data):i.texImage2D(3553,e,g,v.width,v.height,0,f,m,v.data);r.generateMipmaps=!1}else E?(C&&i.texStorage2D(3553,M,g,n.width,n.height),i.texSubImage2D(3553,0,0,0,n.width,n.height,f,m,n.data)):i.texImage2D(3553,0,g,n.width,n.height,0,f,m,n.data);else if(r.isCompressedTexture)if(r.isCompressedArrayTexture){E&&C&&i.texStorage3D(35866,M,g,y[0].width,y[0].height,n.depth);for(let e=0,t=y.length;e<t;e++)v=y[e],r.format!==bs?null!==f?E?i.compressedTexSubImage3D(35866,e,0,0,0,v.width,v.height,n.depth,f,v.data,0,0):i.compressedTexImage3D(35866,e,g,v.width,v.height,n.depth,0,v.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage3D(35866,e,0,0,0,v.width,v.height,n.depth,f,m,v.data):i.texImage3D(35866,e,g,v.width,v.height,n.depth,0,f,m,v.data)}else{E&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],r.format!==bs?null!==f?E?i.compressedTexSubImage2D(3553,e,0,0,v.width,v.height,f,v.data):i.compressedTexImage2D(3553,e,g,v.width,v.height,0,v.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):E?i.texSubImage2D(3553,e,0,0,v.width,v.height,f,m,v.data):i.texImage2D(3553,e,g,v.width,v.height,0,f,m,v.data)}else if(r.isDataArrayTexture)E?(C&&i.texStorage3D(35866,M,g,n.width,n.height,n.depth),i.texSubImage3D(35866,0,0,0,0,n.width,n.height,n.depth,f,m,n.data)):i.texImage3D(35866,0,g,n.width,n.height,n.depth,0,f,m,n.data);else if(r.isData3DTexture)E?(C&&i.texStorage3D(32879,M,g,n.width,n.height,n.depth),i.texSubImage3D(32879,0,0,0,0,n.width,n.height,n.depth,f,m,n.data)):i.texImage3D(32879,0,g,n.width,n.height,n.depth,0,f,m,n.data);else if(r.isFramebufferTexture){if(C)if(E)i.texStorage2D(3553,M,g,n.width,n.height);else{let e=n.width,t=n.height;for(let n=0;n<M;n++)i.texImage2D(3553,n,g,e,t,0,f,m,null),e>>=1,t>>=1}}else if(y.length>0&&p){E&&C&&i.texStorage2D(3553,M,g,y[0].width,y[0].height);for(let e=0,t=y.length;e<t;e++)v=y[e],E?i.texSubImage2D(3553,e,0,0,f,m,v):i.texImage2D(3553,e,g,f,m,v);r.generateMipmaps=!1}else E?(C&&i.texStorage2D(3553,M,g,n.width,n.height),i.texSubImage2D(3553,0,0,0,f,m,n)):i.texImage2D(3553,0,g,f,m,n);w(r,p)&&_(o),u.__version=h.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function F(t,r,s,o,l){let c=a.convert(s.format,s.encoding),h=a.convert(s.type),d=S(s.internalFormat,c,h,s.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,d,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,d,r.width,r.height,0,c,h,null)),i.bindFramebuffer(36160,t),U(r)?p.framebufferTexture2DMultisampleEXT(36160,o,l,n.get(s).__webglTexture,0,z(r)):(3553===l||l>=34069&&l<=34074)&&e.framebufferTexture2D(36160,o,l,n.get(s).__webglTexture,0),i.bindFramebuffer(36160,null)}function B(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||U(i)){let t=i.depthTexture;t&&t.isDepthTexture&&(t.type===ps?r=36012:t.type===us&&(r=33190));let n=z(i);U(i)?p.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):e.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else e.renderbufferStorage(36161,r,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){let r=z(i);n&&!1===U(i)?e.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):U(i)?p.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):e.renderbufferStorage(36161,34041,i.width,i.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{let t=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<t.length;r++){let s=t[r],o=a.convert(s.format,s.encoding),l=a.convert(s.type),c=S(s.internalFormat,o,l,s.encoding),h=z(i);n&&!1===U(i)?e.renderbufferStorageMultisample(36161,h,c,i.width,i.height):U(i)?p.renderbufferStorageMultisampleEXT(36161,h,c,i.width,i.height):e.renderbufferStorage(36161,c,i.width,i.height)}}e.bindRenderbuffer(36161,null)}function N(t){let r=n.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!r.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(r.depthTexture).__webglTexture||r.depthTexture.image.width!==r.width||r.depthTexture.image.height!==r.height)&&(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),D(r.depthTexture,0);let a=n.get(r.depthTexture).__webglTexture,s=z(r);if(r.depthTexture.format===_s)U(r)?p.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,s):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(r.depthTexture.format!==Ss)throw new Error("Unknown depthTexture format");U(r)?p.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,s):e.framebufferTexture2D(36160,33306,3553,a,0)}}(r.__webglFramebuffer,t)}else if(a){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=e.createRenderbuffer(),B(r.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=e.createRenderbuffer(),B(r.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function z(e){return Math.min(u,e.samples)}function U(e){let i=n.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function j(e,i){let n=e.encoding,r=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===Eo||n!==fo&&(n===mo?!1===l?!0===t.has("EXT_sRGB")&&r===bs?(e.format=Eo,e.minFilter=rs,e.generateMipmaps=!1):i=sl.sRGBToLinear(i):(r!==bs||a!==os)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){let e=T;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),T+=1,e},this.resetTextureUnits=function(){T=0},this.setTexture2D=D,this.setTexture2DArray=function(e,t){let r=n.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):i.bindTexture(35866,r.__webglTexture,33984+t)},this.setTexture3D=function(e,t){let r=n.get(e);e.version>0&&r.__version!==e.version?L(r,e,t):i.bindTexture(32879,r.__webglTexture,33984+t)},this.setTextureCube=function(t,r){let s=n.get(t);t.version>0&&s.__version!==t.version?function(t,r,s){if(6!==r.image.length)return;let o=k(t,r),c=r.source;i.bindTexture(34067,t.__webglTexture,33984+s);let d=n.get(c);if(c.version!==d.__version||!0===o){i.activeTexture(33984+s),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);let t=r.isCompressedTexture||r.image[0].isCompressedTexture,n=r.image[0]&&r.image[0].isDataTexture,u=[];for(let e=0;e<6;e++)u[e]=t||n?n?r.image[e].image:r.image[e]:b(r.image[e],!1,!0,h),u[e]=j(r,u[e]);let p,f=u[0],m=x(f)||l,g=a.convert(r.format,r.encoding),v=a.convert(r.type),y=S(r.internalFormat,g,v,r.encoding),E=l&&!0!==r.isVideoTexture,C=void 0===d.__version||!0===o,M=A(r,f,m);if(I(34067,r,m),t){E&&C&&i.texStorage2D(34067,M,y,f.width,f.height);for(let e=0;e<6;e++){p=u[e].mipmaps;for(let t=0;t<p.length;t++){let n=p[t];r.format!==bs?null!==g?E?i.compressedTexSubImage2D(34069+e,t,0,0,n.width,n.height,g,n.data):i.compressedTexImage2D(34069+e,t,y,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):E?i.texSubImage2D(34069+e,t,0,0,n.width,n.height,g,v,n.data):i.texImage2D(34069+e,t,y,n.width,n.height,0,g,v,n.data)}}}else{p=r.mipmaps,E&&C&&(p.length>0&&M++,i.texStorage2D(34067,M,y,u[0].width,u[0].height));for(let e=0;e<6;e++)if(n){E?i.texSubImage2D(34069+e,0,0,0,u[e].width,u[e].height,g,v,u[e].data):i.texImage2D(34069+e,0,y,u[e].width,u[e].height,0,g,v,u[e].data);for(let t=0;t<p.length;t++){let n=p[t].image[e].image;E?i.texSubImage2D(34069+e,t+1,0,0,n.width,n.height,g,v,n.data):i.texImage2D(34069+e,t+1,y,n.width,n.height,0,g,v,n.data)}}else{E?i.texSubImage2D(34069+e,0,0,0,g,v,u[e]):i.texImage2D(34069+e,0,y,g,v,u[e]);for(let t=0;t<p.length;t++){let n=p[t];E?i.texSubImage2D(34069+e,t+1,0,0,g,v,n.image[e]):i.texImage2D(34069+e,t+1,y,g,v,n.image[e])}}}w(r,m)&&_(34067),d.__version=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(s,t,r):i.bindTexture(34067,s.__webglTexture,33984+r)},this.rebindTextures=function(e,t,i){let r=n.get(e);void 0!==t&&F(r.__webglFramebuffer,e,e.texture,36064,3553),void 0!==i&&N(e)},this.setupRenderTarget=function(t){let o=t.texture,c=n.get(t),h=n.get(o);t.addEventListener("dispose",M),!0!==t.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=e.createTexture()),h.__version=o.version,s.memory.textures++);let d=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultipleRenderTargets,p=x(t)||l;if(d){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else{if(c.__webglFramebuffer=e.createFramebuffer(),u)if(r.drawBuffers){let i=t.texture;for(let t=0,r=i.length;t<r;t++){let r=n.get(i[t]);void 0===r.__webglTexture&&(r.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===U(t)){let n=u?o:[o];c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){let r=n[i];c.__webglColorRenderbuffer[i]=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer[i]);let s=a.convert(r.format,r.encoding),o=a.convert(r.type),l=S(r.internalFormat,s,o,r.encoding,!0===t.isXRRenderTarget),h=z(t);e.renderbufferStorageMultisample(36161,h,l,t.width,t.height),e.framebufferRenderbuffer(36160,36064+i,36161,c.__webglColorRenderbuffer[i])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),B(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}}if(d){i.bindTexture(34067,h.__webglTexture),I(34067,o,p);for(let e=0;e<6;e++)F(c.__webglFramebuffer[e],t,o,36064,34069+e);w(o,p)&&_(34067),i.unbindTexture()}else if(u){let e=t.texture;for(let r=0,a=e.length;r<a;r++){let a=e[r],s=n.get(a);i.bindTexture(3553,s.__webglTexture),I(3553,a,p),F(c.__webglFramebuffer,t,a,36064+r,3553),w(a,p)&&_(3553)}i.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(e,h.__webglTexture),I(e,o,p),F(c.__webglFramebuffer,t,o,36064,e),w(o,p)&&_(e),i.unbindTexture()}t.depthBuffer&&N(t)},this.updateRenderTargetMipmap=function(e){let t=x(e)||l,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let a=0,s=r.length;a<s;a++){let s=r[a];if(w(s,t)){let t=e.isWebGLCubeRenderTarget?34067:3553,r=n.get(s).__webglTexture;i.bindTexture(t,r),_(t),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===U(t)){let r=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,s=t.height,o=16384,l=[],c=t.stencilBuffer?33306:36096,h=n.get(t),d=!0===t.isWebGLMultipleRenderTargets;if(d)for(let t=0;t<r.length;t++)i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,null),i.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,null,0);i.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,h.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(36064+i),t.depthBuffer&&l.push(c);let u=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===u&&(t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024)),d&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[i]),!0===u&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),d){let t=n.get(r[i]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,t,0)}e.blitFramebuffer(0,0,a,s,0,0,a,s,o,9728),f&&e.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),d)for(let t=0;t<r.length;t++){i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+t,36161,h.__webglColorRenderbuffer[t]);let a=n.get(r[t]).__webglTexture;i.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+t,3553,a,0)}i.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=N,this.setupFrameBufferTexture=F,this.useMultisampledRTT=U}function Ku(e,t,i){let n=i.isWebGL2;return{convert:function(i){let r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i===os)return 5121;if(i===ms)return 32819;if(i===gs)return 32820;if(i===ls)return 5120;if(i===cs)return 5122;if(i===hs)return 5123;if(i===ds)return 5124;if(i===us)return 5125;if(i===ps)return 5126;if(i===fs)return n?5131:(r=t.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(i===ys)return 6406;if(i===bs)return 6408;if(i===xs)return 6409;if(i===ws)return 6410;if(i===_s)return 6402;if(i===Ss)return 34041;if(i===Eo)return r=t.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(i===As)return 6403;if(i===Es)return 36244;if(i===Cs)return 33319;if(i===Ms)return 33320;if(i===Ps)return 36249;if(i===Ts||i===Ds||i===Rs||i===Os)if(a===mo){if(r=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(i===Ts)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===Ds)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Rs)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Os)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=t.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(i===Ts)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===Ds)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Rs)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Os)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===Is||i===ks||i===Ls||i===Fs){if(r=t.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(i===Is)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===ks)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Ls)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Fs)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===Bs)return r=t.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===Ns||i===zs){if(r=t.get("WEBGL_compressed_texture_etc"),null===r)return null;if(i===Ns)return a===mo?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(i===zs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(i===Us||i===js||i===Vs||i===Gs||i===Hs||i===Ws||i===qs||i===Xs||i===Ys||i===Qs||i===Ks||i===Zs||i===Js||i===$s){if(r=t.get("WEBGL_compressed_texture_astc"),null===r)return null;if(i===Us)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===js)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Vs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===Gs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Hs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===Ws)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===qs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===Xs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===Ys)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===Qs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===Ks)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Zs)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Js)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===$s)return a===mo?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===eo){if(r=t.get("EXT_texture_compression_bptc"),null===r)return null;if(i===eo)return a===mo?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(i===to||i===io||i===no||i===ro){if(r=t.get("EXT_texture_compression_rgtc"),null===r)return null;if(i===eo)return r.COMPRESSED_RED_RGTC1_EXT;if(i===io)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===no)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===ro)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===vs?n?34042:(r=t.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[i]?e[i]:null}}}var Zu=class extends fh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isArrayCamera=!0,this.cameras=e}},Ju=class extends vc{constructor(){super(),this.isGroup=!0,this.type="Group"}},$u={type:"move"},ep=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ju,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ju,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new gl,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new gl),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ju,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new gl,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new gl),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){let t=this._hand;if(t)for(let i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,r=null,a=null,s=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){a=!0;for(let a of e.hand.values()){let e=t.getJointPose(a,i),n=this._getHandJoint(l,a);null!==e&&(n.matrix.fromArray(e.transform.matrix),n.matrix.decompose(n.position,n.rotation,n.scale),n.jointRadius=e.radius),n.visible=null!==e}let n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],s=n.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&s>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&s<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(r=t.getPose(e.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==s&&(n=t.getPose(e.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),n.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(n.linearVelocity)):s.hasLinearVelocity=!1,n.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(n.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent($u)))}return null!==s&&(s.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){let i=new Ju;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}},tp=class extends hl{constructor(e,t,i,n,r,a,s,o,l,c){if((c=void 0!==c?c:_s)!==_s&&c!==Ss)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===_s&&(i=us),void 0===i&&c===Ss&&(i=vs),super(null,n,r,a,s,o,c,i,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==s?s:ts,this.minFilter=void 0!==o?o:ts,this.flipY=!1,this.generateMipmaps=!1}},ip=class extends Co{constructor(e,t){super();let i=this,n=null,r=1,a=null,s="local-floor",o=1,l=null,c=null,h=null,d=null,u=null,p=null,f=t.getContextAttributes(),m=null,g=null,v=[],y=[],b=new Set,x=new Map,w=new fh;w.layers.enable(1),w.viewport=new dl;let _=new fh;_.layers.enable(2),_.viewport=new dl;let S=[w,_],A=new Zu;A.layers.enable(1),A.layers.enable(2);let E=null,C=null;function M(e){let t=y.indexOf(e.inputSource);if(-1===t)return;let i=v[t];void 0!==i&&i.dispatchEvent({type:e.type,data:e.inputSource})}function P(){n.removeEventListener("select",M),n.removeEventListener("selectstart",M),n.removeEventListener("selectend",M),n.removeEventListener("squeeze",M),n.removeEventListener("squeezestart",M),n.removeEventListener("squeezeend",M),n.removeEventListener("end",P),n.removeEventListener("inputsourceschange",T);for(let e=0;e<v.length;e++){let t=y[e];null!==t&&(y[e]=null,v[e].disconnect(t))}E=null,C=null,e.setRenderTarget(m),u=null,d=null,h=null,n=null,g=null,k.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function T(e){for(let t=0;t<e.removed.length;t++){let i=e.removed[t],n=y.indexOf(i);n>=0&&(y[n]=null,v[n].disconnect(i))}for(let t=0;t<e.added.length;t++){let i=e.added[t],n=y.indexOf(i);if(-1===n){for(let e=0;e<v.length;e++){if(e>=y.length){y.push(i),n=e;break}if(null===y[e]){y[e]=i,n=e;break}}if(-1===n)break}let r=v[n];r&&r.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=v[e];return void 0===t&&(t=new ep,v[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=v[e];return void 0===t&&(t=new ep,v[e]=t),t.getGripSpace()},this.getHand=function(e){let t=v[e];return void 0===t&&(t=new ep,v[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:u},this.getBinding=function(){return h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(c){if(n=c,null!==n){if(m=e.getRenderTarget(),n.addEventListener("select",M),n.addEventListener("selectstart",M),n.addEventListener("selectend",M),n.addEventListener("squeeze",M),n.addEventListener("squeezestart",M),n.addEventListener("squeezeend",M),n.addEventListener("end",P),n.addEventListener("inputsourceschange",T),!0!==f.xrCompatible&&await t.makeXRCompatible(),void 0===n.renderState.layers||!1===e.capabilities.isWebGL2){let i={antialias:void 0!==n.renderState.layers||f.antialias,alpha:f.alpha,depth:f.depth,stencil:f.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,t,i),n.updateRenderState({baseLayer:u}),g=new ul(u.framebufferWidth,u.framebufferHeight,{format:bs,type:os,encoding:e.outputEncoding,stencilBuffer:f.stencil})}else{let i=null,a=null,s=null;f.depth&&(s=f.stencil?35056:33190,i=f.stencil?Ss:_s,a=f.stencil?vs:us);let o={colorFormat:32856,depthFormat:s,scaleFactor:r};h=new XRWebGLBinding(n,t),d=h.createProjectionLayer(o),n.updateRenderState({layers:[d]}),g=new ul(d.textureWidth,d.textureHeight,{format:bs,type:os,depthTexture:new tp(d.textureWidth,d.textureHeight,a,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:f.stencil,encoding:e.outputEncoding,samples:f.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(o),l=null,a=await n.requestReferenceSpace(s),k.setContext(n),k.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};let D=new gl,R=new gl;function O(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===n)return;A.near=_.near=w.near=e.near,A.far=_.far=w.far=e.far,(E!==A.near||C!==A.far)&&(n.updateRenderState({depthNear:A.near,depthFar:A.far}),E=A.near,C=A.far);let t=e.parent,i=A.cameras;O(A,t);for(let n=0;n<i.length;n++)O(i[n],t);A.matrixWorld.decompose(A.position,A.quaternion,A.scale),e.matrix.copy(A.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);let r=e.children;for(let n=0,a=r.length;n<a;n++)r[n].updateMatrixWorld(!0);2===i.length?function(e,t,i){D.setFromMatrixPosition(t.matrixWorld),R.setFromMatrixPosition(i.matrixWorld);let n=D.distanceTo(R),r=t.projectionMatrix.elements,a=i.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],d=(a[8]+1)/a[0],u=s*h,p=s*d,f=n/(-h+d),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();let g=s+f,v=o+f,y=u-m,b=p+(n-m),x=l*o/v*g,w=c*o/v*g;e.projectionMatrix.makePerspective(y,b,x,w,g,v)}(A,w,_):A.projectionMatrix.copy(w.projectionMatrix)},this.getCamera=function(){return A},this.getFoveation=function(){if(null!==d||null!==u)return o},this.setFoveation=function(e){o=e,null!==d&&(d.fixedFoveation=e),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=e)},this.getPlanes=function(){return b};let I=null;let k=new Ch;k.setAnimationLoop((function(t,n){if(c=n.getViewerPose(l||a),p=n,null!==c){let t=c.views;null!==u&&(e.setRenderTargetFramebuffer(g,u.framebuffer),e.setRenderTarget(g));let i=!1;t.length!==A.cameras.length&&(A.cameras.length=0,i=!0);for(let n=0;n<t.length;n++){let r=t[n],a=null;if(null!==u)a=u.getViewport(r);else{let t=h.getViewSubImage(d,r);a=t.viewport,0===n&&(e.setRenderTargetTextures(g,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(g))}let s=S[n];void 0===s&&(s=new fh,s.layers.enable(n),s.viewport=new dl,S[n]=s),s.matrix.fromArray(r.transform.matrix),s.projectionMatrix.fromArray(r.projectionMatrix),s.viewport.set(a.x,a.y,a.width,a.height),0===n&&A.matrix.copy(s.matrix),!0===i&&A.cameras.push(s)}}for(let e=0;e<v.length;e++){let t=y[e],i=v[e];null!==t&&void 0!==i&&i.update(t,n,l||a)}if(I&&I(t,n),n.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:n.detectedPlanes});let e=null;for(let t of b)n.detectedPlanes.has(t)||(null===e&&(e=[]),e.push(t));if(null!==e)for(let t of e)b.delete(t),x.delete(t),i.dispatchEvent({type:"planeremoved",data:t});for(let t of n.detectedPlanes)if(b.has(t)){let e=x.get(t);t.lastChangedTime>e&&(x.set(t,t.lastChangedTime),i.dispatchEvent({type:"planechanged",data:t}))}else b.add(t),x.set(t,n.lastChangedTime),i.dispatchEvent({type:"planeadded",data:t})}p=null})),this.setAnimationLoop=function(e){I=e},this.dispose=function(){}}};function np(e,t){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,n.side===sa&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),n.side===sa&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);let r,a,s=t.get(n).envMap;if(s&&(i.envMap.value=s,i.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;let t=!0!==e.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*t}n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.iridescenceMap?r=n.iridescenceMap:n.iridescenceThicknessMap?r=n.iridescenceThicknessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),i.uvTransform.value.copy(r.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),i.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(t,i){i.color.getRGB(t.fogColor.value,hh(e)),i.isFog?(t.fogNear.value=i.near,t.fogFar.value=i.far):i.isFogExp2&&(t.fogDensity.value=i.density)},refreshMaterialUniforms:function(e,n,r,a,s){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(e,n):n.isMeshToonMaterial?(i(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,n)):n.isMeshPhongMaterial?(i(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,n)):n.isMeshStandardMaterial?(i(e,n),function(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}(e,n),n.isMeshPhysicalMaterial&&function(e,t,i){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap)),t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===sa&&e.clearcoatNormalScale.value.negate())),t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap)),t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=i.texture,e.transmissionSamplerSize.value.set(i.width,i.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor)),e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,n,s)):n.isMeshMatcapMaterial?(i(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,n)):n.isMeshDepthMaterial?i(e,n):n.isMeshDistanceMaterial?(i(e,n),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?i(e,n):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){let r;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?r=t.map:t.alphaMap&&(r=t.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix))}(e,n,r,a):n.isSpriteMaterial?function(e,t){let i;e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.alphaTest>0&&(e.alphaTest.value=t.alphaTest),t.map?i=t.map:t.alphaMap&&(i=t.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function rp(e,t,i,n){let r={},a={},s=[],o=i.isWebGL2?e.getParameter(35375):0;function l(e,t,i){let n=e.value;if(void 0===i[t]){if("number"==typeof n)i[t]=n;else{let e=Array.isArray(n)?n:[n],r=[];for(let t=0;t<e.length;t++)r.push(e[t].clone());i[t]=r}return!0}if("number"==typeof n){if(i[t]!==n)return i[t]=n,!0}else{let e=Array.isArray(i[t])?i[t]:[i[t]],r=Array.isArray(n)?n:[n];for(let t=0;t<e.length;t++){let i=e[t];if(!1===i.equals(r[t]))return i.copy(r[t]),!0}}return!1}function c(e){let t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function h(t){let i=t.target;i.removeEventListener("dispose",h);let n=s.indexOf(i.__bindingPointIndex);s.splice(n,1),e.deleteBuffer(r[i.id]),delete r[i.id],delete a[i.id]}return{bind:function(e,t){let i=t.program;n.uniformBlockBinding(e,i)},update:function(i,d){let u=r[i.id];void 0===u&&(function(e){let t=e.uniforms,i=0,n=16,r=0;for(let a=0,s=t.length;a<s;a++){let e=t[a],s={boundary:0,storage:0},o=Array.isArray(e.value)?e.value:[e.value];for(let t=0,i=o.length;t<i;t++){let e=c(o[t]);s.boundary+=e.boundary,s.storage+=e.storage}if(e.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=i,a>0){r=i%n,0!==r&&n-r-s.boundary<0&&(i+=n-r,e.__offset=i)}i+=s.storage}r=i%n,r>0&&(i+=n-r),e.__size=i,e.__cache={}}(i),u=function(t){let i=function(){for(let e=0;e<o;e++)if(-1===s.indexOf(e))return s.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=i;let n=e.createBuffer(),r=t.__size,a=t.usage;return e.bindBuffer(35345,n),e.bufferData(35345,r,a),e.bindBuffer(35345,null),e.bindBufferBase(35345,i,n),n}(i),r[i.id]=u,i.addEventListener("dispose",h));let p=d.program;n.updateUBOMapping(i,p);let f=t.render.frame;a[i.id]!==f&&(function(t){let i=r[t.id],n=t.uniforms,a=t.__cache;e.bindBuffer(35345,i);for(let r=0,s=n.length;r<s;r++){let t=n[r];if(!0===l(t,r,a)){let i=t.__offset,n=Array.isArray(t.value)?t.value:[t.value],r=0;for(let a=0;a<n.length;a++){let s=n[a],o=c(s);"number"==typeof s?(t.__data[0]=s,e.bufferSubData(35345,i+r,t.__data)):s.isMatrix3?(t.__data[0]=s.elements[0],t.__data[1]=s.elements[1],t.__data[2]=s.elements[2],t.__data[3]=s.elements[0],t.__data[4]=s.elements[3],t.__data[5]=s.elements[4],t.__data[6]=s.elements[5],t.__data[7]=s.elements[0],t.__data[8]=s.elements[6],t.__data[9]=s.elements[7],t.__data[10]=s.elements[8],t.__data[11]=s.elements[0]):(s.toArray(t.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(35345,i,t.__data)}}e.bindBuffer(35345,null)}(i),a[i.id]=f)},dispose:function(){for(let t in r)e.deleteBuffer(r[t]);s=[],r={},a={}}}}function ap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;let t,i=void 0!==e.canvas?e.canvas:function(){let e=Xo("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,o=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==n?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let d=null,u=null,p=[],f=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=fo,this.physicallyCorrectLights=!1,this.toneMapping=ja,this.toneMappingExposure=1;let m=this,g=!1,v=0,y=0,b=null,x=-1,w=null,_=new dl,S=new dl,A=null,E=i.width,C=i.height,M=1,P=null,T=null,D=new dl(0,0,E,C),R=new dl(0,0,E,C),O=!1,I=new Eh,k=!1,L=!1,F=null,B=new ql,N=new jo,z=new gl,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function j(){return null===b?M:1}let V,G,H,W,q,X,Y,Q,K,Z,J,$,ee,te,ie,ne,re,ae,se,oe,le,ce,he,de,ue=n;function pe(e,t){for(let n=0;n<e.length;n++){let r=e[n],a=i.getContext(r,t);if(null!==a)return a}return null}try{let e={alpha:!0,depth:r,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine","three.js r".concat(Yr)),i.addEventListener("webglcontextlost",ge,!1),i.addEventListener("webglcontextrestored",ve,!1),i.addEventListener("webglcontextcreationerror",ye,!1),null===ue){let t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ue=pe(t,e),null===ue)throw pe(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(De){throw console.error("THREE.WebGLRenderer: "+De.message),De}function fe(){V=new ed(ue),G=new Fh(ue,V,e),V.init(G),ce=new Ku(ue,V,G),H=new Yu(ue,V,G),W=new nd,q=new Ou,X=new Qu(ue,V,H,q,G,ce,W),Y=new Nh(m),Q=new $h(m),K=new Mh(ue,G),he=new kh(ue,V,K,G),Z=new td(ue,K,W,he),J=new od(ue,Z,K,W),se=new sd(ue,G,X),ne=new Bh(q),$=new Ru(m,Y,Q,V,G,he,ne),ee=new np(m,q),te=new Fu,ie=new Vu(V,G),ae=new Ih(m,Y,Q,H,J,t,o),re=new Xu(m,J,G),de=new rp(ue,W,G,H),oe=new Lh(ue,V,W,G),le=new id(ue,V,W,G),W.programs=$.programs,m.capabilities=G,m.extensions=V,m.properties=q,m.renderLists=te,m.shadowMap=re,m.state=H,m.info=W}fe();let me=new ip(m,ue);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ve(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;let e=W.autoReset,t=re.enabled,i=re.autoUpdate,n=re.needsUpdate,r=re.type;fe(),W.autoReset=e,re.enabled=t,re.autoUpdate=i,re.needsUpdate=n,re.type=r}function ye(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function be(e){let t=e.target;t.removeEventListener("dispose",be),function(e){(function(e){let t=q.get(e).programs;void 0!==t&&(t.forEach((function(e){$.releaseProgram(e)})),e.isShaderMaterial&&$.releaseShaderCache(e))})(e),q.remove(e)}(t)}this.xr=me,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){let e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){let e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(e){void 0!==e&&(M=e,this.setSize(E,C,!1))},this.getSize=function(e){return e.set(E,C)},this.setSize=function(e,t,n){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=e,C=t,i.width=Math.floor(e*M),i.height=Math.floor(t*M),!1!==n&&(i.style.width=e+"px",i.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(E*M,C*M).floor()},this.setDrawingBufferSize=function(e,t,n){E=e,C=t,M=n,i.width=Math.floor(e*n),i.height=Math.floor(t*n),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(_)},this.getViewport=function(e){return e.copy(D)},this.setViewport=function(e,t,i,n){e.isVector4?D.set(e.x,e.y,e.z,e.w):D.set(e,t,i,n),H.viewport(_.copy(D).multiplyScalar(M).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,i,n){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,i,n),H.scissor(S.copy(R).multiplyScalar(M).floor())},this.getScissorTest=function(){return O},this.setScissorTest=function(e){H.setScissorTest(O=e)},this.setOpaqueSort=function(e){P=e},this.setTransparentSort=function(e){T=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(){let e=0;(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(e|=16384),(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&(e|=256),(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(e|=1024),ue.clear(e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ge,!1),i.removeEventListener("webglcontextrestored",ve,!1),i.removeEventListener("webglcontextcreationerror",ye,!1),te.dispose(),ie.dispose(),q.dispose(),Y.dispose(),Q.dispose(),J.dispose(),he.dispose(),de.dispose(),$.dispose(),me.dispose(),me.removeEventListener("sessionstart",we),me.removeEventListener("sessionend",_e),F&&(F.dispose(),F=null),Se.stop()},this.renderBufferDirect=function(e,t,i,n,r,a){null===t&&(t=U);let s=r.isMesh&&r.matrixWorld.determinant()<0,o=function(e,t,i,n,r){!0!==t.isScene&&(t=U),X.resetTextureUnits();let a=t.fog,s=n.isMeshStandardMaterial?t.environment:null,o=null===b?m.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:fo,l=(n.isMeshStandardMaterial?Q:Y).get(n.envMap||s),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i.attributes.tangent,d=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,f=!!i.morphAttributes.color,g=n.toneMapped?m.toneMapping:ja,v=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,y=void 0!==v?v.length:0,_=q.get(n),S=u.state.lights;if(!0===k&&(!0===L||e!==w)){let t=e===w&&n.id===x;ne.setState(n,e,t)}let A=!1;n.version===_.__version?(_.needsLights&&_.lightsStateVersion!==S.state.version||_.outputEncoding!==o||r.isInstancedMesh&&!1===_.instancing||!r.isInstancedMesh&&!0===_.instancing||r.isSkinnedMesh&&!1===_.skinning||!r.isSkinnedMesh&&!0===_.skinning||_.envMap!==l||!0===n.fog&&_.fog!==a||void 0!==_.numClippingPlanes&&(_.numClippingPlanes!==ne.numPlanes||_.numIntersection!==ne.numIntersection)||_.vertexAlphas!==c||_.vertexTangents!==h||_.morphTargets!==d||_.morphNormals!==p||_.morphColors!==f||_.toneMapping!==g||!0===G.isWebGL2&&_.morphTargetsCount!==y)&&(A=!0):(A=!0,_.__version=n.version);let E=_.currentProgram;!0===A&&(E=Pe(n,t,r));let P=!1,T=!1,D=!1,R=E.getUniforms(),O=_.uniforms;if(H.useProgram(E.program)&&(P=!0,T=!0,D=!0),n.id!==x&&(x=n.id,T=!0),P||w!==e){if(R.setValue(ue,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&R.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,T=!0,D=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){let t=R.map.cameraPosition;void 0!==t&&t.setValue(ue,z.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&R.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&R.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(r.isSkinnedMesh){R.setOptional(ue,r,"bindMatrix"),R.setOptional(ue,r,"bindMatrixInverse");let e=r.skeleton;e&&(G.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(ue,"boneTexture",e.boneTexture,X),R.setValue(ue,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let I=i.morphAttributes;if((void 0!==I.position||void 0!==I.normal||void 0!==I.color&&!0===G.isWebGL2)&&se.update(r,i,n,E),(T||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,R.setValue(ue,"receiveShadow",r.receiveShadow)),n.isMeshGouraudMaterial&&null!==n.envMap&&(O.envMap.value=l,O.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1),T&&(R.setValue(ue,"toneMappingExposure",m.toneMappingExposure),_.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(O,D),a&&!0===n.fog&&ee.refreshFogUniforms(O,a),ee.refreshMaterialUniforms(O,n,M,C,F),du.upload(ue,_.uniformsList,O,X)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(du.upload(ue,_.uniformsList,O,X),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&R.setValue(ue,"center",r.center),R.setValue(ue,"modelViewMatrix",r.modelViewMatrix),R.setValue(ue,"normalMatrix",r.normalMatrix),R.setValue(ue,"modelMatrix",r.matrixWorld),r.previousModelViewMatrix&&R.setValue(ue,"previousModelViewMatrix",r.previousModelViewMatrix),e.previousProjectionMatrix&&R.setValue(ue,"previousProjectionMatrix",e.previousProjectionMatrix),n.isShaderMaterial||n.isRawShaderMaterial){let e=n.uniformsGroups;for(let t=0,i=e.length;t<i;t++)if(G.isWebGL2){let i=e[t];de.update(i,E),de.bind(i,E)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return E}(e,t,i,n,r);H.setMaterial(n,s);let l=i.index,c=1;!0===n.wireframe&&(l=Z.getWireframeAttribute(i),c=2);let h=i.drawRange,d=i.attributes.position,p=h.start*c,f=(h.start+h.count)*c;null!==a&&(p=Math.max(p,a.start*c),f=Math.min(f,(a.start+a.count)*c)),null!==l?(p=Math.max(p,0),f=Math.min(f,l.count)):null!=d&&(p=Math.max(p,0),f=Math.min(f,d.count));let g=f-p;if(g<0||g===1/0)return;he.setup(r,n,o,i,l);let v,y=oe;if(null!==l&&(v=K.get(l),y=le,y.setIndex(v)),r.isMesh)!0===n.wireframe?(H.setLineWidth(n.wireframeLinewidth*j()),y.setMode(1)):y.setMode(4);else if(r.isLine){let e=n.linewidth;void 0===e&&(e=1),H.setLineWidth(e*j()),r.isLineSegments?y.setMode(1):r.isLineLoop?y.setMode(2):y.setMode(3)}else r.isPoints?y.setMode(0):r.isSprite&&y.setMode(4);if(r.isInstancedMesh)y.renderInstances(p,g,r.count);else if(i.isInstancedBufferGeometry){let e=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,t=Math.min(i.instanceCount,e);y.renderInstances(p,g,t)}else y.render(p,g)},this.compile=function(e,t){function i(e,t,i){!0===e.transparent&&e.side===oa&&!1===e.forceSinglePass?(e.side=sa,e.needsUpdate=!0,Pe(e,t,i),e.side=aa,e.needsUpdate=!0,Pe(e,t,i),e.side=oa):Pe(e,t,i)}u=ie.get(e),u.init(),f.push(u),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights(m.physicallyCorrectLights),e.traverse((function(t){let n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){i(n[r],e,t)}else i(n,e,t)})),f.pop(),u=null};let xe=null;function we(){Se.stop()}function _e(){Se.start()}let Se=new Ch;function Ae(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||I.intersectsSprite(e)){n&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);let t=J.update(e),r=e.material;r.visible&&d.push(e,t,r,i,z.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||I.intersectsObject(e))){n&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(B);let t=J.update(e),r=e.material;if(Array.isArray(r)){let n=t.groups;for(let a=0,s=n.length;a<s;a++){let s=n[a],o=r[s.materialIndex];o&&o.visible&&d.push(e,t,o,i,z.z,s)}}else r.visible&&d.push(e,t,r,i,z.z,null)}let r=e.children;for(let a=0,s=r.length;a<s;a++)Ae(r[a],t,i,n)}function Ee(e,t,i,n){let r=e.opaque,a=e.transmissive,o=e.transparent;u.setupLightsView(i),!0===k&&ne.setGlobalState(m.clippingPlanes,i),a.length>0&&function(e,t,i){let n=G.isWebGL2;null===F&&(F=new ul(1,1,{generateMipmaps:!0,type:V.has("EXT_color_buffer_half_float")?fs:os,minFilter:ss,samples:n&&!0===s?4:0})),m.getDrawingBufferSize(N),n?F.setSize(N.x,N.y):F.setSize(Bo(N.x),Bo(N.y));let r=m.getRenderTarget();m.setRenderTarget(F),m.clear();let a=m.toneMapping;m.toneMapping=ja,Ce(e,t,i),m.toneMapping=a,X.updateMultisampleRenderTarget(F),X.updateRenderTargetMipmap(F),m.setRenderTarget(r)}(r,t,i),n&&H.viewport(_.copy(n)),r.length>0&&Ce(r,t,i),a.length>0&&Ce(a,t,i),o.length>0&&Ce(o,t,i),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function Ce(e,t,i){let n=!0===t.isScene?t.overrideMaterial:null;for(let r=0,a=e.length;r<a;r++){let a=e[r],s=a.object,o=a.geometry,l=null===n?a.material:n,c=a.group;s.layers.test(i.layers)&&Me(s,t,i,o,l,c)}}function Me(e,t,i,n,r,a){e.onBeforeRender(m,t,i,n,r,a),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),r.onBeforeRender(m,t,i,n,e,a),!0===r.transparent&&r.side===oa&&!1===r.forceSinglePass?(r.side=sa,r.needsUpdate=!0,m.renderBufferDirect(i,t,n,r,e,a),r.side=aa,r.needsUpdate=!0,m.renderBufferDirect(i,t,n,r,e,a),r.side=oa):m.renderBufferDirect(i,t,n,r,e,a),e.onAfterRender(m,t,i,n,r,a)}function Pe(e,t,i){!0!==t.isScene&&(t=U);let n=q.get(e),r=u.state.lights,a=u.state.shadowsArray,s=r.state.version,o=$.getParameters(e,r.state,a,t,i),l=$.getProgramCacheKey(o),c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?Q:Y).get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",be),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===s)return Te(e,o),h}else o.uniforms=$.getUniforms(e),e.onBuild(i,o,m),e.onBeforeCompile(o,m),h=$.acquireProgram(o,l),c.set(l,h),n.uniforms=o.uniforms;let d=n.uniforms;(!e.isShaderMaterial&&!e.isRawShaderMaterial||!0===e.clipping)&&(d.clippingPlanes=ne.uniform),Te(e,o),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=s,n.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotLightMatrix.value=r.state.spotLightMatrix,d.spotLightMap.value=r.state.spotLightMap,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix);let p=h.getUniforms(),f=du.seqWithValue(p.seq,d);return n.currentProgram=h,n.uniformsList=f,h}function Te(e,t){let i=q.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphColors=t.morphColors,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents,i.toneMapping=t.toneMapping}Se.setAnimationLoop((function(e){xe&&xe(e)})),typeof self<"u"&&Se.setContext(self),this.setAnimationLoop=function(e){xe=e,me.setAnimationLoop(e),null===e?Se.stop():Se.start()},me.addEventListener("sessionstart",we),me.addEventListener("sessionend",_e),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(m,e,t,b),u=ie.get(e,f.length),u.init(),f.push(u),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),I.setFromProjectionMatrix(B),L=this.localClippingEnabled,k=ne.init(this.clippingPlanes,L),d=te.get(e,p.length),d.init(),p.push(d),Ae(e,t,0,m.sortObjects),d.finish(),!0===m.sortObjects&&d.sort(P,T),!0===k&&ne.beginShadows();let i=u.state.shadowsArray;if(re.render(i,e,t),!0===k&&ne.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(d,e),u.setupLights(m.physicallyCorrectLights),t.isArrayCamera){let i=t.cameras;for(let t=0,n=i.length;t<n;t++){let n=i[t];Ee(d,e,n,n.viewport)}}else Ee(d,e,t);null!==b&&(X.updateMultisampleRenderTarget(b),X.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(m,e,t),he.resetDefaultState(),x=-1,w=null,f.pop(),u=f.length>0?f[f.length-1]:null,p.pop(),d=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(e,t,i){q.get(e.texture).__webglTexture=t,q.get(e.depthTexture).__webglTexture=i;let n=q.get(e);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===V.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){let i=q.get(e);i.__webglFramebuffer=t,i.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=e,v=t,y=i;let n=!0,r=null,a=!1,s=!1;if(e){let i=q.get(e);void 0!==i.__useDefaultFramebuffer?(H.bindFramebuffer(36160,null),n=!1):void 0===i.__webglFramebuffer?X.setupRenderTarget(e):i.__hasExternalTextures&&X.rebindTextures(e,q.get(e.texture).__webglTexture,q.get(e.depthTexture).__webglTexture);let o=e.texture;(o.isData3DTexture||o.isDataArrayTexture||o.isCompressedArrayTexture)&&(s=!0);let l=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=l[t],a=!0):r=G.isWebGL2&&e.samples>0&&!1===X.useMultisampledRTT(e)?q.get(e).__webglMultisampledFramebuffer:l,_.copy(e.viewport),S.copy(e.scissor),A=e.scissorTest}else _.copy(D).multiplyScalar(M).floor(),S.copy(R).multiplyScalar(M).floor(),A=O;if(H.bindFramebuffer(36160,r)&&G.drawBuffers&&n&&H.drawBuffers(e,r),H.viewport(_),H.scissor(S),H.setScissorTest(A),a){let n=q.get(e.texture);ue.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(s){let n=q.get(e.texture),r=t||0;ue.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}x=-1},this.readRenderTargetPixels=function(e,t,i,n,r,a,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){H.bindFramebuffer(36160,o);try{let s=e.texture,o=s.format,l=s.type;if(o!==bs&&ce.convert(o)!==ue.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");let c=l===fs&&(V.has("EXT_color_buffer_half_float")||G.isWebGL2&&V.has("EXT_color_buffer_float"));if(l!==os&&ce.convert(l)!==ue.getParameter(35738)&&(l!==ps||!(G.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float")))&&!c)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-n&&i>=0&&i<=e.height-r&&ue.readPixels(t,i,n,r,ce.convert(o),ce.convert(l),a)}finally{let e=null!==b?q.get(b).__webglFramebuffer:null;H.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Math.pow(2,-i),r=Math.floor(t.image.width*n),a=Math.floor(t.image.height*n);X.setTexture2D(t,0),ue.copyTexSubImage2D(3553,i,0,0,e.x,e.y,r,a),H.unbindTexture()},this.copyTextureToTexture=function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=t.image.width,a=t.image.height,s=ce.convert(i.format),o=ce.convert(i.type);X.setTexture2D(i,0),ue.pixelStorei(37440,i.flipY),ue.pixelStorei(37441,i.premultiplyAlpha),ue.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ue.texSubImage2D(3553,n,e.x,e.y,r,a,s,o,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):ue.texSubImage2D(3553,n,e.x,e.y,s,o,t.image),0===n&&i.generateMipmaps&&ue.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");let a,s=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,l=e.max.z-e.min.z+1,c=ce.convert(n.format),h=ce.convert(n.type);if(n.isData3DTexture)X.setTexture3D(n,0),a=32879;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(n,0),a=35866}ue.pixelStorei(37440,n.flipY),ue.pixelStorei(37441,n.premultiplyAlpha),ue.pixelStorei(3317,n.unpackAlignment);let d=ue.getParameter(3314),u=ue.getParameter(32878),p=ue.getParameter(3316),f=ue.getParameter(3315),g=ue.getParameter(32877),v=i.isCompressedTexture?i.mipmaps[0]:i.image;ue.pixelStorei(3314,v.width),ue.pixelStorei(32878,v.height),ue.pixelStorei(3316,e.min.x),ue.pixelStorei(3315,e.min.y),ue.pixelStorei(32877,e.min.z),i.isDataTexture||i.isData3DTexture?ue.texSubImage3D(a,r,t.x,t.y,t.z,s,o,l,c,h,v.data):i.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ue.compressedTexSubImage3D(a,r,t.x,t.y,t.z,s,o,l,c,v.data)):ue.texSubImage3D(a,r,t.x,t.y,t.z,s,o,l,c,h,v),ue.pixelStorei(3314,d),ue.pixelStorei(32878,u),ue.pixelStorei(3316,p),ue.pixelStorei(3315,f),ue.pixelStorei(32877,g),0===r&&n.generateMipmaps&&ue.generateMipmap(a),H.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?X.setTextureCube(e,0):e.isData3DTexture?X.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?X.setTexture2DArray(e,0):X.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){v=0,y=0,b=null,H.reset(),he.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class extends ap{}).prototype.isWebGL1Renderer=!0;var sp=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;this.isFog=!0,this.name="",this.color=new rl(e),this.near=t,this.far=i}clone(){return new sp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},op=class extends vc{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}},lp=class{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=So,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ro()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,r=this.stride;n<r;n++)this.array[e+n]=t.array[i+n];return this}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ro()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ro()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},cp=new gl,hp=class{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)cp.fromBufferAttribute(this,t),cp.applyMatrix4(e),this.setXYZ(t,cp.x,cp.y,cp.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)cp.fromBufferAttribute(this,t),cp.applyNormalMatrix(e),this.setXYZ(t,cp.x,cp.y,cp.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)cp.fromBufferAttribute(this,t),cp.transformDirection(e),this.setXYZ(t,cp.x,cp.y,cp.z);return this}setX(e,t){return this.normalized&&(t=zo(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=zo(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=zo(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=zo(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=No(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=No(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=No(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=No(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=zo(t,this.array),i=zo(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=zo(t,this.array),i=zo(i,this.array),n=zo(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=zo(t,this.array),i=zo(i,this.array),n=zo(n,this.array),r=zo(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=r,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new kc(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hp(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let t=0;t<this.count;t++){let i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},dp=class extends vc{constructor(){super(),this.isBone=!0,this.type="Bone"}},up=class extends hl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;super(null,arguments.length>5?arguments[5]:void 0,arguments.length>6?arguments[6]:void 0,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:ts,arguments.length>9&&void 0!==arguments[9]?arguments[9]:ts,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>10?arguments[10]:void 0,arguments.length>11?arguments[11]:void 0),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},pp=new ql,fp=new ql,mp=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=Ro(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new ql)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){let t=new ql;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){let t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){let e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let r=0,a=e.length;r<a;r++){let n=e[r]?e[r].matrixWorld:fp;pp.multiplyMatrices(n,t[r]),pp.toArray(i,16*r)}null!==n&&(n.needsUpdate=!0)}clone(){return new mp(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Fo(e),e=Math.max(e,4);let t=new Float32Array(e*e*4);t.set(this.boneMatrices);let i=new up(t,e,e,bs,ps);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){let i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){let n=e.bones[i],r=t[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new dp),this.bones.push(r),this.boneInverses.push((new ql).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){let e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;let t=this.bones,i=this.boneInverses;for(let n=0,r=t.length;n<r;n++){let r=t[n];e.bones.push(r.uuid);let a=i[n];e.boneInverses.push(a.toArray())}return e}},gp=class extends kc{constructor(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}},vp=new ql,yp=new ql,bp=[],xp=new ql,wp=new ah,_p=class extends ah{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new gp(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let n=0;n<i;n++)this.setMatrixAt(n,xp)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){let i=this.matrixWorld,n=this.count;if(wp.geometry=this.geometry,wp.material=this.material,void 0!==wp.material)for(let r=0;r<n;r++){this.getMatrixAt(r,vp),yp.multiplyMatrices(i,vp),wp.matrixWorld=yp,wp.raycast(e,bp);for(let e=0,i=bp.length;e<i;e++){let i=bp[e];i.instanceId=r,i.object=this,t.push(i)}bp.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new gp(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},Sp=class extends Dc{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new rl(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}},Ap=new gl,Ep=new gl,Cp=new ql,Mp=new Wl,Pp=new Bl,Tp=class extends vc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Wc,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Sp;super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)Ap.fromBufferAttribute(t,e-1),Ep.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=Ap.distanceTo(Ep);e.setAttribute("lineDistance",new Bc(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){let i=this.geometry,n=this.matrixWorld,r=e.params.Line.threshold,a=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Pp.copy(i.boundingSphere),Pp.applyMatrix4(n),Pp.radius+=r,!1===e.ray.intersectsSphere(Pp))return;Cp.copy(n).invert(),Mp.copy(e.ray).applyMatrix4(Cp);let s=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=s*s,l=new gl,c=new gl,h=new gl,d=new gl,u=this.isLineSegments?2:1,p=i.index,f=i.attributes.position;if(null!==p){for(let i=Math.max(0,a.start),n=Math.min(p.count,a.start+a.count)-1;i<n;i+=u){let n=p.getX(i),r=p.getX(i+1);if(l.fromBufferAttribute(f,n),c.fromBufferAttribute(f,r),Mp.distanceSqToSegment(l,c,d,h)>o)continue;d.applyMatrix4(this.matrixWorld);let a=e.ray.origin.distanceTo(d);a<e.near||a>e.far||t.push({distance:a,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,a.start),n=Math.min(f.count,a.start+a.count)-1;i<n;i+=u){if(l.fromBufferAttribute(f,i),c.fromBufferAttribute(f,i+1),Mp.distanceSqToSegment(l,c,d,h)>o)continue;d.applyMatrix4(this.matrixWorld);let n=e.ray.origin.distanceTo(d);n<e.near||n>e.far||t.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){let i=e[t[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=i.length;e<t;e++){let t=i[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}},Dp=new gl,Rp=new gl,Op=class extends Tp{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(null===e.index){let t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)Dp.fromBufferAttribute(t,e),Rp.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+Dp.distanceTo(Rp);e.setAttribute("lineDistance",new Bc(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},Ip=class extends hl{constructor(e,t,i,n,r,a,s,o,l){super(e,t,i,n,r,a,s,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==a?a:rs,this.magFilter=void 0!==r?r:rs,this.generateMipmaps=!1;let c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},kp=class extends hl{constructor(e,t,i,n,r,a,s,o,l){super(e,t,i,n,r,a,s,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},Lp=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t,i=[],n=this.getPoint(0),r=0;i.push(0);for(let a=1;a<=e;a++)t=this.getPoint(a/e),r+=t.distanceTo(n),i.push(r),n=t;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let i,n=this.getLengths(),r=0,a=n.length;i=t||e*n[a-1];let s,o=0,l=a-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),s=n[r]-i,s<0)o=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]===i)return r/(a-1);let c=n[r];return(r+(i-c)/(n[r+1]-c))/(a-1)}getTangent(e,t){let i=e-1e-4,n=e+1e-4;i<0&&(i=0),n>1&&(n=1);let r=this.getPoint(i),a=this.getPoint(n),s=t||(r.isVector2?new jo:new gl);return s.copy(a).sub(r).normalize(),s}getTangentAt(e,t){let i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){let i=new gl,n=[],r=[],a=[],s=new gl,o=new ql;for(let u=0;u<=e;u++){let t=u/e;n[u]=this.getTangentAt(t,new gl)}r[0]=new gl,a[0]=new gl;let l=Number.MAX_VALUE,c=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),d<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],s),a[0].crossVectors(n[0],r[0]);for(let u=1;u<=e;u++){if(r[u]=r[u-1].clone(),a[u]=a[u-1].clone(),s.crossVectors(n[u-1],n[u]),s.length()>Number.EPSILON){s.normalize();let e=Math.acos(Oo(n[u-1].dot(n[u]),-1,1));r[u].applyMatrix4(o.makeRotationAxis(s,e))}a[u].crossVectors(n[u],r[u])}if(!0===t){let t=Math.acos(Oo(r[0].dot(r[e]),-1,1));t/=e,n[0].dot(s.crossVectors(r[0],r[e]))>0&&(t=-t);for(let i=1;i<=e;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],t*i)),a[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:a}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},Fp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=s,this.aRotation=o}getPoint(e,t){let i=t||new jo,n=2*Math.PI,r=this.aEndAngle-this.aStartAngle,a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0===this.aClockwise&&!a&&(r===n?r=-n:r-=n);let s=this.aStartAngle+e*r,o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){let e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};function Bp(){let e=0,t=0,i=0,n=0;function r(r,a,s,o){e=r,t=s,i=-3*r+3*a-2*s-o,n=2*r-2*a+s+o}return{initCatmullRom:function(e,t,i,n,a){r(t,i,a*(i-e),a*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,a,s,o){let l=(t-e)/a-(i-e)/(a+s)+(i-t)/s,c=(i-t)/s-(n-t)/(s+o)+(n-i)/o;l*=s,c*=s,r(t,i,l,c)},calc:function(r){let a=r*r;return e+t*r+i*a+n*(a*r)}}}var Np=new gl,zp=new Bp,Up=new Bp,jp=new Bp;function Vp(e,t,i,n,r){let a=.5*(n-t),s=.5*(r-i),o=e*e;return(2*i-2*n+a+s)*(e*o)+(-3*i+3*n-2*a-s)*o+a*e+i}function Gp(e,t,i,n){return function(e,t){let i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function Hp(e,t,i,n,r){return function(e,t){let i=1-e;return i*i*i*t}(e,t)+function(e,t){let i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,r)}var Wp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new jo,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new jo;super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(Hp(e,i.x,n.x,r.x,a.x),Hp(e,i.y,n.y,r.y,a.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},qp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gl,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new gl;super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl,i=this.v0,n=this.v1,r=this.v2,a=this.v3;return t.set(Hp(e,i.x,n.x,r.x,a.x),Hp(e,i.y,n.y,r.y,a.y),Hp(e,i.z,n.z,r.z,a.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}},Xp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo;super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let i=t||new jo;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Yp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl;super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl;return 1===e?t.copy(this.v2):(t.copy(this.v2).sub(this.v1),t.multiplyScalar(e).add(this.v1)),t}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Qp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new jo;super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,i=this.v0,n=this.v1,r=this.v2;return t.set(Gp(e,i.x,n.x,r.x),Gp(e,i.y,n.y,r.y)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Kp=class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,i=this.points,n=(i.length-1)*e,r=Math.floor(n),a=n-r,s=i[0===r?r:r-1],o=i[r],l=i[r>i.length-2?i.length-1:r+1],c=i[r>i.length-3?i.length-1:r+2];return t.set(Vp(a,s.x,o.x,l.x,c.x),Vp(a,s.y,o.y,l.y,c.y)),t}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push((new jo).fromArray(i))}return this}},Zp=Object.freeze({__proto__:null,ArcCurve:class extends Fp{constructor(e,t,i,n,r,a){super(e,t,i,i,n,r,a),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e){let t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl,r=this.points,a=r.length,s=(a-(this.closed?0:1))*e,o=Math.floor(s),l=s-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/a)+1)*a:0===l&&o===a-1&&(o=a-2,l=1),this.closed||o>0?t=r[(o-1)%a]:(Np.subVectors(r[0],r[1]).add(r[0]),t=Np);let c=r[o%a],h=r[(o+1)%a];if(this.closed||o+2<a?i=r[(o+2)%a]:(Np.subVectors(r[a-1],r[a-2]).add(r[a-1]),i=Np),"centripetal"===this.curveType||"chordal"===this.curveType){let e="chordal"===this.curveType?.5:.25,n=Math.pow(t.distanceToSquared(c),e),r=Math.pow(c.distanceToSquared(h),e),a=Math.pow(h.distanceToSquared(i),e);r<1e-4&&(r=1),n<1e-4&&(n=r),a<1e-4&&(a=r),zp.initNonuniformCatmullRom(t.x,c.x,h.x,i.x,n,r,a),Up.initNonuniformCatmullRom(t.y,c.y,h.y,i.y,n,r,a),jp.initNonuniformCatmullRom(t.z,c.z,h.z,i.z,n,r,a)}else"catmullrom"===this.curveType&&(zp.initCatmullRom(t.x,c.x,h.x,i.x,this.tension),Up.initCatmullRom(t.y,c.y,h.y,i.y,this.tension),jp.initCatmullRom(t.z,c.z,h.z,i.z,this.tension));return n.set(zp.calc(l),Up.calc(l),jp.calc(l)),n}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){let i=e.points[t];this.points.push((new gl).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},CubicBezierCurve:Wp,CubicBezierCurve3:qp,EllipseCurve:Fp,LineCurve:Xp,LineCurve3:Yp,QuadraticBezierCurve:Qp,QuadraticBezierCurve3:class extends Lp{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gl;super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl,i=this.v0,n=this.v1,r=this.v2;return t.set(Gp(e,i.x,n.x,r.x),Gp(e,i.y,n.y,r.y),Gp(e,i.z,n.z,r.z)),t}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},SplineCurve:Kp}),Jp=class extends Lp{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Xp(t,e))}getPoint(e,t){let i=e*this.getLength(),n=this.getCurveLengths(),r=0;for(;r<n.length;){if(n[r]>=i){let e=n[r]-i,a=this.curves[r],s=a.getLength(),o=0===s?0:1-e/s;return a.getPointAt(o,t)}r++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=[];for(let n=0,r=this.curves;n<r.length;n++){let a=r[n],s=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,o=a.getPoints(s);for(let t=0;t<o.length;t++){let n=o[t];e&&e.equals(n)||(i.push(n),e=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){let i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){let i=e.curves[t];this.curves.push((new Zp[i.type]).fromJSON(i))}return this}},$p=class extends Jp{constructor(e){super(),this.type="Path",this.currentPoint=new jo,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let i=new Xp(this.currentPoint.clone(),new jo(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){let r=new Qp(this.currentPoint.clone(),new jo(e,t),new jo(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,r,a){let s=new Wp(this.currentPoint.clone(),new jo(e,t),new jo(i,n),new jo(r,a));return this.curves.push(s),this.currentPoint.set(r,a),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),i=new Kp(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,r,a){let s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+s,t+o,i,n,r,a),this}absarc(e,t,i,n,r,a){return this.absellipse(e,t,i,i,n,r,a),this}ellipse(e,t,i,n,r,a,s,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,r,a,s,o),this}absellipse(e,t,i,n,r,a,s,o){let l=new Fp(e,t,i,n,r,a,s,o);if(this.curves.length>0){let e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}},ef=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new jo(0,-.5),new jo(.5,0),new jo(0,.5)],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Oo(n,0,2*Math.PI);let r=[],a=[],s=[],o=[],l=[],c=1/t,h=new gl,d=new jo,u=new gl,p=new gl,f=new gl,m=0,g=0;for(let v=0;v<=e.length-1;v++)switch(v){case 0:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,u.x=1*g,u.y=-m,u.z=0*g,f.copy(u),u.normalize(),o.push(u.x,u.y,u.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[v+1].x-e[v].x,g=e[v+1].y-e[v].y,u.x=1*g,u.y=-m,u.z=0*g,p.copy(u),u.x+=f.x,u.y+=f.y,u.z+=f.z,u.normalize(),o.push(u.x,u.y,u.z),f.copy(p)}for(let v=0;v<=t;v++){let r=i+v*c*n,u=Math.sin(r),p=Math.cos(r);for(let i=0;i<=e.length-1;i++){h.x=e[i].x*u,h.y=e[i].y,h.z=e[i].x*p,a.push(h.x,h.y,h.z),d.x=v/t,d.y=i/(e.length-1),s.push(d.x,d.y);let n=o[3*i+0]*u,r=o[3*i+1],c=o[3*i+0]*p;l.push(n,r,c)}}for(let v=0;v<t;v++)for(let t=0;t<e.length-1;t++){let i=t+v*e.length,n=i,a=i+e.length,s=i+e.length+1,o=i+1;r.push(n,a,o),r.push(s,o,a)}this.setIndex(r),this.setAttribute("position",new Bc(a,3)),this.setAttribute("uv",new Bc(s,2)),this.setAttribute("normal",new Bc(l,3))}static fromJSON(e){return new ef(e.points,e.segments,e.phiStart,e.phiLength)}},tf=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o};let l=this;n=Math.floor(n),r=Math.floor(r);let c=[],h=[],d=[],u=[],p=0,f=[],m=i/2,g=0;function v(i){let r=p,a=new jo,f=new gl,v=0,y=!0===i?e:t,b=!0===i?1:-1;for(let e=1;e<=n;e++)h.push(0,m*b,0),d.push(0,b,0),u.push(.5,.5),p++;let x=p;for(let e=0;e<=n;e++){let t=e/n*o+s,i=Math.cos(t),r=Math.sin(t);f.x=y*r,f.y=m*b,f.z=y*i,h.push(f.x,f.y,f.z),d.push(0,b,0),a.x=.5*i+.5,a.y=.5*r*b+.5,u.push(a.x,a.y),p++}for(let e=0;e<n;e++){let t=r+e,n=x+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}(function(){let a=new gl,v=new gl,y=0,b=(t-e)/i;for(let l=0;l<=r;l++){let c=[],g=l/r,y=g*(t-e)+e;for(let e=0;e<=n;e++){let t=e/n,r=t*o+s,l=Math.sin(r),f=Math.cos(r);v.x=y*l,v.y=-g*i+m,v.z=y*f,h.push(v.x,v.y,v.z),a.set(l,b,f).normalize(),d.push(a.x,a.y,a.z),u.push(t,1-g),c.push(p++)}f.push(c)}for(let e=0;e<n;e++)for(let t=0;t<r;t++){let i=f[t][e],n=f[t+1][e],r=f[t+1][e+1],a=f[t][e+1];c.push(i,n,a),c.push(n,r,a),y+=6}l.addGroup(g,y,0),g+=y})(),!1===a&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Bc(h,3)),this.setAttribute("normal",new Bc(d,3)),this.setAttribute("uv",new Bc(u,2))}static fromJSON(e){return new tf(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},nf=class extends tf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;super(0,e,t,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}static fromJSON(e){return new nf(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},rf=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};let r=[],a=[];function s(e,t,i,n){let r=n+1,a=[];for(let s=0;s<=r;s++){a[s]=[];let n=e.clone().lerp(i,s/r),o=t.clone().lerp(i,s/r),l=r-s;for(let e=0;e<=l;e++)a[s][e]=0===e&&s===r?n:n.clone().lerp(o,e/l)}for(let s=0;s<r;s++)for(let e=0;e<2*(r-s)-1;e++){let t=Math.floor(e/2);e%2===0?(o(a[s][t+1]),o(a[s+1][t]),o(a[s][t])):(o(a[s][t+1]),o(a[s+1][t+1]),o(a[s+1][t]))}}function o(e){r.push(e.x,e.y,e.z)}function l(t,i){let n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(a[t]=e.x-1),0===i.x&&0===i.z&&(a[t]=n/2/Math.PI+.5)}function h(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(function(e){let i=new gl,n=new gl,r=new gl;for(let a=0;a<t.length;a+=3)l(t[a+0],i),l(t[a+1],n),l(t[a+2],r),s(i,n,r,e)})(n),function(e){let t=new gl;for(let i=0;i<r.length;i+=3)t.x=r[i+0],t.y=r[i+1],t.z=r[i+2],t.normalize().multiplyScalar(e),r[i+0]=t.x,r[i+1]=t.y,r[i+2]=t.z}(i),function(){let e=new gl;for(let t=0;t<r.length;t+=3){e.x=r[t+0],e.y=r[t+1],e.z=r[t+2];let i=h(e)/2/Math.PI+.5,n=d(e)/Math.PI+.5;a.push(i,1-n)}(function(){let e=new gl,t=new gl,i=new gl,n=new gl,s=new jo,o=new jo,l=new jo;for(let d=0,u=0;d<r.length;d+=9,u+=6){e.set(r[d+0],r[d+1],r[d+2]),t.set(r[d+3],r[d+4],r[d+5]),i.set(r[d+6],r[d+7],r[d+8]),s.set(a[u+0],a[u+1]),o.set(a[u+2],a[u+3]),l.set(a[u+4],a[u+5]),n.copy(e).add(t).add(i).divideScalar(3);let p=h(n);c(s,u+0,e,p),c(o,u+2,t,p),c(l,u+4,i,p)}})(),function(){for(let e=0;e<a.length;e+=6){let t=a[e+0],i=a[e+2],n=a[e+4],r=Math.max(t,i,n),s=Math.min(t,i,n);r>.9&&s<.1&&(t<.2&&(a[e+0]+=1),i<.2&&(a[e+2]+=1),n<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new Bc(r,3)),this.setAttribute("normal",new Bc(r.slice(),3)),this.setAttribute("uv",new Bc(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new rf(e.vertices,e.indices,e.radius,e.details)}},af=class extends rf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new af(e.radius,e.detail)}},sf=class extends $p{constructor(e){super(e),this.uuid=Ro(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){let i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){let i=e.holes[t];this.holes.push((new $p).fromJSON(i))}return this}},of=function(e,t){let i,n,r,a,s,o,l,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,h=t&&t.length,d=h?t[0]*c:e.length,u=lf(e,0,d,c,!0),p=[];if(!u||u.next===u.prev)return p;if(h&&(u=function(e,t,i,n){let r,a,s,o,l,c=[];for(r=0,a=t.length;r<a;r++)s=t[r]*n,o=r<a-1?t[r+1]*n:e.length,l=lf(e,s,o,n,!1),l===l.next&&(l.steiner=!0),c.push(bf(l));for(c.sort(mf),r=0;r<c.length;r++)i=gf(c[r],i);return i}(e,t,u,c)),e.length>80*c){i=r=e[0],n=a=e[1];for(let t=c;t<d;t+=c)s=e[t],o=e[t+1],s<i&&(i=s),o<n&&(n=o),s>r&&(r=s),o>a&&(a=o);l=Math.max(r-i,a-n),l=0!==l?32767/l:0}return hf(u,p,c,i,n,l,0),p};function lf(e,t,i,n,r){let a,s;if(r===function(e,t,i,n){let r=0;for(let a=t,s=i-n;a<i;a+=n)r+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return r}(e,t,i,n)>0)for(a=t;a<i;a+=n)s=Tf(a,e[a],e[a+1],s);else for(a=i-n;a>=t;a-=n)s=Tf(a,e[a],e[a+1],s);return s&&Sf(s,s.next)&&(Df(s),s=s.next),s}function cf(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!Sf(n,n.next)&&0!==_f(n.prev,n,n.next))n=n.next;else{if(Df(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function hf(e,t,i,n,r,a,s){if(!e)return;!s&&a&&function(e,t,i,n){let r=e;do{0===r.z&&(r.z=yf(r.x,r.y,t,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,i,n,r,a,s,o,l,c=1;do{for(i=e,e=null,a=null,s=0;i;){for(s++,n=i,o=0,t=0;t<c&&(o++,n=n.nextZ,n);t++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(s>1)}(r)}(e,n,r,a);let o,l,c=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,a?uf(e,n,r,a):df(e))t.push(o.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Df(e),e=l.next,c=l.next;else if((e=l)===c){s?1===s?hf(e=pf(cf(e),t,i),t,i,n,r,a,2):2===s&&ff(e,t,i,n,r,a):hf(cf(e),t,i,n,r,a,1);break}}function df(e){let t=e.prev,i=e,n=e.next;if(_f(t,i,n)>=0)return!1;let r=t.x,a=i.x,s=n.x,o=t.y,l=i.y,c=n.y,h=r<a?r<s?r:s:a<s?a:s,d=o<l?o<c?o:c:l<c?l:c,u=r>a?r>s?r:s:a>s?a:s,p=o>l?o>c?o:c:l>c?l:c,f=n.next;for(;f!==t;){if(f.x>=h&&f.x<=u&&f.y>=d&&f.y<=p&&xf(r,o,a,l,s,c,f.x,f.y)&&_f(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function uf(e,t,i,n){let r=e.prev,a=e,s=e.next;if(_f(r,a,s)>=0)return!1;let o=r.x,l=a.x,c=s.x,h=r.y,d=a.y,u=s.y,p=o<l?o<c?o:c:l<c?l:c,f=h<d?h<u?h:u:d<u?d:u,m=o>l?o>c?o:c:l>c?l:c,g=h>d?h>u?h:u:d>u?d:u,v=yf(p,f,t,i,n),y=yf(m,g,t,i,n),b=e.prevZ,x=e.nextZ;for(;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&xf(o,h,l,d,c,u,b.x,b.y)&&_f(b.prev,b,b.next)>=0||(b=b.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&xf(o,h,l,d,c,u,x.x,x.y)&&_f(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=p&&b.x<=m&&b.y>=f&&b.y<=g&&b!==r&&b!==s&&xf(o,h,l,d,c,u,b.x,b.y)&&_f(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==r&&x!==s&&xf(o,h,l,d,c,u,x.x,x.y)&&_f(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function pf(e,t,i){let n=e;do{let r=n.prev,a=n.next.next;!Sf(r,a)&&Af(r,n,n.next,a)&&Mf(r,a)&&Mf(a,r)&&(t.push(r.i/i|0),t.push(n.i/i|0),t.push(a.i/i|0),Df(n),Df(n.next),n=e=a),n=n.next}while(n!==e);return cf(n)}function ff(e,t,i,n,r,a){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&wf(s,e)){let o=Pf(s,e);return s=cf(s,s.next),o=cf(o,o.next),hf(s,t,i,n,r,a,0),void hf(o,t,i,n,r,a,0)}e=e.next}s=s.next}while(s!==e)}function mf(e,t){return e.x-t.x}function gf(e,t){let i=function(e,t){let i,n=t,r=-1/0,a=e.x,s=e.y;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){let e=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=a&&e>r&&(r=e,i=n.x<n.next.x?n:n.next,e===a))return i}n=n.next}while(n!==t);if(!i)return null;let o,l=i,c=i.x,h=i.y,d=1/0;n=i;do{a>=n.x&&n.x>=c&&a!==n.x&&xf(s<h?a:r,s,c,h,s<h?r:a,s,n.x,n.y)&&(o=Math.abs(s-n.y)/(a-n.x),Mf(n,e)&&(o<d||o===d&&(n.x>i.x||n.x===i.x&&vf(i,n)))&&(i=n,d=o)),n=n.next}while(n!==l);return i}(e,t);if(!i)return t;let n=Pf(i,e);return cf(n,n.next),cf(i,i.next)}function vf(e,t){return _f(e.prev,e,t.prev)<0&&_f(t.next,e,e.next)<0}function yf(e,t,i,n,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function bf(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function xf(e,t,i,n,r,a,s,o){return(r-s)*(t-o)>=(e-s)*(a-o)&&(e-s)*(n-o)>=(i-s)*(t-o)&&(i-s)*(a-o)>=(r-s)*(n-o)}function wf(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Af(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Mf(e,t)&&Mf(t,e)&&function(e,t){let i=e,n=!1,r=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(_f(e.prev,e,t.prev)||_f(e,t.prev,t))||Sf(e,t)&&_f(e.prev,e,e.next)>0&&_f(t.prev,t,t.next)>0)}function _f(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Sf(e,t){return e.x===t.x&&e.y===t.y}function Af(e,t,i,n){let r=Cf(_f(e,t,i)),a=Cf(_f(e,t,n)),s=Cf(_f(i,n,e)),o=Cf(_f(i,n,t));return!!(r!==a&&s!==o||0===r&&Ef(e,i,t)||0===a&&Ef(e,n,t)||0===s&&Ef(i,e,n)||0===o&&Ef(i,t,n))}function Ef(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Cf(e){return e>0?1:e<0?-1:0}function Mf(e,t){return _f(e.prev,e,e.next)<0?_f(e,t,e.next)>=0&&_f(e,e.prev,t)>=0:_f(e,t,e.prev)<0||_f(e,e.next,t)<0}function Pf(e,t){let i=new Rf(e.i,e.x,e.y),n=new Rf(t.i,t.x,t.y),r=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function Tf(e,t,i,n){let r=new Rf(e,t,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Df(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Rf(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Of=class{static area(e){let t=e.length,i=0;for(let n=t-1,r=0;r<t;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i}static isClockWise(e){return Of.area(e)<0}static triangulateShape(e,t){let i=[],n=[],r=[];If(e),kf(i,e);let a=e.length;t.forEach(If);for(let o=0;o<t.length;o++)n.push(a),a+=t[o].length,kf(i,t[o]);let s=of(i,n);for(let o=0;o<s.length;o+=3)r.push(s.slice(o,o+3));return r}};function If(e){let t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function kf(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var Lf=class extends rf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Lf(e.radius,e.detail)}},Ff=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));let o=Math.min(a+s,Math.PI),l=0,c=[],h=new gl,d=new gl,u=[],p=[],f=[],m=[];for(let g=0;g<=i;g++){let u=[],v=g/i,y=0;0==g&&0==a?y=.5/t:g==i&&o==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){let o=i/t;h.x=-e*Math.cos(n+o*r)*Math.sin(a+v*s),h.y=e*Math.cos(a+v*s),h.z=e*Math.sin(n+o*r)*Math.sin(a+v*s),p.push(h.x,h.y,h.z),d.copy(h).normalize(),f.push(d.x,d.y,d.z),m.push(o+y,1-v),u.push(l++)}c.push(u)}for(let g=0;g<i;g++)for(let e=0;e<t;e++){let t=c[g][e+1],n=c[g][e],r=c[g+1][e],s=c[g+1][e+1];(0!==g||a>0)&&u.push(t,n,s),(g!==i-1||o<Math.PI)&&u.push(n,r,s)}this.setIndex(u),this.setAttribute("position",new Bc(p,3)),this.setAttribute("normal",new Bc(f,3)),this.setAttribute("uv",new Bc(m,2))}static fromJSON(e){return new Ff(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}},Bf=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:48,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);let a=[],s=[],o=[],l=[],c=new gl,h=new gl,d=new gl;for(let u=0;u<=i;u++)for(let a=0;a<=n;a++){let p=a/n*r,f=u/i*Math.PI*2;h.x=(e+t*Math.cos(f))*Math.cos(p),h.y=(e+t*Math.cos(f))*Math.sin(p),h.z=t*Math.sin(f),s.push(h.x,h.y,h.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),d.subVectors(h,c).normalize(),o.push(d.x,d.y,d.z),l.push(a/n),l.push(u/i)}for(let u=1;u<=i;u++)for(let e=1;e<=n;e++){let t=(n+1)*u+e-1,i=(n+1)*(u-1)+e-1,r=(n+1)*(u-1)+e,s=(n+1)*u+e;a.push(t,i,s),a.push(i,r,s)}this.setIndex(a),this.setAttribute("position",new Bc(s,3)),this.setAttribute("normal",new Bc(o,3)),this.setAttribute("uv",new Bc(l,2))}static fromJSON(e){return new Bf(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}},Nf=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:r,q:a},i=Math.floor(i),n=Math.floor(n);let s=[],o=[],l=[],c=[],h=new gl,d=new gl,u=new gl,p=new gl,f=new gl,m=new gl,g=new gl;for(let y=0;y<=i;++y){let s=y/i*r*Math.PI*2;v(s,r,a,e,u),v(s+.01,r,a,e,p),m.subVectors(p,u),g.addVectors(p,u),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=n;++e){let r=e/n*Math.PI*2,a=-t*Math.cos(r),s=t*Math.sin(r);h.x=u.x+(a*g.x+s*f.x),h.y=u.y+(a*g.y+s*f.y),h.z=u.z+(a*g.z+s*f.z),o.push(h.x,h.y,h.z),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(y/i),c.push(e/n)}}for(let y=1;y<=i;y++)for(let e=1;e<=n;e++){let t=(n+1)*(y-1)+(e-1),i=(n+1)*y+(e-1),r=(n+1)*y+e,a=(n+1)*(y-1)+e;s.push(t,i,a),s.push(i,r,a)}function v(e,t,i,n,r){let a=Math.cos(e),s=Math.sin(e),o=i/t*e,l=Math.cos(o);r.x=n*(2+l)*.5*a,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new Bc(o,3)),this.setAttribute("normal",new Bc(l,3)),this.setAttribute("uv",new Bc(c,2))}static fromJSON(e){return new Nf(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}};function zf(e,t,i){return jf(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)}function Uf(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function jf(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Vf(e){let t=e.length,i=new Array(t);for(let n=0;n!==t;++n)i[n]=n;return i.sort((function(t,i){return e[t]-e[i]})),i}function Gf(e,t,i){let n=e.length,r=new e.constructor(n);for(let a=0,s=0;s!==n;++a){let n=i[a]*t;for(let i=0;i!==t;++i)r[s++]=e[n+i]}return r}function Hf(e,t,i,n){let r=1,a=e[0];for(;void 0!==a&&void 0===a[n];)a=e[r++];if(void 0===a)return;let s=a[n];if(void 0!==s)if(Array.isArray(s))do{s=a[n],void 0!==s&&(t.push(a.time),i.push.apply(i,s)),a=e[r++]}while(void 0!==a);else if(void 0!==s.toArray)do{s=a[n],void 0!==s&&(t.push(a.time),s.toArray(i,i.length)),a=e[r++]}while(void 0!==a);else do{s=a[n],void 0!==s&&(t.push(a.time),i.push(s)),a=e[r++]}while(void 0!==a)}var Wf=class{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,i=this._cachedIndex,n=t[i],r=t[i-1];e:{t:{let a;i:{n:if(!(e<n)){for(let a=i+2;;){if(void 0===n){if(e<r)break n;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(r=n,n=t[++i],e<n)break t}a=t.length;break i}if(e>=r)break e;{let s=t[1];e<s&&(i=2,r=s);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===a)break;if(n=r,r=t[--i-1],e>=r)break t}a=i,i=0}}for(;i<a;){let n=i+a>>>1;e<t[n]?a=n:i=n+1}if(n=t[i],r=t[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=e*n;for(let a=0;a!==n;++a)t[a]=i[r+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},qf=class extends Wf{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:co,endingEnd:co}}intervalChanged_(e,t,i){let n=this.parameterPositions,r=e-2,a=e+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case ho:r=e,s=2*t-i;break;case uo:r=n.length-2,s=t+n[r]-n[r+1];break;default:r=e,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case ho:a=e,o=2*i-t;break;case uo:a=1,o=i+n[1]-n[0];break;default:a=e-1,o=t}let l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-s),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=a*c}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,y=(-1-u)*m+(1.5+u)*f+.5*p,b=u*m-u*f;for(let x=0;x!==s;++x)r[x]=g*a[c+x]+v*a[l+x]+y*a[o+x]+b*a[h+x];return r}},Xf=class extends Wf{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=e*s,l=o-s,c=(i-t)/(n-t),h=1-c;for(let d=0;d!==s;++d)r[d]=a[l+d]*h+a[o+d]*c;return r}},Yf=class extends Wf{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}},Qf=class{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Uf(t,this.TimeBufferType),this.values=Uf(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){let t,i=e.constructor;if(i.toJSON!==this.toJSON)t=i.toJSON(e);else{t={name:e.name,times:Uf(e.times,Array),values:Uf(e.values,Array)};let i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}InterpolantFactoryMethodDiscrete(e){return new Yf(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Xf(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new qf(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case so:t=this.InterpolantFactoryMethodDiscrete;break;case oo:t=this.InterpolantFactoryMethodLinear;break;case lo:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){let t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return so;case this.InterpolantFactoryMethodLinear:return oo;case this.InterpolantFactoryMethodSmooth:return lo}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){let t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){let i=this.times,n=i.length,r=0,a=n-1;for(;r!==n&&i[r]<e;)++r;for(;-1!==a&&i[a]>t;)--a;if(++a,0!==r||a!==n){r>=a&&(a=Math.max(a,1),r=a-1);let e=this.getValueSize();this.times=zf(i,r,a),this.values=zf(this.values,r*e,a*e)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let s=0;s!==r;s++){let t=i[s];if("number"==typeof t&&isNaN(t)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,t),e=!1;break}if(null!==a&&a>t){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,t,a),e=!1;break}a=t}if(void 0!==n&&jf(n))for(let s=0,o=n.length;s!==o;++s){let t=n[s];if(isNaN(t)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,t),e=!1;break}}return e}optimize(){let e=zf(this.times),t=zf(this.values),i=this.getValueSize(),n=this.getInterpolation()===lo,r=e.length-1,a=1;for(let s=1;s<r;++s){let r=!1,o=e[s];if(o!==e[s+1]&&(1!==s||o!==e[0]))if(n)r=!0;else{let e=s*i,n=e-i,a=e+i;for(let s=0;s!==i;++s){let i=t[e+s];if(i!==t[n+s]||i!==t[a+s]){r=!0;break}}}if(r){if(s!==a){e[a]=e[s];let n=s*i,r=a*i;for(let e=0;e!==i;++e)t[r+e]=t[n+e]}++a}}if(r>0){e[a]=e[r];for(let e=r*i,n=a*i,s=0;s!==i;++s)t[n+s]=t[e+s];++a}return a!==e.length?(this.times=zf(e,0,a),this.values=zf(t,0,a*i)):(this.times=e,this.values=t),this}clone(){let e=zf(this.times,0),t=zf(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}};Qf.prototype.TimeBufferType=Float32Array,Qf.prototype.ValueBufferType=Float32Array,Qf.prototype.DefaultInterpolation=oo;var Kf=class extends Qf{};Kf.prototype.ValueTypeName="bool",Kf.prototype.ValueBufferType=Array,Kf.prototype.DefaultInterpolation=so,Kf.prototype.InterpolantFactoryMethodLinear=void 0,Kf.prototype.InterpolantFactoryMethodSmooth=void 0;var Zf=class extends Qf{};Zf.prototype.ValueTypeName="color";var Jf=class extends Qf{};Jf.prototype.ValueTypeName="number";var $f=class extends Wf{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){let r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(i-t)/(n-t),l=e*s;for(let c=l+s;l!==c;l+=4)ml.slerpFlat(r,0,a,l-s,a,l,o);return r}},em=class extends Qf{InterpolantFactoryMethodLinear(e){return new $f(this.times,this.values,this.getValueSize(),e)}};em.prototype.ValueTypeName="quaternion",em.prototype.DefaultInterpolation=oo,em.prototype.InterpolantFactoryMethodSmooth=void 0;var tm=class extends Qf{};tm.prototype.ValueTypeName="string",tm.prototype.ValueBufferType=Array,tm.prototype.DefaultInterpolation=so,tm.prototype.InterpolantFactoryMethodLinear=void 0,tm.prototype.InterpolantFactoryMethodSmooth=void 0;var im=class extends Qf{};im.prototype.ValueTypeName="vector";var nm=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:po;this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Ro(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],i=e.tracks,n=1/(e.fps||1);for(let a=0,s=i.length;a!==s;++a)t.push(rm(i[a]).scale(n));let r=new this(e.name,e.duration,t,e.blendMode);return r.uuid=e.uuid,r}static toJSON(e){let t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let r=0,a=i.length;r!==a;++r)t.push(Qf.toJSON(i[r]));return n}static CreateFromMorphTargetSequence(e,t,i,n){let r=t.length,a=[];for(let s=0;s<r;s++){let e=[],o=[];e.push((s+r-1)%r,s,(s+1)%r),o.push(0,1,0);let l=Vf(e);e=Gf(e,1,l),o=Gf(o,1,l),!n&&0===e[0]&&(e.push(r),o.push(o[0])),a.push(new Jf(".morphTargetInfluences["+t[s].name+"]",e,o).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){let t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null}static CreateClipsFromMorphTargetSequences(e,t,i){let n={},r=/^([\w-]*?)([\d]+)$/;for(let s=0,o=e.length;s<o;s++){let t=e[s],i=t.name.match(r);if(i&&i.length>1){let e=i[1],r=n[e];r||(n[e]=r=[]),r.push(t)}}let a=[];for(let s in n)a.push(this.CreateFromMorphTargetSequence(s,n[s],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(e,t,i,n,r){if(0!==i.length){let a=[],s=[];Hf(i,a,s,n),0!==a.length&&r.push(new e(t,a,s))}},n=[],r=e.name||"default",a=e.fps||30,s=e.blendMode,o=e.length||-1,l=e.hierarchy||[];for(let c=0;c<l.length;c++){let e=l[c].keys;if(e&&0!==e.length)if(e[0].morphTargets){let t,i={};for(t=0;t<e.length;t++)if(e[t].morphTargets)for(let n=0;n<e[t].morphTargets.length;n++)i[e[t].morphTargets[n]]=-1;for(let r in i){let i=[],a=[];for(let n=0;n!==e[t].morphTargets.length;++n){let n=e[t];i.push(n.time),a.push(n.morphTarget===r?1:0)}n.push(new Jf(".morphTargetInfluence["+r+"]",i,a))}o=i.length*a}else{let r=".bones["+t[c].name+"]";i(im,r+".position",e,"pos",n),i(em,r+".quaternion",e,"rot",n),i(im,r+".scale",e,"scl",n)}}return 0===n.length?null:new this(r,o,n,s)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){let i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function rm(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Jf;case"vector":case"vector2":case"vector3":case"vector4":return im;case"color":return Zf;case"quaternion":return em;case"bool":case"boolean":return Kf;case"string":return tm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){let t=[],i=[];Hf(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var am={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},sm=class{constructor(e,t,i){let n,r=this,a=!1,s=0,o=0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){o++,!1===a&&void 0!==r.onStart&&r.onStart(e,s,o),a=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,o),s===o&&(a=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){let t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){let i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}},om=new sm,lm=class{constructor(e){this.manager=void 0!==e?e:om,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let i=this;return new Promise((function(n,r){i.load(e,n,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},cm={},hm=class extends Error{constructor(e,t){super(e),this.response=t}},dm=class extends lm{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=am.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==cm[e])return void cm[e].push({onLoad:t,onProgress:i,onError:n});cm[e]=[],cm[e].push({onLoad:t,onProgress:i,onError:n});let a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,o=this.responseType;fetch(a).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||void 0===t.body||void 0===t.body.getReader)return t;let i=cm[e],n=t.body.getReader(),r=t.headers.get("Content-Length")||t.headers.get("X-File-Size"),a=r?parseInt(r):0,s=0!==a,o=0,l=new ReadableStream({start(e){!function t(){n.read().then((n=>{let{done:r,value:l}=n;if(r)e.close();else{o+=l.byteLength;let n=new ProgressEvent("progress",{lengthComputable:s,loaded:o,total:a});for(let e=0,t=i.length;e<t;e++){let t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(l),t()}}))}()}});return new Response(l)}throw new hm('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{let t=/charset="?([^;"\s]*)"?/i.exec(s),i=t&&t[1]?t[1].toLowerCase():void 0,n=new TextDecoder(i);return e.arrayBuffer().then((e=>n.decode(e)))}}})).then((t=>{am.add(e,t);let i=cm[e];delete cm[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onLoad&&n.onLoad(t)}})).catch((t=>{let i=cm[e];if(void 0===i)throw this.manager.itemError(e),t;delete cm[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}},um=class extends lm{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);let r=this,a=am.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout((function(){t&&t(a),r.manager.itemEnd(e)}),0),a;let s=Xo("img");function o(){c(),am.add(e,this),t&&t(this),r.manager.itemEnd(e)}function l(t){c(),n&&n(t),r.manager.itemError(e),r.manager.itemEnd(e)}function c(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(e),s.src=e,s}},pm=class extends lm{constructor(e){super(e)}load(e,t,i,n){let r=new hl,a=new um(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){r.image=e,r.needsUpdate=!0,void 0!==t&&t(r)}),i,n),r}},fm=class extends vc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.isLight=!0,this.type="Light",this.color=new rl(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}},mm=class extends fm{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(vc.DEFAULT_UP),this.updateMatrix(),this.groundColor=new rl(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}},gm=new ql,vm=new gl,ym=new gl,bm=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new jo(512,512),this.map=null,this.mapPass=null,this.matrix=new ql,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Eh,this._frameExtents=new jo(1,1),this._viewportCount=1,this._viewports=[new dl(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,i=this.matrix;vm.setFromMatrixPosition(e.matrixWorld),t.position.copy(vm),ym.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ym),t.updateMatrixWorld(),gm.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gm),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(gm)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){let e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},xm=class extends bm{constructor(){super(new fh(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){let t=this.camera,i=2*Do*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;(i!==t.fov||n!==t.aspect||r!==t.far)&&(t.fov=i,t.aspect=n,t.far=r,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}},wm=class extends fm{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2;super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(vc.DEFAULT_UP),this.updateMatrix(),this.target=new vc,this.distance=i,this.angle=n,this.penumbra=r,this.decay=a,this.map=null,this.shadow=new xm}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},_m=new ql,Sm=new gl,Am=new gl,Em=class extends bm{constructor(){super(new fh(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new jo(4,2),this._viewportCount=6,this._viewports=[new dl(2,1,1,1),new dl(0,1,1,1),new dl(3,1,1,1),new dl(1,1,1,1),new dl(3,0,1,1),new dl(1,0,1,1)],this._cubeDirections=[new gl(1,0,0),new gl(-1,0,0),new gl(0,0,1),new gl(0,0,-1),new gl(0,1,0),new gl(0,-1,0)],this._cubeUps=[new gl(0,1,0),new gl(0,1,0),new gl(0,1,0),new gl(0,1,0),new gl(0,0,1),new gl(0,0,-1)]}updateMatrices(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this.camera,n=this.matrix,r=e.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),Sm.setFromMatrixPosition(e.matrixWorld),i.position.copy(Sm),Am.copy(i.position),Am.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(Am),i.updateMatrixWorld(),n.makeTranslation(-Sm.x,-Sm.y,-Sm.z),_m.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_m)}},Cm=class extends fm{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Em}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}},Mm=class extends bm{constructor(){super(new zh(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},Pm=class extends fm{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(vc.DEFAULT_UP),this.updateMatrix(),this.target=new vc,this.shadow=new Mm}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}},Tm=class extends Wc{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){let e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}},Dm=class extends lm{constructor(e){super(e)}load(e,t,i,n){let r=this,a=new dm(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(e,(function(i){try{t(r.parse(JSON.parse(i)))}catch(xM){n?n(xM):console.error(xM),r.manager.itemError(e)}}),i,n)}parse(e){let t={},i={};function n(e,n){if(void 0!==t[n])return t[n];let r=e.interleavedBuffers[n],a=function(e,t){if(void 0!==i[t])return i[t];let n=e.arrayBuffers[t],r=new Uint32Array(n).buffer;return i[t]=r,r}(e,r.buffer),s=qo(r.type,a),o=new lp(s,r.stride);return o.uuid=r.uuid,t[n]=o,o}let r=e.isInstancedBufferGeometry?new Tm:new Wc,a=e.data.index;if(void 0!==a){let e=qo(a.type,a.array);r.setIndex(new kc(e,1))}let s=e.data.attributes;for(let h in s){let t,i=s[h];if(i.isInterleavedBufferAttribute){let r=n(e.data,i.data);t=new hp(r,i.itemSize,i.offset,i.normalized)}else{let e=qo(i.type,i.array);t=new(i.isInstancedBufferAttribute?gp:kc)(e,i.itemSize,i.normalized)}void 0!==i.name&&(t.name=i.name),void 0!==i.usage&&t.setUsage(i.usage),void 0!==i.updateRange&&(t.updateRange.offset=i.updateRange.offset,t.updateRange.count=i.updateRange.count),r.setAttribute(h,t)}let o=e.data.morphAttributes;if(o)for(let h in o){let t=o[h],i=[];for(let r=0,a=t.length;r<a;r++){let a,s=t[r];if(s.isInterleavedBufferAttribute){let t=n(e.data,s.data);a=new hp(t,s.itemSize,s.offset,s.normalized)}else{let e=qo(s.type,s.array);a=new kc(e,s.itemSize,s.normalized)}void 0!==s.name&&(a.name=s.name),i.push(a)}r.morphAttributes[h]=i}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);let l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let h=0,d=l.length;h!==d;++h){let e=l[h];r.addGroup(e.start,e.count,e.materialIndex)}let c=e.data.boundingSphere;if(void 0!==c){let e=new gl;void 0!==c.center&&e.fromArray(c.center),r.boundingSphere=new Bl(e,c.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}},Rm=class{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Om(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=Om();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function Om(){return(typeof performance>"u"?Date:performance).now()}var Im=class{constructor(e,t,i){let n,r,a;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let i=this.buffer,n=this.valueSize,r=e*n+n,a=this.cumulativeWeight;if(0===a){for(let e=0;e!==n;++e)i[r+e]=i[e];a=t}else{a+=t;let e=t/a;this._mixBufferRegion(i,r,0,e,n)}this.cumulativeWeight=a}accumulateAdditive(e){let t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,i=this.buffer,n=e*t+t,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){let e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-r,t)}a>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let o=t,l=t+t;o!==l;++o)if(i[o]!==i[o+t]){s.setValue(i,n);break}}saveOriginalState(){let e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let r=i,a=n;r!==a;++r)t[r]=t[n+r%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,r){if(n>=.5)for(let a=0;a!==r;++a)e[t+a]=e[i+a]}_slerp(e,t,i,n){ml.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,r){let a=this._workIndex*r;ml.multiplyQuaternionsFlat(e,a,e,t,e,i),ml.slerpFlat(e,t,e,t,e,a,n)}_lerp(e,t,i,n,r){let a=1-n;for(let s=0;s!==r;++s){let r=t+s;e[r]=e[r]*a+e[i+s]*n}}_lerpAdditive(e,t,i,n,r){for(let a=0;a!==r;++a){let r=t+a;e[r]=e[r]+e[i+a]*n}}},km="\\[\\]\\.:\\/",Lm=new RegExp("["+km+"]","g"),Fm="[^"+km+"]",Bm="[^"+km.replace("\\.","")+"]",Nm=/((?:WC+[\/:])*)/.source.replace("WC",Fm),zm=/(WCOD+)?/.source.replace("WCOD",Bm),Um=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Fm),jm=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Fm),Vm=new RegExp("^"+Nm+zm+Um+jm+"$"),Gm=["material","materials","bones","map"],Hm=class{constructor(e,t,i){this.path=t,this.parsedPath=i||Hm.parseTrackName(t),this.node=Hm.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Hm.Composite(e,t,i):new Hm(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Lm,"")}static parseTrackName(e){let t=Vm.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){let e=i.nodeName.substring(n+1);-1!==Gm.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){let i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){let i=function(e){for(let n=0;n<e.length;n++){let r=e[n];if(r.name===t||r.uuid===t)return r;let a=i(r.children);if(a)return a}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,i=t.objectName,n=t.propertyName,r=t.propertyIndex;if(e||(e=Hm.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);e=e.material.map;break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}let a=e[n];if(void 0===a){let i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[r]&&(r=e.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};Hm.Composite=class{constructor(e,t,i){let n=i||Hm.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();let i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){let i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},Hm.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Hm.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Hm.prototype.GetterByBindingType=[Hm.prototype._getValue_direct,Hm.prototype._getValue_array,Hm.prototype._getValue_arrayElement,Hm.prototype._getValue_toArray],Hm.prototype.SetterByBindingTypeAndVersioning=[[Hm.prototype._setValue_direct,Hm.prototype._setValue_direct_setNeedsUpdate,Hm.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Hm.prototype._setValue_array,Hm.prototype._setValue_array_setNeedsUpdate,Hm.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Hm.prototype._setValue_arrayElement,Hm.prototype._setValue_arrayElement_setNeedsUpdate,Hm.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Hm.prototype._setValue_fromArray,Hm.prototype._setValue_fromArray_setNeedsUpdate,Hm.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var Wm=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.blendMode;this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;let r=t.tracks,a=r.length,s=new Array(a),o={endingStart:co,endingEnd:co};for(let l=0;l!==a;++l){let e=r[l].createInterpolant(null);s[l]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){let i=this._clip.duration,n=e._clip.duration,r=n/i,a=i/n;e.warp(1,r,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){let e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){let n=this._mixer,r=n.time,a=this.timeScale,s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);let o=s.parameterPositions,l=s.sampleValues;return o[0]=r,o[1]=r+i,l[0]=e/a,l[1]=t/a,this}stopWarping(){let e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);let r=this._startTime;if(null!==r){let n=(e-r)*i;n<0||0===i?t=0:(this._startTime=null,t=i*n)}t*=this._updateTimeScale(e);let a=this._updateTime(t),s=this._updateWeight(e);if(s>0){let e=this._interpolants,t=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(a),t[i].accumulateAdditive(s);else for(let i=0,r=e.length;i!==r;++i)e[i].evaluate(a),t[i].accumulate(n,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let i=this._weightInterpolant;if(null!==i){let n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,i=this.loop,n=this.time+e,r=this._loopCount,a=i===ao;if(0===e)return-1===r?n:a&&1===(1&r)?t-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===r&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=t||n<0){let i=Math.floor(n/t);n-=t*i,r+=Math.abs(i);let s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){let t=e<0;this._setEndings(t,!t,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(a&&1===(1&r))return t-n}return n}_setEndings(e,t,i){let n=this._interpolantSettings;i?(n.endingStart=ho,n.endingEnd=ho):(n.endingStart=e?this.zeroSlopeAtStart?ho:co:uo,n.endingEnd=t?this.zeroSlopeAtEnd?ho:co:uo)}_scheduleFading(e,t,i){let n=this._mixer,r=n.time,a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);let s=a.parameterPositions,o=a.sampleValues;return s[0]=r,o[0]=t,s[1]=r+e,o[1]=i,this}},qm=new Float32Array(1),Xm=class extends Co{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let i=e._localRoot||this._root,n=e._clip.tracks,r=n.length,a=e._propertyBindings,s=e._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];void 0===c&&(c={},l[o]=c);for(let h=0;h!==r;++h){let e=n[h],r=e.name,l=c[r];if(void 0!==l)++l.referenceCount,a[h]=l;else{if(l=a[h],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,o,r));continue}let n=t&&t._propertyBindings[h].binding.parsedPath;l=new Im(Hm.create(i,r,n),e.ValueTypeName,e.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,o,r),a[h]=l}s[h].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){let t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0===i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){let i=t[e];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){let n=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{let t=a.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[i]=e}_removeInactiveAction(e){let t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;let r=e._clip.uuid,a=this._actionsByClip,s=a[r],o=s.knownActions,l=o[o.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete a[r],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let i=0,n=t.length;i!==n;++i){let e=t[i];0===--e.referenceCount&&this._removeInactiveBinding(e)}}_lendAction(e){let t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackAction(e){let t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_addInactiveBinding(e,t,i){let n=this._bindingsByRootAndName,r=this._bindings,a=n[t];void 0===a&&(a={},n[t]=a),a[i]=e,e._cacheIndex=r.length,r.push(e)}_removeInactiveBinding(e){let t=this._bindings,i=e.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,s=a[n],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete s[r],0===Object.keys(s).length&&delete a[n]}_lendBinding(e){let t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_takeBackBinding(e){let t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,r=t[n];e._cacheIndex=n,t[n]=e,r._cacheIndex=i,t[i]=r}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&(i=new Xf(new Float32Array(2),new Float32Array(2),1,qm),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){let t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,r=t[n];e.__cacheIndex=n,t[n]=e,r.__cacheIndex=i,t[i]=r}clipAction(e,t,i){let n=t||this._root,r=n.uuid,a="string"==typeof e?nm.findByName(n,e):e,s=null!==a?a.uuid:e,o=this._actionsByClip[s],l=null;if(void 0===i&&(i=null!==a?a.blendMode:po),void 0!==o){let e=o.actionByRoot[r];if(void 0!==e&&e.blendMode===i)return e;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;let c=new Wm(this,a,t,i);return this._bindAction(c,l),this._addInactiveAction(c,s,r),c}existingAction(e,t){let i=t||this._root,n=i.uuid,r="string"==typeof e?nm.findByName(i,e):e,a=r?r.uuid:e,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[n]||null}stopAllAction(){let e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;let t=this._actions,i=this._nActiveActions,n=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1;for(let l=0;l!==i;++l)t[l]._update(n,e,r,a);let s=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)s[l].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,i=e.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){let e=r.knownActions;for(let i=0,n=e.length;i!==n;++i){let n=e[i];this._deactivateAction(n);let r=n._cacheIndex,a=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,a._cacheIndex=r,t[r]=a,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){let t=e.uuid,i=this._actionsByClip;for(let r in i){let e=i[r].actionByRoot[t];void 0!==e&&(this._deactivateAction(e),this._removeInactiveAction(e))}let n=this._bindingsByRootAndName[t];if(void 0!==n)for(let r in n){let e=n[r];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(e,t){let i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},Ym=class{constructor(e){this.value=e}clone(){return new Ym(void 0===this.value.clone?this.value:this.value.clone())}},Qm=class{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;this.ray=new Wl(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new nc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Zm(e,this,t,!(arguments.length>1&&void 0!==arguments[1])||arguments[1]),t.sort(Km),t}intersectObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(let n=0,r=e.length;n<r;n++)Zm(e[n],this,i,t);return i.sort(Km),i}};function Km(e,t){return e.distance-t.distance}function Zm(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){let n=e.children;for(let e=0,r=n.length;e<r;e++)Zm(n[e],t,i,!0)}}var Jm=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Oo(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},$m=new jo,eg=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo(1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo(-1/0,-1/0);this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let i=$m.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return $m.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},tg=new gl,ig=new gl,ng=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new gl;this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){tg.subVectors(e,this.start),ig.subVectors(this.end,this.start);let i=ig.dot(ig),n=ig.dot(tg)/i;return t&&(n=Oo(n,0,1)),n}closestPointToPoint(e,t,i){let n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},rg=new gl,ag=class extends vc{constructor(e,t){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";let i=new Wc,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,s=1,o=32;a<o;a++,s++){let e=a/o*Math.PI*2,t=s/o*Math.PI*2;n.push(Math.cos(e),Math.sin(e),1,Math.cos(t),Math.sin(t),1)}i.setAttribute("position",new Bc(n,3));let r=new Sp({fog:!1,toneMapped:!1});this.cone=new Op(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),rg.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(rg),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},sg=class extends ah{constructor(e,t,i){super(new Ff(t,4,2),new Rc({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},og=new gl,lg=new gl,cg=new gl,hg=class extends vc{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",void 0===t&&(t=1);let n=new Wc;n.setAttribute("position",new Bc([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));let r=new Sp({fog:!1,toneMapped:!1});this.lightPlane=new Tp(n,r),this.add(this.lightPlane),n=new Wc,n.setAttribute("position",new Bc([0,0,0,0,0,1],3)),this.targetLine=new Tp(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),og.setFromMatrixPosition(this.light.matrixWorld),lg.setFromMatrixPosition(this.light.target.matrixWorld),cg.subVectors(lg,og),this.lightPlane.lookAt(lg),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(lg),this.targetLine.scale.z=cg.length()}},dg=new gl,ug=new ph,pg=class extends Op{constructor(e){let t=new Wc,i=new Sp({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],a={};function s(e,t){o(e),o(t)}function o(e){n.push(0,0,0),r.push(0,0,0),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}s("n1","n2"),s("n2","n4"),s("n4","n3"),s("n3","n1"),s("f1","f2"),s("f2","f4"),s("f4","f3"),s("f3","f1"),s("n1","f1"),s("n2","f2"),s("n3","f3"),s("n4","f4"),s("p","n1"),s("p","n2"),s("p","n3"),s("p","n4"),s("u1","u2"),s("u2","u3"),s("u3","u1"),s("c","t"),s("p","c"),s("cn1","cn2"),s("cn3","cn4"),s("cf1","cf2"),s("cf3","cf4"),t.setAttribute("position",new Bc(n,3)),t.setAttribute("color",new Bc(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();let l=new rl(16755200),c=new rl(16711680),h=new rl(43775),d=new rl(16777215),u=new rl(3355443);this.setColors(l,c,h,d,u)}setColors(e,t,i,n,r){let a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,n.r,n.g,n.b),a.setXYZ(39,n.r,n.g,n.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){let e=this.geometry,t=this.pointMap;ug.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),fg("c",t,e,ug,0,0,-1),fg("t",t,e,ug,0,0,1),fg("n1",t,e,ug,-1,-1,-1),fg("n2",t,e,ug,1,-1,-1),fg("n3",t,e,ug,-1,1,-1),fg("n4",t,e,ug,1,1,-1),fg("f1",t,e,ug,-1,-1,1),fg("f2",t,e,ug,1,-1,1),fg("f3",t,e,ug,-1,1,1),fg("f4",t,e,ug,1,1,1),fg("u1",t,e,ug,.7,1.1,-1),fg("u2",t,e,ug,-.7,1.1,-1),fg("u3",t,e,ug,0,2,-1),fg("cf1",t,e,ug,-1,0,1),fg("cf2",t,e,ug,1,0,1),fg("cf3",t,e,ug,0,-1,1),fg("cf4",t,e,ug,0,1,1),fg("cn1",t,e,ug,-1,0,-1),fg("cn2",t,e,ug,1,0,-1),fg("cn3",t,e,ug,0,-1,-1),fg("cn4",t,e,ug,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function fg(e,t,i,n,r,a,s){dg.set(r,a,s).unproject(n);let o=t[e];if(void 0!==o){let e=i.getAttribute("position");for(let t=0,i=o.length;t<i;t++)e.setXYZ(o[t],dg.x,dg.y,dg.z)}}var mg=class extends Op{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960,i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Wc;n.setIndex(new kc(i,1)),n.setAttribute("position",new Bc([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Sp({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){let t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},gg=class extends Op{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new Wc;i.setAttribute("position",new Bc(t,3)),i.setAttribute("color",new Bc([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Sp({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){let n=new rl,r=this.geometry.attributes.color.array;return n.set(e),n.toArray(r,0),n.toArray(r,3),n.set(t),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},vg=function(){let e=new ArrayBuffer(4),t=new Float32Array(e),i=new Uint32Array(e),n=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){let e=l-127;e<-27?(n[l]=0,n[256|l]=32768,r[l]=24,r[256|l]=24):e<-14?(n[l]=1024>>-e-14,n[256|l]=1024>>-e-14|32768,r[l]=-e-1,r[256|l]=-e-1):e<=15?(n[l]=e+15<<10,n[256|l]=e+15<<10|32768,r[l]=13,r[256|l]=13):e<128?(n[l]=31744,n[256|l]=64512,r[l]=24,r[256|l]=24):(n[l]=31744,n[256|l]=64512,r[l]=13,r[256|l]=13)}let a=new Uint32Array(2048),s=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let e=l<<13,t=0;for(;0===(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,a[l]=e|t}for(let l=1024;l<2048;++l)a[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)32!==l&&(o[l]=1024);return{floatView:t,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:a,exponentTable:s,offsetTable:o}}();var yg=Object.freeze({__proto__:null,fromHalfFloat:function(e){let t=e>>10;return vg.uint32View[0]=vg.mantissaTable[vg.offsetTable[t]+(1023&e)]+vg.exponentTable[t],vg.floatView[0]},toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=Oo(e,-65504,65504),vg.floatView[0]=e;let t=vg.uint32View[0],i=t>>23&511;return vg.baseTable[i]+((8388607&t)>>vg.shiftTable[i])}});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Yr}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Yr);var bg=".",xg=Symbol("target"),wg=Symbol("unsubscribe");function _g(e){return e instanceof Date||e instanceof Set||e instanceof Map||e instanceof WeakSet||e instanceof WeakMap||ArrayBuffer.isView(e)}var Sg=Array.isArray;function Ag(e){return"symbol"==typeof e}var Eg={after:(e,t)=>Sg(e)?e.slice(t.length):""===t?e:e.slice(t.length+1),concat:(e,t)=>Sg(e)?(e=[...e],t&&e.push(t),e):t&&void 0!==t.toString?(""!==e&&(e+=bg),Ag(t)?e+t.toString():e+t):e,initial:e=>{if(Sg(e))return e.slice(0,-1);if(""===e)return e;let t=e.lastIndexOf(bg);return-1===t?"":e.slice(0,t)},last:e=>{if(Sg(e))return e[e.length-1]||"";if(""===e)return e;let t=e.lastIndexOf(bg);return-1===t?e:e.slice(t+1)},walk:(e,t)=>{if(Sg(e))for(let i of e)t(i);else if(""!==e){let i=0,n=e.indexOf(bg);if(-1===n)t(e);else for(;i<e.length;)-1===n&&(n=e.length),t(e.slice(i,n)),i=n+1,n=e.indexOf(bg,i)}},get(e,t){return this.walk(t,(t=>{e&&(e=e[t])})),e}},Cg=Eg;function Mg(e,t,i){return e.isUnsubscribed||t.ignoreSymbols&&Ag(i)||t.ignoreUnderscores&&"_"===i.charAt(0)||"ignoreKeys"in t&&t.ignoreKeys.includes(i)}var Pg=class{constructor(e){this._equals=e,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return void 0===this._descriptorCache&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(e){let t=this._getDescriptorCache(),i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i}_getOwnPropertyDescriptor(e,t){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(e,t);let i=this._getProperties(e),n=i[t];return void 0===n&&(n=Reflect.getOwnPropertyDescriptor(e,t),i[t]=n),n}getProxy(e,t,i,n){if(this.isUnsubscribed)return e;let r=e[n],a=r||e;this._pathCache.set(a,t);let s=this._proxyCache.get(a);return void 0===s&&(s=void 0===r?new Proxy(e,i):e,this._proxyCache.set(a,s)),s}getPath(e){return this.isUnsubscribed?void 0:this._pathCache.get(e)}isDetached(e,t){return!Object.is(e,Cg.get(t,this.getPath(e)))}defineProperty(e,t,i){return!!Reflect.defineProperty(e,t,i)&&(this.isUnsubscribed||(this._getProperties(e)[t]=i),!0)}setProperty(e,t,i,n,r){if(!this._equals(r,i)||!(t in e)){let r=this._getOwnPropertyDescriptor(e,t);return void 0!==r&&"set"in r?Reflect.set(e,t,i,n):Reflect.set(e,t,i)}return!0}deleteProperty(e,t,i){if(Reflect.deleteProperty(e,t)){if(!this.isUnsubscribed){let n=this._getDescriptorCache().get(e);n&&(delete n[t],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(e,t,i){let n=this._getOwnPropertyDescriptor(t,i);return void 0!==e&&void 0!==n&&Object.is(e.value,n.value)&&(e.writable||!1)===(n.writable||!1)&&(e.enumerable||!1)===(n.enumerable||!1)&&(e.configurable||!1)===(n.configurable||!1)&&e.get===n.get&&e.set===n.set}isGetInvariant(e,t){let i=this._getOwnPropertyDescriptor(e,t);return void 0!==i&&!0!==i.configurable&&!0!==i.writable}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function Tg(e){return"[object Object]"===toString.call(e)}function Dg(){return!0}function Rg(e,t){return e.length!==t.length||e.some(((e,i)=>t[i]!==e))}var Og=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),Ig=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),kg={push:Dg,pop:Dg,shift:Dg,unshift:Dg,copyWithin:Rg,reverse:Rg,sort:Rg,splice:Rg,flat:Rg,fill:Rg},Lg=new Set([...Og,...Ig,...Object.keys(kg)]);function Fg(e,t){if(e.size!==t.size)return!0;for(let i of e)if(!t.has(i))return!0;return!1}var Bg=["keys","values","entries"],Ng=new Set(["has","toString"]),zg={add:Fg,clear:Fg,delete:Fg,forEach:Fg},Ug=new Set([...Ng,...Object.keys(zg),...Bg]);function jg(e,t){if(e.size!==t.size)return!0;let i;for(let[n,r]of e)if(i=t.get(n),i!==r||void 0===i&&!t.has(n))return!0;return!1}var Vg=new Set([...Ng,"get"]),Gg={set:jg,clear:jg,delete:jg,forEach:jg},Hg=new Set([...Vg,...Object.keys(Gg),...Bg]),Wg=class{constructor(e,t,i,n){this._path=t,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=n,this._changes=n?[]:null,this.clone=void 0===t?e:this._shallowClone(e)}static isHandledMethod(e){return Og.has(e)}_shallowClone(e){let t=e;if(Tg(e))t={...e};else if(Sg(e))t=[...e];else if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set([...e].map((e=>this._shallowClone(e))));else if(e instanceof Map){t=new Map;for(let[i,n]of e.entries())t.set(i,this._shallowClone(n))}return this._clonedCache.add(t),t}preferredThisArg(e,t,i,n){return e?(Sg(n)?this._onIsChanged=kg[t]:n instanceof Set?this._onIsChanged=zg[t]:n instanceof Map&&(this._onIsChanged=Gg[t]),n):i}update(e,t,i){let n=Cg.after(e,this._path);if("length"!==t){let e=this.clone;Cg.walk(n,(t=>{e&&e[t]&&(this._clonedCache.has(e[t])||(e[t]=this._shallowClone(e[t])),e=e[t])})),this._hasOnValidate&&this._changes.push({path:n,property:t,previous:i}),e&&e[t]&&(e[t]=i)}this._isChanged=!0}undo(e){let t;for(let i=this._changes.length-1;-1!==i;i--)t=this._changes[i],Cg.get(e,t.path)[t.property]=t.previous}isChanged(e){return void 0===this._onIsChanged?this._isChanged:this._onIsChanged(this.clone,e)}},qg=class extends Wg{static isHandledMethod(e){return Lg.has(e)}},Xg=class extends Wg{undo(e){e.setTime(this.clone.getTime())}isChanged(e,t){return!t(this.clone.valueOf(),e.valueOf())}},Yg=class extends Wg{static isHandledMethod(e){return Ug.has(e)}undo(e){for(let t of this.clone)e.add(t);for(let t of e)this.clone.has(t)||e.delete(t)}},Qg=class extends Wg{static isHandledMethod(e){return Hg.has(e)}undo(e){for(let[t,i]of this.clone.entries())e.set(t,i);for(let t of e.keys())this.clone.has(t)||e.delete(t)}},Kg=class extends Wg{constructor(e,t,i,n){super(void 0,t,i,n),this._arg1=i[0],this._weakValue=e.has(this._arg1)}isChanged(e){return this._weakValue!==e.has(this._arg1)}undo(e){this._weakValue&&!e.has(this._arg1)?e.add(this._arg1):e.delete(this._arg1)}},Zg=class extends Wg{constructor(e,t,i,n){super(void 0,t,i,n),this._weakKey=i[0],this._weakHas=e.has(this._weakKey),this._weakValue=e.get(this._weakKey)}isChanged(e){return this._weakValue!==e.get(this._weakKey)}undo(e){let t=e.has(this._weakKey);this._weakHas&&!t?e.set(this._weakKey,this._weakValue):!this._weakHas&&t?e.delete(this._weakKey):this._weakValue!==e.get(this._weakKey)&&e.set(this._weakKey,this._weakValue)}},Jg=class{constructor(e){this._stack=[],this._hasOnValidate=e}static isHandledType(e){return Tg(e)||Sg(e)||_g(e)}static isHandledMethod(e,t){return Tg(e)?Wg.isHandledMethod(t):Sg(e)?qg.isHandledMethod(t):e instanceof Set?Yg.isHandledMethod(t):e instanceof Map?Qg.isHandledMethod(t):_g(e)}get isCloning(){return this._stack.length>0}start(e,t,i){let n=Wg;Sg(e)?n=qg:e instanceof Date?n=Xg:e instanceof Set?n=Yg:e instanceof Map?n=Qg:e instanceof WeakSet?n=Kg:e instanceof WeakMap&&(n=Zg),this._stack.push(new n(e,t,i,this._hasOnValidate))}update(e,t,i){this._stack[this._stack.length-1].update(e,t,i)}preferredThisArg(e,t,i){let{name:n}=e,r=Jg.isHandledMethod(i,n);return this._stack[this._stack.length-1].preferredThisArg(r,n,t,i)}isChanged(e,t,i){return this._stack[this._stack.length-1].isChanged(e,t,i)}undo(e){void 0!==this._previousClone&&this._previousClone.undo(e)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},$g={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},ev=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i={...$g,...i};let n=Symbol("ProxyTarget"),{equals:r,isShallow:a,ignoreDetached:s,details:o}=i,l=new Pg(r),c="function"==typeof i.onValidate,h=new Jg(c),d=(e,t,n,r,a)=>!c||h.isCloning||!0===i.onValidate(Cg.concat(l.getPath(e),t),n,r,a),u=(t,n,r,a)=>{!Mg(l,i,n)&&(!s||!l.isDetached(t,e))&&p(l.getPath(t),n,r,a)},p=(e,i,n,r,a)=>{h.isCloning?h.update(e,i,r):t(Cg.concat(e,i),n,r,a)},f=e=>e&&(e[n]||e),m=(t,r,o,c)=>function(e){return("object"==typeof e?null===e:"function"!=typeof e)||e instanceof RegExp}(t)||"constructor"===o||a&&!Jg.isHandledMethod(r,o)||Mg(l,i,o)||l.isGetInvariant(r,o)||s&&l.isDetached(r,e)?t:(void 0===c&&(c=l.getPath(r)),l.getProxy(t,Cg.concat(c,o),g,n)),g={get(e,t,i){if(Ag(t)){if(t===n||t===xg)return e;if(t===wg&&!l.isUnsubscribed&&0===l.getPath(e).length)return l.unsubscribe(),e}let r=_g(e)?Reflect.get(e,t):Reflect.get(e,t,i);return m(r,e,t)},set(e,t,i,a){i=f(i);let s=e[n]||e,o=s[t];if(r(o,i)&&t in e)return!0;let c=d(e,t,i,o);return c&&l.setProperty(s,t,i,a,o)?(u(e,t,e[t],o),!0):!c},defineProperty(e,t,i){if(!l.isSameDescriptor(i,e,t)){let n=e[t];d(e,t,i.value,n)&&l.defineProperty(e,t,i,n)&&u(e,t,i.value,n)}return!0},deleteProperty(e,t){if(!Reflect.has(e,t))return!0;let i=Reflect.get(e,t),n=d(e,t,void 0,i);return n&&l.deleteProperty(e,t,i)?(u(e,t,void 0,i),!0):!n},apply(t,i,a){let s=i[n]||i;if(l.isUnsubscribed)return Reflect.apply(t,s,a);if((!1===o||!0!==o&&!o.includes(t.name))&&Jg.isHandledType(s)){let n=Cg.initial(l.getPath(t)),o=Jg.isHandledMethod(s,t.name);h.start(s,n,a);let c=Reflect.apply(t,h.preferredThisArg(t,i,s),o?a.map((e=>f(e))):a),u=h.isChanged(s,r),v=h.stop();if(Jg.isHandledType(c)&&o&&(i instanceof Map&&"get"===t.name&&(n=Cg.concat(n,a[0])),c=l.getProxy(c,n,g)),u){let i={name:t.name,args:a,result:c},r=h.isCloning?Cg.initial(n):n,o=h.isCloning?Cg.last(n):"";d(Cg.get(e,r),o,s,v,i)?p(r,o,s,v,i):h.undo(s)}return(i instanceof Map||i instanceof Set)&&function(e){return"object"==typeof e&&"function"==typeof e.next}(c)?function(e,t,i,n,r){let a=e.next;if("entries"===t.name)e.next=function(){let e=a.call(this);return!1===e.done&&(e.value[0]=r(e.value[0],t,e.value[0],n),e.value[1]=r(e.value[1],t,e.value[0],n)),e};else if("values"===t.name){let s=i[xg].keys();e.next=function(){let e=a.call(this);return!1===e.done&&(e.value=r(e.value,t,s.next().value,n)),e}}else e.next=function(){let e=a.call(this);return!1===e.done&&(e.value=r(e.value,t,e.value,n)),e};return e}(c,t,i,n,m):c}return Reflect.apply(t,i,a)}},v=l.getProxy(e,i.pathAsArray?[]:"",g);return t=t.bind(v),c&&(i.onValidate=i.onValidate.bind(v)),v};ev.target=e=>e&&e[xg]||e,ev.unsubscribe=e=>e[wg]||e;var tv=ev,iv="object"==typeof global&&global&&global.Object===Object&&global,nv="object"==typeof self&&self&&self.Object===Object&&self,rv=iv||nv||Function("return this")(),av=rv.Symbol,sv=Object.prototype,ov=sv.hasOwnProperty,lv=sv.toString,cv=av?av.toStringTag:void 0;var hv=function(e){var t=ov.call(e,cv),i=e[cv];try{e[cv]=void 0;var n=!0}catch{}var r=lv.call(e);return n&&(t?e[cv]=i:delete e[cv]),r},dv=Object.prototype.toString;var uv=function(e){return dv.call(e)},pv=av?av.toStringTag:void 0;var fv=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":pv&&pv in Object(e)?hv(e):uv(e)};var mv=function(e){return null!=e&&"object"==typeof e};var gv=function(e){return"symbol"==typeof e||mv(e)&&"[object Symbol]"==fv(e)};var vv=function(e,t){for(var i=-1,n=null==e?0:e.length,r=Array(n);++i<n;)r[i]=t(e[i],i,e);return r},yv=Array.isArray,bv=1/0,xv=av?av.prototype:void 0,wv=xv?xv.toString:void 0;var _v=function e(t){if("string"==typeof t)return t;if(yv(t))return vv(t,e)+"";if(gv(t))return wv?wv.call(t):"";var i=t+"";return"0"==i&&1/t==-bv?"-0":i},Sv=/\s/;var Av=function(e){for(var t=e.length;t--&&Sv.test(e.charAt(t)););return t},Ev=/^\s+/;var Cv=function(e){return e&&e.slice(0,Av(e)+1).replace(Ev,"")};var Mv=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},Pv=/^[-+]0x[0-9a-f]+$/i,Tv=/^0b[01]+$/i,Dv=/^0o[0-7]+$/i,Rv=parseInt;var Ov=function(e){if("number"==typeof e)return e;if(gv(e))return NaN;if(Mv(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Mv(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Cv(e);var i=Tv.test(e);return i||Dv.test(e)?Rv(e.slice(2),i?2:8):Pv.test(e)?NaN:+e};var Iv=function(e){return e};var kv=function(e){if(!Mv(e))return!1;var t=fv(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},Lv=rv["__core-js_shared__"],Fv=function(){var e=/[^.]+$/.exec(Lv&&Lv.keys&&Lv.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var Bv=function(e){return!!Fv&&Fv in e},Nv=Function.prototype.toString;var zv=function(e){if(null!=e){try{return Nv.call(e)}catch{}try{return e+""}catch{}}return""},Uv=/^\[object .+?Constructor\]$/,jv=Function.prototype,Vv=Object.prototype,Gv=jv.toString,Hv=Vv.hasOwnProperty,Wv=RegExp("^"+Gv.call(Hv).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var qv=function(e){return!(!Mv(e)||Bv(e))&&(kv(e)?Wv:Uv).test(zv(e))};var Xv=function(e,t){return null===e||void 0===e?void 0:e[t]};var Yv=function(e,t){var i=Xv(e,t);return qv(i)?i:void 0},Qv=Yv(rv,"WeakMap"),Kv=Object.create,Zv=function(){function e(){}return function(t){if(!Mv(t))return{};if(Kv)return Kv(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}(),Jv=Zv;var $v=function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)};var ey=function(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t},ty=Date.now;var iy=function(e){var t=0,i=0;return function(){var n=ty(),r=16-(n-i);if(i=n,r>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}};var ny=function(e){return function(){return e}},ry=function(){try{var e=Yv(Object,"defineProperty");return e({},"",{}),e}catch{}}(),ay=ry,sy=ay?function(e,t){return ay(e,"toString",{configurable:!0,enumerable:!1,value:ny(t),writable:!0})}:Iv,oy=iy(sy);var ly=function(e,t){for(var i=-1,n=null==e?0:e.length;++i<n&&!1!==t(e[i],i,e););return e},cy=/^(?:0|[1-9]\d*)$/;var hy=function(e,t){var i,n=typeof e;return!!(t=null!==(i=t)&&void 0!==i?i:9007199254740991)&&("number"==n||"symbol"!=n&&cy.test(e))&&e>-1&&e%1==0&&e<t};var dy=function(e,t,i){"__proto__"==t&&ay?ay(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i};var uy=function(e,t){return e===t||e!==e&&t!==t},py=Object.prototype.hasOwnProperty;var fy=function(e,t,i){var n=e[t];(!py.call(e,t)||!uy(n,i)||void 0===i&&!(t in e))&&dy(e,t,i)};var my=function(e,t,i,n){var r=!i;i||(i={});for(var a=-1,s=t.length;++a<s;){var o=t[a],l=n?n(i[o],e[o],o,i,e):void 0;void 0===l&&(l=e[o]),r?dy(i,o,l):fy(i,o,l)}return i},gy=Math.max;var vy=function(e,t,i){return t=gy(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,a=gy(n.length-t,0),s=Array(a);++r<a;)s[r]=n[t+r];r=-1;for(var o=Array(t+1);++r<t;)o[r]=n[r];return o[t]=i(s),$v(e,this,o)}};var yy=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var by=function(e){return null!=e&&yy(e.length)&&!kv(e)},xy=Object.prototype;var wy=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||xy)};var _y=function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n};var Sy=function(e){return mv(e)&&"[object Arguments]"==fv(e)},Ay=Object.prototype,Ey=Ay.hasOwnProperty,Cy=Ay.propertyIsEnumerable,My=Sy(function(){return arguments}())?Sy:function(e){return mv(e)&&Ey.call(e,"callee")&&!Cy.call(e,"callee")},Py=My;var Ty=function(){return!1},Dy="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ry=Dy&&"object"==typeof module&&module&&!module.nodeType&&module,Oy=Ry&&Ry.exports===Dy?rv.Buffer:void 0,Iy=(Oy?Oy.isBuffer:void 0)||Ty,ky={};ky["[object Float32Array]"]=ky["[object Float64Array]"]=ky["[object Int8Array]"]=ky["[object Int16Array]"]=ky["[object Int32Array]"]=ky["[object Uint8Array]"]=ky["[object Uint8ClampedArray]"]=ky["[object Uint16Array]"]=ky["[object Uint32Array]"]=!0,ky["[object Arguments]"]=ky["[object Array]"]=ky["[object ArrayBuffer]"]=ky["[object Boolean]"]=ky["[object DataView]"]=ky["[object Date]"]=ky["[object Error]"]=ky["[object Function]"]=ky["[object Map]"]=ky["[object Number]"]=ky["[object Object]"]=ky["[object RegExp]"]=ky["[object Set]"]=ky["[object String]"]=ky["[object WeakMap]"]=!1;var Ly=function(e){return mv(e)&&yy(e.length)&&!!ky[fv(e)]};var Fy=function(e){return function(t){return e(t)}},By="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ny=By&&"object"==typeof module&&module&&!module.nodeType&&module,zy=Ny&&Ny.exports===By&&iv.process,Uy=function(){try{return Ny&&Ny.require&&Ny.require("util").types||zy&&zy.binding&&zy.binding("util")}catch{}}(),jy=Uy&&Uy.isTypedArray,Vy=jy?Fy(jy):Ly,Gy=Object.prototype.hasOwnProperty;var Hy=function(e,t){var i=yv(e),n=!i&&Py(e),r=!i&&!n&&Iy(e),a=!i&&!n&&!r&&Vy(e),s=i||n||r||a,o=s?_y(e.length,String):[],l=o.length;for(var c in e)(t||Gy.call(e,c))&&(!s||!("length"==c||r&&("offset"==c||"parent"==c)||a&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||hy(c,l)))&&o.push(c);return o};var Wy=function(e,t){return function(i){return e(t(i))}},qy=Wy(Object.keys,Object),Xy=Object.prototype.hasOwnProperty;var Yy=function(e){if(!wy(e))return qy(e);var t=[];for(var i in Object(e))Xy.call(e,i)&&"constructor"!=i&&t.push(i);return t};var Qy=function(e){return by(e)?Hy(e):Yy(e)};var Ky=function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t},Zy=Object.prototype.hasOwnProperty;var Jy=function(e){if(!Mv(e))return Ky(e);var t=wy(e),i=[];for(var n in e)"constructor"==n&&(t||!Zy.call(e,n))||i.push(n);return i};var $y=function(e){return by(e)?Hy(e,!0):Jy(e)},eb=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,tb=/^\w*$/;var ib=function(e,t){if(yv(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!gv(e))||(tb.test(e)||!eb.test(e)||null!=t&&e in Object(t))},nb=Yv(Object,"create");var rb=function(){this.__data__=nb?nb(null):{},this.size=0};var ab=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},sb=Object.prototype.hasOwnProperty;var ob=function(e){var t=this.__data__;if(nb){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return sb.call(t,e)?t[e]:void 0},lb=Object.prototype.hasOwnProperty;var cb=function(e){var t=this.__data__;return nb?void 0!==t[e]:lb.call(t,e)};var hb=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=nb&&void 0===t?"__lodash_hash_undefined__":t,this};function db(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}db.prototype.clear=rb,db.prototype.delete=ab,db.prototype.get=ob,db.prototype.has=cb,db.prototype.set=hb;var ub=db;var pb=function(){this.__data__=[],this.size=0};var fb=function(e,t){for(var i=e.length;i--;)if(uy(e[i][0],t))return i;return-1},mb=Array.prototype.splice;var gb=function(e){var t=this.__data__,i=fb(t,e);return!(i<0)&&(i==t.length-1?t.pop():mb.call(t,i,1),--this.size,!0)};var vb=function(e){var t=this.__data__,i=fb(t,e);return i<0?void 0:t[i][1]};var yb=function(e){return fb(this.__data__,e)>-1};var bb=function(e,t){var i=this.__data__,n=fb(i,e);return n<0?(++this.size,i.push([e,t])):i[n][1]=t,this};function xb(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}xb.prototype.clear=pb,xb.prototype.delete=gb,xb.prototype.get=vb,xb.prototype.has=yb,xb.prototype.set=bb;var wb=xb,_b=Yv(rv,"Map");var Sb=function(){this.size=0,this.__data__={hash:new ub,map:new(_b||wb),string:new ub}};var Ab=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};var Eb=function(e,t){var i=e.__data__;return Ab(t)?i["string"==typeof t?"string":"hash"]:i.map};var Cb=function(e){var t=Eb(this,e).delete(e);return this.size-=t?1:0,t};var Mb=function(e){return Eb(this,e).get(e)};var Pb=function(e){return Eb(this,e).has(e)};var Tb=function(e,t){var i=Eb(this,e),n=i.size;return i.set(e,t),this.size+=i.size==n?0:1,this};function Db(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}Db.prototype.clear=Sb,Db.prototype.delete=Cb,Db.prototype.get=Mb,Db.prototype.has=Pb,Db.prototype.set=Tb;var Rb=Db;function Ob(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function(){var n=arguments,r=t?t.apply(this,n):n[0],a=i.cache;if(a.has(r))return a.get(r);var s=e.apply(this,n);return i.cache=a.set(r,s)||a,s};return i.cache=new(Ob.Cache||Rb),i}Ob.Cache=Rb;var Ib=Ob;var kb=function(e){var t=Ib(e,(function(e){return 500===i.size&&i.clear(),e})),i=t.cache;return t},Lb=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Fb=/\\(\\)?/g,Bb=kb((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Lb,(function(e,i,n,r){t.push(n?r.replace(Fb,"$1"):i||e)})),t})),Nb=Bb;var zb=function(e){return null==e?"":_v(e)};var Ub=function(e,t){return yv(e)?e:ib(e,t)?[e]:Nb(zb(e))},jb=1/0;var Vb=function(e){if("string"==typeof e||gv(e))return e;var t=e+"";return"0"==t&&1/e==-jb?"-0":t};var Gb=function(e,t){for(var i=0,n=(t=Ub(t,e)).length;null!=e&&i<n;)e=e[Vb(t[i++])];return i&&i==n?e:void 0};var Hb=function(e,t){for(var i=-1,n=t.length,r=e.length;++i<n;)e[r+i]=t[i];return e},Wb=av?av.isConcatSpreadable:void 0;var qb=function(e){return yv(e)||Py(e)||!!(Wb&&e&&e[Wb])};var Xb=function e(t,i,n,r,a){var s=-1,o=t.length;for(n||(n=qb),a||(a=[]);++s<o;){var l=t[s];i>0&&n(l)?i>1?e(l,i-1,n,r,a):Hb(a,l):r||(a[a.length]=l)}return a};var Yb=function(e){return(null==e?0:e.length)?Xb(e,1):[]};var Qb=function(e){return oy(vy(e,void 0,Yb),e+"")},Kb=Wy(Object.getPrototypeOf,Object),Zb=Function.prototype,Jb=Object.prototype,$b=Zb.toString,ex=Jb.hasOwnProperty,tx=$b.call(Object);var ix=function(e){if(!mv(e)||"[object Object]"!=fv(e))return!1;var t=Kb(e);if(null===t)return!0;var i=ex.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&$b.call(i)==tx};var nx=function(e,t,i){var n=-1,r=e.length;t<0&&(t=-t>r?0:r+t),(i=i>r?r:i)<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0;for(var a=Array(r);++n<r;)a[n]=e[n+t];return a};var rx=function(){this.__data__=new wb,this.size=0};var ax=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i};var sx=function(e){return this.__data__.get(e)};var ox=function(e){return this.__data__.has(e)};var lx=function(e,t){var i=this.__data__;if(i instanceof wb){var n=i.__data__;if(!_b||n.length<199)return n.push([e,t]),this.size=++i.size,this;i=this.__data__=new Rb(n)}return i.set(e,t),this.size=i.size,this};function cx(e){var t=this.__data__=new wb(e);this.size=t.size}cx.prototype.clear=rx,cx.prototype.delete=ax,cx.prototype.get=sx,cx.prototype.has=ox,cx.prototype.set=lx;var hx=cx;var dx=function(e,t){return e&&my(t,Qy(t),e)};var ux=function(e,t){return e&&my(t,$y(t),e)},px="object"==typeof exports&&exports&&!exports.nodeType&&exports,fx=px&&"object"==typeof module&&module&&!module.nodeType&&module,mx=fx&&fx.exports===px?rv.Buffer:void 0,gx=mx?mx.allocUnsafe:void 0;var vx=function(e,t){if(t)return e.slice();var i=e.length,n=gx?gx(i):new e.constructor(i);return e.copy(n),n};var yx=function(e,t){for(var i=-1,n=null==e?0:e.length,r=0,a=[];++i<n;){var s=e[i];t(s,i,e)&&(a[r++]=s)}return a};var bx=function(){return[]},xx=Object.prototype.propertyIsEnumerable,wx=Object.getOwnPropertySymbols,_x=wx?function(e){return null==e?[]:(e=Object(e),yx(wx(e),(function(t){return xx.call(e,t)})))}:bx,Sx=_x;var Ax=function(e,t){return my(e,Sx(e),t)},Ex=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Hb(t,Sx(e)),e=Kb(e);return t}:bx,Cx=Ex;var Mx=function(e,t){return my(e,Cx(e),t)};var Px=function(e,t,i){var n=t(e);return yv(e)?n:Hb(n,i(e))};var Tx=function(e){return Px(e,Qy,Sx)};var Dx=function(e){return Px(e,$y,Cx)},Rx=Yv(rv,"DataView"),Ox=Yv(rv,"Promise"),Ix=Yv(rv,"Set"),kx="[object Map]",Lx="[object Promise]",Fx="[object Set]",Bx="[object WeakMap]",Nx="[object DataView]",zx=zv(Rx),Ux=zv(_b),jx=zv(Ox),Vx=zv(Ix),Gx=zv(Qv),Hx=fv;(Rx&&Hx(new Rx(new ArrayBuffer(1)))!=Nx||_b&&Hx(new _b)!=kx||Ox&&Hx(Ox.resolve())!=Lx||Ix&&Hx(new Ix)!=Fx||Qv&&Hx(new Qv)!=Bx)&&(Hx=function(e){var t=fv(e),i="[object Object]"==t?e.constructor:void 0,n=i?zv(i):"";if(n)switch(n){case zx:return Nx;case Ux:return kx;case jx:return Lx;case Vx:return Fx;case Gx:return Bx}return t});var Wx=Hx,qx=Object.prototype.hasOwnProperty;var Xx=function(e){var t=e.length,i=new e.constructor(t);return t&&"string"==typeof e[0]&&qx.call(e,"index")&&(i.index=e.index,i.input=e.input),i},Yx=rv.Uint8Array;var Qx=function(e){var t=new e.constructor(e.byteLength);return new Yx(t).set(new Yx(e)),t};var Kx=function(e,t){var i=t?Qx(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.byteLength)},Zx=/\w*$/;var Jx=function(e){var t=new e.constructor(e.source,Zx.exec(e));return t.lastIndex=e.lastIndex,t},$x=av?av.prototype:void 0,ew=$x?$x.valueOf:void 0;var tw=function(e){return ew?Object(ew.call(e)):{}};var iw=function(e,t){var i=t?Qx(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)};var nw=function(e,t,i){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Qx(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Kx(e,i);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return iw(e,i);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Jx(e);case"[object Symbol]":return tw(e)}};var rw=function(e){return"function"!=typeof e.constructor||wy(e)?{}:Jv(Kb(e))};var aw=function(e){return mv(e)&&"[object Map]"==Wx(e)},sw=Uy&&Uy.isMap,ow=sw?Fy(sw):aw;var lw=function(e){return mv(e)&&"[object Set]"==Wx(e)},cw=Uy&&Uy.isSet,hw=cw?Fy(cw):lw,dw="[object Arguments]",uw="[object Function]",pw="[object Object]",fw={};fw[dw]=fw["[object Array]"]=fw["[object ArrayBuffer]"]=fw["[object DataView]"]=fw["[object Boolean]"]=fw["[object Date]"]=fw["[object Float32Array]"]=fw["[object Float64Array]"]=fw["[object Int8Array]"]=fw["[object Int16Array]"]=fw["[object Int32Array]"]=fw["[object Map]"]=fw["[object Number]"]=fw[pw]=fw["[object RegExp]"]=fw["[object Set]"]=fw["[object String]"]=fw["[object Symbol]"]=fw["[object Uint8Array]"]=fw["[object Uint8ClampedArray]"]=fw["[object Uint16Array]"]=fw["[object Uint32Array]"]=!0,fw["[object Error]"]=fw[uw]=fw["[object WeakMap]"]=!1;var mw=function e(t,i,n,r,a,s){var o,l=1&i,c=2&i,h=4&i;if(n&&(o=a?n(t,r,a,s):n(t)),void 0!==o)return o;if(!Mv(t))return t;var d=yv(t);if(d){if(o=Xx(t),!l)return ey(t,o)}else{var u=Wx(t),p=u==uw||"[object GeneratorFunction]"==u;if(Iy(t))return vx(t,l);if(u==pw||u==dw||p&&!a){if(o=c||p?{}:rw(t),!l)return c?Mx(t,ux(o,t)):Ax(t,dx(o,t))}else{if(!fw[u])return a?t:{};o=nw(t,u,l)}}s||(s=new hx);var f=s.get(t);if(f)return f;s.set(t,o),hw(t)?t.forEach((function(r){o.add(e(r,i,n,r,t,s))})):ow(t)&&t.forEach((function(r,a){o.set(a,e(r,i,n,a,t,s))}));var m=d?void 0:(h?c?Dx:Tx:c?$y:Qy)(t);return ly(m||t,(function(r,a){m&&(r=t[a=r]),fy(o,a,e(r,i,n,a,t,s))})),o};var gw=function(e){return mw(e,5)};var vw=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};var yw=function(e){return this.__data__.has(e)};function bw(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new Rb;++t<i;)this.add(e[t])}bw.prototype.add=bw.prototype.push=vw,bw.prototype.has=yw;var xw=bw;var ww=function(e,t){for(var i=-1,n=null==e?0:e.length;++i<n;)if(t(e[i],i,e))return!0;return!1};var _w=function(e,t){return e.has(t)};var Sw=function(e,t,i,n,r,a){var s=1&i,o=e.length,l=t.length;if(o!=l&&!(s&&l>o))return!1;var c=a.get(e),h=a.get(t);if(c&&h)return c==t&&h==e;var d=-1,u=!0,p=2&i?new xw:void 0;for(a.set(e,t),a.set(t,e);++d<o;){var f=e[d],m=t[d];if(n)var g=s?n(m,f,d,t,e,a):n(f,m,d,e,t,a);if(void 0!==g){if(g)continue;u=!1;break}if(p){if(!ww(t,(function(e,t){if(!_w(p,t)&&(f===e||r(f,e,i,n,a)))return p.push(t)}))){u=!1;break}}else if(f!==m&&!r(f,m,i,n,a)){u=!1;break}}return a.delete(e),a.delete(t),u};var Aw=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e,n){i[++t]=[n,e]})),i};var Ew=function(e){var t=-1,i=Array(e.size);return e.forEach((function(e){i[++t]=e})),i},Cw=av?av.prototype:void 0,Mw=Cw?Cw.valueOf:void 0;var Pw=function(e,t,i,n,r,a,s){switch(i){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!a(new Yx(e),new Yx(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return uy(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var o=Aw;case"[object Set]":var l=1&n;if(o||(o=Ew),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;n|=2,s.set(e,t);var h=Sw(o(e),o(t),n,r,a,s);return s.delete(e),h;case"[object Symbol]":if(Mw)return Mw.call(e)==Mw.call(t)}return!1},Tw=Object.prototype.hasOwnProperty;var Dw=function(e,t,i,n,r,a){var s=1&i,o=Tx(e),l=o.length;if(l!=Tx(t).length&&!s)return!1;for(var c=l;c--;){var h=o[c];if(!(s?h in t:Tw.call(t,h)))return!1}var d=a.get(e),u=a.get(t);if(d&&u)return d==t&&u==e;var p=!0;a.set(e,t),a.set(t,e);for(var f=s;++c<l;){var m=e[h=o[c]],g=t[h];if(n)var v=s?n(g,m,h,t,e,a):n(m,g,h,e,t,a);if(!(void 0===v?m===g||r(m,g,i,n,a):v)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(p=!1)}return a.delete(e),a.delete(t),p},Rw="[object Arguments]",Ow="[object Array]",Iw="[object Object]",kw=Object.prototype.hasOwnProperty;var Lw=function(e,t,i,n,r,a){var s=yv(e),o=yv(t),l=s?Ow:Wx(e),c=o?Ow:Wx(t),h=(l=l==Rw?Iw:l)==Iw,d=(c=c==Rw?Iw:c)==Iw,u=l==c;if(u&&Iy(e)){if(!Iy(t))return!1;s=!0,h=!1}if(u&&!h)return a||(a=new hx),s||Vy(e)?Sw(e,t,i,n,r,a):Pw(e,t,l,i,n,r,a);if(!(1&i)){var p=h&&kw.call(e,"__wrapped__"),f=d&&kw.call(t,"__wrapped__");if(p||f){var m=p?e.value():e,g=f?t.value():t;return a||(a=new hx),r(m,g,i,n,a)}}return!!u&&(a||(a=new hx),Dw(e,t,i,n,r,a))};var Fw=function e(t,i,n,r,a){return t===i||(null==t||null==i||!mv(t)&&!mv(i)?t!==t&&i!==i:Lw(t,i,n,r,e,a))};var Bw=function(e,t){return null!=e&&t in Object(e)};var Nw=function(e,t,i){for(var n=-1,r=(t=Ub(t,e)).length,a=!1;++n<r;){var s=Vb(t[n]);if(!(a=null!=e&&i(e,s)))break;e=e[s]}return a||++n!=r?a:!!(r=null==e?0:e.length)&&yy(r)&&hy(s,r)&&(yv(e)||Py(e))};var zw=function(e,t){return null!=e&&Nw(e,t,Bw)},Uw=function(){return rv.Date.now()},jw=Math.max,Vw=Math.min;var Gw=function(e,t,i){var n,r,a,s,o,l,c=0,h=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,a=r;return n=r=void 0,c=t,s=e.apply(a,i)}function f(e){var i=e-l;return void 0===l||i>=t||i<0||d&&e-c>=a}function m(){var e=Uw();if(f(e))return g(e);o=setTimeout(m,function(e){var i=t-(e-l);return d?Vw(i,a-(e-c)):i}(e))}function g(e){return o=void 0,u&&n?p(e):(n=r=void 0,s)}function v(){var e=Uw(),i=f(e);if(n=arguments,r=this,l=e,i){if(void 0===o)return function(e){return c=e,o=setTimeout(m,t),h?p(e):s}(l);if(d)return clearTimeout(o),o=setTimeout(m,t),p(l)}return void 0===o&&(o=setTimeout(m,t)),s}return t=Ov(t)||0,Mv(i)&&(h=!!i.leading,a=(d="maxWait"in i)?jw(Ov(i.maxWait)||0,t):a,u="trailing"in i?!!i.trailing:u),v.cancel=function(){void 0!==o&&clearTimeout(o),c=0,n=l=r=o=void 0},v.flush=function(){return void 0===o?s:g(Uw())},v};var Hw=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};var Ww=function(e,t){return t.length<2?e:Gb(e,nx(t,0,-1))};var qw=function(e,t){return Fw(e,t)};var Xw=function(e,t){return t=Ub(t,e),null==(e=Ww(e,t))||delete e[Vb(Hw(t))]};var Yw=function(e){return ix(e)?void 0:e},Qw=Qb((function(e,t){var i={};if(null==e)return i;var n=!1;t=vv(t,(function(t){return t=Ub(t,e),n||(n=t.length>1),t})),my(e,Dx(e),i),n&&(i=mw(i,7,Yw));for(var r=t.length;r--;)Xw(i,t[r]);return i})),Kw=Qw;var Zw=function(e,t,i,n){if(!Mv(e))return e;for(var r=-1,a=(t=Ub(t,e)).length,s=a-1,o=e;null!=o&&++r<a;){var l=Vb(t[r]),c=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=s){var h=o[l];void 0===(c=n?n(h,l,o):void 0)&&(c=Mv(h)?h:hy(t[r+1])?[]:{})}fy(o,l,c),o=o[l]}return e};var Jw=function(e,t,i){for(var n=-1,r=t.length,a={};++n<r;){var s=t[n],o=Gb(e,s);i(o,s)&&Zw(a,Ub(s,e),o)}return a};var $w=function(e,t){return Jw(e,t,(function(t,i){return zw(e,i)}))},e_=Qb((function(e,t){return null==e?{}:$w(e,t)})),t_=e_;var i_=function(e,t,i){var n=!0,r=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Mv(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),Gw(e,t,{leading:n,maxWait:t,trailing:r})};function n_(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}function r_(e,t){return Object.setPrototypeOf(e,t),e}!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().includes(" electron/")&&(()=>{var e;if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");t?window.localStorage.setItem("desktop-app-version",t):e=window.localStorage.getItem("desktop-app-version")})();var a_=!(typeof window>"u")&&window.navigator.platform.toUpperCase().includes("MAC"),s_=!(typeof window>"u")&&(/iPad|iPhone|iPod/.test(window.navigator.userAgent)||a_&&"ontouchend"in document),o_=!(typeof window>"u")&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,l_=!(typeof window>"u")&&("ontouchstart"in window||navigator.maxTouchPoints>0),c_=(()=>{if(typeof window>"u")return!1;let e=navigator.userAgent,t=navigator.vendor;return/Safari/i.test(e)&&/Apple Computer/.test(t)})(),h_=Number((()=>{if(typeof window>"u")return null;let e=navigator.userAgent.match(/Version\/(\d+\.\d)/);return e&&e[1]})());function d_(e){return Array.isArray(e)?e:[e]}function u_(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}function p_(e){return a_?e.metaKey:e.ctrlKey}var f_=[],m_={},g_={},v_={};function y_(e){f_.includes(e)||f_.push(e)}function b_(e){delete m_[e.pointerId];for(let t=0;t<f_.length;t++)if(f_[t].pointerId===e.pointerId){f_.splice(t,1);break}}function x_(e){if("touch"!==e.pointerType)return;let t=m_[e.pointerId];void 0===t&&(t={x:0,y:0},m_[e.pointerId]=t),t.x=e.pageX,t.y=e.pageY}function w_(e){let t=e.pointerId===f_[0].pointerId?f_[1]:f_[0];return m_[t.pointerId]}function __(e){g_[e.key]=!0,v_[e.key]=void 0===v_[e.key]?1:v_[e.key]+1}function S_(e){if(a_&&g_.Meta)for(let t in g_)g_[t]=!1;else g_[e.key]=!1;v_={}}var A_,E_,C_=new Promise((e=>{A_=e}));function M_(){if(E_)return E_;return E_=async function(){let e=__webpack_require__.e(208).then(__webpack_require__.bind(__webpack_require__,1208)),[t,i]=await Promise.all([e,fetch("".concat("https://unpkg.com/@splinetool/navmesh-wasm@1.2.5/build","/navmesh.wasm")).then((e=>e.arrayBuffer()))]),n=t.default,r=await n({wasmBinary:i});A_(r)}()}var P_,T_,D_=new Promise((e=>{P_=e}));function R_(){if(T_)return T_;return T_=async function(){let e=await __webpack_require__.e(293).then(__webpack_require__.bind(__webpack_require__,7293));await e.init(),P_(e)}()}var O_=class{modifyById(e,t){let i=this;if(void 0===i[e])throw new Error("not expected");{let n={...i,[e]:t};return Object.setPrototypeOf(n,O_.prototype),n}}add(e,t){var i,n;return null!==(i=null===(n=this.runOp({type:1,id:e,data:t}))||void 0===n?void 0:n.data)&&void 0!==i?i:this}runOp(e){let t=this;if(1===e.type){let i,n=t[e.id];i=void 0===n?{type:2,id:e.id}:{type:1,id:e.id,data:n};let{id:r,data:a}=e,s={...t,[r]:a};return Object.setPrototypeOf(s,O_.prototype),{data:s,actual:e,reverse:i}}if(2===e.type){let{id:i}=e,n=t[i];if(void 0===n)return null;{let r={...t};return Object.setPrototypeOf(r,O_.prototype),delete r[i],{data:r,actual:e,reverse:{type:1,id:i,data:n}}}}return null}};function I_(e){if(void 0!==e.deepFreeze)return void e.deepFreeze(e);let t=Object.getOwnPropertyNames(e);for(let i of t){let t=e[i];t&&"object"==typeof t&&I_(t)}return Object.freeze(e)}var k_=class extends Error{};function L_(e){let t={...e};return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}function F_(e,t,i){if(void 0===e?void 0===t?(e=0,t=10):e=t-10:void 0===t&&(t=e+10),e>t){let i=e;e=t,t=i}let n=[],r=1/(i+1);for(let a=0;a<i;a++){let i=e+(t-e)*(a+.75+.5*Math.random())*r;n.push(i)}return n}function B_(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array}function N_(e,t){for(let i of e)!0!==t(i.id,i.data)&&N_(i.children,t)}function z_(e,t){if(!0!==t(e.id,e.data))for(let i of e.children)z_(i,t)}var U_,j_=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,j_.prototype)}deepFreeze(){let e=0;for(;e<this.length;)I_(this[e]),e++}fillCaches0(e,t){this.objCaches.set(e.id,e),this.parentCaches.set(e.id,t);for(let i of e.children)this.fillCaches0(i,e.id)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,this.parentCaches=new Map;for(let e of this)this.fillCaches0(e,null)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}nonExistOrDescendantOf(e,t){if(!this.has(e))return!0;for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}rootAcestor(e){for(;e;){let t=this.parent(e);if(!t)return e;e=t}return e}isDescendantOf(e,t){for(;e;){let i=this.parent(e);if(i===t)return!0;e=i}return!1}data(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}has(e){return void 0!==this.childrenOf(e)}get(e){return this.fillCaches(),this.objCaches.get(e)}childrenOf(e){var t;return null===e?this:null===(t=this.get(e))||void 0===t?void 0:t.children}traverseFrom(e,t){if(null===e)this.traverse(t);else{let i=this.get(e);i&&z_(i,t)}}traverse(e){N_(this,e)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(e){return this.fillCaches(),this.parentCaches.get(e)}childrenArray(e){return null===e?this:this.get(e).children}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this.parent(e),n=this.childrenArray(i),r=n.findIndex((t=>t.id===e));if(r<0)throw new Error("not expected");let a=n[r];return n=[...n],n[r]={...a,data:t},this.modifyArrayBy(i,n)}}modifyArrayBy(e,t){let i=e,n=t;for(;null!==i;){let e=n,t=i;if(i=this.parent(i),void 0===i)throw new Error;n=this.childrenArray(i);let r=n.findIndex((e=>e.id===t));if(r<0)throw new Error;n=[...n],n[r]={...n[r],children:e}}Object.setPrototypeOf(n,j_.prototype);let r=n;return r.fillCaches(),r}runOp(e){switch(e.type){case 7:return this.addOp(e);case 8:return this.deleteOp(e);case 9:return this.moveOp(e)}return null}checkDuplicatedIdRec(e){let{id:t,children:i}=e;if(void 0!==this.get(t))return!0;for(let n of i)if(this.checkDuplicatedIdRec(n))return!0;return!1}addOp(e){let{parent:t,fi:i,id:n,data:r,children:a}=e;if(null!==t&&void 0===this.get(t))return null;if(this.checkDuplicatedIdRec(e))return null;{let s=t,o=this.childrenArray(s),l={fi:i,id:n,data:r,children:a};return o=[...o,l],o.sort(((e,t)=>e.fi-t.fi)),e.localIndex=o.indexOf(l),{data:this.modifyArrayBy(s,o),actual:e,reverse:{type:8,id:n}}}}deleteOp(e){let{id:t}=e;if(null===this.get(t))return null;{let i=this.parent(t);if(void 0===i)return null;let n=this.childrenArray(i),r=n.findIndex((e=>e.id===t));e.localIndex=r,n=[...n];let a=n.splice(r,1)[0];return{data:this.modifyArrayBy(i,n),actual:e,reverse:{type:7,...a,parent:i}}}}moveOp(e){let{parent:t,fi:i,id:n}=e;if(null!==t&&void 0===this.get(t))return this.deleteOp({type:8,id:n});if(null!==t){let e=t;for(;null!==e;){if(void 0===e)throw new Error;if(e===n)throw new k_("cyclic tree");e=this.parent(e)}}let r=this.parent(n);if(void 0===r)return null;let a=r,s=this.childrenArray(r),o=s.findIndex((e=>e.id===n));s=[...s];let l=s.splice(o,1)[0],c=this.modifyArrayBy(r,s);r=t,s=c.childrenArray(r);let h=l.fi;return l={...l,fi:i},s=[...s,l],s.sort(((e,t)=>e.fi-t.fi)),e.localIndex=s.indexOf(l),c=c.modifyArrayBy(r,s),{data:c,actual:e,reverse:{type:9,parent:a,fi:h,id:n}}}previous(e,t){if(null===t){let t=this.childrenArray(e);return 0===t.length?null:t[t.length-1].id}let i=null;for(let n of this.childrenArray(e)){if(n.id===t)return i;i=n.id}return null}traverseSortNext(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex((t=>t.id===e))+1;if(n<i.length)return i[n].id;if(t)return this.traverseSortNext(t)}}sortNext(e){let t=this.childrenArray(e);return t.length>0?t[0].id:this.traverseSortNext(e)}traverseSortPrevious(e){let t=this.childrenArray(e);return t.length>0?this.traverseSortPrevious(t[t.length-1].id):e}sortPrevious(e){let t=this.parent(e);if(void 0!==t){let i=this.childrenArray(t),n=i.findIndex((t=>t.id===e))-1;return n>=0?this.traverseSortPrevious(i[n].id):t}}getAllSorted(e){let t=[];for(let i of e){let e=this.getWithSortKey(i.id);void 0!==e&&t.push({...i,...e})}t.sort(((e,t)=>function(e,t){let i=0;for(;i<e.length&&i<t.length;){if(e[i]<t[i])return-1;if(e[i]>t[i])return 1;i+=1}return i!==t.length?-1:i!==e.length?1:0}(e.sortKey,t.sortKey)));for(let i of t)delete i.sortKey;return t}getWithSortKey(e){var t=e;let i=[],n=this.get(t),r=n;if(void 0!==n){for(;t;)i.splice(0,0,n.fi),null!==(t=this.parent(t))&&(n=this.get(t));return{...r,sortKey:i}}}insertBeforeHelper(e,t,i){return this.insertAfterHelper(e,this.previous(e,t),i)}insertAfterHelper(e,t,i){let n=this.childrenArray(e);if(null===t){if(0===n.length)return F_(0,i,i);{let e=n[0].fi;return F_(e-i,e,i)}}{let r=this.get(t);if(void 0===r||this.parent(t)!==e)throw new Error("illegal args");let a=n.find((e=>e.fi>r.fi));if(void 0===a){let e=n[n.length-1].fi;return F_(e,e+i,i)}return F_(r.fi,a.fi,i)}}};(U_||(U_={})).runOp=function(e,t){if(0!==t.type)return null;if(Array.isArray(e)){let i=t.props,n={},r=[...e],a=!1;if(i)for(let e of Object.keys(i)){let t=parseInt(e);if(isNaN(t))throw new Error("wrong index");n[e]=r[t],r[t]=i[e],a=!0}return a?{data:r,actual:t,reverse:{type:0,props:n}}:null}{let i=t.props,n={},r={...e},a=!1;if(i)for(let e of Object.keys(i)){n[e]=r[e];let t=i[e];void 0===t?delete r[e]:r[e]=t,a=!0}return a?{data:r,actual:t,reverse:{type:0,props:n}}:null}};var V_=class extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,V_.prototype)}deepFreeze(){let e=0;for(;e<this.length;)I_(this[e]),e++}fillCaches0(e){this.objCaches.set(e.id,e)}fillCaches(){if(void 0===this.objCaches){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let e of this)this.fillCaches0(e)}}randomId(){this.fillCaches();let e=Array.from(this.objCaches.keys());if(0!==e.length)return e[Math.max(0,Math.floor(Math.random()*e.length)-1)]}data(e){var t;return null===(t=this.get(e))||void 0===t?void 0:t.data}get(e){return this.fillCaches(),this.objCaches.get(e)}modifyById(e,t){if(void 0===this.get(e))throw new Error("not expected");{let i=this,n=i.findIndex((t=>t.id===e));if(n<0)throw new Error("not expected");let r=i[n];return i=[...i],i[n]={...r,data:t},this.modifyArrayBy(i)}}modifyArrayBy(e){Object.setPrototypeOf(e,V_.prototype);let t=e;return typeof process<"u"||t.fillCaches(),t}runOp(e){switch(e.type){case 4:return this.addOp(e);case 5:return this.deleteOp(e);case 6:return this.moveOp(e)}return null}addOp(e){let{fi:t,id:i,data:n}=e,r=this,a={fi:t,id:i,data:n};return r=[...r,a],r.sort(((e,t)=>e.fi-t.fi)),e.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:e,reverse:{type:5,id:i}}}deleteOp(e){let{id:t}=e,i=this,n=i.findIndex((e=>e.id===t));if(-1===n)return null;e.localIndex=n,i=[...i];let r=i.splice(n,1)[0];return{data:this.modifyArrayBy(i),actual:e,reverse:{type:4,...r}}}moveOp(e){let{fi:t,id:i}=e,n=this;n=[...n];let r=n.findIndex((e=>e.id===i));if(-1===r)return null;let a=n[r].fi,s={...n[r],fi:t};return n[r]=s,n.sort(((e,t)=>e.fi-t.fi)),e.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:e,reverse:{type:6,fi:a,id:i}}}previous(e){if(null===e)return 0===this.length?null:this[this.length-1].id;let t=null;for(let i of this){if(i.id===e)return t;t=i.id}return null}insertBeforeHelper(e,t){return this.insertAfterHelper(this.previous(e),t)}insertAfterHelper(e,t){let i=this;if(null===e){if(0===i.length)return F_(0,t,t);{let e=i[0].fi;return F_(e-t,e,t)}}{let n=this.get(e);if(void 0===n)throw new Error("illegal args");let r=i.find((e=>e.fi>n.fi));if(void 0===r){let e=i[i.length-1].fi;return F_(e,e+t,t)}return F_(n.fi,r.fi,t)}}};function G_(e){return e&&"object"==typeof e&&e instanceof Q_}var H_,W_,q_,X_,Y_,Q_=class{unusedFunOverridesTable(e){}runOp(e){let t=[],i=this,n=0,r={};for(;n<e.path.length;){if(t.push(i),i=void 0===i?void 0:i[e.path[n]],void 0!==i&&!G_(i))return null;n+=1}i=i?L_(i):new Q_;for(let[a,s]of Object.entries(e.props)){let e=i[a];r[a]=e,void 0===s?delete i[a]:i[a]=s}for(;n>0;){if(0===Object.keys(i).length){let r=t[n-1];r&&(i=L_(r),delete i[e.path[n-1]])}else{let r=t[n-1];if(r){let t=L_(r);t[e.path[n-1]]=i,i=t}else{let t=new Q_;t[e.path[n-1]]=i,i=t}}n-=1}return{data:Object.setPrototypeOf(i,Q_.prototype),actual:e,reverse:{...e,props:r}}}};function K_(e,t){if(void 0===t)return;let i=!1,n=e.map((e=>{let n=e.id,r=Z_(e.data,t[n]);if(i=i||void 0!==r,void 0===r&&(r=e.data),e.children){let a=K_(e.children,t);return void 0!==a?i=!0:a=e.children,{...e,id:n,data:r,children:a}}return{...e,id:n,data:r}}));return i?n:void 0}function Z_(e,t){if(!G_(t))return t;if(e instanceof j_){let i=K_(e,t);return void 0!==i&&Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i}if(e instanceof V_)return function(e,t){if(void 0===t)return;let i=!1,n=e.map((e=>{let n=e.id,r=Z_(e.data,t[n]);return i=i||void 0!==r,void 0===r&&(r=e.data),{...e,id:n,data:r}}));return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}(e,t);if(Array.isArray(e)){let i=!1,n=e.map(((e,n)=>{let r=Z_(e,t[n]);return i=i||void 0!==r,void 0===r&&(r=e),r}));return i?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if(e instanceof Q_)return J_(e,t);if(e&&"object"==typeof e){let i={},n=!1;for(let[r,a]of Object.entries(e)){let e=Z_(a,t[r]);n=n||void 0!==e,void 0===e&&(e=a),i[r]=e}return n?(Object.setPrototypeOf(i,Object.getPrototypeOf(e)),i):void 0}}function J_(e,t){if(void 0===e)return t;if(void 0===t)return e;if(!G_(t))return t;if(!G_(e))return H_.apply(e,t);let i=new Set;for(let r of Object.keys(e))i.add(r);for(let r of Object.keys(t))i.add(r);let n=new Q_;for(let r of i){let i=J_(void 0===e?void 0:e[r],void 0===t?void 0:t[r]);n[r]=i}return n}function $_(e,t){var i;let n={cur:[],result:[],len:0};return[e=null!==(i=nS(e,t,n))&&void 0!==i?i:e,n.result]}function eS(e,t){return null===e?null:(e.cur[e.len]=t,e.len+=1,e)}function tS(e){e&&(e.len-=1)}function iS(e,t,i){let n=!1,r=e.map((e=>{let r=e.id,a=t[r];if(void 0!==a&&"string"==typeof a&&(n=!0,r=a,null!==i))throw new Error("not supported");let s=nS(e.data,t,eS(i,r));tS(i),n=n||void 0!==s,void 0===s&&(s=e.data);let o=iS(e.children,t,i);return void 0!==o?n=!0:o=e.children,{...e,id:r,data:s,children:o}}));if(n)return r}function nS(e,t,i){if(e instanceof j_){let n=iS(e,t,i);return void 0!==n&&Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n}if(e instanceof V_)return function(e,t,i){let n=!1,r=e.map((e=>{let r=e.id,a=t[r];if(void 0!==a&&"string"==typeof a&&(n=!0,r=a,null!==i))throw new Error("not supported");let s=nS(e.data,t,eS(i,r));return tS(i),n=n||void 0!==s,void 0===s&&(s=e.data),{...e,id:r,data:s}}));if(n)return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r}(e,t,i);if(Array.isArray(e)){let n=!1,r=e.map(((e,r)=>{let a=nS(e,t,eS(i,r));return tS(i),n=n||void 0!==a,void 0===a&&(a=e),a}));return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(e)),r):void 0}if(e&&"object"==typeof e&&!B_(e)){let n={},r=!1;for(let[a,s]of Object.entries(e))if("name"!==a){let e=t[a];if("string"==typeof e){if(null!==i)throw new Error("not supported");r=!0,a=e}let o=nS(s,t,eS(i,a));tS(i),r=r||void 0!==o,void 0===o&&(o=s),n[a]=o}else n[a]=s;return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(e)),n):void 0}if("string"==typeof e){let n=t[e];return void 0!==n&&function(e){if(null===e)return null;e.result.push(e.cur.slice(0,e.len))}(i),n}}(W_=H_||(H_={})).apply=function(e,t){var i;return null!==(i=Z_(e,t))&&void 0!==i?i:e},W_.merge=function(e,t){return J_(e,t)},W_.filterOp=function(e,t){let i=0,n=t.path,r=e;for(;i<n.length&&void 0!==r;){if(r=gS.zoomOnce(r,n[i]),void 0===r)return t;if(!G_(r))return;i+=1}if(void 0===r)return t;if(G_(r)){if(0===t.type){let e={...t.props};for(let t of Object.keys(r))delete e[t];return{...t,props:e}}if(1===t.type||4===t.type||7===t.type){let e=K_([t],r);return e?(console.log(e),e):t}return t}},(e=>{e.replaceProps=function(e,t){let i=gS.zoom(t,e.path);if("object"==typeof i){let t={};for(let n of Object.keys(e.props))t[n]=i[n];return{...e,props:t}}return{...e,props:{}}}})(q_||(q_={})),(e=>{function t(e,t){let i=t.path;for(var n=[];;){let s;if(e instanceof Q_&&0===t.type&&(s=e.runOp({...t,path:i.slice(n.length)}),null===s&&(s=void 0)),void 0===s&&n.length===i.length&&(s=e instanceof j_||e instanceof V_||e instanceof O_?e.runOp(t):U_.runOp(e,t)),void 0!==s){if(null!==s){let e=s.data;for(let t=n.length-1;t>=0;t--){let r=i[t],a=n[t];if(a instanceof j_){if("number"==typeof r)throw new Error("illegal arg");e=a.modifyById(r,e)}else if(a instanceof V_){if("number"==typeof r)throw new Error("illegal arg");e=a.modifyById(r,e)}else if(a instanceof O_){if("number"==typeof r)throw new Error("illegal arg");e=a.modifyById(r,e)}else if(a instanceof Q_){let t={...a,[r]:e};e=Object.setPrototypeOf(t,Q_.prototype)}else{if("object"!=typeof a)return null;if(Array.isArray(a)){if("string"==typeof r&&(r=parseInt(r),isNaN(r)))throw new Error("Invalid path");let t=e;e=[...a],e[r]=t}else e={...a,[r]:e}}}return{data:e,actual:{...s.actual,path:i},reverse:{...s.reverse,path:i}}}return null}let o,l=i[n.length];if(e instanceof j_){var r;if("number"==typeof l)throw new Error("");o=null===(r=e.get(l))||void 0===r?void 0:r.data}else if(e instanceof V_){var a;if("number"==typeof l)throw new Error("");o=null===(a=e.get(l))||void 0===a?void 0:a.data}else null!==e&&(o=e[l]);if(void 0===o)return null;n.push(e),e=o}}function i(e,t){for(let i=0;i<e.length&&i<t.length;i++)if(e[i]!==t[i])return!0;return!1}function n(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}e.drop=function(e,t){return{...e,path:e.path.slice(t)}},e.applySimple=function(e,i){var n,r;return null!==(n=null===(r=t(e,i))||void 0===r?void 0:r.data)&&void 0!==n?n:e},e.apply=t,e.pathDisjoint=i,e.pathEq=n,e.commutative=function(e,t){return i(e.path,t.path)},e.subsumed=function(e,t){return!(0!==e.type||0!==t.type||!n(e.path,t.path))&&Object.keys(e.props).every((e=>void 0!==t.props[e]))}})(X_||(X_={})),(e=>{function t(e,t){var i=e;let n=[],r=[];for(let s of t)try{if(3===s.type||5===s.type&&"variables"===s.path[s.path.length-1]){let e,t,a;if(3===s.type?(e=gS.zoom(i,[...s.path,s.id]),a=X_.apply(i,{...s,type:2})):(e=gS.zoom(i,[...s.path,s.id,"value"]),a=X_.apply(i,s)),null!==a){i=a.data;let[o,l]=$_(i,{[s.id]:e});i=o;for(let a=0;a<l.length;a++){let o=l[a],c=o.pop();if("number"==typeof c){let n=[c];for(let e=a+1;e<l.length;e++){let t=l[e],i=t[t.length-1];if("number"!=typeof i||!gS.equal(o,t.slice(0,t.length-1)))break;n.push(i),l.splice(e,1)}let r=gS.zoom(i,o);t=r.map(((e,t)=>n.includes(t)?s.id:e)),e=r,c=o.pop()}else{if("alphaOverride"===c||"alpha"===c){e/=100;let t=e,n=gS.zoom(i,o.slice(0,o.length-2)),r=n.layers.map((e=>e.id===o[o.length-1]?{...e,data:{...e.data,[c]:t}}:e));Object.setPrototypeOf(r,Object.getPrototypeOf(n.layers)),n.layers=r}t=s.id}n.push({type:0,path:o,props:{[c]:e}}),r.push({type:0,path:o,props:{[c]:t}})}r.push(a.reverse),n.push(a.actual)}}else{let e=X_.apply(i,s);null!==e&&(n.push(e.actual),i=e.data,r.push(e.reverse))}}catch(a){if(a instanceof k_)return null;throw a}return{data:i,actual:n,reverse:r.reverse()}}e.empty=function(){return[]},e.removePrefix=function(e,t){let i=[];for(let n of e){let[e,...r]=n.path;e===t&&i.push({...n,path:r})}return i},e.addPrefix=function(e,t){return e.map((e=>({...e,path:[t,...e.path]})))},e.concat=function(e,t){return[...e,...t]},e.compress=function(e,t){return[...e.filter((e=>!t.some((t=>X_.subsumed(e,t))))),...t]},e.commutative=function(e,t){return e.every((e=>t.every((t=>X_.commutative(e,t)))))},e.applyAll=function(e,i){for(let n of i){let i=t(e,n);null!==i&&(e=i.data)}return e},e.apply=t})(Y_||(Y_={}));var rS=Symbol(),aS=Symbol(),sS=Symbol(),oS=class{reportOp(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this;if(null===t)return;n._current=t.data;let r=i;for(;!(n instanceof vS);){let e=n._path,t=n._current;if(""!==e&&r.splice(0,0,e),n=n._parent,null===n)return;n.update(e,t)}n.push(r,e,t.actual,t.reverse)}deleteChildren(e){if(this._children){let t=this._children[e];if(t){let i=t[sS];i&&i(),delete this._children[e]}}}},lS=class extends oS{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){if(Array.isArray(this._current)){if("string"==typeof e&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid path");this._current=[...this._current],this._current[e]=t}else this._current={...this._current,[e]:t}}runOp(e){this.reportOp(e,U_.runOp(this._current,e),e.path)}},cS=class extends oS{constructor(e,t,i){super(),this._parent=e,this._path=t,this._current=i}update(e,t){this._current={...this._current,[e]:t},Object.setPrototypeOf(this._current,O_.prototype)}runOp(e){this.reportOp(e,this._current.runOp(e))}},hS={get(e,t){if(t===sS)return()=>{e._parent=null};if(t===rS)return e._current;if(t===aS)return e;let{_current:i,_children:n}=e;if("push"===t&&Array.isArray(i))throw new Error("not supported to expand array");let r=void 0===n?void 0:n[t];if(void 0!==r)return r;let a=i[t],s=yS(e,t,a);return s!==a?(void 0===n&&(n={},e._children=n),n[t]=s,s):a},has:(e,t)=>t in e._current,ownKeys:e=>Reflect.ownKeys(e._current),defineProperty(){throw Error("not supported")},getPrototypeOf:e=>Object.getPrototypeOf(e._current),setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(e,t){let i=e._current,n=Reflect.getOwnPropertyDescriptor(i,t);return n&&{writable:!0,configurable:!0,enumerable:n.enumerable,value:i[t]}}},dS={...hS,set(e,t,i){var n;let r={type:0,props:{[t]:null!==(n=wS(i))&&void 0!==n?n:i}};return e.deleteChildren(t),e.runOp(r),!0},deleteProperty(e,t){let i={type:0,props:{[t]:void 0}};return e.deleteChildren(t),e.runOp(i),!0}},uS={...hS,set(e,t,i){return void 0===i?this.deleteProperty(e,t):(e.deleteChildren(t),e.runOp({type:1,id:t,data:i})),!0},deleteProperty:(e,t)=>(e.runOp({type:2,id:t}),!0)},pS=class extends oS{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[sS]=()=>{this._parent=null}}unproxy(){return this._current}update(e,t){this._current=this._current.modifyById(e,t)}runOp(e){this.reportOp(e,this._current.runOp(e))}randomId(){return this._current.randomId()}isDescendantOf(e,t){return this._current.isDescendantOf(e,t)}childrenOf(e){return this._current.childrenOf(e)}traverse(e){return this._current.traverse(e)}get(e){return this._current.get(e)}parent(e){return this._current.parent(e)}traverse(e){this._current.traverse(((t,i)=>{e(t,this.data(t))}))}data(e){var t;let{_current:i,_children:n}=this,r=void 0===n?void 0:n[e];if(void 0!==r)return r;let a=null===(t=i.get(e))||void 0===t?void 0:t.data,s=yS(this,e,a);return s!==a?(void 0===n&&(n={},this._children=n),n[e]=s,s):a}add(e,t,i,n,r){this.runOp({type:7,parent:e,fi:t,id:i,data:n,children:r})}move(e,t,i){this.runOp({type:9,parent:e,fi:t,id:i})}insertAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.add(e,n[r],t.id,t.data,t.children)}}insertBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.add(e,n[r],t.id,t.data,t.children)}}moveAfter(e,t,i){let n=this._current.insertAfterHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.move(e,n[r],t)}}moveBefore(e,t,i){let n=this._current.insertBeforeHelper(e,t,i.length);for(let r=0;r<i.length;r++){let t=i[r];this.move(e,n[r],t)}}delete(e){this.deleteChildren(e),this.runOp({type:8,id:e})}sortNext(e){return this._current.sortNext(e)}sortPrevious(e){return this._current.sortPrevious(e)}getAllSorted(e){return this._current.getAllSorted(e)}},fS=class extends oS{constructor(e,t,i){super(),this._children={},this._parent=e,this._path=t,this._current=i,this[sS]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(e){let t=this.length;for(let i=0;i<t;i++){let t=this._current[i].id,n=this._current[i].fi;e(this.data(this._current[i].id),t,n)}}find(e){let t=this.length;for(let i=0;i<t;i++){let t=this._current[i].id;if(e(this.data(t),t))return this.get(t)}}update(e,t){this._current=this._current.modifyById(e,t)}randomId(){return this._current.randomId()}get(e){return{...this._current.get(e),data:this.data(e)}}data(e){var t;let{_current:i,_children:n}=this,r=void 0===n?void 0:n[e];if(void 0!==r)return r;let a=null===(t=i.get(e))||void 0===t?void 0:t.data,s=yS(this,e,a);return s!==a?(void 0===n&&(n={},this._children=n),n[e]=s,s):a}runOp(e){this.reportOp(e,this._current.runOp(e))}add(e,t,i){this.runOp({type:4,fi:e,id:t,data:i})}move(e,t){this.runOp({type:6,fi:e,id:t})}insertAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.add(i[n],e.id,e.data)}}insertBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.add(i[n],e.id,e.data)}}moveAfter(e,t){let i=this._current.insertAfterHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.move(i[n],e)}}moveBefore(e,t){let i=this._current.insertBeforeHelper(e,t.length);for(let n=0;n<t.length;n++){let e=t[n];this.move(i[n],e)}}delete(e){this.deleteChildren(e),this.runOp({type:5,id:e})}};function mS(e,t,i){if(e.length>0){let n=e[e.length-1];if(0===n.type&&0===t.type&&gS.equal(n.path,i))return void Object.assign(n.props,t.props)}e.push({...t,path:i})}var gS,vS=class extends oS{constructor(e){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=e}update(e,t){if(""!==e)throw new Error("");this._current=t}push(e,t,i,n){mS(this.ts,t,e),mS(this.actual,i,e),mS(this.reverse,n,e)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function yS(e,t,i){return i instanceof j_?new pS(e,t,i):i instanceof V_?new fS(e,t,i):i instanceof O_?new Proxy(new cS(e,t,i),uS):null!==i&&"object"==typeof i?B_(i)?i:new Proxy(new lS(e,t,i),dS):i}function bS(e){let t=new vS(e);return[yS(t,"",e),t]}function xS(e,t){let[i,n]=bS(e);return t(i),n.result()}function wS(e){return e instanceof pS||e instanceof fS?e._current:null!==e&&"object"==typeof e?e[rS]:e}function _S(e,t){let i=[];if(!(t.length<=e.length))return null;for(var n=0;n<t.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e=>{function t(e,t){return(e instanceof j_||e instanceof pS)&&"string"==typeof t||(e instanceof V_||e instanceof fS)&&"string"==typeof t?e.data(t):"number"==typeof t&&Array.isArray(e)||"string"==typeof t&&"object"==typeof e&&null!==e?e[t]:void 0}function i(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;n<i.length&&void 0!==e;)e=t(e,i[n]),n+=1;return e}e.equal=function(e,t){if(t.length!==e.length)return!1;for(var i=0;i<e.length;){if(e[i]!==t[i])return!1;i+=1}return!0},e.removeOverridden=function(e,t,n){let r=i(n,e);if(void 0!==r&&"object"==typeof r&&null!==r){let e={...t};return Object.keys(r).forEach((t=>{delete e[t]})),e}return t},e.zoomOnce=t,e.zoom=i})(gS||(gS={}));var SS,AS=class{},ES=class extends AS{constructor(e){super(),this.id=e}},CS=class extends AS{constructor(e){super(),this.data=e}};try{SS=new TextDecoder}catch{}var MS,PS,TS,DS,RS,OS,IS,kS=0,LS=[],FS=LS,BS=0,NS={},zS=0,US=0,jS=[],VS={useRecords:!1,mapsAsObjects:!0},GS=class{},HS=new GS;HS.name="MessagePack 0xC1";var WS=!1,qS=class{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0)),Object.assign(this,e)}unpack(e,t){if(MS)return vA((()=>(yA(),this?this.unpack(e,t):qS.prototype.unpack.call(VS,e,t))));PS=t>-1?t:e.length,kS=0,BS=0,US=0,DS=null,FS=LS,RS=null,MS=e;try{IS=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(W_){throw MS=null,e instanceof Uint8Array?W_:new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof qS){if(NS=this,this.structures)return TS=this.structures,XS();(!TS||TS.length>0)&&(TS=[])}else NS=VS,(!TS||TS.length>0)&&(TS=[]);return XS()}unpackMultiple(e,t){let i,n=0;try{WS=!0;let r=e.length,a=this?this.unpack(e,r):wA.unpack(e,r);if(!t){for(i=[a];kS<r;)n=kS,i.push(XS());return i}for(t(a);kS<r;)if(n=kS,!1===t(XS()))return}catch(DE){throw DE.lastPosition=n,DE.values=i,DE}finally{WS=!1,yA()}}_mergeStructures(e,t){for(let i=0,n=(e=e||[]).length;i<n;i++){let t=e[i];t&&(t.isShared=!0,i>=32&&(t.highByte=i-32>>5))}e.sharedLength=e.length;for(let i in t||[])if(i>=0){let n=e[i],r=t[i];r&&(n&&((e.restoreStructures||(e.restoreStructures=[]))[i]=n),e[i]=r)}return this.structures=e}decode(e,t){return this.unpack(e,t)}};function XS(){try{if(!NS.trusted&&!WS){let e=TS.sharedLength||0;e<TS.length&&(TS.length=e)}let e=QS();if(kS==PS)TS.restoreStructures&&YS(),TS=null,MS=null,OS&&(OS=null);else{if(kS>PS){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}if(!WS)throw new Error("Data read, but end of buffer not reached")}return e}catch(DD){throw TS.restoreStructures&&YS(),yA(),(DD instanceof RangeError||DD.message.startsWith("Unexpected end of buffer"))&&(DD.incomplete=!0),DD}}function YS(){for(let e in TS.restoreStructures)TS[e]=TS.restoreStructures[e];TS.restoreStructures=null}function QS(){let e=MS[kS++];if(e<160){if(e<128){if(e<64)return e;{let t=TS[63&e]||NS.getStructures&&$S()[63&e];return t?(t.read||(t.read=ZS(t,63&e)),t.read()):e}}if(e<144){if(e-=128,NS.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[pA()]=QS();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(QS(),QS());return t}}{e-=144;let t=new Array(e);for(let i=0;i<e;i++)t[i]=QS();return t}}if(e<192){let t=e-160;if(US>=kS)return DS.slice(kS-zS,(kS+=t)-zS);if(0==US&&PS<140){let e=t<16?cA(t):lA(t);if(null!=e)return e}return eA(t)}{let t;switch(e){case 192:return null;case 193:return RS?(t=QS(),t>0?RS[1].slice(RS.position1,RS.position1+=t):RS[0].slice(RS.position0,RS.position0-=t)):HS;case 194:return!1;case 195:return!0;case 196:return hA(MS[kS++]);case 197:return t=IS.getUint16(kS),kS+=2,hA(t);case 198:return t=IS.getUint32(kS),kS+=4,hA(t);case 199:return dA(MS[kS++]);case 200:return t=IS.getUint16(kS),kS+=2,dA(t);case 201:return t=IS.getUint32(kS),kS+=4,dA(t);case 202:if(t=IS.getFloat32(kS),NS.useFloat32>2){let e=bA[(127&MS[kS])<<1|MS[kS+1]>>7];return kS+=4,(e*t+(t>0?.5:-.5)|0)/e}return kS+=4,t;case 203:return t=IS.getFloat64(kS),kS+=8,t;case 204:return MS[kS++];case 205:return t=IS.getUint16(kS),kS+=2,t;case 206:return t=IS.getUint32(kS),kS+=4,t;case 207:return NS.int64AsNumber?(t=4294967296*IS.getUint32(kS),t+=IS.getUint32(kS+4)):t=IS.getBigUint64(kS),kS+=8,t;case 208:return IS.getInt8(kS++);case 209:return t=IS.getInt16(kS),kS+=2,t;case 210:return t=IS.getInt32(kS),kS+=4,t;case 211:return NS.int64AsNumber?(t=4294967296*IS.getInt32(kS),t+=IS.getUint32(kS+4)):t=IS.getBigInt64(kS),kS+=8,t;case 212:if(t=MS[kS++],114==t)return fA(63&MS[kS++]);{let e=jS[t];if(e)return e.read?(kS++,e.read(QS())):e.noBuffer?(kS++,e()):e(MS.subarray(kS,++kS));throw new Error("Unknown extension "+t)}case 213:return t=MS[kS],114==t?(kS++,fA(63&MS[kS++],MS[kS++])):dA(2);case 214:return dA(4);case 215:return dA(8);case 216:return dA(16);case 217:return t=MS[kS++],US>=kS?DS.slice(kS-zS,(kS+=t)-zS):tA(t);case 218:return t=IS.getUint16(kS),US>=(kS+=2)?DS.slice(kS-zS,(kS+=t)-zS):iA(t);case 219:return t=IS.getUint32(kS),US>=(kS+=4)?DS.slice(kS-zS,(kS+=t)-zS):nA(t);case 220:return t=IS.getUint16(kS),kS+=2,aA(t);case 221:return t=IS.getUint32(kS),kS+=4,aA(t);case 222:return t=IS.getUint16(kS),kS+=2,sA(t);case 223:return t=IS.getUint32(kS),kS+=4,sA(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}var KS=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function ZS(e,t){function i(){if(i.count++>2){let i=e.read=new Function("r","return function(){return {"+e.map((e=>KS.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"}}")(QS);return 0===e.highByte&&(e.read=JS(t,e.read)),i()}let n={};for(let t=0,i=e.length;t<i;t++){n[e[t]]=QS()}return n}return i.count=0,0===e.highByte?JS(t,i):i}var JS=(e,t)=>function(){let i=MS[kS++];if(0===i)return t();let n=e<32?-(e+(i<<5)):e+(i<<5),r=TS[n]||$S()[n];if(!r)throw new Error("Record id is not defined for "+n);return r.read||(r.read=ZS(r,e)),r.read()};function $S(){let e=vA((()=>(MS=null,NS.getStructures())));return TS=NS._mergeStructures(e,TS)}var eA=rA,tA=rA,iA=rA,nA=rA;function rA(e){let t;if(e<16&&(t=cA(e)))return t;if(e>64&&SS)return SS.decode(MS.subarray(kS,kS+=e));let i=kS+e,n=[];for(t="";kS<i;){let e=MS[kS++];if(0===(128&e))n.push(e);else if(192===(224&e)){let t=63&MS[kS++];n.push((31&e)<<6|t)}else if(224===(240&e)){let t=63&MS[kS++],i=63&MS[kS++];n.push((31&e)<<12|t<<6|i)}else if(240===(248&e)){let t=(7&e)<<18|(63&MS[kS++])<<12|(63&MS[kS++])<<6|63&MS[kS++];t>65535&&(t-=65536,n.push(t>>>10&1023|55296),t=56320|1023&t),n.push(t)}else n.push(e);n.length>=4096&&(t+=oA.apply(String,n),n.length=0)}return n.length>0&&(t+=oA.apply(String,n)),t}function aA(e){let t=new Array(e);for(let i=0;i<e;i++)t[i]=QS();return t}function sA(e){if(NS.mapsAsObjects){let t={};for(let i=0;i<e;i++)t[pA()]=QS();return t}{let t=new Map;for(let i=0;i<e;i++)t.set(QS(),QS());return t}}var oA=String.fromCharCode;function lA(e){let t=kS,i=new Array(e);for(let n=0;n<e;n++){let e=MS[kS++];if((128&e)>0)return void(kS=t);i[n]=e}return oA.apply(String,i)}function cA(e){if(e<4){if(e<2){if(0===e)return"";{let e=MS[kS++];return(128&e)>1?void(kS-=1):oA(e)}}{let t=MS[kS++],i=MS[kS++];if((128&t)>0||(128&i)>0)return void(kS-=2);if(e<3)return oA(t,i);let n=MS[kS++];return(128&n)>0?void(kS-=3):oA(t,i,n)}}{let t=MS[kS++],i=MS[kS++],n=MS[kS++],r=MS[kS++];if((128&t)>0||(128&i)>0||(128&n)>0||(128&r)>0)return void(kS-=4);if(e<6){if(4===e)return oA(t,i,n,r);{let e=MS[kS++];return(128&e)>0?void(kS-=5):oA(t,i,n,r,e)}}if(e<8){let a=MS[kS++],s=MS[kS++];if((128&a)>0||(128&s)>0)return void(kS-=6);if(e<7)return oA(t,i,n,r,a,s);let o=MS[kS++];return(128&o)>0?void(kS-=7):oA(t,i,n,r,a,s,o)}{let a=MS[kS++],s=MS[kS++],o=MS[kS++],l=MS[kS++];if((128&a)>0||(128&s)>0||(128&o)>0||(128&l)>0)return void(kS-=8);if(e<10){if(8===e)return oA(t,i,n,r,a,s,o,l);{let e=MS[kS++];return(128&e)>0?void(kS-=9):oA(t,i,n,r,a,s,o,l,e)}}if(e<12){let c=MS[kS++],h=MS[kS++];if((128&c)>0||(128&h)>0)return void(kS-=10);if(e<11)return oA(t,i,n,r,a,s,o,l,c,h);let d=MS[kS++];return(128&d)>0?void(kS-=11):oA(t,i,n,r,a,s,o,l,c,h,d)}{let c=MS[kS++],h=MS[kS++],d=MS[kS++],u=MS[kS++];if((128&c)>0||(128&h)>0||(128&d)>0||(128&u)>0)return void(kS-=12);if(e<14){if(12===e)return oA(t,i,n,r,a,s,o,l,c,h,d,u);{let e=MS[kS++];return(128&e)>0?void(kS-=13):oA(t,i,n,r,a,s,o,l,c,h,d,u,e)}}{let p=MS[kS++],f=MS[kS++];if((128&p)>0||(128&f)>0)return void(kS-=14);if(e<15)return oA(t,i,n,r,a,s,o,l,c,h,d,u,p,f);let m=MS[kS++];return(128&m)>0?void(kS-=15):oA(t,i,n,r,a,s,o,l,c,h,d,u,p,f,m)}}}}}function hA(e){return NS.copyBuffers?Uint8Array.prototype.slice.call(MS,kS,kS+=e):MS.subarray(kS,kS+=e)}function dA(e){let t=MS[kS++];if(jS[t])return jS[t](MS.subarray(kS,kS+=e));throw new Error("Unknown extension type "+t)}var uA=new Array(4096);function pA(){let e=MS[kS++];if(!(e>=160&&e<192))return kS--,QS();if(e-=160,US>=kS)return DS.slice(kS-zS,(kS+=e)-zS);if(!(0==US&&PS<180))return eA(e);let t,i=4095&(e<<5^(e>1?IS.getUint16(kS):e>0?MS[kS]:0)),n=uA[i],r=kS,a=kS+e-3,s=0;if(n&&n.bytes==e){for(;r<a;){if(t=IS.getUint32(r),t!=n[s++]){r=1879048192;break}r+=4}for(a+=3;r<a;)if(t=MS[r++],t!=n[s++]){r=1879048192;break}if(r===a)return kS=r,n.string;a-=3,r=kS}for(n=[],uA[i]=n,n.bytes=e;r<a;)t=IS.getUint32(r),n.push(t),r+=4;for(a+=3;r<a;)t=MS[r++],n.push(t);let o=e<16?cA(e):lA(e);return n.string=null!=o?o:eA(e)}var fA=(e,t)=>{var i=QS();let n=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,i.highByte=t);let r=TS[e];return r&&r.isShared&&((TS.restoreStructures||(TS.restoreStructures=[]))[e]=r),TS[e]=i,i.read=ZS(i,n),i.read()},mA="object"==typeof self?self:global;jS[0]=()=>{},jS[0].noBuffer=!0,jS[101]=()=>{let e=QS();return(mA[e[0]]||Error)(e[1])},jS[105]=e=>{let t=IS.getUint32(kS-4);OS||(OS=new Map);let i,n=MS[kS];i=n>=144&&n<160||220==n||221==n?[]:{};let r={target:i};OS.set(t,r);let a=QS();return r.used?Object.assign(i,a):(r.target=a,a)},jS[112]=e=>{let t=IS.getUint32(kS-4),i=OS.get(t);return i.used=!0,i.target},jS[115]=()=>new Set(QS());var gA=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));function vA(e){let t=PS,i=kS,n=BS,r=zS,a=US,s=DS,o=FS,l=OS,c=RS,h=new Uint8Array(MS.slice(0,PS)),d=TS,u=TS.slice(0,TS.length),p=NS,f=WS,m=e();return PS=t,kS=i,BS=n,zS=r,US=a,DS=s,FS=o,OS=l,RS=c,MS=h,WS=f,(TS=d).splice(0,TS.length,...u),NS=p,IS=new DataView(MS.buffer,MS.byteOffset,MS.byteLength),m}function yA(){MS=null,OS=null,TS=null}jS[116]=e=>{let t=e[0],i=gA[t];if(!i)throw new Error("Could not find typed array for code "+t);return new mA[i](Uint8Array.prototype.slice.call(e,1).buffer)},jS[120]=()=>{let e=QS();return new RegExp(e[0],e[1])},jS[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],i=kS;kS+=t-4,(RS=[QS(),QS()]).position0=0,RS.position1=0;let n=kS;kS=i;try{return QS()}finally{kS=n}},jS[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");var bA=new Array(147);for(let NY=0;NY<256;NY++)bA[NY]=+("1e"+Math.floor(45.15-.30103*NY));var xA,wA=new qS({useRecords:!1}),_A=(wA.unpack,wA.unpackMultiple,wA.unpack,new Float32Array(1));new Uint8Array(_A.buffer,0,4);try{xA=new TextEncoder}catch{}var SA,AA,EA,CA,MA,PA=typeof Buffer<"u",TA=PA?Buffer.allocUnsafeSlow:Uint8Array,DA=PA?Buffer:Uint8Array,RA=PA?4294967296:2144337920,OA=0,IA=null,kA=/[\u0080-\uFFFF]/,LA=Symbol("record-id"),FA=class extends qS{constructor(e){super(e),this.offset=0;let t,i,n,r,a,s=0,o=DA.prototype.utf8Write?function(e,t,i){return EA.utf8Write(e,t,i)}:!(!xA||!xA.encodeInto)&&function(e,t){return xA.encodeInto(e,EA.subarray(t)).written},l=this;e||(e={});let c=e&&e.sequential,h=e.structures||e.saveStructures,d=e.maxSharedStructures;if(null==d&&(d=h?32:0),d>8160)throw new Error("Maximum maxSharedStructure is 8160");let u=e.maxOwnStructures;null==u&&(u=h?32:64),c&&!e.saveStructures&&(this.structures=[]);let p=d>32||u+d>64,f=d+64,m=d+u+64;if(m>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let g=[],v=0,y=0;this.pack=this.encode=function(e,o){if(EA||(EA=new TA(8192),CA=new DataView(EA.buffer,0,8192),OA=0),(MA=EA.length-10)-OA<2048?(EA=new TA(EA.length),CA=new DataView(EA.buffer,0,EA.length),MA=EA.length-10,OA=0):OA=OA+7&2147483640,t=OA,a=l.structuredClone?new Map:null,l.bundleStrings?(IA=["",""],EA[OA++]=214,EA[OA++]=98,IA.position=OA-t,OA+=4):IA=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let e=i.sharedLength||0;if(e>d)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let t=0;t<e;t++){let e=i[t];if(!e)continue;let n,r=i.transitions;for(let t=0,i=e.length;t<i;t++){let i=e[t];n=r[i],n||(n=r[i]=Object.create(null)),r=n}r[LA]=t+64}s=e}c||(i.nextId=e+64)}n&&(n=!1),r=i||[];try{if(b(e),IA){CA.setUint32(IA.position+t,OA-IA.position-t);let e=IA;IA=null,b(e[0]),b(e[1])}if(l.offset=OA,a&&a.idsToInsert){(OA+=6*a.idsToInsert.length)>MA&&w(OA),l.offset=OA;let e=function(e,t){let i,n=6*t.length,r=e.length-n;for(t.sort(((e,t)=>e.offset>t.offset?1:-1));i=t.pop();){let t=i.offset,a=i.id;e.copyWithin(t+n,t,r),n-=6;let s=t+n;e[s++]=214,e[s++]=105,e[s++]=a>>24,e[s++]=a>>16&255,e[s++]=a>>8&255,e[s++]=255&a,r=t}return e}(EA.subarray(t,OA),a.idsToInsert);return a=null,e}return o&QA?(EA.start=t,EA.end=OA,EA):EA.subarray(t,OA)}finally{if(i){if(y<10&&y++,v>1e4)i.transitions=null,y=0,v=0,g.length>0&&(g=[]);else if(g.length>0&&!c){for(let e=0,t=g.length;e<t;e++)g[e][LA]=0;g=[]}if(n&&l.saveStructures){let n=i.sharedLength||d;i.length>n&&(i=i.slice(0,n));let r=EA.subarray(t,OA);return!1===l.saveStructures(i,s)?(l._mergeStructures(l.getStructures()),l.pack(e)):(s=n,r)}}o&KA&&(OA=t)}};let b=e=>{OA>MA&&(EA=w(OA));var i,n=typeof e;if("string"===n){let t,n=e.length;if(IA&&n>=8&&n<4096){let t=kA.test(e);return IA[t?0:1]+=e,EA[OA++]=193,void b(t?-n:n)}t=n<32?1:n<256?2:n<65536?3:5;let r=3*n;if(OA+r>MA&&(EA=w(OA+r)),n<64||!o){let r,a,s,o=OA+t;for(r=0;r<n;r++)a=e.charCodeAt(r),a<128?EA[o++]=a:a<2048?(EA[o++]=a>>6|192,EA[o++]=63&a|128):55296===(64512&a)&&56320===(64512&(s=e.charCodeAt(r+1)))?(a=65536+((1023&a)<<10)+(1023&s),r++,EA[o++]=a>>18|240,EA[o++]=a>>12&63|128,EA[o++]=a>>6&63|128,EA[o++]=63&a|128):(EA[o++]=a>>12|224,EA[o++]=a>>6&63|128,EA[o++]=63&a|128);i=o-OA-t}else i=o(e,OA+t,r);i<32?EA[OA++]=160|i:i<256?(t<2&&EA.copyWithin(OA+2,OA+1,OA+1+i),EA[OA++]=217,EA[OA++]=i):i<65536?(t<3&&EA.copyWithin(OA+3,OA+2,OA+2+i),EA[OA++]=218,EA[OA++]=i>>8,EA[OA++]=255&i):(t<5&&EA.copyWithin(OA+5,OA+3,OA+3+i),EA[OA++]=219,CA.setUint32(OA,i),OA+=4),OA+=i}else if("number"===n)if(e>>>0===e)e<64?EA[OA++]=e:e<256?(EA[OA++]=204,EA[OA++]=e):e<65536?(EA[OA++]=205,EA[OA++]=e>>8,EA[OA++]=255&e):(EA[OA++]=206,CA.setUint32(OA,e),OA+=4);else if((e|0)===e)e>=-32?EA[OA++]=256+e:e>=-128?(EA[OA++]=208,EA[OA++]=e+256):e>=-32768?(EA[OA++]=209,CA.setInt16(OA,e),OA+=2):(EA[OA++]=210,CA.setInt32(OA,e),OA+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let i;if(EA[OA++]=202,CA.setFloat32(OA,e),t<4||((i=e*bA[(127&EA[OA])<<1|EA[OA+1]>>7])|0)===i)return void(OA+=4);OA--}EA[OA++]=203,CA.setFloat64(OA,e),OA+=8}else if("object"===n)if(e){if(a){let i=a.get(e);if(i){if(!i.id){let e=a.idsToInsert||(a.idsToInsert=[]);i.id=e.push(i)}return EA[OA++]=214,EA[OA++]=112,CA.setUint32(OA,i.id),void(OA+=4)}a.set(e,{offset:OA-t})}let n=e.constructor;if(n===Object)x(e,!0);else if(n===Array){(i=e.length)<16?EA[OA++]=144|i:i<65536?(EA[OA++]=220,EA[OA++]=i>>8,EA[OA++]=255&i):(EA[OA++]=221,CA.setUint32(OA,i),OA+=4);for(let t=0;t<i;t++)b(e[t])}else if(n===Map){(i=e.size)<16?EA[OA++]=128|i:i<65536?(EA[OA++]=222,EA[OA++]=i>>8,EA[OA++]=255&i):(EA[OA++]=223,CA.setUint32(OA,i),OA+=4);for(let[t,i]of e)b(t),b(i)}else{for(let t=0,i=SA.length;t<i;t++){if(e instanceof AA[t]){let i=SA[t];if(i.write)return i.type&&(EA[OA++]=212,EA[OA++]=i.type,EA[OA++]=0),void b(i.write.call(this,e));let n,r=EA,a=CA,s=OA;EA=null;try{n=i.pack.call(this,e,(e=>(EA=r,r=null,(OA+=e)>MA&&w(OA),{target:EA,targetView:CA,position:OA-e})),b)}finally{r&&(CA=a,OA=s,MA=(EA=r).length-10)}return void(n&&(n.length+OA>MA&&w(n.length+OA),OA=zA(n,EA,OA,i.type)))}}x(e,!e.hasOwnProperty)}}else EA[OA++]=192;else if("boolean"===n)EA[OA++]=e?195:194;else if("bigint"===n){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))EA[OA++]=211,CA.setBigInt64(OA,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)EA[OA++]=207,CA.setBigUint64(OA,e);else{if(!this.largeBigIntToFloat)throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");EA[OA++]=203,CA.setFloat64(OA,Number(e))}OA+=8}else if("undefined"===n)this.encodeUndefinedAsNil?EA[OA++]=192:(EA[OA++]=212,EA[OA++]=0,EA[OA++]=0);else{if("function"!==n)throw new Error("Unknown type: "+n);b(this.writeFunction&&this.writeFunction())}},x=!1===this.useRecords?this.variableMapSize?e=>{let t,i=Object.keys(e),n=i.length;n<16?EA[OA++]=128|n:n<65536?(EA[OA++]=222,EA[OA++]=n>>8,EA[OA++]=255&n):(EA[OA++]=223,CA.setUint32(OA,n),OA+=4);for(let r=0;r<n;r++)b(t=i[r]),b(e[t])}:(e,i)=>{EA[OA++]=222;let n=OA-t;OA+=2;let r=0;for(let t in e)(i||e.hasOwnProperty(t))&&(b(t),b(e[t]),r++);EA[n+++t]=r>>8,EA[n+t]=255&r}:e=>{let t,i=Object.keys(e),a=r.transitions||(r.transitions=Object.create(null)),s=0;for(let n=0,r=i.length;n<r;n++){let e=i[n];t=a[e],t||(t=a[e]=Object.create(null),s++),a=t}let o=a[LA];if(o)o>=96&&p?(EA[OA++]=96+(31&(o-=96)),EA[OA++]=o>>5):EA[OA++]=o;else{o=r.nextId,o||(o=64),o<f&&this.shouldShareStructure&&!this.shouldShareStructure(i)?(o=r.nextOwnId,o<m||(o=f),r.nextOwnId=o+1):(o>=m&&(o=f),r.nextId=o+1);let e=i.highByte=o>=96&&p?o-96>>5:-1;a[LA]=o,r[o-64]=i,o<f?(i.isShared=!0,r.sharedLength=o-63,n=!0,e>=0?(EA[OA++]=96+(31&o),EA[OA++]=e):EA[OA++]=o):(e>=0?(EA[OA++]=213,EA[OA++]=114,EA[OA++]=96+(31&o),EA[OA++]=e):(EA[OA++]=212,EA[OA++]=114,EA[OA++]=o),s&&(v+=y*s),g.length>=u&&(g.shift()[LA]=0),g.push(a),b(i))}for(let n=0,r=i.length;n<r;n++)b(e[i[n]])},w=e=>{let i;if(e>16777216){if(e-t>RA)throw new Error("Packed buffer would be larger than maximum buffer size");i=Math.min(RA,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else i=1+(Math.max(e-t<<2,EA.length-1)>>12)<<12;let n=new TA(i);return CA=new DataView(n.buffer,0,i),EA.copy?EA.copy(n,0,t,e):n.set(EA.slice(t,e)),OA-=t,t=0,MA=n.length-10,EA=n}}useBuffer(e){EA=e,CA=new DataView(EA.buffer,EA.byteOffset,EA.byteLength),OA=0}};function BA(e,t,i,n){let r=e.byteLength;if(r+1<256){var{target:a,position:s}=i(4+r);a[s++]=199,a[s++]=r+1}else if(r+1<65536){var{target:a,position:s}=i(5+r);a[s++]=200,a[s++]=r+1>>8,a[s++]=r+1&255}else{var{target:a,position:s,targetView:o}=i(7+r);a[s++]=201,o.setUint32(s,r+1),s+=4}a[s++]=116,a[s++]=t,a.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),s)}function NA(e,t){let i=e.byteLength;var n,r;if(i<256){var{target:n,position:r}=t(i+2);n[r++]=196,n[r++]=i}else if(i<65536){var{target:n,position:r}=t(i+3);n[r++]=197,n[r++]=i>>8,n[r++]=255&i}else{var{target:n,position:r,targetView:a}=t(i+5);n[r++]=198,a.setUint32(r,i),r+=4}n.set(e,r)}function zA(e,t,i,n){let r=e.length;switch(r){case 1:t[i++]=212;break;case 2:t[i++]=213;break;case 4:t[i++]=214;break;case 8:t[i++]=215;break;case 16:t[i++]=216;break;default:r<256?(t[i++]=199,t[i++]=r):r<65536?(t[i++]=200,t[i++]=r>>8,t[i++]=255&r):(t[i++]=201,t[i++]=r>>24,t[i++]=r>>16&255,t[i++]=r>>8&255,t[i++]=255&r)}return t[i++]=n,t.set(e,i),i+=r}function UA(e){if(e.Class){if(!e.pack&&!e.write)throw new Error("Extension has no pack or write function");if(e.pack&&!e.type)throw new Error("Extension has no type (numeric code to identify the extension)");AA.unshift(e.Class),SA.unshift(e)}!function(e){e.unpack?jS[e.type]=e.unpack:jS[e.type]=e}(e)}AA=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,GS],SA=[{pack(e,t,i){let n=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&n>=0&&n<4294967296){let{target:e,targetView:i,position:r}=t(6);e[r++]=214,e[r++]=255,i.setUint32(r,n)}else if(n>0&&n<17179869184){let{target:i,targetView:r,position:a}=t(10);i[a++]=215,i[a++]=255,r.setUint32(a,4e6*e.getMilliseconds()+(n/1e3/4294967296|0)),r.setUint32(a+4,n)}else if(isNaN(n)){if(this.onInvalidDate)return t(0),i(this.onInvalidDate());let{target:e,targetView:n,position:r}=t(3);e[r++]=212,e[r++]=255,e[r++]=255}else{let{target:i,targetView:r,position:a}=t(15);i[a++]=199,i[a++]=12,i[a++]=255,r.setUint32(a,1e6*e.getMilliseconds()),r.setBigInt64(a+4,BigInt(Math.floor(n)))}}},{pack(e,t,i){let n=Array.from(e),{target:r,position:a}=t(this.structuredClone?3:0);this.structuredClone&&(r[a++]=212,r[a++]=115,r[a++]=0),i(n)}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=101,n[r++]=0),i([e.name,e.message])}},{pack(e,t,i){let{target:n,position:r}=t(this.structuredClone?3:0);this.structuredClone&&(n[r++]=212,n[r++]=120,n[r++]=0),i([e.source,e.flags])}},{pack(e,t){this.structuredClone?BA(e,16,t):NA(PA?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let i=e.constructor;i!==DA&&this.structuredClone?BA(e,gA.indexOf(i.name),t):NA(e,t)}},{pack(e,t){let{target:i,position:n}=t(1);i[n]=193}}];var jA,VA,GA,HA=new FA({useRecords:!1}),{NEVER:WA,ALWAYS:qA,DECIMAL_ROUND:XA,DECIMAL_FIT:YA}=(HA.pack,HA.pack,{NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4}),QA=512,KA=1024,ZA=new FA({structuredClone:!0});function JA(e){if(B_(e))return e;if(Array.isArray(e))return e.map(JA);if("object"==typeof e&&null!==e){let t={};for(let i of Object.keys(e).sort())t[i]=JA(e[i]);return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}UA({Class:O_.prototype.constructor,type:1,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,O_.prototype),e)}),UA({Class:V_.prototype.constructor,type:2,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,V_.prototype),e)}),UA({Class:j_.prototype.constructor,type:3,write:e=>[...e],read:e=>(Object.setPrototypeOf(e,j_.prototype),e)}),UA({Class:ES.prototype.constructor,type:4,write:e=>e.id,read:e=>new ES(e)}),UA({Class:CS.prototype.constructor,type:5,write:e=>e.data,read:e=>new CS(e)}),UA({Class:Q_.prototype.constructor,type:6,write:e=>({...e}),read:e=>(Object.setPrototypeOf(e,Q_.prototype),e)}),(e=>{function t(e){return ZA.pack(e)}e.serialize=t,e.deserialize=function(e){return ZA.unpack(e)},e.checksum=function(e){return function(e){var t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e[i],t|=0;return t}(t(JA(e))).toString()}})(jA||(jA={})),(GA=VA||(VA={})).toEventUIType=function(e){return"Conditional"===e.type?"Distance"===e.condition.type?"Distance":"StateChange":e.type},GA.fromEventUIType=function(e){return"Distance"===e||"StateChange"===e?"Conditional":e};var $A,eE,tE,iE,nE,rE,aE,sE,oE,lE,cE,hE,dE,uE,pE,fE={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional"],MouseHover:["Transition","Animation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional"],Scroll:["Transition","Animation","Create","SetVariable","DynamicVariablePlay","Conditional"],Start:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Conditional:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MouseUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],MousePress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyDown:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyUp:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional"],GameControl:["Transition","Animation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional"]};(e=>{e.is=function(e){return"MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type},e.defaultData=function(e){return"MouseDown"===e||"MouseUp"===e||"MousePress"===e?{type:e,mode:"Object",disabled:!1,actions:new V_}:{type:e,disabled:!1,key:void 0,actions:new V_}}})($A||($A={})),(e=>{e.propertyDefaultData=function(e){return{type:"Property",value:[null!==e&&void 0!==e?e:null,"position","x"]}},e.valueDefaultData={type:"Literal",value:0}})(eE||(eE={})),(e=>{e.comparisonDefaultData=function(e){return{type:"Comparison",operator:"==",lOperand:eE.propertyDefaultData(e),rOperand:{...eE.valueDefaultData}}},e.distanceDefaultData=function(e){return{type:"Distance",toObject:null!==e&&void 0!==e?e:null,fromObject:null!==e&&void 0!==e?e:null,distance:200}},e.stateDefaultData=function(e,t){return{type:"State",object:null!==e&&void 0!==e?e:null,state:null!==t&&void 0!==t?t:null}}})(tE||(tE={})),(e=>{e.is=function(e){return"Conditional"===e.type},e.defaultData=function(e){return{type:"Conditional",disabled:!1,inActions:new V_,outActions:new V_,condition:tE.distanceDefaultData(e)}}})(iE||(iE={})),(e=>{e.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new V_,drop:new V_}}})(nE||(nE={})),(e=>{e.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new V_}})(rE||(rE={})),(e=>{e.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5}})(aE||(aE={})),(e=>{e.is=function(e){return"MouseHover"===e.type},e.defaultData=function(){return{type:"MouseHover",disabled:!1,actions:new V_}}})(sE||(sE={})),(e=>{e.is=function(e){return"Scroll"===e.type},e.defaultData=function(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new V_}}})(oE||(oE={})),(e=>{e.is=function(e){return"Start"===e.type},e.defaultData=function(){return{type:"Start",disabled:!1,actions:new V_}}})(lE||(lE={})),(e=>{e.is=function(e){return"Collision"===e.type},e.defaultData=function(){return{type:"Collision",disabled:!1,target:"character",actions:new V_}}})(cE||(cE={})),(e=>{e.is=function(e){return"Trigger"===e.type},e.defaultData=function(e,t){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new V_,triggerZone:"box",position:t.toArray(),rotation:[0,0,0],size:e.toArray(),radius:e.length()/2,helperVisible:!0}}})(hE||(hE={})),(uE=dE||(dE={})).defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]},uE.is=function(e){return"Resize"===e.type},uE.sizeToDevice=function(e){return"string"==typeof e?e:"custom"},uE.deviceToSize=function(e){return"string"==typeof e?[...uE.defaultSizes[e]]:[...e]},uE.defaultData=function(){let e={size:"mobile",operator:"<",actions:new V_},t={size:"tablet",operator:"<",actions:new V_},i={size:[...uE.defaultSizes.custom],operator:"<>",actions:new V_},n=new V_;return n.push({id:Uo.generateUUID(),fi:0,data:e},{id:Uo.generateUUID(),fi:1,data:t},{id:Uo.generateUUID(),fi:2,data:i}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:n}},uE.defaultBreakpointData=function(){return{size:[...uE.defaultSizes.custom],operator:"<>",actions:new V_}},(e=>{e.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]},e.is=function(e){return"VariableChange"===e.type},e.defaultData=function(){return{disabled:!1,type:"VariableChange",actions:new V_,variableId:"",objectId:null,property:"Position X"}}})(pE||(pE={}));var mE,gE,vE,yE,bE,xE,wE,_E,SE,AE,EE,CE,ME,PE,TE,DE,RE,OE,IE,kE,LE="personal camera",FE="a218fcc3-276b-49b9-b485-49037fd14f5f",BE=5526619;function NE(e){return"string"==typeof e&&36===e.length&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)}(e=>{function t(e,t){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)}function i(e,i){return Math.sqrt(t(e,i))}function n(t,i,n){let r=e.sub(i,t),a=e.sub(n,t),s=e.dot(r,a)/e.dot(r,r),o=e.scalarMultiply(r,s);return e.add(t,o)}e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]},e.lerp=function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i]},e.add=function(e,t){return[e[0]+t[0],e[1]+t[1]]},e.sub=function(e,t){return[e[0]-t[0],e[1]-t[1]]},e.multiply=function(e,t){return[e[0]*t[0],e[1]*t[1]]},e.divide=function(e,t){return[e[0]/t[0],e[1]/t[1]]},e.distanceSquared=t,e.distance=i,e.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},e.scalarMultiply=function(e,t){return[e[0]*t,e[1]*t]},e.projectionOnto=n,e.projectionOntoDistance=function(e,t,r){return i(e,n(e,t,r))},e.center=function(e,t){return[.5*(e[0]+t[0]),.5*(e[1]+t[1])]}})(mE||(mE={})),(vE=gE||(gE={})).isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},vE.add=function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},vE.sub=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},vE.div=function(e,t){return[e[0]/t[0],e[1]/t[1],e[2]/t[2]]},vE.mul=function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},vE.dist=function(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},vE.lerp=function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i,e[2]+(t[2]-e[2])*i]},(e=>{e.isEqual=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.lerp=function(e,t,i){return[e[0]+(t[0]-e[0])*i,e[1]+(t[1]-e[1])*i,e[2]+(t[2]-e[2])*i,e[3]+(t[3]-e[3])*i]}})(yE||(yE={})),(e=>{let t=180/Math.PI,i=Math.PI/180;function n(e){return"number"==typeof e?e*t:e}function r(e){return"number"==typeof e?e*i:e}e.radToDeg=function(e){return[n(e[0]),n(e[1]),n(e[2])]},e.degToRad=function(e){return[r(e[0]),r(e[1]),r(e[2])]}})(bE||(bE={})),(wE=xE||(xE={})).identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],wE.isEqual=function(e,t){for(let i=0;i<16;i++)if(e[i]!==t[i])return!1;return!0},wE.simplify=function(e){return null!==e&&void 0!==e?e:wE.identity},wE.applyMatrix4=function(e,t){let i=t.slice(0);for(var n=0,r=t.length;n<r;n+=3){let r=e[3]*t[n]+e[7]*t[n+1]+e[11]*t[n+2]+e[15];i[n]=(e[0]*t[n]+e[4]*t[n+1]+e[8]*t[n+2]+e[12])/r,i[n+1]=(e[1]*t[n]+e[5]*t[n+1]+e[9]*t[n+2]+e[13])/r,i[n+2]=(e[2]*t[n]+e[6]*t[n+1]+e[10]*t[n+2]+e[14])/r}return i},(SE=_E||(_E={})).isRGB=function(e){return"object"==typeof e&&"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b},SE.white={r:1,g:1,b:1},SE.red={r:1,g:0,b:0},SE.black={r:0,g:0,b:0},SE.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:1}},SE.clone=function(e){return{r:e.r,g:e.g,b:e.b}},SE.fromHex=function(e){return{r:((e=Math.floor(e))>>16&255)/255,g:(e>>8&255)/255,b:(255&e)/255}},SE.toHex=function(e){return 65536*Math.round(255*e.r)+256*Math.round(255*e.g)+Math.round(255*e.b)},SE.equals=function(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b},SE.equalsFixed=function(e,t){return e.r.toFixed(2)===t.r.toFixed(2)&&e.g.toFixed(2)===t.g.toFixed(2)&&e.b.toFixed(2)===t.b.toFixed(2)},SE.lerp=function(e,t,i){return{r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i}},(EE=AE||(AE={})).white={..._E.white,a:1},EE.transparent={..._E.white,a:0},EE.from0to1=function(e){return{r:e[0],g:e[1],b:e[2],a:e[3]}},EE.fromHexAndA=function(e,t){return{..._E.fromHex(e),a:t}},EE.toRgb255a1=function(e){return{r:Math.round(255*e.r),g:Math.round(255*e.g),b:Math.round(255*e.b),a:e.a}},EE.equals=function(e,t){return _E.equals(e,t)&&e.a===t.a},EE.equalsFixed=function(e,t){return _E.equalsFixed(e,t)&&e.a.toFixed(2)===t.a.toFixed(2)},EE.lerp=function(e,t,i){return{r:e.r+(t.r-e.r)*i,g:e.g+(t.g-e.g)*i,b:e.b+(t.b-e.b)*i,a:e.a+(t.a-e.a)*i}},EE.toStyle=function(){let{r:e,g:t,b:i,a:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:EE.white;return"rgba(".concat(255*e,", ").concat(255*t,", ").concat(255*i,", ").concat(n,")")},(e=>{e.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}})(CE||(CE={})),(e=>{e.defaultData={mass:1,stiffness:80,damping:10,velocity:0}})(ME||(ME={})),(e=>{e.defaultData={control1:[.5,0],control2:[.5,1]}})(PE||(PE={})),(DE=TE||(TE={})).linear=[0,0,1,1],DE.ease=[.25,.1,.25,1],DE.easeIn=[.42,0,1,1],DE.easeOut=[0,0,.58,1],DE.easeInOut=[.42,0,.58,1],(e=>{e.all=["PerspectiveCamera","OrthographicCamera"],e.is=function(t){return e.all.includes(t)}})(RE||(RE={})),(e=>{e.DefaultUp=[0,1,0],e.DefaultTargetOffset=1e3,e.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:e.DefaultUp,isUpVectorFlipped:!1,targetOffset:e.DefaultTargetOffset},e.getZoom=function(e){var t,i,n,r;return"PerspectiveCamera"===e.type?null!==(t=null===(i=e.perspective)||void 0===i?void 0:i.zoom)&&void 0!==t?t:1:null!==(n=null===(r=e.orthographic)||void 0===r?void 0:r.zoom)&&void 0!==n?n:1}})(OE||(OE={})),(e=>{e.defaultData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:2*Math.max(e[0],e[1]),start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[e[0]+e[0]*t,0,0]},grid:{count:[2,2,2],size:e.map((e=>e*(1+t))),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}},e.merge=function(e,t){let i={...e};if(KE.forEach((n=>{var r;Object.assign(i,{[n]:null!==(r=t[n])&&void 0!==r?r:e[n]})})),i.radial={...e.radial},t.radial){let n=e.radial,r=t.radial;ZE.forEach((e=>{var t;Object.assign(i.radial,{[e]:null!==(t=r[e])&&void 0!==t?t:n[e]})}))}if(i.linear={...e.linear},t.linear){let n=e.linear,r=t.linear;JE.forEach((e=>{var t;Object.assign(i.linear,{[e]:null!==(t=r[e])&&void 0!==t?t:n[e]})}))}if(i.grid={...e.grid},t.grid){let n=e.grid,r=t.grid;$E.forEach((e=>{var t;Object.assign(i.grid,{[e]:null!==(t=r[e])&&void 0!==t?t:n[e]})}))}if(i.toObject={...e.toObject},t.toObject){let n=e.toObject,r=t.toObject;eC.forEach((e=>{var t;Object.assign(i.toObject,{[e]:null!==(t=r[e])&&void 0!==t?t:n[e]})}))}if(i.randomnessObject={...e.randomnessObject},t.randomnessObject){let n=e.randomnessObject,r=t.randomnessObject;tC.forEach((e=>{var t;Object.assign(i.randomnessObject,{[e]:null!==(t=r[e])&&void 0!==t?t:n[e]})}))}return i}})(IE||(IE={})),(e=>{e.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let t=["radial","linear","grid","toObject","randomnessObject"];e.toOps=function(e,i){let n=[];void 0!==e.count&&n.push({type:0,path:i,props:{count:e.count}});for(let r of t){let t=e[r];t&&Object.keys(t).length>0&&n.push({type:0,path:[...i,r],props:t})}return n}})(kE||(kE={}));var zE,UE,jE,VE,GE,HE,WE,qE,XE,YE,QE,KE=["count"],ZE=["radius","start","end","position","scale","rotation"],JE=["position","scale","rotation"],$E=["count","size"],eC=["count","position","scale","rotation"],tC=["strength","scale","rotation","position","movement","seed","freqScale"];(e=>{e.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"],e.is=function(t){return e.all.includes(t)}})(zE||(zE={})),(e=>{e.defaultData=function(e){return function(e){if("PointLight"===e)return{type:e,color:AE.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if("SpotLight"===e)return{type:e,color:AE.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if("DirectionalLight"===e)return{type:e,color:AE.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}(e)}})(UE||(UE={})),(e=>{e.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},e.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},e.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:e.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeLoopDelayStart:"end",emitTimeDuration:1,...e.defaultCollisionData}})(jE||(jE={})),(e=>{e.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]}})(VE||(VE={})),(e=>{e.defaultData={castShadow:!0,receiveShadow:!0},e.equals=function(e,t){return e.castShadow===t.castShadow&&e.receiveShadow===t.receiveShadow}})(GE||(GE={})),(e=>{e.defaultData={flatShading:!1,wireframe:!1,side:0},e.equals=function(e,t){return e.flatShading===t.flatShading&&e.side===t.side&&e.wireframe===t.wireframe}})(HE||(HE={})),(e=>{e.defaultData={...HE.defaultData,...GE.defaultData}})(WE||(WE={})),(e=>{e.getMaterialData=function(e,t){let i=[];if("material"in e){var n,r;let a="string"==typeof e.material?null!==(n=t.materials[e.material])&&void 0!==n?n:null===(r=t.lib.materials[e.material])||void 0===r?void 0:r.asset:e.material;a&&i.push(a)}else if("materials"in e)for(let o of e.materials){var a,s;let e="string"==typeof o?null!==(a=t.materials[o])&&void 0!==a?a:null===(s=t.lib.materials[o])||void 0===s?void 0:s.asset:o;e&&i.push(e)}return i}})(qE||(qE={})),(e=>{e.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},e.maxSize=3e7})(XE||(XE={})),(e=>{e.is=function(e){return"texture"===e||"video"===e||"color"===e||"depth"===e||"normal"===e||"gradient"===e||"noise"===e||"fresnel"===e||"rainbow"===e||"toon"===e||"outline"===e||"particle"===e||"transmission"===e||"matcap"===e||"displace"===e||"pattern"===e||"light"===e}})(YE||(YE={})),(e=>{e.is=function(e){return"phong"===e||"toon"===e||"lambert"===e||"physical"===e}})(QE||(QE={}));var iC,nC,rC,aC,sC=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],oC=["wrapping","image","video","name","minFilter"];(e=>{e.patch=function(e,t){let{texture:i,...n}=t;if(Object.assign(e,n),i){let t=e.texture;t&&Object.assign(t,i)}},e.defaultData=function(e,t){return"light"===e&&t?function(e){let t={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(e){case"phong":return{...t,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...t,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...t,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...t,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}(t):function(e){let t={alpha:1,mode:0,isMask:!1,visible:!0};switch(e){case"texture":return{...t,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008},crop:!1};case"video":return{...t,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:XE.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008},crop:!1};case"color":return{...t,type:"color",color:_E.fromHex(BE)};case"depth":return{...t,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...t,type:"normal",cnormal:[1,1,1]};case"gradient":return{...t,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...t,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{..._E.fromHex(6710886),a:1},colorB:{..._E.fromHex(6710886),a:1},colorC:{..._E.fromHex(16777215),a:1},colorD:{..._E.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...t,type:"fresnel",color:AE.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...t,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...t,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:AE.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...t,type:"outline",outlineColor:AE.fromHexAndA(0,1),contourColor:AE.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...t,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008}};case"transmission":return{...t,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...t,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{..._E.fromHex(0),a:1},colorB:{..._E.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}(e)}})(iC||(iC={})),(e=>{function t(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer1",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer2",n=new V_;return n.push({fi:0,data:iC.defaultData("light",e),id:t}),n.push({fi:1,data:iC.defaultData("color"),id:i}),{layers:n}}e.isMergable=function(e){return!e.layers.some((e=>"texture"===e.data.type&&0!==e.data.projection||"depth"===e.data.type&&!e.data.isWorldSpace||"noise"===e.data.type||"displace"===e.data.type))},e.getHash=function(e){let t="";return e.layers.forEach((e=>{Object.entries(e.data).forEach((e=>{let[i,n]=e;t+="".concat(i).concat(n),Array.isArray(n)?n.forEach((e=>t+="".concat(e))):"object"==typeof n?Object.values(n).forEach((e=>{t+="".concat("number"==typeof e?e.toFixed(4):e)})):t+="".concat(n)}))})),t},e.defaultEmptyData=function(){return{layers:new V_}},e.defaultData=function(){return t("phong",arguments.length>0&&void 0!==arguments[0]?arguments[0]:"layer1",arguments.length>1&&void 0!==arguments[1]?arguments[1]:"layer2")},e.withName=function(e,t){return{...e,name:t}},e.defaultTwoLayerData=t,e.defaultUIObjectMaterial=function(e){let t=iC.defaultData("texture");e&&Object.assign(t.texture,{image:e});let i=new V_;return i.push({fi:0,data:t,id:"layer1"}),i.push({fi:1,data:{...iC.defaultData("transmission"),alpha:1},id:"layer2"}),i.push({fi:2,data:{...iC.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:i}},e.defaultTwoLayerTextureData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=iC.defaultData("texture");Object.assign(r.texture,{image:e});let a=new V_;return a.push({fi:0,data:r,id:i}),a.push({fi:1,data:iC.defaultData("light",t),id:n}),{layers:a}},e.defaultTwoLayerVideoTextureData=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"phong",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"layer1",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"layer2",r=iC.defaultData("video");Object.assign(r.texture,{video:e});let a=new V_;return a.push({fi:0,data:r,id:i}),a.push({fi:1,data:iC.defaultData("light",t),id:n}),{layers:a}}})(nC||(nC={})),(e=>{e.defaultData=function(){return{points:new V_,roundness:0,shapeHoles:[],isClosed:!1}}})(rC||(rC={})),(e=>{e.defaultData=function(){return{points:new V_,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}})(aC||(aC={}));var lC,cC={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0};(e=>{e.merge=function(e,t){let i={...e};return fC.forEach((n=>{var r;Object.assign(i,{[n]:null!==(r=t[n])&&void 0!==r?r:e[n]})})),i}})(lC||(lC={}));var hC,dC,uC,pC={shape:cC,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},fC=["depth","offset","angle","twist","startScale","endScale"];(e=>{e.is2DParametricMesh=function(e){return"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"UIGeometry"===e},e.isParametricMesh=function(e){return"PolygonGeometry"===e||"PolygonGeometry"===e||"RectangleGeometry"===e||"StarGeometry"===e||"TriangleGeometry"===e||"EllipseGeometry"===e||"PathGeometry"===e||"VectorGeometry"===e||"ConeGeometry"===e||"CubeGeometry"===e||"CylinderGeometry"===e||"DodecahedronGeometry"===e||"HelixGeometry"===e||"IcosahedronGeometry"===e||"LatheGeometry"===e||"PyramidGeometry"===e||"SphereGeometry"===e||"PlaneGeometry"===e||"BackdropGeometry"===e||"TorusGeometry"===e||"TorusKnotGeometry"===e||"BooleanGeometry"===e||"TextGeometry"===e}})(hC||(hC={})),(e=>{e.merge=function(e,t){let i={...e};return Object.assign(i,t),"PathGeometry"===i.type&&"extrusion"in t&&t.extrusion&&(i.extrusion={...e.extrusion},Object.assign(i.extrusion,lC.merge(i.extrusion,t.extrusion))),i}})(dC||(dC={})),(e=>{e.defaultData=function(e){if("RectangleGeometry"===e)return{width:320,height:320,type:e,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("UIGeometry"===e)return{type:e,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if("PathGeometry"===e)return{type:e,width:1,height:1,depth:1,path:aC.defaultData(),extrusion:pC};if("VectorGeometry"===e)return{width:1,height:1,type:e,subdivisions:12,shape:rC.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if("BooleanGeometry"===e)return{type:e,operation:2,width:0,height:0,depth:0,phongAngle:35};if("TextGeometry"===e)return{type:e,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",extrudeBevelSize:0,extrudeBevelSegments:1};if("SphereGeometry"===e)return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}})(uC||(uC={}));var mC,gC,vC,yC,bC,xC,wC,_C,SC,AC,EC,CC,MC,PC,TC,DC,RC,OC,IC,kC,LC,FC,BC,NC,zC,UC,jC,VC,GC,HC,WC,qC,XC,YC,QC,KC,ZC,JC,$C,eM,tM=["width","height","depth"];function iM(e){e.layers.forEach((e=>{if("depth"===e.type&&void 0!==e.colorA){let t=e.colorA,i=e.colorB,n=[[t.r,t.g,t.b,t.a],[i.r,i.g,i.b,i.a]],r=[0,1];for(let e=2;e<10;e++)n.push(n[1]),r.push(1);let a={...t_(wS(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:n,steps:r,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,a)}else if("depth"===e.type&&1===e.gradientType&&(e.near<0||e.far<0)){let t={...wS(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,t)}}))}function nM(e,t){Object.values(e.shared.materials).forEach((e=>t(e)))}function rM(e,t){e.scene.objects.traverse(((e,i)=>{"materials"in i?i.materials.forEach(((e,n)=>{void 0===e&&(i.materials[n]=nC.defaultData(),e=i.materials[n]),"string"!=typeof e&&t(e)})):"material"in i?"string"!=typeof i.material&&(void 0===i.material&&(i.material=nC.defaultData()),t(i.material)):"Mesh"===i.type&&(void 0===i.material&&(i.material=nC.defaultData()),t(i.material)),"overrides"in i&&Object.values(i.overrides).forEach((e=>{e.material&&"string"!=typeof e.material&&Object.getPrototypeOf(e.material)!==Q_.prototype&&t(e.material)}))}))}function aM(e){void 0===e.layers&&Object.assign(e,nC.defaultTwoLayerData("lambert"))}function sM(e){!e.layers||e.layers.forEach((e=>{if("depth"===e.type&&10===e.colors.length){let t=[...e.colors];t.push(e.colors[9]);let i=[...e.steps];i.push(e.steps[9]);let n={...wS(e),colors:t,steps:i};Object.assign(e,n)}}))}function oM(e){e.scene.objects.traverse(((e,t)=>{"materials"in t?t.materials.forEach((e=>{"string"!=typeof e&&sM(e)})):"material"in t&&"string"!=typeof t.material&&sM(t.material)})),Object.values(e.shared.materials).forEach((e=>sM(e)))}function lM(e){e.layers&&e.layers.forEach((e=>{"depth"===e.type&&void 0!==e.num&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)}))}function cM(e){e.layers&&e.layers.forEach((e=>{(function(e){return"displace"!==e.type})(e)&&void 0===e.isMask&&(e.isMask=!1),("texture"===e.type||"video"===e.type)&&void 0===e.blending&&(e.blending=0),("noise"===e.type||"displace"===e.type&&"noise"===e.displacementType)&&(void 0===e.voronoiStyle&&(e.voronoiStyle=0),void 0===e.highCut&&(e.highCut=1),void 0===e.lowCut&&(e.lowCut=0),void 0===e.smoothness&&(e.smoothness=.3),void 0===e.seed&&(e.seed=0),void 0===e.quality&&(e.quality=1))}))}function hM(e){var t;let i=null===(t=e.layers.find((e=>"light"===e.type)))||void 0===t?void 0:t.data;if("basic"===(null===i||void 0===i?void 0:i.category)){let e=iC.defaultData("light","phong"),t=i;Object.assign(t,e),t.visible=!1}}function dM(e){nM(e,hM),rM(e,hM)}function uM(e){e.layers.forEach((e=>{"light"===e.type&&"toon"!==e.category&&void 0===e.occlusion&&(e.occlusion=!0)}))}function pM(e){e.layers&&e.layers.forEach((e=>{"light"===e.type&&void 0===e.bumpMapIntensity&&(e.bumpMapIntensity=5)}))}function fM(e,t){if(t<1&&(rM(e,iM),nM(e,iM),e.schema=1),t<2&&(function(e){Object.assign(e.scene.publish,{orbitControls:{...zC.defaultData,...wS(e.scene.publish.orbitControls)}})}(e),e.schema=2),t<3&&(function(e){function t(e){if(e.layers)for(let t of Object.values(e.layers))if(t)for(let[e,i]of Object.entries(t))if((sC.includes(e)||"boolean"==typeof i)&&delete t[e],"texture"===e)for(let[t,n]of Object.entries(i))(oC.includes(t)||"boolean"==typeof n)&&delete i[t]}e.scene.objects.traverse(((e,i)=>{i.states.forEach((e=>{let i=e;i.material?t(i.material):i.materials&&i.materials.forEach((e=>{t(e)}))}))}))}(e),e.schema=3),t<4&&(function(e){e.scene.publish.withBackground=!0}(e),e.schema=4),t<5&&(function(e){e.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}(e),e.schema=5),t<6&&(function(e){e.scene.objects.traverse(((e,t)=>{let i=t.cloner;i&&(i.radial.scale=i.radial.scale.map((e=>e+1)),i.linear.scale=i.linear.scale.map((e=>e+1)))}))}(e),e.schema=6),t<7&&(function(e){e.scene.objects.traverse(((e,t)=>{let i=t.geometry;i&&("DodecahedronGeometry"===i.type||"IcosahedronGeometry"===i.type)&&(i.detail=Math.round(i.detail))}))}(e),e.schema=7),t<8&&(e.schema=8),t<9&&(oM(e),e.schema=9),t<10&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&("BooleanGeometry"===t.geometry.type||"SubdivGeometry"===t.geometry.type)&&(t.geometry.phongAngle=35)}))}(e),e.schema=10),t<11&&(function(e){e.scene.environment.ambientLight.softShadows=!1,e.scene.environment.ambientLight.softShadowQuality="low",e.scene.objects.traverse(((e,t)=>{("DirectionalLight"===t.type||"SpotLight"===t.type)&&(t.shadowResolution=1024,t.shadowRadius=1,t.depth=1e5)})),e.shared.penumbraSize=new Array(5).fill(.5)}(e),e.schema=11),t<12&&(oM(e),e.schema=12),t<13&&(function(e){e.shared.audios=r_({},O_.prototype)}(e),e.schema=13),t<14&&(function(e){let t=e.shared.materials;Object.entries(t).forEach((e=>{let[i,n]=e;if(!n.layers){let e={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(t,{[i]:e})}}))}(e),e.schema=14),t<15&&(function(e){Object.entries(wS(e.shared.images)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.images[t]})),Object.entries(wS(e.shared.audios)).filter((e=>!1===e[1].asset)).map((e=>e[0])).forEach((t=>{delete e.shared.audios[t]}))}(e),e.schema=15),t<16&&(function(e){e.scene.publish.settings.web.preload=!1}(e),e.schema=16),t<17&&(rM(e,lM),nM(e,lM),e.schema=17),t<18&&(rM(e,aM),nM(e,aM),e.schema=18),t<19&&(function(e){Object.assign(e.scene.publish.settings,{video:{...UC.defaultData.settings.video,...wS(e.scene.publish.settings.video)}})}(e),e.schema=19),t<20&&(function(e){e.shared.fonts=r_({},O_.prototype)}(e),function(e){let t=[];e.scene.objects.traverse(((i,n)=>{let r=n;if("TextFrame"===r.type){let n=nC.defaultTwoLayerData("phong"),a="string"==typeof r.color?e.shared.colors[r.color]:r.color;n.layers[1].data.color={r:a.r,g:a.g,b:a.b},n.layers[1].data.alpha=r.alpha;let s=function(e){return e.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map((e=>e.charAt(0).toUpperCase()+e.slice(1))).join(" ")}(r.font);void 0===e.shared.fonts[s]&&(e.shared.fonts[s]={name:s});let o={name:r.name,...CC.defaultData,...RC.defaultData,flatShading:!1,wireframe:!1,geometry:{...uC.defaultData("TextGeometry"),width:r.width,height:r.height,font:s,depth:0,horizontalAlign:r.horizontalAlign,verticalAlign:r.verticalAlign,fontSize:1.40625*r.fontSize,lineHeight:r.lineHeight/1.40625,letterSpacing:r.letterSpacing-1,text:r.text,textTransform:r.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:n,states:wS(r.states),events:wS(r.events),visible:r.visible,raycastLock:r.raycastLock,position:r.position,rotation:r.rotation,scale:r.scale,hiddenMatrix:r.hiddenMatrix},l=wS(e.scene.objects).parent(i);e.scene.objects.insertAfter(null!==l&&void 0!==l?l:null,i,[{id:i+"new",data:o,children:[]}]),t.push(i)}})),t.forEach((t=>{e.scene.objects.delete(t)}))}(e),e.schema=20),t<21&&(function(e){let t={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};e.scene.objects.traverse(((e,i)=>{i.events.forEach((e=>{if(t[Number(e.type)])if(Object.assign(e,{type:t[Number(e.type)]}),"Audio"===e.type&&"audioEvent"in e&&(Object.assign(e,{playAudio:e.audioEvent}),delete e.audioEvent),"GameControl"===e.type)Object.assign(e,{gameActions:{idle:new V_,move:new V_,jump:new V_}});else{let t=new V_;Object.assign(e,{actions:t}),("MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type)&&"url"in e&&t.push({fi:0,id:Uo.generateUUID(),data:{type:"Link",url:e.url,delay:0}}),"targets"in e&&(e.targets.forEach(((e,i,n)=>{let r={easing:e.easing,duration:e.duration};6===e.easing?Object.assign(r,t_(e,"mass","stiffness","damping","velocity")):5===e.easing&&Object.assign(r,{control1:{...e.control1},control2:{...e.control2}});let a={repeat:e.repeat?-1:0,delay:e.delay,delayDirection:e.delayDirection,direction:e.cycle&&e.rewind?"pingpong-rewind":e.cycle?"pingpong":"normal"},s={state:e.state,...a,...r},o={allowSlerp:!0,type:"Transition",object:e.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new V_({fi:0,id:Uo.generateUUID(),data:{state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4}},{fi:1,id:Uo.generateUUID(),data:s})};t.push({fi:n,id:i,data:o})})),delete e.targets)}}))}))}(e),function(e){e.scene.objects.traverse(((e,t)=>{function i(e,i){let n=new V_,r=[];if(t.events.forEach(((e,t,a)=>{if("Audio"===e.type&&e.trigger===i){let i;r.push(t),"play"===e.interaction?i={...t_(e,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in e?e.after:void 0,toggle:"after"in e?e.toggle:void 0,type:"Audio"}:("pause"===e.interaction||"stop"===e.interaction)&&(i={...t_(e,"interaction","delay","object","playAudio"),type:"Audio"}),i&&n.push({fi:a,id:t,data:i})}})),r.forEach((e=>t.events.delete(e))),n.length){var a;let i=null===(a=t.events.find((t=>t.type===e)))||void 0===a?void 0:a.data;i?"actions"in i&&i.actions.insertBefore(null,n):t.events.insertBefore(null,[{id:Uo.generateUUID(),data:{type:e,actions:n}}])}}i("Start","start"),i("MouseDown","mouseDown"),i("MouseUp","mouseUp"),i("KeyDown","keyDown"),i("KeyUp","keyUp")}))}(e),e.schema=21),t<22&&(dM(e),e.schema=22),t<23&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"SubdivGeometry"===t.geometry.type&&(t.geometry.scaleBaked||(t.geometry.scaleBaked=[1,1,1]))}))}(e),e.schema=23),t<24&&(function(e){e.scene.objects.traverse(((e,t)=>{("Empty"===t.type||"Mesh"===t.type)&&t.cloner&&!t.cloner.randomnessObject&&!t.cloner.toObject&&!t.cloner.randomness&&(t.cloner={...t.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})}))}(e),e.schema=24),(t<25||void 0===e.shared.videos)&&(function(e){e.shared.videos=r_({},O_.prototype)}(e),t<25&&(e.schema=25)),t<26&&(function(e){e.scene.objects.traverse(((t,i)=>{let n=e.scene.objects.unproxy().parent(t);if(n){let t=wS(e.scene.objects.data(n));t&&"Mesh"===t.type&&"BooleanGeometry"===t.geometry.type&&"Mesh"===i.type&&(i.visible=!0!==wS(i).booleanExclude)}}))}(e),e.schema=26),t<27&&(function(e){e.scene.objects.traverse(((e,t)=>{if("Mesh"===t.type){let e=t;"NonParametricGeometry"===t.geometry.type?void 0!==e.material&&delete e.material:void 0!==e.materials&&delete e.materials}}))}(e),e.schema=27),t<28&&(dM(e),e.schema=28),t<29&&(function(e){function t(e){Object.setPrototypeOf(e,Q_.prototype),e.texture&&Object.setPrototypeOf(e.texture,Q_.prototype)}function i(e){Object.setPrototypeOf(e,Q_.prototype);for(let i in e)t(e[i])}e.scene.objects.traverse(((e,t)=>{t.states.forEach((e=>{let t=e;if(t.material){let e=wS(t.material).layers;i(e),t.material.layers=e}if(t.materials)for(let n=0;n<t.materials.length;n++){let e=t.materials[n],r=wS(e).layers;i(r),e.layers=r}}))}))}(e),e.schema=29),t<30&&(function(e){e.scene.objects.traverse(((e,t)=>{"Mesh"===t.type&&"NonParametricGeometry"===t.geometry.type&&!("material"in t)&&!("materials"in t)&&(t.material=nC.defaultTwoLayerData("phong"))}))}(e),e.schema=30),t<31&&(function(e){void 0===e.scene.publish.orbitControls.autoZoom&&(e.scene.publish.orbitControls.autoZoom=!1),e.scene.objects.traverse(((e,t)=>{("OrthographicCamera"===t.type||"PerspectiveCamera"===t.type)&&(void 0===t.orthographic.autoZoom&&(t.orthographic.autoZoom=!1),void 0===t.orthographic.autoZoomFrustumSize&&(t.orthographic.autoZoomFrustumSize=790))}))}(e),e.schema=31),t<33&&(function(e){e.scene.objects.traverse(((e,t)=>{void 0===t.pathSnapping&&(t.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),void 0===t.pathSnapping.offset&&(t.pathSnapping.offset=0)}))}(e),e.schema=33),t<34&&(function(e){void 0===e.scene.publish.mouseEventTarget&&(e.scene.publish.mouseEventTarget="canvas"),void 0===e.scene.publish.settings.web.hint&&(e.scene.publish.settings.web.hint=!1)}(e),e.schema=34),t<35&&(function(e){let{video:t}=e.scene.publish.settings;"gif"===t.format&&t.fps>48&&(t.fps=15)}(e),e.schema=35),t<36&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.resetYPosition=Math.abs(e.resetYPosition-t.position[1]))}))}))}(e),e.schema=36),t<37&&(function(e){let t=e.scene.environment.usePhysics;e.scene.objects.traverse(((e,i)=>{t&&null===i.physics?i.collision=!1:i.collision="visibility"}))}(e),e.schema=37),t<38&&(rM(e,cM),nM(e,cM),e.schema=38),t<39&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.navmesh=eM.defaultDataThirdPerson.navmesh)}))}))}(e),e.schema=39),t<40&&(function(e){e.scene.styles||(e.scene.styles=GC.defaultData())}(e),e.schema=40),t<41&&(function(e){void 0===e.scene.environment.ambientLight.occlusion&&(e.scene.environment.ambientLight.occlusion=!1),void 0===e.scene.environment.ambientLight.aoFullRes&&(e.scene.environment.ambientLight.aoFullRes=!1),void 0===e.scene.environment.ambientLight.radius&&(e.scene.environment.ambientLight.radius=256),void 0===e.scene.environment.ambientLight.bias&&(e.scene.environment.ambientLight.bias=.5),void 0===e.scene.environment.ambientLight.aoColor&&(e.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),rM(e,uM),nM(e,uM)}(e),e.schema=41),t<42&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&Object.assign(e.gameActions,{run:new V_})}))}))}(e),e.schema=42),t<43&&(function(e){e.scene.objects.traverse(((e,t)=>{t.events.forEach((e=>{"GameControl"===e.type&&(e.keyAssignments=[...e.keyAssignments,["run","\u21e7"],["none","Ctrl"]])}))}))}(e),e.schema=43),t<99){var i;rM(e,pM),nM(e,pM),null===e.scene.publish.playCamera&&(e.scene.publish.playCamera=LE);let t=wS(e.scene.objects),n=e.scene.objects;e.scene.publish.playPage=FE,n.insertBefore(null,null,[{id:FE,data:{...FC.defaultData,backgroundColor:e.scene.backgroundColor,fog:e.scene.fog,postprocessing:e.scene.postprocessing,ao:t_(e.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:e.scene.publish.playCamera,gameControlObject:e.scene.publish.gameControlObject},shadow:t_(e.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...xC.defaultData,...t_(e.scene.environment,"usePhysics","gravity")},camera:null!==(i=wS(e.scene.ownerCamera))&&void 0!==i?i:FC.defaultData.camera,name:"Scene"},children:[]}]);for(let e of t)e.id!==WC.TRASH_CAN_ID&&n.move(FE,e.fi,e.id);let r=0,a=0;e.shared.penumbraSize&&e.scene.objects.traverse(((t,i)=>{var n;"DirectionalLight"===i.type?(i.penumbraSize=e.shared.penumbraSize[Math.min(r,2)],r+=1):"SpotLight"===i.type&&(i.penumbraSize=e.shared.penumbraSize[3+Math.min(a,1)],a+=1),(void 0===i.physics||null===i.physics)&&"Instance"!==i.type&&(i.physics={},Object.assign(i.physics,VE.defaultData)),void 0!==i.physics&&null!==i.physics&&(i.physics.enabled=null!==(n=i.collision)&&void 0!==n?n:"visibility",delete i.collision)})),e.schema=99}}function mM(e){e.layers&&e.layers.forEach((e=>{"light"===e.type&&void 0===e.alphaOverride&&(e.alphaOverride=1)}))}(e=>{e.defaultData={enabled:!1,useBackgroundColor:!1,color:_E.white,near:.1,far:2e3}})(mC||(mC={})),(e=>{let t={opacity:1,blendFunction:13,enabled:!1};e.defaultData={enabled:!1,pixelation:{...t,blendFunction:16,granularity:15},bloom:{...t,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...t,offset:[2,2]},vignette:{...t,darkness:1,offset:0},hueSaturation:{...t,hue:3,saturation:0},brightnessContrast:{...t,brightness:.25,contrast:0},depthOfField:{...t,focusDistance:100,focalLength:20,bokehScale:5},noise:{...t,blendFunction:16}}})(gC||(gC={})),(e=>{e.defaultData={softShadowQuality:"low"}})(vC||(vC={})),(e=>{e.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75}})(yC||(yC={})),(e=>{e.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}}})(bC||(bC={})),(e=>{e.defaultData={usePhysics:!1,gravity:-10}})(xC||(xC={})),(e=>{e.defaultData={playCamera:LE,gameControlObject:null}})(wC||(wC={})),(e=>{e.defaultData={backgroundColor:AE.fromHexAndA(2960946,1),postprocessing:gC.defaultData,fog:mC.defaultData,globalPhysics:xC.defaultData,ambient:yC.defaultData,ao:bC.defaultData,shadow:vC.defaultData,publish:wC.defaultData}})(_C||(_C={})),(e=>{e.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95}})(SC||(SC={})),(e=>{e.isComponentRelated=function(e){return"Component"===e||"Instance"===e},e.isEmptyOrComponent=function(e){return"Empty"===e||"Instance"===e}})(AC||(AC={})),(e=>{e.identity={...CE.identity,hiddenMatrix:xE.identity},e.fromObject=function(e){return{position:e.position,rotation:e.rotation,scale:e.scale,hiddenMatrix:e.hiddenMatrix}},e.merge=function(e,t){return{position:(null===t||void 0===t?void 0:t.position)||e.position,rotation:(null===t||void 0===t?void 0:t.rotation)||e.rotation,scale:(null===t||void 0===t?void 0:t.scale)||e.scale,hiddenMatrix:(null===t||void 0===t?void 0:t.hiddenMatrix)||e.hiddenMatrix}},e.diff=function(e,t){return n_({position:gE.isEqual(e.position,t.position)?void 0:t.position,rotation:gE.isEqual(e.rotation,t.rotation)?void 0:t.rotation,scale:gE.isEqual(e.scale,t.scale)?null:t.scale,hiddenMatrix:xE.isEqual(e.hiddenMatrix,t.hiddenMatrix)?void 0:t.hiddenMatrix})}})(EC||(EC={})),(e=>{e.defaultData={states:new V_,events:new V_,visible:!0,raycastLock:!1,physics:VE.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...EC.identity,cloner:null}})(CC||(CC={})),(e=>{e.defaultData={type:"Empty",...CC.defaultData}})(MC||(MC={})),(e=>{e.defaultData={type:"ParticleCollider",...SC.defaultData,...CC.defaultData}})(PC||(PC={})),(e=>{e.defaultData={type:"Component",...CC.defaultData}})(TC||(TC={})),(e=>{e.defaultData={type:"Particle",...CC.defaultData,...jE.defaultData}})(DC||(DC={})),(e=>{e.defaultData={type:"Mesh",...CC.defaultData,...WE.defaultData}})(RC||(RC={})),(e=>{e.defaultData={...CC.defaultData,...EC.identity,position:[0,0,OE.DefaultTargetOffset],...OE.defaultData}})(OC||(OC={})),(e=>{e.defaultData=function(e){return{...CC.defaultData,...UE.defaultData(e)}},e.defaultDirectionalLightData={...e.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(IC||(IC={})),(e=>{function t(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(;i<t.length;){let n=e?e[t[i]]:void 0;if(t.length===i+1)return n;if(!n)return;e=n.descendants,i+=1}}e.resolveWithDes=t,e.resolve=function(e,i){let n=t(e,i,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);if(n){let e=Object.keys(n);if(1===e.length&&"descendants"===e[0])return}return n}})(kC||(kC={})),(e=>{function t(e,t){return{...CC.defaultData,...t,component:e,overrides:new Q_,physics:void 0,events:void 0,type:"Instance"}}e.rootOverrideProps=["physics","events"],e.compositeNonOptionalOverrideProps=["geometry"],e.compositeEntireOverrideOverrideProps=["material"],e.ofComponent=t,e.fromComponentData=function(e){let i=EC.fromObject(e.data);return t(e.id,i)}})(LC||(LC={})),(e=>{e.defaultData={type:"Page",...CC.defaultData,physics:{...VE.defaultData,fusedBody:!1},..._C.defaultData,camera:OC.defaultData},e.isUIPage=function(e){return void 0!==e.uiScene}})(FC||(FC={})),(e=>{e.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:xE.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:VE.defaultData,states:new V_,events:new V_,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...OE.defaultData},e.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},e.defaultMeshObject={name:"Rectangle",...CC.defaultData,...RC.defaultData,geometry:uC.defaultData("RectangleGeometry"),material:nC.defaultTwoLayerData("phong","layer1","layer2")},e.defaultBooleanObject={name:"Boolean",...CC.defaultData,...RC.defaultData,geometry:uC.defaultData("BooleanGeometry"),material:nC.defaultTwoLayerData("phong","layer1","layer2")},e.defaultTextObject={name:"Text",...CC.defaultData,...RC.defaultData,geometry:uC.defaultData("TextGeometry"),material:nC.defaultTwoLayerData("phong","layer1","layer2")}})(BC||(BC={})),(e=>{e.newEmpty=function(e,t){let i={name:t};return"Mesh"===e.type?(i.geometry={},"material"in e&&(i.material={layers:new Q_}),"materials"in e&&(i.materials=e.materials.map((e=>({layers:new Q_}))))):RE.is(e.type)&&(i.perspective={},i.orthographic={}),i},e.toOps=function(e,t){let i,n=[],r={orthographic:0,perspective:0,geometry:0};function a(e,t){for(let[i,r]of Object.entries(t.layers)){let{texture:t,...a}=r;if(void 0!==t&&Object.keys(t).length>0){let r={path:[...e,"layers",i,"texture"],props:t,type:0};n.push(r)}if(Object.keys(a).length>0){let t={path:[...e,"layers",i],props:a,type:0};n.push(t)}}}for(let[s,o]of Object.entries(t))if("name"!==s)if("cloner"===s)n.push(...kE.toOps(o,["cloner"]));else if("pathSnapping"===s)n.push({path:[s],props:{slide:o.slide,offset:o.offset},type:0});else if("material"===s)a(["material"],o);else if("materials"===s)for(let[e,t]of Object.entries(o))a(["materials",e],t);else if(0===r[s]){if("geometry"===s&&void 0!==o.extrusion){let e={path:[s,"extrusion"],props:o.extrusion,type:0};n.push(e),o={...o},delete o.extrusion}if(Object.keys(o).length>0){let e={path:[s],props:o,type:0};n.push(e)}}else void 0===i&&(i={path:[],props:{},type:0},n.push(i)),i.props[s]=o;return n},e.patch=function(e,t){var i,n,r,a,s,o,l,c;if(void 0===t)return e;let h={...e};if(Object.assign(h,EC.merge(h,t)),Object.assign(h,{pathSnapping:Object.assign({},h.pathSnapping,{slide:null!==(i=null!==(n=null===(r=t.pathSnapping)||void 0===r?void 0:r.slide)&&void 0!==n?n:null===(a=h.pathSnapping)||void 0===a?void 0:a.slide)&&void 0!==i?i:0,offset:null!==(s=null!==(o=null===(l=t.pathSnapping)||void 0===l?void 0:l.offset)&&void 0!==o?o:null===(c=h.pathSnapping)||void 0===c?void 0:c.offset)&&void 0!==s?s:0})}),RE.is(e.type)){var d,u;h.orthographic={...h.orthographic},h.perspective={...h.perspective};let e=t;void 0!==(null===(d=e.orthographic)||void 0===d?void 0:d.zoom)&&(h.orthographic.zoom=e.orthographic.zoom),void 0!==(null===(u=e.perspective)||void 0===u?void 0:u.zoom)&&(h.perspective.zoom=e.perspective.zoom),void 0!==e.isUpVectorFlipped&&(h.isUpVectorFlipped=e.isUpVectorFlipped),void 0!==e.targetOffset&&(h.targetOffset=e.targetOffset)}else if("Mesh"===e.type)"geometry"in t&&Object.assign(h,{geometry:dC.merge(h.geometry,t.geometry)}),(t.material||t.materials)&&(h=function(e,t){if(void 0===t)return e;let i={...e};return"material"in i&&"material"in t&&t.material&&(i.material=xS(i.material,(e=>{if("string"!=typeof e)for(let[i,n]of Object.entries(t.material.layers)){let t=e.layers.data(i);t&&iC.patch(t,n)}})).data),i.materials&&t.materials&&(i.materials=xS(i.materials,(e=>{for(let r=0;r<i.materials.length;r++){let i=t.materials[r];if("string"!=typeof i)for(let[t,a]of Object.entries(i.layers)){var n;let i=null===(n=e[r])||void 0===n||null===(n=n.layers)||void 0===n?void 0:n.data(t);i&&iC.patch(i,a)}}})).data),i}(h,t)),h.cloner&&"cloner"in t&&Object.assign(h,{cloner:IE.merge(h.cloner,t.cloner)});else if("Empty"===e.type)h.cloner&&"cloner"in t&&Object.assign(h,{cloner:IE.merge(h.cloner,t.cloner)});else if(zE.is(e.type)){let e=t;void 0!==e.intensity&&(h.intensity=e.intensity),void 0!==e.color&&("string"==typeof e.color?h.color=e.color:h.color=_E.clone(e.color))}return h}})(NC||(NC={})),(e=>{e.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0}})(zC||(zC={})),(e=>{e.defaultData={orbitControls:zC.defaultData,playPage:FE,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map(((e,t)=>{let i=0,n=0;return t<5?n=-30:t<10&&(n=30),0===t||10===t||5===t?i=30:(4===t||11===t||9===t)&&(i=-30),[120,[i,n],"show"]})),settings:{image:{format:"jpg",ratio:1},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1}},stopRaycast:!0,hdTransmission:!1}})(UC||(UC={})),(e=>{e.defaultData={id:"basic",label:"Basic",style:"None",prompt:""}})(jC||(jC={})),(e=>{e.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0}})(VC||(VC={})),(e=>{e.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...jC.defaultData},isRandomSeed:!0,seed:e.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:VC.defaultData}),e.generateSeed=()=>Math.round(1e5*Math.random())})(GC||(GC={})),(e=>{e.physicsEnabled=function(e){return void 0!==e.find((e=>"Page"===e.data.type&&e.data.globalPhysics.usePhysics))},e.traverseModuleInstances=function(e,t,i){e.scene.objects.traverseFrom(t,((t,n)=>{if("Instance"===n.type){var r;let a=null===(r=bM.getComponentData(e,n.component))||void 0===r?void 0:r.data;a&&i(t,n,a.events)}else i(t,n,n.events)}))}})(HC||(HC={})),(e=>{function t(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],r=BC.defaultMeshObject;t&&(n.push({...e.defaultLight}),n.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:r,children:[]})),n.push(...i);let a=new j_;return a.push({fi:1,id:FE,data:{...FC.defaultData,name:"Scene 1"},children:n}),a}function i(t){return{...e.defaultData,objects:r_(t,j_.prototype)}}e.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",e.defaultLight={fi:-1,data:IC.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]},e.createDefaultObjectTreeWithPage=t,e.defaultData={objects:t(),publish:UC.defaultData,styles:GC.defaultData()},e.emptyDataWithoutPage=function(){return{objects:new j_,publish:UC.defaultData,styles:GC.defaultData()}},e.emptyDataWithPage=function(){return{objects:t(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]),publish:UC.defaultData,styles:GC.defaultData()}},e.emptyData=function(){return{objects:new j_,publish:{...UC.defaultData},styles:GC.defaultData()}},e.withObjs=i,e.withObj=function(e,t){return i([{id:e,data:t,children:[],fi:0}])}})(WC||(WC={})),(e=>{e.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}}})(qC||(qC={})),(e=>{function t(e){return void 0!==e.textValue}function i(e){return"boolean"==typeof e}e.isTextValue=t,e.isNumber=function(e){return"number"==typeof e},e.isBoolean=i,e.typeOfVariable=function(e){return t(e)?"string":i(e)?"boolean":"number"},e.getDisplayedValue=function(t){var i;return e.isTextValue(t)?Array.isArray(t.textValue)?t.textValue.map((e=>{var i;return e.toString().padStart(null!==(i=t.padding)&&void 0!==i?i:2,"0")})).join(null!==(i=t.deliminator)&&void 0!==i?i:":")+(void 0!==t.suffix?" "+t.suffix:""):t.textValue.toString():e.isBoolean(t)?t?"True":"False":e.isNumber(t)?parseFloat(t.toFixed(3)).toString():t.toString()}})(XC||(XC={})),(e=>{e.all=["images","videos","colors","audios","particles","fonts","materials","variables"]})(YC||(YC={})),(e=>{e.all=[...YC.all,"components"]})(QC||(QC={})),(e=>{e.defaultData=function(){return{images:new O_,videos:new O_,colors:new O_,audios:new O_,particles:new O_,fonts:new O_,materials:new O_,components:new O_,variables:new O_}}})(KC||(KC={})),(e=>{e.defaultData=function(){return{images:new O_,videos:new O_,colors:new O_,audios:new O_,particles:new O_,fonts:new O_,materials:new O_,components:new O_,variables:new O_}}})(ZC||(ZC={})),(e=>{e.defaultColors=function(){let e={"89b10010-844c-11ec-a8a3-0242ac120002":{r:.5,g:.5,b:.5,a:1,name:"Default Color"}};return r_(e,O_.prototype)},e.defaultImages=function(){return r_({},O_.prototype)},e.emptyData=function(){return{catelogs:new O_,materials:new O_,images:new O_,videos:new O_,colors:new O_,audios:new O_,particles:new O_,fonts:new O_,variables:new V_,lib:ZC.defaultData()}},e.defaultVariables=function(e){switch(e){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let t=[0,0,0];return{name:"Time",value:{textValue:t,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:t,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",e)}},e.getFormattedTimerTime=function(e,t){if("HH:mm:ss"===t.format){let t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60);return{textValue:[t,i,Math.round(e-3600*t-60*i)]}}if("mm:ss"===t.format){let t=Math.floor(e/60);return{textValue:[t,Math.round(e-60*t)]}}return e="number"===t.format?Math.round(e):Math.round(1e3*e)/1e3}})(JC||(JC={})),(e=>{e.list=["idle","move","jump","run"]})($C||($C={})),(e=>{e.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},e.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","\u25b2"],["rotPosY","\u25c0"],["rotNegX","\u25bc"],["rotNegY","\u25b6"],["jump","Space"],["run","\u21e7"],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:e.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new V_,move:new V_,jump:new V_,run:new V_},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:AE.fromHexAndA(3728051,1)}}})(eM||(eM={}));var gM=180/Math.PI;function vM(e){e.rotation=e.rotation.slice(0,3).map((e=>e*gM))}function yM(e){var t,i,n;vM(e),"Page"===e.type&&vM(e.camera),null===(t=e.states)||void 0===t||t.forEach((e=>{void 0===e.rotation||null===e.rotation||(e.rotation=e.rotation.slice(0,3).map((e=>e*gM)))}));let r=e.geometry;r&&"SphereGeometry"===r.type&&(r.thetaLength=(null!==(i=r.thetaLength)&&void 0!==i?i:180)*gM),r&&"TorusGeometry"===r.type&&(r.arc=r.arc*gM),r&&"PathGeometry"===r.type&&(r.extrusion.angle*=gM,r.extrusion.twist*=gM),"Mesh"===e.type&&"TextGeometry"===e.geometry.type&&(e.geometry.text={textValue:e.geometry.text}),Array.isArray(wS(e.events))&&(null===(n=e.events)||void 0===n||n.forEach((e=>{("MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"KeyPress"===e.type||"Collision"===e.type||"Trigger"===e.type)&&(e.runMode=e.toggle?"Toggle":"Repeat")})))}var bM,xM,wM,_M,SM,AM,EM,CM,MM,PM,TM,DM,RM,OM,IM,kM,LM,FM,BM,NM,zM=113;function UM(e,t){t(e.data);for(let i of e.children)UM(i,t)}function jM(e){var t;let i=null!==(t=e.schema)&&void 0!==t?t:104;i!==zM&&i<105&&(UM(e.asset,yM),e.schema=105)}function VM(e){var t;let i=null!==(t=e.schema)&&void 0!==t?t:0;if(i!==zM){console.warn("updating from ",i,"to ",zM),fM(e,i),i<100&&(void 0===e.scene.publish.joystickSizeAndXYOffset&&(e.scene.publish.joystickSizeAndXYOffset=UC.defaultData.joystickSizeAndXYOffset),e.schema=100),i<101&&(rM(e,mM),nM(e,mM),e.schema=101),i<102&&(function(e){e.scene.objects.traverse(((e,t)=>{let i=t.geometry;i&&"PathGeometry"===i.type&&(i.extrusion.capType="flat",i.extrusion.bevel=50,i.extrusion.bevelSides=6,"Custom"===i.extrusion.shape.type&&(i.extrusion.shape.shapeQuality="low"))}))}(e),e.schema=102),i<104&&(e.shared.catelogs=new O_,e.shared.lib=ZC.defaultData(),e.schema=104),i<105&&(function(e){e.shared.variables=r_({},O_.prototype)}(e),e.scene.objects.traverse(((e,t)=>{yM(t)})),e.schema=105);for(let t of Object.values(e.shared.lib.components))jM(t);i<106&&(function(e){let t=wS(e.shared.variables);e.shared.variables=r_(Object.entries(null!==t&&void 0!==t?t:{}).map(((e,t)=>{let[i,n]=e;return{fi:t,id:i,data:n}})),V_.prototype)}(e),e.schema=106),i<107&&(e.shared.lib.variables=ZC.defaultData().variables,e.schema=107),i<109&&(function(e){e.shared.particles=r_({},O_.prototype),e.shared.lib&&(e.shared.lib.particles=ZC.defaultData().particles)}(e),e.schema=109),i<110&&(function(e){e.scene.objects.traverse(((e,t)=>{"Particle"===t.type&&"number"==typeof t.renderMaterial.size&&Object.assign(t.renderMaterial,{size:[t.renderMaterial.size,t.renderMaterial.size]})}))}(e),e.schema=110),i<111&&(e.scene.objects.traverse(((e,t)=>{!function(e){var t;Array.isArray(wS(e.events))&&(null===(t=e.events)||void 0===t||t.forEach((e=>{"disabled"in e||(e.disabled=!1),("MouseDown"===e.type||"MouseUp"===e.type||"MousePress"===e.type)&&(e.mode=e.mode||"Object")})))}(t)})),e.schema=111),i<112&&(function(e){e.scene.objects.traverse(((e,t)=>{"Page"===t.type&&(t.postprocessing.depthOfField.focusDistance=100,t.postprocessing.depthOfField.focalLength=20,t.postprocessing.depthOfField.bokehScale=5)}))}(e),e.schema=112),i<113&&(function(e){e.scene.objects.traverse(((e,t)=>{var i;!1!==Array.isArray(wS(t.events))&&(null===(i=t.events)||void 0===i||i.forEach((e=>{var t,i,n,r,a,s,o,l,c;let h=e.runMode;"MouseDown"===e.type||"MouseUp"===e.type||"KeyDown"===e.type||"KeyUp"===e.type||"Collision"===e.type||"Trigger"===e.type?null===(t=e.actions)||void 0===t||t.forEach((e=>{"Transition"===e.type&&(e.runMode=null!==h&&void 0!==h?h:"Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle"===h?"Toggle":"Normal")})):"MouseHover"===e.type||"MousePress"===e.type||"KeyPress"===e.type?null===(i=e.actions)||void 0===i||i.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")})):"GameControl"===e.type?(delete e.actions,Object.keys(e.gameActions).forEach((t=>{var i;null===(i=e.gameActions[t])||void 0===i||i.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),"Animation"===e.type&&(e.runMode="Normal")}))}))):"DragDrop"===e.type?(delete e.actions,null!==(n=e.dragDropActions)&&void 0!==n&&null!==(n=n.drag)&&void 0!==n&&n.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")})),null===(r=e.dragDropActions)||void 0===r||null===(r=r.drop)||void 0===r||r.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")}))):"Resize"===e.type?(delete e.actions,null===(a=e.breakpoints)||void 0===a||a.forEach((e=>{var t;null===(t=e.actions)||void 0===t||t.forEach((e=>{("Transition"===e.type||"Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Toggle")}))}))):"Start"===e.type?null===(s=e.actions)||void 0===s||s.forEach((e=>{"Transition"===e.type&&(e.runMode="Once"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})):"VariableChange"===e.type||"Scroll"===e.type?null===(o=e.actions)||void 0===o||o.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})):"Conditional"===e.type&&(delete e.actions,null!==(l=e.inActions)&&void 0!==l&&l.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})),null===(c=e.outActions)||void 0===c||c.forEach((e=>{"Transition"===e.type&&(e.runMode="Repeat"),("Animation"===e.type||"SwitchCamera"===e.type)&&(e.runMode="Normal")})))})))}))}(e),e.schema=113)}}function GM(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=null!==e[0].index,n=new Set(Object.keys(e[0].attributes)),r=new Set(Object.keys(e[0].morphAttributes)),a={},s={},o=e[0].morphTargetsRelative,l=new Wc,c=0;for(let h=0;h<e.length;++h){let d=e[h],u=0;if(i!==(null!==d.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let e in d.attributes){if(!n.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(d.attributes[e]),u++}if(u!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". Make sure all geometries have the same number of attributes."),null;if(o!==d.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let e in d.morphAttributes){if(!r.has(e))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[e]&&(s[e]=[]),s[e].push(d.morphAttributes[e])}if(t){let e;if(i)e=d.index.count;else{if(void 0===d.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+h+". The geometry must have either an index or a position attribute"),null;e=d.attributes.position.count}l.addGroup(c,e,h),c+=e}}if(i){let t=0,i=[];for(let n=0;n<e.length;++n){let r=e[n].index;for(let e=0;e<r.count;++e)i.push(r.getX(e)+t);t+=e[n].attributes.position.count}l.setIndex(i)}for(let h in a){let e=HM(a[h]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" attribute."),null;l.setAttribute(h,e)}for(let h in s){let e=s[h][0].length;if(0===e)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[h]=[];for(let t=0;t<e;++t){let e=[];for(let n=0;n<s[h].length;++n)e.push(s[h][n][t]);let i=HM(e);if(!i)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+h+" morphAttribute."),null;l.morphAttributes[h].push(i)}}return l}function HM(e){let t,i,n,r=0;for(let o=0;o<e.length;++o){let a=e[o];if(a.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=a.array.constructor),t!==a.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===i&&(i=a.itemSize),i!==a.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=a.normalized),n!==a.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=a.array.length}let a=new t(r),s=0;for(let o=0;o<e.length;++o)a.set(e[o].array,s),s+=e[o].array.length;return new kc(a,i,n)}(xM=bM||(bM={})).defaultData={schema:zM,scene:WC.defaultData,frames:(new O_).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",qC.defaultData),shared:{...JC.emptyData(),colors:JC.defaultColors()}},xM.emptyDataForImports=function(){let e=WC.emptyDataWithPage();return{schema:zM,scene:e,frames:(new O_).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",qC.defaultData),shared:{...JC.emptyData(),colors:JC.defaultColors(),images:JC.defaultImages()}}},xM.emptyData=function(){return{schema:zM,scene:WC.emptyDataWithPage(),frames:(new O_).add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",qC.defaultData),shared:JC.emptyData()}},xM.clipboard2dData=function(){return{schema:zM,scene:WC.emptyData(),frames:new O_,shared:JC.emptyData()}},xM.collabHelper={...Y_,updateSchema(e){var t,i;return(null!==(t=e.schema)&&void 0!==t?t:0)<zM?xS(e,VM):(null!==(i=e.schema)&&void 0!==i?i:0)-zM}},xM.updateSchemaDirectly=function(e){let t=xM.collabHelper.updateSchema(e);return"number"==typeof t?0===t?e:null:t.data},xM.withoutLib=function(e){return{...e,shared:{...e.shared,lib:ZC.defaultData()}}},xM.getComponentData=function(e,t){let i=e.scene.objects.get(t);if(i&&"Component"===i.data.type)return i;{let i=e.shared.lib.components[t];if(i)return i.asset}},(e=>{e.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"}})(wM||(wM={})),(e=>{e.is=function(e){return!0}})(_M||(_M={})),(e=>{e.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]},e.merge=function(e,t){var i,n,r,a;return{position:null!==(i=null===t||void 0===t?void 0:t.position)&&void 0!==i?i:e.position,rotation:null!==(n=null===t||void 0===t?void 0:t.rotation)&&void 0!==n?n:e.rotation,scale:null!==(r=null===t||void 0===t?void 0:t.scale)&&void 0!==r?r:e.scale,shear:null!==(a=null===t||void 0===t?void 0:t.shear)&&void 0!==a?a:e.shear}},e.diff=function(e,t){return n_({position:mE.isEqual(e.position,t.position)?void 0:t.position,rotation:e.rotation===t.rotation?void 0:t.rotation,scale:mE.isEqual(e.scale,t.scale)?void 0:t.scale,shear:e.shear&&t.shear&&mE.isEqual(e.shear,t.shear)?void 0:t.shear})}})(SM||(SM={})),(e=>{e.defaultData={horizontalConstraint:0,verticalConstraint:0}})(AM||(AM={})),(e=>{e.defaultData={opacity:1,fill:{color:AE.fromHexAndA(BE,1),enabled:!0},stroke:{color:AE.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:AE.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:AE.from0to1([0,0,0,1]),enabled:!1,spread:0}}})(EM||(EM={})),(e=>{e.newEmpty=function(e,t){return{name:t}},e.patch=function(e,t){if(void 0===t)return e;let i={...e};return Object.assign(i,SM.merge(i,t)),i=function(e,t){if(void 0===t)return e;let i={...e},n=["width","height","cornerRadius"];for(let r of n)r in i&&r in t&&void 0!==t[r]&&Object.assign(i,{[r]:t[r]});return i}(i,t),i=function(e,t){if(void 0===t)return e;let i={...e};return"fill"in i&&"fill"in t&&void 0!==t.fill&&Object.assign(i,{fill:{...i.fill,...t.fill}}),"stroke"in i&&"stroke"in t&&void 0!==t.stroke&&Object.assign(i,{stroke:{...i.stroke,...t.stroke}}),"layerBlur"in i&&"layerBlur"in t&&void 0!==t.layerBlur&&Object.assign(i,{layerBlur:{...i.layerBlur,...t.layerBlur}}),"backgroundBlur"in i&&"backgroundBlur"in t&&void 0!==t.backgroundBlur&&Object.assign(i,{backgroundBlur:{...i.backgroundBlur,...t.backgroundBlur}}),"dropShadow"in i&&"dropShadow"in t&&void 0!==t.dropShadow&&Object.assign(i,{dropShadow:{...i.dropShadow,...t.dropShadow}}),"innerShadow"in i&&"innerShadow"in t&&void 0!==t.innerShadow&&Object.assign(i,{innerShadow:{...i.innerShadow,...t.innerShadow}}),i}(i,t),i},e.toOps=function(e,t){let i,n=[];for(let[r,a]of Object.entries(t))"name"!==r&&(void 0===i&&(i={path:[],props:{},type:0},n.push(i)),i.props[r]=a);return n}})(CM||(CM={})),(e=>{e.defaultData={...SM.defaultData,...AM.defaultData,states:new V_,events:new V_,visible:!0,raycastLock:!1}})(MM||(MM={})),(e=>{e.defaultData={...MM.defaultData,...EM.defaultData}})(PM||(PM={})),(e=>{e.defaultData={cornerRadius:[0,0,0,0]}})(TM||(TM={})),(e=>{e.defaultData={...PM.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"}})(DM||(DM={})),(e=>{e.defaultData={...PM.defaultData,...TM.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"}})(RM||(RM={})),(e=>{e.defaultData={...PM.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"}})(OM||(OM={})),(e=>{e.defaultData={...PM.defaultData,type:"path2d",path:"",name:"Path"}})(IM||(IM={})),(e=>{e.is=function(e){return"ellipse2d"===e.type||"rectangle2d"===e.type||"text2d"===e.type||"vector2d"===e.type||"path2d"===e.type}})(kM||(kM={})),(e=>{e.defaultData={...MM.defaultData,name:"Group",type:"group2d"}})(LM||(LM={})),(e=>{e.defaultData=()=>({...MM.defaultData,...TM.defaultData,...EM.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:AE.fromHexAndA(4737101,1),enabled:!0},stroke:{color:AE.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}})})(FM||(FM={})),(e=>{e.defaultData=function(e){switch(e){case"rectangle2d":case"vector2d":return{...RM.defaultData};case"ellipse2d":return{...DM.defaultData};case"text2d":return{...OM.defaultData};case"path2d":return{...IM.defaultData};case"frame2d":return{...FM.defaultData()};case"group2d":return{...LM.defaultData}}},e.getPivot=function(e){return"width"in e&&"height"in e?["number"==typeof e.width?.5*e.width:0,"number"==typeof e.height?.5*e.height:0]:[0,0]},e.isResizeable=function(e){return"rectangle2d"===e.type||"ellipse2d"===e.type||"text2d"===e.type||"frame2d"===e.type},e.hasCorners=function(e){return"rectangle2d"===e.type||"frame2d"===e.type}})(BM||(BM={})),(e=>{e.defaultData={name:"UI",type:"scene2d",objects:new j_},e.emptyData=function(){return{type:"scene2d",objects:new j_}}})(NM||(NM={}));var WM=Math.pow(2,-24),qM=class{constructor(){}};function XM(e,t,i){return i.min.x=t[e],i.min.y=t[e+1],i.min.z=t[e+2],i.max.x=t[e+3],i.max.y=t[e+4],i.max.z=t[e+5],i}function YM(e){let t=-1,i=-1/0;for(let n=0;n<3;n++){let r=e[n+3]-e[n];r>i&&(i=r,t=n)}return t}function QM(e,t){t.set(e)}function KM(e,t,i){let n,r;for(let a=0;a<3;a++){let s=a+3;n=e[a],r=t[a],i[a]=n<r?n:r,n=e[s],r=t[s],i[s]=n>r?n:r}}function ZM(e,t,i){for(let n=0;n<3;n++){let r=t[e+2*n],a=t[e+2*n+1],s=r-a,o=r+a;s<i[n]&&(i[n]=s),o>i[n+3]&&(i[n+3]=o)}}function JM(e){let t=e[3]-e[0],i=e[4]-e[1],n=e[5]-e[2];return 2*(t*i+i*n+n*t)}function $M(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=1/0,s=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0,d=1/0,u=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,v=null!==r;for(let y=6*t,b=6*(t+i);y<b;y+=6){let t=e[y+0],i=e[y+1],n=t-i,r=t+i;n<a&&(a=n),r>l&&(l=r),v&&t<d&&(d=t),v&&t>f&&(f=t);let b=e[y+2],x=e[y+3],w=b-x,_=b+x;w<s&&(s=w),_>c&&(c=_),v&&b<u&&(u=b),v&&b>m&&(m=b);let S=e[y+4],A=e[y+5],E=S-A,C=S+A;E<o&&(o=E),C>h&&(h=C),v&&S<p&&(p=S),v&&S>g&&(g=S)}n[0]=a,n[1]=s,n[2]=o,n[3]=l,n[4]=c,n[5]=h,v&&(r[0]=d,r[1]=u,r[2]=p,r[3]=f,r[4]=m,r[5]=g)}var eP=32,tP=(e,t)=>e.candidate-t.candidate,iP=new Array(eP).fill().map((()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0}))),nP=new Float32Array(6);function rP(e,t){function i(e){u&&u(e/p)}function n(t,r,u){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!f&&m>=l&&(f=!0,c&&(console.warn("MeshBVH: Max depth of ".concat(l," reached when generating BVH. Consider increasing maxDepth.")),console.warn(e))),u<=h||m>=l)return i(r+u),t.offset=r,t.count=u,t;let g=function(e,t,i,n,r,a){let s=-1,o=0;if(0===a)s=YM(t),-1!==s&&(o=(t[s]+t[s+3])/2);else if(1===a)s=YM(e),-1!==s&&(o=function(e,t,i,n){let r=0;for(let a=t,s=t+i;a<s;a++)r+=e[6*a+2*n];return r/i}(i,n,r,s));else if(2===a){let a=JM(e),l=1.25*r,c=6*n,h=6*(n+r);for(let e=0;e<3;e++){let n=t[e],d=(t[e+3]-n)/eP;if(r<eP/4){let t=[...iP];t.length=r;let n=0;for(let r=c;r<h;r+=6,n++){let a=t[n];a.candidate=i[r+2*e],a.count=0;let{bounds:s,leftCacheBounds:o,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0;ZM(r,i,s)}t.sort(tP);let d=r;for(let e=0;e<d;e++){let i=t[e];for(;e+1<d&&t[e+1].candidate===i.candidate;)t.splice(e+1,1),d--}for(let r=c;r<h;r+=6){let n=i[r+2*e];for(let e=0;e<d;e++){let a=t[e];n>=a.candidate?ZM(r,i,a.rightCacheBounds):(ZM(r,i,a.leftCacheBounds),a.count++)}}for(let i=0;i<d;i++){let n=t[i],c=n.count,h=r-n.count,d=n.leftCacheBounds,u=n.rightCacheBounds,p=0;0!==c&&(p=JM(d)/a);let f=0;0!==h&&(f=JM(u)/a);let m=1+1.25*(p*c+f*h);m<l&&(s=e,l=m,o=n.candidate)}}else{for(let e=0;e<eP;e++){let t=iP[e];t.count=0,t.candidate=n+d+e*d;let i=t.bounds;for(let e=0;e<3;e++)i[e]=1/0,i[e+3]=-1/0}for(let r=c;r<h;r+=6){let t=~~((i[r+2*e]-n)/d);t>=eP&&(t=eP-1);let a=iP[t];a.count++,ZM(r,i,a.bounds)}let t=iP[eP-1];QM(t.bounds,t.rightCacheBounds);for(let e=eP-2;e>=0;e--){let t=iP[e],i=iP[e+1];KM(t.bounds,i.rightCacheBounds,t.rightCacheBounds)}let u=0;for(let i=0;i<eP-1;i++){let t=iP[i],n=t.count,c=t.bounds,h=iP[i+1].rightCacheBounds;0!==n&&(0===u?QM(c,nP):KM(c,nP,nP)),u+=n;let d=0,p=0;0!==u&&(d=JM(nP)/a);let f=r-u;0!==f&&(p=JM(h)/a);let m=1+1.25*(d*u+p*f);m<l&&(s=e,l=m,o=t.candidate)}}}}else console.warn("MeshBVH: Invalid build strategy value ".concat(a," used."));return{axis:s,pos:o}}(t.boundingData,p,s,r,u,d);if(-1===g.axis)return i(r+u),t.offset=r,t.count=u,t;let v=function(e,t,i,n,r){let a=i,s=i+n-1,o=r.pos,l=2*r.axis;for(;;){for(;a<=s&&t[6*a+l]<o;)a++;for(;a<=s&&t[6*s+l]>=o;)s--;if(!(a<s))return a;for(let i=0;i<3;i++){let n=e[3*a+i];e[3*a+i]=e[3*s+i],e[3*s+i]=n;let r=t[6*a+2*i+0];t[6*a+2*i+0]=t[6*s+2*i+0],t[6*s+2*i+0]=r;let o=t[6*a+2*i+1];t[6*a+2*i+1]=t[6*s+2*i+1],t[6*s+2*i+1]=o}a++,s--}}(o,s,r,u,g);if(v===r||v===r+u)i(r+u),t.offset=r,t.count=u;else{t.splitAxis=g.axis;let e=new qM,i=r,o=v-r;t.left=e,e.boundingData=new Float32Array(6),$M(s,i,o,e.boundingData,a),n(e,i,o,a,m+1);let l=new qM,c=v,h=u-o;t.right=l,l.boundingData=new Float32Array(6),$M(s,c,h,l.boundingData,a),n(l,c,h,a,m+1)}return t}!function(e,t){if(!e.index){let i,n=e.attributes.position.count,r=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;i=n>65535?new Uint32Array(new r(4*n)):new Uint16Array(new r(2*n)),e.setIndex(new kc(i,1));for(let e=0;e<n;e++)i[e]=e}}(e,t);let r=new Float32Array(6),a=new Float32Array(6),s=function(e,t){let i=e.attributes.position,n=e.index.array,r=n.length/3,a=new Float32Array(6*r),s=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let h=["getX","getY","getZ"];for(let d=0;d<r;d++){let e,r,u,p=3*d,f=6*d;s?(e=n[p+0],r=n[p+1],u=n[p+2]):(e=n[p+0]*c+l,r=n[p+1]*c+l,u=n[p+2]*c+l);for(let n=0;n<3;n++){let l,c,d;s?(l=i[h[n]](e),c=i[h[n]](r),d=i[h[n]](u)):(l=o[e+n],c=o[r+n],d=o[u+n]);let p=l;c<p&&(p=c),d<p&&(p=d);let m=l;c>m&&(m=c),d>m&&(m=d);let g=(m-p)/2,v=2*n;a[f+v+0]=p+g,a[f+v+1]=g+(Math.abs(p)+g)*WM,p<t[n]&&(t[n]=p),m>t[n+3]&&(t[n+3]=m)}}return a}(e,r),o=e.index.array,l=t.maxDepth,c=t.verbose,h=t.maxLeafTris,d=t.strategy,u=t.onProgress,p=e.index.count/3,f=!1,m=[],g=function(e){if(!e.groups||!e.groups.length)return[{offset:0,count:e.index.count/3}];let t=[],i=new Set;for(let r of e.groups)i.add(r.start),i.add(r.start+r.count);let n=Array.from(i.values()).sort(((e,t)=>e-t));for(let r=0;r<n.length-1;r++){let e=n[r],i=n[r+1];t.push({offset:e/3,count:(i-e)/3})}return t}(e);if(1===g.length){let e=g[0],t=new qM;t.boundingData=r,function(e,t,i,n){let r=1/0,a=1/0,s=1/0,o=-1/0,l=-1/0,c=-1/0;for(let h=6*t,d=6*(t+i);h<d;h+=6){let t=e[h+0];t<r&&(r=t),t>o&&(o=t);let i=e[h+2];i<a&&(a=i),i>l&&(l=i);let n=e[h+4];n<s&&(s=n),n>c&&(c=n)}n[0]=r,n[1]=a,n[2]=s,n[3]=o,n[4]=l,n[5]=c}(s,e.offset,e.count,a),n(t,e.offset,e.count,a),m.push(t)}else for(let v of g){let e=new qM;e.boundingData=new Float32Array(6),$M(s,v.offset,v.count,e.boundingData,a),n(e,v.offset,v.count,a),m.push(e)}return m}var aP=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,a=e.length;r<a;r++){let a=e[r][t];i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,a=t.length;r<a;r++){let a=t[r],s=e.dot(a);i=s<i?s:i,n=s>n?s:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};aP.prototype.setFromBox=function(){let e=new gl;return function(t,i){let n=i.min,r=i.max,a=1/0,s=-1/0;for(let o=0;o<=1;o++)for(let i=0;i<=1;i++)for(let l=0;l<=1;l++){e.x=n.x*o+r.x*(1-o),e.y=n.y*i+r.y*(1-i),e.z=n.z*l+r.z*(1-l);let c=t.dot(e);a=Math.min(c,a),s=Math.max(c,s)}this.min=a,this.max=s}}();!function(){let e=new aP}();var sP=function(){let e=new gl,t=new gl,i=new gl;return function(n,r,a){let s=n.start,o=e,l=r.start,c=t;i.subVectors(s,l),e.subVectors(n.end,n.start),t.subVectors(r.end,r.start);let h,d,u=i.dot(c),p=c.dot(o),f=c.dot(c),m=i.dot(o),g=o.dot(o)*f-p*p;h=0!==g?(u*p-m*f)/g:0,d=(u+h*p)/f,a.x=h,a.y=d}}(),oP=function(){let e=new jo,t=new gl,i=new gl;return function(n,r,a,s){sP(n,r,e);let o=e.x,l=e.y;if(o>=0&&o<=1&&l>=0&&l<=1)return n.at(o,a),void r.at(l,s);if(o>=0&&o<=1)return l<0?r.at(0,s):r.at(1,s),void n.closestPointToPoint(s,!0,a);if(l>=0&&l<=1)return o<0?n.at(0,a):n.at(1,a),void r.closestPointToPoint(a,!0,s);{let e,c;e=o<0?n.start:n.end,c=l<0?r.start:r.end;let h=t,d=i;return n.closestPointToPoint(c,!0,t),r.closestPointToPoint(e,!0,i),h.distanceToSquared(c)<=d.distanceToSquared(e)?(a.copy(h),void s.copy(c)):(a.copy(e),void s.copy(d))}}}(),lP=function(){let e=new gl,t=new gl,i=new _h,n=new ng;return function(r,a){let{radius:s,center:o}=r,{a:l,b:c,c:h}=a;if(n.start=l,n.end=c,n.closestPointToPoint(o,!0,e).distanceTo(o)<=s||(n.start=l,n.end=h,n.closestPointToPoint(o,!0,e).distanceTo(o)<=s)||(n.start=c,n.end=h,n.closestPointToPoint(o,!0,e).distanceTo(o)<=s))return!0;let d=a.getPlane(i);if(Math.abs(d.distanceToPoint(o))<=s){let e=d.projectPoint(o,t);if(a.containsPoint(e))return!0}return!1}}();function cP(e){return Math.abs(e)<1e-15}var hP=class extends Pc{constructor(){super(...arguments),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map((()=>new gl)),this.satBounds=new Array(4).fill().map((()=>new aP)),this.points=[this.a,this.b,this.c],this.sphere=new Bl,this.plane=new _h,this.needsUpdate=!0}intersectsSphere(e){return lP(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,a=this.satBounds,s=r[0],o=a[0];this.getNormal(s),o.setFromPoints(s,n);let l=r[1],c=a[1];l.subVectors(e,t),c.setFromPoints(l,n);let h=r[2],d=a[2];h.subVectors(t,i),d.setFromPoints(h,n);let u=r[3],p=a[3];u.subVectors(i,e),p.setFromPoints(u,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,e),this.needsUpdate=!1}};hP.prototype.closestPointToSegment=function(){let e=new gl,t=new gl,i=new ng;return function(n){let r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{start:o,end:l}=n,c=this.points,h=1/0;for(let d=0;d<3;d++){let o=(d+1)%3;i.start.copy(c[d]),i.end.copy(c[o]),oP(i,n,e,t),r=e.distanceToSquared(t),r<h&&(h=r,a&&a.copy(e),s&&s.copy(t))}return this.closestPointToPoint(o,e),r=o.distanceToSquared(e),r<h&&(h=r,a&&a.copy(e),s&&s.copy(o)),this.closestPointToPoint(l,e),r=l.distanceToSquared(e),r<h&&(h=r,a&&a.copy(e),s&&s.copy(l)),Math.sqrt(h)}}(),hP.prototype.intersectsTriangle=function(){let e=new hP,t=new Array(3),i=new Array(3),n=new aP,r=new aP,a=new gl,s=new gl,o=new gl,l=new gl,c=new ng,h=new ng,d=new ng;return function(u){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,f=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.needsUpdate&&this.update(),u.isExtendedTriangle?u.needsUpdate&&u.update():(e.copy(u),e.update(),u=e);let m=this.plane,g=u.plane;if(Math.abs(m.normal.dot(g.normal))>1-1e-10){let e=this.satBounds,s=this.satAxes;i[0]=u.a,i[1]=u.b,i[2]=u.c;for(let t=0;t<4;t++){let r=e[t],a=s[t];if(n.setFromPoints(a,i),r.isSeparated(n))return!1}let o=u.satBounds,l=u.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let i=0;i<4;i++){let e=o[i],r=l[i];if(n.setFromPoints(r,t),e.isSeparated(n))return!1}for(let c=0;c<4;c++){let e=s[c];for(let s=0;s<4;s++){let o=l[s];if(a.crossVectors(e,o),n.setFromPoints(a,t),r.setFromPoints(a,i),n.isSeparated(r))return!1}}return p&&(f||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}{let e=this.points,t=!1,i=0;for(let o=0;o<3;o++){let n=e[o],r=e[(o+1)%3];c.start.copy(n),c.end.copy(r),c.delta(s);let a=t?h.start:h.end,l=cP(g.distanceToPoint(n));if(cP(g.normal.dot(s))&&l){h.copy(c),i=2;break}if((g.intersectLine(c,a)||l)&&!cP(a.distanceTo(r))){if(i++,t)break;t=!0}}if(1===i&&u.containsPoint(h.end))return p&&(p.start.copy(h.end),p.end.copy(h.end)),!0;if(2!==i)return!1;let n=u.points,r=!1,a=0;for(let s=0;s<3;s++){let e=n[s],t=n[(s+1)%3];c.start.copy(e),c.end.copy(t),c.delta(o);let i=r?d.start:d.end,l=cP(m.distanceToPoint(e));if(cP(m.normal.dot(o))&&l){d.copy(c),a=2;break}if((m.intersectLine(c,i)||l)&&!cP(i.distanceTo(t))){if(a++,r)break;r=!0}}if(1===a&&this.containsPoint(d.end))return p&&(p.start.copy(d.end),p.end.copy(d.end)),!0;if(2!==a)return!1;if(h.delta(s),d.delta(o),s.dot(o)<0){let e=d.start;d.start=d.end,d.end=e}let f=h.start.dot(s),v=h.end.dot(s),y=d.start.dot(s),b=d.end.dot(s);return(f===b||y===v||v<y!==f<b)&&(p&&(l.subVectors(h.start,d.start),l.dot(s)>0?p.start.copy(h.start):p.start.copy(d.start),l.subVectors(h.end,d.end),l.dot(s)<0?p.end.copy(h.end):p.end.copy(d.end)),!0)}}}(),hP.prototype.distanceToPoint=function(){let e=new gl;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),hP.prototype.distanceToTriangle=function(){let e=new gl,t=new gl,i=["a","b","c"],n=new ng,r=new ng;return function(a){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=s||o?n:null;if(this.intersectsTriangle(a,l))return(s||o)&&(s&&l.getCenter(s),o&&l.getCenter(o)),0;let c=1/0;for(let t=0;t<3;t++){let n,r=i[t],l=a[r];this.closestPointToPoint(l,e),n=l.distanceToSquared(e),n<c&&(c=n,s&&s.copy(e),o&&o.copy(l));let h=this[r];a.closestPointToPoint(h,e),n=h.distanceToSquared(e),n<c&&(c=n,s&&s.copy(h),o&&o.copy(e))}for(let h=0;h<3;h++){let l=i[h],d=i[(h+1)%3];n.set(this[l],this[d]);for(let h=0;h<3;h++){let l=i[h],d=i[(h+1)%3];r.set(a[l],a[d]),oP(n,r,e,t);let u=e.distanceToSquared(t);u<c&&(c=u,s&&s.copy(e),o&&o.copy(t))}}return Math.sqrt(c)}}();var dP=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new gl,this.max=new gl,this.matrix=new ql,this.invMatrix=new ql,this.points=new Array(8).fill().map((()=>new gl)),this.satAxes=new Array(3).fill().map((()=>new gl)),this.satBounds=new Array(3).fill().map((()=>new aP)),this.alignedSatBounds=new Array(3).fill().map((()=>new aP)),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};dP.prototype.update=function(){let e=this.matrix,t=this.min,i=this.max,n=this.points;for(let l=0;l<=1;l++)for(let r=0;r<=1;r++)for(let a=0;a<=1;a++){let s=n[1*l|2*r|4*a];s.x=l?i.x:t.x,s.y=r?i.y:t.y,s.z=a?i.z:t.z,s.applyMatrix4(e)}let r=this.satBounds,a=this.satAxes,s=n[0];for(let l=0;l<3;l++){let e=a[l],t=r[l],i=n[1<<l];e.subVectors(s,i),t.setFromPoints(e,n)}let o=this.alignedSatBounds;o[0].setFromPointsField(n,"x"),o[1].setFromPointsField(n,"y"),o[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},dP.prototype.intersectsBox=function(){let e=new aP;return function(t){this.needsUpdate&&this.update();let i=t.min,n=t.max,r=this.satBounds,a=this.satAxes,s=this.alignedSatBounds;if(e.min=i.x,e.max=n.x,s[0].isSeparated(e)||(e.min=i.y,e.max=n.y,s[1].isSeparated(e))||(e.min=i.z,e.max=n.z,s[2].isSeparated(e)))return!1;for(let o=0;o<3;o++){let i=a[o],n=r[o];if(e.setFromBox(i,t),n.isSeparated(e))return!1}return!0}}(),dP.prototype.intersectsTriangle=function(){let e=new hP,t=new Array(3),i=new aP,n=new aP,r=new gl;return function(a){this.needsUpdate&&this.update(),a.isExtendedTriangle?a.needsUpdate&&a.update():(e.copy(a),e.update(),a=e);let s=this.satBounds,o=this.satAxes;t[0]=a.a,t[1]=a.b,t[2]=a.c;for(let e=0;e<3;e++){let n=s[e],r=o[e];if(i.setFromPoints(r,t),n.isSeparated(i))return!1}let l=a.satBounds,c=a.satAxes,h=this.points;for(let e=0;e<3;e++){let t=l[e],n=c[e];if(i.setFromPoints(n,h),t.isSeparated(i))return!1}for(let e=0;e<3;e++){let a=o[e];for(let e=0;e<4;e++){let s=c[e];if(r.crossVectors(a,s),i.setFromPoints(r,t),n.setFromPoints(r,h),i.isSeparated(n))return!1}}return!0}}(),dP.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},dP.prototype.distanceToPoint=function(){let e=new gl;return function(t){return this.closestPointToPoint(t,e),t.distanceTo(e)}}(),dP.prototype.distanceToBox=function(){let e=["x","y","z"],t=new Array(12).fill().map((()=>new ng)),i=new Array(12).fill().map((()=>new ng)),n=new gl,r=new gl;return function(a){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.needsUpdate&&this.update(),this.intersectsBox(a))return(o||l)&&(a.getCenter(r),this.closestPointToPoint(r,n),a.closestPointToPoint(n,r),o&&o.copy(n),l&&l.copy(r)),0;let c=s*s,h=a.min,d=a.max,u=this.points,p=1/0;for(let e=0;e<8;e++){let t=u[e];r.copy(t).clamp(h,d);let i=t.distanceToSquared(r);if(i<p&&(p=i,o&&o.copy(t),l&&l.copy(r),i<c))return Math.sqrt(i)}let f=0;for(let n=0;n<3;n++)for(let r=0;r<=1;r++)for(let a=0;a<=1;a++){let s=(n+1)%3,o=(n+2)%3,l=1<<n|r<<s|a<<o,c=u[r<<s|a<<o],p=u[l];t[f].set(c,p);let m=e[n],g=e[s],v=e[o],y=i[f],b=y.start,x=y.end;b[m]=h[m],b[g]=r?h[g]:d[g],b[v]=a?h[v]:d[g],x[m]=d[m],x[g]=r?h[g]:d[g],x[v]=a?h[v]:d[g],f++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let i=0;i<=1;i++){r.x=e?d.x:h.x,r.y=t?d.y:h.y,r.z=i?d.z:h.z,this.closestPointToPoint(r,n);let a=r.distanceToSquared(n);if(a<p&&(p=a,o&&o.copy(n),l&&l.copy(r),a<c))return Math.sqrt(a)}for(let e=0;e<12;e++){let a=t[e];for(let e=0;e<12;e++){let t=i[e];oP(a,t,n,r);let s=n.distanceToSquared(r);if(s<p&&(p=s,o&&o.copy(n),l&&l.copy(r),s<c))return Math.sqrt(s)}}return Math.sqrt(p)}}();var uP=new gl,pP=new gl,fP=new gl,mP=new jo,gP=new jo,vP=new jo,yP=new gl,bP=new gl,xP=new gl,wP=new gl;function _P(e,t,i,n,r,a,s,o,l){uP.fromBufferAttribute(t,a),pP.fromBufferAttribute(t,s),fP.fromBufferAttribute(t,o);let c=function(e,t,i,n,r,a){let s;return s=a===sa?e.intersectTriangle(n,i,t,!0,r):e.intersectTriangle(t,i,n,a!==oa,r),null===s?null:{distance:e.origin.distanceTo(r),point:r.clone()}}(e,uP,pP,fP,wP,l);if(c){n&&(mP.fromBufferAttribute(n,a),gP.fromBufferAttribute(n,s),vP.fromBufferAttribute(n,o),c.uv=Pc.getInterpolation(wP,uP,pP,fP,mP,gP,vP,new jo)),r&&(mP.fromBufferAttribute(r,a),gP.fromBufferAttribute(r,s),vP.fromBufferAttribute(r,o),c.uv1=Pc.getInterpolation(wP,uP,pP,fP,mP,gP,vP,new jo)),i&&(yP.fromBufferAttribute(i,a),bP.fromBufferAttribute(i,s),xP.fromBufferAttribute(i,o),c.normal=Pc.getInterpolation(wP,uP,pP,fP,yP,bP,xP,new gl),c.normal.dot(e.direction)>0&&c.normal.multiplyScalar(-1));let t={a:a,b:s,c:o,normal:new gl,materialIndex:0};Pc.getNormal(uP,pP,fP,t.normal),c.face=t,c.faceIndex=a}return c}function SP(e,t,i,n,r){let a=3*n,s=e.index.getX(a),o=e.index.getX(a+1),l=e.index.getX(a+2),{position:c,normal:h,uv:d,uv1:u}=e.attributes,p=_P(i,c,h,d,u,s,o,l,t);return p?(p.faceIndex=n,r&&r.push(p),p):null}function AP(e,t,i,n){let r=e.a,a=e.b,s=e.c,o=t,l=t+1,c=t+2;i&&(o=i.getX(t),l=i.getX(t+1),c=i.getX(t+2)),r.x=n.getX(o),r.y=n.getY(o),r.z=n.getZ(o),a.x=n.getX(l),a.y=n.getY(l),a.z=n.getZ(l),s.x=n.getX(c),s.y=n.getY(c),s.z=n.getZ(c)}function EP(e,t,i,n,r,a,s){let o=i.index,l=i.attributes.position;for(let c=e,h=t+e;c<h;c++)if(AP(s,3*c,o,l),s.needsUpdate=!0,n(s,c,r,a))return!0;return!1}var CP=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function MP(e,t){return 65535===t[e+15]}function PP(e,t){return t[e+6]}function TP(e,t){return t[e+14]}function DP(e){return e+8}function RP(e,t){return t[e+6]}var OP=new bl,IP=new gl,kP=["x","y","z"];function LP(e,t,i,n,r){let a=2*e,s=jP,o=VP,l=GP;if(MP(a,o)){!function(e,t,i,n,r,a){for(let s=n,o=n+r;s<o;s++)SP(e,t,i,s,a)}(t,i,n,PP(e,l),TP(a,o),r)}else{let a=DP(e);zP(a,s,n,IP)&&LP(a,t,i,n,r);let o=RP(e,l);zP(o,s,n,IP)&&LP(o,t,i,n,r)}}function FP(e,t,i,n){let r=2*e,a=jP,s=VP,o=GP;if(MP(r,s)){return function(e,t,i,n,r){let a=1/0,s=null;for(let o=n,l=n+r;o<l;o++){let n=SP(e,t,i,o);n&&n.distance<a&&(s=n,a=n.distance)}return s}(t,i,n,PP(e,o),TP(r,s))}{let r,s,l=function(e,t){return t[e+7]}(e,o),c=kP[l],h=n.direction[c]>=0;h?(r=DP(e),s=RP(e,o)):(r=RP(e,o),s=DP(e));let d=zP(r,a,n,IP)?FP(r,t,i,n):null;if(d){let e=d.point[c];if(h?e<=a[s+l]:e>=a[s+l+3])return d}let u=zP(s,a,n,IP)?FP(s,t,i,n):null;return d&&u?d.distance<=u.distance?d:u:d||u||null}}var BP=function(){let e,t,i=[],n=new CP((()=>new bl));return function(){e=n.getPrimitive(),t=n.getPrimitive(),i.push(e,t);let a=r(...arguments);n.releasePrimitive(e),n.releasePrimitive(t),i.pop(),i.pop();let s=i.length;return s>0&&(t=i[s-1],e=i[s-2]),a};function r(i,n,a,s){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;function h(e){let t=2*e,i=VP,n=GP;for(;!MP(t,i);)t=2*(e=DP(e));return PP(e,n)}function d(e){let t=2*e,i=VP,n=GP;for(;!MP(t,i);)t=2*(e=RP(e,n));return PP(e,n)+TP(t,i)}let u=2*i,p=jP,f=VP,m=GP;if(MP(u,f)){let t=PP(i,m),n=TP(u,f);return XM(i,p,e),s(t,n,!1,c,l+i,e)}{let u,g,v,y,b=DP(i),x=RP(i,m),w=b,_=x;if(o&&(v=e,y=t,XM(w,p,v),XM(_,p,y),u=o(v),g=o(y),g<u)){w=x,_=b;let e=u;u=g,g=e,v=y}v||(v=e,XM(w,p,v));let S,A=a(v,MP(2*w,f),u,c+1,l+w);if(2===A){let e=h(w);S=s(e,d(w)-e,!0,c+1,l+w,v)}else S=A&&r(w,n,a,s,o,l,c+1);if(S)return!0;y=t,XM(_,p,y);let E,C=a(y,MP(2*_,f),g,c+1,l+_);if(2===C){let e=h(_);E=s(e,d(_)-e,!0,c+1,l+_,y)}else E=C&&r(_,n,a,s,o,l,c+1);return!!E}}}(),NP=function(){let e=new hP,t=new hP,i=new ql,n=new dP,r=new dP;return function a(s,o,l,c){let h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,d=2*s,u=jP,p=VP,f=GP;if(null===h&&(l.boundingBox||l.computeBoundingBox(),n.set(l.boundingBox.min,l.boundingBox.max,c),h=n),!MP(d,p)){let e=s+8,t=f[s+6];return XM(e,u,OP),!!(h.intersectsBox(OP)&&a(e,o,l,c,h)||(XM(t,u,OP),h.intersectsBox(OP)&&a(t,o,l,c,h)))}{let n=o,a=n.index,h=n.attributes.position,m=l.index,g=l.attributes.position,v=PP(s,f),y=TP(d,p);if(i.copy(c).invert(),l.boundsTree)return XM(s,u,r),r.matrix.copy(i),r.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:e=>r.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(c),e.b.applyMatrix4(c),e.c.applyMatrix4(c),e.needsUpdate=!0;for(let i=3*v,n=3*(y+v);i<n;i+=3)if(AP(t,i,a,h),t.needsUpdate=!0,e.intersectsTriangle(t))return!0;return!1}});for(let r=3*v,s=y+3*v;r<s;r+=3){AP(e,r,a,h),e.a.applyMatrix4(i),e.b.applyMatrix4(i),e.c.applyMatrix4(i),e.needsUpdate=!0;for(let i=0,n=m.count;i<n;i+=3)if(AP(t,i,m,g),t.needsUpdate=!0,e.intersectsTriangle(t))return!0}}}}();function zP(e,t,i,n){return XM(e,t,OP),i.intersectBox(OP,n)}var UP,jP,VP,GP,HP=[];function WP(e){UP&&HP.push(UP),UP=e,jP=new Float32Array(e),VP=new Uint16Array(e),GP=new Uint32Array(e)}function qP(){UP=null,jP=null,VP=null,GP=null,HP.length&&WP(HP.pop())}var XP=Symbol("skip tree generation"),YP=new bl,QP=new bl,KP=new ql,ZP=new dP,JP=new dP,$P=new gl,eT=new gl,tT=new gl,iT=new gl,nT=new gl,rT=new bl,aT=new CP((()=>new hP)),sT=class{static serialize(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),sT.serialize(arguments[0],{cloneBuffers:void 0===arguments[2]||arguments[2]});t={cloneBuffers:!0,...t};let i,n=e.geometry,r=e._roots,a=n.getIndex();return i=t.cloneBuffers?{roots:r.map((e=>e.slice())),index:a.array.slice()}:{roots:r,index:a.array},i}static deserialize(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("boolean"==typeof i)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),sT.deserialize(arguments[0],arguments[1],{setIndex:void 0===arguments[2]||arguments[2]});i={setIndex:!0,...i};let{index:n,roots:r}=e,a=new sT(t,{...i,[XP]:!0});if(a._roots=r,i.setIndex){let i=t.getIndex();if(null===i){let i=new kc(e.index,1,!1);t.setIndex(i)}else i.array!==n&&(i.array.set(n),i.needsUpdate=!0)}return a}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[XP]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[XP]||(this._roots=function(e,t){let i,n,r,a=rP(e,t),s=[],o=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<a.length;h++){let e=a[h],t=new o(32*l(e));i=new Float32Array(t),n=new Uint32Array(t),r=new Uint16Array(t),c(0,e),s.push(t)}return s;function l(e){return e.count?1:1+l(e.left)+l(e.right)}function c(e,t){let a=e/4,s=e/2,o=!!t.count,l=t.boundingData;for(let n=0;n<6;n++)i[a+n]=l[n];if(o){let i=t.offset,o=t.count;return n[a+6]=i,r[s+14]=o,r[s+15]=65535,e+32}{let i,r=t.left,s=t.right,o=t.splitAxis;if(i=c(e+32,r),i/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[a+6]=i/4,i=c(i,s),n[a+7]=o,i}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new bl))),this.geometry=e}refit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&Array.isArray(e)&&(e=new Set(e));let t,i,n,r,a=this.geometry,s=a.index.array,o=a.attributes.position,l=0,c=this._roots;for(let d=0,u=c.length;d<u;d++)t=c[d],i=new Uint32Array(t),n=new Uint16Array(t),r=new Float32Array(t),h(0,l),l+=t.byteLength;function h(t,a){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=2*t;if(65535===n[c+15]){let e=i[t+6],a=1/0,l=1/0,h=1/0,d=-1/0,u=-1/0,p=-1/0;for(let t=3*e,i=3*(e+n[c+14]);t<i;t++){let e=s[t],i=o.getX(e),n=o.getY(e),r=o.getZ(e);i<a&&(a=i),i>d&&(d=i),n<l&&(l=n),n>u&&(u=n),r<h&&(h=r),r>p&&(p=r)}return(r[t+0]!==a||r[t+1]!==l||r[t+2]!==h||r[t+3]!==d||r[t+4]!==u||r[t+5]!==p)&&(r[t+0]=a,r[t+1]=l,r[t+2]=h,r[t+3]=d,r[t+4]=u,r[t+5]=p,!0)}{let n=t+8,s=i[t+6],o=n+a,c=s+a,d=l,u=!1,p=!1;e?d||(u=e.has(o),p=e.has(c),d=!u&&!p):(u=!0,p=!0);let f=d||p,m=!1;(d||u)&&(m=h(n,a,d));let g=!1;f&&(g=h(s,a,d));let v=m||g;if(v)for(let e=0;e<3;e++){let i=n+e,a=s+e,o=r[i],l=r[i+3],c=r[a],h=r[a+3];r[t+e]=o<c?o:c,r[t+e+3]=l>h?l:h}return v}}}traverse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);!function t(a){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=2*a,l=65535===r[o+15];if(l){let t=n[a+6],c=r[o+14];e(s,l,new Float32Array(i,4*a,6),t,c)}else{let r=a+8,o=n[a+6],c=n[a+7];e(s,l,new Float32Array(i,4*a,6),c)||(t(r,s+1),t(o,s+1))}}(0)}raycast(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:aa,i=this._roots,n=this.geometry,r=[],a=t.isMaterial,s=Array.isArray(t),o=n.groups,l=a?t.side:t;for(let c=0,h=i.length;c<h;c++){let a=s?t[o[c].materialIndex].side:l,h=r.length;if(WP(i[c]),LP(0,n,a,e,r),qP(),s){let e=o[c].materialIndex;for(let t=h,i=r.length;t<i;t++)r[t].face.materialIndex=e}}return r}raycastFirst(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:aa,i=this._roots,n=this.geometry,r=t.isMaterial,a=Array.isArray(t),s=null,o=n.groups,l=r?t.side:t;for(let c=0,h=i.length;c<h;c++){let r=a?t[o[c].materialIndex].side:l;WP(i[c]);let h=FP(0,n,r,e);qP(),null!=h&&(null==s||h.distance<s.distance)&&(s=h,a&&(h.face.materialIndex=o[c].materialIndex))}return s}intersectsGeometry(e,t){let i=this.geometry,n=!1;for(let r of this._roots)if(WP(r),n=NP(0,i,e,t),qP(),n)break;return n}shapecast(e,t,i){let n=this.geometry;if(e instanceof Function){if(t){let e=t;t=(t,i,n,r)=>{let a=3*i;return e(t,a,a+1,a+2,n,r)}}e={boundsTraverseOrder:i,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let r=aT.getPrimitive(),{boundsTraverseOrder:a,intersectsBounds:s,intersectsRange:o,intersectsTriangle:l}=e;if(o&&l){let e=o;o=(t,i,a,s,o)=>!!e(t,i,a,s,o)||EP(t,i,n,l,a,s,r)}else o||(o=l?(e,t,i,a)=>EP(e,t,n,l,i,a,r):(e,t,i)=>i);let c=!1,h=0;for(let d of this._roots){if(WP(d),c=BP(0,n,s,o,a,h),qP(),c)break;h+=d.byteLength}return aT.releasePrimitive(r),c}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i,a=this.geometry.index,s=this.geometry.attributes.position,o=e.geometry.index,l=e.geometry.attributes.position;KP.copy(t).invert();let c=aT.getPrimitive(),h=aT.getPrimitive();if(r){let e=function(e,i,n,d,u,p,f,m){for(let g=n,v=n+d;g<v;g++){AP(h,3*g,o,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let t=e,n=e+i;t<n;t++)if(AP(c,3*t,a,s),c.needsUpdate=!0,r(c,h,t,g,u,p,f,m))return!0}return!1};if(n){let t=n;n=function(i,n,r,a,s,o,l,c){return!!t(i,n,r,a,s,o,l,c)||e(i,n,r,a,s,o,l,c)}}else n=e}e.getBoundingBox(QP),QP.applyMatrix4(t);let d=this.shapecast({intersectsBounds:e=>QP.intersectsBox(e),intersectsRange:(t,i,r,a,s,o)=>(YP.copy(o),YP.applyMatrix4(KP),e.shapecast({intersectsBounds:e=>YP.intersectsBox(e),intersectsRange:(e,r,o,l,c)=>n(t,i,e,r,a,s,l,c)}))});return aT.releasePrimitive(c),aT.releasePrimitive(h),d}intersectsBox(e,t){return ZP.set(e.min,e.max,t),ZP.needsUpdate=!0,this.shapecast({intersectsBounds:e=>ZP.intersectsBox(e),intersectsTriangle:e=>ZP.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0;e.boundingBox||e.computeBoundingBox(),ZP.set(e.boundingBox.min,e.boundingBox.max,t),ZP.needsUpdate=!0;let s=this.geometry,o=s.attributes.position,l=s.index,c=e.attributes.position,h=e.index,d=aT.getPrimitive(),u=aT.getPrimitive(),p=eT,f=tT,m=null,g=null;n&&(m=iT,g=nT);let v=1/0,y=null,b=null;return KP.copy(t).invert(),JP.matrix.copy(KP),this.shapecast({boundsTraverseOrder:e=>ZP.distanceToBox(e),intersectsBounds:(e,t,i)=>i<v&&i<a&&(t&&(JP.min.copy(e.min),JP.max.copy(e.max),JP.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:e=>JP.distanceToBox(e),intersectsBounds:(e,t,i)=>i<v&&i<a,intersectsRange:(e,a)=>{for(let s=3*e,x=3*(e+a);s<x;s+=3){AP(u,s,h,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let e=3*i,t=3*(i+n);e<t;e+=3){AP(d,e,l,o),d.needsUpdate=!0;let t=d.distanceToTriangle(u,p,m);if(t<v&&(f.copy(p),g&&g.copy(m),v=t,y=e/3,b=s/3),t<r)return!0}}}});for(let e=0,a=h?h.count:c.count;e<a;e+=3){AP(u,e,h,c),u.a.applyMatrix4(t),u.b.applyMatrix4(t),u.c.applyMatrix4(t),u.needsUpdate=!0;for(let t=3*i,a=3*(i+n);t<a;t+=3){AP(d,t,l,o),d.needsUpdate=!0;let i=d.distanceToTriangle(u,p,m);if(i<v&&(f.copy(p),g&&g.copy(m),v=i,y=t/3,b=e/3),i<r)return!0}}}}),aT.releasePrimitive(d),aT.releasePrimitive(u),v===1/0?null:(i.point?i.point.copy(f):i.point=f.clone(),i.distance=v,i.faceIndex=y,n&&(n.point?n.point.copy(g):n.point=g.clone(),n.point.applyMatrix4(KP),f.applyMatrix4(KP),n.distance=f.sub(n.point).length(),n.faceIndex=b),i)}closestPointToPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,r=i*i,a=n*n,s=1/0,o=null;if(this.shapecast({boundsTraverseOrder:t=>($P.copy(e).clamp(t.min,t.max),$P.distanceToSquared(e)),intersectsBounds:(e,t,i)=>i<s&&i<a,intersectsTriangle:(t,i)=>{t.closestPointToPoint(e,$P);let n=e.distanceToSquared($P);return n<s&&(eT.copy($P),s=n,o=i),n<r}}),s===1/0)return null;let l=Math.sqrt(s);return t.point?t.point.copy(eT):t.point=eT.clone(),t.distance=l,t.faceIndex=o,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach((t=>{XM(0,new Float32Array(t),rT),e.union(rT)})),e}},oT=Br(zr()),lT=.5*(Math.sqrt(3)-1),cT=(3-Math.sqrt(3))/6,hT=1/3,dT=1/6,uT=(Math.sqrt(5),Math.sqrt(5),e=>0|Math.floor(e)),pT=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),fT=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function mT(){let e=gT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((e=>pT[e%12*2])),i=new Float64Array(e).map((e=>pT[e%12*2+1]));return function(n,r){let a,s,o=0,l=0,c=0,h=(n+r)*lT,d=uT(n+h),u=uT(r+h),p=(d+u)*cT,f=n-(d-p),m=r-(u-p);f>m?(a=1,s=0):(a=0,s=1);let g=f-a+cT,v=m-s+cT,y=f-1+2*cT,b=m-1+2*cT,x=255&d,w=255&u,_=.5-f*f-m*m;if(_>=0){let n=x+e[w];_*=_,o=_*_*(t[n]*f+i[n]*m)}let S=.5-g*g-v*v;if(S>=0){let n=x+a+e[w+s];S*=S,l=S*S*(t[n]*g+i[n]*v)}let A=.5-y*y-b*b;if(A>=0){let n=x+1+e[w+1];A*=A,c=A*A*(t[n]*y+i[n]*b)}return 70*(o+l+c)}}function gT(e){let t=new Uint8Array(512);for(let i=0;i<256;i++)t[i]=i;for(let i=0;i<255;i++){let n=i+~~(e()*(256-i)),r=t[i];t[i]=t[n],t[n]=r}for(let i=256;i<512;i++)t[i]=t[i-256];return t}var vT,yT=new Pc,bT=class{constructor(e){this.weightAttribute=null;let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let e=this.positionAttribute,t=new Float32Array(e.count/3);for(let n=0;n<e.count;n+=3){let i=1;yT.a.fromBufferAttribute(e,n),yT.b.fromBufferAttribute(e,n+1),yT.c.fromBufferAttribute(e,n+2),i*=yT.getArea(),t[n/3]=i}this.distribution=new Float32Array(e.count/3);let i=0;for(let n=0;n<t.length;n++)i+=t[n],this.distribution[n]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t){if(this.distribution){let i=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*i);return this.sampleFace(n,e,t)}}binarySearch(e){if(!this.distribution)return 0;let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let a=Math.ceil((i+n)/2);if(0===a||t[a-1]<=e&&t[a]>e){r=a;break}e<t[a]?n=a-1:i=a+1}return r}sampleFace(e,t,i){let n=this.randomFunction(),r=this.randomFunction();return n+r>1&&(n=1-n,r=1-r),yT.a.fromBufferAttribute(this.positionAttribute,3*e),yT.b.fromBufferAttribute(this.positionAttribute,3*e+1),yT.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(yT.a,n).addScaledVector(yT.b,r).addScaledVector(yT.c,1-(n+r)),yT.getNormal(i),this}},xT=Br(Ur()),wT=new ql,_T=new ql,ST=new ql;(e=>{e.is=function(e){return e&&e.__isSPEObject}})(vT||(vT={}));var AT,ET=e=>class extends e{constructor(){super(...arguments),this.previousModelViewMatrix=new ql,this.copyPreviousMatrix=!0,this.hiddenMatrix=new ql,this.matrixWorldRigid=new ql,this.shearScale=new ql,this.shearScaleInv=new ql}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof vc&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let t of this.children)t.updateMatrixWorld(e)}updateWorldMatrix(e,t){let i=this.parent;if(e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),t)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;for(let i of this.children)vT.is(i)&&i.traverseObject(e,t+1)}traverseObject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let i of this.children)vT.is(i)&&i.traverseObject(e,t+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,t=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:i,v:n,q:r}=(0,xT.SVD)(t),a=wT.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=_T.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),o=ST.copy(s).transpose();this.shearScale.makeScale(r[0],r[1],r[2]).multiply(o).premultiply(s),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,o).copyPosition(this.matrixWorld),r.every((e=>Math.abs(r[0]-e)<.01))?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,t){this.updateWorldMatrix(!0,!1);let i=(new ql).copy(this.matrixWorld).invert();return null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),i.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof ql?e.hiddenMatrix.premultiply(i):e.applyMatrix4(i),e.updateWorldMatrix(!1,!1),this.add(e),void 0!==t&&(this.children.pop(),this.children.splice(t,0,e)),this}copy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(e,t),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,t,i,n,r,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},CT=class extends(ET(vc)){},MT=class extends CT{constructor(e){super(),this.object=e,this.matrixAutoUpdate=!1,this.hasNonUniformScale=e.hasNonUniformScale}raycast(e,t){}expand(){let e=0,t=this.object.entityChildren(e);for(;t;){var i;let n=this.children[e];(null===(i=n)||void 0===i?void 0:i.object)!==t&&(n&&this.remove(n),n=new MT(t),this.add(n),this.children.splice(e,0,this.children.pop()),n.matrixWorldNeedsUpdate=!0,n.matrixAutoUpdate=!1,n.matrix=t.matrix,n.hiddenMatrix=t.hiddenMatrix),n.expand(),e+=1,t=this.object.entityChildren(e)}for(;this.children.length>e;)this.remove(this.children[e])}get visible(){var e;return void 0!==this.playModeVisible?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&!0===(null===(e=this.object.dataPatched.cloner)||void 0===e?void 0:e.hideBase)}set visible(e){}get castShadow(){return this.object.castShadow}set castShadow(e){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(e){}get isMesh(){return"Mesh"===this.object.type}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(e){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}},PT=new gl,TT=new gl,DT=new ql,RT=[new gl(-1,1,1),new gl(-1,-1,1),new gl(1,-1,1),new gl(1,1,1),new gl(-1,1,-1),new gl(-1,-1,-1),new gl(1,-1,-1),new gl(1,1,-1)],OT=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],IT=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],kT=(e,t,i)=>{e.updateEntityBoxSize(PT,TT),DT.copy(t).multiply(e.matrixWorld),0===TT.x&&0===TT.y&&0===TT.z?i.push(new gl(PT.x,PT.y,PT.z).applyMatrix4(DT)):RT.forEach((e=>{i.push(e.clone().multiply(TT).add(PT).applyMatrix4(DT))}))},LT=class extends bl{constructor(){super(...arguments),this.matrix=new ql,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(e){return super.copy(e),this.matrix.copy(e.matrix),this.vertices=e.vertices.map((e=>e.clone())),this.faces=e.faces.map((e=>e.clone())),this.edges=e.edges.map((e=>e.clone())),this.centerEdges=e.centerEdges.map((e=>e.clone())),this}setFromObjectSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,t),this.makeEmpty(),this.matrix.copy(e.matrixWorld);let i=(new ql).copy(e.matrixWorld).invert();return this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t){let i=[];return!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])?e.traverseEntity((e=>{if(e.visible||e.cloner&&e.data.visible){if(!("geometry"in e))return void i.push(new gl);kT(e,t,i)}})):kT(e,t,i),this.setFromPoints(i)}getCenter(e){return(e=super.getCenter(e)).applyMatrix4(this.matrix),e}getPositionToCenter(e){return(e=super.getCenter(e)).applyMatrix4(DT.copy(this.matrix).setPosition(0,0,0)),e}computeVertices(){this.getSize(TT).multiplyScalar(.5),this.getCenter(PT),DT.copy(this.matrix).setPosition(PT),this.vertices=RT.map((e=>e.clone().multiply(TT).applyMatrix4(DT)))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=OT.map((e=>{let[t,i]=e;return new ng(this.vertices[t],this.vertices[i])})),this.centerEdges=this.edges.map((e=>e.getCenter(new gl)))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=IT.map((e=>{let[t,i]=e;return this.vertices[t].clone().add(this.vertices[i]).multiplyScalar(.5)}))}},FT={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},BT=class extends Jp{constructor(){super()}getPoints(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,i=[],n=this.getCurveLengths(),r=n[n.length-1]/n.length;for(let a=0,s=this.curves;a<s.length;a++){let o=s[a],l=0===a?n[a]:n[a]-n[a-1],c=Math.ceil(t*l/r),h=o.getPoints(c);for(let t=0;t<h.length;t++){let n=h[t];e&&e.equals(n)||(i.push(n),e=n)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}},NT=.001;function zT(e,t,i){return t.clone().sub(e).cross(t.clone().sub(i)).length()<=NT}function UT(e,t){let i=new gl(...e.position),n=new gl(...e.controlNext.position),r=new gl(...t.controlPrevious.position),a=new gl(...t.position);return zT(i,n,a)&&zT(i,r,a)}function jT(e){let t=e.points.map((e=>new gl(...e.data.position))),i=[e.points[0]],n=new gl(...i[0].data.position);for(let h=0;h<e.points.length-1;h++)zT(n,t[h],t[h+1])||(i.push(e.points[h]),n=t[h]);i.push(e.points[e.points.length-1]);let r=e.isClosed,a=i.length-(r?0:1),s=i.length,o=[];for(let h=0;h<s;h++){let t=i[h].data,n=new gl(...t.position),a=new gl(...t.controlPrevious.position),l=new gl(...t.controlNext.position),c={position:n,baseRoundness:t.roundness,controlPrevious:a,controlNext:l};if(0===t.roundness||!e.isClosed&&(0===h||h===s-1)){o[h]={...c,removedLength:0};continue}let d=r&&h==s-1?0:h+1,u=i[r&&0==h?s-1:h-1].data,p=i[d].data,f=new gl(...u.position),m=new gl(...p.position),g=f.clone().sub(n).normalize(),v=m.clone().sub(n).normalize();Object.assign(c,{prevDir:g,nextDir:v});let y=UT(u,t),b=UT(t,p);if(y&&b){let e=g.clone().add(v).normalize(),i=e.clone().cross(g).length()/g.dot(e);o[h]={...c,tan:i,removedLength:t.roundness/i}}else o[h]={...c,removedLength:0}}for(let h=0;h<a;h++){let e=r&&h===s-1?0:h+1,t=o[h],i=o[e];if(0!==t.removedLength||0!==i.removedLength){let e=t.position.distanceTo(i.position);t.removedLength=Math.min(t.removedLength,e/2),i.removedLength=Math.min(i.removedLength,e/2)}}let l=[];for(let h=0;h<a;h++){let e=h,t=r&&h===s-1?0:h+1,n=o[e],a=o[t],c=null;if(UT(i[e].data,i[t].data)){let e=n.position.clone(),t=a.position.clone();(0!==n.removedLength||0!==a.removedLength)&&(n.nextDir&&e.add(n.nextDir.clone().setLength(n.removedLength)),a.prevDir&&t.add(a.prevDir.clone().setLength(a.removedLength))),e.distanceTo(t)>NT&&(c=new qp(e,e.clone().lerp(t,.3),t.clone().lerp(e,.3),t))}else n.position.distanceTo(a.position)>NT&&(c=new qp(n.position,n.controlNext,a.controlPrevious,a.position));l[2*h+1]=c}for(let h=0;h<s;h++){let e=o[h];if(0===e.removedLength){l[2*h]=null;continue}let t=e.position,i=e.prevDir.clone().multiplyScalar(e.removedLength).add(t),n=e.nextDir.clone().multiplyScalar(e.removedLength).add(t),r=e.tan*e.removedLength,a=e.prevDir.clone().add(e.nextDir).normalize(),s=i.clone().lerp(n,.5),c=i.distanceTo(n)/2,d=a.clone().multiplyScalar(Math.sqrt(Math.pow(r,2)-Math.pow(c,2))).add(s),u=a.clone().multiplyScalar(-r).add(d),p=t.distanceTo(u)/t.distanceTo(s),f=e.prevDir.clone().multiplyScalar(p*t.distanceTo(i)).add(t),m=f.clone().lerp(u,2),g=i.clone().lerp(f,4/3),v=n.clone().lerp(m,4/3);l[2*h]=new qp(i,g,v,n)}let c=new BT;return l.forEach((e=>{e&&c.add(e)})),c}(e=>{e.is=function(e){return e&&e.__isEntity}})(AT||(AT={}));var VT=e=>AT.is(e),GT={type:"completeState",isfromEntity:!0},HT=["x","y","z"],WT=new gl,qT=(new gl).set(0,1,0),XT=e=>class extends(ET(e)){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new LT,this._recursiveBBox=new LT,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let t=this.children[e];if(AT.is(t))return t}entityChildrenCount(){let e=this.children.length;for(;e--;)if(AT.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return"string"==typeof this.identity}get isVirtualEntity(){return"string"!=typeof this.identity}get isInstanceRoot(){return this.isConcreteEntity&&"Instance"===this.data.type}nearestInstanceSelfOrParent(){let e=this;for(;"Instance"!==e.data.type;){let t=e.parent;if(!AT.is(t))return;e=t}return e}forInstancesRec(e){this.instances.forEach((t=>{t.disposed||e(t),t.forInstancesRec(e)}))}super_Entity(e,t){"string"==typeof e&&(this.uuid=e),this.identity=e,this.data=t,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||i){for(let e of this.data.states)NC.toOps(this.data,e.data).forEach((e=>{let i=q_.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(i,this.data,t)}));if(null!==e){let i=this.data.states.data(e);i&&(this.dataPatched=NC.patch(this.data,i),NC.toOps(this.data,i).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}i&&this.updateTransformState(this.dataPatched,t),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,t){e.setScalar(0),t.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{VT(e)&&e.resetBBoxNeedsUpdateSelf()})),this.traverseEntity((e=>{e.resetBBoxNeedsUpdateSelf()}))}find(e){let t;return this.traverseEntity((i=>{i.uuid===e&&(t=i)})),t}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children,i=t.indexOf(this)+1;if(AT.is(t[i]))return t[i];if(AT.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&AT.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let t=this;for(;e>0&&null!==t;)t=t.parent,e-=1;return t}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let t=this.parent;for(;t;){if(e===t)return!0;t=t.parent}return!1}countToAccestor(e){let t=0,i=this;for(;i!==e;){if(null===i)return-1;i=i.parent,t+=1}return t}forEachEntity(e){for(let t of this.children)VT(t)&&e(t)}traverseEntityAncestors(e){this.traverseAncestors((t=>{AT.is(t)&&e(t)}))}traverseConcreteEntity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let i of this.children)VT(i)&&i.isConcreteEntity&&i.traverseEntity(e,t+1)}traverseEntity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!0!==e(this,t))for(let i of this.children)VT(i)&&i.traverseEntity(e,t+1)}traverseVisibleEntity(e){e(this);for(let t of this.children)VT(t)&&t.visible&&t.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return super.copy(e,t),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some((e=>VT(e)))}isAncestorOf(e){if(this.uuid===e)return!1;let t=!1;return this.traverseEntity((i=>{i.uuid===e&&(t=!0)})),t}toObjectTransformState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.updateWorldMatrix(!0,!1);let t={position:this.position.toArray(),rotation:[this.rotation.x*Uo.RAD2DEG,this.rotation.y*Uo.RAD2DEG,this.rotation.z*Uo.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Kw(t,e)}getTransformValues(e,t,i){return t[e].map(((t,n)=>{var r;return null!==(r=null===i||void 0===i?void 0:i.shared.getVariable(t,[this.uuid,e,HT[n]]))&&void 0!==r?r:t}))}updateTransformState(e,t){var i;let n=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,t)),n=!0),e.rotation&&(WT.fromArray(this.getTransformValues("rotation",e,t)).multiplyScalar(Uo.DEG2RAD),this.rotation.setFromVector3(WT),n=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,t)),n=!0),void 0!==e.hiddenMatrix&&(n=!0,this.hiddenMatrix.fromArray(null!==(i=e.hiddenMatrix)&&void 0!==i?i:xE.identity)),n&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)}))),e.position&&e.rotation&&e.scale&&void 0!==e.hiddenMatrix&&this.updateWorldMatrix(!1,!0),n}onVariableUpdate(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.resetBBoxNeedsUpdate():(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors((e=>{e.invalidateClonerTransform(this)})))}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)AT.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach((e=>{AT.is(e)&&e.disposeRecursively()}))}toState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return Kw(t,e)}updateByObjUpdateOp(e,t){void 0!==e&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},t,!1)}updateByOp(e,t,i,n){let r=this.data;this.data=t;let a=e,s=_S(e.path,["states","*"]);if(null!==s){if(0===e.type){let[t]=s;if((null===this||void 0===this?void 0:this.stateSelection)===t){let t={...e.props};if(delete t.name,Object.values(e.props).some((e=>void 0===e))){let i=this.data;if(void 0!==i){let n=gS.zoom(i,e.path.slice(2));if(n)for(let i in e.props)void 0===e.props[i]&&i in n&&(t[i]=n[i])}}a={...e,props:t,path:e.path.slice(2)}}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e,...i}=t;t=i}if(void 0!==e.props.material&&"material"in t){let{material:e,...i}=t;t=i}let i=gS.removeOverridden(e.path,e.props,t);a={...e,props:i}}}if(this.updateByPatchedOpBase(a,NC.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i),_S(e.path,["overrides"])){let n=[],r=[...e.path];for(n.push(r[1]),r.splice(0,2);r.length>0&&"descendants"===r[0];)n.push(r[1]),r.splice(0,2);if(void 0===n[n.length-1]){if(0===e.type)for(let t of Object.keys(e.props)){n[n.length-1]=t;let r=i.scene.findInstance([this.uuid,...n]);r&&(r.overrideData=e.props[t],r.updateState(H_.apply(r.component.data,r.overrideData),i))}}else{let a=i.scene.findInstance([this.uuid,...n]);if(a){let s=gS.zoom(a.component.data,r);if(0===(e={...e,path:r}).type){let t=e.props;if(s)for(let[i,n]of Object.entries(e.props))void 0===n&&(t===e.props&&(t={...e.props}),t[i]=s[i]);e={...e,props:t}}a.overrideData=kC.resolve(t.overrides,n),a.updateByOp(e,X_.applySimple(a.data,e),i,!1)}}}else if(this.instances.length>0){let n;if(0===e.path.length&&0===e.type){let t;for(let i of LC.rootOverrideProps)i in e.props&&(void 0===t&&(t={}),t[i]=e.props[i]);t&&(n={...e,props:t})}else for(let t of LC.rootOverrideProps)if(_S(e.path,[t])){n=e;break}void 0!==n&&this.instances.forEach((e=>{if(e.isInstanceRoot){let t=H_.filterOp(e.overrideData,n);t&&e.updateByOp(t,X_.applySimple(e.data,t),i,!0)}})),this.instances.forEach((n=>{if(!n.isInstanceRoot){let a=H_.filterOp(n.overrideData,e);if(a){let s;s=r===n.data&&e===a?t:X_.applySimple(n.data,a),n.updateByOp(a,s,i,!0)}}}))}}updateByPatchedOpBase(e,t,i){if(this.dataPatched=t,0===e.path.length&&0===e.type)void 0!==e.props.type&&!RE.is(e.props.type)&&FT.changeEntityProptotype(this,t,i);else if(1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&"type"in e.props){FT.changeEntityProptotype(this,t,i);for(let e of this.children)AT.is(e)&&e.updateVisible(i.scene)}this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){if(0===e.path.length&&0===e.type&&this.updateState(e.props,i),null!==_S(e.path,["pathSnapping"])&&this.updatePathSnapping(t.pathSnapping),null!==_S(e.path,["cloner"])){let n=X_.drop(e,1);0===n.path.length&&0===n.type&&!0===n.props.disabled?this.setFromClonerState(null,i):this.cloner?this.cloner.updateState(t.cloner,i.scene):(this.setFromClonerState(t.cloner,i),this.expandCloner(i.scene)),this.updateVisible(i.scene)}}updatePathSnapping(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.dataPatched.pathSnapping;this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){var t,i,n,r,a,s,o,l,c,h,d;let u=null!==(t=null===(i=this._updatedPathSnapping)||void 0===i?void 0:i.pathId)&&void 0!==t?t:this.dataPatched.pathSnapping.pathId,p=null!==(n=null!==(r=null===(a=this._updatedPathSnapping)||void 0===a?void 0:a.slide)&&void 0!==r?r:this.dataPatched.pathSnapping.slide)&&void 0!==n?n:0,f=null!==(s=null!==(o=null===(l=this._updatedPathSnapping)||void 0===l?void 0:l.offset)&&void 0!==o?o:this.dataPatched.pathSnapping.offset)&&void 0!==s?s:0,m=null!==(c=null===(h=this._updatedPathSnapping)||void 0===h?void 0:h.orientation)&&void 0!==c?c:this.dataPatched.pathSnapping.orientation;if(null===u)return;let g=e.find(u);if(!g||!1===this._needApplyPathSnapping)return;this._needApplyPathSnapping=!1;let v=g.data;if(v.geometry.path.points.length<=1)return;let y=jT(v.geometry.path),b=(p+f)%1;p+f===1&&0===b&&(b=1);let x=y.curves.length?y.getPointAt(b):null;if(null===x)return;let w=this.parent?null===(d=this.parent)||void 0===d?void 0:d.matrixWorld:new ql;g.updateMatrixWorld();let _=(new ql).multiplyMatrices(w.clone().invert(),g.matrixWorld);x.applyMatrix4(_);let S={position:x.toArray(),rotation:v.rotation};if("tangential"===m){let e=(new ql).extractRotation(g.matrixWorld),t=y.getTangentAt(b).applyMatrix4(e).add(x),i=(new ql).lookAt(x,t,qT),n=WT.setFromEuler((new ic).setFromRotationMatrix(i)).multiplyScalar(Uo.RAD2DEG);S={...S,rotation:n.toArray()}}this.updateTransformState(S),this.traverseEntity((e=>{e._cameraType&&e.dispatchEvent(GT)}))}updateVisible(e){var t,i;if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||null!==(t=this.dataPatched.cloner.disabled)&&void 0!==t&&t||!0!==(null===(i=this.dataPatched.cloner)||void 0===i?void 0:i.hideBase)),!e)return;let n=!1;this.traverseEntity((e=>{if("Splat"===e.data.type)return n=!0,!0})),n&&e.reloadSplats()}updateState_Entity(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.raycastLock&&(this.raycastLock=e.raycastLock),void 0!==e.visible&&(this.updateVisible(null===t||void 0===t?void 0:t.scene),this.resetBBoxNeedsUpdate()),t&&"cloner"in e&&void 0!==e.cloner&&(this.setFromClonerState(e.cloner,t),this.updateVisible(t.scene)),this.updateTransformState(e,t)}get attachedSurfaceCloners(){return this.children.filter((e=>e instanceof FT.Cloner&&"toObject"===e.parameters.type))}setFromClonerState(e,t){this.disposed||(null===e||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):void 0===this.cloner?(this.cloner=new FT.Cloner(this,e),t.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,t.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}requestRender(){this.dispatchEvent({type:"requestRender"})}},YT=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r,a,s;let o=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},e.parameters);o.thetaLength=Uo.clamp(o.thetaLength,0,360);let l=o.width/2,c=null!==(n=o.radiusTop)&&void 0!==n?n:l,h=null!==(r=o.radiusBottom)&&void 0!==r?r:l;return c===h?(c=l,h=l):c>h?(c=l,h=h*l/c):(c=c*l/h,h=l),{parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(a=o.height)&&void 0!==a?a:o.width),depth:Math.abs(null!==(s=o.depth)&&void 0!==s?s:o.width),radiusTop:c,radiusBottom:h})}}static build(e){let t,{width:i,depth:n,height:r,radialSegments:a,heightSegments:s,openEnded:o,thetaStart:l,thetaLength:c,radiusTop:h,radiusBottom:d,cornerRadius:u,cornerSegments:p,hollow:f}=e.parameters;return 0===c?(t=new Wc,t.setAttribute("position",new Bc([],3))):t=u||f?new ZT(h,d,r,a,s,o,l,c*Math.PI/180,u,u,p,f):new tf(h,d,r,a,s,o,l,c*Math.PI/180),t.scale(1,1,n/i),Object.assign(t,{userData:{...e,type:"CylinderGeometry"}})}};function QT(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function KT(e){return new jo(e.y,-e.x)}var ZT=class extends Wc{constructor(e,t,i,n,r,a,s,o,l,c,h,d){let u=arguments.length>12&&void 0!==arguments[12]&&arguments[12];super(),this.type="RoundedCylinderBufferGeometry",e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,a=void 0!==a&&a,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI,a&&(l=0,c=0);let p=[],f=[],m=[],g=[],v=0,y=i/2,b=new gl,x=new gl;u&&0==e&&(e=l),u&&0==t&&(t=c);let w=new jo(e,y),_=new jo(t,-y),S=null,A=null,E=null,C=null,M=w.clone().sub(_),P=0,T=0,D=0;d>0&&(P=Math.min(e,t)*(1-d),T=e-P,D=t-P);let R=w.clone();R.x-=P;let O=Math.PI-M.angle(),I=M.angle(),k=Math.tan(I/2),L=Math.tan(O/2),F=k+L,B=d?F:L,N=d?F:k;if(l=Math.min(l,(e-T)/B,M.length()/F),c=Math.min(c,(t-D)/N,M.length()/F),l>0){let e=l/k;S=w.clone().sub(new jo(e,l)),d&&(E=S.clone(),E.x-=P-F*l),w.sub(M.clone().setLength(e))}if(c>0){let e=c/L;A=_.clone().sub(new jo(e,-c)),_.add(M.clone().setLength(e)),d&&(C=A.clone(),C.x-=P-F*c,R.sub(M.clone().setLength(e)))}M=w.clone().sub(_);let z=M.length()<.5,U=[];for(let H=0;H<=n;H++){let h=[],u=H/n,p=u*o+s,y=new jo(Math.sin(p),Math.cos(p));if(C&&A?(j(h,u,y,O,c,C,-1,!0),j(h,u,y,I,c,A,-1,!1)):A?(V(h,y,A.x,0,-1),j(h,u,y,I,c,A,-1,!1)):a||V(h,y,t,D,-1),QT(KT(M).normalize(),y,b),!z)for(let e=0;e<=r;e++){let t=e/r;QT(M.clone().multiplyScalar(t).add(_),y,x),f.push(x.x,x.y,x.z),m.push(b.x,b.y,b.z),g.push(u,.5+x.y/i),h.push(v++)}if(E&&S?(j(h,u,y,O,l,S,1,!1),j(h,u,y,I,l,E,1,!0)):S?(j(h,u,y,O,l,S,1,!1),V(h,y,S.x,0,1)):a||V(h,y,e,T,1),d&&!z){QT(KT(M).multiplyScalar(-1).normalize(),y,b);for(let e=0;e<=r;e++){let t=e/r;QT(M.clone().multiplyScalar(-t).add(R),y,x),f.push(x.x,x.y,x.z),m.push(b.x,b.y,b.z),g.push(u,.5+x.y/i),h.push(v++)}}d&&!a&&h.push(h[0]),U.push(h)}for(let H=0;H<U.length-1;H++)for(let e=0;e<U[0].length-1;e++){if(a&&d&&e==r)continue;let t=U[H][e],i=U[H+1][e],n=U[H+1][e+1],s=U[H][e+1],o=f[3*n+0],l=f[3*n+2];p.push(t,i,s),(0!=o||0!=l)&&p.push(i,n,s)}function j(e,t,n,r,a,s,o,l){for(let c=0;c<h+1;c++){let d=c/h,u=o<0?d:1-d;l&&(u-=1),u*=r;let p=new jo(Math.sin(u),Math.cos(u)*o);QT(p.clone().multiplyScalar(a).add(s),n,x),f.push(x.x,x.y,x.z),QT(p,n,b),m.push(b.x,b.y,b.z),g.push(t,.5+x.y/i),e.push(v++)}}function V(e,t,i,n,r){let a=new gl,s=new jo,o=[i,n];r<0&&o.reverse();for(let l of o)s.set(l,y*r),QT(s,t,a),f.push(a.x,a.y,a.z),m.push(0,r,0),g.push(.5,.5),e.push(v++)}function G(i,n,r){let a=new jo(Math.sin(r),Math.cos(r)),s=new jo(-Math.cos(r),Math.sin(r)),o=new gl,l=i<0?(e,t,i)=>p.push(e,t,i):(e,t,i)=>p.push(e,i,t);QT(new jo((e+t+T+D)/4,0),a,o),f.push(o.x,o.y,o.z),m.push(s.x,0,s.y),g.push(.5,.5);let c=v++;for(let e of n){let t=f.slice(3*e,3*e+3);f.push(...t),m.push(s.x,0,s.y);let i=g.slice(2*e,2*e+2);g.push(...i),v++}for(let e=c+1;e<v-1;e++)l(c,e,e+1);l(c,v-1,c+1)}o<2*Math.PI&&(G(-1,U[0],s),G(1,U[U.length-1],s+o)),this.setIndex(p),this.setAttribute("position",new Bc(f,3)),this.setAttribute("normal",new Bc(m,3)),this.setAttribute("uv",new Bc(g,2))}},JT=Math.PI/2,$T=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:4;super(),this.type="BoxGeometry",n=Math.floor(n),r=Math.floor(r),a=Math.floor(a),o=Math.floor(o),s=Math.min(s,e/2,t/2,i/2);let l=[],c=[],h=[],d=[],u=0;function p(e,t,i,n,r,a,o,p,f,m){let g=(a-2*s)/f,v=(o-2*s)/m,y=a/2-s,b=o/2-s,x=p/2,w=f+1,_=m+1,S=0,A=new gl;for(let s=0;s<_;s++){let a=s*v-b;for(let o=0;o<w;o++){let l=o*g-y;A[e]=l*n,A[t]=a*r,A[i]=x,c.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[i]=p>0?1:-1,h.push(A.x,A.y,A.z),d.push(o/f),d.push(1-s/m),S+=1}}for(let s=0;s<m;s++)for(let e=0;e<f;e++){let t=u+e+w*s,i=u+e+w*(s+1),n=u+(e+1)+w*(s+1),r=u+(e+1)+w*s;l.push(t,i,r),l.push(i,n,r)}u+=S}function f(e,t,i,n,r,a,p,f,m,g){let v=(p-2*s)/g,y=p/2-s,b=f/2-s,x=m/2,w=g+1,_=0,S=new gl,A=new gl;for(let l=0;l<o+1;l++){let u=l/o*JT,p=Math.sin(u)*s,f=(1-Math.cos(u))*s,m=Math.sin(u),E=Math.cos(u);S[t]=(b+p)*r,S[i]=(x-f)*a,A[e]=0,A[t]=m*Math.sign(S[t]),A[i]=E*Math.sign(S[i]);for(let t=0;t<w;t++){let i=t*v-y;S[e]=i*n,c.push(S.x,S.y,S.z),h.push(A.x,A.y,A.z),d.push(t/g),d.push(0),_+=1}}for(let s=0;s<o;s++)for(let e=0;e<g;e++){let t=u+e+w*s,i=u+e+w*(s+1),n=u+(e+1)+w*(s+1),r=u+(e+1)+w*s;l.push(t,i,r),l.push(i,n,r)}u+=_}function m(n,r,a){let p=new gl,f=new gl(e/2,t/2,i/2);f.subScalar(s);let m=[],g=n*r*a>0?(e,t,i)=>l.push(e,t,i):(e,t,i)=>l.push(e,i,t);for(let e=0;e<=o;e++){let t=[],i=JT*(1-e/o),l=Math.cos(i),g=Math.sin(i),v=0;for(let o=0;o<=e;o++){let i=Math.cos(v),o=Math.sin(v);p.x=l*i,p.y=g,p.z=l*o;let m=f.clone().addScaledVector(p,s);c.push(n*m.x,r*m.y,a*m.z),h.push(n*p.x,r*p.y,a*p.z),d.push(0,0),t.push(u++),v+=JT/e}m.push(t)}let v=m.length-1;for(let e=0;e<v;e++){let t=m[e],i=m[e+1],n=t.length-1;g(t[0],i[1],i[0]);for(let e=1;e<=n;e++)g(t[e-1],t[e],i[e]),g(t[e],i[e+1],i[e])}}p("z","y","x",-1,-1,i,t,e,a,r),p("z","y","x",1,-1,i,t,-e,a,r),p("x","z","y",1,1,e,i,t,n,a),p("x","z","y",1,-1,e,i,-t,n,a),p("x","y","z",1,-1,e,t,i,n,r),p("x","y","z",-1,-1,e,t,-i,n,r),s>0&&(f("z","y","x",-1,-1,1,i,t,e,a),f("z","y","x",1,-1,-1,i,t,e,a),f("z","y","x",-1,1,-1,i,t,e,a),f("z","y","x",1,1,1,i,t,e,a),f("x","y","z",-1,-1,-1,e,t,i,n),f("x","y","z",1,-1,1,e,t,i,n),f("x","y","z",-1,1,1,e,t,i,n),f("x","y","z",1,1,-1,e,t,i,n),f("y","x","z",-1,-1,1,t,e,i,r),f("y","x","z",1,-1,-1,t,e,i,r),f("y","x","z",1,1,1,t,e,i,r),f("y","x","z",-1,1,-1,t,e,i,r),m(1,1,1),m(-1,1,1),m(1,-1,1),m(-1,-1,1),m(1,1,-1),m(-1,1,-1),m(1,-1,-1),m(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new Bc(c,3)),this.setAttribute("normal",new Bc(h,3)),this.setAttribute("uv",new Bc(d,2))}},eD=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;super(),this.type="PolyhedronGeometryRound";let s=[],o=[],l=[];return function(){r=Math.min(.99999,r),0==r&&(a=0);let o={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],c=new gl,h=c.clone(),d=new Pc,u=r*n,p=n-u,f=a+1,m=new gl,g=(e,t)=>m.subVectors(e,t).normalize(),v=(e,t)=>Array(e).fill(void 0).map(t),y=v(e.length/3,((t,i)=>(new gl).fromArray(e,3*i).setLength(n))),b=[],x=1e6;for(let e=0;e<y.length;e++){let i,n,r,a=y[e],s=[],o=1e10,l=-1;for(;-1!=(l=t.indexOf(e,l+1));){let e=l-l%3;i=t[e+(l+1)%3],n=t[e+(l+2)%3],r=a.distanceToSquared(y[i]),o=Math.min(o,r),s.push([i,n,r])}o+=1e-6;let c=[],h=0,d=s.length;for(let t=0;t<d;t++){var w;[i,n,r]=s[h];let t=1==(null===(w=b[i])||void 0===w?void 0:w.includes(e));r<=o&&c.push(i+ +t*x),h=s.findIndex((e=>e[0]==n))}b.push(c)}let _=[];{let e,t,i=0,n=0,r=3==o;for(let s=0;s<=a;s++){e=s*(s+1)/2,t=(s+1)*(s+2)/2;for(let o=0;o<a-s;o++)[i,n]=[e+o+s+2,t+o+s+3],_.push(e,t,...r?[n,e]:[i,t],n,i),[e,t]=[i,n];_.push(e,t,e+a+2)}}let S=c.clone(),A=c.clone(),E=c.clone(),C=c.clone(),M=c.clone(),P=[],T=v(y.length,(()=>v(o,(()=>c.clone()))));for(let e=0;e<y.length;e++){c.copy(y[e]).normalize(),S.copy(c).multiplyScalar(p);let t=b[e];for(let a=0;a<t.length;a++){let i=t[a],n=t[(a+1)%o];d.setFromPointsAndIndices(y,e,i%x,n%x),d.b.sub(d.a).setLength(1e10).add(d.a),d.c.sub(d.a).setLength(1e10).add(d.a),d.closestPointToPoint(S,T[e][a])}let i=[],n=[],r=[],v=new gl;0==a&&[...T[e]].reduce(((e,t)=>e.add(t)),v).multiplyScalar(1/o);for(let s=0;s<o;s++){let t=[],l=(s-1+o)%o,d=T[e][l],y=T[e][s];c.copy(d).sub(S),h.copy(y).sub(S);let b=S.angleTo(c),x=c.angleTo(h),w=Math.cos(b)*u;0==a?A.copy(v):A.copy(S).setLength(p+w),n.push(w);let _=[A,d,y];for(let e=0;e<2;e++){let n=_[e],r=_[e+1];C.subVectors(n,S),M.subVectors(r,S),E.crossVectors(C,M).normalize();for(let a=0;a<f;a++){let r=[b,x][e]*a/f;c.copy(C).applyAxisAngle(E,r).add(S),i.push(c.clone()),e&&(g(c,S),t.push([0==a?n:c.clone(),m.clone()]))}e&&(g(r,S),t.push([r,m.clone()]))}r.push(t)}P.push(r);let w=2*f,D=2;for(let e=0;e<o;e++){let t=w*e,r=w*((e+1)%o),a=[i[t]];for(let s=1;s<f;s++){C=i[t+s],M=i[r+s],a.push(C);for(let t=1,i=s-D+1;t<=i;t++)c.lerpVectors(C,M,t/(i+1)),c.sub(S).setLength(n[e]).add(S),a.push(c.clone());a.push(M)}for(let e=0;e<f;e++)a.push(i[e+f+t]);a.push(i[r+f]);let h=_.map((e=>a[e]));s.push(...h.map((e=>[e.x,e.y,e.z])).flat()),l.push(...h.map((e=>(g(e,S),[m.x,m.y,m.z]))).flat())}}let D=[];for(let e=0;e<b.length;e++)for(let t=0;t<o;t++){let i=b[e][t];if(i<x){let n=b[i].findIndex((t=>t%x==e)),r=P[e][t],a=P[i][n];for(let e=0;e<f;e++){let t=r[e],i=a[f-e],n=r[e+1];[t,i,n,n,i,a[f-(e+1)]].forEach((e=>{s.push(e[0].x,e[0].y,e[0].z),l.push(e[1].x,e[1].y,e[1].z)}))}D.push(r[0][0],a[f][0],r[f][0],a[0][0])}}for(;D.length;){let e,t,i,n;[e,t]=D.splice(0,2);let r=[e];for(;e!=t;)r.push(t),i=D.indexOf(t),n=i%2,t=D.splice(i-n,2)[1-n];m.subVectors(r[0],r[1]).cross(c.subVectors(r[0],r[2])).normalize();let a=m.dot(r[0])<0;a&&m.negate();for(let o=1;o<=r.length-2;o++)[r[o+ +a],r[o+1-+a],r[0]].forEach((e=>{s.push(e.x,e.y,e.z),l.push(m.x,m.y,m.z)}))}}(),function(){let e=new gl;for(let p=0;p<s.length;p+=3){e.x=s[p+0],e.y=s[p+1],e.z=s[p+2];let t=d(e)/2/Math.PI+.5,i=u(e)/Math.PI+.5;o.push(t,1-i)}let t=new gl,i=new gl,n=new gl,r=new gl,a=new jo,l=new jo,c=new jo,h=(e,t,i,n)=>{n<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=n/2/Math.PI+.5)};for(let p=0,f=0;p<s.length;p+=9,f+=6){t.set(s[p+0],s[p+1],s[p+2]),i.set(s[p+3],s[p+4],s[p+5]),n.set(s[p+6],s[p+7],s[p+8]),a.set(o[f+0],o[f+1]),l.set(o[f+2],o[f+3]),c.set(o[f+4],o[f+5]),r.copy(t).add(i).add(n).divideScalar(3);let e=d(r);h(a,f+0,t,e),h(l,f+2,i,e),h(c,f+4,n,e)}for(let s=0;s<o.length;s+=6){let e=o[s+0],t=o[s+2],i=o[s+4],n=Math.max(e,t,i),r=Math.min(e,t,i);n>.9&&r<.1&&(e<.2&&(o[s+0]+=1),t<.2&&(o[s+2]+=1),i<.2&&(o[s+4]+=1))}function d(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}}(),this.setAttribute("position",new Bc(s,3)),this.setAttribute("normal",new Bc(l,3)),void this.setAttribute("uv",new Bc(o,2))}static fromJSON(e){return new eD(e.vertices,e.indices,e.radius,e.corner,e.cornerSides)}},tD=class extends eD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=(1+Math.sqrt(5))/2,r=1/n,a="DodecahedronGeometry";super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],a,e,t,i),this.type=a}static fromJSON(e){return new tD(e.radius,e.corner,e.cornerSides)}},iD=1e-12,nD=class{constructor(e){this.position=new jo,this.startPosition=new jo,this.uuid=Uo.generateUUID(),this.position=e.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(e){this.position.copy(this.startPosition).add(e)}copy(e){return this.position.copy(e.position),this.startPosition.copy(e.startPosition),this}clone(){return new nD(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},rD=class extends nD{constructor(e){super(e.position),this.parent=e}copy(e){return super.copy(e),this}clone(){return new rD(this.parent).copy(this)}},aD=class extends nD{constructor(e,t){super(t),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=e,this.controls.push(new rD(this),new rD(this))}static create(e,t){let i=new aD(e,new jo(...t.position));return i.controls[0].position.set(...t.controlPrevious.position),i.controls[1].position.set(...t.controlNext.position),i.roundness=t.roundness,i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored,i}getOppositeControl(e){let t=this.controls.indexOf(e);return 0===t?this.controls[1]:1===t?this.controls[0]:null}applyOffsetToControls(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let i=0,n=this.controls.length;i<n;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=t?n.position.copy(this.position):n.applyOffset(e)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(e){return super.copy(e),this.controls[0].copy(e.controls[0]),this.controls[1].copy(e.controls[1]),this.roundness=e.roundness,this.uuid=e.uuid,this}clone(){return new aD(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){var e,t;return[null===(e=this.curveBefore)||void 0===e?void 0:e.getTangentAt(1),null===(t=this.curveAfter)||void 0===t?void 0:t.getTangentAt(0)]}computeNormals(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,[i,n]=this.computeTangents();return i&&n&&(sD(i,e),sD(n,t)),[e,t]}computeTangent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,[t,i]=this.computeTangents();return t&&i&&e.copy(t).add(i).normalize(),e}computeNormal(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,[t,i]=this.computeNormals();return e.copy(t).add(i).normalize(),e}};function sD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo,i=e.length();return t.set(-e.y/i,e.x/i)}var oD=new jo,lD=new jo,cD=new jo,hD=new jo,dD=new jo,uD=new jo,pD=new gl,fD=new gl;function mD(e){let t=new jo;t.addVectors(e.v0,oD.subVectors(e.v1,e.v0).multiplyScalar(2/3));let i=new jo;return i.addVectors(e.v2,lD.subVectors(e.v1,e.v2).multiplyScalar(2/3)),new Wp(e.v0,t,i,e.v2)}function gD(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e-t)<i}function vD(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<i}function yD(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return e.distanceTo(t)<i}function bD(e,t,i){let n=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)),a=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));return Math.acos((r*r+n*n-a*a)/(2*r*n))}function xD(e,t,i){return CD(e,t)&&CD(t,i)&&wD(e.position,t.position,i.position)}function wD(e,t,i){return 0===oD.copy(t).sub(e).cross(lD.copy(i).sub(e))}function _D(e,t,i,n,r){let a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=(e.y+t.y)/2,o=(e.x+t.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(a/2,2))*(e.y-t.y)/a,c=Math.sqrt(Math.pow(i,2)-Math.pow(a/2,2))*(t.x-e.x)/a;return n.set(o+l,s+c),r.set(o-l,s-c),[n,r]}function SD(e,t,i){return e.distanceTo(i)<t.distanceTo(i)?t:e}function AD(e,t,i,n,r,a){let s,o=t.x-e.x,l=t.y-e.y,c=i.x-e.x,h=i.y-e.y,d=Math.sqrt((o+c)*(o+c)+(l+h)*(l+h));return bD(t,e,i)>Math.PI&&(d*=-1),s=gD(h,l)?(l+h)*(n/d-.5)*8/3/(o-c):(o+c)*(n/d-.5)*8/3/(h-l),r.set(t.x-s*l,t.y+s*o),a.set(i.x+s*h,i.y-s*c),[r,a]}function ED(e,t){return e.position.equals(e.controls[1].position)&&t.position.equals(t.controls[0].position)}function CD(e,t){return wD(e.position,e.controls[1].position,t.position)&&wD(e.position,t.controls[0].position,t.position)}function MD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[];for(let r=0,a=e.length;r<a;r++){let a=e[r],s=0;if(i&&void 0!==a.roundedCurveCorner){let e=.5*PD(a.roundedCurveCorner,t);r>0&&(n[r-1]+=e),s+=e}void 0!==a.curveAfter&&(s+=PD(a.curveAfter,t)),n.push(s)}return e.length>0&&i&&void 0!==e[0].roundedCurveCorner&&(n[e.length-1]+=.5*PD(e[0].roundedCurveCorner,t)),n}function PD(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return e&&e instanceof Fp?2*t:e&&(e instanceof Xp||e instanceof Yp)?1:e&&e instanceof Kp?t*e.points.length:t}var TD,DD,RD,OD=new jo,ID=new jo,kD=new jo,LD=new jo,FD=new jo,BD=new jo,ND=class extends sf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;super(),this.points=[],this.shapeHoles=[],this.plane=new _h(new gl(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Uo.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=e,this._height=t}static createFromState(e,t,i){let n=new ND;return n.isClosed=e.isClosed,n.points=e.points.map((e=>aD.create(e.id,e.data))),"number"==typeof e.roundness&&(n.roundness=e.roundness),n.shapeHoles=e.shapeHoles.map((e=>ND.createFromState(e))),void 0!==t&&void 0!==i&&n.applySize(t,i),n.update(),n}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(e){if(this._roundness!==e){this._roundness=e;for(let t=0,i=this.points.length;t<i;t++)this.points[t].roundness=e;this.needsUpdate=!0}}getPointsIndexesByIds(e){return e.map((e=>this.getPointIndexById(e))).filter((e=>e>=0))}getPointIndexById(e){let t=this.points.length,i=this.points.findIndex((t=>t.uuid===e));if(i<0){let i=t;for(let t=0,n=this.shapeHoles.length;t<n;t++){let n=this.shapeHoles[t],r=n.points.length,a=n.getPointIndexById(e);if(!(a<0))return a+i;i+=r}}return i}getLineIndexById(e){return this.getPointIndexById(e)}getBezierPoint(e){if(e<=this.points.length-1)return this.points[e];if(this.shapeHoles.length>0){let t=this.points.length;for(let i=0,n=this.shapeHoles.length;i<n;i++){let n=this.shapeHoles[i],r=e-t;if(r<=n.points.length-1)return n.points[r];t+=n.points.length}}throw new Error("This shape does not have a point for this index: "+e)}getBezierPointIndex(e){let t=this.points.indexOf(e);if(t>=0)return t;if(t=this.points.length,this.shapeHoles.length>0)for(let i=0,n=this.shapeHoles.length;i<n;i++){let n=this.shapeHoles[i],r=n.points.indexOf(e);if(r>=0)return t+r;t+=n.points.length}return-1}getAllPoints(){let e=[].concat(...this.shapeHoles.map((e=>e.points)));return[...this.points,...e]}applySize(e,t){0===e&&(e=.001),0===t&&(t=.001),this._width=e,this._height=t}applyScale(e,t){let i=OD.set(e,t);for(let n=0,r=this.points.length;n<r;n++){let e=this.points[n];e.position.multiply(i),e.controls[0].position.multiply(i),e.controls[1].position.multiply(i)}for(let n=0,r=this.shapeHoles.length;n<r;n++)this.shapeHoles[n].applyScale(e,t);this._update()}createPoint(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Uo.generateUUID();t=e instanceof jo?e:new jo(e,i);let r=new aD(n,t);return r.roundness=this.roundness,r}addPoint(e){this.points.push(e),this.needsUpdate=!0}addPointAt(e,t){this.points.splice(t,0,e),this.needsUpdate=!0}getPointByUuid(e){for(let t=0,i=this.points.length;t<i;t++){let i=this.points[t];if(i.uuid===e)return i}for(let t=0,i=this.shapeHoles.length;t<i;t++){let i=this.shapeHoles[t].getPointByUuid(e);if(i)return i}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(e){let t=this.points.indexOf(e);t>=0&&this.points.splice(t,1),this.needsUpdate=!0}removePointById(e){let t=this.points.find((t=>t.uuid===e));t&&this.removePoint(t)}update(){for(let e=0,t=this.shapeHoles.length;e<t;e++)this.shapeHoles[e].update();this._update()}extractShapePointsToBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t);let n=i?this.roundedCurveDivisions:this.curveDivisions;return function(e,t){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=fD.set(0,0,0),s=0,o=[];for(let l=0;l<t.length;l++){let r=t[l],c=oD,h=PD(r,n);o.push(h);for(let t=0;t<=h;t++)if(r instanceof Wp||r instanceof Qp||r instanceof Xp){if(r.getPoint(t/h,c),a.set(c.x,c.y,0),void 0!==i&&yD(i,a))continue;void 0===i&&(i=pD),i.copy(a),e.setXYZ(s,a.x,a.y,a.z),s++}}r&&s>1&&!(e.getX(s-1)===e.getX(0)&&e.getY(s-1)===e.getY(0)&&e.getZ(s-1)===e.getZ(0))&&(e.setXYZ(s,e.getX(0),e.getY(0),e.getZ(0)),s++)}(e,i?this.roundedCurves:this.curves,t,this.autoClose),n.reduce(((e,t)=>e+t),0)+1}computeCurveDivisions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12;return this.curveDivisions=MD(this.points,e,!1),this.roundedCurveDivisions=MD(this.points,e,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12;return 2*function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=fD.set(0,0,0),s=0,o=[];for(let c=0;c<t.length;c++){if(!1===i[c])continue;let r,h=t[c],d=oD,u=PD(h,n);o.push(u);for(let t=0;t<=u;t++)if(h instanceof Wp||h instanceof Qp||h instanceof Xp){var l;if(h.getPoint(t/u,d),a.set(d.x,d.y,0),null!==(l=r)&&void 0!==l&&l.equals(a))continue;void 0===r?r=pD:(e.setXYZ(s,r.x,r.y,r.z),s++,e.setXYZ(s,a.x,a.y,a.z),s++),r.copy(a)}}return r&&s>1&&!(e.getX(s-1)===e.getX(0)&&e.getY(s-1)===e.getY(0)&&e.getZ(s-1)===e.getZ(0))&&(e.setXYZ(s,e.getX(0),e.getY(0),e.getZ(0)),s++),o}(e,this.curves,t,i,this.autoClose).reduce(((e,t)=>e+t),0)}extractShapePointsToFlatArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;return this.subdivision=t,void 0===this.curveDivisions&&this.computeCurveDivisions(t),function(e,t){let i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=0;for(let s=0;s<t.length;s++){let r=t[s],o=PD(r,n),l=oD;for(let t=0;t<=o;t++)if(r instanceof Wp||r instanceof Qp||r instanceof Xp){if(r.getPoint(t/o,l),void 0!==i&&vD(i,l,iD))continue;void 0===i&&(i=lD),i.copy(l),e.push(l.x,l.y),a++}}return gD(e[0],e[e.length-2],iD)&&gD(e[1],e[e.length-1],iD)&&(e.pop(),e.pop()),r&&a>1&&!(gD(e[a-1],e[1],iD)&&gD(e[a-2],e[0],iD))&&(e.push(e[0],e[1]),a++),e}(e,this.roundedCurves,t,this.autoClose)}getCurveIndexFromVertexId(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=0;void 0===this.curveDivisions&&this.computeCurveDivisions(this.subdivision);let n=t?this.roundedCurveDivisions:this.curveDivisions,r=0;t&&void 0!==this.points[0].roundedCurveCorner&&(r=.5*PD(this.points[0].roundedCurveCorner,this.subdivision));let a=e-r;a<0&&(a+=n.reduce(((e,t)=>e+t),0));for(let s=0,o=n.length;s<o;s++){let e=n[s];if(a<i+e)return[s,(a-i+1)/e];i+=e}return[0,1]}getCurveT(e,t,i){let n=this.points[e],r=this.points[e>=this.points.length-1?0:e+1],a=this.curveDivisions,s=a[e];if(ED(n,r)){let e=n.position.distanceTo(r.position);return n.position.distanceTo(OD.set(i.x,i.y))/e}let o=0;for(let l=0;l<e;l++)o+=a[l];return(t-o)/s}dispose(){}_applyCurveForPoint(e,t){ED(t,e)?this.lineTo(e.position.x,e.position.y):this.bezierCurveTo(t.controls[1].position.x,t.controls[1].position.y,e.controls[0].position.x,e.controls[0].position.y,e.position.x,e.position.y);let i=this.curves[this.curves.length-1];e.curveBefore=i,t.curveAfter=i;let n=i.clone();e.roundedCurveBefore=n,t.roundedCurveAfter=n,e.roundedCurveCorner=void 0,this.roundedCurves.push(n)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let n=0,r=this.points.length;n<r;n++){let e=this.points[n];if(0===n)this.moveTo(e.position.x,e.position.y);else{let t=this.points[n-1];this._applyCurveForPoint(e,t)}}let e=this.getLastPoint();if(null!==e&&void 0!==e&&e.curveAfter&&(e.curveAfter=void 0),this.isClosed){let e=this.points[0],t=this.points[this.points.length-1];this._applyCurveForPoint(e,t)}if(this.points.length>2){let e=0;for(let n=0,r=this.points.length;n<r;n++){var t,i;let r=this.points[n],a=null!==(t=this.points[n-1])&&void 0!==t?t:this.points[this.points.length-1],s=null!==(i=this.points[n+1])&&void 0!==i?i:this.points[0],o=r.roundness,l=a&&s&&xD(a,r,s);if(!r.controlsMoved()&&o>0&&!l){let t=r.curveBefore,i=r.curveAfter;if(void 0===t||void 0===i)continue;let a,s=r.roundedCurveBefore,l=r.roundedCurveAfter,c=t.getLength(),h=i.getLength(),d=Math.min(o,.499*c),u=Math.min(o,.499*h),p=Math.min(d,u),f=1-p/c,m=p/h,g=t.getPointAt(f,OD),v=i.getPointAt(m,ID);if(this._subSplitCurve(t,s,f,g,void 0),this._subSplitCurve(i,l,m,void 0,v),this.useCubicForRoundedCorners){let e=bD(g,r.position,v)/2,t=Math.tan(e)*g.distanceTo(r.position),[i,n]=_D(g,v,t,kD,LD),s=SD(i,n,r.position),[o,l]=AD(s,g,v,t,FD,BD);a=new Wp(g.clone(),o.clone(),l.clone(),v.clone())}else a=new Qp(g.clone(),r.position.clone(),v.clone());r.roundedCurveCorner=a,this.roundedCurves.splice(n+e,0,a),e++}}}}_subSplitCurve(e,t,i,n,r){if(!(e instanceof Xp)){let a=e,s=t,o=a.getUtoTmapping(i,0),l=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,a=oD.subVectors(t,e).multiplyScalar(r).add(e),s=lD.subVectors(i,t).multiplyScalar(r).add(t),o=cD.subVectors(n,i).multiplyScalar(r).add(i),l=a,c=hD.subVectors(s,a).multiplyScalar(r).add(a),h=dD.subVectors(o,s).multiplyScalar(r).add(s),d=o,u=uD.subVectors(h,c).multiplyScalar(r).add(c);return[e.x,e.y,l.x,l.y,c.x,c.y,u.x,u.y,h.x,h.y,d.x,d.y,n.x,n.y]}(a.v0,a.v1,a.v2,a.v3,o);return void 0!==n&&(s.v0.set(l[0],l[1]),s.v1.set(l[2],l[3]),s.v2.set(l[4],l[5]),s.v3.set(l[6],l[7])),void 0!==r&&(s.v0.set(l[6],l[7]),s.v1.set(l[8],l[9]),s.v2.set(l[10],l[11]),s.v3.set(l[12],l[13])),s}return void 0!==n&&t.v2.copy(n),void 0!==r&&t.v1.copy(r),t}clone(){let e=new ND(this._width,this._height);return e.points=this.points.map((e=>e.clone())),e.isClosed=this.isClosed,e.roundness=this.roundness,e.isMesh2D=this.isMesh2D,e.shapeHoles=this.shapeHoles.map((e=>e.clone())),e}toJSON(){return{points:this.points.reduce(((e,t)=>e.concat(t.toJSON())),[]),shapeHoles:this.shapeHoles.map((e=>e.toJSON())),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(e){var t;this.points=[],this.pointIDs=0;let i=e.points.length/7;for(let n=0;n<i;n++){let t=7*n,i=e.points[t+0],r=e.points[t+1],a=e.points[t+2],s=e.points[t+3],o=e.points[t+4],l=e.points[t+5],c=e.points[t+6],h=new aD(Uo.generateUUID(),new jo(i,r));h.controls[0].position.set(a,s),h.controls[1].position.set(o,l),h.roundness=c,this.points.push(h)}return this.shapeHoles=null!==(t=e.shapeHoles)&&void 0!==t&&t.length?e.shapeHoles.map((e=>{let t=new ND;return t.fromJSON(e),t})):[],this.isClosed=e.isClosed,this._roundness=e.roundness,this._update(),this}fromShape(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.isText=t;let i=(e,t)=>{t instanceof Wp&&t.v3.equals(e.position)&&e.controls[0].position.copy(t.v2)};return this.points=(e=>{let t,n,r=[];for(t=0,n=e.length;t<n;t++)e[t]instanceof Qp&&(e[t]=mD(e[t]));for(t=0,n=e.length;t<n;t++){let n,a=e[t],s=t>0?e[t-1]:null;a instanceof Wp?(n=this.createPoint(a.v0),n.controls[1].position.copy(a.v1)):a instanceof Xp&&(n=this.createPoint(a.v1)),void 0!==n&&(null!==s&&i(n,s),r.push(n))}let a=e[e.length-1],s=!1;return a instanceof Wp?a.v3.equals(r[0].position)&&(r[0].controls[0].position.copy(a.v2),s=!0):a instanceof Xp&&a.v2.equals(r[0].position)&&(s=!0),this.isClosed=s,r})(e.curves),e instanceof sf&&(this.shapeHoles=e.holes.map((e=>{let t=new ND;return t.fromShape(e),t}))),this.update(),this}updatePoint(e,t){let i=this.getPointByUuid(e);i&&(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.roundness&&(i.roundness=t.roundness),void 0!==t.areControlsDirectionsMirrored&&(i.areControlsDirectionsMirrored=t.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(e,t){var i;let n=null===(i=this.getPointByUuid(e))||void 0===i?void 0:i.controls[0];n&&(t.position&&n.position.fromArray(t.position),this.needsUpdate=!0)}updateNextControl(e,t){var i;let n=null===(i=this.getPointByUuid(e))||void 0===i?void 0:i.controls[1];n&&(t.position&&n.position.fromArray(t.position),this.needsUpdate=!0)}},zD=2*Math.PI;function UD(e,t,i,n,r){let{x:a,y:s}=e;return{x:a*t+n,y:s*i+r}}function jD(e,t){let i=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:1.3333333333333333*Math.tan(t/4),n=Math.cos(e),r=Math.sin(e),a=Math.cos(e+t),s=Math.sin(e+t);return[{x:n-r*i,y:r+n*i},{x:a+s*i,y:s-a*i},{x:a,y:s}]}function VD(e,t,i,n){let r=e*n-t*i<0?-1:1,a=Math.min(1,Math.max(-1,e*i+t*n));return r*Math.acos(a)}function GD(e){let{px:t,py:i,cx:n,cy:r,rx:a,ry:s,largeArcFlag:o,sweepFlag:l}=e,c=[];if(0===a||0===s)return[];let h=(t-n)/2,d=(i-r)/2;if(0===h&&0===d)return[];a=Math.abs(a),s=Math.abs(s);let u=Math.pow(h,2)/Math.pow(a,2)+Math.pow(d,2)/Math.pow(s,2);u>1&&(a*=Math.sqrt(u),s*=Math.sqrt(u));let p=function(e,t,i,n,r,a,s,o,l,c){let h=Math.pow(r,2),d=Math.pow(a,2),u=Math.pow(s,2),p=Math.pow(o,2),f=h*d-h*p-d*u;f<0&&(f=0),f/=h*p+d*u,f=Math.sqrt(f)*(l===c?-1:1);let m=f*r/a*o,g=f*-a/r*s,v=m+(e+i)/2,y=g+(t+n)/2,b=(s-m)/r,x=(o-g)/a,w=(-s-m)/r,_=(-o-g)/a,S=VD(1,0,b,x),A=VD(b,x,w,_);return!c&&A>0&&(A-=zD),c&&A<0&&(A+=zD),{centerx:v,centery:y,ang1:S,ang2:A}}(t,i,n,r,a,s,h,d,o,l),{ang1:f,ang2:m}=p,{centerx:g,centery:v}=p,y=Math.abs(m)/(zD/4);Math.abs(1-y)<1e-7&&(y=1);let b=Math.max(Math.ceil(y),1);m/=b;for(let x=0;x<b;x++)c.push(jD(f,m)),f+=m;return c.map((e=>{let{x:t,y:i}=UD(e[0],a,s,g,v),{x:n,y:r}=UD(e[1],a,s,g,v),{x:o,y:l}=UD(e[2],a,s,g,v);return{x1:t,y1:i,x2:n,y2:r,x:o,y:l}}))}function HD(e,t){if(!e)throw t||"Assertion Failed!"}(DD=TD||(TD={}))[DD.ODD=0]="ODD",DD[DD.NONZERO=1]="NONZERO",DD[DD.POSITIVE=2]="POSITIVE",DD[DD.NEGATIVE=3]="NEGATIVE",DD[DD.ABS_GEQ_TWO=4]="ABS_GEQ_TWO",function(e){e[e.POLYGONS=0]="POLYGONS",e[e.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",e[e.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"}(RD||(RD={}));var WD=function(){function e(){}return e.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.edgeGoesLeft=function(t){return e.vertLeq(t.Dst,t.Org)},e.edgeGoesRight=function(t){return e.vertLeq(t.Org,t.Dst)},e.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.edgeEval=function(t,i,n){HD(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,a=n.s-i.s;return r+a>0?r<a?i.t-t.t+(t.t-n.t)*(r/(r+a)):i.t-n.t+(n.t-t.t)*(a/(r+a)):0},e.edgeSign=function(t,i,n){HD(e.vertLeq(t,i)&&e.vertLeq(i,n));var r=i.s-t.s,a=n.s-i.s;return r+a>0?(i.t-n.t)*r+(i.t-t.t)*a:0},e.transEval=function(t,i,n){HD(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,a=n.t-i.t;return r+a>0?r<a?i.s-t.s+(t.s-n.s)*(r/(r+a)):i.s-n.s+(n.s-t.s)*(a/(r+a)):0},e.transSign=function(t,i,n){HD(e.transLeq(t,i)&&e.transLeq(i,n));var r=i.t-t.t,a=n.t-i.t;return r+a>0?(i.s-n.s)*r+(i.s-t.s)*a:0},e.vertCCW=function(e,t,i){return e.s*(t.t-i.t)+t.s*(i.t-e.t)+i.s*(e.t-t.t)>=0},e.interpolate=function(e,t,i,n){return(e=e<0?0:e)<=(i=i<0?0:i)?0===i?(t+n)/2:t+e/(e+i)*(n-t):n+i/(e+i)*(t-n)},e.intersect=function(t,i,n,r,a){var s,o,l;e.vertLeq(t,i)||(l=t,t=i,i=l),e.vertLeq(n,r)||(l=n,n=r,r=l),e.vertLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.vertLeq(n,i)?e.vertLeq(i,r)?((s=e.edgeEval(t,n,i))+(o=e.edgeEval(n,i,r))<0&&(s=-s,o=-o),a.s=e.interpolate(s,n.s,o,i.s)):((s=e.edgeSign(t,n,i))+(o=-e.edgeSign(t,r,i))<0&&(s=-s,o=-o),a.s=e.interpolate(s,n.s,o,r.s)):a.s=(n.s+i.s)/2,e.transLeq(t,i)||(l=t,t=i,i=l),e.transLeq(n,r)||(l=n,n=r,r=l),e.transLeq(t,n)||(l=t,t=n,n=l,l=i,i=r,r=l),e.transLeq(n,i)?e.transLeq(i,r)?((s=e.transEval(t,n,i))+(o=e.transEval(n,i,r))<0&&(s=-s,o=-o),a.t=e.interpolate(s,n.t,o,i.t)):((s=e.transSign(t,n,i))+(o=-e.transSign(t,r,i))<0&&(s=-s,o=-o),a.t=e.interpolate(s,n.t,o,r.t)):a.t=(n.t+i.t)/2},e}(),qD=function(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1},XD=function(){function e(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(e.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),e}(),YD=function(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0},QD=function(){function e(){var e=new YD,t=new qD,i=new XD(0),n=new XD(1);e.next=e.prev=e,e.anEdge=null,t.next=t.prev=t,i.next=i,i.Sym=n,n.next=n,n.Sym=i,this.vHead=e,this.fHead=t,this.eHead=i,this.eHeadSym=n}return e.prototype.makeEdge_=function(e){var t=new XD(0),i=new XD(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return i.next=n,n.Sym.next=t,t.next=e,e.Sym.next=i,t.Sym=i,t.Onext=t,t.Lnext=i,t.Org=null,t.Lface=null,t.winding=0,t.activeRegion=null,i.Sym=t,i.Onext=i,i.Lnext=t,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,t},e.prototype.splice_=function(e,t){var i=e.Onext,n=t.Onext;i.Sym.Lnext=t,n.Sym.Lnext=e,e.Onext=n,t.Onext=i},e.prototype.makeVertex_=function(e,t,i){var n=e;HD(n,"Vertex can't be null!");var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=t;var a=t;do{a.Org=n,a=a.Onext}while(a!==t)},e.prototype.makeFace_=function(e,t,i){var n=e;HD(n,"Face can't be null");var r=i.prev;n.prev=r,r.next=n,n.next=i,i.prev=n,n.anEdge=t,n.trail=null,n.marked=!1,n.inside=i.inside;var a=t;do{a.Lface=n,a=a.Lnext}while(a!==t)},e.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var t=e.next,i=e.Sym.next;t.Sym.next=i,i.Sym.next=t},e.prototype.killVertex_=function(e,t){var i=e.anEdge,n=i;do{n.Org=t,n=n.Onext}while(n!==i);var r=e.prev,a=e.next;a.prev=r,r.next=a},e.prototype.killFace_=function(e,t){var i=e.anEdge,n=i;do{n.Lface=t,n=n.Lnext}while(n!==i);var r=e.prev,a=e.next;a.prev=r,r.next=a},e.prototype.makeEdge=function(){var e=new YD,t=new YD,i=new qD,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(t,n.Sym,this.vHead),this.makeFace_(i,n,this.fHead),n},e.prototype.splice=function(e,t){var i=!1,n=!1;if(e!==t){if(t.Org!==e.Org&&(n=!0,this.killVertex_(t.Org,e.Org)),t.Lface!==e.Lface&&(i=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(t,e),!n){var r=new YD;this.makeVertex_(r,t,e.Org),e.Org.anEdge=e}if(!i){var a=new qD;this.makeFace_(a,t,e.Lface),e.Lface.anEdge=e}}},e.prototype.delete=function(e){var t=e.Sym,i=!1;if(e.Lface!==e.Rface&&(i=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!i){var n=new qD;this.makeFace_(n,e,e.Lface)}t.Onext===t?(this.killVertex_(t.Org,null),this.killFace_(t.Lface,null)):(e.Lface.anEdge=t.Oprev,t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),this.killEdge_(e)},e.prototype.addEdgeVertex=function(e){var t=this.makeEdge_(e),i=t.Sym;this.splice_(t,e.Lnext),t.Org=e.Dst;var n=new YD;return this.makeVertex_(n,i,t.Org),t.Lface=i.Lface=e.Lface,t},e.prototype.splitEdge=function(e){var t=this.addEdgeVertex(e).Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,t),e.Dst=t.Org,t.Dst.anEdge=t.Sym,t.Rface=e.Rface,t.winding=e.winding,t.Sym.winding=e.Sym.winding,t.idx=e.idx,t.Sym.idx=e.Sym.idx,t},e.prototype.connect=function(e,t){var i=!1,n=this.makeEdge_(e),r=n.Sym;if(t.Lface!==e.Lface&&(i=!0,this.killFace_(t.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(r,t),n.Org=e.Dst,r.Org=t.Org,n.Lface=r.Lface=e.Lface,e.Lface.anEdge=r,!i){var a=new qD;this.makeFace_(a,n,e.Lface)}return n},e.prototype.zapFace=function(e){var t,i,n,r,a,s=e.anEdge;i=s.Lnext;do{i=(t=i).Lnext,t.Lface=null,null===t.Rface&&(t.Onext===t?this.killVertex_(t.Org,null):(t.Org.anEdge=t.Onext,this.splice_(t,t.Oprev)),(n=t.Sym).Onext===n?this.killVertex_(n.Org,null):(n.Org.anEdge=n.Onext,this.splice_(n,n.Oprev)),this.killEdge_(t))}while(t!=s);r=e.prev,(a=e.next).prev=r,r.next=a},e.prototype.countFaceVerts_=function(e){var t=e.anEdge,i=0;do{i++,t=t.Lnext}while(t!==e.anEdge);return i},e.prototype.mergeConvexFaces=function(e){var t,i,n,r,a;for(t=this.fHead.next;t!==this.fHead;t=t.next)if(t.inside)for(a=(i=t.anEdge).Org;n=i.Lnext,(r=i.Sym)&&r.Lface&&r.Lface.inside&&(this.countFaceVerts_(t)+this.countFaceVerts_(r.Lface)-2<=e&&WD.vertCCW(i.Lprev.Org,i.Org,r.Lnext.Lnext.Org)&&WD.vertCCW(r.Lprev.Org,r.Org,i.Lnext.Lnext.Org)&&(n=r.Lnext,this.delete(r),i=null,r=null)),!i||i.Lnext.Org!==a;)i=n;return!0},e.prototype.check=function(){var e,t,i,n,r,a,s=this.fHead,o=this.vHead,l=this.eHead;for(t=s,t=s;(e=t.next)!==s;t=e){HD(e.prev===t),r=e.anEdge;do{HD(r.Sym!==r),HD(r.Sym.Sym===r),HD(r.Lnext.Onext.Sym===r),HD(r.Onext.Sym.Lnext===r),HD(r.Lface===e),r=r.Lnext}while(r!==e.anEdge)}for(HD(e.prev===t&&null===e.anEdge),n=o,n=o;(i=n.next)!==o;n=i){HD(i.prev===n),r=i.anEdge;do{HD(r.Sym!==r),HD(r.Sym.Sym===r),HD(r.Lnext.Onext.Sym===r),HD(r.Onext.Sym.Lnext===r),HD(r.Org===i),r=r.Onext}while(r!==i.anEdge)}for(HD(i.prev===n&&null===i.anEdge),a=l,a=l;(r=a.next)!==l;a=r)HD(r.Sym.next===a.Sym),HD(r.Sym!==r),HD(r.Sym.Sym===r),HD(null!==r.Org),HD(null!==r.Dst),HD(r.Lnext.Onext.Sym===r),HD(r.Onext.Sym.Lnext===r);HD(r.Sym.next===a.Sym&&r.Sym===this.eHeadSym&&r.Sym.Sym===r&&null===r.Org&&null===r.Dst&&null===r.Lface&&null===r.Rface)},e}(),KD=function(){this.handle=null},ZD=function(){this.key=null,this.node=0},JD=function(){function e(e,t){this.leq=t,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var i=0;i<e+1;i++)this.nodes[i]=new KD,this.handles[i]=new ZD;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return e.prototype.floatDown_=function(e){var t,i,n,r=this.nodes,a=this.handles;for(t=r[e].handle;;){if((n=e<<1)<this.size&&this.leq(a[r[n+1].handle].key,a[r[n].handle].key)&&++n,HD(n<=this.max),i=r[n].handle,n>this.size||this.leq(a[t].key,a[i].key)){r[e].handle=t,a[t].node=e;break}r[e].handle=i,a[i].node=e,e=n}},e.prototype.floatUp_=function(e){var t,i,n,r=this.nodes,a=this.handles;for(t=r[e].handle;;){if(i=r[n=e>>1].handle,0===n||this.leq(a[i].key,a[t].key)){r[e].handle=t,a[t].node=e;break}r[e].handle=i,a[i].node=e,e=n}},e.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},e.prototype.min=function(){return this.handles[this.nodes[1].handle].key},e.prototype.insert=function(e){var t,i;if(2*(t=++this.size)>this.max){var n,r;for(this.max*=2,r=this.nodes.length,this.nodes.length=this.max+1,n=r;n<this.nodes.length;n++)this.nodes[n]=new KD;for(r=this.handles.length,this.handles.length=this.max+1,n=r;n<this.handles.length;n++)this.handles[n]=new ZD}return 0===this.freeList?i=t:(i=this.freeList,this.freeList=this.handles[i].node),this.nodes[t].handle=i,this.handles[i].node=t,this.handles[i].key=e,this.initialized&&this.floatUp_(t),i},e.prototype.extractMin=function(){var e=this.nodes,t=this.handles,i=e[1].handle,n=t[i].key;return this.size>0&&(e[1].handle=e[this.size].handle,t[e[1].handle].node=1,t[i].key=null,t[i].node=this.freeList,this.freeList=i,--this.size,this.size>0&&this.floatDown_(1)),n},e.prototype.delete=function(e){var t,i=this.nodes,n=this.handles;HD(e>=1&&e<=this.max&&null!==n[e].key),i[t=n[e].node].handle=i[this.size].handle,n[i[t].handle].node=t,--this.size,t<=this.size&&(t<=1||this.leq(n[i[t>>1].handle].key,n[i[t].handle].key)?this.floatDown_(t):this.floatUp_(t)),n[e].key=null,n[e].node=this.freeList,this.freeList=e},e}(),$D=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},eR=function(){this.key=null,this.next=null,this.prev=null},tR=function(){function e(e,t){this.frame=e,this.leq=t,this.head=new eR,this.head.next=this.head,this.head.prev=this.head}return e.prototype.min=function(){return this.head.next},e.prototype.max=function(){return this.head.prev},e.prototype.insert=function(e){return this.insertBefore(this.head,e)},e.prototype.search=function(e){var t=this.head;do{t=t.next}while(null!==t.key&&!this.leq(this.frame,e,t.key));return t},e.prototype.insertBefore=function(e,t){do{e=e.prev}while(null!==e.key&&!this.leq(this.frame,e.key,t));var i=new eR;return i.key=t,i.next=e.next,e.next.prev=i,i.prev=e,e.next=i,i},e.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},e}(),iR=function(){function e(){}return e.regionBelow=function(e){return e.nodeUp.prev.key},e.regionAbove=function(e){return e.nodeUp.next.key},e.debugEvent=function(e){},e.addWinding=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.edgeLeq=function(e,t,i){var n=e.event,r=t.eUp,a=i.eUp;return r.Dst===n?a.Dst===n?WD.vertLeq(r.Org,a.Org)?WD.edgeSign(a.Dst,r.Org,a.Org)<=0:WD.edgeSign(r.Dst,a.Org,r.Org)>=0:WD.edgeSign(a.Dst,n,a.Org)<=0:a.Dst===n?WD.edgeSign(r.Dst,n,r.Org)>=0:WD.edgeEval(r.Dst,n,r.Org)>=WD.edgeEval(a.Dst,n,a.Org)},e.deleteRegion=function(e,t){t.fixUpperEdge&&HD(0===t.eUp.winding),t.eUp.activeRegion=null,e.dict.delete(t.nodeUp)},e.fixUpperEdge=function(e,t,i){HD(t.fixUpperEdge),e.mesh.delete(t.eUp),t.fixUpperEdge=!1,t.eUp=i,i.activeRegion=t},e.topLeftRegion=function(t,i){var n,r=i.eUp.Org;do{i=e.regionAbove(i)}while(i.eUp.Org===r);if(i.fixUpperEdge){if(null===(n=t.mesh.connect(e.regionBelow(i).eUp.Sym,i.eUp.Lnext)))return null;e.fixUpperEdge(t,i,n),i=e.regionAbove(i)}return i},e.topRightRegion=function(t){var i=t.eUp.Dst;do{t=e.regionAbove(t)}while(t.eUp.Dst===i);return t},e.addRegionBelow=function(e,t,i){var n=new $D;return n.eUp=i,n.nodeUp=e.dict.insertBefore(t.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,i.activeRegion=n,n},e.isWindingInside=function(e,t){switch(e.windingRule){case TD.ODD:return 0!==(1&t);case TD.NONZERO:return 0!==t;case TD.POSITIVE:return t>0;case TD.NEGATIVE:return t<0;case TD.ABS_GEQ_TWO:return t>=2||t<=-2}throw new Error("Invalid winding rulle")},e.computeWinding=function(t,i){i.windingNumber=e.regionAbove(i).windingNumber+i.eUp.winding,i.inside=e.isWindingInside(t,i.windingNumber)},e.finishRegion=function(t,i){var n=i.eUp,r=n.Lface;r.inside=i.inside,r.anEdge=n,e.deleteRegion(t,i)},e.finishLeftRegions=function(t,i,n){for(var r,a=null,s=i,o=i.eUp;s!==n;){if(s.fixUpperEdge=!1,(r=(a=e.regionBelow(s)).eUp).Org!=o.Org){if(!a.fixUpperEdge){e.finishRegion(t,s);break}r=t.mesh.connect(o.Lprev,r.Sym),e.fixUpperEdge(t,a,r)}o.Onext!==r&&(t.mesh.splice(r.Oprev,r),t.mesh.splice(o,r)),e.finishRegion(t,s),o=a.eUp,s=a}return o},e.addRightEdges=function(t,i,n,r,a,s){var o,l,c,h,d=!0;c=n;do{HD(WD.vertLeq(c.Org,c.Dst)),e.addRegionBelow(t,i,c.Sym),c=c.Onext}while(c!==r);for(null===a&&(a=e.regionBelow(i).eUp.Rprev),l=i,h=a;(c=(o=e.regionBelow(l)).eUp.Sym).Org===h.Org;)c.Onext!==h&&(t.mesh.splice(c.Oprev,c),t.mesh.splice(h.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=e.isWindingInside(t,o.windingNumber),l.dirty=!0,!d&&e.checkForRightSplice(t,l)&&(e.addWinding(c,h),e.deleteRegion(t,l),t.mesh.delete(h)),d=!1,l=o,h=c;l.dirty=!0,HD(l.windingNumber-c.winding===o.windingNumber),s&&e.walkDirtyRegions(t,l)},e.spliceMergeVertices=function(e,t,i){e.mesh.splice(t,i)},e.vertexWeights=function(e,t,i){var n=WD.vertL1dist(t,e),r=WD.vertL1dist(i,e),a=.5*r/(n+r),s=.5*n/(n+r);e.coords[0]+=a*t.coords[0]+s*i.coords[0],e.coords[1]+=a*t.coords[1]+s*i.coords[1],e.coords[2]+=a*t.coords[2]+s*i.coords[2]},e.getIntersectData=function(t,i,n,r,a,s){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,e.vertexWeights(i,n,r),e.vertexWeights(i,a,s)},e.checkForRightSplice=function(t,i){var n=e.regionBelow(i),r=i.eUp,a=n.eUp;if(WD.vertLeq(r.Org,a.Org)){if(WD.edgeSign(a.Dst,r.Org,a.Org)>0)return!1;WD.vertEq(r.Org,a.Org)?r.Org!==a.Org&&(t.pq.delete(r.Org.pqHandle),e.spliceMergeVertices(t,a.Oprev,r)):(t.mesh.splitEdge(a.Sym),t.mesh.splice(r,a.Oprev),i.dirty=n.dirty=!0)}else{if(WD.edgeSign(r.Dst,a.Org,r.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(r.Sym),t.mesh.splice(a.Oprev,r)}return!0},e.checkForLeftSplice=function(t,i){var n,r=e.regionBelow(i),a=i.eUp,s=r.eUp;if(HD(!WD.vertEq(a.Dst,s.Dst)),WD.vertLeq(a.Dst,s.Dst)){if(WD.edgeSign(a.Dst,s.Dst,a.Org)<0)return!1;e.regionAbove(i).dirty=i.dirty=!0,n=t.mesh.splitEdge(a),t.mesh.splice(s.Sym,n),n.Lface.inside=i.inside}else{if(WD.edgeSign(s.Dst,a.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,n=t.mesh.splitEdge(s),t.mesh.splice(a.Lnext,s.Sym),n.Rface.inside=i.inside}return!0},e.checkForIntersect=function(t,i){var n,r,a=e.regionBelow(i),s=i.eUp,o=a.eUp,l=s.Org,c=o.Org,h=s.Dst,d=o.Dst,u=new YD;if(HD(!WD.vertEq(d,h)),HD(WD.edgeSign(h,t.event,l)<=0),HD(WD.edgeSign(d,t.event,c)>=0),HD(l!==t.event&&c!==t.event),HD(!i.fixUpperEdge&&!a.fixUpperEdge),l===c||Math.min(l.t,h.t)>Math.max(c.t,d.t))return!1;if(WD.vertLeq(l,c)){if(WD.edgeSign(d,l,c)>0)return!1}else if(WD.edgeSign(h,c,l)<0)return!1;return e.debugEvent(t),WD.intersect(h,l,d,c,u),HD(Math.min(l.t,h.t)<=u.t),HD(u.t<=Math.max(c.t,d.t)),HD(Math.min(d.s,h.s)<=u.s),HD(u.s<=Math.max(c.s,l.s)),WD.vertLeq(u,t.event)&&(u.s=t.event.s,u.t=t.event.t),n=WD.vertLeq(l,c)?l:c,WD.vertLeq(n,u)&&(u.s=n.s,u.t=n.t),WD.vertEq(u,l)||WD.vertEq(u,c)?(e.checkForRightSplice(t,i),!1):!WD.vertEq(h,t.event)&&WD.edgeSign(h,t.event,u)>=0||!WD.vertEq(d,t.event)&&WD.edgeSign(d,t.event,u)<=0?d===t.event?(t.mesh.splitEdge(s.Sym),t.mesh.splice(o.Sym,s),i=e.topLeftRegion(t,i),s=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),a),e.addRightEdges(t,i,s.Oprev,s,s,!0),!0):h===t.event?(t.mesh.splitEdge(o.Sym),t.mesh.splice(s.Lnext,o.Oprev),a=i,i=e.topRightRegion(i),r=e.regionBelow(i).eUp.Rprev,a.eUp=o.Oprev,o=e.finishLeftRegions(t,a,null),e.addRightEdges(t,i,o.Onext,s.Rprev,r,!0),!0):(WD.edgeSign(h,t.event,u)>=0&&(e.regionAbove(i).dirty=i.dirty=!0,t.mesh.splitEdge(s.Sym),s.Org.s=t.event.s,s.Org.t=t.event.t),WD.edgeSign(d,t.event,u)<=0&&(i.dirty=a.dirty=!0,t.mesh.splitEdge(o.Sym),o.Org.s=t.event.s,o.Org.t=t.event.t),!1):(t.mesh.splitEdge(s.Sym),t.mesh.splitEdge(o.Sym),t.mesh.splice(o.Oprev,s),s.Org.s=u.s,s.Org.t=u.t,s.Org.pqHandle=t.pq.insert(s.Org),e.getIntersectData(t,s.Org,l,h,c,d),e.regionAbove(i).dirty=i.dirty=a.dirty=!0,!1)},e.walkDirtyRegions=function(t,i){for(var n,r,a=e.regionBelow(i);;){for(;a.dirty;)i=a,a=e.regionBelow(a);if(!i.dirty&&(a=i,null===(i=e.regionAbove(i))||!i.dirty))return;if(i.dirty=!1,n=i.eUp,r=a.eUp,n.Dst!==r.Dst&&e.checkForLeftSplice(t,i)&&(a.fixUpperEdge?(e.deleteRegion(t,a),t.mesh.delete(r),r=(a=e.regionBelow(i)).eUp):i.fixUpperEdge&&(e.deleteRegion(t,i),t.mesh.delete(n),n=(i=e.regionAbove(a)).eUp)),n.Org!==r.Org)if(n.Dst===r.Dst||i.fixUpperEdge||a.fixUpperEdge||n.Dst!==t.event&&r.Dst!==t.event)e.checkForRightSplice(t,i);else if(e.checkForIntersect(t,i))return;n.Org===r.Org&&n.Dst===r.Dst&&(e.addWinding(r,n),e.deleteRegion(t,i),t.mesh.delete(n),i=e.regionAbove(a))}},e.connectRightVertex=function(t,i,n){var r,a=n.Onext,s=e.regionBelow(i),o=i.eUp,l=s.eUp,c=!1;o.Dst!==l.Dst&&e.checkForIntersect(t,i),WD.vertEq(o.Org,t.event)&&(t.mesh.splice(a.Oprev,o),i=e.topLeftRegion(t,i),a=e.regionBelow(i).eUp,e.finishLeftRegions(t,e.regionBelow(i),s),c=!0),WD.vertEq(l.Org,t.event)&&(t.mesh.splice(n,l.Oprev),n=e.finishLeftRegions(t,s,null),c=!0),c?e.addRightEdges(t,i,n.Onext,a,a,!0):(r=WD.vertLeq(l.Org,o.Org)?l.Oprev:o,r=t.mesh.connect(n.Lprev,r),e.addRightEdges(t,i,r,r.Onext,r.Onext,!1),r.Sym.activeRegion.fixUpperEdge=!0,e.walkDirtyRegions(t,i))},e.connectLeftDegenerate=function(t,i,n){var r,a,s,o,l;return r=i.eUp,WD.vertEq(r.Org,n)?(HD(!1),void e.spliceMergeVertices(t,r,n.anEdge)):WD.vertEq(r.Dst,n)?(HD(!1),i=e.topRightRegion(i),a=o=(s=(l=e.regionBelow(i)).eUp.Sym).Onext,l.fixUpperEdge&&(HD(a!==s),e.deleteRegion(t,l),t.mesh.delete(s),s=a.Oprev),t.mesh.splice(n.anEdge,s),WD.edgeGoesLeft(a)||(a=null),void e.addRightEdges(t,i,s.Onext,o,a,!0)):(t.mesh.splitEdge(r.Sym),i.fixUpperEdge&&(t.mesh.delete(r.Onext),i.fixUpperEdge=!1),t.mesh.splice(n.anEdge,r),void e.sweepEvent(t,n))},e.connectLeftVertex=function(t,i){var n,r,a,s,o,l,c=new $D;if(c.eUp=i.anEdge.Sym,n=t.dict.search(c).key,r=e.regionBelow(n)){if(s=n.eUp,o=r.eUp,0===WD.edgeSign(s.Dst,i,s.Org))return void e.connectLeftDegenerate(t,n,i);if(a=WD.vertLeq(o.Dst,s.Dst)?n:r,n.inside||a.fixUpperEdge){if(a===n)l=t.mesh.connect(i.anEdge.Sym,s.Lnext);else l=t.mesh.connect(o.Dnext,i.anEdge).Sym;a.fixUpperEdge?e.fixUpperEdge(t,a,l):e.computeWinding(t,e.addRegionBelow(t,n,l)),e.sweepEvent(t,i)}else e.addRightEdges(t,n,i.anEdge,i.anEdge,null,!0)}},e.sweepEvent=function(t,i){t.event=i,e.debugEvent(t);for(var n=i.anEdge;null===n.activeRegion;)if((n=n.Onext)===i.anEdge)return void e.connectLeftVertex(t,i);var r=e.topLeftRegion(t,n.activeRegion);HD(null!==r);var a=e.regionBelow(r),s=a.eUp,o=e.finishLeftRegions(t,a,null);o.Onext===s?e.connectRightVertex(t,r,o):e.addRightEdges(t,r,o.Onext,s,s,!0)},e.addSentinel=function(e,t,i,n){var r=new $D,a=e.mesh.makeEdge();a.Org.s=i,a.Org.t=n,a.Dst.s=t,a.Dst.t=n,e.event=a.Dst,r.eUp=a,r.windingNumber=0,r.inside=!1,r.fixUpperEdge=!1,r.sentinel=!0,r.dirty=!1,r.nodeUp=e.dict.insert(r)},e.initEdgeDict=function(t){t.dict=new tR(t,e.edgeLeq);var i=t.bmax[0]-t.bmin[0],n=t.bmax[1]-t.bmin[1],r=t.bmin[0]-i,a=t.bmax[0]+i,s=t.bmin[1]-n,o=t.bmax[1]+n;e.addSentinel(t,r,a,s),e.addSentinel(t,r,a,o)},e.doneEdgeDict=function(t){for(var i,n=0;null!==(i=t.dict.min().key);)i.sentinel||(HD(i.fixUpperEdge),HD(1===++n)),HD(0===i.windingNumber),e.deleteRegion(t,i)},e.removeDegenerateEdges=function(t){var i,n,r,a=t.mesh.eHead;for(i=a.next;i!==a;i=n)n=i.next,r=i.Lnext,WD.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(e.spliceMergeVertices(t,r,i),t.mesh.delete(i),r=(i=r).Lnext),r.Lnext===i&&(r!==i&&((r===n||r===n.Sym)&&(n=n.next),t.mesh.delete(r)),(i===n||i===n.Sym)&&(n=n.next),t.mesh.delete(i))},e.initPriorityQ=function(e){var t,i,n,r=0;for(i=(n=e.mesh.vHead).next;i!==n;i=i.next)r++;for(r+=8,t=e.pq=new JD(r,WD.vertLeq),i=(n=e.mesh.vHead).next;i!==n;i=i.next)i.pqHandle=t.insert(i);return i===n&&(t.init(),!0)},e.donePriorityQ=function(e){e.pq=null},e.removeDegenerateFaces=function(t,i){var n,r,a;for(n=i.fHead.next;n!==i.fHead;n=r)r=n.next,HD((a=n.anEdge).Lnext!==a),a.Lnext.Lnext===a&&(e.addWinding(a.Onext,a),t.mesh.delete(a));return!0},e.computeInterior=function(t,i){var n,r;if(void 0===i&&(i=!0),e.removeDegenerateEdges(t),!e.initPriorityQ(t))return!1;for(e.initEdgeDict(t);null!==(n=t.pq.extractMin());){for(;null!==(r=t.pq.min())&&WD.vertEq(r,n);)r=t.pq.extractMin(),e.spliceMergeVertices(t,n.anEdge,r.anEdge);e.sweepEvent(t,n)}return t.event=t.dict.min().key.eUp.Org,e.debugEvent(t),e.doneEdgeDict(t),e.donePriorityQ(t),!!e.removeDegenerateFaces(t,t.mesh)&&(i&&t.mesh.check(),!0)},e}(),nR=function(){function e(){this.mesh=new QD,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=TD.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return e.prototype.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.prototype.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!t)throw"Zero-size vector!";t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},e.prototype.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.prototype.computeNormal_=function(e){var t,i,n,r,a,s,o=[0,0,0],l=[0,0,0],c=[0,0,0],h=[0,0,0],d=[0,0,0],u=[null,null,null],p=[null,null,null],f=this.mesh.vHead;t=f.next;for(var m=0;m<3;++m)r=t.coords[m],l[m]=r,p[m]=t,o[m]=r,u[m]=t;for(t=f.next;t!==f;t=t.next)for(var g=0;g<3;++g)(r=t.coords[g])<l[g]&&(l[g]=r,p[g]=t),r>o[g]&&(o[g]=r,u[g]=t);var v=0;if(o[1]-l[1]>o[0]-l[0]&&(v=1),o[2]-l[2]>o[v]-l[v]&&(v=2),l[v]>=o[v])return e[0]=0,e[1]=0,void(e[2]=1);for(s=0,i=p[v],n=u[v],c[0]=i.coords[0]-n.coords[0],c[1]=i.coords[1]-n.coords[1],c[2]=i.coords[2]-n.coords[2],t=f.next;t!==f;t=t.next)h[0]=t.coords[0]-n.coords[0],h[1]=t.coords[1]-n.coords[1],h[2]=t.coords[2]-n.coords[2],d[0]=c[1]*h[2]-c[2]*h[1],d[1]=c[2]*h[0]-c[0]*h[2],d[2]=c[0]*h[1]-c[1]*h[0],(a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2])>s&&(s=a,e[0]=d[0],e[1]=d[1],e[2]=d[2]);s<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(c)]=1)},e.prototype.checkOrientation_=function(){for(var e,t,i=this.mesh.fHead,n=this.mesh.vHead,r=0,a=i.next;a!==i;a=a.next)if(!((t=a.anEdge).winding<=0))do{r+=(t.Org.s-t.Dst.s)*(t.Org.t+t.Dst.t),t=t.Lnext}while(t!==a.anEdge);if(r<0){for(e=n.next;e!==n;e=e.next)e.t=-e.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},e.prototype.projectPolygon_=function(){var e,t,i=this.mesh.vHead,n=[0,0,0],r=!1;n[0]=this.normal[0],n[1]=this.normal[1],n[2]=this.normal[2],!n[0]&&!n[1]&&!n[2]&&(this.computeNormal_(n),r=!0),e=this.sUnit,t=this.tUnit;var a=this.longAxis_(n);e[a]=0,e[(a+1)%3]=1,e[(a+2)%3]=0,t[a]=0,t[(a+1)%3]=0,t[(a+2)%3]=n[a]>0?1:-1;for(var s=i.next;s!==i;s=s.next)s.s=this.dot_(s.coords,e),s.t=this.dot_(s.coords,t);r&&this.checkOrientation_();for(var o=!0,l=i.next;l!==i;l=l.next)o?(this.bmin[0]=this.bmax[0]=l.s,this.bmin[1]=this.bmax[1]=l.t,o=!1):(l.s<this.bmin[0]&&(this.bmin[0]=l.s),l.s>this.bmax[0]&&(this.bmax[0]=l.s),l.t<this.bmin[1]&&(this.bmin[1]=l.t),l.t>this.bmax[1]&&(this.bmax[1]=l.t))},e.prototype.addWinding_=function(e,t){e.winding+=t.winding,e.Sym.winding+=t.Sym.winding},e.prototype.tessellateMonoRegion_=function(e,t){var i,n;if((i=t.anEdge).Lnext===i||i.Lnext.Lnext===i)throw"Mono region invalid";for(;WD.vertLeq(i.Dst,i.Org);i=i.Lprev);for(;WD.vertLeq(i.Org,i.Dst);i=i.Lnext);n=i.Lprev;for(;i.Lnext!==n;)if(WD.vertLeq(i.Dst,n.Org)){for(;n.Lnext!==i&&(WD.edgeGoesLeft(n.Lnext)||WD.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)n=e.connect(n.Lnext,n).Sym;n=n.Lprev}else{for(;n.Lnext!==i&&(WD.edgeGoesRight(i.Lprev)||WD.edgeSign(i.Dst,i.Org,i.Lprev.Org)>=0);)i=e.connect(i,i.Lprev).Sym;i=i.Lnext}if(n.Lnext===i)throw"Mono region invalid";for(;n.Lnext.Lnext!==i;)n=e.connect(n.Lnext,n).Sym;return!0},e.prototype.tessellateInterior_=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t)if(t=i.next,i.inside&&!this.tessellateMonoRegion_(e,i))return!1;return!0},e.prototype.discardExterior_=function(e){for(var t,i=e.fHead.next;i!==e.fHead;i=t)t=i.next,i.inside||e.zapFace(i)},e.prototype.setWindingNumber_=function(e,t,i){for(var n,r=e.eHead.next;r!==e.eHead;r=n)n=r.next,r.Rface.inside!==r.Lface.inside?r.winding=r.Lface.inside?t:-t:i?e.delete(r):r.winding=0},e.prototype.getNeighbourFace_=function(e){return e.Rface&&e.Rface.inside?e.Rface.n:-1},e.prototype.outputPolymesh_=function(e,t,i,n){var r,a,s=0,o=0;i>3&&e.mergeConvexFaces(i);for(var l=e.vHead.next;l!==e.vHead;l=l.next)l.n=-1;for(var c=e.fHead.next;c!==e.fHead;c=c.next)if(c.n=-1,c.inside){r=c.anEdge,a=0;do{-1===(l=r.Org).n&&(l.n=o,o++),a++,r=r.Lnext}while(r!==c.anEdge);if(a>i)throw"Face vertex greater that support polygon";c.n=s,++s}this.elementCount=s,t===RD.CONNECTED_POLYGONS&&(s*=2),this.elements=[],this.elements.length=s*i,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(l=e.vHead.next;l!==e.vHead;l=l.next)if(-1!==l.n){var h=l.n*n;this.vertices[h+0]=l.coords[0],this.vertices[h+1]=l.coords[1],n>2&&(this.vertices[h+2]=l.coords[2]),this.vertexIndices[l.n]=l.idx}var d=0;for(c=e.fHead.next;c!==e.fHead;c=c.next)if(c.inside){r=c.anEdge,a=0;do{l=r.Org;this.elements[d++]=l.n,a++,r=r.Lnext}while(r!==c.anEdge);for(var u=a;u<i;++u)this.elements[d++]=-1;if(t===RD.CONNECTED_POLYGONS){r=c.anEdge;do{this.elements[d++]=this.getNeighbourFace_(r),r=r.Lnext}while(r!==c.anEdge);for(var p=a;p<i;++p)this.elements[d++]=-1}}},e.prototype.outputContours_=function(e,t){var i,n,r=0,a=0;this.vertexCount=0,this.elementCount=0;for(var s=e.fHead.next;s!==e.fHead;s=s.next)if(s.inside){n=i=s.anEdge;do{this.vertexCount++,i=i.Lnext}while(i!==n);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*t,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var o=0,l=0,c=0;r=0;for(s=e.fHead.next;s!==e.fHead;s=s.next)if(s.inside){a=0,n=i=s.anEdge;do{this.vertices[o++]=i.Org.coords[0],this.vertices[o++]=i.Org.coords[1],t>2&&(this.vertices[o++]=i.Org.coords[2]),this.vertexIndices[l++]=this.vertexIdCallback?this.vertexIdCallback(i):i.Org.idx,a++,i=i.Lnext}while(i!==n);this.elements[c++]=r,this.elements[c++]=a,r+=a}},e.prototype.addContour=function(e,t){null===this.mesh&&(this.mesh=new QD),e<2&&(e=2),e>3&&(e=3);for(var i=null,n=0;n<t.length;n+=e)null===i?(i=this.mesh.makeEdge(),this.mesh.splice(i,i.Sym)):(this.mesh.splitEdge(i),i=i.Lnext),i.Org.coords[0]=t[n+0],i.Org.coords[1]=t[n+1],i.Org.coords[2]=e>2?t[n+2]:0,i.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(i),i.winding=1,i.Sym.winding=-1},e.prototype.tesselate=function(e,t,i,n,r,a){if(void 0===e&&(e=TD.ODD),void 0===t&&(t=RD.POLYGONS),void 0===a&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,r&&(this.normal[0]=r[0],this.normal[1]=r[1],this.normal[2]=r[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),iR.computeInterior(this,a);var s=this.mesh;return t===RD.BOUNDARY_CONTOURS?this.setWindingNumber_(s,1,!0):this.tessellateInterior_(s),a&&s.check(),t===RD.BOUNDARY_CONTOURS?this.outputContours_(s,n):this.outputPolymesh_(s,t,i,n),!0},e}();function rR(e){var t=e.windingRule,i=void 0===t?TD.ODD:t,n=e.elementType,r=void 0===n?RD.POLYGONS:n,a=e.polySize,s=void 0===a?3:a,o=e.vertexSize,l=void 0===o?2:o,c=e.normal,h=void 0===c?[0,0,1]:c,d=e.contours,u=void 0===d?[]:d,p=e.strict,f=void 0===p||p,m=e.debug,g=void 0!==m&&m;if(!u&&f)throw new Error("Contours can't be empty");if(u){var v=new nR;e.edgeCreateCallback&&(v.edgeCreateCallback=e.edgeCreateCallback),e.vertexIdCallback&&(v.vertexIdCallback=e.vertexIdCallback);for(var y=0;y<u.length;y++)v.addContour(l||2,u[y]);return v.tesselate(i,r,s,l,h,f),{vertices:v.vertices,vertexIndices:v.vertexIndices,vertexCount:v.vertexCount,elements:v.elements,elementCount:v.elementCount,mesh:g?v.mesh:void 0}}}TD.ODD,TD.NONZERO,TD.POSITIVE,TD.NEGATIVE,TD.ABS_GEQ_TWO,RD.POLYGONS,RD.CONNECTED_POLYGONS,RD.BOUNDARY_CONTOURS;var aR=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.capacity=e,this.size=0,this.debug=t,this.debug&&console.log("allocating with cap ".concat(e));let i=e*aR.eSize;this.buffer=new ArrayBuffer(i);let n=Float32Array.BYTES_PER_ELEMENT,r=0;this.positions=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.normals=new Float32Array(this.buffer,r*n,3*e),r+=3*e,this.uvs=new Float32Array(this.buffer,r*n,2*e)}realloc(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<this.size)throw Error("cannot shrink buffer");if(e<=this.capacity&&!t)return;this.debug&&console.log("resizing from ".concat(this.capacity," \u2192 ").concat(e));let i=e*aR.eSize,n=new ArrayBuffer(i),r=Float32Array.BYTES_PER_ELEMENT,a=0,s=new Float32Array(n,a*r,3*e);a+=3*e;let o=new Float32Array(n,a*r,3*e);a+=3*e;let l=new Float32Array(n,a*r,2*e);t?(s.set(this.positions.subarray(0,3*this.size)),o.set(this.normals.subarray(0,3*this.size)),l.set(this.uvs.subarray(0,2*this.size))):(s.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=n,this.positions=s,this.normals=o,this.uvs=l,this.capacity=e}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.size+e;if(t>this.capacity){let e=this.capacity;for(;t>e;)e*=2;this.realloc(e)}let i=this.size;return this.size=t,i}reserve(e){let t=this.size+e;t>this.capacity&&this.realloc(t)}shrink(){this.debug&&console.log("shrinking ".concat(this.capacity," \u2192 ").concat(this.size)),this.realloc(this.size,!0)}},sR=aR;sR.eSize=8*Float32Array.BYTES_PER_ELEMENT;var oR=Br(Vr()),lR={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},cR={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},hR={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},dR=(e,t)=>i=>{let[n,r]=i;return r<n&&(r+=t),(e>=n?e:e+t)<=r},uR=class extends Wc{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:TD.ODD,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];super(),this.forPathBevel=s,this.type="ShapeGeometry",this.vertexCache={},this._shape=e,this._depth=t,this._curveSegments=n,this._bevelSegmentsInput=r;let o,l,c,h=this._shape.extractShapePointsToFlatArray([],n),d=this._shape.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],n),i=[];for(let n=t.length-1;n>=1;n-=2){let e=t[n-1],r=t[n-0];i.push(e,r)}return i})),u=[],p=[];for(let E=0;E<h.length;E+=2)p.push([h[E],h[E+1]]);u.push(p);for(let E=0;E<d.length;E++){let e=d[E],t=[];for(let i=0;i<e.length;i+=2)t.push([e[i],e[i+1]]);u.push(t)}o=e.isText?.1*(new eg).setFromPoints(e.points.map((e=>e.position))).getSize(new jo).length():0===u[0].length?i:(0,oR.default)(u).distance,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,o,t/2),this._bevelSegments=Math.floor(r));try{l=rR({windingRule:a,elementType:RD.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[h]})}catch{l=lR}try{c=rR({windingRule:TD.ODD,elementType:RD.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...d]})}catch{c=cR}if(!l)throw new Error("error generating geometry");let f=l.elementCount;if(c){l.elementCount+=c.elementCount;for(let e=0;e<c.elements.length;e++){let t=c.elements[e],i=e%2===0?l.vertexCount:0;l.elements.push(t+i)}for(let e=0;e<c.vertexIndices.length;e++){let t=c.vertexIndices[e],i=l.vertexCount;l.vertexIndices.push(t+i)}for(let e=0;e<c.vertices.length;e++){let t=c.vertices[e];l.vertices.push(t)}}let m=1/0,g=-1/0,v=1/0,y=-1/0;for(let E=0,C=l.vertexCount;E<C;E++){let e=2*E,t=l.vertices[e+0],i=l.vertices[e+1];t<m&&(m=t),t>g&&(g=t),i<v&&(v=i),i>y&&(y=i)}this._minX=m,this._minY=v,this._width=g-m,this._height=y-v,this._buffer=new sR(this._computeBufferEstimatedSize(l));let b=[],x=[];for(let E=l.elementCount-1;E>=0;E--){let e=E>=f,t=2*E,i=l.elements[t+0],r=l.elements[t+1],a=i+r,c={start:i,count:r,normals:[],continuous:[],concave:[]},h=i,u=a-1,p=i+1,m=this._shape.roundedCurves.length;do{let t=h-i,n=l.vertices[2*u+0],s=l.vertices[2*u+1],o=l.vertices[2*h+0],d=l.vertices[2*h+1],f=l.vertices[2*p+0],g=l.vertices[2*p+1],v=o-n,y=d-s,b=Math.sqrt(v*v+y*y);v/=b,y/=b;let x=o-f,w=d-g,_=Math.sqrt(x*x+w*w);x/=_,w/=_,c.normals[2*t+0]=-w,c.normals[2*t+1]=x,c.concave[t]=v*w-y*x>0;let S=l.vertexIndices[h];if(Array.isArray(S))c.continuous[t]=!1;else{let[e,i]=this._shape.getCurveIndexFromVertexId(S-1,!0);if(i>0&&i<1)c.continuous[t]=!0;else{let n=1===i?e+1:e-1;n=(n+m)%m;let r=1===i?0:1,a=this._shape.roundedCurves[e].getTangent(i),s=this._shape.roundedCurves[n].getTangent(r);c.continuous[t]=a.dot(s)>.95}}e&&(c.normals[2*t+0]*=-1,c.normals[2*t+1]*=-1),[u,h,p]=[h,p,p+1],p>=a&&(p-=r)}while(p!==i+1);let g=[];g.push({bevelI:0,angle:0,size:0,boundary:{vertices:l.vertices.slice(2*i,2*a),vertexCount:r,vertexIndices:new Array(r).fill(!0).map(((e,t)=>[t,t])),elements:[0,r],elementCount:1,mesh:null},reverseMap:[],insetPoints:l.vertices.slice(2*i,2*a)});let v=0;for(let s=1;s<=this._bevelSegments;s++){let t=s/this._bevelSegments*Math.PI/2,i=(1-Math.cos(t))*this._bevel,a=[],o=[],h=[],d=[],u=0;for(let s=0;s<r;s++){let t=2*s,p=(s-1+r)%r*2,f=l.vertices[2*c.start+t+0],m=l.vertices[2*c.start+t+1],g=-c.normals[p+0]*i,v=-c.normals[p+1]*i,y=-c.normals[t+0]*i,b=-c.normals[t+1]*i;if(c.concave[s]||!c.concave[s]&&e){let t=Math.atan2(v,g),r=Math.atan2(b,y);r>t&&(r-=2*Math.PI);let o=r-t;if(c.continuous[s]||e){let n=t+o/2,r=Math.cos(n)*i,l=Math.sin(n)*i;a[2*u+0]=f+r*(e?-1:1),a[2*u+1]=m+l*(e?-1:1),d[u]=s,u++}else{let e=Math.max(1,Math.floor(n/4*Math.abs(o)/Math.PI));for(let n=0;n<=e;n++){let r=t+o*(n/e),l=Math.cos(r)*i,c=Math.sin(r)*i;a[2*u+0]=f+l,a[2*u+1]=m+c,d[u]=s,u++}}}else a[2*u+0]=f+g,a[2*u+1]=m+v,d[u]=s,o[s]=u,u++,a[2*u+0]=f,a[2*u+1]=m,d[u]=s,u++,a[2*u+0]=f+y,a[2*u+1]=m+b,d[u]=s,h[s]=u,u++}let p=rR({windingRule:TD.POSITIVE,elementType:RD.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[a],edgeCreateCallback:e=>{let t=e.Org.idx,i=d[t],n=d[(t+1)%d.length];e.idx=[i,n],e.Sym.idx=[n,i]},vertexIdCallback:e=>{let t=e.Lprev.idx;return[t?t[1]:0,e.idx?e.idx[0]:0]}});if(!p)throw console.log("Error"),new Error("error generating bevel geometry for ".concat(s,"'th loop"));if(!p.vertexCount){let e=(s-1)/this._bevelSegments*Math.PI/2;v=(1-Math.sin(e))*this._bevel;break}for(let e=0;e<p.vertexIndices.length;e++){let[t,i]=p.vertexIndices[e];if(t===i)continue;let n=i;i<t&&(n+=r);for(let a=t;a<n;a++){let n=a%r,s=(a+1)%r;if(!c.continuous[n]||!c.continuous[s]){p.vertexIndices[e]=[t,n],p.vertexIndices.splice(e+1,0,[s,i]),p.vertices.splice(2*(e+1),0,p.vertices[2*e],p.vertices[2*e+1]);break}}}g.push({bevelI:s,angle:t,size:i,boundary:p,reverseMap:d,insetPoints:a})}let y=(e,t,i)=>{let n=0,r=e.boundary.vertexIndices.length;for(;n<r&&i(e.boundary.vertexIndices[t]);)t=(t+1)%r,n++;return n},w=b.length;for(let n=1;n<g.length;n++){let e=g[n-1],t=g[n],i=e.boundary.vertexIndices.length,a=t.boundary.vertexIndices.length;if(!i||!a)break;let o=c.concave.length,l=0,h=dR(l,r);for(;!e.boundary.vertexIndices.filter(h).length||!t.boundary.vertexIndices.filter(h).length;)l++,h=dR(l,r);let d=e.boundary.vertexIndices.findIndex(h),u=t.boundary.vertexIndices.findIndex(h);do{d=(d+1)%i}while(h(e.boundary.vertexIndices[d]));do{u=(u+1)%a}while(h(t.boundary.vertexIndices[u]));l=(l+1)%r;let p,f,m=l,v=0,x=this._buildBevelVert(c,e,(d-1+i)%i,void 0,v),w=this._buildBevelVert(c,t,(u-1+a)%a,void 0,v),_=!1;do{v=(l||o)/o,h=dR(l,r);let n=y(e,d,h),m=y(t,u,h),g=_;if(_=!1,n&&!m){for(let t=0;t<n;t++)p=this._buildBevelVert(c,e,(d+t)%i,t/(n-1),v),b.push(x.topN,p.topP,w.topN),!1===s&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p;_=!0}else if(!n&&m)for(let e=0;e<m;e++)f=this._buildBevelVert(c,t,(u+e)%a,e/(m-1),v),b.push(w.topN,x.topP,f.topP),!1===s&&b.push(x.bottomP,w.bottomN,f.bottomP),w=f;else if(n&&m)if(p=this._buildBevelVert(c,e,d,0,v),f=this._buildBevelVert(c,t,u,0,v),g?(b.push(x.topN,f.topP,w.topN),b.push(x.topN,p.topP,f.topP),!1===s&&(b.push(f.bottomP,x.bottomN,w.bottomN),b.push(f.bottomP,p.bottomP,x.bottomN))):(b.push(w.topN,x.topN,p.topP),b.push(w.topN,p.topP,f.topP),!1===s&&(b.push(p.bottomP,x.bottomN,w.bottomN),b.push(p.bottomP,w.bottomN,f.bottomP))),x=p,w=f,n===m)for(let r=1;r<n;r++)p=this._buildBevelVert(c,e,(d+r)%i,r/(n-1),v),f=this._buildBevelVert(c,t,(u+r)%a,r/(m-1),v),b.push(x.topN,p.topP,w.topN),b.push(w.topN,p.topP,f.topP),!1===s&&(b.push(p.bottomP,x.bottomN,w.bottomN),b.push(p.bottomP,w.bottomN,f.bottomP)),x=p,w=f;else if(n>m){let r=n/m,o=0;for(let l=1;l<n;l++)p=this._buildBevelVert(c,e,(d+l)%i,l/(n-1),v),b.push(x.topN,p.topP,w.topN),!1===s&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p,l>(o+1)*r&&(o++,f=this._buildBevelVert(c,t,(u+o)%a,o/(m-1),v),b.push(w.topN,p.topP,f.topP),!1===s&&b.push(p.bottomP,w.bottomN,f.bottomP),w=f)}else{let r=m/n,o=0;for(let l=1;l<m;l++)f=this._buildBevelVert(c,t,(u+l)%a,l/(m-1),v),b.push(w.topN,p.topP,f.topP),!1===s&&b.push(p.bottomP,w.bottomN,f.bottomP),w=f,l>(o+1)*r&&(o++,p=this._buildBevelVert(c,e,(d+o)%i,o/(n-1),v),b.push(x.topN,p.topP,w.topN),!1===s&&b.push(p.bottomP,x.bottomN,w.bottomN),x=p)}d=(d+n)%i,u=(u+m)%a,l=(l+1)%o}while(l!==m)}if(!1===s&&this._depth>2*this._bevel&&this._buildWall(g,c,b),e){let e=[];for(let t=b.length-1;t>=w+2;t-=3){let i=b[t-2],n=b[t-1],r=b[t-0];e.push(r,n,i)}b.splice(w,b.length-w,...e)}if(e){let e=[];for(let t=g[g.length-1].boundary.vertices.length-1;t>=1;t-=2){let i=g[g.length-1].boundary.vertices[t-1],n=g[g.length-1].boundary.vertices[t-0];e.push(i,n)}x.push(e)}if(!e){let e,t=g[g.length-1];try{e=rR({windingRule:g.length>1?TD.POSITIVE:TD.ODD,elementType:RD.POLYGONS,vertexSize:2,strict:!0,contours:[t.insetPoints,...x]})}catch{e=hR}if(!e)throw new Error("Error generating geometry for surface");0===d.length&&this._bevel<o&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let i=0;i<3*e.elementCount;i+=3){let t=this._buildSurfaceVert(e,e.elements[i+0],v),n=this._buildSurfaceVert(e,e.elements[i+1],v),r=this._buildSurfaceVert(e,e.elements[i+2],v);b.push(t.top,n.top,r.top),!1===s&&b.push(r.bottom,n.bottom,t.bottom)}}this.vertexCache={}}this._buffer.shrink();let w=new kc(Uint32Array.from(b),1),_=new kc(this._buffer.positions,3),S=new kc(this._buffer.normals,3),A=new kc(this._buffer.uvs,2);_.needsUpdate=!0,S.needsUpdate=!0,A.needsUpdate=!0,w.needsUpdate=!0,this.setAttribute("position",_),this.setAttribute("normal",S),this.setAttribute("uv",A),this.setIndex(w)}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,a=n.boundary.vertexCount;r<a;r++){let e=this._buildBevelVert(t,n,r),s=this._buildBevelVert(t,n,(r+1)%a);i.push(s.topP,e.topN,e.bottomN),i.push(s.topP,e.bottomN,s.bottomP)}}_buildSurfaceVert(e,t,i){let n=t.toString();if(n in this.vertexCache)return this.vertexCache[n];let r=e.vertices[2*t+0],a=e.vertices[2*t+1],s=(r-this._minX)/this._width,o=(a-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=3*l,h=2*l,d={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=r,this._buffer.positions[c+1]=a,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[h+0]=s,this._buffer.uvs[h+1]=o,!1===this.forPathBevel&&(this._buffer.positions[c+3]=r,this._buffer.positions[c+4]=a,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[h+2]=s,this._buffer.uvs[h+3]=o),this.vertexCache[n]=d,d}_buildBevelVert(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,a="".concat(t.bevelI,":").concat(i);if(a in this.vertexCache&&0!==r&&1!==r&&(!r||r===this.vertexCache[a].pathBevelUCoord))return this.vertexCache[a];let s,o,l,c,[h,d]=t.boundary.vertexIndices[i];h!==d?(o=h,s=d,c=!1,l=e.continuous[o]&&e.continuous[s]):(s=h,o=(s-1+e.count)%e.count,c=e.concave[s]&&t.bevelI>0,l=e.continuous[s]||c);let u=Math.cos(t.angle),p=Math.sin(t.angle),f=2*i,m=2*s,g=2*o,v=t.boundary.vertices[f+0],y=t.boundary.vertices[f+1],b=(1-p)*this._bevel,x=(v-this._minX)/this._width,w=(y-this._minY)/this._height;this.forPathBevel&&(void 0!==r&&(x=r),w=1);let _=e.normals[m+0],S=e.normals[m+1],A=e.normals[g+0],E=e.normals[g+1];if(c){_+=(A-_)*(1-n),S+=(E-S)*(1-n);let e=Math.sqrt(_*_+S*S);_/=e,S/=e}let C=this.forPathBevel?this._buffer.get(l?1:2):this._buffer.get(l?2:4),M=3*C,P=2*C,T={i:i,fi:s,topP:C+0,topN:C+0,bottomP:C+1,bottomN:C+1,pathBevelUCoord:r};return this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=_*u,this._buffer.normals[M+1]=S*u,this._buffer.normals[M+2]=p,this._buffer.uvs[P+0]=x,this._buffer.uvs[P+1]=w,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=_*u,this._buffer.normals[M+4]=S*u,this._buffer.normals[M+5]=-p,this._buffer.uvs[P+2]=w,this._buffer.uvs[P+3]=x),l||(this.forPathBevel?(C+=1,M+=3,P+=2):(C+=2,M+=6,P+=4),T.topP=C+0,T.bottomP=C+1,this._buffer.positions[M+0]=v,this._buffer.positions[M+1]=y,this._buffer.positions[M+2]=(this.forPathBevel?this._bevel:this._depth)-b,this._buffer.normals[M+0]=A*u,this._buffer.normals[M+1]=E*u,this._buffer.normals[M+2]=p,this._buffer.uvs[P+0]=x,this._buffer.uvs[P+1]=w,!1===this.forPathBevel&&(this._buffer.positions[M+3]=v,this._buffer.positions[M+4]=y,this._buffer.positions[M+5]=b,this._buffer.normals[M+3]=A*u,this._buffer.normals[M+4]=E*u,this._buffer.normals[M+5]=-p,this._buffer.uvs[P+2]=w,this._buffer.uvs[P+3]=x)),this.vertexCache[a]=T,T}clone(){let e=new uR(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=gw(this.userData),e}},pR=class extends Wc{constructor(e){var t,i,n,r,a,s;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.type="ShapeGeometry",this.windingRule=TD.ODD,this.elementType=RD.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=e,this._curveSegments=o,this._triangulationOptions=Object.assign({windingRule:TD.ODD,elementType:RD.POLYGONS,polySize:3,vertexSize:2,strict:!0},l);let c,h,d,u=this._shape.extractShapePointsToFlatArray([],this._curveSegments),p=this._shape.shapeHoles.map((e=>e.extractShapePointsToFlatArray([],this._curveSegments))),f=!0,m=!0;for(let y=0,b=u.length/2;y<b;y++){let e=2*y,t=u[e+0],i=u[e+1];if(void 0!==h&&t!==h&&(f=!1),void 0!==d&&i!==d&&(m=!1),h=t,d=i,!f&&!m)break}if(!f&&!m)try{c=rR({contours:[u,...p],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{c=lR}let g=null!==(t=null===(i=c)||void 0===i?void 0:i.vertexCount)&&void 0!==t?t:1,v=null!==(n=null===(r=c)||void 0===r?void 0:r.elementCount)&&void 0!==n?n:1;if(this._positionAttribute=new kc(new Float32Array(3*g),3),this._normalAttribute=new kc(new Float32Array(3*g),3),this._uvAttribute=new kc(new Float32Array(2*g),2),this._indexAttribute=new kc(new Uint32Array(3*v),1),c){let e=1/0,t=-1/0,i=1/0,n=-1/0;for(let s=0,o=g;s<o;s++){let r=2*s,a=c.vertices[r+0],o=c.vertices[r+1];a<e&&(e=a),a>t&&(t=a),o<i&&(i=o),o>n&&(n=o)}let r=t-e,a=n-i;for(let s=0,o=g;s<o;s++){let t=2*s,n=c.vertices[t+0],o=c.vertices[t+1],l=(n-e)/r,h=(o-i)/a;this._positionAttribute.setXYZ(s,n,o,0),this._normalAttribute.setXYZ(s,0,0,1),this._uvAttribute.setXY(s,l,h)}for(let s=0,o=v;s<o;s++){let e=3*s,t=c.elements[e+0],i=c.elements[e+1],n=c.elements[e+2];this._indexAttribute.setX(e+0,t),this._indexAttribute.setX(e+1,i),this._indexAttribute.setX(e+2,n)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,3*(null!==(a=null===(s=c)||void 0===s?void 0:s.elementCount)&&void 0!==a?a:1))}clone(){let e=new pR(this._shape,this._curveSegments);return e.userData=gw(this.userData),e}},fR=class extends uR{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:12,arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,arguments.length>5&&void 0!==arguments[5]?arguments[5]:TD.ODD),this.type="ShapeGeometry"}_computeBufferEstimatedSize(e){return 2*e.vertexCount*(2+this._bevelSegments)}_buildWall(e,t,i){let n=e[0];for(let r=0,a=n.boundary.vertexCount;r<a;r++){let e=this._buildBevelVert(t,n,r),s=this._buildBevelVert(t,n,(r+1)%a);i.push(s.topP,e.topN,e.bottomN),i.push(s.topP,e.bottomN,s.bottomP)}}clone(){let e=new fR(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return e.userData=gw(this.userData),e}},mR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r,a,s,o,l,c,h;let d=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:TD.ODD},e.parameters),u=Math.abs(d.width),p=Math.abs(null!==(n=d.height)&&void 0!==n?n:d.width),f=Math.abs(null!==(r=d.depth)&&void 0!==r?r:0),m=null!==(a=e.shape)&&void 0!==a?a:null===t||void 0===t?void 0:t.shape,g=null!==(s=null===(o=m)||void 0===o?void 0:o.roundness)&&void 0!==s?s:d.roundness;void 0!==m&&(m instanceof ND?(m.width!==u||m.height!==p)&&m.applySize(u,p):m=new ND(u,p).fromJSON(m),void 0!==(null===(l=e.parameters)||void 0===l?void 0:l.roundness)&&(null===(c=e.parameters)||void 0===c?void 0:c.roundness)>0&&m.update());let v=null!==(h=m)&&void 0!==h?h:new ND(u,p);return{parameters:Object.assign(d,{width:u,height:p,depth:f,roundness:g}),shape:v}}static build(e){let t,{depth:i,extrudeBevelSize:n,extrudeBevelSegments:r,subdivisions:a,roundness:s,windingRule:o}=e.parameters;return e.shape.roundness=s,t=i<=0?new pR(e.shape,a,{windingRule:o}):new fR(e.shape,i,n,a,r,o),Object.assign(t,{userData:{...e,type:"VectorGeometry"}})}},gR=2*Math.PI,vR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return a.angle=Uo.clamp(a.angle,0,360),{shape:e.shape&&e.shape instanceof ND?e.shape:new ND,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:0)})}}static build(e){let t,{width:i,height:n,spikes:r,angle:a,innerRadius:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,d=function(e,t,i,n,r,a){if(n>=gR)return r>30||r%4===0?(function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=.5522847498,o=t*s,l=i*s;e.addPoint(xR(r-t,a,r-t,a-l,r-t,a+l)),e.addPoint(xR(r,a+i,r-o,a+i,r+o,a+i)),e.addPoint(xR(r+t,a,r+t,a+l,r+t,a-l)),e.addPoint(xR(r,a-i,r+o,a-i,r-o,a-i)),n>0&&_R(e,t,i,n)}(e,t,i,a),Math.round(r/4)):yR(e,n,r,t,i,a);n=Math.max(n,.001);let s={x:0,y:i},o=n+.5*Math.PI,l={x:Math.cos(o)*t,y:Math.sin(o)*i},c=GD({px:s.x,py:s.y,cx:l.x,cy:l.y,rx:t,ry:i,largeArcFlag:n>Math.PI,sweepFlag:!0});return r>30||r%c.length===0?function(e,t,i,n,r,a,s,o){let l=Math.round(r/n.length);e.addPoint(bR(t,i));for(let c=0,h=n.length;c<h;c++){let t=n[c],i=e.points[c],r=bR(t.x,t.y);i.controls[1].position.set(t.x1,t.y1),r.controls[0].position.set(t.x2,t.y2),e.addPoint(r)}return o>0?wR(e,a,s,o):e.addPoint(bR(0,0)),l}(e,s.x,s.y,c,r,t,i,a):yR(e,n,r,t,i,a)}(h,.5*i,.5*n,a*Math.PI/180,r,s);return h.isClosed=!0,h.update(),0===a?(t=new Wc,t.setAttribute("position",new Bc([],3))):t=mR.create({shape:h,parameters:{subdivisions:d,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}}),Object.assign(t,{userData:{...e,type:"EllipseGeometry"}})}};function yR(e,t,i,n,r,a){let s=-t/i;for(let o=0;o<=i;o++){let t=s*o,i=Math.sin(t)*n,a=Math.cos(t)*r;e.addPoint(bR(i,a))}return t<gR?a>0?wR(e,n,r,a):e.addPoint(bR(0,0)):(e.removePoint(e.points[e.points.length-1]),a>0&&_R(e,n,r,a)),1}function bR(e,t){return new aD(Uo.generateUUID(),new jo(e,t))}function xR(e,t,i,n,r,a){let s=bR(e,t);return s.controls[0].position.set(i,n),s.controls[1].position.set(r,a),s}function wR(e,t,i,n){SR(e,t,i,n).forEach((t=>e.addPoint(t)))}function _R(e,t,i,n){let r=SR(e,t,i,n),a=new ND;r.forEach((e=>a.addPoint(e))),a.isClosed=!0,e.shapeHoles.push(a)}function SR(e,t,i,n){let r=n*t/100,a=r*(Math.abs(i)/Math.abs(t)),s=new jo(r/t,a/i),o=e.points.map((e=>{let t=e.clone();return t.uuid=Uo.generateUUID(),t})).reverse();return o.forEach((e=>{e.position.multiply(s);let t=e.controls[0].position.clone().multiply(s),i=e.controls[1].position.clone().multiply(s);e.controls[0].position.copy(i),e.controls[1].position.copy(t)})),o}var AR=new Fc([0,0,0],1),ER=class extends Wc{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,o=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,l=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1;if(super(),0===n)return;let c=e&&1===n;c&&(l=0),o>100&&(o=100),0===o&&(l=0);let h,d,u,p,f,m,g,v,y=()=>new gl,b=new gl,x=y(),w=y(),_=y(),S=y(),A=y(),E=y(),C=y(),M=y(),P=y(),T=y(),D=y(),R=t-2*a+.001,O=R/n,I=Math.ceil(r*n),k=I+1,L=R/I,F=-R/2,B=s+1,N=2*Math.PI/s,z=Math.PI/2/l,U=Math.min((1-o/100)*a,a-.01),j=a-U,V=0,G=2*l+2,H=B*G/2,W=H+B*k,q=Math.max(0,B*(k+G)),[X,Y,Q]=[3,3,2].map((e=>Array(q*e).fill(0))),K=[],Z=i-a;function J(t,i){let n=Math.PI/2;m=i*L,v=2*Math.PI*(m%O)/O+n,m+=F,g=Math.sin(v)*Z,f=Math.cos(v)*Z,e?t.set(f,g,m):t.set(f,m,g)}J(b,-1e-10),J(x,0),S.copy(b),J(b,1);let $=b.distanceTo(x),ee=c?0:j+U,te=$*I+2*ee,ie=U,ne=te-ee;for(let oe=0;oe<=I;oe++){J(w,oe),D.subVectors(w,S).normalize(),S.copy(w),P.copy(w).setComponent(+e+1,0).normalize(),T.crossVectors(D,P).normalize();let t=0===oe,i=oe===I,n=t?3*Math.PI/2:z,r=t?ie:ne,o=t?B:W,h=t?0:q-B,d=D.clone().multiplyScalar(t?-j:j).add(w),u=D.clone().multiplyScalar(t?-1:1).normalize();for(let e=0;e<B;e++){let p=e*N;if(A.addVectors(b.copy(P).multiplyScalar(a*Math.cos(p)),x.copy(T).multiplyScalar(a*Math.sin(p))),E.copy(A).normalize(),t||i){c||(V=h+e,[0,1,2].forEach((e=>{X[3*V+e]=d.getComponent(e),Y[3*V+e]=u.getComponent(e)})),Q[2*V]=+i,Q[2*V+1]=e/s),x.copy(E).multiplyScalar(U),_.addVectors(w,x);for(let i=0;i<l;i++){let a=i*z+n;C.addVectors(b.copy(D).multiplyScalar(j*Math.sin(a)),x.copy(E).multiplyScalar(j*Math.cos(a))),M.copy(C).normalize(),x.addVectors(_,C),C.normalize(),V=o+i*B+e,[0,1,2].forEach((e=>{X[3*V+e]=x.getComponent(e),Y[3*V+e]=M.getComponent(e)}));let l=+t+Math.sin(a);Q[2*V]=(r+j*l)/te,Q[2*V+1]=e/s}}x.addVectors(w,A),V=H+oe*B+e,[0,1,2].forEach((e=>{X[3*V+e]=x.getComponent(e),Y[3*V+e]=E.getComponent(e)})),Q[2*V]=(ee+oe*$)/te,Q[2*V+1]=e/s}}let re=k+2*l+2,[ae,se]=[+c,re-1];for(let oe=ae;oe<=se-1;oe++){let e=c&&oe===se-1;for(let t=0;t<B-1;t++)h=oe*B+t,d=h+1,u=(e?t:h)+B,p=(e?t+1:d)+B,0===oe?K.push(d,p,u):oe===re-2?K.push(h,d,u):K.push(h,d,u,d,p,u)}this.setIndex(K),this.setAttribute("position",new Bc(X,3)),this.setAttribute("normal",new Bc(Y,3)),this.setAttribute("uv",new Bc(Q,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let e,t,i,n,r=this.userData.parameters,a=Math.ceil(r.tubularSegments),s=r.radialSegments+1,o=Array.from(this.getIndex().array),l=6*(a-1)*r.radialSegments,c=a,h=c===a;for(let d=0;d<r.radialSegments;d++)e=c*s+d,t=e+1,i=(h?d:e)+s,n=(h?d+1:t)+s,o[l++]=e,o[l++]=t,o[l++]=i,o[l++]=t,o[l++]=n,o[l++]=i;return o.length=l,AR.array=o,AR.count=o.length,AR}},CR=class extends eD{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=(1+Math.sqrt(5))/2,r="IcosahedronGeometry";super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r,e,t,i),this.type=r}static fromJSON(e){return new CR(e.radius,e.corner,e.cornerSides)}},MR=new ql,PR=new vc,TR=new gl,DR=class extends Co{constructor(){super(),this.uuid=Uo.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(e){let t=(new Vo).getNormalMatrix(e);for(let i=0,n=this.vertices.length;i<n;i++)this.vertices[i].applyMatrix4(e);for(let i=0,n=this.faces.length;i<n;i++){let e=this.faces[i];e.normal.applyMatrix3(t).normalize();for(let i=0,n=e.vertexNormals.length;i<n;i++)e.vertexNormals[i].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(e){return MR.makeRotationX(e),this.applyMatrix4(MR),this}rotateY(e){return MR.makeRotationY(e),this.applyMatrix4(MR),this}rotateZ(e){return MR.makeRotationZ(e),this.applyMatrix4(MR),this}translate(e,t,i){return MR.makeTranslation(e,t,i),this.applyMatrix4(MR),this}scale(e,t,i){return MR.makeScale(e,t,i),this.applyMatrix4(MR),this}lookAt(e){return PR.lookAt(e),PR.updateMatrix(),this.applyMatrix4(PR.matrix),this}fromBufferGeometry(e){let t=this,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let r=n.position,a=n.normal,s=n.color,o=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let d=0;d<r.count;d++)t.vertices.push((new gl).fromBufferAttribute(r,d)),void 0!==s&&t.colors.push((new rl).fromBufferAttribute(s,d));function c(e,i,n,r){let c=void 0===s?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()],h=void 0===a?[]:[(new gl).fromBufferAttribute(a,e),(new gl).fromBufferAttribute(a,i),(new gl).fromBufferAttribute(a,n)],d=new OR(e,i,n,h,c,r);t.faces.push(d),void 0!==o&&t.faceVertexUvs[0].push([(new jo).fromBufferAttribute(o,e),(new jo).fromBufferAttribute(o,i),(new jo).fromBufferAttribute(o,n)]),void 0!==l&&t.faceVertexUvs[1].push([(new jo).fromBufferAttribute(l,e),(new jo).fromBufferAttribute(l,i),(new jo).fromBufferAttribute(l,n)])}let h=e.groups;if(h.length>0)for(let d=0;d<h.length;d++){let e=h[d],t=e.start;for(let n=t,r=t+e.count;n<r;n+=3)void 0!==i?c(i.getX(n),i.getX(n+1),i.getX(n+2),e.materialIndex):c(n,n+1,n+2,e.materialIndex)}else if(void 0!==i)for(let d=0;d<i.count;d+=3)c(i.getX(d),i.getX(d+1),i.getX(d+2));else for(let d=0;d<r.count;d+=3)c(d,d+1,d+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(TR).negate(),this.translate(TR.x,TR.y,TR.z),this}normalize(){this.computeBoundingSphere();let e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,n=new ql;return n.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(n),this}computeFaceNormals(){let e=new gl,t=new gl;for(let i=0,n=this.faces.length;i<n;i++){let n=this.faces[i],r=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];e.subVectors(s,a),t.subVectors(r,a),e.cross(t),e.normalize(),n.normal.copy(e)}}computeVertexNormals(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=new Array(this.vertices.length);for(let i=0,n=this.vertices.length;i<n;i++)t[i]=new gl;if(e){let e=new gl,i=new gl;for(let n=0,r=this.faces.length;n<r;n++){let r=this.faces[n],a=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c];e.subVectors(o,s),i.subVectors(a,s),e.cross(i),t[r.a].add(e),t[r.b].add(e),t[r.c].add(e)}}else{this.computeFaceNormals();for(let e=0,i=this.faces.length;e<i;e++){let i=this.faces[e];t[i.a].add(i.normal),t[i.b].add(i.normal),t[i.c].add(i.normal)}}for(let i=0,n=this.vertices.length;i<n;i++)t[i].normalize();for(let i=0,n=this.faces.length;i<n;i++){let e=this.faces[i],n=e.vertexNormals;3===n.length?(n[0].copy(t[e.a]),n[1].copy(t[e.b]),n[2].copy(t[e.c])):(n[0]=t[e.a].clone(),n[1]=t[e.b].clone(),n[2]=t[e.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],i=t.vertexNormals;3===i.length?(i[0].copy(t.normal),i[1].copy(t.normal),i[2].copy(t.normal)):(i[0]=t.normal.clone(),i[1]=t.normal.clone(),i[2]=t.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let t=0,i=this.faces.length;t<i;t++){let e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,i=e.vertexNormals.length;t<i;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}let e=new DR;e.faces=this.faces;for(let t=0,i=this.morphTargets.length;t<i;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[];let e=this.morphNormals[t].faceNormals,i=this.morphNormals[t].vertexNormals;for(let t=0,n=this.faces.length;t<n;t++){let t=new gl,n={a:new gl,b:new gl,c:new gl};e.push(t),i.push(n)}}let i=this.morphNormals[t];e.vertices=this.morphTargets[t].vertices,e.computeFaceNormals(),e.computeVertexNormals();for(let e=0,t=this.faces.length;e<t;e++){let t=this.faces[e],n=i.faceNormals[e],r=i.vertexNormals[e];n.copy(t.normal),r.a.copy(t.vertexNormals[0]),r.b.copy(t.vertexNormals[1]),r.c.copy(t.vertexNormals[2])}}for(let t=0,i=this.faces.length;t<i;t++){let e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new bl),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Bl),this.boundingSphere.setFromPoints(this.vertices)}merge(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);let n,r=this.vertices.length,a=this.vertices,s=e.vertices,o=this.faces,l=e.faces,c=this.colors,h=e.colors;void 0!==t&&(n=(new Vo).getNormalMatrix(t));for(let d=0,u=s.length;d<u;d++){let e=s[d].clone();void 0!==t&&e.applyMatrix4(t),a.push(e)}for(let d=0,u=h.length;d<u;d++)c.push(h[d].clone());for(let d=0,u=l.length;d<u;d++){let e,t,a=l[d],s=a.vertexNormals,c=a.vertexColors,h=new OR(a.a+r,a.b+r,a.c+r);h.normal.copy(a.normal),void 0!==n&&h.normal.applyMatrix3(n).normalize();for(let i=0,r=s.length;i<r;i++)e=s[i].clone(),void 0!==n&&e.applyMatrix3(n).normalize(),h.vertexNormals.push(e);h.color.copy(a.color);for(let i=0,n=c.length;i<n;i++)t=c[i],h.vertexColors.push(t.clone());h.materialIndex=a.materialIndex+i,o.push(h)}for(let d=0,u=e.faceVertexUvs.length;d<u;d++){let t=e.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(let e=0,i=t.length;e<i;e++){let i=t[e],n=[];for(let e=0,t=i.length;e<t;e++)n.push(i[e].clone());this.faceVertexUvs[d].push(n)}}}mergeMesh(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)}mergeVertices(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t={},i=[],n=[],r=Math.pow(10,e);for(let o=0,l=this.vertices.length;o<l;o++){let e=this.vertices[o],a=Math.round(e.x*r)+"_"+Math.round(e.y*r)+"_"+Math.round(e.z*r);void 0===t[a]?(t[a]=o,i.push(this.vertices[o]),n[o]=i.length-1):n[o]=n[t[a]]}let a=[];for(let o=0,l=this.faces.length;o<l;o++){let e=this.faces[o];e.a=n[e.a],e.b=n[e.b],e.c=n[e.c];let t=[e.a,e.b,e.c];for(let i=0;i<3;i++)if(t[i]===t[(i+1)%3]){a.push(o);break}}for(let o=a.length-1;o>=0;o--){let e=a[o];this.faces.splice(e,1);for(let t=0,i=this.faceVertexUvs.length;t<i;t++)this.faceVertexUvs[t].splice(e,1)}let s=this.vertices.length-i.length;return this.vertices=i,s}setFromPoints(e){this.vertices=[];for(let t=0,i=e.length;t<i;t++){let i=e[t];this.vertices.push(new gl(i.x,i.y,i.z||0))}return this}sortFacesByMaterialIndex(){let e=this.faces,t=e.length;for(let s=0;s<t;s++)e[s]._id=s;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));let i,n,r=this.faceVertexUvs[0],a=this.faceVertexUvs[1];r&&r.length===t&&(i=[]),a&&a.length===t&&(n=[]);for(let s=0;s<t;s++){let t=e[s]._id;i&&i.push(r[t]),n&&n.push(a[t])}i&&(this.faceVertexUvs[0]=i),n&&(this.faceVertexUvs[1]=n)}toJSON(){let e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){let t=this.parameters;for(let i in t)void 0!==t[i]&&(e[i]=t[i]);return e}let t=[];for(let p=0;p<this.vertices.length;p++){let e=this.vertices[p];t.push(e.x,e.y,e.z)}let i=[],n=[],r={},a=[],s={},o=[],l={};for(let p=0;p<this.faces.length;p++){let e=this.faces[p],t=!0,n=!1,r=void 0!==this.faceVertexUvs[0][p],a=e.normal.length()>0,s=e.vertexNormals.length>0,o=1!==e.color.r||1!==e.color.g||1!==e.color.b,l=e.vertexColors.length>0,f=0;if(f=c(f,0,0),f=c(f,1,t),f=c(f,2,n),f=c(f,3,r),f=c(f,4,a),f=c(f,5,s),f=c(f,6,o),f=c(f,7,l),i.push(f),i.push(e.a,e.b,e.c),i.push(e.materialIndex),r){let e=this.faceVertexUvs[0][p];i.push(u(e[0]),u(e[1]),u(e[2]))}if(a&&i.push(h(e.normal)),s){let t=e.vertexNormals;i.push(h(t[0]),h(t[1]),h(t[2]))}if(o&&i.push(d(e.color)),l){let t=e.vertexColors;i.push(d(t[0]),d(t[1]),d(t[2]))}}function c(e,t,i){return i?e|1<<t:e&~(1<<t)}function h(e){let t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==r[t]||(r[t]=n.length/3,n.push(e.x,e.y,e.z)),r[t]}function d(e){let t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==s[t]||(s[t]=a.length,a.push(e.getHex())),s[t]}function u(e){let t=e.x.toString()+e.y.toString();return void 0!==l[t]||(l[t]=o.length/2,o.push(e.x,e.y)),l[t]}return e.data={},e.data.vertices=t,e.data.normals=n,a.length>0&&(e.data.colors=a),o.length>0&&(e.data.uvs=[o]),e.data.faces=i,e}clone(){return(new DR).copy(this)}copy(e){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;let t=e.vertices;for(let d=0,u=t.length;d<u;d++)this.vertices.push(t[d].clone());let i=e.colors;for(let d=0,u=i.length;d<u;d++)this.colors.push(i[d].clone());let n=e.faces;for(let d=0,u=n.length;d<u;d++)this.faces.push(n[d].clone());for(let d=0,u=e.faceVertexUvs.length;d<u;d++){let t=e.faceVertexUvs[d];void 0===this.faceVertexUvs[d]&&(this.faceVertexUvs[d]=[]);for(let e=0,i=t.length;e<i;e++){let i=t[e],n=[];for(let e=0,t=i.length;e<t;e++){let t=i[e];n.push(t.clone())}this.faceVertexUvs[d].push(n)}}let r=e.morphTargets;for(let d=0,u=r.length;d<u;d++){let e={};if(e.name=r[d].name,void 0!==r[d].vertices){e.vertices=[];for(let t=0,i=r[d].vertices.length;t<i;t++)e.vertices.push(r[d].vertices[t].clone())}if(void 0!==r[d].normals){e.normals=[];for(let t=0,i=r[d].normals.length;t<i;t++)e.normals.push(r[d].normals[t].clone())}this.morphTargets.push(e)}let a=e.morphNormals;for(let d=0,u=a.length;d<u;d++){let e={};if(void 0!==a[d].vertexNormals){e.vertexNormals=[];for(let t=0,i=a[d].vertexNormals.length;t<i;t++){let i=a[d].vertexNormals[t],n={};n.a=i.a.clone(),n.b=i.b.clone(),n.c=i.c.clone(),e.vertexNormals.push(n)}}if(void 0!==a[d].faceNormals){e.faceNormals=[];for(let t=0,i=a[d].faceNormals.length;t<i;t++)e.faceNormals.push(a[d].faceNormals[t].clone())}this.morphNormals.push(e)}let s=e.skinWeights;for(let d=0,u=s.length;d<u;d++)this.skinWeights.push(s[d].clone());let o=e.skinIndices;for(let d=0,u=o.length;d<u;d++)this.skinIndices.push(o[d].clone());let l=e.lineDistances;for(let d=0,u=l.length;d<u;d++)this.lineDistances.push(l[d]);let c=e.boundingBox;null!==c&&(this.boundingBox=c.clone());let h=e.boundingSphere;return null!==h&&(this.boundingSphere=h.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}toBufferGeometry(){let e=(new RR).fromGeometry(this),t=new Wc,i=new Float32Array(3*e.vertices.length);if(t.setAttribute("position",FR.call(new kc(i,3),e.vertices)),e.normals.length>0){let i=new Float32Array(3*e.normals.length);t.setAttribute("normal",FR.call(new kc(i,3),e.normals))}if(e.colors.length>0){let i=new Float32Array(3*e.colors.length);t.setAttribute("color",kR.call(new kc(i,3),e.colors))}if(e.uvs.length>0){let i=new Float32Array(2*e.uvs.length);t.setAttribute("uv",LR.call(new kc(i,2),e.uvs))}if(e.uvs2.length>0){let i=new Float32Array(2*e.uvs2.length);t.setAttribute("uv2",LR.call(new kc(i,2),e.uvs2))}t.groups=e.groups;for(let n in e.morphTargets){let i=[],r=e.morphTargets[n];for(let e=0,t=r.length;e<t;e++){let t=r[e],n=new Bc(3*t.data.length,3);n.name=t.name,i.push(FR.call(n,t.data))}t.morphAttributes[n]=i}if(e.skinIndices.length>0){let i=new Bc(4*e.skinIndices.length,4);t.setAttribute("skinIndex",BR.call(i,e.skinIndices))}if(e.skinWeights.length>0){let i=new Bc(4*e.skinWeights.length,4);t.setAttribute("skinWeight",BR.call(i,e.skinWeights))}return null!==e.boundingSphere&&(t.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(t.boundingBox=e.boundingBox.clone()),t}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(e){let t=new Wc,i=e.geometry;if(e.isPoints||e.isLine){let e=new Bc(3*i.vertices.length,3),n=new Bc(3*i.colors.length,3);if(t.setAttribute("position",FR.call(e,i.vertices)),t.setAttribute("color",kR.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let e=new Bc(i.lineDistances.length,1);t.setAttribute("lineDistance",IR.call(e,i.lineDistances))}null!==i.boundingSphere&&(t.boundingSphere=i.boundingSphere.clone()),null!==i.boundingBox&&(t.boundingBox=i.boundingBox.clone())}else e.isMesh&&(t=i.toBufferGeometry());return t}};DR.prototype.isGeometry=!0;var RR=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(e){let t,i,n,r=[],a=e.faces;for(i=0;i<a.length;i++){let e=a[i];e.materialIndex!==n&&(n=e.materialIndex,void 0!==t&&(t.count=3*i-t.start,r.push(t)),t={start:3*i,materialIndex:n})}void 0!==t&&(t.count=3*i-t.start,r.push(t)),this.groups=r}fromGeometry(e){let t,i=e.faces,n=e.vertices,r=e.faceVertexUvs,a=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,o=e.morphTargets,l=o.length;if(l>0){t=[];for(let e=0;e<l;e++)t[e]={name:o[e].name,data:[]};this.morphTargets.position=t}let c,h=e.morphNormals,d=h.length;if(d>0){c=[];for(let e=0;e<d;e++)c[e]={name:h[e].name,data:[]};this.morphTargets.normal=c}let u=e.skinIndices,p=e.skinWeights,f=u.length===n.length,m=p.length===n.length;n.length>0&&0===i.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let g=0;g<i.length;g++){let e=i[g];this.vertices.push(n[e.a],n[e.b],n[e.c]);let v=e.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{let t=e.normal;this.normals.push(t,t,t)}let y=e.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{let t=e.color;this.colors.push(t,t,t)}if(!0===a){let e=r[0][g];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",g),this.uvs.push(new jo,new jo,new jo))}if(!0===s){let e=r[1][g];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",g),this.uvs2.push(new jo,new jo,new jo))}for(let i=0;i<l;i++){let n=o[i].vertices;t[i].data.push(n[e.a],n[e.b],n[e.c])}for(let t=0;t<d;t++){let e=h[t].vertexNormals[g];c[t].data.push(e.a,e.b,e.c)}f&&this.skinIndices.push(u[e.a],u[e.b],u[e.c]),m&&this.skinWeights.push(p[e.a],p[e.b],p[e.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}},OR=class{constructor(e,t,i,n,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.a=e,this.b=t,this.c=i,this.normal=n&&n.isVector3?n:new gl,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new rl,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=a}clone(){return(new this.constructor).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}};function IR(e){return this.array.set(e),this}function kR(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new rl),t[i++]=r.r,t[i++]=r.g,t[i++]=r.b}return this}function LR(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new jo),t[i++]=r.x,t[i++]=r.y}return this}function FR(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new gl),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z}return this}function BR(e){let t=this.array,i=0;for(let n=0,r=e.length;n<r;n++){let r=e[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new dl),t[i++]=r.x,t[i++]=r.y,t[i++]=r.z,t[i++]=r.w}return this}var NR=["a","b","c"];function zR(e,t){switch(t){case"c":return e.c;case"b":return e.b;default:return e.a}}function UR(e,t,i){let n=Math.min(e,t)+"_"+Math.max(e,t);return i.get(n)}function jR(e,t,i,n,r,a){let s,o=Math.min(e,t),l=Math.max(e,t),c=o+"_"+l;if(n.has(c))s=n.get(c);else{s={a:i[o],b:i[l],newEdge:null,faces:[]},n.set(c,s)}s.faces.push(r),a[e].edges.push(s),a[t].edges.push(s)}function VR(e,t,i,n,r){e.push(new OR(t,i,n,void 0,void 0,r))}function GR(e,t){return Math.abs(t-e)/2+Math.min(e,t)}function HR(e,t,i,n){e.push([t.clone(),i.clone(),n.clone()])}var WR=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.subdivisions=e}modify(e){(e=e instanceof Wc?(new DR).fromBufferGeometry(e):e.clone()).mergeVertices();let t=this.subdivisions;for(;t-- >0;)this._smooth(e);return e.computeFaceNormals(),e.computeVertexNormals(),e}_smooth(e){let t,i,n,r,a,s=new gl,o=e.vertices,l=e.faces,c=e.faceVertexUvs[0],h=void 0!==c&&c.length>0,d=[],u=new Map;!function(e,t,i,n){let r,a,s;for(r=0,a=e.length;r<a;r++)i[r]={edges:[]};for(r=0,a=t.length;r<a;r++)s=t[r],jR(s.a,s.b,e,n,s,i),jR(s.b,s.c,e,n,s,i),jR(s.c,s.a,e,n,s,i)}(o,l,d,u);let p,f,m,g,v,y,b,x=[];for(let G of Array.from(u.keys())){for(f=u.get(G),m=new gl,v=3/8,y=1/8,b=f.faces.length,2!=b&&(v=.5,y=0),m.addVectors(f.a,f.b).multiplyScalar(v),s.set(0,0,0),r=0;r<b;r++){for(g=f.faces[r],a=0;a<3&&(p=o[zR(g,NR[a])],p===f.a||p===f.b);a++);p&&s.add(p)}s.multiplyScalar(y),m.add(s),f.newEdge=x.length,x.push(m)}let w,_,S,A,E,C,M,P=[];for(i=0,n=o.length;i<n;i++){for(C=o[i],E=d[i].edges,t=E.length,3==t?w=3/16:t>3&&(w=3/(8*t)),_=1-t*Number(w),S=w,t<=2&&(2==t&&(_=3/4,S=1/8)),M=C.clone().multiplyScalar(_),s.set(0,0,0),r=0;r<t;r++)A=E[r],p=A.a!==C?A.a:A.b,s.add(p);s.multiplyScalar(Number(S)),M.add(s),P.push(M)}let T,D,R,O,I,k,L,F=P.concat(x),B=P.length,N=[],z=[],U=new jo,j=new jo,V=new jo;for(i=0,n=l.length;i<n;i++)g=l[i],T=Number(UR(g.a,g.b,u).newEdge)+B,D=Number(UR(g.b,g.c,u).newEdge)+B,R=Number(UR(g.c,g.a,u).newEdge)+B,VR(N,T,D,R,g.materialIndex),VR(N,g.a,T,R,g.materialIndex),VR(N,g.b,D,T,g.materialIndex),VR(N,g.c,R,D,g.materialIndex),h&&(O=c[i],I=O[0],k=O[1],L=O[2],U.set(GR(I.x,k.x),GR(I.y,k.y)),j.set(GR(k.x,L.x),GR(k.y,L.y)),V.set(GR(I.x,L.x),GR(I.y,L.y)),HR(z,U,j,V),HR(z,I,U,V),HR(z,k,j,U),HR(z,L,V,j));e.vertices=F,e.faces=N,h&&(e.faceVertexUvs[0]=z)}},qR=new gl,XR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters);return{shape:e.shape&&e.shape instanceof ND?e.shape:new ND,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t,height:i,spikes:n,cornerRadius:r,depth:a,extrudeBevelSize:s,extrudeBevelSegments:o}=e.parameters,l=e.shape,c=.5*t,h=.5*i,d=2*Math.PI/n;for(let p=0;p<n;p++){let e=d*p,t=0+Math.sin(e)*c,i=0+Math.cos(e)*h;l.addPoint(l.createPoint(t,i))}l.isClosed=!0;for(let p=0,f=l.points.length;p<f;p++)l.points[p].roundness=r;l.roundness=r,l.update();let u=mR.create({shape:l,parameters:{roundness:r,depth:a,extrudeBevelSize:s,extrudeBevelSegments:o}});return Object.assign(u,{userData:{...e,type:"PolygonGeometry"}})}};function YR(e,t,i){i.x=e.x*t.x,i.y=e.y,i.z=e.x*t.y}function QR(e,t,i,n,r,a){let s=t.clone().sub(e),o=i.clone().sub(e),l=s.angleTo(o);if(s.normalize(),o.normalize(),n===r){let t=s.add(o).normalize();a.copy(e).addScaledVector(t,n/Math.sin(l/2))}else{let t=s.angleTo(o);a.copy(e),a.addScaledVector(s,r/Math.sin(t)),a.addScaledVector(o,n/Math.sin(t))}}function KR(e,t,i){let n=e.clone().sub(t),r=i.clone().sub(t);return n.projectOnVector(r),n.add(t)}var ZR=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:4;super(),i=Math.floor(Math.max(3,i)),n=Math.floor(n),s=Math.floor(s);let o,l=[],c=[],h=[],d=[],u=0,p=t/2,f=Math.PI/i,m=e*Math.cos(Math.PI/i),g=2*Math.PI/i,v=(i-2)*Math.PI/i,y=Math.PI-v,b=new gl(0,-p,0),x=new gl(0,p,0),w=new jo(e,-p),_=new jo(m,-p),S=new jo(0,x.y).sub(_),A=new jo(0,x.y).sub(w),E=new jo(S.y,-S.x).normalize(),C=new jo(A.y,-A.x).normalize(),M=e*Math.cos(Math.PI/i)*Math.tan((Math.PI-S.angle())/2)-1e-8;a=Math.min(a,M);{let e=new gl(E.x,E.y,0),t=new gl(Math.cos(g)*e.x,e.y,Math.sin(g)*e.x);o=e.angleTo(t)}let P=a/Math.tan((Math.PI-S.angle())/2),T=a/Math.tan((Math.PI-o)/2),D=new gl;if(!r){c.push(b.x,b.y,b.z),h.push(0,-1,0),d.push(0,0);let e=u++,t=[],n=w.clone(),r=P/Math.cos(Math.PI/i);n.x-=r;for(let a=0;a<i;a++){let e=a/i*Math.PI*2+f;YR(n,new jo(Math.sin(e),Math.cos(e)),D),c.push(D.x,D.y,D.z),h.push(0,-1,0),d.push(0,0),t.push(u++)}for(let i=0;i<t.length;i++)l.push(t[i],e,t[(i+1)%t.length])}let R=[];{let e=new gl,t=new gl,n=new gl,r=new gl,p=new gl,m=new gl;for(let g=0;g<i;g++){let v=g/i*Math.PI*2+f,y=(g+.5)/i*Math.PI*2+f,_=(g+1)/i*Math.PI*2+f,A=new jo(Math.sin(v),Math.cos(v)),M=new jo(Math.sin(y),Math.cos(y)),D=new jo(Math.sin(_),Math.cos(_));YR(w,A,t),YR(w,D,n),YR(E,M,e),QR(x,t,n,T,T,r),c.push(r.x,r.y,r.z),QR(t,x,n,T,P,p),c.push(p.x,p.y,p.z),QR(n,t,x,P,T,m),c.push(m.x,m.y,m.z),h.push(e.x,e.y,e.z),h.push(e.x,e.y,e.z),h.push(e.x,e.y,e.z),d.push(0,0),d.push(0,0),d.push(0,0);let k=u++,L=u++,F=u++;if(l.push(k,L,F),a>0){{let e=t.clone().add(n).multiplyScalar(.5),i=x.clone().sub(e).normalize(),r=b.clone().sub(e).normalize().add(i).normalize().multiplyScalar(-1);O(e,m.clone().sub(p),r,S.angle())}let f,g;{let e=new gl;YR(C,D,e);let t=m.clone().add(r).multiplyScalar(.5);t=KR(t,n,x);let i=m.clone().sub(r);[f,g]=O(t,i,e,o,r.y)}{let e=f,t=e.clone().setY(0).normalize(),i=new gl(0,-1,0),n=t.clone().cross(i);I(e,t,i,n)}R.concat(g);{let t=S.angle(),n=Math.PI-t,r=x.clone();r.y-=a/Math.sin(t-Math.PI/2);let o=new gl,p=[];for(let l=0;l<s;l++){let t=[],f=Math.PI/2-n*l/s,m=Math.cos(f),g=Math.sin(f),v=y;for(let n=0;n<=l;n++){let n=Math.cos(v),s=Math.sin(v);e.x=m*s,e.y=g,e.z=m*n,o.copy(r).addScaledVector(e,a),c.push(o.x,o.y,o.z),h.push(e.x,e.y,e.z),d.push(0,0),t.push(u++),v+=2*Math.PI/l/i}p.push(t)}g.reverse(),p.push(g);let f=p.length-1;for(let e=0;e<f;e++){let t=p[e],i=p[e+1],n=t.length-1;l.push(i[1],t[0],i[0]);for(let e=1;e<=n;e++)l.push(t[e],t[e-1],i[e]),l.push(i[e+1],t[e],i[e])}}}}}function O(e,t,i,n,r){let o=-n/2,p=(Math.PI-n)/2,f=t.clone().normalize().cross(i);e.addScaledVector(i,-a/Math.sin(p));let m=new gl,g=new gl,v=u,y=[];for(let l=0;l<=s;l++){let p=o+l/s*n;g.set(0,0,0),g.addScaledVector(f,Math.sin(p)),g.addScaledVector(i,Math.cos(p));for(let i=0;i<=1;i++){let n=i/1-.5;if(m.copy(e),m.addScaledVector(t,n),m.addScaledVector(g,a),null!=r){let e=Math.max(0,m.y-r);m.addScaledVector(t,-e/t.y)}c.push(m.x,m.y,m.z),h.push(g.x,g.y,g.z),d.push(0,0),0===i&&y.push(u),u++}}for(let a=0;a<s;a++)for(let e=0;e<1;e++){let t=v+e+2*a,i=t+2,n=i+1,r=t+1;l.push(t,i,r),l.push(i,n,r)}return[e.clone().addScaledVector(t,.5),y]}function I(e,t,i,n){let r=Math.PI/2,o=A.angle()-r,p=[],f=new gl,m=new gl;for(let l=0;l<=s;l++){let g=[],v=l/s;for(let s=0;s<=l;s++){let p=((l?s/l:0)-.5)*y,b=Math.cos(p),x=Math.sin(p),w=(r+Math.atan(Math.tan(o)*b))*v,_=Math.cos(w),S=Math.sin(w);f.set(0,0,0),f.addScaledVector(t,S*b),f.addScaledVector(i,_),f.addScaledVector(n,S*x),m.copy(e).addScaledVector(f,a),c.push(m.x,m.y,m.z),h.push(f.x,f.y,f.z),d.push(0,0),g.push(u++)}p.push(g)}let g=p.length-1;for(let a=0;a<g;a++){let e=p[a],t=p[a+1],i=e.length-1;l.push(e[0],t[1],t[0]);for(let n=1;n<=i;n++)l.push(e[n-1],e[n],t[n]),l.push(e[n],t[n+1],t[n])}}this.setIndex(l),this.setAttribute("position",new Bc(c,3)),this.setAttribute("normal",new Bc(h,3)),this.setAttribute("uv",new Bc(d,2))}},JR=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r,a;let s=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters),o=Object.assign(null!==(n=null===t||void 0===t?void 0:t.ui)&&void 0!==n?n:{enabledIndieCorners:!1},e.ui);return{shape:e.shape&&e.shape instanceof ND?e.shape:new ND,parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(r=s.height)&&void 0!==r?r:s.width),depth:Math.abs(null!==(a=s.depth)&&void 0!==a?a:0)}),ui:o}}static build(e){let t=e.shape,{width:i,height:n,cornerRadius:r,cornerType:a,depth:s,extrudeBevelSize:o,extrudeBevelSegments:l}=e.parameters,c={x:.5*i,y:.5*n},h={x:-c.x,y:-c.y},d={x:c.x,y:c.y};function u(e,t,r){return t>i&&r>n?Math.min(e*i/t,e*n/r):t>i?e*i/t:r>n?e*n/r:e}let p=[];p[0]=0===r[0]?0:u(r[0],r[0]+r[3],r[0]+r[1]),p[1]=0===r[1]?0:u(r[1],r[1]+r[2],r[1]+r[0]),p[2]=0===r[2]?0:u(r[2],r[2]+r[1],r[2]+r[3]),p[3]=0===r[3]?0:u(r[3],r[3]+r[0],r[3]+r[2]);let f=h.x,m=d.x,g=d.y,v=h.y;t.addPoint(t.createPoint(f,g)),t.addPoint(t.createPoint(m,g)),t.addPoint(t.createPoint(m,v)),t.addPoint(t.createPoint(f,v)),t.isClosed=!0;let y=!0;for(let x=0,w=t.points.length;x<w;x++)t.points[x].roundness=p[x],x>0&&p[x]!==p[x-1]&&(y=!1);y&&(t.roundness=p[0]),t.useCubicForRoundedCorners=1!==a,t.update();let b=mR.create({shape:t,parameters:{depth:s,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(b,{userData:{...e,type:"RectangleGeometry"}})}},$R=class extends Wc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:90,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:24;super(),this.type="BackdropGeometry";let s=[],o=[],l=[],c=.001;0==r&&(a=1),a=Math.max(1,Math.floor(a)),r=Math.min(r,100),n=Math.min(180-c,n),n*=Math.PI/180;let h=[],d=Math.PI/2,u=function(){return new gl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)},p=u(),f=u(),[m,g,v]=[t/2,e/2,i/2],y=-g,b=+g,[x,w,_]=[u(y,-m,+v),u(y,-m,-v),u(y,+m,-v)],S=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.sin(e-Math.PI/(+t+1))},A=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Math.cos(e-Math.PI/(+t+1))};_.y=Math.sin(n)*t-m;let E=Math.cos(n)*t-v,C=x.z-c;n<=d?(_.z=Math.min(E,C),_.z==C&&(_.y-=(E-C)/Math.tan(d-n))):w.z=Math.min(w.z-E-v,x.z-c),p.subVectors(x,w),f.subVectors(_,w);let M=Math.min(p.length(),f.length())*r/100,P=M*Math.tan(n/2),T=M/Math.cos(n/2),D=p.clone().normalize().add(f.normalize()).setLength(T).add(w);p.set(0,S(n,!0),A(n,!0)),h.push([_,p.clone()]);let R=(Math.PI-n)/a;for(let V=0;V<=a;V++){let e=d+n+V*R;p.set(0,Math.sin(e)*P,Math.cos(e)*P),p.add(D),f.set(0,S(e),A(e)),h.push([p.clone(),f.clone()])}h.push([x,u(0,1,0)]);let O=Math.sin(R/2)*P*2,I=h.length-1,k=h[0][0].distanceTo(h[1][0]),L=k+O*a+h[I-1][0].distanceTo(h[I][0]);h[0].push(1);for(let V=0;V<=a;V++)h[V+1].push(1-(k+V*O)/L);h[I].push(0);let F,B,N,[z,U,j]=h[0];for(let V=1;V<h.length;V++)[F,B,N]=h[V],s.push(y,z.y,z.z,y,F.y,F.z,b,z.y,z.z,b,z.y,z.z,y,F.y,F.z,b,F.y,F.z),o.push(0,U.y,U.z,0,B.y,B.z,0,U.y,U.z,0,U.y,U.z,0,B.y,B.z,0,B.y,B.z),l.push(0,j,0,N,1,j,1,j,0,N,1,N),[z,U,j]=[F,B,N];this.setAttribute("position",new Bc(s,3)),this.setAttribute("normal",new Bc(o,3)),this.setAttribute("uv",new Bc(l,2))}},eO=class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},e.parameters);return{shape:e.shape&&e.shape instanceof ND?e.shape:new ND,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t,height:i,innerRadiusPercent:n,spikes:r,cornerRadius:a,angle:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=e.parameters,h=e.shape,d=.5*t,u=.5*i,p=s*Math.PI/360/r,f=Math.PI/2*3*-1,m=d*n/100,g=u*n/100;if(3===r&&50===n){p=2*Math.PI/r;for(let e=0;e<r;e++){let t=p*e,i=0+Math.sin(t)*d,n=0+Math.cos(t)*u;h.addPoint(h.createPoint(i,n))}}else for(let y=0;y<r;y++){let e=0+Math.cos(f)*d,t=0+Math.sin(f)*u;h.addPoint(h.createPoint(e,t)),f+=p,e=0+Math.cos(f)*m,t=0+Math.sin(f)*g,h.addPoint(h.createPoint(e,t)),f+=p}h.isClosed=!0;for(let y=0,b=h.points.length;y<b;y++)h.points[y].roundness=a;h.roundness=a,h.update();let v=mR.create({shape:h,parameters:{roundness:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(v,{userData:{...e,type:"StarGeometry"}})}};var tO=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+tO.version}static addUnaryOp(e){return tO.max_unop_len=Math.max(e.length,tO.max_unop_len),tO.unary_ops[e]=1,tO}static addBinaryOp(e,t,i){return tO.max_binop_len=Math.max(e.length,tO.max_binop_len),tO.binary_ops[e]=t,i?tO.right_associative.add(e):tO.right_associative.delete(e),tO}static addIdentifierChar(e){return tO.additional_identifier_chars.add(e),tO}static addLiteral(e,t){return tO.literals[e]=t,tO}static removeUnaryOp(e){return delete tO.unary_ops[e],e.length===tO.max_unop_len&&(tO.max_unop_len=tO.getMaxKeyLen(tO.unary_ops)),tO}static removeAllUnaryOps(){return tO.unary_ops={},tO.max_unop_len=0,tO}static removeIdentifierChar(e){return tO.additional_identifier_chars.delete(e),tO}static removeBinaryOp(e){return delete tO.binary_ops[e],e.length===tO.max_binop_len&&(tO.max_binop_len=tO.getMaxKeyLen(tO.binary_ops)),tO.right_associative.delete(e),tO}static removeAllBinaryOps(){return tO.binary_ops={},tO.max_binop_len=0,tO}static removeLiteral(e){return delete tO.literals[e],tO}static removeAllLiterals(){return tO.literals={},tO}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new tO(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map((e=>e.length)))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return tO.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!tO.binary_ops[String.fromCharCode(e)]||tO.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return tO.isIdentifierStart(e)||tO.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(tO.hooks[e]){let i={context:this,node:t};return tO.hooks.run(e,i),i.node}return t}searchHook(e){if(tO.hooks[e]){let t={context:this};return tO.hooks[e].find((function(e){return e.call(t.context,t),t.node})),t.node}}gobbleSpaces(){let e=this.code;for(;e===tO.SPACE_CODE||e===tO.TAB_CODE||e===tO.LF_CODE||e===tO.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=1===e.length?e[0]:{type:tO.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t,i,n=[];for(;this.index<this.expr.length;)if(t=this.code,t===tO.SEMCOL_CODE||t===tO.COMMA_CODE)this.index++;else if(i=this.gobbleExpression())n.push(i);else if(this.index<this.expr.length){if(t===e)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,tO.max_binop_len),t=e.length;for(;t>0;){if(tO.binary_ops.hasOwnProperty(e)&&(!tO.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!tO.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,i,n,r,a,s,o,l;if(a=this.gobbleToken(),!a||(t=this.gobbleBinaryOp(),!t))return a;for(r={value:t,prec:tO.binaryPrecedence(t),right_a:tO.right_associative.has(t)},s=this.gobbleToken(),s||this.throwError("Expected expression after "+t),n=[a,r,s];t=this.gobbleBinaryOp();){if(i=tO.binaryPrecedence(t),0===i){this.index-=t.length;break}r={value:t,prec:i,right_a:tO.right_associative.has(t)},l=t;let o=e=>r.right_a&&e.right_a?i>e.prec:i<=e.prec;for(;n.length>2&&o(n[n.length-2]);)s=n.pop(),t=n.pop().value,a=n.pop(),e={type:tO.BINARY_EXP,operator:t,left:a,right:s},n.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),n.push(r,e)}for(o=n.length-1,e=n[o];o>1;)e={type:tO.BINARY_EXP,operator:n[o-1].value,left:n[o-2],right:e},o-=2;return e}gobbleToken(){let e,t,i,n;if(this.gobbleSpaces(),n=this.searchHook("gobble-token"),n)return this.runHook("after-token",n);if(e=this.code,tO.isDecimalDigit(e)||e===tO.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===tO.SQUOTE_CODE||e===tO.DQUOTE_CODE)n=this.gobbleStringLiteral();else if(e===tO.OBRACK_CODE)n=this.gobbleArray();else{for(t=this.expr.substr(this.index,tO.max_unop_len),i=t.length;i>0;){if(tO.unary_ops.hasOwnProperty(t)&&(!tO.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!tO.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=i;let e=this.gobbleToken();return e||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:tO.UNARY_EXP,operator:t,argument:e,prefix:!0})}t=t.substr(0,--i)}tO.isIdentifierStart(e)?(n=this.gobbleIdentifier(),tO.literals.hasOwnProperty(n.name)?n={type:tO.LITERAL,value:tO.literals[n.name],raw:n.name}:n.name===tO.this_str&&(n={type:tO.THIS_EXP})):e===tO.OPAREN_CODE&&(n=this.gobbleGroup())}return n?(n=this.gobbleTokenProperty(n),this.runHook("after-token",n)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===tO.PERIOD_CODE||t===tO.OBRACK_CODE||t===tO.OPAREN_CODE||t===tO.QUMARK_CODE;){let i;if(t===tO.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==tO.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===tO.OBRACK_CODE?(e={type:tO.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==tO.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===tO.OPAREN_CODE?e={type:tO.CALL_EXP,arguments:this.gobbleArguments(tO.CPAREN_CODE),callee:e}:(t===tO.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),e={type:tO.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),i&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e,t,i="";for(;tO.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(this.code===tO.PERIOD_CODE)for(i+=this.expr.charAt(this.index++);tO.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);if(e=this.char,"e"===e||"E"===e){for(i+=this.expr.charAt(this.index++),e=this.char,("+"===e||"-"===e)&&(i+=this.expr.charAt(this.index++));tO.isDecimalDigit(this.code);)i+=this.expr.charAt(this.index++);tO.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+i+this.char+")")}return t=this.code,tO.isIdentifierStart(t)?this.throwError("Variable names cannot start with a number ("+i+this.char+")"):(t===tO.PERIOD_CODE||1===i.length&&i.charCodeAt(0)===tO.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:tO.LITERAL,value:parseFloat(i),raw:i}}gobbleStringLiteral(){let e="",t=this.index,i=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===i){n=!0;break}if("\\"===t)switch(t=this.expr.charAt(this.index++),t){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return n||this.throwError('Unclosed quote after "'+e+'"'),{type:tO.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(tO.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,tO.isIdentifierPart(e));)this.index++;return{type:tO.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],i=!1,n=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){i=!0,this.index++,e===tO.CPAREN_CODE&&n&&n>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(r===tO.COMMA_CODE){if(this.index++,n++,n!==t.length)if(e===tO.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===tO.CBRACK_CODE)for(let e=t.length;e<n;e++)t.push(null)}else if(t.length!==n&&0!==n)this.throwError("Expected comma");else{let e=this.gobbleExpression();(!e||e.type===tO.COMPOUND)&&this.throwError("Expected comma"),t.push(e)}}return i||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(tO.CPAREN_CODE);if(this.code===tO.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:tO.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:tO.ARRAY_EXP,elements:this.gobbleArguments(tO.CBRACK_CODE)}}},iO=new class{add(e,t,i){if("string"!=typeof arguments[0])for(let n in arguments[0])this.add(n,arguments[0][n],arguments[1]);else(Array.isArray(e)?e:[e]).forEach((function(e){this[e]=this[e]||[],t&&this[e][i?"unshift":"push"](t)}),this)}run(e,t){this[e]=this[e]||[],this[e].forEach((function(e){e.call(t&&t.context?t.context:t,t)}))}};Object.assign(tO,{hooks:iO,plugins:new class{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{if("object"!=typeof e||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)}))}}(tO),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),tO.max_unop_len=tO.getMaxKeyLen(tO.unary_ops),tO.max_binop_len=tO.getMaxKeyLen(tO.binary_ops);var nO=e=>new tO(e).parse();Object.getOwnPropertyNames(tO).forEach((e=>{void 0===nO[e]&&"prototype"!==e&&(nO[e]=tO[e])})),nO.Jsep=tO;var rO={name:"ternary",init(e){e.hooks.add("after-expression",(function(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;let i=t.node,n=this.gobbleExpression();if(n||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;let r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:i,consequent:n,alternate:r},i.operator&&e.binary_ops[i.operator]<=.9){let n=i;for(;n.right.operator&&e.binary_ops[n.right.operator]<=.9;)n=n.right;t.node.test=n.right,n.right=t.node,t.node=i}}else this.throwError("Expected :")}}))}};nO.plugins.register(rO);var aO=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],sO=["0","1","2","3","4","5","6","7","8","9","."],oO=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function lO(e){return"string"==typeof e&&(!isNaN(e)&&!isNaN(parseFloat(e)))}function cO(e,t){let i,n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"number",a="";for(let s=0;s<e.length;s++){let i=e[s];if("id"in i){let n=e[s-1];if(s>0&&"id"in n)return void console.error("Two variables in a row",e);let o=t.getVariable(i.id),l=XC.getDisplayedValue(o);"number"===r&&XC.isTextValue(o)&&Array.isArray(o.textValue)&&1===o.textValue.length?l=parseFloat(l).toString():"boolean"===r&&XC.isBoolean(o)?l=o?"true":"false":"boolean"===r&&XC.isTextValue(o)&&!Array.isArray(o.textValue)&&(l='"'+l+'"'),a+=l}else"string"!==r?"and"!==i.name?"or"!==i.name?"True"!==i.name?"False"!==i.name?"boolean"!==r||lO(i.name)||sO.includes(i.name)||aO.includes(i.name)||oO.includes(i.name.replace(/\($/g,""))?a+=i.name:a+='"'+i.name+'"':a+="false":a+="true":a+="||":a+="&&":('"'!==i.name&&"+"!==i.name&&(a+=i.name),"+"===i.name&&"\\"===a[a.length-1]&&(a=a.slice(0,-1)+i.name))}if("string"===r)return a;if(0===e.length){if("number"===r)return 0;if("boolean"===r)return!1}try{i=nO(a)}catch(uE){return void console.error(a,uE)}try{n=hO(i)}catch(uE){console.error(a,i,uE)}return n}function hO(e){switch(e.type){case"BinaryExpression":switch(e.operator){case"==":return Number(hO(e.left)===hO(e.right));case"!=":return Number(hO(e.left)!==hO(e.right));case">":return Number(hO(e.left)>hO(e.right));case">=":return Number(hO(e.left)>=hO(e.right));case"<":return Number(hO(e.left)<hO(e.right));case"<=":return Number(hO(e.left)<=hO(e.right));case"+":return hO(e.left)+hO(e.right);case"-":return hO(e.left)-hO(e.right);case"*":return hO(e.left)*hO(e.right);case"/":return hO(e.left)/hO(e.right);case"%":return hO(e.left)%hO(e.right);case"&&":return hO(e.left)&&hO(e.right);case"||":return hO(e.left)||hO(e.right);case"^":return Math.pow(hO(e.left),hO(e.right));default:throw new Error("Unknown operator: "+e.operator)}case"UnaryExpression":switch(e.operator){case"-":return-hO(e.argument);case"!":return Number(!hO(e.argument));default:throw new Error("Unknown operator: "+e.operator)}case"Identifier":throw new Error("Unknown identifier: "+e.name);case"Literal":return e.value;case"CallExpression":if("Identifier"===e.callee.type){if("random"===e.callee.name){let t=0,i=1;if(e.arguments.length>=1)try{t=hO(e.arguments[0])}catch(W_){console.warn(W_)}if(e.arguments.length>=2)try{i=hO(e.arguments[1])}catch(W_){console.warn(W_)}return t=Math.min(i,t),i=Math.max(i,t),t+Math.random()*(i-t)}return Math[e.callee.name].apply(null,e.arguments.map(hO))}throw new Error("Unknown node");default:throw new Error("Unknown node type: "+e.type)}}nO.addBinaryOp("^",11,!0);var dO=new ql,uO=new ql;var pO=class extends Wc{constructor(e){super(),this.type="PathExtrusionGeometry",this.inputs=e,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&1===this.inputs.parameters.extrusion.depth}_isOpenEnded(){let e=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&1===e.depth)||!function(e,t){let i=2*Math.PI;return(e%i+i)%i===(t%i+i)%i}(e.twist,0)||e.startScale!==e.endScale}build(){let e=this._extractPathPoints();if(e.length<2)return;let t=this._computeBasisMatrices(e),{depth:i,offset:n}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),n=Math.max(0,Math.min(n,1));let r=this.inputs.path.isClosed?e.length:e.length-1,a=Math.floor(n*r),s=this.inputs.path.isClosed?Math.ceil((i+n)*r):Math.ceil(Math.min(1,i+n)*r),o=Math.min(Math.max(2,s-a+1),r+2),l=[],c=[];for(let I=0;I<o;I++){let i=this.inputs.path.isClosed?(I+a)%e.length:Math.min(I+a,e.length-1);l.push(e[i].clone()),c.push(t[i].clone())}let h=(e,t,i)=>{l[e]=l[e].clone().lerp(l[t],i),c[e]=function(e,t,i){let n=[new gl,new gl,new gl],r=[new gl,new gl,new gl];return e.extractBasis(n[0],n[1],n[2]),t.extractBasis(r[0],r[1],r[2]),n.forEach(((e,t)=>{let n=r[t],a=Uo.lerp(e.length(),n.length(),i);e.lerp(n,i).setLength(a)})),(new ql).makeBasis(n[0],n[1],n[2])}(c[e],c[t],i)},d=0,u=n*r%1;(!this.inputs.path.isClosed||i<=1)&&(u||0===n)&&(d=u,h(0,1,d));let p=0,f=(n+i)*r%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&n+i<1)&&f&&(p=f,h(l.length-1,l.length-2,1-p)),0===i){let e=l.length-1;l[e].copy(l[0]),c[e].copy(c[0])}this._applyPathModifiers(c,d,p);let{bevel:m,bevelSides:g}=this.inputs.parameters.extrusion,v=m>0?this.inputs.parameters.extrusion.capType:"flat",y=5;"Custom"===this.inputs.parameters.extrusion.shape.type&&(y="low"===this.inputs.parameters.extrusion.shape.shapeQuality?5:12);let b,{regions:x,infos:w,vertices:_}=this._computeShapePoints(y),S=0;"round"===v&&(b=new uR(this.inputs.shapeData,2*m,m,y,g,void 0,!0),S=b.getAttribute("position").count);let A=0,E=0;w.sort(((e,t)=>e.start-t.start)),w.forEach((e=>{e.verticesStart=A,e.verticesCount=e.continuous.reduce(((e,t,i)=>e+(0!==i&&t?1:2)),0),E+=e.verticesCount,A=E}));let C,M=E*o,P=0;if(this._isOpenEnded()&&"flat"===v){try{C=rR({windingRule:TD.ODD,elementType:RD.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:x})}catch{C=hR}P=C.vertexCount}let T=M+2*P+2*S,D=M+2*P,R={positions:new Float32Array(3*T),normals:new Float32Array(3*T),uvs:new Float32Array(2*T)},O=[];if(w.forEach((e=>{this._extrudeRegion(e,_,c,l,R,O,this._isGeometryClosed()&&!this._isOpenEnded())})),C&&(this._closeEnd(C,M,O,R,c[0],l[0],!1),this._closeEnd(C,M+P,O,R,c[c.length-1],l[l.length-1],!0)),b){R.positions.set(b.getAttribute("position").array,3*D),R.normals.set(b.getAttribute("normal").array,3*D),R.uvs.set(b.getAttribute("uv").array,2*D);for(let n=D;n<D+S;n++)R.uvs[2*n+1]=1e-4;let e=O.length;O.push(...b.getIndex().array.map((e=>e+D))),D+=S,R.positions.set(b.getAttribute("position").array,3*D),R.normals.set(b.getAttribute("normal").array,3*D),R.uvs.set(b.getAttribute("uv").array,2*D);let t=O.length;O.push(...b.getIndex().array.map((e=>e+D))),this.setAttribute("position",new kc(R.positions,3)),this.setAttribute("normal",new kc(R.normals,3)),this.setAttribute("uv",new kc(R.uvs,2)),this.setIndex(O);let i=dO;i.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(i,D,T),i.copy(c[0]).setPosition(l[0]).multiply(uO.makeScale(1,1,-1)),this.applyMatrix4OnRange(i,D-S,D),this.reverseIndicesOnRange(e,t)}else this.setAttribute("position",new kc(R.positions,3)),this.setAttribute("normal",new kc(R.normals,3)),this.setAttribute("uv",new kc(R.uvs,2)),this.setIndex(O)}_extractPathPoints(){let e=jT(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(e.length<2)return[];let t=[e[0]];return e.forEach((e=>{t[t.length-1].distanceToSquared(e)>.001&&t.push(e)})),this.inputs.path.isClosed&&t[t.length-1].distanceTo(t[0])<.001&&t.pop(),t}_computeBasisMatrices(e){let t=[],i=e.length,n=this.inputs.path.isClosed,r=new gl,a=new gl,s=new gl,o=new gl,l=new gl(0,1,0);for(let f=0;f<i;f++){let c,h,d=e[f];c=0===f?n?e[e.length-2]:d.clone().multiplyScalar(2).sub(e[1]):e[f-1],h=f===i-1?n?e[1]:d.clone().multiplyScalar(2).sub(e[f-1]):e[f+1];let u=d.clone().sub(c).normalize(),p=h.clone().sub(d).normalize(),m=u.clone().add(p).normalize();s.copy(m),0===f&&(m.equals(l)||m.clone().negate().equals(l))&&l.set(0,0,1);let g=l.clone().cross(m).normalize(),v=m.clone().cross(g).normalize();l.copy(v),o.copy(g),0===f&&(r.copy(v),a.copy(m));let y=(new ql).makeBasis(g,v,m);t.push(y)}let c=n?a:s,h=n?r:new gl(0,1,0),d=c.clone().cross(o).normalize(),u=Math.acos(h.dot(d));if(isNaN(u))return t;let p=h.clone().cross(d);c.dot(p)>0&&(u*=-1);for(let f=1;f<t.length;f++){let e=(new ql).makeRotationZ(u*f/t.length);t[f].multiply(e)}return t}_applyPathModifiers(e,t,i){let n=e.length,{angle:r,twist:a,startScale:s,endScale:o}=this.inputs.parameters.extrusion,l=new ql,c=new ql;return e.forEach(((e,h)=>{let d=0===h?0:h===n-1?1:(h-t)/(n-(0===i?0:1)-(t+(1-i)));l.makeRotationZ(Uo.lerp(r,r+a,d)*Uo.DEG2RAD);let u=Uo.lerp(s,o,d);c.makeScale(u,u,u),e.multiply(l).multiply(c)})),e}_computeShapePoints(){let e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:TD.ODD,r=this.inputs.shapeData,a=r.extractShapePointsToFlatArray([],i),s=r.shapeHoles.map((e=>{let t=e.extractShapePointsToFlatArray([],i),n=[];for(let i=t.length-1;i>=1;i-=2){let e=t[i-1],r=t[i-0];n.push(e,r)}return n}));try{e=rR({windingRule:n,elementType:RD.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[a]})}catch{e=lR}try{t=rR({windingRule:TD.ODD,elementType:RD.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...s]})}catch{t=cR}if(!e)throw new Error("error generating geometry");let o=e.elementCount;if(t){e.elementCount+=t.elementCount;for(let i=0;i<t.elements.length;i++){let n=t.elements[i],r=i%2===0?e.vertexCount:0;e.elements.push(n+r)}for(let i=0;i<t.vertexIndices.length;i++){let n=t.vertexIndices[i],r=e.vertexCount;e.vertexIndices.push(n+r)}for(let i=0;i<t.vertices.length;i++){let n=t.vertices[i];e.vertices.push(n)}}let l=1/0,c=-1/0,h=1/0,d=-1/0;for(let p=0,f=e.vertexCount;p<f;p++){let t=2*p,i=e.vertices[t+0],n=e.vertices[t+1];i<l&&(l=i),i>c&&(c=i),n<h&&(h=n),n>d&&(d=n)}let u=[];for(let p=e.elementCount-1;p>=0;p--){let t=p>=o,i=2*p,n=e.elements[i+0],a=e.elements[i+1],s=n+a,l={start:n,count:a,normals:[],isHole:t,continuous:[],verticesStart:0,verticesCount:0};u.push(l);let c=n,h=s-1,d=n+1,f=r.roundedCurves.length;do{let i=c-n,o=e.vertices[2*h+0],u=e.vertices[2*h+1],p=e.vertices[2*c+0],m=e.vertices[2*c+1],g=e.vertices[2*d+0],v=e.vertices[2*d+1],y=p-o,b=m-u,x=Math.sqrt(y*y+b*b);y/=x,b/=x;let w=p-g,_=m-v,S=Math.sqrt(w*w+_*_);w/=S,_/=S,l.normals[2*i+0]=-_,l.normals[2*i+1]=w;let A=e.vertexIndices[c];if(Array.isArray(A))l.continuous[i]=!1;else{let[e,t]=r.getCurveIndexFromVertexId(A-1,!0);if(t>0&&t<1)l.continuous[i]=!0;else{let n=1===t?e+1:e-1;n=(n+f)%f;let a=1===t?0:1,s=r.roundedCurves[e].getTangent(t),o=r.roundedCurves[n].getTangent(a);l.continuous[i]=s.dot(o)>.95}}t&&(l.normals[2*i+0]*=-1,l.normals[2*i+1]*=-1),[h,c,d]=[c,d,d+1],d>=s&&(d-=a)}while(d!==n+1)}return{regions:[a,...s],infos:u,vertices:e.vertices}}_insertVertex(e,t,i,n,r){let a=2*t,s=3*t;e.positions[s+0]=i.x,e.positions[s+1]=i.y,e.positions[s+2]=i.z,e.normals[s+0]=n.x,e.normals[s+1]=n.y,e.normals[s+2]=n.z,e.uvs[a+0]=r.x,e.uvs[a+1]=r.y}_extrudeRegion(e,t,i,n,r,a,s){let o=new gl,l=new gl,c=new gl,h=new gl,d=new jo;i.forEach(((a,s)=>{let u=n[s],p=e.verticesStart*i.length+e.verticesCount*s;for(let n=0;n<e.count;n++){let f=2*(e.start+n);if(o.set(t[f+0],t[f+1],0),c.copy(o).applyMatrix4(a).add(u),e.continuous[n])h.set(e.normals[2*n+0],e.normals[2*n+1],0);else{let i=0===n?2*(e.start+e.count-1):f-2;l.set(t[i+0],t[i+1],0),h.copy(o).sub(l),h.set(-h.y,h.x,0),e.isHole||h.negate()}if(h.applyMatrix4(a).normalize(),d.set(0===n?1:n/e.count,s/(i.length-1)),this._insertVertex(r,p,c,h,d),p++,!e.continuous[n]||0===n){if(0===n)h.set(e.normals[2*n+0],e.normals[2*n+1],0),d.set(0,s/(i.length-1));else{let i=n===e.count-1?2*e.start:f+2;l.set(t[i+0],t[i+1],0),h.copy(l).sub(o),h.set(-h.y,h.x,0),e.isHole||h.negate()}h.applyMatrix4(a).normalize(),this._insertVertex(r,p,c,h,d),p++}}}));let u=i.length-1;for(let p=0;p<u;p++){let t=e.verticesStart*i.length+e.verticesCount*p,n=e.verticesStart*i.length+e.verticesCount*(p+1),r=0;for(let i=0;i<e.count;i++){(!e.continuous[i]||0===i)&&r++;let s=i===e.count-1?0:r+1,o=t+r,l=t+s,c=n+s,h=n+r;e.isHole?a.push(o,c,l,o,h,c):a.push(o,l,c,o,c,h),r++}}}_closeEnd(e,t,i,n,r,a,s){let o=e.vertexCount,l=new gl(0,0,s?-1:1).applyMatrix4(r),c=new gl,h=new jo;for(let u=0;u<o;u++){let i=2*u;c.set(e.vertices[i+0],e.vertices[i+1],0).applyMatrix4(r).add(a),this._insertVertex(n,t+u,c,l,h)}let d=e.elements;for(let u=0;u<e.elementCount;u++){let e=3*u,n=d[e+0]+t,r=d[e+(s?1:2)]+t,a=d[e+(s?2:1)]+t;i.push(n,r,a)}}applyMatrix4OnRange(e,t,i){let n,r,a,s,o=e.elements,l=(new Vo).getNormalMatrix(e).elements,c=this.attributes.position,h=this.attributes.normal;if(!c||!h)return;let d=c.array,u=h.array,p=c.itemSize;for(let f=t*p,m=i*p;f<m;f+=p)n=d[f+0],r=d[f+1],a=d[f+2],s=1/(o[3]*n+o[7]*r+o[11]*a+o[15]),d[f+0]=(o[0]*n+o[4]*r+o[8]*a+o[12])*s,d[f+1]=(o[1]*n+o[5]*r+o[9]*a+o[13])*s,d[f+2]=(o[2]*n+o[6]*r+o[10]*a+o[14])*s,n=u[f+0],r=u[f+1],a=u[f+2],u[f+0]=l[0]*n+l[3]*r+l[6]*a,u[f+1]=l[1]*n+l[4]*r+l[7]*a,u[f+2]=l[2]*n+l[5]*r+l[8]*a;c.needsUpdate=!0,h.needsUpdate=!0}reverseIndicesOnRange(e,t){let i=this.index;if(i){for(let n=e;n<t;n+=3){let e=i.getX(n),t=i.getX(n+1),r=i.getX(n+2);i.setXYZ(n,r,t,e)}i.needsUpdate=!0}}};function fO(){let e=new Wc;return e.setAttribute("position",new kc(new Float32Array([]),3)),e.setIndex(new kc(new Uint16Array([]),1)),e}var mO=fO().attributes,gO=class extends Wc{constructor(e,t){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,mO),this.userData={parameters:e,type:"TextGeometry"};let i=t.getFont(e.font);null!==i&&void 0!==i&&i.isLoaded?(this.font=i,this.update(e)):this.updateFont(e.font,t).then((()=>{this.update(e),null===t||void 0===t||t.requestRender()}))}async updateFont(e,t){let i=t.getFont(e);i&&(this.font=i,await i.loadingPromise)}update(e){let t=this.font;if(this.userData={parameters:e,type:"TextGeometry"},null===t||void 0===t||!t.isLoaded)return void console.warn("Cannot update text because its font is not loaded");let{width:i,height:n,depth:r,extrudeBevelSize:a,extrudeBevelSegments:s,text:o,textTransform:l}=e,c=XC.getDisplayedValue(o),h=function(e,t,i){let n=[""],r="";for(let a of i)r+=a," "===a||"\n"===a?(n[n.length-1]+=r,r="","\n"===a&&n.push("")):t.getTextWidth(n[n.length-1]+r,e)>e.width&&(n[n.length-1].length&&n.push(""),t.getTextWidth(n[n.length-1]+r,e)>e.width&&(1===r.length?(n[n.length-1]+=r,r=""):(n[n.length-1]+=r.slice(0,-1),r=r[r.length-1],n.push(""))));return n[n.length-1]+=r,n}(e,t,2===l?c.toUpperCase():3===l?c.toLowerCase():c),{shapes:d,charWidths:u,charCoords:p}=t.generateShapes(h,e),f=.5*("number"==typeof i?i:1),m=.5*("number"==typeof n?n:1),g=d.map((e=>(new ND).fromShape(e,!0)));this.vectorShapes=g;let v=g.map((e=>mR.create({shape:e,parameters:{depth:r,extrudeBevelSegments:s,extrudeBevelSize:a,windingRule:r<=0?TD.NONZERO:TD.ODD,subdivisions:this.isLowResolution&&r>0?1:12}}))),y=v.length?GM(v):fO();y.translate(-f,m,0),this.dispose(),this.wrappedText=h,this.charCoords=p,this.charWidths=u,this.deleteAttribute("extrudeNormal"),Object.entries(y.attributes).forEach((e=>{let[t,i]=e;this.setAttribute(t,i)})),this.setIndex(y.index),this.computeBoundingSphere()}clone(){let e=r_(new Wc,gO.prototype);return e.copy(this),console.log("CloneGeometry",this,e),e}copy(e){return Object.entries(e.attributes).forEach((e=>{let[t,i]=e;this.setAttribute(t,i)})),this.setIndex(e.index),this.userData={parameters:{...e.userData.parameters},type:"TextGeometry"},this}async setText(e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:e})}get text(){var e;return null!==(e=this.userData.parameters.text)&&void 0!==e?e:""}};var vO,yO,bO=new Promise((e=>{vO=e})),xO=!1;function wO(){if(!xO)return yO||(yO=async function(){let e=__webpack_require__.e(917).then(__webpack_require__.bind(__webpack_require__,917)),[t,i]=await Promise.all([e,fetch("".concat("https://unpkg.com/@splinetool/modelling-wasm@1.2.5/build","/process.wasm")).then((e=>e.arrayBuffer()))]),n=t.default,r=await n({wasmBinary:i});vO(r),xO=!0}(),yO)}var _O=["font"];function SO(e,t,i,n){let r,a,s;"PathGeometry"===e.type?(a=JSON.parse(JSON.stringify(e)),s=[[],["extrusion"]]):(a={...e},s=[[]]);for(let u of s){let e=a;for(let t of u)e=e[t];for(r in e){let i=e[r];NE(i)&&!_O.includes(r)&&(e[r]=t.getVariable(i,[n.uuid,"geometry",...u,r]),NE(e[r])&&(e[r]=1))}}let o,l={parameters:a,type:a.type};if("PathGeometry"===a.type)l.path=a.path;else if("VectorGeometry"===a.type){let e=ND.createFromState(a.shape,a.width,a.height);l.shape=e}else if("NonParametricGeometry"===a.type){var c;if(a.data.groups&&null!==(c=a.data.groups)&&void 0!==c&&c.forEach((e=>{var t;return e.materialIndex=Math.max(null!==(t=e.materialIndex)&&void 0!==t?t:0,0)})),l.geometry=(new Dm).parse(a),0===l.geometry.groups.length){var h,d;let e=l.geometry;e.addGroup(0,Math.max(null!==(h=null===(d=e.getIndex())||void 0===d?void 0:d.count)&&void 0!==h?h:0,e.getAttribute("position").count),0)}}else{if("SubdivGeometry"===a.type){let t=new OO(a,i);return t.data=e,t}if("TextGeometry"===a.type)return new gO(a,t);if("UIGeometry"===a.type)return JR.create({parameters:{width:a.width,height:a.height,cornerRadius:a.cornerRadius,cornerType:a.cornerType}})}try{o=iI(l)}catch(EE){console.error(EE)}if(!o){let e=ND.createFromState(rC.defaultData(),100,100);l.shape=e,o=iI(l)}return o}var AO=new ql;function EO(e,t,i,n){let r,a,s,o=e.position.array,l=e.normal.array,c=AO.makeScale(t,i,n).invert().elements;for(var h=0,d=o.length;h<d;h+=3)o[h]*=t,o[h+1]*=i,o[h+2]*=n,r=l[h],a=l[h+1],s=l[h+2],l[h]=c[0]*r+c[4]*a+c[8]*s,l[h+1]=c[1]*r+c[5]*a+c[9]*s,l[h+2]=c[2]*r+c[6]*a+c[10]*s;e.position.needsUpdate=!0,e.normal.needsUpdate=!0}var CO,MO=new bl,PO=new gl;bO.then((e=>{CO=e}));var TO=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),DO=new Uint32Array([0,1,2,3]),RO=new Uint8Array([4]),OO=class extends Wc{constructor(e,t){super(),this.data=e,this.flatShading=t,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(e,t){this.freeSubdivPointer();let i=this.data.scaleBaked,n=gE.div(t,i);this.subdividedGeometry&&EO(this.subdividedGeometry.attributes,...n),this.originalGeometry&&EO(this.originalGeometry.attributes,...n),this.data=e;let r=this.userData.parameters;this.userData.parameters={width:r.width*n[0],height:r.height*n[1],depth:r.depth*n[2]},this.originalGeometry.boundingSphere.center.multiply(PO.fromArray(n));let a=PO.set(r.width,r.height,r.depth).length();this.originalGeometry.boundingSphere.radius=a/2}ensureSubdivPointer(){return 0===this.subdivPointer&&this.rebuild(),this.subdivPointer}rebuild(){var e,t;let i,n,r;try{({originalGeometry:i,subdividedGeometry:n,subdivPointer:r}=OO.build(this.data,void 0,!this.flatShading,void 0))}catch{i=new oh(100,100,100),r=0}this.subdivPointer=r,this.originalGeometry=i,this.subdividedGeometry=null!==(e=n)&&void 0!==e?e:void 0;let a=null!==(t=this.subdividedGeometry)&&void 0!==t?t:this.originalGeometry;Object.assign(this,a),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(OO.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new Bl,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;MO.setFromBufferAttribute(t),MO.getCenter(i),e.boundingSphere.radius=i.distanceTo(MO.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),MO.getSize(PO);let n={width:PO.x,height:PO.y,depth:PO.z};return this.userData.parameters=n,n}static build(e,t,i,n){var r;let a,s,o,l=null!==(r=null===e||void 0===e?void 0:e.phongAngle)&&void 0!==r?r:35;!1===i&&(l=-1),t&&(CO.free_bvh(t),CO.free_subdivision_surface(t));try{a=OO.allocate(e,n)}catch(c){console.error(c,e),a=OO.allocate({positionWASM:TO,indexWASM:DO,verticesPerFaceWASM:RO},n)}if(CO.set_destination_refinement_level(a,0),s=OO.buildLevel(a,!0,l),e.subdivisions>0)try{CO.set_destination_refinement_level(a,e.subdivisions),o=OO.buildLevel(a,!1,l)}catch{try{CO.set_destination_refinement_level(a,e.subdivisions-1),o=OO.buildLevel(a,!1,l)}catch{o=null}}else o=null;return{subdivPointer:a,originalGeometry:s,subdividedGeometry:o}}static primitiveToQuads(e,t,i){e.widthSegments>16&&(e.widthSegments=16),e.heightSegments>16&&(e.heightSegments=16),e.depthSegments>16&&(e.depthSegments=16),e.radialSegments>16&&(e.radialSegments=16),"DodecahedronGeometry"===e.type&&(e.detail=0);let n,r,a,s,o,l,c=void 0!==e.shape||void 0!==e.path?t.geometry:SO(e,i,!1);if(n="TorusGeometry"===e.type&&e.arc===2*Math.PI?c.getClosedTorusIndicesForBooleanOrSubdiv():c.getIndex(),({positions:r,triIndices:o}=kO(c.getAttribute("position"),n)),"CylinderGeometry"===e.type&&0===e.cornerRadius&&0===e.hollow&&!1===e.openEnded){let t=e.radialSegments*e.heightSegments*3*2;l=[t,t+3*e.radialSegments]}return({indices:a,verticesPerFace:s}=zO(r,o,c,l)),{positions:r,indices:a,verticesPerFace:s}}static allocate(e,t){var i;let n,r,a,s=[],o=[];e.positionWASM&&e.positionWASM.length>0?(n=e.positionWASM,r=e.indexWASM,a=e.verticesPerFaceWASM):(n=TO,r=DO,a=RO);let l,c=n.length,h=r.length,d=a.length,u=n.length+s.length+o.length,p=r.length+a.length,f=u*Float32Array.BYTES_PER_ELEMENT+p*Uint32Array.BYTES_PER_ELEMENT,m=u*Float32Array.BYTES_PER_ELEMENT,g=(Uint32Array.BYTES_PER_ELEMENT,CO._malloc(f)),v=new Float32Array(CO.HEAPF32.buffer,g,u),y=new Uint32Array(CO.HEAPU32.buffer,g+m,p);v.set(n,0),v.set(s,n.length),v.set(o,n.length+s.length),y.set(r,0),y.set(a,r.length),null!==e&&void 0!==e&&null!==(i=e.scaleBaked)&&void 0!==i&&i.some((e=>1!==e))&&(l=(new ql).makeScale(...e.scaleBaked)),t&&(l?l.premultiply(t):l=t);let b=l?CO.alloc_subdivision_surface2(g,c,g+m,h,g+m+r.length*Uint32Array.BYTES_PER_ELEMENT,d,l.elements):CO.alloc_subdivision_surface(g,c,g+m,h,g+m+r.length*Uint32Array.BYTES_PER_ELEMENT,d);return CO._free(g),b}static buildLevel(e,t,i,n,r){let a=r?CO.get_mesh_data2(e,t?CO.Level.CONTROL:CO.Level.REFINED,i,r.elements):CO.get_mesh_data(e,t?CO.Level.CONTROL:CO.Level.REFINED,i),s=CO.HEAPU32.subarray(a>>2,8+(a>>2)),o=s.subarray(4,8),l=0,c=CO.HEAPU32[s[l]>>2],h=CO.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let d=CO.HEAPU32[s[l]>>2],u=CO.HEAPF32.subarray(d>>2,(d>>2)+o[l]);l++;let p=CO.HEAPU32[s[l]>>2],f=CO.HEAPU32.subarray(p>>2,(p>>2)+o[l]);l++;let m=CO.HEAPU32[s[l]>>2],g=CO.HEAPU32.subarray(m>>2,(m>>2)+o[l]);if(l++,void 0===n){let e=new Wc;if(e.setIndex(new Fc(g,1)),e.setAttribute("position",new Bc(h,3)),e.setAttribute("normal",new Bc(u,3)),t){e.setAttribute("faceMap",new Fc(f,1));let t=new Float32Array(u.length/3*4).fill(0);e.setAttribute("color",new kc(t,4))}return CO.free_mesh_data(a),e.userData.type="SubdivGeometry",e}n.getAttribute("position").copyArray(h),n.getAttribute("normal").copyArray(u),n.attributes.position.needsUpdate=!0,n.attributes.normal.needsUpdate=!0,CO.free_mesh_data(a)}static freeSubdivPointer(e){CO.free_bvh(e),CO.free_subdivision_surface(e)}static buildControlCageWireframe(e,t,i){let n=CO.get_wireframe_data_for_base_level(e),r=CO.HEAPU32.subarray(n>>2,4+(n>>2)),a=r.subarray(2,4),s=0,o=CO.HEAPU32[r[s]>>2],l=CO.HEAPF32.subarray(o>>2,(o>>2)+a[s]);s++;let c=CO.HEAPU32[r[s]>>2],h=CO.HEAPU32.subarray(c>>2,(c>>2)+a[s]);if(void 0===t){let e=new Wc;e.setAttribute("position",new Bc(l,3));let t=new Float32Array(l.length);for(let n=0,r=l.length;n<r;)t[n++]=i.r,t[n++]=i.g,t[n++]=i.b;return e.setAttribute("color",new kc(t,3)),e.setIndex(new Fc(h,1)),CO.free_wireframe_data_for_base_level(n),e}t.getAttribute("position").copyArray(l),t.attributes.position.needsUpdate=!0,CO.free_wireframe_data_for_base_level(n)}static updateCollabMesh(e,t,i){let n=0===t;n||CO.set_destination_refinement_level(e,t);let r=i?CO.get_topological_data2(e,n?CO.Level.CONTROL:CO.Level.REFINED,i.elements):CO.get_topological_data(e,n?CO.Level.CONTROL:CO.Level.REFINED),a=CO.HEAPU32.subarray(r>>2,6+(r>>2)),s=a.subarray(3,6),o=0,l=CO.HEAPU32[a[o]>>2],c=new Float32Array(CO.HEAPF32.subarray(l>>2,(l>>2)+s[o]));o++;let h=CO.HEAPU32[a[o]>>2],d=new Uint32Array(CO.HEAPU32.subarray(h>>2,(h>>2)+s[o]));o++;let u=CO.HEAPU32[a[o]>>2],p=new Uint8Array(CO.HEAPU32.subarray(u>>2,(u>>2)+s[o]));return CO.free_topological_data(r),{positions:c,indices:d,verticesPerFace:p}}},IO=["getX","getY","getZ"];function kO(e,t){let i={},n=t?t.count:e.count,r=0,a=[],s=[];for(let l=0;l<n;l++){let n=t?t.getX(l):l,o="";for(let t=0;t<3;t++)o+="".concat(~~(1e4*e[IO[t]](n)),",");if(o in i)a.push(i[o]);else{for(let t=0;t<3;t++)s.push(e[IO[t]](n));i[o]=r,a.push(r),r++}}let o=[];for(let l=0;l<a.length;l+=3)a[l]===a[l+1]||a[l]===a[l+2]||a[l+1]===a[l+2]||o.push(a[l],a[l+1],a[l+2]);return{positions:s,triIndices:o}}var LO=new gl,FO=new gl,BO=new gl,NO=new gl;function zO(e,t,i,n){let r=[],a=[];if(void 0!==i.userData.shape&&0===i.userData.parameters.depth&&0===i.userData.shape.shapeHoles.length){let t=i.userData.shape.extractShapePointsToFlatArray([]),n=i.userData.parameters.spikes;if("EllipseGeometry"===i.userData.type&&n<=24&&n%4===0&&i.userData.parameters.angle>=360){let e=t.length/2/n;t=t.filter(((t,i)=>Math.floor(i/2)%e===0))}let s=0;for(let e=0;e<t.length;e+=2)s+=(t[e]-t[(0===e?t.length:e)-2])*(t[e+1]+t[(0===e?t.length:e)-1]);e.length=0;let o=0;if(s<0)for(let i=0;i<t.length;i+=2)e.push(t[i],t[i+1],0),r.push(o++);else for(let i=t.length-2;i>=0;i-=2)e.push(t[i],t[i+1],0),r.push(o++);return a.push(o),{indices:r,verticesPerFace:a}}let s=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<t.length;){if(i.useNgonForTopBottomFaceDuringBake){let i=0;if((e[3*t[o]+2]===s||0===e[3*t[o]+2])&&i++,(e[3*t[o+1]+2]===s||0===e[3*t[o+1]+2])&&i++,(e[3*t[o+2]+2]===s||0===e[3*t[o+2]+2])&&i++,3===i)break}if(t[o+1]===t[o+3]&&t[o+2]===t[o+5]||t[o+0]===t[o+3]&&t[o+2]===t[o+4]){LO.set(e[3*t[o]],e[3*t[o]+1],e[3*t[o]+2]),FO.set(e[3*t[o+1]],e[3*t[o+1]+1],e[3*t[o+1]+2]),BO.set(e[3*t[o+4]],e[3*t[o+4]+1],e[3*t[o+4]+2]),NO.set(e[3*t[o+5]],e[3*t[o+5]+1],e[3*t[o+5]+2]),FO.sub(LO).normalize(),BO.sub(LO).normalize(),NO.sub(LO).normalize();let i=FO.cross(BO).dot(NO);Math.abs(i)>.005||n&&n.some(((e,t)=>t%2!==1&&(o>=n[t]&&o<n[t+1])))?(r.push(t[o],t[o+1],t[o+2]),a.push(3),o+=3):(r.push(t[o],t[o+1],t[o+4],t[o+5]),a.push(4),o+=6)}else r.push(t[o],t[o+1],t[o+2]),a.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let t=[],n=[],o=0;for(let i=0,r=0;i<e.length;i+=3,r++)0===e[i+2]&&(t.push(r),o++),e[i+2]===s&&n.push(r);if(0===i.userData.parameters.extrudeBevelSize){let e=n[0];n[0]=n[1],n[1]=e}t.reverse(),r.push(...t,...n),a.push(o,o)}return{indices:r,verticesPerFace:a}}var UO={};((e,t)=>{for(var i in t)Rr(e,i,{get:t[i],enumerable:!0})})(UO,{calcBoolean:()=>KO,calcBooleanTopological:()=>QO,freeMeshSet:()=>eI,getMeshSet:()=>ZO,hasOpenEdges:()=>JO,transformMeshSet:()=>$O});var jO,VO,GO,HO,WO=new Promise((e=>{jO=e}));function qO(){if(VO)return VO;return VO=async function(){let e=__webpack_require__.e(516).then(__webpack_require__.bind(__webpack_require__,3516)),[t,i]=await Promise.all([e,fetch("".concat("https://unpkg.com/@splinetool/boolean-wasm@1.2.5/build","/boolean.wasm")).then((e=>e.arrayBuffer()))]),n=t.default,r=await n({wasmBinary:i});jO(r)}(),VO}function XO(e){let t=e.length,i=t*Uint32Array.BYTES_PER_ELEMENT,n=t*Float32Array.BYTES_PER_ELEMENT,r=Number.isInteger(e[0])?i:n,a=GO._malloc(r);return(Number.isInteger(e[0])?new Uint32Array(GO.HEAPU32.buffer,a,t):new Float32Array(GO.HEAPF32.buffer,a,t)).set(e,0),a}function YO(e){switch(e){case 0:return GO.OP.UNION;case 1:return GO.OP.INTERSECTION;case 2:return GO.OP.A_MINUS_B;case 3:return GO.OP.B_MINUS_A;case 4:return GO.OP.SYMMETRIC_DIFFERENCE;case 5:return GO.OP.ALL;default:throw new Error("Unknown boolean operation "+e)}}function QO(e,t){void 0===HO&&(HO=GO.init_csg());let i=XO(e),n=GO.csg_calc_topological(HO,i,e.length,YO(t));GO._free(i);let r=GO.HEAPU32.subarray(n>>2,6+(n>>2)),a=r.subarray(3,6),s=0,o=GO.HEAPU32[r[s]>>2],l=new Float32Array(GO.HEAPF32.subarray(o>>2,(o>>2)+a[s]));s++;let c=GO.HEAPU32[r[s]>>2],h=new Uint32Array(GO.HEAPU32.subarray(c>>2,(c>>2)+a[s]));s++;let d=GO.HEAPU32[r[s]>>2],u=new Uint8Array(GO.HEAPU32.subarray(d>>2,(d>>2)+a[s]));return GO.free_mesh_data(n),{positions:l,indices:h,verticesPerFace:u}}function KO(e,t,i,n){void 0===HO&&(HO=GO.init_csg());let r=XO(e),a=GO.csg_calc(HO,r,e.length,n,YO(t));GO._free(r);let s=GO.HEAPU32.subarray(a>>2,5+(a>>2)),o=s.subarray(2,5),l=0,c=GO.HEAPU32[s[l]>>2],h=GO.HEAPF32.subarray(c>>2,(c>>2)+o[l]);l++;let d=GO.HEAPU32[s[l]>>2],u=GO.HEAPF32.subarray(d>>2,(d>>2)+o[l]);l++;let p=o[l];i.setAttribute("position",new Bc(h,3)),i.setAttribute("normal",new Bc(u,3));let f=GO.HEAPF32.subarray(5+(a>>2),5+(a>>2)+6);return null===i.boundingSphere&&(i.boundingSphere=new Bl),i.boundingSphere.center.set(f[0],f[1],f[2]),i.boundingSphere.radius=(f[3]**2+f[4]**2+f[5]**2)**.5,i.userData.parameters={width:2*f[3],height:2*f[4],depth:2*f[5]},GO.free_mesh_data(a),p}function ZO(e,t,i){if(void 0===GO)return-1;let n,r,a;if(t&&void 0!==e.userData.positions){let t=e.userData;a=t.verticesPerFace.length,n=t.positions,r=Array(t.verticesPerFace.reduce(((e,t)=>e+t),0)+a);for(let e=0,i=0,n=0;e<t.verticesPerFace.length;e++){r[n++]=t.verticesPerFace[e];for(let a=0;a<t.verticesPerFace[e];a++)r[n++]=t.indices[i++]}}else({positions:n,faceIndices:r,nFaces:a}=function(e,t,i){let n,r;r="TorusGeometry"===e.userData.parameters.type&&e.userData.parameters.arc===2*Math.PI?e.getClosedTorusIndicesForBooleanOrSubdiv():e.getIndex();let a,{positions:s,triIndices:o}=kO(e.getAttribute("position"),r);if(t&&i){let{indices:t,verticesPerFace:i}=zO(s,o,e);a=i.length,n=[];for(let e=0,r=0;e<a;e++){n.push(i[e]);for(let a=0;a<i[e];a++)n.push(t[r++])}}else{let e=o.length;n=Array(e+e/3),a=0;for(let t=0,i=0;i<n.length;)n[i++]=3,a++,n[i++]=o[t++],n[i++]=o[t++],n[i++]=o[t++]}return{positions:s,faceIndices:n,nFaces:a}}(e,t,i));let s=n.length,o=r.length,l=n.length,c=r.length,h=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,d=l*Float32Array.BYTES_PER_ELEMENT,u=(Uint32Array.BYTES_PER_ELEMENT,GO._malloc(h)),p=new Float32Array(GO.HEAPF32.buffer,u,l),f=new Uint32Array(GO.HEAPU32.buffer,u+d,c);p.set(n,0),f.set(r,0);let m=GO.get_csg_mesh(u,s,u+d,o,a);return GO._free(u),m}function JO(e){return GO.has_open_edges(e)}function $O(e,t){GO.transform_csg_mesh(e,t.elements)}function eI(e){GO.free_csg_mesh(e)}WO.then((e=>GO=e));var tI={ConeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},e.parameters);return a.thetaLength=Uo.clamp(a.thetaLength,0,360),{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let t,{width:i,depth:n,height:r,radialSegments:a,heightSegments:s,openEnded:o,thetaStart:l,thetaLength:c,cornerRadiusTop:h,cornerRadiusBottom:d,cornerSegments:u}=e.parameters;return 0===c?(t=new Wc,t.setAttribute("position",new Bc([],3))):t=h>0||d>0||c<360?new ZT(0,i/2,r,a,s,o,l,c*Math.PI/180,h,d,u,0,!0):new nf(i/2,r,a,s,o),t.scale(1,1,n/i),Object.assign(t,{userData:{...e,type:"ConeGeometry"}})}},CubeGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let t,{width:i,height:n,depth:r,widthSegments:a,heightSegments:s,depthSegments:o,cornerRadius:l,cornerSegments:c}=e.parameters;return t=0===l?new oh(i,n,r,a,s,o):new $T(i,n,r,a,s,o,l,c),Object.assign(t,{userData:{...e,type:"CubeGeometry"}})}},CylinderGeometry:YT,DodecahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:a,cornerSides:s}=e.parameters,o=0===r&&0!==a?new tD(.5*t,a,s):new af(.5*t,r);return o.scale(1,i/t,n/t),Object.assign(o,{userData:{...e,type:"DodecahedronGeometry"}})}},EllipseGeometry:vR,HelixGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},e.parameters),s=Math.abs(a.width),o=Math.abs(null!==(n=a.height)&&void 0!==n?n:s),l=Math.abs(null!==(r=a.depth)&&void 0!==r?r:s),c=Math.abs(Math.min(s,l))/2;return{parameters:Object.assign(a,{width:s,height:o,depth:l,radius:c,segments:Math.round(a.segments),pathSegments:Math.round(a.pathSegments),cornerSegments:Math.round(a.cornerSegments)})}}static build(e){let{width:t,height:i,depth:n,radius:r,revolutions:a,segments:s,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:h,cornerSegments:d}=e.parameters,u=new ER(!1,t,i,n,r,a,s,o,l,c,h,d);return Object.assign(u,{userData:{...e,type:"HelixGeometry"}})}},IcosahedronGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,detail:0,corner:0,cornerSides:4},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let{width:t,height:i,depth:n,detail:r,corner:a,cornerSides:s}=e.parameters,o=0===r&&0!==a?new CR(.5*t,a,s):new Lf(.5*t,r);return o.scale(1,i/t,n/t),Object.assign(o,{userData:{...e,type:"IcosahedronGeometry"}})}},LatheGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r,a,s;(null!==(i=null===(n=e.parameters)||void 0===n?void 0:n.points)&&void 0!==i?i:[]).forEach((e=>{Array.isArray(e)&&(e.x=e[0],e.y=e[1])}));let o=Object.assign({},null!==(r=null===t||void 0===t?void 0:t.parameters)&&void 0!==r?r:{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},e.parameters);return{parameters:Object.assign(o,{width:Math.abs(o.width),height:Math.abs(null!==(a=o.height)&&void 0!==a?a:o.width),depth:Math.abs(null!==(s=o.depth)&&void 0!==s?s:o.width)})}}static build(e){let{points:t,segments:i,verticalSegments:n}=e.parameters,r=new sf;r.moveTo(t[0].x,t[0].y),r.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y);let a=new ef(r.extractPoints(n).shape,i);return a.rotateZ(Math.PI),Object.assign(a,{userData:{...e,type:"LatheGeometry"}})}},NonParametricGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n;let r,a=null!==(i=null!==(n=e.geometry)&&void 0!==n?n:null===t||void 0===t?void 0:t.geometry)&&void 0!==i?i:(new Wc).copy(new oh(100,100,100));void 0===t?(a.computeBoundingBox(),a.boundingBox.getSize(qR),r={width:qR.x,height:qR.y,depth:qR.z,subdivisions:0}):r=t.parameters;let s={...r,...e.parameters};return{parameters:{width:Math.abs(s.width),height:Math.abs(s.height),depth:Math.abs(s.depth),subdivisions:Math.abs(s.subdivisions)},geometry:a}}static build(e){var t;let{width:i,height:n,depth:r,subdivisions:a}=e.parameters,s=null!==(t=e.geometry)&&void 0!==t?t:(new Wc).copy(new oh(100,100,100)),o=s.userData.parameters;void 0===o?(s.computeBoundingBox(),s.boundingBox.getSize(qR)):qR.set(o.width,o.height,o.depth),(i!==qR.x||n!==qR.y||r!==qR.z)&&s.scale(0===qR.x?1:i/qR.x,0===qR.y?1:n/qR.y,0===qR.z?1:r/qR.z);let l=s.originalGeometry;try{a>0?(void 0===l||(null===o||void 0===o?void 0:o.subdivisions)!==a)&&(void 0===l&&(l=s),s=new WR(a).modify(l).toBufferGeometry()):(void 0!==l&&(s=l),l=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals())}catch{void 0!==l&&(s=l),l=void 0,void 0===s.getAttribute("normal")&&s.computeVertexNormals()}return void 0!==l&&Object.assign(s,{originalGeometry:l}),delete e.geometry,Object.assign(s,{userData:{...e,type:"NonParametricGeometry"}})}static loadFromUrl(e,t,i){new Dm(i).load(e,(e=>{let i=this.normalizeInputs({geometry:e});e.boundingBox.getSize(qR);let n=100/qR.x;Object.assign(i.parameters,{width:100,height:qR.y*n,depth:qR.z*n}),t(this.build(i))}))}},PolygonGeometry:XR,PyramidGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,heightSegments:a,openEnded:s,cornerRadius:o,cornerSegments:l}=e.parameters,c=new ZR(.5*t,i,r,a,s,o,l);return c.scale(1,1,n/t),Object.assign(c,{userData:{...e,type:"PyramidGeometry"}})}},RectangleGeometry:JR,SphereGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},e.parameters);return a.thetaLength=Uo.clamp(a.thetaLength,0,180),{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let t,{width:i=100,height:n=i,depth:r=i,widthSegments:a=64,heightSegments:s=64,phiStart:o,phiLength:l,thetaStart:c,thetaLength:h}=e.parameters;return 0===h?(t=new Wc,t.setAttribute("position",new Bc([],3))):t=new Ff(.5*i,a,s,o,l,c,h*Uo.DEG2RAD),t.scale(1,n/i,r/i),Object.assign(t,{userData:{...e,type:"SphereGeometry"}})}},PlaneGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n;let r=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0,widthSegments:8,heightSegments:8},e.parameters);return{parameters:Object.assign(r,{width:Math.abs(r.width),height:Math.abs(null!==(n=r.height)&&void 0!==n?n:r.width),depth:0})}}static build(e){let{width:t=100,height:i=t,widthSegments:n=8,heightSegments:r=8}=e.parameters,a=new Ph(t,i,n,r);return a.scale(1,1,1),Object.assign(a,{userData:{...e,type:"PlaneGeometry"}})}},BackdropGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,angle:90,cornerRadius:24,cornerSegments:8},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:a.width)})}}static build(e){let{width:t,height:i,depth:n,angle:r,cornerRadius:a,cornerSegments:s}=e.parameters,o=new $R(t,i,n,r,a,s);return Object.assign(o,{userData:{...e,type:"BackdropGeometry"}})}},StarGeometry:eO,TextFrameGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0},e.parameters);return{parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t,height:i}=e.parameters,n=new Ph(t,i);return Object.assign(n,{userData:{...e,type:"TextFrameGeometry"}})}},TorusGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},e.parameters),s=Math.abs(a.width),o=Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width),l=Math.round(Math.abs(null!==(r=a.depth)&&void 0!==r?r:.25*a.width));return{parameters:Object.assign(a,{width:s,height:o,depth:l})}}static build(e){let{width:t,height:i,depth:n,radialSegments:r,tubularSegments:a,arc:s,cornerRadius:o,cornerSegments:l}=e.parameters,c=function(e,t,i,n,r,a,s,o,l,c,h){[t,i]=[i,t],s=t/2;let d=Uo.clamp(r/360,0,1);if(0===d){let e=new Wc;return e.setAttribute("position",new Bc([],3)),e}return 1===d&&(c=0),new ER(!0,e,t,i,n,d,a,s,o,l,c,h)}(t,i,n,.5*t,s,a,0,0,r,o,l);return c.scale(1,i/t,1),Object.assign(c,{userData:{...e,type:"TorusGeometry"}})}},TorusKnotGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r,a;let s=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},e.parameters);return{parameters:Object.assign(s,{width:Math.abs(s.width),height:Math.abs(null!==(n=s.height)&&void 0!==n?n:s.width),depth:Math.abs(null!==(r=s.depth)&&void 0!==r?r:s.width),tube:null!==(a=s.tube)&&void 0!==a?a:.125*s.width})}}static build(e){let{width:t,tube:i,tubularSegments:n,radialSegments:r,p:a,q:s}=e.parameters,o=.5*t;o!==i&&(o-=i);let l=new Nf(o,i,n,r,a,s);return Object.assign(l,{userData:{...e,type:"TorusKnotGeometry"}})}},TriangleGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r;let a=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},e.parameters);return{shape:e.shape&&e.shape instanceof ND?e.shape:new ND,parameters:Object.assign(a,{width:Math.abs(a.width),height:Math.abs(null!==(n=a.height)&&void 0!==n?n:a.width*(a.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(null!==(r=a.depth)&&void 0!==r?r:0)})}}static build(e){let{width:t=100,height:i,cornerRadius:n,depth:r,extrudeBevelSize:a,extrudeBevelSegments:s,isRect:o}=e.parameters,l=e.shape,c=.5*t,h=.5*i;o?(l.addPoint(l.createPoint(-c,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))):(l.addPoint(l.createPoint(0,h)),l.addPoint(l.createPoint(c,-h)),l.addPoint(l.createPoint(-c,-h))),l.isClosed=!0;for(let u=0,p=l.points.length;u<p;u++)l.points[u].roundness=n;l.roundness=n,l.update();let d=mR.create({shape:l,parameters:{roundness:n,depth:r,extrudeBevelSize:a,extrudeBevelSegments:s}});return Object.assign(d,{userData:{...e,type:"TriangleGeometry"}})}},PathGeometry:class{static create(e){return this.build(this.normalizeInputs(e))}static normalizeInputs(e,t){var i,n,r,a,s;let o=Object.assign({},null!==(i=null===t||void 0===t?void 0:t.parameters)&&void 0!==i?i:{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},e.parameters),l=Math.abs(o.width),c=Math.abs(null!==(n=o.height)&&void 0!==n?n:o.width),h=Math.abs(null!==(r=o.depth)&&void 0!==r?r:0),d=null!==(a=null===t||void 0===t?void 0:t.shapeData)&&void 0!==a?a:vR.create({parameters:cC}).userData.shape;return{path:null!==(s=e.path)&&void 0!==s?s:aC.defaultData(),parameters:Object.assign(o,{width:l,height:c,depth:h,extrusion:{...pC,...o.extrusion}}),shapeData:d}}static build(e){if(e.path.points.length>=2){let t=new pO(e);return Object.assign(t,{userData:{...e,type:"PathGeometry"}})}return Object.assign(new Wc,{userData:{...e,type:"PathGeometry"}})}},VectorGeometry:mR},iI=e=>tI[e.type].create(e);function nI(e){return null!==e&&"booleanOp"in e}var rI=class extends(XT(ah)){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new ql}updateVisible(e){super.updateVisible(e),this.visible=!nI(this.parent)&&this.visible,nI(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){-1!==this.booleanMeshSetAddress&&(UO.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.booleanWasTransformed=!0:this.freeBooleanPointer(),nI(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let e of this.children)e instanceof rI&&(e.freeBooleanPointer(),nI(e)&&e.invalidateUpstreamBooleanData())}updateTransformState(e,t){let i=super.updateTransformState(e,t);return i&&nI(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super.onVariableUpdate(e),nI(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},aI=new bl;function sI(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.count,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,a=1/0,s=1/0,o=1/0,l=-1/0,c=-1/0,h=-1/0;for(let d=t;d<i;d++){let t=e.getX(d),i=e.getY(d),n=e.getZ(d);t<a&&(a=t),i<s&&(s=i),n<o&&(o=n),t>l&&(l=t),i>c&&(c=i),n>h&&(h=n)}aI.min.set(a,s,o),aI.max.set(l,c,h),aI.getCenter(n),aI.getSize(r).multiplyScalar(.5)}var oI=new Wc,lI=new Rc,cI=class extends rI{constructor(e,t){super(oI,lI),this.super_Entity(e,t)}updateState(e,t){this.updateState_Entity(e,t)}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?sI(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},hI=class{constructor(e){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},null===hI.uuidContext)throw new Error("plz startContext");hI.uuidContext===hI.globalContext?this.uuid="_gid"+hI.uuidContext.nodeContextUuid++:this.uuid="_uid"+hI.uuidContext.nodeContextUuid++,this.type=e,this.name=""}static startContext(e){null===this.uuidContext||this.uuidContext===hI.globalContext?this.uuidContext=e:console.error("Can't start context twice")}static endContext(e){this.uuidContext!==e&&console.error("Can't end context twice"),this.uuidContext=null}analyze(e,t){var i;t=null!==(i=t)&&void 0!==i?i:{},e.analyzing=!0,this.build(e.addFlow(t.slot,t.cache,t.context),"v4"),e.clearVertexNodeCode(),e.clearFragmentNodeCode(),e.removeFlow(),e.analyzing=!1}analyzeAndFlow(e,t,i){var n;return i=null!==(n=i)&&void 0!==n?n:{},this.analyze(e,i),this.flow(e,t,i)}flow(e,t,i){var n;i=null!==(n=i)&&void 0!==n?n:{},e.addFlow(i.slot,i.cache,i.context);let r={result:this.build(e,t),code:e.clearNodeCode(),extra:e.context.extra};return e.removeFlow(),r}build(e,t,i){var n;t=null!==(n=t)&&void 0!==n?n:this.getType(e,t);let r=e.getNodeData(null!==i&&void 0!==i?i:this);return e.analyzing&&this.appendDepsNode(e,r,t),-1===e.nodes.indexOf(this)&&e.nodes.push(this),void 0!==this.updateFrame&&-1===e.updaters.indexOf(this)&&e.updaters.push(this),this.generate(e,t,i)}updateFrame(e){}generateReadonly(e,t,i,n,r,a){return""}generate(e,t,i,n,r){return""}parse(e,t,i,n){}appendDepsNode(e,t,i){t.deps=(t.deps||0)+1;let n=e.getTypeLength(i);(n>(t.outputMax||0)||this.getType(e,i))&&(t.outputMax=n,t.output=i)}setName(e){this.name=e}getName(){return this.name}getType(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type}},dI=hI;dI.globalContext={nodeContextUuid:0},dI.uuidContext=hI.globalContext;var uI=class{constructor(e){var t;e=null!==(t=e)&&void 0!==t?t:{},this.name=e.name,this.type=e.type,this.node=e.node,this.size=e.size,this.needsUpdate=e.needsUpdate}get value(){return this.node.value}set value(e){this.node.value=e}},pI=new class{constructor(){this.nodes={},this.keywords={}}add(e){this.nodes[e.name]=e}addKeyword(e,t,i){i=void 0===i||i,this.keywords[e]={callback:t,cache:i}}remove(e){delete this.nodes[e.name]}removeKeyword(e){delete this.keywords[e]}get(e){return this.nodes[e]}getKeyword(e,t){return this.keywords[e].callback(t)}getKeywordData(e){return this.keywords[e]}contains(e){return void 0!==this.nodes[e]}containsKeyword(e){return void 0!==this.keywords[e]}},fI=class extends dI{constructor(e,t){var i;super(e),this.scope="",t=null!==(i=t)&&void 0!==i?i:{},this.shared=void 0===t.shared||t.shared,this.unique=void 0!==t.unique&&t.unique}build(e,t,i,n){var r;if(t=null!==(r=t)&&void 0!==r?r:this.getType(e),this.getShared(e,t)){var a;let r=this.getUnique(e,t);r&&void 0===this.uuid&&(this.uuid=Uo.generateUUID()),i=e.getUUID(null!==(a=i)&&void 0!==a?a:this.getUUID(),!r);let s=e.getNodeData(i),o=s.output||this.getType(e);if(e.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(e,s,t),this.generate(e,t,i)):super.build(e,t,i);if(r)return s.name=s.name||super.build(e,t,i),s.name;if(!this.getLabel()&&(!this.getShared(e,o)||e.context.ignoreCache||1===s.deps))return super.build(e,t,i);i=this.getUUID(!1);let l=this.getTemp(e,i);if(l)return e.format(l,o,t);{l=super.generate(e,t,i,s.output,n);let r=this.generate(e,o,i);return e.addNodeCode(l+" = "+r+";"),e.format(l,o,t)}}return super.build(e,t,i)}getShared(e,t){return"sampler2D"!==t&&"samplerCube"!==t&&this.shared}getUnique(e,t){return this.unique}setLabel(e){return this.label=e,this}getLabel(){return this.label}getUUID(e){let t=this.uuid;return"string"==typeof this.scope&&(t=this.scope+"-"+t),t}getTemp(e,t){t=t||this.uuid;let i=e.getVars()[t];return i?i.name:void 0}generate(e,t,i,n,r){var a;return this.getShared(e,t)||console.error("TempNode is not shared"),i=null!==(a=i)&&void 0!==a?a:this.uuid,e.getTempVar(i,null!==n&&void 0!==n?n:this.getType(e),r,this.getLabel()).name}},mI=class extends fI{constructor(e,t){var i;(t=null!==(i=t)&&void 0!==i?i:{}).shared=void 0!==t.shared&&t.shared,super(e,t),this.readonly=!1}setReadonly(e){return this.readonly=e,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(e,t,i,n,r,a){var s,o;i=e.getUUID(null!==(s=i)&&void 0!==s?s:this.getUUID()),n=null!==(o=n)&&void 0!==o?o:this.getType(e);let l=e.getNodeData(i);return this.getReadonly()&&void 0!==this.generateReadonly?this.generateReadonly(e,t,i,n,r,a):e.isShader("vertex")?(l.vertex||(l.vertex=e.createVertexUniform(n,this,r,a,this.getLabel())),e.format(l.vertex.name,n,t)):(l.fragment||(l.fragment=e.createFragmentUniform(n,this,r,a,this.getLabel())),e.format(l.fragment.name,n,t))}},gI=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;super("v2"),this.nodeType="Vector2",this.value=e instanceof jo?e:new jo(e,t)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}generateReadonly(e,t,i,n,r,a){return e.format("vec2("+this.value.x+", "+this.value.y+")",n,t)}},vI=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v3"),this.nodeType="Vector3",this.value=e instanceof gl?e:new gl(e,t,i)}get x(){return this.value.x}set x(e){this.value.x=e}get y(){return this.value.y}set y(e){this.value.y=e}get z(){return this.value.z}set z(e){this.value.z=e}generateReadonly(e,t,i,n,r,a){return e.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",n,t)}},yI=class extends rl{constructor(e,t,i,n){super(e,t,i),this.isColorA=!0,this.a=n}setRGBA(e,t,i,n){super.setRGB(e,t,i),this.a=n}copy(e){return super.copy(e),this.a="a"in e?e.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(e){return super.equals(e)&&this.a===e.a}setStyle(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"srgb";if("transparent"===e)return this.setRGBA(0,0,0,0),this;if(t=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(e)){let n,r=t[1],a=t[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.a="rgba"===r?parseFloat(n[4]):1,super.setStyle(e,i);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.a="hsla"===r?parseFloat(n[4]):1,super.setStyle(e,i)}}return super.setStyle(e,i)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(e){this.r=e}set y(e){this.g=e}set z(e){this.b=e}set w(e){this.a=e}},bI=class extends mI{constructor(e){super("v4"),this.nodeType="Vector4",this.value=e instanceof yI?e:new yI(e.r,e.g,e.b,e.a)}generateReadonly(e,t,i,n,r,a){return e.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",n,t)}},xI=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,wI=/[a-z_0-9]+/gi,_I=class extends fI{constructor(e,t,i,n,r){super(r),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=void 0===r,this.isInterface=!1,this.parse(e,t,i,n)}getShared(e,t){return!this.isMethod}getType(e){return e.getTypeByFormat(this.type)}getInputByName(e){if(this.inputs){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}}getIncludeByName(e){if(this.includes){let t=this.includes.length;for(;t--;)if(this.includes[t].name===e)return this.includes[t]}}generate(e,t,i,n,r){let a,s=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)e.include(this.includes[c],this);for(let c in this.extensions)e.extensions[c]=!0;let l=[];for(;a=wI.exec(this.src);)l.push(a);for(let c=0;c<l.length;c++){let t=l[c],i=t[0],n=!this.isMethod||!this.getInputByName(i),r=i;if(this.keywords[i]||this.useKeywords&&n&&pI.containsKeyword(i)){let t=this.keywords[i];if(!t){let n=pI.getKeywordData(i);n.cache&&(t=e.keywords[i]),t=t||pI.getKeyword(i,e),n.cache&&(e.keywords[i]=t)}r=t.build(e)}i!==r&&"."!==o[t.index+s-1]&&(o=o.substring(0,t.index+s)+r+o.substring(t.index+i.length+s),s+=r.length-i.length),void 0===this.getIncludeByName(r)&&pI.contains(r)&&e.include(pI.get(r))}return"source"===t?o:this.isMethod?(this.isInterface||e.include(this,void 0,o),this.name):e.format("( "+o+" )",this.getType(e),t)}parse(e,t,i,n){if(this.src=e||"",this.includes=null!==t&&void 0!==t?t:[],this.extensions=null!==i&&void 0!==i?i:{},this.keywords=null!==n&&void 0!==n?n:{},this.isMethod){let e=xI.exec(this.src);if(this.inputs=[],e&&4==e.length){this.type=e[1],this.name=e[2];let t=e[3].match(wI);if(t){let e=0;for(;e<t.length;){let i,n=t[e++];"in"===n||"out"===n||"inout"===n?i=t[e++]:(i=n,n="");let r=t[e++];this.inputs.push({name:r,type:i,qualifier:n})}}this.isInterface=-1===this.src.indexOf("{")}else this.type="",this.name=""}}},SI=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,AI=class extends fI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(e||AI.PI,void 0,void 0,void 0,t)}getType(e){return e.getTypeByFormat(this.type)}parse(e,t,i,n,r){this.src=e||"";let a,s,o="",l=SI.exec(e);this.useDefine=null!==r&&void 0!==r?r:"#"===this.src.charAt(0),l&&l.length>1?(s=l[1],a=l[2],o=l[3]):(a=this.src,s="f"),this.name=a,this.type=s,this.value=o}build(e,t){if("source"===t){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return e.include(this),e.format(this.name,this.getType(e),t)}generate(e,t,i,n,r){return e.format(this.name,this.getType(e),t)}},EI=AI;EI.PI="PI",EI.PI2="PI2",EI.RECIPROCAL_PI="RECIPROCAL_PI",EI.RECIPROCAL_PI2="RECIPROCAL_PI2",EI.LOG2="LOG2",EI.EPSILON="EPSILON";var CI=new RegExp("^structs*([a-z_0-9]+)s*{s*((.|\n)*?)}","gim"),MI=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),PI=class extends fI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(e)}getType(e){return e.getTypeByFormat(this.name)}getInputByName(e){let t=this.inputs.length;for(;t--;)if(this.inputs[t].name===e)return this.inputs[t]}generate(e,t,i,n,r){return"source"===t?this.src+";":e.format("( "+this.src+" )",this.getType(e),t)}parse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.src=e,this.inputs=[];let t=CI.exec(e);if(t){let e,i=t[2];for(;e=MI.exec(i);)this.inputs.push({type:e[1],name:e[2]});this.name=t[1]}else this.name="";this.type=this.name}},TI=class extends fI{constructor(e){super("v2",{shared:!1}),this.nodeType="UV",this.index=null!==e&&void 0!==e?e:0}generate(e,t){e.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",n=e.isShader("vertex")?"uv"+i:"vUv"+i;return e.format(n,this.getType(e),t)}};pI.addKeyword("uv",(function(){return new TI})),pI.addKeyword("uv2",(function(){return new TI(1)}));var DI=class extends fI{constructor(e,t){super("v4"),this.nodeType="ColorSpace",this.input=e,this.method=null!==t&&void 0!==t?t:DI.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(e){switch(e){case fo:return["Linear"];case mo:return["sRGB"];default:return[]}}generate(e,t){var i;let n=this.input.build(e,"v4"),r=this.getType(e),a=DI.Nodes[this.method],s=e.include(a);if(s===DI.LINEAR_TO_LINEAR)return e.format(n,r,t);if(2===(null===(i=a.inputs)||void 0===i?void 0:i.length)){let i=this.factor.build(e,"f");return e.format(s+"( "+n+", "+i+" )",r,t)}return e.format(s+"( "+n+" )",r,t)}fromEncoding(e){let t=DI.getEncodingComponents(e);this.method="LinearTo"+t[0],this.factor=t[1]}fromDecoding(e){let t=DI.getEncodingComponents(e);this.method=t[0]+"ToLinear",this.factor=t[1]}},RI=DI;RI.Nodes={LinearToLinear:new _I(["vec4 LinearToLinear( in vec4 value ) {","\treturn value;","}"].join("\n")),sRGBToLinear:new _I(["vec4 sRGBToLinear( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join("\n")),LinearTosRGB:new _I(["vec4 LinearTosRGB( in vec4 value ) {","\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join("\n"))},RI.LINEAR_TO_LINEAR="LinearToLinear",RI.SRGB_TO_LINEAR="sRGBToLinear",RI.LINEAR_TO_SRGB="LinearTosRGB";var OI=class extends _I{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",arguments.length>4?arguments[4]:void 0,arguments.length>3?arguments[3]:void 0,arguments.length>2?arguments[2]:void 0,arguments.length>1?arguments[1]:void 0),this.nodeType="Expression"}},II=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new hl,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super("v4",{shared:!0}),this.nodeType="Texture",this.value=e,this.uv=null!==t&&void 0!==t?t:new TI,this.bias=i,this.project=void 0!==n&&n}getTexture(e,t){return super.generate(e,t,this.value.uuid,"t")}generate(e,t){var i;if("sampler2D"===t)return this.getTexture(e,t);let n,r,a=this.getTexture(e,t),s=this.uv.build(e,this.project?"v4":"v2"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),n=this.project?"texture2DProj":o?"tex2DBias":"tex2D",r=o?n+"( "+a+", "+s+", "+o+" )":n+"( "+a+", "+s+" )";let l={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(l),this.colorSpace=null!==(i=this.colorSpace)&&void 0!==i?i:new RI(new OI("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,c),e.removeContext(),e.format(r,c,t)}},kI=class extends mI{constructor(e){super("f"),this.nodeType="Float",this.value=null!==e&&void 0!==e?e:0}generateReadonly(e,t,i,n,r,a){return e.format(this.value+(this.value%1?"":".0"),n,t)}},LI=class extends fI{constructor(e,t){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=e,this.inputs=null!==t&&void 0!==t?t:[]}getFunction(){return this.value}getType(e){return this.value.getType(e)}generate(e,t,i,n,r){n=this.getType(e);let a=this.value,s=a.build(e,t)+"( ",o=[];if(a.inputs){for(let t=0;t<a.inputs.length;t++){let i=a.inputs[t],n=this.inputs[t]||this.inputs[i.name];o.push(n.build(e,e.getTypeByFormat(i.type)))}s+=o.join(", ")+" )"}return e.format(s,n,t)}},FI=class extends fI{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:FI.ADD;super(),this.nodeType="Operator",this.type=e.type,this.a=e,this.b=t,this.op=i}getType(e){let t=this.a.getType(e),i=this.b.getType(e);return e.isTypeMatrix(t)?"v4":e.getTypeLength(i)>e.getTypeLength(t)?i:t}generate(e,t){let i=this.getType(e);this.type=i;let n=this.a.build(e,i),r=this.b.build(e,i);return e.format("( "+n+" "+this.op+" "+r+" )",i,t)}},BI=FI;BI.ADD="+",BI.SUB="-",BI.MUL="*",BI.DIV="/";var NI=class extends fI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NI.ABS,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super(),this.nodeType="Math",this.a=e,"string"!=typeof t?this.b=t:n=t,"string"!=typeof i?this.c=i:n=i,this.method=n,this.hashProperties=["method"]}getNumInputs(e){switch(this.method){case NI.MIX:case NI.CLAMP:case NI.REFRACT:case NI.SMOOTHSTEP:case NI.FACEFORWARD:return 3;case NI.MIN:case NI.MAX:case NI.MOD:case NI.STEP:case NI.REFLECT:case NI.DISTANCE:case NI.DOT:case NI.CROSS:case NI.POW:return 2;default:return 1}}getInputType(e){let t=e.getTypeLength(this.a.getType(e)),i=this.b?e.getTypeLength(this.b.getType(e)):0,n=this.c?e.getTypeLength(this.c.getType(e)):0;return t>i&&t>n?this.a.getType(e):i>n?this.b.getType(e):this.c.getType(e)}getType(e){switch(this.method){case NI.LENGTH:case NI.DISTANCE:case NI.DOT:return"f";case NI.CROSS:return"v3"}return this.getInputType(e)}generate(e,t){let i,n,r,a=this.a?e.getTypeLength(this.a.getType(e)):0,s=this.b?e.getTypeLength(this.b.getType(e)):0,o=this.c?e.getTypeLength(this.c.getType(e)):0,l=this.getInputType(e),c=this.getType(e);switch(this.type=c,this.method){case NI.NEGATE:return e.format("( -"+this.a.build(e,l)+" )",l,t);case NI.INVERT:return e.format("( 1.0 - "+this.a.build(e,l)+" )",l,t);case NI.CROSS:i=this.a.build(e,"v3"),n=this.b.build(e,"v3");break;case NI.STEP:i=this.a.build(e,1===a?"f":l),n=this.b.build(e,l);break;case NI.MIN:case NI.MAX:case NI.MOD:i=this.a.build(e,l),n=this.b.build(e,1===s?"f":l);break;case NI.REFRACT:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,"f");break;case NI.MIX:i=this.a.build(e,l),n=this.b.build(e,l),r=this.c.build(e,1===o?"f":l);break;default:i=this.a.build(e,l),this.b&&(n=this.b.build(e,l)),this.c&&(r=this.c.build(e,l))}let h=[];h.push(i),n&&h.push(n),r&&h.push(r);let d=this.getNumInputs(e);if(h.length!==d)throw Error('Arguments not match used in "'.concat(this.method,'". Require ').concat(d,", currently ").concat(h.length,"."));return e.format(this.method+"( "+h.join(", ")+" )",c,t)}},zI=NI;zI.RAD="radians",zI.DEG="degrees",zI.EXP="exp",zI.EXP2="exp2",zI.LOG="log",zI.LOG2="log2",zI.SQRT="sqrt",zI.INV_SQRT="inversesqrt",zI.FLOOR="floor",zI.CEIL="ceil",zI.NORMALIZE="normalize",zI.FRACT="fract",zI.SATURATE="saturate",zI.SIN="sin",zI.COS="cos",zI.TAN="tan",zI.ASIN="asin",zI.ACOS="acos",zI.ARCTAN="atan",zI.ABS="abs",zI.SIGN="sign",zI.LENGTH="length",zI.NEGATE="negate",zI.INVERT="invert",zI.MIN="min",zI.MAX="max",zI.MOD="mod",zI.STEP="step",zI.REFLECT="reflect",zI.DISTANCE="distance",zI.DOT="dot",zI.CROSS="cross",zI.POW="pow",zI.MIX="mix",zI.CLAMP="clamp",zI.REFRACT="refract",zI.SMOOTHSTEP="smoothstep",zI.FACEFORWARD="faceforward";var UI=class extends fI{constructor(e,t,i){super("v4"),this.nodeType="TextureCubeUV",this.value=e,this.uv=t,this.bias=i}bilinearCubeUV(e,t,i,n){var r,a,s,o;let l=new LI(UI.Nodes.bilinearCubeUV,[t,i,n]);this.colorSpaceTL=null!==(r=this.colorSpaceTL)&&void 0!==r?r:new RI(new OI("","v4")),this.colorSpaceTL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(l.build(e)+".tl"),this.colorSpaceTR=null!==(a=this.colorSpaceTR)&&void 0!==a?a:new RI(new OI("","v4")),this.colorSpaceTR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(l.build(e)+".tr"),this.colorSpaceBL=null!==(s=this.colorSpaceBL)&&void 0!==s?s:new RI(new OI("","v4")),this.colorSpaceBL.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(l.build(e)+".bl"),this.colorSpaceBR=null!==(o=this.colorSpaceBR)&&void 0!==o?o:new RI(new OI("","v4")),this.colorSpaceBR.fromDecoding(e.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(l.build(e)+".br");let c={include:e.isShader("vertex"),ignoreCache:!0};e.addContext(c),this.colorSpaceTLExp=new OI(this.colorSpaceTL.build(e,"v4"),"v4"),this.colorSpaceTRExp=new OI(this.colorSpaceTR.build(e,"v4"),"v4"),this.colorSpaceBLExp=new OI(this.colorSpaceBL.build(e,"v4"),"v4"),this.colorSpaceBRExp=new OI(this.colorSpaceBR.build(e,"v4"),"v4"),e.removeContext();let h=new OI("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return h.keywords.cubeUV_TL=this.colorSpaceTLExp,h.keywords.cubeUV_TR=this.colorSpaceTRExp,h.keywords.cubeUV_BL=this.colorSpaceBLExp,h.keywords.cubeUV_BR=this.colorSpaceBRExp,h.keywords.cubeUV=l,h}generate(e,t){if(e.isShader("fragment")){let i=this.uv,n=this.bias||e.context.roughness,r=new LI(UI.Nodes.roughnessToMip,[n]),a=new zI(r,UI.Nodes.m0,UI.Nodes.cubeUV_maxMipLevel,zI.CLAMP),s=new zI(a,zI.FLOOR),o=new zI(a,zI.FRACT),l=this.bilinearCubeUV(e,this.value,i,s),c=this.bilinearCubeUV(e,this.value,i,new BI(s,new kI(1).setReadonly(!0),BI.ADD)),h=new zI(l,c,o,zI.MIX);return e.format(h.build(e),"v4",t)}return console.warn("TextureCubeUVNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t)}},jI=UI;jI.Nodes=function(){let e=new PI("struct TextureCubeUVData {\n\t\t\tvec4 tl;\n\t\t\tvec4 tr;\n\t\t\tvec4 br;\n\t\t\tvec4 bl;\n\t\t\tvec2 f;\n\t\t}"),t=new EI("float cubeUV_maxMipLevel 8.0",!0),i=new EI("float cubeUV_minMipLevel 4.0",!0),n=new EI("float cubeUV_maxTileSize 256.0",!0),r=new EI("float cubeUV_minTileSize 16.0",!0),a=new _I("float getFace(vec3 direction) {\n\t\t\t\tvec3 absDirection = abs(direction);\n\t\t\t\tfloat face = -1.0;\n\t\t\t\tif (absDirection.x > absDirection.z) {\n\t\t\t\t\tif (absDirection.x > absDirection.y)\n\t\t\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t} else {\n\t\t\t\t\tif (absDirection.z > absDirection.y)\n\t\t\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\t\t\telse\n\t\t\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t\t\t}\n\t\t\t\treturn face;\n\t\t}");a.useKeywords=!1;let s=new _I("vec2 getUV(vec3 direction, float face) {\n\t\t\t\tvec2 uv;\n\t\t\t\tif (face == 0.0) {\n\t\t\t\t\tuv = vec2(direction.z, direction.y) / abs(direction.x); // pos x\n\t\t\t\t} else if (face == 1.0) {\n\t\t\t\t\tuv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y\n\t\t\t\t} else if (face == 2.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z\n\t\t\t\t} else if (face == 3.0) {\n\t\t\t\t\tuv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x\n\t\t\t\t} else if (face == 4.0) {\n\t\t\t\t\tuv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y\n\t\t\t\t} else {\n\t\t\t\t\tuv = vec2(direction.x, direction.y) / abs(direction.z); // neg z\n\t\t\t\t}\n\t\t\t\treturn 0.5 * (uv + 1.0);\n\t\t}");s.useKeywords=!1;let o=new _I("TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n\t\t\tfloat face = getFace(direction);\n\t\t\tfloat filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n\t\t\tmipInt = max(mipInt, cubeUV_minMipLevel);\n\t\t\tfloat faceSize = exp2(mipInt);\n\t\t\tfloat texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n\t\t\tvec2 uv = getUV(direction, face) * (faceSize - 1.0);\n\t\t\tvec2 f = fract(uv);\n\t\t\tuv += 0.5 - f;\n\t\t\tif (face > 2.0) {\n\t\t\t\tuv.y += faceSize;\n\t\t\t\tface -= 3.0;\n\t\t\t}\n\t\t\tuv.x += face * faceSize;\n\t\t\tif(mipInt < cubeUV_maxMipLevel){\n\t\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t\t}\n\t\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\t\tuv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n\t\t\tuv *= texelSize;\n\t\t\tvec4 tl = texture2D(envMap, uv);\n\t\t\tuv.x += texelSize;\n\t\t\tvec4 tr = texture2D(envMap, uv);\n\t\t\tuv.y += texelSize;\n\t\t\tvec4 br = texture2D(envMap, uv);\n\t\t\tuv.x -= texelSize;\n\t\t\tvec4 bl = texture2D(envMap, uv);\n\t\t\treturn TextureCubeUVData( tl, tr, br, bl, f );\n\t\t}",[e,a,s,t,i,n,r]);o.useKeywords=!1;let l=new EI("float r0 1.0",!0),c=new EI("float v0 0.339",!0),h=new EI("float m0 -2.0",!0),d=new EI("float r1 0.8",!0),u=new EI("float v1 0.276",!0),p=new EI("float m1 -1.0",!0),f=new EI("float r4 0.4",!0),m=new EI("float v4 0.046",!0),g=new EI("float m4 2.0",!0),v=new EI("float r5 0.305",!0),y=new EI("float v5 0.016",!0),b=new EI("float m5 3.0",!0),x=new EI("float r6 0.21",!0),w=new EI("float v6 0.0038",!0),_=new EI("float m6 4.0",!0);return{bilinearCubeUV:o,roughnessToMip:new _I("float roughnessToMip(float roughness) {\n\t\t\tfloat mip = 0.0;\n\t\t\tif (roughness >= r1) {\n\t\t\t\tmip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n\t\t\t} else if (roughness >= r4) {\n\t\t\t\tmip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n\t\t\t} else if (roughness >= r5) {\n\t\t\t\tmip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n\t\t\t} else if (roughness >= r6) {\n\t\t\t\tmip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n\t\t\t} else {\n\t\t\t\tmip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25\n\t\t\t}\n\t\t\treturn mip;\n\t\t}",[l,c,h,d,u,p,f,m,g,v,y,b,x,w,_]),m0:h,cubeUV_maxMipLevel:t}}();var VI=class extends fI{constructor(e){super("v3"),this.nodeType="Normal",this.scope=null!==e&&void 0!==e?e:VI.VIEW}getShared(){return this.scope===VI.WORLD}build(e,t,i,n){let r=e.context[this.scope+"Normal"];return r?r.build(e,t,i,n):super.build(e,t,i)}generate(e,t,i,n,r){let a;switch(this.scope){case VI.VIEW:a=e.isShader("vertex")?"transformedNormal":"geometryNormal";break;case VI.LOCAL:e.isShader("vertex")?a="objectNormal":(e.requires.normal=!0,a="vObjectNormal");break;case VI.WORLD:e.isShader("vertex")?a="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(e.requires.worldNormal=!0,a="vWNormal")}return e.format(a,this.getType(e),t)}},GI=VI;GI.LOCAL="local",GI.WORLD="world",GI.VIEW="view",GI.NORMAL="normal",pI.addKeyword("viewNormal",(function(){return new GI(GI.VIEW)})),pI.addKeyword("localNormal",(function(){return new GI(GI.NORMAL)})),pI.addKeyword("worldNormal",(function(){return new GI(GI.WORLD)}));var HI=class extends fI{constructor(e){super("v3"),this.nodeType="Position",this.scope=null!==e&&void 0!==e?e:HI.LOCAL}getType(){return this.scope===HI.PROJECTION?"v4":this.type}getShader(){switch(this.scope){case HI.LOCAL:case HI.WORLD:return!1}return!0}generate(e,t,i,n,r){let a;switch(this.scope){case HI.LOCAL:e.isShader("vertex")?a="transformed":(e.requires.position=!0,a="vPosition");break;case HI.WORLD:if(e.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";e.requires.worldPosition=!0,a="vWPosition";break;case HI.VIEW:a=e.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case HI.PROJECTION:a=e.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )"}return e.format(a,this.getType(),t)}},WI=HI;WI.LOCAL="local",WI.WORLD="world",WI.VIEW="view",WI.PROJECTION="projection",pI.addKeyword("position",(function(){return new WI})),pI.addKeyword("worldPosition",(function(){return new WI(WI.WORLD)})),pI.addKeyword("viewPosition",(function(){return new WI(WI.VIEW)}));var qI=class extends fI{constructor(e){super("v3"),this.nodeType="Reflect",this.scope=null!==e&&void 0!==e?e:qI.CUBE}getUnique(e){return!e.context.viewNormal}getType(){return this.scope===qI.SPHERE?"v2":this.type}generate(e,t){let i=this.getUnique(e);if(e.isShader("fragment")){let n;switch(this.scope){case qI.VECTOR:{let t=new GI(GI.VIEW),r=e.context.roughness,a=t.build(e,"v3"),s=new WI(WI.VIEW).build(e,"v3"),o=r?r.build(e,"f"):void 0,l="reflect( -normalize( ".concat(s," ), ").concat(a," )");o&&(l="normalize( mix( ".concat(l,", ").concat(a,", ").concat(o," * ").concat(o," ) )"));let c="inverseTransformDirection( ".concat(l,", viewMatrix )");i?(e.addNodeCode("vec3 reflectVec = ".concat(c,";")),n="reflectVec"):n=c;break}case qI.CUBE:{let t=new qI(qI.VECTOR).build(e,"v3"),r="vec3( -"+t+".x, "+t+".yz )";i?(e.addNodeCode("vec3 reflectCubeVec = ".concat(r,";")),n="reflectCubeVec"):n=r;break}case qI.SPHERE:{let t="normalize( ( viewMatrix * vec4( "+new qI(qI.VECTOR).build(e,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(e.addNodeCode("vec2 reflectSphereVec = ".concat(t,";")),n="reflectSphereVec"):n=t;break}}return e.format(n,this.getType(),t)}return console.warn("ReflectNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.type,t)}},XI=qI;XI.CUBE="cube",XI.SPHERE="sphere",XI.VECTOR="vector";var YI=class extends fI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new II,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v4"),this.nodeType="TextureCube",this.value=e,this.radianceNode=new jI(this.value,null!==t&&void 0!==t?t:new XI(XI.VECTOR),i),this.irradianceNode=new jI(this.value,new GI(GI.WORLD),new kI(1).setReadonly(!0))}generate(e,t){return e.isShader("fragment")?(e.require("irradiance"),e.context.bias&&e.context.bias.setTexture(this.value),("irradiance"===e.slot?this.irradianceNode:this.radianceNode).build(e,t)):(console.warn("TextureCubeNode is not compatible with "+e.shader+" shader."),e.format("vec4( 0.0 )",this.getType(e),t))}},QI=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new vh,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=e,this.uv=null!==t&&void 0!==t?t:new XI,this.bias=i}getTexture(e,t){return super.generate(e,t,this.value.uuid,"tc")}generate(e,t){var i,n;if("samplerCube"===t)return this.getTexture(e,t);let r,a=this.getTexture(e,t),s=null===(i=this.uv)||void 0===i?void 0:i.build(e,"v3"),o=this.bias?this.bias.build(e,"f"):void 0;void 0===o&&e.context.bias&&(o=e.context.bias.setTexture(this).build(e,"f")),r=o?"texCubeBias( "+a+", "+s+", "+o+" )":"texCube( "+a+", "+s+" )";let l={include:e.isShader("vertex"),ignoreCache:!0},c=this.getType(e);return e.addContext(l),this.colorSpace=null!==(n=this.colorSpace)&&void 0!==n?n:new RI(new OI("",c)),this.colorSpace.fromDecoding(e.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(r),r=this.colorSpace.build(e,c),e.removeContext(),e.format(r,c,t)}},KI=["x","y","z","w"],ZI=["float","vec2","vec3","vec4"],JI={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},$I={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},ek=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=function(){function e(e,t){return e.deps.length-t.deps.length}return function(t,i){let n=this.getIncludes(t,i);if(!n)return"";let r="";n=n.sort(e);for(let e=0;e<n.length;e++)n[e].src&&(r+=n[e].src+"\n");return r}}(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","\t#define texCube(a, b) textureCube(a, b)","\t#define texCubeBias(a, b, c) textureCube(a, b, c)","\t#define tex2D(a, b) texture2D(a, b)","\t#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif","\n\t\t\t// NOTE: Include Spline's blending modes. This could be part of BlendNode\n\t\t\t#define SPE_BLENDING_NORMAL 0\n\t\t\t#define SPE_BLENDING_MULTIPLY 1\n\t\t\t#define SPE_BLENDING_SCREEN 2\n\t\t\t#define SPE_BLENDING_OVERLAY 3\n\n\t\t\tvec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\treturn mix( a, a * b, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );\n\t\t\t\treturn mix( a, tmp, alpha );\n\t\t\t}\n\n\t\t\tvec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {\n\t\t\t\tvec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );\n\t\t\t\treturn clamp( mix( a, tmp, alpha ), 0.0, 1.0 );\n\t\t\t}\n\n\t\t\tvec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {\n\t\t\t\tif ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );\n\t\t\t\telse if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );\n\t\t\t\treturn vec3( 1.0 );\n\t\t\t}\n\t\t\t","#include <packing>","#include <common>"].join("\n"),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join("\n"),fragment:["float accumAlpha = 0.0;","void accumulateAlpha(float alpha) {\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * alpha;\n\t\t\t\t}",""].join("\n")},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(e,t){this.addVertexParsCode("\nuniform int frameIndex;\nuniform vec2 resolution;\nuniform mat4 previousModelViewMatrix;\nuniform mat4 previousProjectionMatrix;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n"),this.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n\nuniform int frameIndex;\nuniform vec2 resolution;\n\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\nvec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {\n  const float goldenAngle = 2.399963f; // radians\n  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));\n  float theta = float(sampleIndex) * goldenAngle + angle;\n  float sine = sin(theta);\n  float cosine = cos(theta);\n  return vec2(cosine, sine) * r;\n}\n\n// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso\nfloat getNoiseInterleavedGradient(vec2 screenPos) {\n    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);\n    return fract(magic.z * fract(dot(screenPos, magic.xy)));\n}\n\n"),this.buildShader("vertex",e),this.buildShader("fragment",t);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let e=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+e+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+e+";"),this.addVertexFinalCode("vUv"+e+" = uv"+e+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode("vObjectNormal = normal;")),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode("\n// TODO: This could be generated CPU side and passed to the shader every frame\nconst vec2 haltonSequence[16] = vec2[16](\nvec2( 0.000000,-0.333334),\nvec2(-0.500000, 0.333334),\nvec2( 0.500000,-0.777778),\nvec2(-0.750000,-0.111112),\nvec2( 0.250000, 0.555556),\nvec2(-0.250000,-0.555556),\nvec2( 0.750000, 0.111112),\nvec2(-0.875000, 0.777778),\nvec2(0.125000, -0.925926),\nvec2(-0.375000, -0.259260),\nvec2(0.625000, 0.407408),\nvec2(-0.625000, -0.703704),\nvec2(0.375000, -0.037038),\nvec2(-0.125000, 0.629630),\nvec2(0.875000, -0.481482),\nvec2(-0.937500, 0.185186));\n\n// TODO: Pass correct view size\nvec2 offset = haltonSequence[frameIndex];\noffset.x /= resolution.x;\noffset.y /= resolution.y;\n\nvec4 currentPosition = gl_Position;\nvec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);\n\n// We want to calculate the velocity with unjittered positions\n// so that things that are not moving get a velocity = 0\nvCurrentPosition = currentPosition;\nvPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);\n#ifdef OUTLINE_COMPENSATION\nvPreviousPosition.xy += OUTLINE_COMPENSATION;\n#endif\ngl_Position = currentPositionJittered;\n\n"),this.addFragmentFinalCode("\nvec2 oldPos = vPreviousPosition.xy;\n    oldPos /= vPreviousPosition.w;\n    oldPos.xy = (oldPos.xy+1.)/2.0;\n\nvec2 newPos = vCurrentPosition.xy;\n    newPos /= vCurrentPosition.w;\n    newPos.xy = (newPos.xy+1.)/2.0;\n\nvec2 velocity = (newPos - oldPos);\n\n// Discard fully transparent pixels \nif (gl_FragColor.a <= 0.0) discard;\n\ngVelocity = vec4(velocity, 0.0, 1.0);\n")),this}buildShader(e,t){this.resultCode[e]=t.build(this.setShader(e),"v4")}setMaterial(e,t){return this.defines={},this}addFlow(e,t,i){return this.addSlot(e).addCache(t).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(e){return this.cache=null!==e&&void 0!==e?e:"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(e){return this.context=Object.assign({},this.context,e),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(e){return this.slot=e||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(e,t){void 0===this.fragmentVariables[e]&&(this.addFragmentCode("".concat(t," ").concat(e,";")),this.fragmentVariables[e]="")}addFragmentParsVariable(e,t){void 0===this.fragmentParsVariables[e]&&(this.addFragmentParsCode("".concat(t," ").concat(e,";")),this.fragmentParsVariables[e]="")}addVertexParsVariable(e,t){void 0===this.vertexParsVariables[e]&&(this.addVertexParsCode("".concat(t," ").concat(e,";")),this.vertexParsVariables[e]="")}addVertexCode(e){this.addCode(e,"vertex")}addFragmentCode(e){this.addCode(e,"fragment")}addCode(e,t){this.code[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}addVertexNodeCode(e){this.addNodeCode(e,"vertex")}addFragmentNodeCode(e){this.addNodeCode(e,"fragment")}addNodeCode(e,t){this.nodeCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}clearNodeCode(e){var t;e=null!==(t=e)&&void 0!==t?t:this.shader;let i=this.nodeCode[e];return this.nodeCode[e]="",i}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(e){this.addFinalCode(e,"vertex")}addFragmentFinalCode(e){this.addFinalCode(e,"fragment")}addFinalCode(e,t){this.finalCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}addVertexParsCode(e){this.addParsCode(e,"vertex")}addFragmentParsCode(e){this.addParsCode(e,"fragment")}addParsCode(e,t){this.parsCode[null!==t&&void 0!==t?t:this.shader]+=e+"\n"}addVaryCode(e){this.addVertexParsCode(e),this.addFragmentParsCode(e)}isCache(e){return-1!==this.caches.indexOf(e)}isSlot(e){return-1!==this.slots.indexOf(e)}define(e,t){this.defines[e]=void 0===t?1:t}require(e){this.requires[e]=!0}isDefined(e){return void 0!==this.defines[e]}getVar(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"varying",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"V",a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=this.getVars(n),o=s[e];if(!o){let n=s.length;o={name:i||"node"+r+n+(a?"_"+a:""),type:t},s.push(o),s[e]=o}return o}getTempVar(e,t,i,n){return this.getVar(e,t,i,this.shader,"T",n)}getAttribute(e,t){if(!this.attributes[e]){let i=this.getVar(e,t);this.addVertexParsCode("attribute "+t+" "+e+";"),this.addVertexFinalCode(i.name+" = "+e+";"),this.attributes[e]={varying:i,name:e,type:t}}return this.attributes[e]}getCode(e){return[this.prefixCode,this.parsCode[e],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[e],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[e],"uniform"),this.getIncludesCode("consts",e),this.getIncludesCode("structs",e),this.getIncludesCode("functions",e),"void main() {",this.getVarListCode(this.getVars(e)),this.code[e],this.resultCode[e],this.finalCode[e],"}"].join("\n")}getVarListCode(e,t){var i;t=null!==(i=t)&&void 0!==i?i:"";let n="";for(let r=0,a=e.length;r<a;++r){let i=e[r],a=i.type,s=i.name,o=i.size,l=this.getFormatByType(a);if(void 0===l)throw new Error("Node pars "+l+" not found.");l.includes("[]")?n+=t+" "+l.substring(0,l.length-2)+" "+s+"[".concat(o,"];\n"):n+=t+" "+l+" "+s+";\n"}return n}getVars(e){return this.inputs.vars[null!==e&&void 0!==e?e:this.shader]}getNodeData(e){let t=e instanceof dI?e.uuid:e;return this.nodeData[t]=this.nodeData[t]||{}}createUniform(e,t,i,n,r,a){if(t.includes("[]")){let s=this.inputs.arrayUniforms,o=s.list.length,l=new uI({type:t,size:i.size,name:n||"nodeUA"+o+(a?"_"+a:""),node:i,needsUpdate:r});return s.list.push(l),s[e].push(l),s[e][l.name]=l,this.uniforms[l.name]=l,l}{let s=this.inputs.uniforms,o=s.list.length,l=new uI({type:t,name:n||"nodeU"+o+(a?"_"+a:""),node:i,needsUpdate:r});return s.list.push(l),s[e].push(l),s[e][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(e,t,i,n,r){return this.createUniform("vertex",e,t,i,n,r)}createFragmentUniform(e,t,i,n,r){return this.createUniform("fragment",e,t,i,n,r)}include(e,t,i){let n;if(e="string"==typeof e?pI.get(e):e,!1===this.context.include)return e.name;e instanceof _I?n=this.includes.functions:e instanceof EI?n=this.includes.consts:e instanceof PI&&(n=this.includes.structs);let r=n[this.shader]=n[this.shader]||[];if(e){var a;let n=r[e.name];if(n||(n=r[e.name]={node:e,deps:[]},r.push(n),n.src=e.build(this,"source")),e instanceof _I&&t&&r[t.name]&&-1===r[t.name].deps.indexOf(e)&&(r[t.name].deps.push(e),null!==(a=e.includes)&&void 0!==a&&a.length)){let i=0;do{this.include(e.includes[i++],t)}while(i<e.includes.length)}return i&&(n.src=i),e.name}throw new Error("Include not found.")}colorToVectorProperties(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(e){return e.replace(/c/g,"v3")}getIncludes(e,t){return this.includes[e][t||this.shader]}getConstructorFromLength(e){return ZI[e-1]}isTypeMatrix(e){return/^m/.test(e)}getTypeLength(e){return"f"===e?1:parseInt(this.colorToVector(e).substr(1))}getTypeFromLength(e){return 1===e?"f":"v"+e}findNode(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let n=0;n<arguments.length;n++){let e=t[n];if(null!==e&&void 0!==e&&e.isNode)return e}}resolve(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(let n=0;n<arguments.length;n++){let e=t[n];if(void 0!==e){if(e.isNode)return e;if(e.isTexture)switch(e.mapping){case Xa:case Ya:return new QI(e);case Za:return new YI(new II(e));default:return new II(e)}else{if(e.isVector2)return new gI(e);if(e.isVector3)return new vI(e);if(e.isVector4)return new bI(e)}}}}format(e,t,i){switch(this.colorToVector(i+" <- "+t)){case"f <- v2":case"f <- v3":case"f <- v4":return e+".x";case"f <- i":case"f <- b":return"float( "+e+" )";case"v2 <- f":return"vec2( "+e+" )";case"v2 <- v3":case"v2 <- v4":return e+".xy";case"v2 <- i":case"v2 <- b":case"v3 <- i":case"v3 <- b":return"vec2( float( "+e+" ) )";case"v3 <- f":return"vec3( "+e+" )";case"v3 <- v2":return"vec3( "+e+", 0.0 )";case"v3 <- v4":return e+".xyz";case"v4 <- f":return"vec4( "+e+" )";case"v4 <- v2":return"vec4( "+e+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+e+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+e+" ) )";case"i <- f":case"i <- b":return"int( "+e+" )";case"i <- v2":case"i <- v3":case"i <- v4":return"int( "+e+".x )";case"b <- f":return"( "+e+" != 0.0 )";case"b <- v2":return"( "+e+" != vec2( 0.0 ) )";case"b <- v3":return"( "+e+" != vec3( 0.0 ) )";case"b <- v4":return"( "+e+" != vec4( 0.0 ) )";case"b <- i":return"( "+e+" != 0 )"}return e}getTypeByFormat(e){return JI[e]||e}getFormatByType(e){return $I[e]||e}getUUID(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e}getElementByIndex(e){return KI[e]}getIndexByElement(e){return KI.indexOf(e)}isShader(e){return this.shader===e}setShader(e){return this.shader=e,this}mergeDefines(e){for(let t in e)this.defines[t]=e[t];return this.defines}mergeUniform(e){for(let t in e)this.uniforms[t]=e[t];return this.uniforms}getTextureEncodingFromMap(e){let t;return e?e.isTexture&&(t=e.encoding):t=fo,t===fo&&this.context.gamma&&(t=mo),t}},tk=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;super("c"),this.nodeType="Color",this.value=e instanceof yI?e:new yI(e||0,t,i,n)}setRGBA(e){this.value.setRGBA(e.r,e.g,e.b,e.a)}generate(e,t,i,n,r,a){var s,o;i=e.getUUID(null!==(s=i)&&void 0!==s?s:this.getUUID()),n=null!==(o=n)&&void 0!==o?o:this.getType(e);let l=e.getNodeData(i),c=this.getReadonly()&&void 0!==this.generateReadonly;if(this.alpha){let t=this.alpha.build(e,"f");e.addFragmentNodeCode("accumAlpha += ( 1.0 - accumAlpha ) * ".concat(t,";"))}return c?this.generateReadonly(e,t,i,n,r,a):e.isShader("vertex")?(l.vertex||(l.vertex=e.createVertexUniform(n,this,r,a,this.getLabel())),e.format(l.vertex.name,n,t)):(l.fragment||(l.fragment=e.createFragmentUniform(n,this,r,a,this.getLabel())),e.format(l.fragment.name,n,t))}generateReadonly(e,t,i,n,r,a){return e.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",n,t)}},ik=class extends mI{constructor(e){super("i"),this.nodeType="Int",this.value=Math.floor(null!==e&&void 0!==e?e:0)}generateReadonly(e,t,i,n,r,a){return e.format(this.value.toString(),n,t)}},nk=class extends mI{constructor(e){super("b"),this.nodeType="Bool",this.value=null!==e&&void 0!==e&&e}generateReadonly(e,t,i,n){return e.format(this.value?"true":"false",n,t)}},rk=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;super("f[]"),this.nodeType="FloatArray",this.size=e,this.value=Array.isArray(t)?t:"number"==typeof t?new Array(e).fill(t):new Array(e).fill(0)}},ak=class extends mI{},sk=class extends ak{constructor(e){super("v3"),this.image=e,this._value=new gl}get value(){var e,t;return this._value.x=this.image.isVideo?null!==(e=this.image.img.videoWidth)&&void 0!==e?e:0:this.image.img.width,this._value.y=this.image.isVideo?null!==(t=this.image.img.videoHeight)&&void 0!==t?t:0:this.image.img.height,this._value}},ok=class extends ak{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1008;super("t"),this.image=e,this.wrap=t,this.minFilter=i}get value(){return this.image.getTexture(this.wrap,this.minFilter)}},lk=class extends mI{constructor(e){super("m3"),this.nodeType="Matrix3",this.value=null!==e&&void 0!==e?e:new Vo}generateReadonly(e,t,i,n,r,a){return e.format("mat3("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}},ck=class extends mI{constructor(e){super("m4"),this.nodeType="Matrix4",this.value=null!==e&&void 0!==e?e:new ql}generateReadonly(e,t,i,n,r,a){return e.format("mat4("+this.value.elements.join(", ")+")",n,t)}get elements(){return this.value.elements}set elements(e){this.value.fromArray(e)}};function hk(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e.setUvTransform(i[0],i[1],t[0],t[1],0,0,0).premultiply((new Vo).makeRotation(n*Uo.DEG2RAD))}var dk=class extends lk{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(new Vo),this.repeat=e,this.offset=t,this.rotation=i,hk(this.value,e,t,i)}updateMatrix(){hk(this.value,this.repeat,this.offset,this.rotation)}},uk=class extends mI{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;super("v4[]"),this.nodeType="Vector4Array",this.size=e,this.value=Array.isArray(t)?t:t instanceof dl?new Array(e).fill(t):new Array(e).fill(new dl(0))}},pk=class extends fI{constructor(e,t,i,n){super("v3"),this.nodeType="Blend",this.a=e,this.b=t,this.alpha=i,this.mode=n}generate(e,t){if(e.isShader("fragment")){let i=[];return i.push(this.a.build(e,"c")),i.push(this.b.build(e,"c")),i.push(this.alpha.build(e,"f")),i.push(this.mode.build(e,"i")),e.format("spe_blend("+i.join(",")+")",this.getType(e),t)}return console.warn("BlendNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},fk=class extends fI{constructor(e,t){super("v3"),this.nodeType="CustomColor",this.color=e,this.alpha=t,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){let i=e.include(fk.Nodes.customColor);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.color.build(e,"v3")),n.push(this.mask?"luminance(".concat(this.mask.build(e,"v3"),")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomColorNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},mk=fk;mk.Nodes={customColor:new _I("vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color;\n\t\t\t}")};var gk=class extends fI{constructor(e,t){super("v3"),this.nodeType="CustomNormal",this.cnormal=e,this.alpha=t,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){let i=e.include(gk.Nodes.customNormal);e.addFragmentVariable(this.calpha,"float");let n=[];return n.push(this.cnormal.build(e,"v3")),n.push("normal"),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("CustomNormalNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},vk=gk;vk.Nodes={customNormal:new _I("vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 normal = packNormalToRGB( norm ).rgb;\n\t\t\t\tnormal *= step( vec3(0.5), cnormal );\n\n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\n\t\t\t\treturn normal;\n\t\t\t}")};var yk=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c,h,d){super("v3"),this.nodeType="CustomTexture",this.texture=e,this.textureSize=t,this.crop=i,this.projection=n,this.axis=r,this.side=a,this.size=s,this.blending=o,this.mat=l,this.isMask=d,this.alpha=c,this.mode=h,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){e.require("position"),e.require("normal"),e.require("uv"),e.requires.uv=[!0],e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0;let i,n="g".concat(this.uuid.toString().replace(/-/g,""));switch(this.projection.value){case 3:i=e.include(yk.Nodes.cylindrical);break;case 2:i=e.include(yk.Nodes.spherical);break;case 1:let t=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],r=["zy","xz","xy"][this.axis.value],a=new _I("\n\t\tvec3 ".concat(n,"_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 projected = (1. + (position.").concat(r,")) / 2.;\n\t\t\t\tvec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\t").concat(2===this.side.value?"":"lalpha *= step(0.0, ".concat(1===this.side.value?"-1.0 * ":"","dot(vObjectNormal, ").concat(t,"));"),"\n\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"));i=e.include(a);break;case 4:i=e.include(yk.Nodes.triplanar);break;default:i=e.include(yk.Nodes.uv)}e.addFragmentVariable(this.calpha,"float");let r=[];if(r.push("normal"),r.push(this.texture.generate(e,"t")),r.push(this.textureSize.build(e,"v2")),r.push(this.crop.build(e,"f")),r.push(this.mat.build(e,"mat3")),r.push(this.size.build(e,"v2")),r.push(this.blending.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),4===this.projection.value){let t="".concat(n,"_writeUvs"),i=t+"0",a=t+"1",s=t+"2",o="".concat(n,"_triplanarWeights");e.addFragmentVariable(i,"vec2"),e.addFragmentVariable(a,"vec2"),e.addFragmentVariable(s,"vec2"),e.addFragmentVariable(o,"vec3"),r.push(i),r.push(a),r.push(s),r.push(o)}else{let t="".concat(n,"_writeUvs");e.addFragmentVariable(t,"vec2"),r.push(t)}return e.format(i+"("+r.join(",")+")",this.getType(e),t)}},bk=yk;bk.Nodes={cylindrical:new _I("\nvec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(position);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float scaledHeight = position.y / (size.y * 0.5);\n                float v =  (scaledHeight / 2.) + .5;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\t\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),spherical:new _I("\nvec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n                vec3 posN = normalize(vPosition);\n                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);\n                float v = 0.5 + asin(posN.y) / 3.1415;\n\n                vec2 calculatedUv = vec2(u,v);\n\t\t\t\tvec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n                vec2 df = fwidth(uvs);\n               \tif(df.x > 0.5) df.x = 0.;\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#else\n                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}\n"),uv:new _I("vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {\n\t\t\t\tvec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;\n\t\t\t\twriteUv = uvs;\n\n\t\t\t\tvec4 tmp = texture2D( tex, uvs );\n\n\t\t\t\tvec3 col = tmp.rgb;\n\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tlalpha *= mask;\n\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;\n\t\t\t}"),triplanar:new _I("vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {\n\t\t\t\tvec3 p = position;\n\t\t\t\tvec2 uv0 = (1.0 + p.xy) / 2.0;     \n\t\t\t\tvec2 uv1 = (1.0 + p.zy) / 2.0;\t\t\n\t\t\t\tvec2 uv2 = (1.0 + p.xz) / 2.0;\t\t\n\t\n\t\t\t\tuv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\t\t\t\tuv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;\n\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\n\t\t\t\t// Write out all sets of UVs that we generated\n\t\t\t\twriteUvs0 = uv0;\n\t\t\t\twriteUvs1 = uv1;\n\t\t\t\twriteUvs2 = uv2;\n\t\t\t\twriteWeights = weights;\n\n\t\t\t\t// Derivatives for LOD\n\t\t\t\tvec2 df0 = fwidth(uv0);\n\t\t\t\tvec2 df1 = fwidth(uv1);\n\t\t\t\tvec2 df2 = fwidth(uv2);\n\t\t\t\tif (df0.x > 0.5) df0.x = 0.0;\n\t\t\t\tif (df1.x > 0.5) df1.x = 0.0;\n\t\t\t\tif (df2.x > 0.5) df2.x = 0.0;\n\n\t\t\t\t#ifdef GL_EXT_shader_texture_lod\n                \tvec4 tmp = \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttexture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#else\n                \tvec4 tmp = \n\t\t\t\t\t\ttextureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + \n\t\t\t\t\t\ttextureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + \n\t\t\t\t\t\ttextureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;\n\t\t\t\t#endif\n\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tfloat lalpha = alpha * tmp.a;\n\n\t\t\t\t// Apply cropping across all 3 planes\n\t\t\t\tif ( crop > 0.5 ) {\n\t\t\t\t\tif ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t\tif ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {\n\t\t\t\t\t\tlalpha = 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlalpha *= mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn col;//n * 0.5 + 0.5;\n\t\t\t}\t\t\t\n\t\t\t")};var xk=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c,h,d){super("v3"),this.nodeType="Depth",this.gradientType=e,this.smooth=t,this.near=i,this.far=n,this.isVector=r,this.isWorldSpace=a,this.origin=s,this.direction=o,this.colors=l,this.steps=c,this.isMask=d,this.alpha=h,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){let i="g".concat(this.uuid.toString().replace(/-/g,"")),n=new _I("vec3 ".concat(i,"_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[").concat(i,"_MAX_COLORS], float steps[").concat(i,"_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {\n               vec4 color = colors[0];\n               #ifdef ").concat(i,"_IS_VECTOR\n                   #ifdef ").concat(i,"_LINEAR\n                       #ifdef ").concat(i,"_WORLDSPACE\n                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);\n                       #else\n                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);\n                       #endif\n                   #else\n                       #ifdef ").concat(i,"_WORLDSPACE\n                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);\n                       #else\n                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);\n                       #endif\n                   #endif\n               #else\n                   float dist = length(vWPosition - cameraPosition);\n\t\t\t       float depth = ( dist - near ) / ( far - near );\n               #endif\n\n\n              float p;\n              #ifdef ").concat(i,"_SMOOTH\n\t\t\t\tfor ( int i = 1; i < ").concat(i,"_MAX_COLORS; i++ ) {\n\t\t\t\t\t\tp = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n              #else\n                for ( int i = 1; i < ").concat(i,"_MAX_COLORS; i++ ) {\n                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);\n                   color = mix(color, colors[i], p);\n                 }\n              #endif\n\n               float lalpha = alpha * color.a * mask;\n               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t   \n               return color.rgb;\n\t\t\t}"),[xk.Nodes.vectorLinearWorldSpaceDepth,xk.Nodes.vectorLinearObjectSpaceDepth,xk.Nodes.vectorSphericalObjectSpaceDepth,xk.Nodes.vectorSphericalWorldSpaceDepth]);if(e.isShader("fragment")){e.define("".concat(i,"_MAX_COLORS"),this.colors.value.length),this.smooth.value&&e.define("".concat(i,"_SMOOTH")),this.isVector.value>.5&&e.define("".concat(i,"_IS_VECTOR")),0===this.gradientType.value&&e.define("".concat(i,"_LINEAR")),this.isWorldSpace.value>.5&&e.define("".concat(i,"_WORLDSPACE")),e.require("worldPosition"),e.addFragmentVariable(this.calpha,"float");let r=e.include(n),a=[];return a.push(this.near.build(e,"f")),a.push(this.far.build(e,"f")),a.push(this.origin.build(e,"v3")),a.push(this.direction.build(e,"v3")),a.push(this.colors.build(e,"v4[]")),a.push(this.steps.build(e,"f[]")),a.push(this.isMask.build(e,"b")),a.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),a.push(this.alpha.build(e,"f")),a.push(this.calpha),e.format(r+"("+a.join(",")+")",this.getType(e),t)}return console.warn("DepthNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},wk=xk;wk.Nodes={vectorLinearWorldSpaceDepth:new _I("float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorLinearObjectSpaceDepth:new _I("float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {\n               vec3 n = normalize(direction);\n               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalWorldSpaceDepth:new _I("float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(vWPosition - origin);\n               return ( dist - near ) / ( far - near );\n            }"),vectorSphericalObjectSpaceDepth:new _I("float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {\n               float dist = length(position - origin);\n               return ( dist - near ) / ( far - near );\n            }")};var _k=class extends fI{constructor(e,t,i,n,r,a,s,o){super("v3"),this.nodeType="Fresnel",this.color=e,this.bias=t,this.scale=i,this.intensity=n,this.factor=r,this.isMask=o,this.alpha=a,this.mode=s,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=new _I("vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {\n\t\t\t\t\tfloat fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );\n\n\t\t\t\t\tfloat lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn color;\n\t\t\t\t}"),n=e.include(i),r=[];return r.push(this.color.build(e,"c")),r.push(this.bias.build(e,"f")),r.push(this.scale.build(e,"f")),r.push(this.intensity.build(e,"f")),r.push(this.factor.build(e,"f")),r.push(this.isMask.build(e,"b")),r.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),r.push(this.alpha.build(e,"f")),r.push(this.mode.build(e,"i")),r.push(this.calpha),e.format(n+"("+r.join(",")+")",this.getType(e),t)}return console.warn("FresnelNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Sk=class extends fI{constructor(e,t,i,n,r,a,s,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=e,this.smooth=t,this.colors=i,this.steps=n,this.offset=r,this.morph=a,this.angle=s,this.isMask=l,this.alpha=o,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){e.define("GRAD_MAX",10),e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Sk.Nodes.gradient),n=[];return n.push(this.gradientType.build(e,"i")),n.push(this.smooth.build(e,"b")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.offset.build(e,"v2")),n.push(this.morph.build(e,"v2")),n.push(this.angle.build(e,"f")),n.push(this.isMask.build(e,"b")),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("GradientNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Ak=Sk;Ak.Nodes={gradient:new _I("vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tvec2 m = morph / vUv.xy;\n\t\t\t\tvec2 rot = vec2( 0.5 + m.x, m.y );\n\t\t\t\tvec2 dt = vec2(\n\t\t\t\t\tcos( angle ) * rot.x - sin( angle ) * rot.y,\n\t\t\t\t\tsin( angle ) * rot.x + cos( angle ) * rot.y\n\t\t\t\t);\n\t\t\t\tvec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;\n\t\t\t\tfloat t = dot( pt, dt ) / dot( dt, dt );\n\t\t\t\tif ( gradientType == 1 ) {\n\t\t\t\t\tt = distance (\n\t\t\t\t\t\t( vUv + morph ) * 3.0,\n\t\t\t\t\t\t( vUv + offset ) + 1.0\n\t\t\t\t\t) + angle;\n\t\t\t\t} else if ( gradientType == 2 ) {\n\t\t\t\t\tfloat polar = atan(\n\t\t\t\t\t\tvUv.x + morph.x - 0.5 + offset.x,\n\t\t\t\t\t\tvUv.y + morph.y - 0.5 + offset.y\n\t\t\t\t\t) * -1.0;\n\t\t\t\t\tt = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );\n\t\t\t\t}\n\n\t\t\t\tfloat p;\n\t\t\t\tif (smoothed) {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tfor ( int i = 1; i < GRAD_MAX; i++ ) {\n\t\t\t\t\t\tp = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );\n\t\t\t\t\t\tcolor = mix(color, colors[i], p);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\n\t\t\t\treturn color.xyz;\n\t\t\t}")};var Ek=class extends fI{constructor(e,t,i,n,r){super("v3"),this.nodeType="Matcap",this.texture=e,this.isMask=n,this.alpha=t,this.mode=i,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha"),this.rotation=r}generate(e,t){if(e.isShader("fragment")){e.addFragmentVariable(this.calpha,"float");let i=e.include(Ek.Nodes.matcap);e.require("normal"),e.requires.normal=!0;let n=[];return n.push(this.texture.generate(e,"t")),n.push("normal"),n.push(this.isMask.build(e,"b")),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.mode.build(e,"i")),n.push(this.calpha),n.push(this.rotation.build(e,"f")),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("MatcapNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Ck=Ek;Ck.Nodes={matcap:new _I("vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {\n\t\t\t\t\tvec3 viewDir = normalize( vViewPosition );\n\t\t\t\t\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\t\t\t\t\tvec3 y = cross( viewDir, x );\n\t\t\t\t\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) );\n\t\t\t\t\tuv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;\n\t\t\t\t\tuv = uv * 0.495 + 0.5;\n\t\t\t\t\tvec4 matcapColor = texture2D( matcapTex, uv );\n\n\t\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\t\t\t\t\t\n\t\t\t\t\treturn matcapColor.rgb;\n            \t}")};var Mk=(e=>(e.SIMPLEX="simplex3d",e.SIMPLEX_FRACTAL="simplex3dFractal",e.ASHIMA="simplexAshima",e.FBM="fbm",e.PERLIN="perlin",e.VORONOI="voronoi",e))(Mk||{}),Pk=function(){let e=new _I("vec3 random3(vec3 c) {\n\t\t\tfloat j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n\t\t\tvec3 r;\n\t\t\tr.z = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.x = fract(512.0*j);\n\t\t\tj *= .125;\n\t\t\tr.y = fract(512.0*j);\n\t\t\treturn r-0.5;\n\t\t}"),t=new _I("float simplex3d(vec3 p) {\n\t\t\t vec3 s = floor(p + dot(p, vec3(F3)));\n\t\t\t vec3 x = p - s + dot(s, vec3(G3));\n\t\t\t \n\t\t\t vec3 e = step(vec3(0.0), x - x.yzx);\n\t\t\t vec3 i1 = e*(1.0 - e.zxy);\n\t\t\t vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n\t\t\t\t\n\t\t\t vec3 x1 = x - i1 + G3;\n\t\t\t vec3 x2 = x - i2 + 2.0*G3;\n\t\t\t vec3 x3 = x - 1.0 + 3.0*G3;\n\t\t\t \n\t\t\t vec4 w, d;\n\t\t\t \n\t\t\t w.x = dot(x, x);\n\t\t\t w.y = dot(x1, x1);\n\t\t\t w.z = dot(x2, x2);\n\t\t\t w.w = dot(x3, x3);\n\t\t\t \n\t\t\t w = max(0.6 - w, 0.0);\n\t\t\t \n\t\t\t d.x = dot(random3(s), x);\n\t\t\t d.y = dot(random3(s + i1), x1);\n\t\t\t d.z = dot(random3(s + i2), x2);\n\t\t\t d.w = dot(random3(s + 1.0), x3);\n\t\t\t \n\t\t\t w *= w;\n\t\t\t w *= w;\n\t\t\t d *= w;\n\t\t\t \n\t\t\t return dot(d, vec4(52.0));\n\t\t}",[e]);t.keywords.F3=new EI("float F3 0.3333333"),t.keywords.G3=new EI("float G3 0.1666667");let i=new _I("float simplex3dFractal(vec3 m) {\n\t\t\tmat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);\n\t\t\tmat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);\n\t\t\tmat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);\n\t\t\treturn 0.5333333 * simplex3d(m * rot1)\n\t\t\t\t + 0.2666667 * simplex3d(2.0 * m * rot2)\n\t\t\t\t + 0.1333333 * simplex3d(4.0 * m * rot3)\n\t\t\t\t + 0.0666667 * simplex3d(8.0 * m);\n\t\t}",[t]),n=new _I("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),r=new _I("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new _I("float simplexAshima(vec3 v) {\n\t\t  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n\t\t  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\t\t  vec3 i  = floor(v + dot(v, C.yyy) );\n\t\t  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\t\t  vec3 g = step(x0.yzx, x0.xyz);\n\t\t  vec3 l = 1.0 - g;\n\t\t  vec3 i1 = min( g.xyz, l.zxy );\n\t\t  vec3 i2 = max( g.xyz, l.zxy );\n\t\t  vec3 x1 = x0 - i1 + 1.0 * C.xxx;\n\t\t  vec3 x2 = x0 - i2 + 2.0 * C.xxx;\n\t\t  vec3 x3 = x0 - 1. + 3.0 * C.xxx;\n\t\t  i = mod(i, 289.0 ); \n\t\t  vec4 p = permute( permute( permute( \n\t\t\t\t\t i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n\t\t\t\t   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n\t\t\t\t   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\t\t  float n_ = 1.0/7.0; // N=7\n\t\t  vec3  ns = n_ * D.wyz - D.xzx;\n\t\t  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)\n\t\t  vec4 x_ = floor(j * ns.z);\n\t\t  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\t\t  vec4 x = x_ *ns.x + ns.yyyy;\n\t\t  vec4 y = y_ *ns.x + ns.yyyy;\n\t\t  vec4 h = 1.0 - abs(x) - abs(y);\n\t\t  vec4 b0 = vec4( x.xy, y.xy );\n\t\t  vec4 b1 = vec4( x.zw, y.zw );\n\t\t  vec4 s0 = floor(b0)*2.0 + 1.0;\n\t\t  vec4 s1 = floor(b1)*2.0 + 1.0;\n\t\t  vec4 sh = -step(h, vec4(0.0));\n\t\t  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n\t\t  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\t\t  vec3 p0 = vec3(a0.xy,h.x);\n\t\t  vec3 p1 = vec3(a0.zw,h.y);\n\t\t  vec3 p2 = vec3(a1.xy,h.z);\n\t\t  vec3 p3 = vec3(a1.zw,h.w);\n\t\t  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n\t\t  p0 *= norm.x;\n\t\t  p1 *= norm.y;\n\t\t  p2 *= norm.z;\n\t\t  p3 *= norm.w;\n\t\t  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n\t\t  m = m * m;\n\t\t  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n\t\t\t\t\t\t\t\t\t\tdot(p2,x2), dot(p3,x3) ) );\n\t\t}",[n,r]),s=new _I("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),o=new _I("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[s]),l=new _I("float noise(vec3 p){\n\t\t\tvec3 a = floor(p);\n\t\t\tvec3 d = p - a;\n\t\t\td = d * d * (3.0 - 2.0 * d);\n\t\t\tvec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n\t\t\tvec4 k1 = perm(b.xyxy);\n\t\t\tvec4 k2 = perm(k1.xyxy + b.zzww);\n\t\t\tvec4 c = k2 + a.zzzz;\n\t\t\tvec4 k3 = perm(c);\n\t\t\tvec4 k4 = perm(c + 1.0);\n\t\t\tvec4 o1 = fract(k3 * (1.0 / 41.0));\n\t\t\tvec4 o2 = fract(k4 * (1.0 / 41.0));\n\t\t\tvec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n\t\t\tvec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\t\t\treturn o4.y * d.y + o4.x * (1.0 - d.y);\n\t\t}",[o]),c=new _I("float fbm(vec3 x) {\n\t\t\tfloat v = 0.0;\n\t\t\tfloat a = 0.5;\n\t\t\tvec3 shift = vec3(100);\n\t\t\tfor (int i = 0; i < NUM_OCTAVES; ++i) {\n\t\t\t\tv += a * noise(x);\n\t\t\t\tx = x * 2.0 + shift;\n\t\t\t\ta *= 0.5;\n\t\t\t}\n\t\t\treturn v;\n\t\t}",[l]);c.keywords.NUM_OCTAVES=new EI("int NUM_OCTAVES ".concat(5));let h=new _I("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new _I("float perlin(vec3 P){\n\t\t  vec3 Pi0 = floor(P);\n\t\t  vec3 Pi1 = Pi0 + vec3(1.0);\n\t\t  Pi0 = mod(Pi0, 289.0);\n\t\t  Pi1 = mod(Pi1, 289.0);\n\t\t  vec3 Pf0 = fract(P);\n\t\t  vec3 Pf1 = Pf0 - vec3(1.0);\n\t\t  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n\t\t  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n\t\t  vec4 iz0 = Pi0.zzzz;\n\t\t  vec4 iz1 = Pi1.zzzz;\n\t\t  vec4 ixy = permute(permute(ix) + iy);\n\t\t  vec4 ixy0 = permute(ixy + iz0);\n\t\t  vec4 ixy1 = permute(ixy + iz1);\n\t\t  vec4 gx0 = ixy0 / 7.0;\n\t\t  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;\n\t\t  gx0 = fract(gx0);\n\t\t  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n\t\t  vec4 sz0 = step(gz0, vec4(0.0));\n\t\t  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n\t\t  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\t\t  vec4 gx1 = ixy1 / 7.0;\n\t\t  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;\n\t\t  gx1 = fract(gx1);\n\t\t  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n\t\t  vec4 sz1 = step(gz1, vec4(0.0));\n\t\t  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n\t\t  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\t\t  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n\t\t  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n\t\t  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n\t\t  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n\t\t  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n\t\t  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n\t\t  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n\t\t  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\t\t  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n\t\t  g000 *= norm0.x;\n\t\t  g010 *= norm0.y;\n\t\t  g100 *= norm0.z;\n\t\t  g110 *= norm0.w;\n\t\t  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n\t\t  g001 *= norm1.x;\n\t\t  g011 *= norm1.y;\n\t\t  g101 *= norm1.z;\n\t\t  g111 *= norm1.w;\n\t\t  float n000 = dot(g000, Pf0);\n\t\t  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n\t\t  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n\t\t  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n\t\t  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n\t\t  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n\t\t  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n\t\t  float n111 = dot(g111, Pf1);\n\t\t  vec3 fade_xyz = fade(Pf0);\n\t\t  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n\t\t  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n\t\t  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n\t\t  return 2.2 * n_xyz;\n\t\t}",[n,r,h]),u=new _I("float hashwithoutsine13(vec3 p3)\n\t\t{\n\t\t\tp3  = fract(p3 * .1031);\n\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t}"),p=new _I("vec3 hashwithoutsine33(vec3 p3)\n\t\t{\n\t\t\tp3 = fract(p3 * vec3(.1031, .1030, .0973));\n\t\t\tp3 += dot(p3, p3.yxz+33.33);\n\t\t\treturn fract((p3.xxy + p3.yxx)*p3.zyx);\n\t\t}"),f=new _I("float metric(in vec3 p)\n\t\t{\n\t\t\t// L2 \n\t\t\treturn length(p);\n\n\t\t\t// Chebyshev \n\t\t\t// vec3 a = abs(p);\n\t\t\t// return max(a.x, max(a.y, a.z));\n\t\t}"),m=new _I("float smin( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(b, a, h) - correction;\n\t\t}"),g=new _I("float smax( float a, float b, float k )\n\t\t{\n\t\t\tfloat h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);\n\t\t\tfloat correction = k * h * (1.0 - h);\n\t\t\treturn mix(a, b, h) + correction;\n\t\t}"),v=new _I("float remap(float value, float input_min, float input_max, float output_min, float output_max) {\n\t\t\t// Compute width of each interval\n\t\t\tfloat input_width = input_max - input_min;\n\t\t\tfloat output_width = output_max - output_min;\n\t\t\n\t\t\t// Convert input range into a 0-1 range \n\t\t\tfloat scaled = (value - input_min) / input_width;\n\t\t\n\t\t\t// Convert the 0-1 range into a value in output range\n\t\t\treturn output_min + (scaled * output_width);\n\t\t}");return{simplex:t,simplexFractal:i,simplexAshima:a,fbm:c,perlin:d,voronoi:new _I('float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) \n\t\t{\n\t\t\t// Integer and fractional parts of this point\'s coordinates\n\t\t\tivec3 p = ivec3(floor(x));\n\t\t\tvec3 f = fract(x);\n\n\t\t\t// Different variables that we will use to construct noise:\n\t\t\t//\n\t\t\t// f1: distance to the closest feature point\n\t\t\t// f2: distance to the second closest feature point\n\t\t\t// e: distance to the closest edge (cell boundary)\n\t\t\t//\n\t\t\t// We also compute "smooth" versions of all of the above quantites, essentially\n\t\t\t// replacing "hard" minimums with "smooth" minimums (described by IQ)\n\t\t\tfloat f1_smooth = 8.0;\n\t\t\tfloat f1 = 8.0;\n\t\t\tfloat f2_smooth = 8.0;\n\t\t\tfloat f2 = 8.0;\n\t\t\tfloat e_smooth = 8.0;\n\t\t\tfloat e = 8.0;\n\n\t\t\t// Variables stored from closest cell\n\t\t\tivec3 mb;\n\t\t\tvec3 mr; \n\n\t\t\tint steps = quality;\n\t\t\t\n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d = length(r);\n\t\t\t\t\n\t\t\t\tf1_smooth = smin(d, f1_smooth, smoothness);\n\n\t\t\t\t// Store un-smoothed distances too \n\t\t\t\tif (d < f1) \n\t\t\t\t{\n\t\t\t\t\tf2 = f1;\n\t\t\t\t\tf1 = d;\n\n\t\t\t\t\tmb = ivec3(x, y, z);\n\t\t\t\t\tmr = r;\n\t\t\t\t} \n\t\t\t\telse if (d < f2) \n\t\t\t\t{\n\t\t\t\t\tf2 = d;\n\t\t\t\t}\n\t\t\t}\t\n\t\t\t\n\t\t\tfloat id = hashwithoutsine13(vec3(p + mb) + seed);\n\n\t\t\t// Second pass for edge distance  \n\t\t\tfor (int x = -steps; x <= steps; x++) \n\t\t\tfor (int y = -steps; y <= steps; y++)\n\t\t\tfor (int z = -steps; z <= steps; z++)\n\t\t\t{\n\t\t\t\t// Start search at the cell that contains the closest point to "x" (found in 1st pass)\n\t\t\t\tivec3 b = mb + ivec3(x, y, z);\n\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\tfloat d1 = dot(0.5 * (mr + r), (r - mr)); \t\t\t\t// IQ normalizes "r - mr" but that breaks things for the smooth version?\n\t\t\t\tfloat d2 = dot(0.5 * (mr + r), normalize(r - mr));\n\n\t\t\t\te_smooth = smin(d1, e_smooth, smoothness);\n\n\t\t\t\te = min(e, d2);\n\n\t\t\t\t// Also compute a smooth version of F2 in this pass\n\t\t\t\t{\n\t\t\t\t\tivec3 b = ivec3(x, y, z);\n\t\t\t\t\tif (b != mb) \n\t\t\t\t\t{\n\t\t\t\t\t\tvec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;\n\t\t\t\t\t\tfloat d = length(r);\n\n\t\t\t\t\t\tf2_smooth = smin(d, f2_smooth, smoothness);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Different visualization modes \n\t\t\tif (style == 0) \n\t\t\t{\n\t\t\t\treturn f1_smooth;\n\t\t\t}\n\t\t\tif (style == 1) \n\t\t\t{\n\t\t\t\treturn f2_smooth;\n\t\t\t}\n\t\t\tif (style == 2) \n\t\t\t{\n\t\t\t\treturn f2_smooth - f1_smooth;\n\t\t\t\t\n\t\t\t\t// "Pebbles" also cool\n\t\t\t\t//return step(0.2, f2_smooth - f1_smooth);\n\t\t\t}\n\t\t\tif (style == 3) \n\t\t\t{\n\t\t\t\t// This one is really good for rock / stone effects\n\t\t\t\tfloat a = f1; \n\t\t\t\tfloat b = f2;\n\t\t\t\tfloat k = 3.0;\n\t\t\t\tfloat h = max(k - abs(a - b), 0.0) / k;\n\t\t\t\tfloat final = min(a, b) - h * h * k * (1.0 / 4.0);\n\t\t\t\treturn final;\n\t\t\t}\n\t\t\tif (style == 4) \n\t\t\t{\n\t\t\t\t// Some random adjustments to make this style stand out more \n\t\t\t\treturn exp(5.0 * e_smooth);\n\t\t\t}\n\t\t\tif (style == 5) \n\t\t\t{\n\t\t\t\treturn pow(f1_smooth, 3.0);\n\t\t\t}\n\t\t\tif (style == 6) \n\t\t\t{\t\t\t\t\n\t\t\t\tconst float eps = 0.0125;\n\n\t\t\t\t// Thicker lines as the user increases the smoothness slider\n\t\t\t\tfloat thickness = smoothness * 0.25 + eps;\n\n\t\t\t\t// Blurrier lines as the user increases the smoothness slider\n\t\t\t\tfloat blur = pow(smoothness, 3.0) * 0.25 + eps;\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\tthickness - thickness * blur, \n\t\t\t\t\tthickness + thickness * blur, \n\t\t\t\t\te\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (style == 7) \n\t\t\t{\n\t\t\t\treturn hashwithoutsine13(vec3(p + mb) + seed);\n\t\t\t}\n\t\t}\n\t',[u,p,f,m,g,v])}}(),Tk=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c,h,d,u,p,f,m,g,v,y){super("v3"),this.nodeType="Noise",this.scale=e,this.size=t,this.move=i,this.fA=n,this.fB=r,this.distortion=a,this.colorA=s,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=d,this.voronoiStyle=p,this.highCut=f,this.lowCut=m,this.smoothness=g,this.seed=v,this.quality=y,this.isMask=u,this.alpha=h,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t,i,n,r){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let a=Object.values(Mk)[this.noiseType.value],s="voronoi"==a?"\n\t\tfloat v = ".concat(a,'(st + move, voronoiStyle, smoothness, seed, quality);\n\n\t\t// Apply clipping to colors\n\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t// Note that the voronoi mode only uses colors "A" and "C" from the UI \n\t\tvec4 color = mix(colorA, colorC, v); \n\t\t'):"\n\t\tvec3 q = vec3(".concat(a,"(st),\n\t\t\t\t\t   ").concat(a,"(st + vec3(1.0)),\n\t\t\t\t\t   ").concat(a,"(st + vec3(1.0)));\n\t\tvec3 r = vec3(").concat(a,"(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),\n\t\t\t\t\t  ").concat(a,"(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), \n\t\t\t\t\t  ").concat(a,"(st * q));\n\t\tfloat f = ").concat(a,"(st + r);\n\t\tvec4 color;\n\t\tcolor = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));\n\t\tcolor = mix(color, colorC, clamp(length(q), 0.0, 1.0));\n\t\tcolor = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));\n\t\t"),o=new _I("vec3 ".concat(a,"customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) \n\t\t\t{\n                // Prevent scale of zero \n\t\t\t\tscale = max(abs(scale), 0.001);\n\n\t\t\t\tvec3 st = position / size;\n\t\t\t\tst /= scale;\n\n\t\t\t\t").concat(s,"\n\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t}"),[Pk.simplex,Pk.simplexFractal,Pk.simplexAshima,Pk.fbm,Pk.perlin,Pk.voronoi]),l=e.include(o),c=[];return c.push(this.scale.build(e,"f")),c.push(this.size.build(e,"v3")),c.push(this.move.build(e,"f")),c.push(this.fA.build(e,"v2")),c.push(this.fB.build(e,"v2")),c.push(this.distortion.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.colorC.build(e,"v4")),c.push(this.colorD.build(e,"v4")),c.push(this.voronoiStyle.build(e,"i")),c.push(this.highCut.build(e,"f")),c.push(this.lowCut.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.seed.build(e,"f")),c.push(this.quality.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}};Tk.numOctaves=5;var Dk=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c,h,d,u,p,f,m){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=e,this.contourColor=t,this.outlineWidth=i,this.contourWidth=n,this.contourThreshold=r,this.outlineThreshold=a,this.contourFrequency=s,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=h,this.resolution=d,this.normalMap=u,this.depthMap=p,this.pixelRatio=f,this.alpha=m,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){let i="g".concat(this.uuid.toString().replace(/-/g,""));if(e.require("vWorldViewDir"),e.require("worldNormal"),e.extensions.derivatives=!0,this.compensation.value&&e.define("OUTLINE_COMPENSATION","".concat(i,"_offset")),this.firstTime){let t=this.outlineWidth.build(e,"f"),n=this.resolution.build(e,"v2"),r=this.compensation.build(e,"b"),a=this.pixelRatio.build(e,"f");e.addVertexParsVariable("randomColor","attribute vec3"),e.addVertexParsVariable("extrudeNormal","attribute vec3"),e.addVertexParsVariable(t,"uniform float"),e.addVertexParsVariable(n,"uniform vec2"),e.addVertexParsVariable(r,"uniform bool"),e.addVertexParsVariable(a,"uniform float"),e.addVertexParsVariable("vID","flat out float"),e.addFragmentParsVariable("vID","flat in float"),e.addVertexFinalCode("\n                vID = randomColor.r;\n                vec2 ".concat(i,"_offset = vec2(0.0);\n                if (").concat(r,") {\n                    vec4 ").concat(i,"_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the\n                    // normals face the camera directly. So we hackily fix this by offsetting the normal\n                    // by a tiny amount.\n                    vec3 ").concat(i,"_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;\n                    ").concat(i,"_offset = normalize(").concat(i,"_clipNormal.xy) / ").concat(n," * (").concat(t," / 2.0) * ").concat(i,"_clipPosition.w * 2.0 * ").concat(a,";\n                    ").concat(i,"_clipPosition.xy += ").concat(i,"_offset;\n                    // TODO(MAX): To handle multiple outline layers, we only want to extrude\n                    // if this offset is the biggest of all the potential offsets\n                    gl_Position = ").concat(i,"_clipPosition;\n                }\n            "))}if(e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(Dk.Nodes.outline),n=[];return n.push(this.outlineColor.build(e,"c")),n.push(this.contourColor.build(e,"c")),n.push(this.outlineWidth.build(e,"f")),n.push(this.contourWidth.build(e,"f")),n.push(this.contourThreshold.build(e,"f")),n.push(this.outlineThreshold.build(e,"f")),n.push(this.contourFrequency.build(e,"f")),n.push(this.outlineSmoothing.build(e,"f")),n.push(this.contourDirection.build(e,"v3")),n.push(this.positionalLines.build(e,"b")),n.push(this.resolution.build(e,"v2")),n.push(this.normalMap.getTexture(e,"t")),n.push(this.depthMap.getTexture(e,"t")),n.push(this.pixelRatio.build(e,"f")),n.push(this.compensation.build(e,"b")),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("OutlineNode is not compatible with "+e.shader+" shader."),""}},Rk=Dk;Rk.Nodes=function(){let e=new _I("\nfloat sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)\n{\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    vec2 texelSize = (vec2(1.0) / resolution);\n    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;\n\n    vec2 uvSamples[9];\n    vec4 normalSamples[9];\n\n\tuvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);\n\tuvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);\n\tuvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);\n\tuvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);\n\tuvSamples[4] = uv;\n\tuvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);\n\tuvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);\n\tuvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);\n\tuvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);\n\n\n    normalSamples[0] = texture2D(t, uvSamples[0]);\n    normalSamples[1] = texture2D(t, uvSamples[1]);\n    normalSamples[2] = texture2D(t, uvSamples[2]);\n    normalSamples[3] = texture2D(t, uvSamples[3]);\n    normalSamples[4] = texture2D(t, uvSamples[4]);\n    normalSamples[5] = texture2D(t, uvSamples[5]);\n    normalSamples[6] = texture2D(t, uvSamples[6]);\n    normalSamples[7] = texture2D(t, uvSamples[7]);\n    normalSamples[8] = texture2D(t, uvSamples[8]);\n\n    float depthBias = 0.0001;\n    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!\n    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n\n    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {\n        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;\n        if (gl_FragCoord.z > depthAtSample) {\n           return 0.0;\n        }\n    }\n\n    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);\n  \tvec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);\n\n    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));\n    return edgeNormal;\n}\n");return{outline:new _I("vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {\n                vec3 result = outlineColor;\n                float resultAlpha = 0.0;\n\n                vec3 N = normalize(vWNormal);\n                vec2 nuv = (gl_FragCoord.xy / resolution);\n                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);\n                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);\n\n                //resultAlpha = 1.0;\n                //result = vec3(sobelSample);\n\n                float t = 1.0 - contourThreshold;\n                if(positionalLines) {\n                    vec3 NDir = position * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float f  = fract(NT * contourFrequency * 0.01);\n                    float df = fwidth(NT * contourFrequency);\n\n                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);\n                    if (g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0;\n                    }\n                 }\n                 else {\n                    vec3 NDir = N * contourDirection;\n                    float NT = NDir.x + NDir.y + NDir.z;\n                    float df = fwidth(NT * contourThreshold);\n                    float f = sin(NT * 1.0 * contourFrequency);\n                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);\n\n                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {\n                        result = contourColor;\n                        resultAlpha = 1.0 - g;\n                    }\n                 }\n\n                 float lalpha = alpha * resultAlpha * mask;\n                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;\n\t\t\t\t \n                 return result;\n             }",[e])}}();var Ok=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c,h,d,u,p,f,m,g,v){super("v3"),this.nodeType="Pattern",this.style=e,this.projection=t,this.axis=i,this.blending=n,this.offset=r,this.colorA=a,this.colorB=s,this.frequency=o,this.size=l,this.variation=c,this.smoothness=h,this.zigzag=d,this.rotation=u,this.vertical=p,this.horizontal=f,this.sides=m,this.isMask=v,this.alpha=g,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.isShader("fragment")){let i;switch(e.require("position"),e.require("uv"),e.requires.uv=[!0],e.require("normal"),e.requires.normal=!0,e.addFragmentVariable(this.calpha,"float"),this.style.value){case 0:default:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave"}let n="g".concat(this.uuid.toString().replace(/-/g,"")),r=new _I("float hashwithoutsine12(vec2 p)\n\t\t\t\t{\n\t\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * .1031);\n\t\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t\t}"),a=new _I("vec2 rotate_uv(in vec2 uv, float a, bool repeat) \n\t\t\t\t{\n\t\t\t\t\tconst float mid = 0.5;\n\t\t\t\t\tfloat radians = a * (PI / 180.0);\n\t\t\t\t\tvec2 rotated = vec2(\n\t\t\t\t\t\tcos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,\n\t\t\t\t\t\tcos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid\n\t\t\t\t\t);\n\t\t\t\t\treturn repeat ? fract(rotated): rotated;\n\t\t\t\t}"),s="";if(4===this.projection.value){let e=2===this.style.value?"".concat(i,"(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(i,"(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),t=2===this.style.value?"".concat(i,"(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(i,"(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),n=2===this.style.value?"".concat(i,"(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(i,"(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)");s="\n\t\t\t\tvec3 p = position;\n\t\t\t\tfloat factor = 0.0125;\n\t\t\t\tvec2 uv0 = fract(p.xy * factor);\n\t\t\t\tvec2 uv1 = fract(p.zy * factor);\n\t\t\t\tvec2 uv2 = fract(p.xz * factor);\n\t\t\t\t\n\t\t\t\tuv0 = rotate_uv(uv0 + offset, rotation, true);\n\t\t\t\tuv1 = rotate_uv(uv1 + offset, rotation, true);\n\t\t\t\tuv2 = rotate_uv(uv2 + offset, rotation, true);\n\t\n\t\t\t\tfloat d0 = ".concat(e,";\n\t\t\t\tfloat d1 = ").concat(t,";\n\t\t\t\tfloat d2 = ").concat(n,";\n\t\t\t\t\n\t\t\t\t// Range from 3 to 128 seems to be good\n\t\t\t\tfloat exponent = (1.0 - blending) * 125.0 + 3.0;\n\n\t\t\t\tvec3 n = vObjectNormal;\n\t\t\t\tvec3 weights = abs(normalize(n));\n\t\t\t\tweights = pow(weights, vec3(exponent));\n\t\t\t\tweights /= dot(weights, vec3(1.0));\n\t\t\t\td0 *= weights.z;\n\t\t\t\td1 *= weights.x;\n\t\t\t\td2 *= weights.y;\n\t\t\t\tfloat draw = d0 + d1 + d2;\n\t\n\t\t\t\tvec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;\n\t\t\t\t")}else{let e=2===this.style.value?"".concat(i,"(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)"):"".concat(i,"(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)"),t="";0===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.z);\n\t\t\t\t\tfloat phi = acos(p.x / radius);":1===this.axis.value?t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.x, p.z);\n\t\t\t\t\tfloat phi = acos(p.y / radius);":(this.axis.value,t="float radius = length(p);\n\t\t\t\t\tfloat theta = atan(p.y, p.x);\n\t\t\t\t\tfloat phi = acos(p.z / radius);");let n="";switch(this.projection.value){case 0:n="custom_uv = vUv.st;";break;case 1:case 3:default:break;case 2:n="\n\t\t\t\t\t\t\tvec3 p = position;\n\t\t\t\t\t\t\t".concat(t,"\n\t\t\t\t\t\t\tcustom_uv = vec2(theta, phi);\n\t\t\t\t\t\t\tcustom_uv /= PI;\n\t\t\t\t\t\t\t")}s="\n\t\t\t\tvec2 custom_uv;\n\t\t\t\t".concat(n,"\n\t\n\t\t\t\tcustom_uv += offset;\n\t\t\t\tcustom_uv = fract(custom_uv);\n\t\t\t\tcustom_uv = rotate_uv(custom_uv, rotation, true);\n\t\n\t\t\t\tfloat draw = ").concat(e,";\n\t\t\t\t")}let o=new _I("vec3 ".concat(n,"_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\t\tconst float TWO_PI = PI * 2.0;\n\t\t\t\t\tfloat smoothness_remapped = pow(smoothness, 5.0);\t\n\n\t\t\t\t\t").concat(s,"\n\n\t\t\t\t\t// Construct final output color\n\t\t\t\t\tvec4 color = mix(colorA, colorB, draw);\n\t\t\t\t\tcolor.a = clamp(color.a, 0.0, 1.0);\n\n\t\t\t\t\t// Apply cuts\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(vertical.x, custom_uv.y) * \n\t\t\t\t\t\tstep(custom_uv.y, vertical.y);\n\t\t\t\t\tcolor.a *= \n\t\t\t\t\t\tstep(horizontal.x, abs(custom_uv.x)) * \n\t\t\t\t\t\tstep(abs(custom_uv.x), horizontal.y);\n\n\t\t\t\t\t// Accumulate alpha \n\t\t\t\t\tfloat lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;\n\t\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\t\treturn clamp(color, 0.0, 1.0).rgb;\n\t\t\t\t}"),[a,r,Ok.DrawFunctions.circle,Ok.DrawFunctions.ring,Ok.DrawFunctions.polygon,Ok.DrawFunctions.cross,Ok.DrawFunctions.diamond,Ok.DrawFunctions.checkerboard,Ok.DrawFunctions.line,Ok.DrawFunctions.wave]),l=e.include(o),c=[];return c.push("normal"),c.push(this.blending.build(e,"f")),c.push(this.style.build(e,"i")),c.push(this.offset.build(e,"v2")),c.push(this.colorA.build(e,"v4")),c.push(this.colorB.build(e,"v4")),c.push(this.frequency.build(e,"v2")),c.push(this.size.build(e,"f")),c.push(this.variation.build(e,"f")),c.push(this.smoothness.build(e,"f")),c.push(this.zigzag.build(e,"f")),c.push(this.rotation.build(e,"f")),c.push(this.vertical.build(e,"v2")),c.push(this.horizontal.build(e,"v2")),c.push(this.sides.build(e,"i")),c.push(this.isMask.build(e,"b")),c.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),c.push(this.alpha.build(e,"f")),c.push(this.calpha),e.format(l+"("+c.join(",")+")",this.getType(e),t)}return console.warn("PatterNode is not compatible with "+e.shader+" shader."),e.format("vec3(0.0)",this.getType(e),t)}},Ik=Ok;Ik.DrawFunctions=function(){let e=new _I("float hashwithoutsine12(vec2 p) {\n\t\t\t\tvec3 p3 = fract(vec3(p.xyx) * 0.1031);\n\t\t\t\tp3 += dot(p3, p3.yzx + 33.33);\n\t\t\t\treturn fract((p3.x + p3.y) * p3.z);\n\t\t\t}"),t=new _I("vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {\n                // Create tiles in UV-space\n                uv *= frequency;\n\n                // Integer coords\n                vec2 i = floor(uv);\n\n                // Offset every other row based on zigzag param, then compute fractional coords\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = fract(uv);\n\n\t\t\t\t// Rotate the tile itself:\n\t\t\t\t// const float mid = 0.5;\n\t\t\t\t// f = vec2(\n\t\t\t\t// \tcos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,\n\t\t\t\t// \tcos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid\n\t\t\t\t// );\n\t\t\t\t// f = fract(f);\n\n                f = f * 2.0 - 1.0;\n\n\t\t\t\t// Recompute integer coords after shifting - then, random value per tile \n\t\t\t\ti = floor(uv);\n\t\t\t\tfloat rand = (hashwithoutsine12(i) * 5.0 + 1.0);\n\t\t\t\tfloat jitter = mix(1.0, rand, variation);\n\t\t\t\tf *= jitter;\n\n                return f;\n            }",[e]);return{tileAndCenter:t,circle:new _I("float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(\n                    -smoothness, \n                     smoothness, \n                     length(f) - size\n                );\n            }",[t]),ring:new _I("float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\n\t\t\t\tfloat d = length(f);\n                const float inner_width = 0.5;\n\n                float outer = smoothstep(-smoothness, smoothness, d - size);\n                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);\n\t\t\t\treturn outer + (1.0 - inner);   \n            }",[t]),polygon:new _I("float sdf_ngon(in vec2 p, in float r, in int n) {\n                float an = (PI * 2.0) / float(n);\n                float he = r * tan(0.5 * an);\n                \n                // Rotate to first sector\n                p = -p.yx; \n                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);\n                vec2  cs = vec2(cos(bn), sin(bn));\n                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;\n            \n                // Side of polygon\n                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);\n            }\n            \n            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));\n            }",[t]),cross:new _I("float sdf_cross(in vec2 p, in vec2 b, float r ) {\n                p = abs(p); \n\t\t\t\tp = (p.y > p.x) ? p.yx : p.xy;\n                vec2  q = p - b;\n                float k = max(q.y, q.x);\n                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);\n                return sign(k) * length(max(w, 0.0)) + r;\n            }\n            \n            // Avoid namespace conflicts \n            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));\n            }",[t]),diamond:new _I("float ndot(vec2 a, vec2 b) { \n                return a.x*b.x - a.y*b.y; \n            }\n            \n            float sdf_diamond(in vec2 p, in vec2 b) {\n                p = abs(p);\n                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);\n                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));\n                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);\n            }\n\n            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);\n\t            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));\n            }",[t]),checkerboard:new _I("float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                uv *= frequency;\n                vec2 i = floor(uv);\n\n                float offset = mod(i.y, 2.0);\n\n                uv.x += offset + zigzag * offset;\n                float x = floor(uv.x);\n                \n                return mod(x, 2.0);\n            }"),line:new _I("float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);\n\t\t\t\t\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat row = floor(uv * frequency).y;\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(row));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n\t\t\t\treturn smoothstep(\n\t\t\t\t\ts - smoothness, \n\t\t\t\t\ts + smoothness, \n\t\t\t\t\tabs(f.y)\n\t\t\t\t);\n            }",[t]),wave:new _I("// Uses bisection \n            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {\n                // Convert all data to a primitive cosine wave\n                p = c * (p - vec2(d, a));\n                \n                const float TWO_PI = PI * 2.0;\n\n                // Reduce to principal half cycle\n                p.x = mod(p.x, TWO_PI); \n                if (p.x > PI) {\n                    p.x = TWO_PI - p.x;\n                }\n            \n                // Find zero of derivative (minimize distance)\n                float xa = 0.0;\n                float xb = TWO_PI;\n\n                // 24 bit precision\n                for (int i = 0; i < 24; i++) {\n                    float x = 0.5 * (xa + xb);\n                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));\n                    if (y < 0.0) xa = x; \n                    else xb = x;\n                }\n                float x = 0.5 * (xa + xb);\n                \n                // Compute distance    \n                vec2 q = vec2(x, b * c * cos(x));\n                return length(p - q) / c;\n            }\n\n            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {\n                float repeat = frequency.x;\n                uv *= repeat;\n                vec2 i = floor(uv);\n                float row_offset = mod(i.y, 2.0);\n                uv.x += row_offset * zigzag;\n                vec2 f = vec2(uv.x, fract(uv.y));\n\n                // Generalized cosine: y(x) = a + b * cos(cx + d)\n                const float amplitude = 0.125;\n                float wave_frequency = frequency.y * 0.1;\n                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);\n\n\t\t\t\t// Different approach for variation param here\n\t\t\t\tfloat rand = hashwithoutsine12(vec2(i.y));\n\t\t\t\tfloat s = mix(size, size * rand, variation);\n\n                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);\n            }")}}();var kk=class extends fI{constructor(e,t,i,n,r,a,s,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=e,this.movement=t,this.wavelengths=i,this.noiseStrength=n,this.noiseScale=r,this.offset=a,this.isMask=o,this.alpha=s,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.require("vWorldViewDir"),e.require("worldNormal"),e.isShader("fragment")){e.require("uv"),e.requires.uv=[!0],e.addFragmentVariable(this.calpha,"float");let i=e.include(kk.Nodes.rainbow),n=[];return n.push(this.filmThickness.build(e,"f")),n.push(this.movement.build(e,"f")),n.push(this.wavelengths.build(e,"v3")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.offset.build(e,"v3")),n.push(this.isMask.build(e,"b")),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("RainbowNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Lk=kk;Lk.Nodes=function(){let e=new _I("vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {\n                 vec3 st = position / noiseScale;\n\t\t\t\t vec3 q = vec3(simplex3d(st),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(1.0)));\n\n\t\t\t\t vec3 r = vec3(simplex3d(st + vec3(1.4, 1.3, 1.0) * q + vec3(1.7, 9.2, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st + vec3(2.0, 1.2, 1.0) * q + vec3(8.3, 2.8, 1.0)),\n\t\t\t\t\t\t\t  simplex3d(st * q));\n\n                 float noise = simplex3d(st + r);\n\n                 return .5 + .5 * cos((((filmThickness + (noise * noiseStrength)) / (vec3(wavelengths.r * 1.0, wavelengths.g * 0.8, wavelengths.b * 0.6) + 1.0)) * dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal))) + movement);\n             }",[Pk.simplex]);return{rainbow:new _I("vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {\n\t\t\t\tvec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);\n\n\t\t\t\tfloat rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);\n\n\t\t\t\tfloat lalpha = alpha * rainbowContribution * mask;\n\t\t\t\tcalpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));\n\n\t\t\t\treturn res;\n             }",[e])}}();var Fk=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=e,this.colors=t,this.steps=i,this.source=n,this.isWorldSpace=r,this.noiseStrength=a,this.noiseScale=s,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.require("worldNormal"),e.require("worldPosition"),e.isShader("fragment")){e.define("COLORS_MAX",10),e.addFragmentVariable(this.calpha,"float");let i=e.include(Fk.Nodes.toon),n=[];return n.push(this.positioning.build(e,"i")),n.push(this.colors.build(e,"v4[]")),n.push(this.steps.build(e,"f[]")),n.push(this.source.build(e,"v3")),n.push(this.isWorldSpace.build(e,"b")),n.push(this.noiseStrength.build(e,"f")),n.push(this.noiseScale.build(e,"f")),n.push(this.shadowColor.build(e,"v4")),n.push(this.offset.build(e,"v3")),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("ToonNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Bk=Fk;Bk.Nodes=function(){let e=new _I("float rand(float n) {\n\t\t\t\treturn fract(sin(n) * 43758.5453123);\n\t\t\t}"),t=new _I("float hash1(float p) { \n\t\t\t\tp = fract(p * 0.011); \n\t\t\t\tp *= p + 7.5; \n\t\t\t\tp *= p + p; \n\t\t\t\treturn fract(p); \n\t\t\t}"),i=new _I("float valueNoise(vec3 x) {\n\t\t\t\tconst vec3 step = vec3(110, 241, 171);\n\t\t\t\n\t\t\t\tvec3 i = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\t\t\t \n\t\t\t\t// For performance, compute the base input to a 1D hash from the integer part of the argument and the \n\t\t\t\t// incremental change to the 1D based on the 3D -> 1D wrapping\n\t\t\t\tfloat n = dot(i, step);\n\t\t\t\n\t\t\t\tvec3 u = f * f * (3.0 - 2.0 * f);\n\t\t\t\treturn mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),\n\t\t\t\t\t\t   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),\n\t\t\t\t\t\t\t   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);\n\t\t\t}",[t]),n=new _I("vec3 hash3(vec3 x) {\n\t\t\t\tx = vec3(dot(x,vec3(127.1, 311.7, 74.7)),\n\t\t\t\t\t\t dot(x,vec3(269.5, 183.3, 246.1)),\n\t\t\t\t\t\t dot(x,vec3(113.5, 271.9, 124.6)));\n\t\t\t\n\t\t\t\treturn fract(sin(x)*43758.5453123);\n\t\t\t}"),r=new _I('vec3 voronoiNoise(in vec3 x)\n\t\t\t{\n\t\t\t\tvec3 p = floor(x);\n\t\t\t\tvec3 f = fract(x);\n\n\t\t\t\tfloat id = 0.0;\n\t\t\t\tvec2 res = vec2(100.0);\n\n\t\t\t\tfor(int k=-1; k<=1; k++)\n\t\t\t\tfor(int j=-1; j<=1; j++)\n\t\t\t\tfor(int i=-1; i<=1; i++)\n\t\t\t\t{\n\t\t\t\t\tvec3 b = vec3(float(i), float(j), float(k));\n\n\t\t\t\t\t// Comment out the "+ hash(p + b);" part below to get "square" cells\n\t\t\t\t\tvec3 r = vec3(b) - f + hash3(p + b);\n\t\t\t\t\tfloat d = dot(r, r);\n\n\t\t\t\t\tif (d < res.x)\n\t\t\t\t\t{\n\t\t\t\t\t\tid = dot(p + b, vec3(1.0, 57.0, 113.0));\n\t\t\t\t\t\tres = vec2(d, res.x);\t\t\t\n\t\t\t\t\t}\n\t\t\t\t\telse if (d < res.y)\n\t\t\t\t\t{\n\t\t\t\t\t\tres.y = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn vec3(sqrt(res), abs(id));\n\t\t\t}\n\t\t\t',[n]);return{toon:new _I('vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {\n\t\t\t\tfloat t = 0.0;\n\t\t\t\tfloat shadow = 1.0;\n\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\t// Can\'t do this mode if lighting is "none"\n\t\t\t\t\t#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))\n\n\t\t\t\t\t\t// Algorithm from Chapter 10 of Graphics Shaders\n\t\t\t\t\t\tconst vec3 weights = vec3(0.2125, 0.7154, 0.0721);\n\t\t\t\t\t\tvec3 lpos;\n\t\t\t\t\t\tvec3 l;\n\t\t\t\t\t\tfloat dproduct;\n\n\t\t\t\t\t\t#if (NUM_POINT_LIGHTS > 0)\n\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tPointLightShadow pointLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_POINT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Light positions are in view-space for some reason?\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// TODO: we want to use "intensity" but it isn\'t available in the shader code\n\t\t\t\t\t\t\t\t//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);\n\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tpointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getPointShadow( \n\t\t\t\t\t\t\t\t\t\t\tpointShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowRadius,\n\t\t\t\t\t\t\t\t\t\t\tvPointShadowCoord[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraNear, \n\t\t\t\t\t\t\t\t\t\t\tpointLightShadow.shadowCameraFar);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_DIR_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tDirectionalLightShadow directionalLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_DIR_LIGHTS; i++) {\n\t\t\t\t\t\t\t\t// Use the direction vector for directional lights instead\n\t\t\t\t\t\t\t\tl = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;\n\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tdirectionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow( \n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tdirectionalShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tdirectionalLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0 \n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)\n\t\t\t\t\t\t\t\tSpotLightShadow spotLightShadow;\n\t\t\t\t\t\t\t#endif \n\n\t\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\t\tfor (int i = 0; i < NUM_SPOT_LIGHTS; i++) {\n\t\t\t\t\t\t\t\tlpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;\n\t\t\t\t\t\t\t\tl = normalize(lpos - worldPosition);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tdproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;\n\t\t\t\t\t\t\t\tt = max(t, dproduct);\n\n\t\t\t\t\t\t\t\t// Accumulate shadow contribution\n\t\t\t\t\t\t\t\t#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)\n\t\t\t\t\t\t\t\t\tspotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];\n\t\t\t\t\t\t\t\t\tshadow *= getShadow(\n\t\t\t\t\t\t\t\t\t\tUNROLLED_LOOP_INDEX,\n\t\t\t\t\t\t\t\t\t\tspotShadowMap[UNROLLED_LOOP_INDEX], \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowMapSize, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowBias, \n\t\t\t\t\t\t\t\t\t\tspotLightShadow.shadowRadius, \n\t\t\t\t\t\t\t\t\t\tvSpotLightCoord[UNROLLED_LOOP_INDEX]);\n\t\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t#pragma unroll_loop_end\n\n\t\t\t\t\t\t#endif\n\n\t\t\t\t\t\tt = clamp(t, 0.0, 1.0);\n\t\t\t\t\n\t\t\t\t\t#endif\n\n\t\t\t\t} else if (positioning == 1) {\n\t\t\t\t\t\n\t\t\t\t\tvec3 origin = mix(position, worldPosition, float(isWorldSpace));\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\n\t\t\t\t} else {\n\n\t\t\t\t\tvec3 origin = worldPosition;\n\t\t\t\t\tvec3 source = cameraPosition - offset;\n\t\t\t\t\tvec3 direction = normalize(source - origin);\n\t\t\t\t\tt = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;\t\n\t\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\tif (noiseStrength > 0.0) {\n\t\t\t\t\t// Distort with noise\n\t\t\t\t\tvec3 st = position / noiseScale;\n\t\t\t\t\t\n\t\t\t\t\t// Voronoi "smooth" noise\n\t\t\t\t\tfloat noise = 1.0 - voronoiNoise(st).x;\n\n\t\t\t\t\t// Voronoi cellular noise\n\t\t\t\t\t//float noise = 1.0 - rand(voronoiNoise(st).z);\n\n\t\t\t\t\t// Position warp noise\n\t\t\t\t\t// vec3 offset = vec3(\n\t\t\t\t\t// \tsimplex3d(st),\n\t\t\t\t\t// \tsimplex3d(st + vec3(111.1, 143.89, 217.19)),\n\t\t\t\t\t// \tsimplex3d(st + vec3(171.1, 247.89, 117.23))\n\t\t\t\t\t// );\n\t\t\t\t\t// st += offset;\n\t\t\t\t\t// float noise = valueNoise(st);\n\n\t\t\t\t\tt += noise * noiseStrength;\n\t\t\t\t}\n\n\t\t\t\tt = clamp(t, 0.0, 1.0);\n\n\t\t\t\t// Compute ramp color\n\t\t\t\tfloat p;\n\t\t\t\tvec4 color = colors[0];\n\t\t\t\tfor (int i = 1; i < COLORS_MAX; i++) {\n\t\t\t\t\tp = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);\n\t\t\t\t\tcolor = mix(color, colors[i], smoothstep(0.0, 1.0, p));\n\t\t\t\t}\n\n\t\t\t\t// Incorporate custom shadow color\n\t\t\t\tif (positioning == 0) {\n\n\t\t\t\t\tvec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);\n\t\t\t\t\tcolor.rgb = mix(blendedShadow, color.rgb, shadow);\n\t\t\t\t\n\t\t\t\t}\n\n\t\t\t\t// Accumulate alpha as usual\n\t\t\t\tfloat lalpha = alpha * color.a * mask;\n\t\t\t\tcalpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);\n\t\t\t\taccumAlpha += (1.0 - accumAlpha) * lalpha;\n\n\t\t\t\treturn color.xyz;\n\n            }',[Pk.simplex,e,i,r])}}();var Nk={textureBicubic:new _I("float w0( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n        }\n    \n        float w1( float a ) {\n            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n        }\n    \n        float w2( float a ){\n            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n        }\n    \n        float w3( float a ) {\n            return ( 1.0 / 6.0 ) * ( a * a * a );\n        }\n    \n        // g0 and g1 are the two amplitude functions\n        float g0( float a ) {\n            return w0( a ) + w1( a );\n        }\n    \n        float g1( float a ) {\n            return w2( a ) + w3( a );\n        }\n    \n        // h0 and h1 are the two offset functions\n        float h0( float a ) {\n            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n        }\n    \n        float h1( float a ) {\n            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n        }\n    \n        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n            uv = uv * texelSize.zw + 0.5;\n    \n            vec2 iuv = floor( uv );\n            vec2 fuv = fract( uv );\n    \n            float g0x = g0( fuv.x );\n            float g1x = g1( fuv.x );\n            float h0x = h0( fuv.x );\n            float h1x = h1( fuv.x );\n            float h0y = h0( fuv.y );\n            float h1y = h1( fuv.y );\n    \n            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n    \n            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + \n                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n        }\n\n        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n            vec2 fLodSizeInv = 1.0 / fLodSize;\n            vec2 cLodSizeInv = 1.0 / cLodSize;\n            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n            return mix( fSample, cSample, fract( lod ) );\n        }")};var zk=class extends fI{constructor(e,t,i,n,r,a,s,o){super("v3"),this.nodeType="Transmission",this.thickness=e,this.ior=t,this.roughness=i,this.transmissionSamplerSize=n,this.transmissionSamplerMap=r,this.transmissionDepthMap=a,this.aspectRatio=s,this.alpha=o,this.calpha="g".concat(this.uuid.toString().replace(/-/g,""),"_calpha")}generate(e,t){if(e.extensions.shaderTextureLOD=!0,e.extensions.derivatives=!0,e.isShader("fragment")){e.define("NUM_SAMPLES",6),e.define("BLUR_SLOD",Math.pow(2,Hk.transmissionLod.value)),e.require("worldPosition"),e.requires.worldNormal=!0,e.requires.modelMatrix=!0,e.requires.projectionMatrix=!0,e.addFragmentVariable(this.calpha,"float");let i=e.include(zk.Nodes.transmission),n=[];return n.push(this.thickness.build(e,"f")),n.push(this.ior.build(e,"f")),n.push(this.roughness.build(e,"f")),n.push(this.transmissionSamplerSize.build(e,"v2")),n.push(this.transmissionSamplerMap.getTexture(e,"t")),n.push(this.transmissionDepthMap.getTexture(e,"t")),n.push(this.aspectRatio.build(e,"v2")),n.push("normal"),n.push(this.mask?"luminance(".concat(this.mask.flow(e,"v3").result,")"):"1.0"),n.push(this.alpha.build(e,"f")),n.push(this.calpha),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("TransmissionNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Uk=zk;Uk.Nodes=function(){let e=new _I("vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {\n                // Slightly modified version of this:\n                // https://www.shadertoy.com/view/ltScRG\n\n\t\t\t\t// Special case for blur == 0.0\n\t\t\t\tif (lod == 0.0) {\n\t\t\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\t\treturn texture2DLodEXT( sp, U, 0.0).rgb;\n\t\t\t\t\t#else\n\t\t\t\t\treturn textureLod( sp, U, 0.0).rgb;\n\t\t\t\t\t#endif\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvec2 texelSize = vec2(1.0) / resolution;\n                vec2 halton = haltonSequence[frameIndex];\n                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n                float temporalAngle  = temporalOffset * PI2;\n\t\t\t\tvec3 res = vec3(0.0);\n                vec2 uv = vec2(0.0);\n                vec2 offset = vec2(0.0);\n                vec2 vogelSample = vec2(0.0);\n                for (int i = 0; i < NUM_SAMPLES; i++) {\n                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;\n                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20\n                    uv = U + offset;\n                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));\n                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {\n                        uv = unrefractedU;\n                        lod = lod > 4.0 ? lod : lod / 2.0;\n                    }\n                    res += textureLod(sp, uv, lod).rgb;\n                }\n                return res / float(NUM_SAMPLES);\n            }"),t=new _I("vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\t        // Direction of refracted light.\n\t\t        vec3 refractionVector = refract( -v,  n, 1.0 / ior );\n\t\t        \n\t\t\t\t// Compute rotation-independant scaling of the model matrix.\n\t\t        vec3 modelScale;\n\t\t        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\t        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\t        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\n\t\t        // The thickness is specified in local space\n\t\t        return normalize( refractionVector ) * thickness * modelScale;\n\t        }"),i=new _I("float applyIorToRoughness( float roughness, float ior ) {\n\t\t\t\t// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and\n\t\t\t\t// an IOR of 1.5 results in the default amount of microfacet refraction.\n\t\t\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t\t\t}"),n=new _I('vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {\n\t\t\t\t// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see\n\t\t\t\t// also the code in convertTransmission.ts, which runs during export\n\t\t\t\t#ifdef IS_THREEJS_EXPORT\n\t\t\t\t\tfloat lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);\n\t\t\t\t\treturn textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;\n\t\t\t\t#else\n\t\t\t\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t\t\t\tfloat lod = applyIorToRoughness(roughness, ior);\n\t\t\t\t\treturn blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);\n\t\t\t\t#endif\n\t\t\t}',[Nk.textureBicubic,i,e]),r=new _I("vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\n\t\t\t\t// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\n\t\t\t\tvec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );\n\t\t\t\tvec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;\n\t\t\t\tunrefractedCoords += 1.0;\n\t\t\t\tunrefractedCoords /= 2.0;\n\n\t\t\t\t// Sample framebuffer to get pixel the refracted ray hits.\n\t\t\t\treturn getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );\n    \t\t}",[n,t]);return{transmission:new _I("vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {\n                vec3 v = vec3(0.);\n                if (isOrthographic) {\n                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n                } else {\n                    v = normalize(vWPosition - cameraPosition);\n                }\n                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );\n                \n\t\t\t\tfloat lalpha = alpha * mask;\n\t\t\t\tcalpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );\n\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * alpha;\n\n\t\t\t\treturn transmission;\n            }",[r])}}();var jk=(e=>(e.NOISE="noise",e.MAP="map",e))(jk||{}),Vk=class extends fI{constructor(e,t,i,n,r,a,s,o,l,c,h){super("v3"),this.displacementTypeIndex=new ik(0),this.nodeType="VertexDisplacement",this.intensity=e,this.movementOrTexture=t,"map"===Object.values(jk)[this.displacementTypeIndex.value]&&(this.mat=new lk(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=h,this.voronoiStyle=n,this.smoothness=r,this.seed=a,this.highCut=s,this.lowCut=o,this.quality=l}generate(e,t){if(e.isShader("vertex")){e.define("USE_LAYER_DISPLACE");let i,n=[];switch(n.push("displaced_position"),n.push("displaced_normal"),Object.values(jk)[this.displacementTypeIndex.value]){case"map":i=e.include(Vk.Nodes.map),n.push(this.movementOrTexture.getTexture(e,"t")),n.push("uv"),n.push(this.cropOrOffset.build(e,"f")),this.mat&&n.push(this.mat.build(e,"mat3"));break;case"noise":{let t=Object.values(Mk)[this.noiseFunctionIndex.value],r=new _I("vec3 orthogonal(vec3 v) {\n\t\t\t\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t\t\t\t}"),a="voronoi"==t?"\n\t\t\t\t\tfloat v = ".concat(t,"((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);\n\t\t\t\t\tv = remap(v, lowCut, highCut, 0.0, 1.0);\n\t\t\t\t\tv = smax(v, 0.0, smoothness * 0.25);\n\t\t\t\t\tv = smin(v, 1.0, smoothness * 0.25);\n\n\t\t\t\t\treturn p + n * v * intensity;\n\t\t\t\t\t"):"\n\t\t\t\t\treturn p + n * ".concat(t,"((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;\n\t\t\t\t\t"),s=new _I("vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {\n\t\t\t\t\t\t\t".concat(a,"\n\t\t\t\t\t\t}"),[Pk.simplex,Pk.simplexFractal,Pk.simplexAshima,Pk.fbm,Pk.perlin,Pk.voronoi]),o=new _I("vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {\n\t\t\t\t\t\t\tvec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 tangent1 = orthogonal(normal);\n\t\t\t\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\n                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.\n                            // This caused some small oval/circular visual artifacts in the lighting.\n                            // For now, simply using neighbors further away betters the problem,\n                            // but we should figure out the underlying cause when we have some time.\n                            // Maybe its related to how we calculate the tangent and bitangent?\n\t\t\t\t\t\t\tvec3 nearby1 = position + tangent1;\n\t\t\t\t\t\t\tvec3 nearby2 = position + tangent2;\n\t\t\t\t\t\t\tvec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tvec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);\n\t\t\t\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\t\t\t\treturn displaced_position;\n\t\t\t\t\t\t}",[s,r]);i=e.include(o),n.push(this.scale.build(e,"f")),n.push(this.cropOrOffset.build(e,"v3")),n.push(this.movementOrTexture.build(e,"f")),n.push(this.voronoiStyle.build(e,"i")),n.push(this.smoothness.build(e,"f")),n.push(this.seed.build(e,"f")),n.push(this.highCut.build(e,"f")),n.push(this.lowCut.build(e,"f")),n.push(this.quality.build(e,"i"));break}}return n.push(this.intensity.build(e,"f")),n.push("displaced_normal"),e.format(i+"("+n.join(",")+")",this.getType(e),t)}return console.warn("VertexDisplacementNode is not compatible with "+e.shader+" shader."),e.format("vec3( 0.0 )",this.getType(e),t)}},Gk=Vk;Gk.Nodes=function(){let e=new _I("vec3 orthogonal(vec3 v) {\n\t\t\t\treturn normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));\n\t\t\t}"),t=new _I("float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {\n\t\t\t\tvec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;\n\t\t\t\tvec4 tmp = texture2D(tex, uvs);\n\t\t\t\tvec3 col = tmp.rgb;\n\t\t\t\tif (crop > 0.5) {\n\t\t\t\t\tif ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {\n\t\t\t\t\t\treturn 0.0;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn col.r;\n\t\t\t}");return{map:new _I("vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {\n\t\t\t\tvec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;\n\t\t\t\tvec3 tangent1 = normalize(orthogonal(normal));\n\t\t\t\tvec3 tangent2 = normalize(cross(normal, tangent1));\n\t\t\t\tvec3 nearby1 = position + tangent1 * 0.1;\n\t\t\t\tvec3 nearby2 = position + tangent2 * 0.1;\n\t\t\t\tvec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tvec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;\n\t\t\t\tdisplaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));\n\t\t\t\treturn displaced_position;\n\t\t\t}",[e,t])}}();var Hk={normalRenderTarget:new II,normalRenderTargetDepth:new II,transmissionRenderTarget:new II,aspectRatio:new gI,transmissionSize:new gI(2048,2048),transmissionRenderTargetDepth:new II,aoRenderTarget:new II,aoEnabled:new nk,pixelRatioNode:new kI(1),resolution:new gI,penumbraSize:new rk(5,.5),frameIndex:new ik(0),transmissionLod:new ik(2)};for(let NY of Object.values(Hk))NY.isRenderGlobal=!0;var Wk,qk={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.2.5/build/ui.wasm"},Xk=class extends dI{constructor(){super("basic"),this.nodeType="Basic",this.color=new tk(BE),this.shadingAlpha=new kI(1),this.shadingBlend=new ik(0),this.previousModelViewMatrix=new ck,this.previouseProjectionMatrix=new ck}get category(){return"phong"}generate(e){let t;if(e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({resolution:Hk.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(dh.merge([Dh.fog])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <normal_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = normal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","\tvNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{void 0===this.color&&(this.color=new tk(BE)),this.color.analyze(e,{slot:"color"}),this.alpha&&this.alpha.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"});let i=this.color.flow(e,"c",{slot:"color"}),n=this.alpha?this.alpha.flow(e,"f"):void 0,r=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,a=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0;e.requires.transparent=void 0!==n,e.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join("\n"));let s=["#include <normal_fragment_begin>",i.code];n&&s.push(n.code,"#ifdef ALPHATEST"," if ( "+n.result+" <= ALPHATEST ) discard;","#endif"),a?s.push(a.code,"vec3 outgoingLight = ".concat(i.result,";"),"vec3 finalColor = spe_blend(outgoingLight, ".concat(a.result,", 1.0, SPE_BLENDING_NORMAL);")):s.push("vec3 finalColor = ".concat(i.result,";"));let o="1.0";this.mask&&(this.mask.analyze(e),o="luminance(".concat(this.mask.flow(e,"v3").result,")")),n?s.push("gl_FragColor = vec4( finalColor, accumAlpha * ".concat(n.result," * ").concat(o," );")):s.push("gl_FragColor = vec4("+i.result+", 1.0 );"),r&&s.push("gl_FragColor.a *= ".concat(r.result,";")),s.push("#include <fog_fragment>","#include <dithering_fragment>"),t=s.join("\n")}return t}},Yk=class extends dI{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new tk(BE),this.emissive=new tk(0),this.emissiveIntensity=new kI(1),this.previousModelViewMatrix=new ck,this.previouseProjectionMatrix=new ck,this.shadingAlpha=new kI(1),this.shadingBlend=new ik(0),this.occlusion=new nk(!0)}get category(){return"lambert"}build(e){let t;if(e.define("LAMBERT"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({resolution:Hk.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(dh.merge([Dh.fog,Dh.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\n\t\t\t\t\tvec3 diffuse = vec3( 1.0 );\n\t\t\t\t\tGeometricContext geometry;\n\t\t\t\t\tgeometry.position = mvPosition.xyz;\n\t\t\t\t\tgeometry.normal = normalize( transformedNormal );\n\t\t\t\t\tgeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\t\t\t\t"),n.push("\n\t\t\t\t\tGeometricContext backGeometry;\n\t\t\t\t\tbackGeometry.position = geometry.position;\n\t\t\t\t\tbackGeometry.normal = -geometry.normal;\n\t\t\t\t\tbackGeometry.viewDir = geometry.viewDir;\n\t\t\t\t\tvLightFront = vec3( 0.0 );\n\t\t\t\t\tvIndirectFront = vec3( 0.0 );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvLightBack = vec3( 0.0 );\n\t\t\t\t\t\tvIndirectBack = vec3( 0.0 );\n\t\t\t\t\t#endif\n\t\t\t\t\tIncidentLight directLight;\n\t\t\t\t\tfloat dotNL;\n\t\t\t\t\tvec3 directLightColor_Diffuse;\n\t\t\t\t\tvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\tvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\t\t\t\t\t\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_POINT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_SPOT_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_DIR_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\t\t\t\t\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\t\t\t\t\t\tdirectLightColor_Diffuse = directLight.color;\n\t\t\t\t\t\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t\t#if NUM_HEMI_LIGHTS > 0\n\t\t\t\t\t\t#pragma unroll_loop_start\n\t\t\t\t\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\t\t\t\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t\t\t\t\t\t#ifdef DOUBLE_SIDED\n\t\t\t\t\t\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t\t\t\t\t\t#endif\n\t\t\t\t\t\t}\n\t\t\t\t\t\t#pragma unroll_loop_end\n\t\t\t\t\t#endif\n\t\t\t\t","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Hk.penumbraSize}),e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({aoMap:Hk.aoRenderTarget}),e.mergeUniform({aoEnabled:Hk.aoEnabled}),void 0===this.color&&(this.color=new tk(BE)),this.color.analyze(e,{slot:"color"}),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.emissive.flow(e,"c",{slot:"emissive"}),r=this.emissiveIntensity.flow(e,"f",{slot:"emissive"}),a=this.occlusion.flow(e,"b",{slot:"occlusion"}),s=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","\tvarying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let d=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx, viewdy));\n\t\t\t\tbool isFrontFacing = (dot(normal, faceNormal) >= 0.0);\n\t\t\t\t","#include <clipping_planes_fragment>"];d.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&d.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),d.push("#ifdef DOUBLE_SIDED","\treflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","\treflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","\treflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","\treflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),n&&d.push(n.code,"reflectedLight.directDiffuse += "+n.result+" * "+r.result+";"),d.push("vec3 ao = aoEnabled && "+a.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let u="1.0";this.mask&&(this.mask.analyze(e),u="luminance(".concat(this.mask.flow(e,"v3").result,")")),d.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * ").concat(u," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result," * ").concat(u,", ").concat(o.result," );\n\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")),l&&d.push(l.code,"outgoingLight = spe_blend(outgoingLight, ".concat(l.result,", 1.0, SPE_BLENDING_NORMAL);")),c?d.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result," );")):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&d.push("gl_FragColor.a *= ".concat(h.result,";")),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=d.join("\n")}return t}},Qk={dHdxy:new _I("vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {\n\n            // Gradient of UVs w.r.t. X coordinate (in screen-space)\n            vec2 dSTdx = dFdx(bumpMapUv);\n\n            // Gradient of UVs w.r.t. Y coordinate (in screen-space)\n            vec2 dSTdy = dFdy(bumpMapUv);\n            \n            // Forward differencing\n            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);\n            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;\n            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;\n            \n            return vec2( dBx, dBy );\n        }"),perturbNormalArb:new _I("vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n            vec3 vSigmaX = dFdx( surf_pos.xyz );\n            vec3 vSigmaY = dFdy( surf_pos.xyz );\n            vec3 vN = surf_norm; // normalized\n            \n            vN = normalize(vN);\n\n            vec3 R1 = cross( vSigmaY, vN );\n            vec3 R2 = cross( vN, vSigmaX );\n\n            R1 = normalize(R1);\n            R2 = normalize(R2);\n    \n            float fDet = dot( vSigmaX, R1 ) * faceDirection;\n    \n            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n            return normalize( abs( fDet ) * vN - vGrad );\n        }")},Kk=class extends dI{constructor(){super("phong"),this.nodeType="Phong",this.color=new tk(BE),this.specular=new tk(1118481),this.shininess=new kI(30),this.previousModelViewMatrix=new ck,this.previouseProjectionMatrix=new ck,this.shadingAlpha=new kI(1),this.shadingBlend=new ik(0),this.occlusion=new nk(!0)}get category(){return"phong"}build(e){let t;if(e.define("PHONG"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({resolution:Hk.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(dh.merge([Dh.fog,Dh.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Hk.penumbraSize}),e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({aoMap:Hk.aoRenderTarget}),e.mergeUniform({aoEnabled:Hk.aoEnabled}),void 0===this.color&&(this.color=new tk(BE)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e);let i=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let n=this.color.flow(e,"c",{slot:"color"}),r=this.specular.flow(e,"c"),a=this.shininess.flow(e,"f"),s=this.shadingAlpha.flow(e,"f"),o=this.shadingBlend.flow(e,"i"),l=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(e,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==c,e.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join("\n"));let d=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tBlinnPhongMaterial material;"];if(this.bumpMap){e.include(Qk.dHdxy),e.include(Qk.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),i=this.bumpMap.flow(e,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?"\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(t.result,", uv0, ").concat(n,");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(t.result,", uv1, ").concat(n,");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(t.result,", uv2, ").concat(n,");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(t.result,", bumpMapCachedUv, ").concat(n,");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"),d.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(i.result,";\n\t\t\t\t\t").concat(r,"\n\t\t\t\t\t"))}d.push(n.code,"\tvec3 diffuseColor = "+n.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","\tvec3 totalEmissiveRadiance = emissive;",r.code,"\tvec3 specular = "+r.result+";",a.code,"\tfloat shininess = max( 0.0001, "+a.result+" );","\tfloat specularStrength = 1.0;"),c&&d.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),d.push("material.diffuseColor = diffuseColor;"),d.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),d.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let u="1.0";this.mask&&(this.mask.analyze(e),u="luminance(".concat(this.mask.flow(e,"v3").result,")")),d.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(s.result," * ").concat(u," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(s.result," * ").concat(u,", ").concat(o.result," );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")),l&&d.push(l.code,"outgoingLight = spe_blend(outgoingLight, ".concat(l.result,", 1.0, SPE_BLENDING_NORMAL);")),c?d.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(c.result,");")):d.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&d.push("gl_FragColor.a *= ".concat(h.result,";")),d.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=d.join("\n")}return t}},Zk=class extends dI{constructor(){super("standard"),this.nodeType="Standard",this.color=new tk(BE),this.roughness=new kI(.3),this.metalness=new kI(0),this.reflectivity=new kI(.5),this.previousModelViewMatrix=new ck,this.previouseProjectionMatrix=new ck,this.shadingAlpha=new kI(1),this.shadingBlend=new ik(0),this.occlusion=new nk(!0)}get category(){return"physical"}build(e){let t;if(e.define("STANDARD"),e.requires.lights=!0,e.extensions.derivatives=!0,e.extensions.shaderTextureLOD=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({resolution:Hk.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(dh.merge([Dh.fog,Dh.lights])),Dh.LTC_1&&(e.uniforms.ltc_1={value:void 0},e.uniforms.ltc_2={value:void 0}),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#if defined( USE_LAYER_DISPLACE )\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#if !defined( USE_LAYER_DISPLACE )\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif /* !USE_LAYER_DISPLACE */\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Hk.penumbraSize}),e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({aoMap:Hk.aoRenderTarget}),e.mergeUniform({aoEnabled:Hk.aoEnabled});let i={gamma:!0};void 0===this.color&&(this.color=new tk(BE)),this.color.analyze(e,{slot:"color",context:i}),this.roughness.analyze(e),this.metalness.analyze(e);let n=this.occlusion.flow(e,"b",{slot:"occlusion"});this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e),this.reflectivity&&this.reflectivity.analyze(e);let r=this.color.flow(e,"c",{slot:"color",context:i}),a=this.roughness.flow(e,"f"),s=this.metalness.flow(e,"f"),o=this.shadingAlpha.flow(e,"f"),l=this.shadingBlend.flow(e,"i"),c=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,h=this.alpha?this.alpha.flow(e,"f"):void 0,d=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0,u=this.reflectivity?this.reflectivity.flow(e,"f"):void 0;e.requires.transparent=void 0!==h,e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join("\n"));let p=["#include <clipping_planes_fragment>","\t#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tPhysicalMaterial material;","\tmaterial.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){e.include(Qk.dHdxy),e.include(Qk.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),i=this.bumpMap.flow(e,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?"\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(t.result,", uv0, ").concat(n,");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(t.result,", uv1, ").concat(n,");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(t.result,", uv2, ").concat(n,");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(t.result,", bumpMapCachedUv, ").concat(n,");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"),p.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(i.result,";\n\t\t\t\t\t").concat(r,"\n\t\t\t\t\t"))}if(p.push(r.code,"\tvec3 diffuseColor = "+r.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",s.code,"\tfloat metalnessFactor = "+s.result+";"),this.roughnessMap){let t=this.roughnessMap.texture.flow(e,"t"),i=this.roughnessMap.flow(e,"v3"),n="";n=4===this.roughnessMap.projection.value?"\n\t\t\t\t\tfloat roughnessChange = 1.0;\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tfloat r0 = luminance(texture(").concat(t.result,", uv0).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r1 = luminance(texture(").concat(t.result,", uv1).rgb) * roughnessScale;\n\t\t\t\t\t\tfloat r2 = luminance(texture(").concat(t.result,", uv2).rgb) * roughnessScale;\n\n\t\t\t\t\t\troughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);\n\t\t\t\t\t}\n\t\t\t\t\tfloat roughnessFactor = roughnessChange * ").concat(a.result,";\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 roughnessMapCachedUv = g".concat(this.roughnessMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\n\t\t\t\t\tvec4 vals = texture(").concat(t.result,",  roughnessMapCachedUv);\n\t\t\t\t\tfloat roughnessFactor = luminance(vals.rgb) * ").concat(a.result,";\n\t\t\t\t\t"),p.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(i.result,";\n\n\t\t\t\t\tconst float roughnessScale = 1.0;\n\n\t\t\t\t\t").concat(n,"\n\t\t\t\t"))}else p.push(a.code,"\tfloat roughnessFactor = "+a.result+";");h&&p.push(h.code,"#ifdef ALPHATEST","\tif ( "+h.result+" <= ALPHATEST ) discard;","#endif"),p.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),p.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),u?p.push(u.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+u.result+" ) ), diffuseColor, metalnessFactor );"):p.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),p.push("#include <lights_fragment_begin>"),p.push("#include <lights_fragment_end>"),p.push("vec3 ao = aoEnabled && "+n.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let f="1.0";this.mask&&(this.mask.analyze(e),f="luminance(".concat(this.mask.flow(e,"v3").result,")")),p.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(o.result," * ").concat(f," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(o.result," * ").concat(f,", ").concat(l.result," );\n\t\t\t\t\t\n\t\t\t\t\toutgoingLight *= ao;\n\t\t\t\t}\n\t\t\t\t")),c&&p.push(c.code,"outgoingLight = spe_blend(outgoingLight, ".concat(c.result,", 1.0, SPE_BLENDING_NORMAL);")),h?p.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(h.result," );")):p.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),d&&p.push("gl_FragColor.a *= ".concat(d.result,";")),p.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=p.join("\n")}return t}},Jk=class extends dI{constructor(){super("toon"),this.nodeType="Toon",this.color=new tk(BE),this.specular=new tk(1118481),this.shininess=new kI(30),this.previousModelViewMatrix=new ck,this.previouseProjectionMatrix=new ck,this.shadingAlpha=new kI(1),this.shadingBlend=new ik(0)}get category(){return"toon"}build(e){let t;if(e.define("TOON"),e.requires.lights=!0,e.extensions.derivatives=!0,e.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(e,"v3",{cache:"position"}):void 0;e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({resolution:Hk.resolution}),e.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),e.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),e.mergeUniform(dh.merge([Dh.fog,Dh.lights])),e.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join("\n"));let n=["#include <beginnormal_vertex>","\n\t\t\t\t#include <skinbase_vertex>\n\t\t\t\t#include <skinnormal_vertex>\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <defaultnormal_vertex>\n\t\t\t\t#endif\n\n\t\t\t\tvec3 displaced_position = position;\n\t\t\t\tvec3 displaced_normal = objectNormal;\n\n\t\t\t\t#ifdef USE_LAYER_DISPLACE\n\t\t\t\t\tvec3 transformed;\n\t\t\t\t\tvec3 transformedNormal;\n\t\t\t\t#endif\n\t\t\t\t","#include <normal_vertex>","\n\t\t\t\t#ifndef USE_LAYER_DISPLACE\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t#endif\n\t\t\t\t"];i&&n.push(i.code,i.result?"displaced_position = "+i.result+";":""),n.push("transformed = displaced_position;","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),n.push("\t#include <project_vertex>","\t#include <fog_vertex>","\t#include <clipping_planes_vertex>","\tvViewPosition = - mvPosition.xyz;","\t#include <worldpos_vertex>","\t#include <shadowmap_vertex>","\t#include <fog_vertex>"),n.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),t=n.join("\n")}else{e.mergeUniform({penumbraSize:Hk.penumbraSize}),e.mergeUniform({frameIndex:Hk.frameIndex}),e.mergeUniform({aoMap:Hk.aoRenderTarget}),e.mergeUniform({aoEnabled:Hk.aoEnabled}),void 0===this.color&&(this.color=new tk(BE)),this.color.analyze(e,{slot:"color"}),this.specular.analyze(e),this.shininess.analyze(e),this.shadingAlpha.analyze(e),this.shadingBlend.analyze(e),this.afterColor&&this.afterColor.analyze(e,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(e);let i=this.color.flow(e,"c",{slot:"color"}),n=this.specular.flow(e,"c"),r=this.shininess.flow(e,"f"),a=this.shadingAlpha.flow(e,"f"),s=this.shadingBlend.flow(e,"i"),o=this.afterColor?this.afterColor.flow(e,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(e,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(e,"f"):void 0;e.requires.transparent=void 0!==l,e.addParsCode(["uniform float penumbraSize[".concat(5,"];"),"uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>","\n\t\t\t\t\tvarying vec3 vViewPosition;\n\t\t\t\t\tstruct ToonMaterial {\n\t\t\t\t\t\tvec3\tdiffuseColor;\n\t\t\t\t\t\tvec3\tspecularColor;\n\t\t\t\t\t\tfloat\tspecularShininess;\n\t\t\t\t\t\tfloat\tspecularStrength;\n\t\t\t\t\t};\n\t\t\t\t\tvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t\t\t\n\t\t\t\t\t\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n\t\t\t\t\t}\n\t\t\t\t\tvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\t\t\t\t\t\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\t\t\t\t\t}\n\t\t\t\t\t#define RE_Direct\t\t\t\tRE_Direct_Toon\n\t\t\t\t\t#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\t\t\t\t\t#define Material_LightProbeLOD( material )\t(0)\n\t\t\t\t\t","#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join("\n"));let h=["#include <normal_fragment_begin>","\n\t\t\t\t// NOTE: gl_FrontFacing alternative using face normal estimation.\n\t\t\t\tvec3 viewdx = dFdx(vViewPosition);\n\t\t\t\tvec3 viewdy = dFdy(vViewPosition);\n\t\t\t\tvec3 faceNormal = normalize(cross(viewdx,viewdy));\n\t\t\t\tif (dot(normal, faceNormal) < 0.0) {\n\t\t\t\t\tnormal *= -1.0;\n\t\t\t\t}\n\t\t\t\t","\tToonMaterial material;"];if(this.bumpMap){e.include(Qk.dHdxy),e.include(Qk.perturbNormalArb);let t=this.bumpMap.texture.flow(e,"t"),i=this.bumpMap.flow(e,"v3"),n=this.bumpMapIntensity?this.bumpMapIntensity.flow(e,"f").result:"1.0",r="";r=4===this.bumpMap.projection.value?"\n\t\t\t\t\tvec3 bumpNormal = vec3(0.0);\n\t\t\t\t\t{\n\t\t\t\t\t\tvec2 uv0 = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs0;\n\t\t\t\t\t\tvec2 uv1 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs1;\n\t\t\t\t\t\tvec2 uv2 = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs2;\n\t\t\t\t\t\tvec3 weights = g").concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_triplanarWeights;\n\n\t\t\t\t\t\tvec2 grad0 = dHdxy(").concat(t.result,", uv0, ").concat(n,");\n\t\t\t\t\t\tvec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);\n\n\t\t\t\t\t\tvec2 grad1 = dHdxy(").concat(t.result,", uv1, ").concat(n,");\n\t\t\t\t\t\tvec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);\n\n\t\t\t\t\t\tvec2 grad2 = dHdxy(").concat(t.result,", uv2, ").concat(n,");\n\t\t\t\t\t\tvec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);\n\t\t\t\t\t\t\n\t\t\t\t\t\tbumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;\n\t\t\t\t\t\tbumpNormal = normalize(bumpNormal);\n\t\t\t\t\t}\n\n\t\t\t\t\tnormal = bumpNormal;\n\t\t\t\t\t"):"\n\t\t\t\t\tvec2 bumpMapCachedUv = g".concat(this.bumpMap.uuid.toString().replace(/-/g,""),"_writeUvs;\n\t\t\t\t\tvec2 grad = dHdxy(").concat(t.result,", bumpMapCachedUv, ").concat(n,");\n\t\t\t\t\tnormal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );\n\t\t\t\t\t"),h.push("// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates\n\t\t\t\t\t".concat(i.result,";\n\t\t\t\t\t").concat(r,"\n\t\t\t\t\t"))}h.push(i.code,"\tvec3 diffuseColor = "+i.result+";","\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",n.code,"\tvec3 specular = "+n.result+";",r.code,"\tfloat shininess = max( 0.0001, "+r.result+" );","\tfloat specularStrength = 1.0;"),l&&h.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let d="1.0";this.mask&&(this.mask.analyze(e),d="luminance(".concat(this.mask.flow(e,"v3").result,")")),h.push("\n\t\t\t\tif (outgoingLight != diffuseColor) {\n\t\t\t\t\tfloat lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );\n\t\t\t\t\taccumAlpha += ( 1.0 - accumAlpha ) * ".concat(a.result," * ").concat(d," * lightAccu;\n\t\t\t\t\toutgoingLight = spe_blend( diffuseColor, outgoingLight, ").concat(a.result," * ").concat(d,", ").concat(s.result," );\n\t\t\t\t}\n\t\t\t\t")),o&&h.push(o.code,"outgoingLight = spe_blend(outgoingLight, ".concat(o.result,", 1.0, SPE_BLENDING_NORMAL);")),l?h.push("gl_FragColor = vec4( outgoingLight, accumAlpha * ".concat(l.result," );")):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&h.push("gl_FragColor.a *= ".concat(c.result,";")),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),t=h.join("\n")}return t}},$k=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;this.timeout=e,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(){}remove(e){let t=this.cache.get(e);t&&(this.dispose(e,t.data),this.cache.delete(e),t.prev.next=t.next,t.next.prev=t.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout((()=>{this.hasClean=!1,this.log("cleaning");let e=Date.now(),t=this.head.next;for(;t.time<e-this.timeout;)this.dispose(t.src,t.data),this.cache.delete(t.src),t=t.next,t.prev=this.head,this.head.next=t;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")}),this.timeout+1e3))}has(e){var t;return null===(t=this.cache.get(e))||void 0===t?void 0:t.data}load(e){let t=Date.now(),i=this.cache.get(e);return void 0===i?(i={data:this.create(e),src:e,time:t,next:null,prev:null},this.cache.set(e,i)):(i.time=t,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},eL=class extends $k{create(e){return URL.createObjectURL(new Blob([e]))}dispose(e,t){URL.revokeObjectURL(t)}};var tL=class{constructor(e,t){this.data=e,this.cache=t,this.refCount=0}deref(){this.refCount,this.refCount-=1,0===this.refCount&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount,0}},iL=class{constructor(){this.cache=new Map}remove(e){this.cache.delete(e.data),0}load(e){let t=this.cache.get(e);return void 0===t&&(t=this.create(e),this.cache.set(e,t)),t.refCount+=1,t}},nL=class extends tL{constructor(e,t){super(e,t.imageHolderCache),this.data=e,this.shared=t,this.loaded=!1,this.isVideo=!1,this.isCanvas=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo="video"===e.type,this.isCanvas="CANVAS"===e.nodeName,this.updateSrc(this.isCanvas?e:e.data)}async updateSrc(e){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let t=()=>{this.loaded=!0;for(let e of Object.values(this._cache))for(let t of Object.values(e))t&&(t.image=this.img,t.needsUpdate=!0);this.shared.requestRender()};if(this.isCanvas)this.img=e,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,"string"!=typeof e){var i=new FileReader;let t;i.readAsDataURL(new Blob([e],{type:"video/mp4"})),await new Promise((e=>{i.onloadend=i=>{var n;t=null===(n=i.target)||void 0===n?void 0:n.result,e(null)}})),this.img.src=t}else this.img.src=e;this.img.onloadeddata=()=>{t()}}else this.img=new Image,this.img.src=function(e){return"string"==typeof e?e:(Wk||(Wk=new eL),Wk.load(e))}(e),this.img.onload=t}getTexture(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1008,n=null===(t=this._cache[e])||void 0===t?void 0:t[i];if(n)return n;{let t;return this.isCanvas&&(t=new kp(this.img,void 0,e,e,void 0,i)),t=this.isVideo?new Ip(this.img,void 0,e,e):new hl(this.img,void 0,e,e,void 0,i),this.loaded&&(t.needsUpdate=!0),void 0===this._cache[e]&&(this._cache[e]={}),this._cache[e][i]=t,t}}setNeedsUpdate(e){for(let t of Object.values(this._cache))for(let i of Object.values(t))i&&(i.needsUpdate=e)}disposeTextures(){for(let[e,t]of Object.entries(this._cache))for(let[i,n]of Object.entries(t))null!==n&&void 0!==n&&n.dispose(),this._cache[e][i]=void 0}dispose(){super.dispose(),this.disposeTextures()}},rL=class extends nL{};function aL(e,t){var i=function(e){if(!oL[e]){var t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i="06/25/2014, 00:00:00"===t||"\u200e06\u200e/\u200e25\u200e/\u200e2014\u200e \u200e00\u200e:\u200e00\u200e:\u200e00"===t;oL[e]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:e,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return oL[e]}(t);return i.formatToParts?function(e,t){try{for(var i=e.formatToParts(t),n=[],r=0;r<i.length;r++){var a=sL[i[r].type];a>=0&&(n[a]=parseInt(i[r].value,10))}return n}catch(uE){if(uE instanceof RangeError)return[NaN];throw uE}}(i,e):function(e,t){var i=e.format(t).replace(/\u200E/g,""),n=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[n[3],n[1],n[2],n[4],n[5],n[6]]}(i,e)}var sL={year:0,month:1,day:2,hour:3,minute:4,second:5};var oL={};function lL(e,t,i,n,r,a,s){var o=new Date(0);return o.setUTCFullYear(e,t,i),o.setUTCHours(n,r,a,s),o}var cL=36e5,hL=6e4,dL={timezone:/([Z+-].*)$/,timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function uL(e,t,i){var n,r,a;if(!e||(n=dL.timezoneZ.exec(e)))return 0;if(n=dL.timezoneHH.exec(e))return fL(a=parseInt(n[1],10))?-a*cL:NaN;if(n=dL.timezoneHHMM.exec(e)){a=parseInt(n[1],10);var s=parseInt(n[2],10);return fL(a,s)?(r=Math.abs(a)*cL+s*hL,a>0?-r:r):NaN}if(function(e){if(mL[e])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:e}),mL[e]=!0,!0}catch{return!1}}(e)){t=new Date(t||Date.now());var o=i?t:function(e){return lL(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())}(t),l=pL(o,e),c=i?l:function(e,t,i){var n=e.getTime(),r=n-t,a=pL(new Date(r),i);if(t===a)return t;r-=a-t;var s=pL(new Date(r),i);return a===s?a:Math.max(a,s)}(t,l,e);return-c}return NaN}function pL(e,t){var i=aL(e,t),n=lL(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),r=e.getTime(),a=r%1e3;return n-(r-=a>=0?a:1e3+a)}function fL(e,t){return-23<=e&&e<=23&&(null==t||0<=t&&t<=59)}var mL={};var gL=Br(Gr(),1),vL=Br(Hr(),1),yL=36e5,bL=6e4,xL=2,wL={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,plainTime:/:/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/};function _L(e,t){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(null===e)return new Date(NaN);var i=t||{},n=null==i.additionalDigits?xL:(0,gL.default)(i.additionalDigits);if(2!==n&&1!==n&&0!==n)throw new RangeError("additionalDigits must be 0, 1 or 2");if(e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e))return new Date(e.getTime());if("number"==typeof e||"[object Number]"===Object.prototype.toString.call(e))return new Date(e);if("string"!=typeof e&&"[object String]"!==Object.prototype.toString.call(e))return new Date(NaN);var r=function(e){var t,i={},n=wL.dateTimePattern.exec(e);if(n?(i.date=n[1],t=n[3]):(n=wL.datePattern.exec(e),n?(i.date=n[1],t=n[2]):(i.date=null,t=e)),t){var r=wL.timeZone.exec(t);r?(i.time=t.replace(r[1],""),i.timeZone=r[1].trim()):i.time=t}return i}(e),a=function(e,t){var i,n=wL.YYY[t],r=wL.YYYYY[t];if(i=wL.YYYY.exec(e)||r.exec(e),i){var a=i[1];return{year:parseInt(a,10),restDateString:e.slice(a.length)}}if(i=wL.YY.exec(e)||n.exec(e),i){var s=i[1];return{year:100*parseInt(s,10),restDateString:e.slice(s.length)}}return{year:null}}(r.date,n),s=a.year,o=function(e,t){if(null===t)return null;var i,n,r,a;if(0===e.length)return n=new Date(0),n.setUTCFullYear(t),n;if(i=wL.MM.exec(e),i)return n=new Date(0),r=parseInt(i[1],10)-1,ML(t,r)?(n.setUTCFullYear(t,r),n):new Date(NaN);if(i=wL.DDD.exec(e),i){n=new Date(0);var s=parseInt(i[1],10);return function(e,t){if(t<1)return!1;var i=CL(e);return!(i&&t>366||!i&&t>365)}(t,s)?(n.setUTCFullYear(t,0,s),n):new Date(NaN)}if(i=wL.MMDD.exec(e),i){n=new Date(0),r=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return ML(t,r,o)?(n.setUTCFullYear(t,r,o),n):new Date(NaN)}if(i=wL.Www.exec(e),i)return a=parseInt(i[1],10)-1,PL(t,a)?SL(t,a):new Date(NaN);if(i=wL.WwwD.exec(e),i){a=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return PL(t,a,l)?SL(t,a,l):new Date(NaN)}return null}(a.restDateString,s);if(isNaN(o))return new Date(NaN);if(o){var l,c=o.getTime(),h=0;if(r.time&&(h=function(e){var t,i,n;if(t=wL.HH.exec(e),t)return i=parseFloat(t[1].replace(",",".")),TL(i)?i%24*yL:NaN;if(t=wL.HHMM.exec(e),t)return i=parseInt(t[1],10),n=parseFloat(t[2].replace(",",".")),TL(i,n)?i%24*yL+n*bL:NaN;if(t=wL.HHMMSS.exec(e),t){i=parseInt(t[1],10),n=parseInt(t[2],10);var r=parseFloat(t[3].replace(",","."));return TL(i,n,r)?i%24*yL+n*bL+1e3*r:NaN}return null}(r.time),isNaN(h)))return new Date(NaN);if(r.timeZone||i.timeZone){if(l=uL(r.timeZone||i.timeZone,new Date(c+h)),isNaN(l))return new Date(NaN)}else l=(0,vL.default)(new Date(c+h)),l=(0,vL.default)(new Date(c+h+l));return new Date(c+h+l)}return new Date(NaN)}function SL(e,t,i){t=t||0,i=i||0;var n=new Date(0);n.setUTCFullYear(e,0,4);var r=7*t+i+1-(n.getUTCDay()||7);return n.setUTCDate(n.getUTCDate()+r),n}var AL=[31,28,31,30,31,30,31,31,30,31,30,31],EL=[31,29,31,30,31,30,31,31,30,31,30,31];function CL(e){return e%400===0||e%4===0&&e%100!==0}function ML(e,t,i){if(t<0||t>11)return!1;if(null!=i){if(i<1)return!1;var n=CL(e);if(n&&i>EL[t]||!n&&i>AL[t])return!1}return!0}function PL(e,t,i){return!(t<0||t>52||null!=i&&(i<0||i>6))}function TL(e,t,i){return!(null!=e&&(e<0||e>=25)||null!=t&&(t<0||t>=60)||null!=i&&(i<0||i>=60))}function DL(e,t){return t.color(e)}function RL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=arguments.length>1?arguments[1]:void 0,i=t.format,n=e.getSeconds(),r=e;t&&null!==t.timeZone&&(r=function(e,t,i){var n=_L(e,i),r=uL(t,n,!0),a=new Date(n.getTime()-r),s=new Date(0);return s.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),s.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),s}(new Date,t.timeZone));let a,s=r.getHours(),o=r.getMinutes();"12ampm"===t.format12h24h&&(a=s>=12?"PM":"AM");let l,c,h=s;switch("24"!==t.format12h24h&&(h=s%12,0===h&&(h=12)),i){case"HH:mm:ss":l=[h,o,n];break;case"HH:mm":l=[h,o];break;case"HH":l=[h],a=void 0;break;case"mm":l=[o],a=void 0;break;case"ss":l=[n],a=void 0;break;case"year":c=r.getFullYear();break;case"month":c=r.getMonth()+1;break;case"dayOfYear":c=Math.floor((r.getTime()-new Date(r.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":c=r.getDate();break;case"secondOfDay":c=60*s*60+60*o+n;break;default:console.error("Unknown time format",i),c=0}return void 0!==l?{textValue:l,suffix:a}:c}function OL(e,t){switch(e.type){case"fresnel":return function(e,t){let{bias:i,scale:n,intensity:r,factor:a,color:s}=e;return{...kL(e,t),color:DL(s,t),bias:i,scale:n,intensity:r,factor:a}}(e,t);case"gradient":return function(e,t){let{gradientType:i,smooth:n,colors:r,steps:a,angle:s,offset:o,morph:l}=e;return{...kL(e,t),gradientType:i,smooth:n,colors:r.map((e=>new dl(e[0],e[1],e[2],e[3]))),num:r.length,steps:a,offset:new jo(...o),morph:new jo(...l),angle:s}}(e,t);case"depth":return function(e,t){let{gradientType:i,near:n,far:r,isVector:a,isWorldSpace:s,origin:o,direction:l,colors:c,steps:h,smooth:d}=e;return{...kL(e,t),gradientType:i,near:n,far:r,isVector:a,isWorldSpace:s,origin:new gl(...o),direction:l?new gl(...l):new gl(1,0,0),colors:c.map((e=>void 0!==e?new dl(e[0],e[1],e[2],e[3]):new dl(0,0,0,0))),steps:h.slice(0,c.length),smooth:d}}(e,t);case"normal":return function(e,t){let{cnormal:i}=e;return{...kL(e,t),cnormal:new gl(i[0],i[1],i[2])}}(e,t);case"noise":return function(e,t){return{...kL(e,t),scale:e.scale,move:e.move,fA:new jo(...e.fA),fB:new jo(...e.fB),size:new gl(...e.size),distortion:new jo(...e.distortion),colorA:DL(e.colorA,t),colorB:DL(e.colorB,t),colorC:DL(e.colorC,t),colorD:DL(e.colorD,t),noiseType:e.noiseType,voronoiStyle:e.voronoiStyle,highCut:e.highCut,lowCut:e.lowCut,smoothness:e.smoothness,seed:e.seed,quality:e.quality}}(e,t);case"rainbow":return function(e,t){return{...kL(e,t),filmThickness:e.filmThickness,movement:e.movement,wavelengths:new gl(...e.wavelengths),noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,offset:new gl(...e.offset)}}(e,t);case"toon":return function(e,t){return{...kL(e,t),positioning:e.positioning,colors:e.colors.map((e=>new dl(e[0],e[1],e[2],e[3]))),num:e.colors.length,steps:e.steps,source:new gl(...e.source),isWorldSpace:e.isWorldSpace,noiseStrength:e.noiseStrength,noiseScale:e.noiseScale,shadowColor:DL(e.shadowColor,t),offset:new gl(...e.offset)}}(e,t);case"outline":return function(e,t){return{...kL(e,t),outlineColor:DL(e.outlineColor,t),contourColor:DL(e.contourColor,t),outlineWidth:e.outlineWidth,contourWidth:e.contourWidth,outlineThreshold:e.outlineThreshold,contourThreshold:e.contourThreshold,outlineSmoothing:e.outlineSmoothing,contourFrequency:e.contourFrequency,contourDirection:new gl(...e.contourDirection),positionalLines:e.positionalLines,compensation:e.compensation}}(e,t);case"transmission":return function(e,t){return{...kL(e,t),thickness:e.thickness,ior:e.ior,roughness:e.roughness}}(e,t);case"color":return function(e,t){return{...kL(e,t),color:DL(e.color,t)}}(e,t);case"pattern":return function(e,t){return{...kL(e,t),style:e.style,projection:e.projection,axis:e.axis,blending:e.blending,offset:new jo(...e.offset),colorA:DL(e.colorA,t),colorB:DL(e.colorB,t),frequency:new jo(...e.frequency),size:e.size,variation:e.variation,smoothness:e.smoothness,zigzag:e.zigzag,rotation:e.rotation,vertical:new jo(...e.vertical),horizontal:new jo(...e.horizontal),sides:e.sides}}(e,t)}}function IL(e){return{type:e.type}}function kL(e,t){var i;let{alpha:n,mode:r,isMask:a}=e,s="string"==typeof n?(null!==(i=Number(t.getVariable(n)))&&void 0!==i?i:100)/100:n;return{...IL(e),alpha:s,mode:r,isMask:a}}var LL=class extends yI{},FL={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},BL={depth:["colors"]};function NL(e,t,i){if("isMask"===t)return!0;let n=FL[e.type],r=BL[e.type];if(void 0!==r){let n=e.color;if(r.includes(t)){var a;let e=null===(a=n[t])||void 0===a||null===(a=a.value)||void 0===a?void 0:a.length;if(void 0!==e&&e!==i.length)return!0}}return void 0!==n&&n.includes(t)}function zL(e,t,i){var n;let r=i.uniforms["f".concat(i.id,"_texture")];if(!r)return!1;let a=!1,s=e;if("image"in s){let e=s.image,i=t.image(e),n=r;n.image instanceof rL||n.image.deref(),n.image=i}if("video"in s){let e=s.video,i=t.video(e),n=r;n.image instanceof rL||n.image.deref(),n.image=i}if("wrapping"in s){r.wrap=s.wrapping}if("minFilter"in s){r.minFilter=s.minFilter}if("rotation"in s&&i.uniforms["f".concat(i.id,"_rotation")])return i.uniforms["f".concat(i.id,"_rotation")].value=(null!==(n=s.rotation)&&void 0!==n?n:0)*Uo.DEG2RAD,a;if("repeat"in s||"offset"in s||"rotation"in s){var o;let e="mat",t=i.uniforms["f".concat(i.id,"_").concat(e)];"repeat"in s&&(t.repeat=s.repeat),"offset"in s&&(t.offset=s.offset),"rotation"in s&&(t.rotation=null!==(o=s.rotation)&&void 0!==o?o:0),t.updateMatrix()}return a}var UL=(e,t,i)=>{var n,r;return null!==(n=Math.max(0,Math.min(1,Number(null!==(r=t.getVariable("number"==typeof e?100*e:e,i))&&void 0!==r?r:100)/100)))&&void 0!==n?n:1},jL=class{constructor(e,t,i,n,r){this.id=e,this.uuid=t,this.data=i,this.uniforms={};for(let a in n)this.uniforms["f".concat(this.id,"_").concat(a)]=n[a];for(let a in i)qL(a,this,i,r)}get type(){return this.data.type}static create(e,t,i,n){if("light"===i.type)return HL.createLigherLayer(e,t,i,n);if("texture"===i.type||"video"===i.type){var r,a,s,o,l,c,h,d,u;let p="texture"===i.type?null!==(r=n.canvas(i.texture.image))&&void 0!==r?r:n.image(i.texture.image):n.video(i.texture.video),f=new ok(p,i.texture.wrapping,null!==(a=i.texture.minFilter)&&void 0!==a?a:1008),m=new sk(p),g=new dk(i.texture.repeat,i.texture.offset,null!==(s=i.texture.rotation)&&void 0!==s?s:0),v=new kI(i.crop?1:0),y=new ik(null!==(o=i.projection)&&void 0!==o?o:0),b=new ik(null!==(l=["x","y","z"].indexOf(i.axis))&&void 0!==l?l:0),x=new ik(null!==(c=i.side)&&void 0!==c?c:0),w=new gI(i.size?new jo(i.size[0],i.size[1]):new jo(100,100)),_=new kI(null!==(h=i.blending)&&void 0!==h?h:0),S=new kI(UL(i.alpha,n)),A=new ik(null!==(d=i.mode)&&void 0!==d?d:0),E=new nk(null!==(u=i.isMask)&&void 0!==u&&u),C=new bk(f,m,v,y,b,x,w,_,g,S,A,E),M=new OI(C.calpha,"f");return new VL(e,t,i,{texture:f,textureSize:m,crop:v,projection:y,axis:b,side:x,size:w,blending:_,mat:g,alpha:S,mode:A,isMask:E},C,A,M,E,n)}if("matcap"===i.type){var p,f,m,g;let r=n.image(i.texture.image),a=new ok(r,i.texture.wrapping,null!==(p=i.texture.minFilter)&&void 0!==p?p:1008),s=new kI(UL(i.alpha,n)),o=new ik(null!==(f=i.mode)&&void 0!==f?f:0),l=new nk(null!==(m=i.isMask)&&void 0!==m&&m),c=new kI(null!==(g=i.texture.rotation)&&void 0!==g?g:0),h=new Ck(a,s,o,l,c),d=new OI(h.calpha,"f");return new VL(e,t,i,{texture:a,alpha:s,mode:o,isMask:l,rotation:c},h,o,d,l,n)}if("displace"===i.type){if("noise"===i.displacementType){var v,y,b,x,w,_,S,A,E,C;let r=new vI(new gl(...i.offset)),a=new kI(null!==(v=i.scale)&&void 0!==v?v:10),s=new kI(null!==(y=i.intensity)&&void 0!==y?y:8),o=new kI(null!==(b=i.movement)&&void 0!==b?b:1),l=new ik(null!==(x=i.noiseType)&&void 0!==x?x:0),c=new ik(null!==(w=i.voronoiStyle)&&void 0!==w?w:0),h=new kI(null!==(_=i.smoothness)&&void 0!==_?_:.5),d=new kI(null!==(S=i.seed)&&void 0!==S?S:0),u=new kI(null!==(A=i.highCut)&&void 0!==A?A:1),p=new kI(null!==(E=i.lowCut)&&void 0!==E?E:0),f=new ik(null!==(C=i.quality)&&void 0!==C?C:1),m=new Gk(s,o,r,c,h,d,u,p,f,a,l);return new GL(e,t,i,{offset:r,scale:a,intensity:s,movement:o,noiseType:l,voronoiStyle:c,smoothness:h,seed:d,highCut:u,lowCut:p,quality:f},m,n)}throw new Error}return function(e,t,i,n){let r=OL(i,n);return function(e,t,i,n,r){switch(e.type){case"color":{var a;let s=new tk(null!==(a=n.color)&&void 0!==a?a:BE),o=WL(n),l=new mk(s,o.alpha),c=new OI(l.calpha,"f");return new VL(t,i,e,{color:s,...o},l,o.mode,c,o.isMask,r)}case"fresnel":{var s,o,l,c,h;let a=new tk(null!==(s=n.color)&&void 0!==s?s:16777215),d=new kI(null!==(o=n.bias)&&void 0!==o?o:.1),u=new kI(null!==(l=n.scale)&&void 0!==l?l:1),p=new kI(null!==(c=n.intensity)&&void 0!==c?c:2),f=new kI(null!==(h=n.factor)&&void 0!==h?h:1),m=WL(n),g=new _k(a,d,u,p,f,m.alpha,m.mode,m.isMask),v=new OI(g.calpha,"f");return new VL(t,i,e,{color:a,bias:d,scale:u,intensity:p,factor:f,...m},g,m.mode,v,m.isMask,r)}case"rainbow":{var d,u,p,f,m,g;let a=new kI(null!==(d=n.filmThickness)&&void 0!==d?d:30),s=new kI(null!==(u=n.movement)&&void 0!==u?u:0),o=new vI(null!==(p=n.wavelengths)&&void 0!==p?p:new gl(0,0,0)),l=new kI(null!==(f=n.noiseStrength)&&void 0!==f?f:0),c=new kI(null!==(m=n.noiseScale)&&void 0!==m?m:1),h=new vI(null!==(g=n.offset)&&void 0!==g?g:new gl(0,0,0)),v=WL(n),y=new Lk(a,s,o,l,c,h,v.alpha,v.isMask),b=new OI(y.calpha,"f");return new VL(t,i,e,{filmThickness:a,movement:s,wavelengths:o,noiseStrength:l,noiseScale:c,offset:h,...v},y,v.mode,b,v.isMask,r)}case"transmission":{var v,y,b;let a=new kI(null!==(v=n.thickness)&&void 0!==v?v:10),s=new kI(null!==(y=n.ior)&&void 0!==y?y:1.5),o=new kI(null!==(b=n.roughness)&&void 0!==b?b:.5),l=Hk.transmissionSize,c=Hk.transmissionRenderTarget,h=Hk.transmissionRenderTargetDepth,d=window.innerWidth,u=window.innerHeight,p=d>=u?new gI(u/d,1):new gI(1,d/u),f=WL(n),m=new Uk(a,s,o,l,c,h,p,f.alpha),g=new OI(m.calpha,"f");return new VL(t,i,e,{thickness:a,ior:s,roughness:o,aspectRatio:p,...f},m,f.mode,g,f.isMask,r)}case"toon":{var x,w,_,S,A,E;let a,s,o=new ik(null!==(x=n.positioning)&&void 0!==x?x:0);n.colors?a=new uk(n.colors.length,n.colors):(a=new uk(10,new dl(0,0,0,1)),a.value[1]=new dl(1,1,1,1)),n.steps?s=new rk(n.steps.length,n.steps):(s=new rk(10,1),s.value[0]=0);let l=new vI(null!==(w=n.source)&&void 0!==w?w:new gl(0,0,0)),c=new nk(null===(_=n.isWorldSpace)||void 0===_||_),h=new kI(null!==(S=n.noiseStrength)&&void 0!==S?S:0),d=new kI(null!==(A=n.noiseScale)&&void 0!==A?A:1),u=new bI(n.shadowColor),p=new vI(null!==(E=n.offset)&&void 0!==E?E:new gl(0,0,0)),f=WL(n),m=new Bk(o,a,s,l,c,h,d,u,p,f.alpha),g=new OI(m.calpha,"f");return new VL(t,i,e,{positioning:o,colors:a,steps:s,source:l,isWorldSpace:c,noiseStrength:h,noiseScale:d,shadowColor:u,offset:p,...f},m,f.mode,g,f.isMask,r)}case"outline":{var C,M,P,T,D,R,O,I,k,L,F;let a=new tk(null!==(C=n.outlineColor)&&void 0!==C?C:16777215),s=new tk(null!==(M=n.contourColor)&&void 0!==M?M:16777215),o=new kI(null!==(P=n.outlineWidth)&&void 0!==P?P:.1),l=new kI(null!==(T=n.contourWidth)&&void 0!==T?T:.1),c=new kI(null!==(D=n.outlineThreshold)&&void 0!==D?D:.1),h=new kI(null!==(R=n.contourThreshold)&&void 0!==R?R:.1),d=new kI(null!==(O=n.outlineSmoothing)&&void 0!==O?O:.1),u=new kI(null!==(I=n.contourFrequency)&&void 0!==I?I:.1),p=new vI(null!==(k=n.contourDirection)&&void 0!==k?k:new gl(0,1,0)),f=new nk(null!==(L=n.positionalLines)&&void 0!==L&&L),m=new nk(null===(F=n.compensation)||void 0===F||F),g=Hk.normalRenderTarget,v=Hk.normalRenderTargetDepth,y=Hk.pixelRatioNode,b=Hk.resolution,x=WL(n),w=new Rk(a,s,o,l,c,h,d,u,p,f,m,b,g,v,y,x.alpha),_=new OI(w.calpha,"f");return new VL(t,i,e,{outlineColor:a,contourColor:s,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:h,outlineSmoothing:d,contourFrequency:u,contourDirection:p,positionalLines:f,compensation:m,...x},w,x.mode,_,x.isMask,r)}case"depth":{var B,N,z,U,j,V,G,H;let a,s,o=new ik(null!==(B=n.gradientType)&&void 0!==B?B:0),l=new nk(null!==(N=n.smooth)&&void 0!==N&&N),c=new kI(null!==(z=n.near)&&void 0!==z?z:50),h=new kI(null!==(U=n.far)&&void 0!==U?U:200),d=new kI(null!==(j=n.isVector)&&void 0!==j?j:1),u=new kI(null!==(V=n.isWorldSpace)&&void 0!==V?V:0),p=new vI(null!==(G=n.origin)&&void 0!==G?G:new gl),f=new vI(null!==(H=n.direction)&&void 0!==H?H:new gl);n.colors?a=new uk(n.colors.length,n.colors):(a=new uk(2,new dl(0,0,0,1)),a.value[1]=new dl(1,1,1,1)),n.steps?s=new rk(n.steps.length,n.steps):(s=new rk(2,1),s.value[0]=0);let m=WL(n),g=new wk(o,l,c,h,d,u,p,f,a,s,m.alpha,m.isMask),v=new OI(g.calpha,"f");return new VL(t,i,e,{gradientType:o,smooth:l,near:c,far:h,isVector:d,isWorldSpace:u,origin:p,direction:f,colors:a,steps:s,...m},g,m.mode,v,m.isMask,r)}case"noise":{var W,q,X,Y,Q,K,Z,J,$,ee,te,ie,ne;let a=new kI(null!==(W=n.scale)&&void 0!==W?W:1),s=new vI(null!==(q=n.size)&&void 0!==q?q:new gl(100,100,100)),o=new kI(null!==(X=n.move)&&void 0!==X?X:1),l=new gI(null!==(Y=n.fA)&&void 0!==Y?Y:new jo(1.7,9.2)),c=new gI(null!==(Q=n.fB)&&void 0!==Q?Q:new jo(8.3,2.8)),h=new gI(null!==(K=n.distortion)&&void 0!==K?K:new jo(1,1)),d=new bI(n.colorA),u=new bI(n.colorB),p=new bI(n.colorC),f=new bI(n.colorD),m=new ik(null!==(Z=n.noiseType)&&void 0!==Z?Z:0),g=new ik(null!==(J=n.voronoiStyle)&&void 0!==J?J:0),v=new kI(null!==($=n.highCut)&&void 0!==$?$:1),y=new kI(null!==(ee=n.lowCut)&&void 0!==ee?ee:0),b=new kI(null!==(te=n.smoothness)&&void 0!==te?te:.5),x=new kI(null!==(ie=n.seed)&&void 0!==ie?ie:.5),w=new ik(null!==(ne=n.quality)&&void 0!==ne?ne:1),_=WL(n),S=new Tk(a,s,o,l,c,h,d,u,p,f,_.alpha,m,_.isMask,g,v,y,b,x,w),A=new OI(S.calpha,"f");return new VL(t,i,e,{scale:a,size:s,move:o,fA:l,fB:c,distortion:h,colorA:d,colorB:u,colorC:p,colorD:f,noiseType:m,..._,voronoiStyle:g,highCut:v,lowCut:y,smoothness:b,seed:x,quality:w},S,_.mode,A,_.isMask,r)}case"normal":{var re;let a=new vI(null!==(re=n.cnormal)&&void 0!==re?re:new gl(1,1,1)),s=WL(n),o=new vk(a,s.alpha),l=new OI(o.calpha,"f");return new VL(t,i,e,{cnormal:a,...s},o,s.mode,l,s.isMask,r)}case"gradient":{var ae,se,oe,le,ce;let a,s,o=new ik(null!==(ae=n.gradientType)&&void 0!==ae?ae:0),l=new nk(null!==(se=n.smooth)&&void 0!==se&&se);n.colors?a=new uk(n.colors.length,n.colors):(a=new uk(10,new dl(0,0,0,1)),a.value[1]=new dl(1,1,1,1)),n.steps?s=new rk(n.steps.length,n.steps):(s=new rk(10,1),s.value[0]=0);let c=new gI(null!==(oe=n.offset)&&void 0!==oe?oe:new jo(0,0)),h=new gI(null!==(le=n.morph)&&void 0!==le?le:new jo(0,0)),d=new kI(null!==(ce=n.angle)&&void 0!==ce?ce:0),u=WL(n),p=new Ak(o,l,a,s,c,h,d,u.alpha,u.isMask),f=new OI(p.calpha,"f");return new VL(t,i,e,{gradientType:o,smooth:l,colors:a,steps:s,offset:c,morph:h,angle:d,...u},p,u.mode,f,u.isMask,r)}case"pattern":{var he,de,ue,pe,fe,me,ge,ve,ye,be,xe,we,_e,Se;let a=new ik(null!==(he=n.style)&&void 0!==he?he:0),s=new ik(null!==(de=n.projection)&&void 0!==de?de:0),o=new ik(null!==(ue=["x","y","z"].indexOf(n.axis))&&void 0!==ue?ue:0),l=new kI(null!==(pe=n.blending)&&void 0!==pe?pe:0),c=new gI(null!==(fe=n.offset)&&void 0!==fe?fe:new jo(0,0)),h=new bI(n.colorA),d=new bI(n.colorB),u=new gI(null!==(me=n.frequency)&&void 0!==me?me:new jo(10,10)),p=new kI(null!==(ge=n.size)&&void 0!==ge?ge:.5),f=new kI(null!==(ve=n.variation)&&void 0!==ve?ve:0),m=new kI(null!==(ye=n.smoothness)&&void 0!==ye?ye:.5),g=new kI(null!==(be=n.zigzag)&&void 0!==be?be:0),v=new kI(null!==(xe=n.rotation)&&void 0!==xe?xe:0),y=new gI(null!==(we=n.vertical)&&void 0!==we?we:new jo(0,1)),b=new gI(null!==(_e=n.horizontal)&&void 0!==_e?_e:new jo(0,1)),x=new ik(null!==(Se=n.sides)&&void 0!==Se?Se:6),w=WL(n),_=new Ik(a,s,o,l,c,h,d,u,p,f,m,g,v,y,b,x,w.alpha,w.isMask),S=new OI(_.calpha,"f");return new VL(t,i,e,{style:a,projection:s,axis:o,blending:l,offset:c,colorA:h,colorB:d,frequency:u,size:p,variation:f,smoothness:m,zigzag:g,rotation:v,vertical:y,horizontal:b,sides:x,...w},_,w.mode,S,w.isMask,r)}default:{let a=new tk(1,0,0,1),s=WL(n),o=new mk(a,s.alpha),l=new OI(o.calpha,"f");return new VL(t,i,e,{color:a,...s},o,s.mode,l,s.isMask,r)}}}(i,e,t,r,n)}(e,t,i,n)}updateByOp(e,t,i){let n=e;if(void 0===n.path[0]){if(0===n.type)return"type"in n.props||"category"in n.props||"visible"in n.props?(i.scene.markNeedsUpdateRendererDirty(),!0):function(e,t,i,n){let r=!1;for(let[a,s]of Object.entries(e)){if("bumpMap"===a||"roughnessMap"===a){r=!0;continue}if(!a||void 0===s)continue;if(qL(a,i,n,t)){"visible"===a&&"light"===i.type&&(r=!0);continue}i.visible=n.visible;let e=i.uniforms["f".concat(i.id,"_").concat(a)];if(e&&!(e instanceof ak))switch(r=r||NL(i,a,s),e.constructor){case tk:if("string"==typeof s){let i=t.getColor(s);i&&(e.value=i);break}{let t=s;e.value instanceof LL?e.value=new yI(t.r,t.g,t.b,t.a):e.setRGBA(t);break}case bI:if("string"==typeof s){let i=t.getColor(s);i&&(e.value=i);break}{let t=s;e.value instanceof LL?e.value=new yI(t.r,t.g,t.b,t.a):e.value.setRGBA(t.r,t.g,t.b,t.a);break}case gI:{let t=s;e.value.setX(t[0]),e.value.setY(t[1]);break}case vI:{let t=s;e.value.setX(t[0]),e.value.setY(t[1]),e.value.setZ(t[2]);break}case II:zL(s,t,i);break;case uk:e.value=s.map((e=>new dl(...e)));break;default:e.value=s}}return r}(n.props,i.shared,this,t)}else if("texture"===n.path[0])return!("texture"in t)&&!("video"in t)||zL(n.props,i.shared,this);return!1}dispose(){if(function(e){let t=e instanceof jL?e.type:e;return"texture"===t||"video"===t||"displace_map"===t||"matcap"===t}(this)){let e=this.uniforms["f".concat(this.id,"_texture")];if(!e)return!1;let t=e;t.image instanceof rL||t.image.deref()}}hasValueByKey(e){return void 0!==this.uniforms[e]}hasValue(e){return this.hasValueByKey("f".concat(this.id,"_").concat(e))}setValue(e,t){let i="f".concat(this.id,"_").concat(e);this.hasValueByKey(i)&&void 0!==t&&(this.uniforms[i].value=t)}getNode(e){let t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t]}getValue(e){let t="f".concat(this.id,"_").concat(e);if(this.hasValueByKey(t))return this.uniforms[t].value}getName(e){let t=/f\d+_(.*)/.exec(e);if(t&&t.length>1)return t[1];console.log("Layer.getName: error ".concat(e))}getNames(){let e=[];for(let t in this.uniforms){let i=this.getName(t);i&&e.push(i)}return e}},VL=class extends jL{constructor(e,t,i,n,r,a,s,o,l){super(e,t,i,n,l),this.params=n,this.color=r,this.mode=a,this.alpha=s,this.isMask=o}},GL=class extends jL{constructor(e,t,i,n,r,a){super(e,t,i,n,a),this.position=r}},HL=class extends jL{constructor(e,t,i,n,r,a){super(e,t,i,r,a),this.node=n}static createLigherLayer(e,t,i,n){let r,a,s=new kI(UL(i.alpha,n)),o=new ik(i.mode),l=new kI(i.bumpMapIntensity),c=new kI(UL(i.alphaOverride,n));if(i.visible)if("lambert"===i.category){var h,d;r=new Yk;let e=new tk(null!==(h=n.color(i.emissive))&&void 0!==h?h:0),t=new nk(null===(d=i.occlusion)||void 0===d||d);a={emissive:e,occlusion:t},r.emissive=e,r.occlusion=t}else if("toon"===i.category){var u,p;r=new Jk;let e=new kI(null!==(u=i.shininess)&&void 0!==u?u:30),t=new tk(null!==(p=n.color(i.specular))&&void 0!==p?p:1118481);a={shininess:e,specular:t},r.shininess=e,r.specular=t}else if("physical"===i.category){var f,m,g,v;r=new Zk;let e=new kI(null!==(f=i.roughness)&&void 0!==f?f:.3),t=new kI(null!==(m=i.metalness)&&void 0!==m?m:0),n=new kI(null!==(g=i.reflectivity)&&void 0!==g?g:.5),s=new nk(null===(v=i.occlusion)||void 0===v||v);a={roughness:e,metalness:t,reflectivity:n,occlusion:s},r.roughness=e,r.metalness=t,r.reflectivity=n,r.occlusion=s}else{var y,b,x;r=new Kk;let e=new kI(null!==(y=i.shininess)&&void 0!==y?y:30),t=new tk(void 0!==i.specular&&null!==(b=n.color(i.specular))&&void 0!==b?b:1118481),s=new nk(null===(x=i.occlusion)||void 0===x||x);a={shininess:e,specular:t,occlusion:s},r.shininess=e,r.specular=t,r.occlusion=s}else r=new Xk,a={};return r.alpha=new kI(1),r.shadingAlpha=s,r.shadingBlend=o,r.bumpMapIntensity=l,r.alphaOverride=c,a.alpha=r.shadingAlpha,a.mode=r.shadingBlend,a.bumpMapIntensity=r.bumpMapIntensity,a.alphaOverride=r.alphaOverride,new HL(e,t,i,r,a,n)}get category(){return this.node.category}};function WL(e){var t,i,n;return{alpha:new kI(null!==(t=e.alpha)&&void 0!==t?t:1),mode:new ik(null!==(i=e.mode)&&void 0!==i?i:0),isMask:new nk(null!==(n=e.isMask)&&void 0!==n&&n)}}function qL(e,t,i,n){if("displace"===i.type&&("intensity"===e||"visible"===e)){let e=t.uniforms["f".concat(t.id,"_intensity")];return e?(e.value=i.intensity*(i.visible?1:0),e):void 0}if("displace"!==i.type&&("alpha"===e||"visible"===e)){let r=t.uniforms["f".concat(t.id,"_alpha")];if(!r)return;if(r.value=UL(i.alpha,n)*(i.visible?1:0),"outline"===i.type&&"visible"===e){let e=t.uniforms["f".concat(t.id,"_compensation")];e&&(e.value=i.compensation&&i.visible)}return r}}function XL(e,t){let i=0,n=e.layers.find((e=>"light"===e.data.type));if(n){let e=n.data,i=Number(t.getVariable(e.alphaOverride));if(("string"==typeof e.alphaOverride?i/100:e.alphaOverride)<1)return!0}for(let a of e.layers){if("displace"!==a.data.type&&a.data.isMask)return!0;if("displace"!==a.data.type&&"alpha"in a.data&&"light"!==a.data.type&&"fresnel"!==a.data.type&&"texture"!==a.data.type&&"matcap"!==a.data.type&&"rainbow"!==a.data.type&&"outline"!==a.data.type&&"pattern"!==a.data.type){var r;let e=a.data.visible?a.data.alpha:0;if("string"==typeof e&&(e=Math.max(0,Math.min(1,Number(null!==(r=t.getVariable(e))&&void 0!==r?r:100)/100))),1===e&&"depth"===a.data.type||"gradient"===a.data.type){for(let t of a.data.colors)if(t[3]<1){e=t[3];break}}else if(1===e&&"noise"===a.data.type){let i=t.color(a.data.colorA).a,n=t.color(a.data.colorB).a,r=t.color(a.data.colorC).a,s=t.color(a.data.colorD).a,o=Math.min(i,Math.min(n,Math.min(r,s)));o<1&&(e=o)}i+=(1-i)*e}}return i<1}var YL=class extends uh{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},QL=class extends YL{constructor(e,t,i,n){super(),this.flatShading=e,this.side=t,this.wireframe=i,this.root=n}updateAfterBuild(){let e=this.root;this.lights=e.lights,this.vertexShader=e.vertexShader,this.fragmentShader=e.fragmentShader,this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.transparent=e.transparent,this.cacheKey=e.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(e,t){this.root.onBeforeCompile(e)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(e,t,i){return this.root.getFlavor(e,t,i)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(e){return this.root.getLayersOfType(e)}getLayerByUuid(e){return this.root.getLayerByUuid(e)}updateByOp(e,t,i){this.root.updateByOp(e,t,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},KL=class extends YL{constructor(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(),this.data=e,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],dI.startContext(this),this.reset0(e,t),dI.endContext(this)}get nodeMaterial(){return this}getFlavor(e,t,i){let n=i?6:(e?3:0)+t;if(0===n)return this;void 0===this.flavors&&(this.flavors=[]),n-=1;let r=this.flavors[n];return void 0===r&&(r=new QL(e,t,i,this),this.flavors[n]=r,r.flatShading=e,r.side=t,r.updateAfterBuild()),r}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){var e,t;return null!==(e=null===(t=this.lightLayer.getNode("occlusion"))||void 0===t?void 0:t.value)&&void 0!==e&&e}reset(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];dI.startContext(this),(this.data!==e||i)&&this.reset0(e,t),dI.endContext(this)}reset0(e,t){var i,n;this.data=e;let r=null!==(i=e.layers)&&void 0!==i?i:nC.defaultTwoLayerData("phong").layers;try{this.layers=r.map((e=>jL.create(this.layerIdGen++,e.id,e.data,t.shared)))}catch{this.layers=[]}this.layers.reverse(),this.name=null!==(n=e.name)&&void 0!==n?n:"Untitled Material",this.onUpdate(t.shared),this.transparent=XL(e,t.shared),this.saveVariableLocations(t)}onVariableUpdate(e,t,i){if("alphaOverride"===e[0])this.transparent=XL(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(t)/100,1)));else if("layer"===e[0]){let n=e[1],r=e[2];if(n&&r){let e=this.layers.find((e=>e.uuid===n));(null===e||void 0===e?void 0:e.hasValue(r))&&("alpha"===r?(this.transparent=XL(this.data,i.shared),e.setValue(r,Math.max(0,Math.min(Number(t)/100,1)))):e.setValue(r,t))}}}saveVariableLocations(e){if(!this.allowVariableSaves)return;let t=this.data.layers.find((e=>"light"===e.data.type));t&&e.shared.getVariable(t.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach((t=>{"alpha"in t.data&&"string"==typeof t.data.alpha&&e.shared.getVariable(t.data.alpha,["material",this.uuid,"layer",t.id,"alpha"])}))}getLayersOfType(e){return this.layers.filter((t=>t.type===e))}getLayerByUuid(e){return this.layers.find((t=>t.uuid===e))}onUpdate(e){this.lightLayer=this.layers.find((e=>e instanceof HL)),void 0===this.lightLayer&&(this.lightLayer=new HL(0,"",{...iC.defaultData("light","phong"),visible:!1},new Xk,{},e)),this.dispose();for(let t of this.flavors)t&&t.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let e=this.layers.find((e=>e instanceof HL));if(!e)return;let t=e.data,i=t.bumpMap,n=t.roughnessMap;e.node.bumpMap=void 0,e.node.roughnessMap=void 0;for(let r=0;r<this.layers.length;++r){let t=this.layers[r];t instanceof VL&&t.color instanceof bk&&(t.uuid===i&&(e.node.bumpMap=t.color),t.uuid===n&&(e.node.roughnessMap=t.color))}}updateByOp(e,t,i){if(dI.startContext(this),void 0!==t?this.data=t:t=this.data,this.transparent=XL(t,i.shared),"layers"===e.path[0]){let n=i.shared,r=e.path[1];if(void 0===r)i.scene.markNeedsUpdateRendererDirty(),this.reset0(t,i);else{0===e.type&&void 0!==e.props.occlusion&&i.scene.markNeedsUpdateRendererDirty();let a=this.layers.find((e=>e.uuid===r));if(a){let s,o=t.layers.data(r);0===e.type&&("alpha"in e.props||"alphaOverride"in e.props)&&(s="alpha"in e.props?{...e.props,alpha:UL(e.props.alpha,n,["material",this.uuid,"layer",r,"alpha"])}:{...e.props,alphaOverride:UL(e.props.alphaOverride,n,["material",this.uuid,"alphaOverride"])}),a.updateByOp({...e,...s?{props:s}:{},path:e.path.slice(2)},o,i)&&this.reset0(t,i)}}}else this.reset0(t,i);dI.endContext(this)}applyMasks(){for(let e=0;e<this.layers.length;++e){let t=this.layers[e];t instanceof VL?t.color.mask=void 0:t instanceof HL&&(t.node.mask=void 0)}for(let e=0;e<this.layers.length;++e){let t=this.layers[e];if(t instanceof VL&&t.isMask.value&&t.data.visible&&e>0){let i=e-1,n=this.layers[i];n instanceof HL?n.node.mask=new BI(t.color,t.alpha,BI.MUL):n instanceof VL&&(n.isMask.value||(n.color.mask=new BI(t.color,t.alpha,BI.MUL)))}}}blendColors(){let e=this.layers.findIndex((e=>e instanceof VL)),t=this.layers.findIndex((e=>e instanceof HL));if(-1!==e&&e<t){let i=this.layers[e].color;for(let n=e+1;n<t;++n){let e=this.layers[n];if(e instanceof VL){if(e.isMask.value)continue;i=new pk(i,e.color,e.alpha,e.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let e=new OI("outgoingLight","f"),t=this.layers.findIndex((e=>e instanceof HL));if(this.layers.length>t+1){for(let i=t+1;i<this.layers.length;++i){let t=this.layers[i];if(t instanceof VL){if(t.isMask.value)continue;e=new pk(e,t.color,t.alpha,t.mode)}}this.fragment.afterColor=e}else this.fragment.afterColor=void 0}blendPositions(){let e=this.layers.filter((e=>e instanceof GL));if(e.length>0){let t=e[0].position;for(let i=1;i<e.length;++i)e[i]&&(t=new BI(t,e[i].position,BI.ADD),t=new BI(t,new kI(.5).setReadonly(!0),BI.MUL));this.fragment.position=t}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(e){e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.extensionDerivatives=!0===this.extensions.derivatives,e.extensionFragDepth=!0===this.extensions.fragDepth,e.extensionDrawBuffers=!0===this.extensions.drawBuffers,e.extensionShaderTextureLOD=!0===this.extensions.shaderTextureLOD}clampUniformsForPreview(e,t){let i=(e,t,i)=>Math.min(Math.max(e,t),i);for(let n of this.layers)if("displace"===n.type){let r=i(n.uniforms["f".concat(n.id,"_intensity")].value,e,t);n.uniforms["f".concat(n.id,"_intensity")].value=r}}updateFrame(e){for(let t=0;t<this.updaters.length;++t)e.updateNode(this.updaters[t])}build(){let e=new ek;e.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,e.build(this.fragment,this.fragment),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms=e.uniforms,this.extensions=e.extensions,this.updaters=e.updaters;for(let t of this.flavors)t&&t.updateAfterBuild();return this}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose();for(let e of this.flavors)e&&e.dispose()}assetsLoaded(){for(let e of this.layers)if(e instanceof VL){let t=e.params.texture;if(t instanceof ok&&!t.image.loaded)return!1}return!0}};Object.defineProperties(YL.prototype,{properties:{get:function(){return this.fragment.properties}}});var ZL=class extends KL{constructor(e,t,i){super(e,t,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(t)}},JL=new Map;function $L(e){if("string"==typeof e)return e;let t=JL.get(e);return t||(t={url:URL.createObjectURL(new Blob([e]))},JL.set(e,t)),t.url}var eF,tF,iF,nF=new Promise((e=>{eF=e})),rF=!1;function aF(){if(!rF)return tF||(tF=async function(){await __webpack_require__.e(519).then(__webpack_require__.bind(__webpack_require__,5519)),eF(void 0!==window?window:global),rF=!0}())}function sF(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{if(!1===i.visible||void 0===i.events||!1===Array.isArray(i.events))return!0;let n=[];i.events.forEach((e=>{"dragDropActions"in e.data?(n.push(...e.data.dragDropActions.drag),n.push(...e.data.dragDropActions.drop)):"inActions"in e.data?(n.push(...e.data.inActions),n.push(...e.data.outActions)):"gameActions"in e.data?(n.push(...e.data.gameActions.idle),n.push(...e.data.gameActions.move),n.push(...e.data.gameActions.jump),n.push(...e.data.gameActions.run)):"breakpoints"in e.data?e.data.breakpoints.forEach((e=>{n.push(...e.data.actions)})):"actions"in e.data&&n.push(...e.data.actions),t=t||n.some((e=>"Audio"===e.data.type))}))})),t}nF.then((e=>iF=e));var oF,lF,cF=class{constructor(e){let t,{src:i,volume:n,delay:r,loop:a}=e;this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)},t="string"==typeof i?{src:i}:{src:$L(i),format:"wav"},this.sound=new iF.Howl(t),this.sound.on("end",this.onEnd),this.src=i,void 0!==n&&(this.volume=n),void 0!==r&&(this.delay=r),void 0!==a&&(this.loop=a)}get status(){return this._status}get volume(){return this._volume}set volume(e){this._volume=e,this.sound.volume(e)}get loop(){return this._loop}set loop(e){this._loop=e,this.loopsRemaining=e}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout((()=>{this.sound.play(),this.clearDelay()}),this.delay)}fade(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;e?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout((()=>{this.sound.fade(this._volume,0,t),this.clearFade()}),e)):this.sound.fade(this._volume,0,t)}on(e,t,i){this.sound.on(e,t,i)}off(e,t,i){this.sound.off(e,t,i)}play(){"playing"===this._status||this.sound.playing()||("paused"===this._status?(0===this.sound.seek()?this.replay():this.sound.play(),this._status="playing"):"stopped"===this._status&&(this.replay(),this._status="playing"))}pause(){"playing"===this._status&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},hF=class{constructor(){this.type="ShapePath",this.color=new rl,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new $p,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){var i;return null!==(i=this.currentPath)&&void 0!==i&&i.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){var r;return null!==(r=this.currentPath)&&void 0!==r&&r.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,r,a){var s;return null!==(s=this.currentPath)&&void 0!==s&&s.bezierCurveTo(e,t,i,n,r,a),this}splineThru(e){var t;return null!==(t=this.currentPath)&&void 0!==t&&t.splineThru(e),this}toShapes(){let e=0,t=1,i=2,n=3,r=4,a=5,s=6,o={loc:e,t:0};function l(t,n,r,a){let s=t.x,l=n.x,h=r.x,d=a.x,u=t.y,p=n.y,f=r.y,m=a.y,g=(d-h)*(u-f)-(m-f)*(s-h),v=(m-f)*(l-s)-(d-h)*(p-u),y=g/v,b=((l-s)*(u-f)-(p-u)*(s-h))/v;if(0===v&&0!==g||y<=0||y>=1||b<0||b>1)return null;if(0===g&&0===v){for(let h=0;h<2;h++){if(c(0===h?r:a,t,n),o.loc===e){let e=0===h?r:a;return{x:e.x,y:e.y,t:o.t}}if(o.loc===i){return{x:+(s+o.t*(l-s)).toPrecision(10),y:+(u+o.t*(p-u)).toPrecision(10),t:o.t}}}return null}for(let i=0;i<2;i++)if(c(0===i?r:a,t,n),o.loc===e){let e=0===i?r:a;return{x:e.x,y:e.y,t:o.t}}return{x:+(s+y*(l-s)).toPrecision(10),y:+(u+y*(p-u)).toPrecision(10),t:y}}function c(l,c,h){let d,u=h.x-c.x,p=h.y-c.y,f=l.x-c.x,m=l.y-c.y,g=u*m-f*p;return l.x===c.x&&l.y===c.y?(o.loc=e,void(o.t=0)):l.x===h.x&&l.y===h.y?(o.loc=t,void(o.t=1)):void(g<-Number.EPSILON?o.loc=n:g>Number.EPSILON?o.loc=r:u*f<0||p*m<0?o.loc=a:Math.sqrt(u*u+p*p)<Math.sqrt(f*f+m*m)?o.loc=s:(d=0!==u?f/u:m/p,o.loc=i,o.t=d))}function h(e,t,i){let n=new jo;t.getCenter(n);let r=[];return i.forEach((t=>{t.boundingBox.containsPoint(n)&&function(e,t){let i=[],n=[];for(let r=1;r<e.length;r++){let a=e[r-1],s=e[r];for(let e=1;e<t.length;e++){let r=l(a,s,t[e-1],t[e]);null!==r&&void 0===i.find((e=>e.t<=r.t+Number.EPSILON&&e.t>=r.t-Number.EPSILON))&&(i.push(r),n.push(new jo(r.x,r.y)))}}return n}(e,t.points).forEach((e=>{r.push({identifier:t.identifier,isCW:t.isCW,point:e})}))})),r.sort(((e,t)=>e.point.x-t.point.x)),r}let d=0,u=999999999,p=-999999999,f=[];this.subPaths.forEach((e=>{let t=e.getPoints(),i=-999999999,n=999999999,r=-999999999,a=999999999;for(let s=0;s<t.length;s++){let e=t[s];e.y>i&&(i=e.y),e.y<n&&(n=e.y),e.x>r&&(r=e.x),e.x<a&&(a=e.x)}p<=r&&(p=r+1),u>=a&&(u=a-1),t.length&&f.push({curves:e.curves,points:t,isCW:Of.isClockWise(t),identifier:d++,boundingBox:new eg(new jo(a,n),new jo(r,i))})}));let m=f.map((e=>{var t;return function(e,t,i,n,r){(null==r||""===r)&&(r="nonzero");let a=new jo;e.boundingBox.getCenter(a);let s=h([new jo(i,a.y),new jo(n,a.y)],e.boundingBox,t);s.sort(((e,t)=>e.point.x-t.point.x));let o=[],l=[];s.forEach((t=>{t.identifier===e.identifier?o.push(t):l.push(t)}));let c=o[0].point.x,d=[],u=0;for(;u<l.length&&l[u].point.x<c;)d.length>0&&d[d.length-1]===l[u].identifier?d.pop():d.push(l[u].identifier),u++;if(d.push(e.identifier),"evenodd"===r){let t=d.length%2===0,i=d[d.length-2];return{identifier:e.identifier,isHole:t,for:i}}if("nonzero"===r){let i=!0,n=null,r=null;for(let e=0;e<d.length;e++){let a=d[e];t[a]&&(i?(r=t[a].isCW,i=!1,n=a):r!==t[a].isCW&&(r=t[a].isCW,i=!0))}return{identifier:e.identifier,isHole:i,for:n}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}(e,f,u,p,null===(t=this.userData)||void 0===t?void 0:t.style.fillRule)})),g=[];return f.forEach((e=>{let t=m[e.identifier];if(t&&!t.isHole){let t=new sf;t.curves=e.curves,m.filter((t=>(null===t||void 0===t?void 0:t.isHole)&&t.for===e.identifier)).forEach((e=>{if(e){let i=f[e.identifier],n=new $p;n.curves=i.curves,t.holes.push(n)}})),g.push(t)}})),g}},dF=!1,uF=new Promise((e=>{oF=e})),pF=!1;function fF(){if(dF=!0,!pF)return lF||(lF=async function(){let e=await __webpack_require__.e(946).then(__webpack_require__.bind(__webpack_require__,8946));oF(e),pF=!0}(),lF)}var mF=new class{async load(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{},{load:n}=await uF;n(e,((e,n)=>{e||!n?i(null!==e&&void 0!==e?e:"Something went wrong"):t(n)}))}async parse(e){let{parse:t,Bidi:i}=await uF;try{let n=t(e),r=new i,a=e=>n.charToGlyphIndex(e.char);return r.registerModifier("glyphIndex",null,a),r.applyFeatures(n,n.defaultRenderOptions.features),{font:n,bidi:r}}catch(wE){console.error(wE)}}};async function gF(e){let t,i,n=!1;if(e.url?(t=await async function(e){return await(await fetch(e)).arrayBuffer()}(e.url),i=e.url,n=e.url.startsWith("/")):e.data&&(t=e.data.buffer.slice(e.data.byteOffset,e.data.byteOffset+e.data.byteLength)),t){if(!dF)return{font:void 0,url:i,intercepted:n,arr:t,bidi:null};{let e=await mF.parse(t);if(e)return{font:e.font,url:i,intercepted:n,arr:t,bidi:e.bidi}}}}function vF(e,t){return t.state.glyphIndex===e||t.state.fina===e||t.state.medi===e||t.state.init===e}var yF=class{constructor(e){var t;this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=null!==(t=e.isUserFont)&&void 0!==t&&t,this._loadingPromise=gF(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}update(e){var t;this._isLoaded=!1,this._isUserFont=null!==(t=e.isUserFont)&&void 0!==t&&t,this._loadingPromise=gF(e).then((e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)}))}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(e,t,i){if(!this._bidi)return[];let n=this._bidi;n.getTextGlyphs(t);let r=n.tokenizer.tokens,a=[],s=0,o=i.length===r.length;for(let l=0;l<i.length;l++){let n=i[l].index,c=String.fromCharCode(i[l].unicode),h=r[s];if(vF(n,h)||o)a.push({char:c,index:n,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),s++;else{let i=h.char,r="",o=[h.state.glyphIndex],l=[],d=!1;for(;!d;)s++,r=t.charAt(s),i+=r,o.push(e.charToGlyphIndex(r)),l=e.stringToGlyphs(i),1===l.length&&l[0].index===n&&(d=!0),s>t.length&&(d=!0);a.push({char:c,index:n,replacements:o,replacementChars:Array.from(i)}),s++}}return a}generateShapes(e,t){if(!this._isLoaded)return;let i,n=this.font,r=t.fontSize/this.unitsPerEm,a=t.fontSize*t.lineHeight,s=e.map((e=>this.getTextWidth(e,t))),o=t.width,l=this.getCharWidth("\n",t),c=1===t.horizontalAlign?l:0,h=this.computeSpaceWidthForLine(e,0,t),d=this.getLineInitialOffsetX(s[0],o,t.horizontalAlign,e[0],l),u=this.getLineInitialOffsetY(a,e.length,t.height,r,t.verticalAlign),p=[],f=e.map((e=>[])),m=e.map((e=>[]));for(let y=0;y<e.length;y++){let g=e[y],b={features:{liga:!0}},x=[];try{x=n.stringToGlyphs(g,b)}catch(v){console.warn(v)}d=this.getLineInitialOffsetX(s[y],o,t.horizontalAlign,g,l);let w=[];try{w=this.reverseLigaturesTable(n,g,x)}catch(v){console.warn(v)}h=this.computeSpaceWidthForLine(e,y,t);for(let e=0;e<x.length;e++){let a=x[e],s=0===a.index?"\n":a.unicode?String.fromCharCode(a.unicode):void 0,o=w[e],l=0,g=0;0===e&&2===t.horizontalAlign&&void 0!==a.leftSideBearing&&(g=-a.leftSideBearing*r),i&&(l=n.getKerningValue(a,i)*r),d+=g+l;let v=0;if("\n"===s)v=c;else if(" "===s)v=h;else{let e=this.createPath(a,r,d,u,t);e&&(v=e.offsetX-(l+g),p.push(e.path))}if(1===o.replacements.length)m[y].push([d,u]),f[y].push(v);else{let e=o.replacements.map((e=>{var t;return(null!==(t=n.glyphs.get(e).advanceWidth)&&void 0!==t?t:0)*r})),t=e.reduce(((e,t)=>e+t),0),i=e.map((e=>e/t)),a=d;for(let n=0;n<i.length;n++){let e=v*i[n];m[y].push([a,u]),f[y].push(e),a+=e}}d+=v,i=a}u-=a}let g=[];for(let y=0,b=p.length;y<b;y++)g.push(...p[y].toShapes());return{shapes:g,charWidths:f,lineWidths:s,charCoords:m}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.ascender)&&void 0!==e?e:0}get descender(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.descender)&&void 0!==e?e:0}get familyName(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.names.fontFamily)&&void 0!==e?e:""}get subfamilyName(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.names.fontSubfamily)&&void 0!==e?e:""}get unitsPerEm(){var e,t;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.unitsPerEm)&&void 0!==e?e:1}getLineInitialOffsetX(e,t,i,n,r){return(3===i||2===i)&&n.indexOf("\n")>=0&&(e-=r),3===i?.5*t-.5*e:2===i?t-e:0}getLineInitialOffsetY(e,t,i,n,r){let a=t*e,s=e-Math.abs(this.ascender-this.descender)*n,o=-this.ascender*n-s/2;return 3===r?-(i-a-o):2===r?-(.5*i-.5*a-o):o}createPath(e,t,i,n,r){var a;let s=e.getPath(i,-n,r.fontSize,{kerning:!1,letterSpacing:r.letterSpacing});if(!s)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+this.familyName+".");let o=new hF,l=(null!==(a=e.advanceWidth)&&void 0!==a?a:1)*t;if(e)for(let h of s.commands){var c;let e=null===(c=o.currentPath)||void 0===c?void 0:c.currentPoint;if(!e||"Z"===h.type||e.x!==h.x||-e.y!==h.y)switch(h.type){case"M":o.moveTo(h.x,-h.y);break;case"L":o.lineTo(h.x,-h.y);break;case"Q":o.quadraticCurveTo(h.x1,-h.y1,h.x,-h.y);break;case"C":o.bezierCurveTo(h.x1,-h.y1,h.x2,-h.y2,h.x,-h.y)}}return o.subPaths.forEach((e=>{let t=function(e){if(e.length){let t=e[0];if(t instanceof Xp)return t.v1;if(t instanceof Wp||t instanceof Qp)return t.v0}}(e.curves);void 0!==t&&e.currentPoint.distanceTo(t)>0&&e.lineTo(t.x,t.y)})),{offsetX:l+r.fontSize*r.letterSpacing,path:o}}getCharWidth(e,t){var i,n;return null!==(i=null===(n=this.font)||void 0===n?void 0:n.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))&&void 0!==i?i:0}getTextWidth(e,t){var i,n;return null!==(i=null===(n=this.font)||void 0===n?void 0:n.getAdvanceWidth(e,t.fontSize,{kerning:!0,letterSpacing:t.letterSpacing}))&&void 0!==i?i:0}computeSpaceWidthForLine(e,t,i){let n=this.getCharWidth(" ",i),r=e[t];if(r){let a=this.countSpaces(r.trimEnd());if(4===i.horizontalAlign&&t<e.length-1&&a){return(i.width-(this.getTextWidth(r,i)-a*n))/a}}return n}countSpaces(e){return(e.match(/ /g)||[]).length}};var bF=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(e){return this.objects.get(e)}get size(){return this.objects.size}get(e,t,i){let n=this.objects.get(e);return void 0===n?(n=this.createObject(e,t,i),this.objects.set(e,n)):n.isShared=!0,n}forceDelete(e){let t=this.objects.get(e);t&&(this.disposeObject(t),this.objects.delete(e))}mutateIfUnique(e,t){let i=this.objects.get(e);if(i&&!0!==i.isShared)return this.objects.delete(e),this.objects.set(t,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(e,t){t===this.objects.get(e)&&this.unreachable.delete(e)}endGc(){this.unreachable.forEach((e=>{this.disposeObject(this.objects.get(e)),this.objects.delete(e)})),this.unreachable.clear()}dispose(){this.objects.forEach((e=>{this.disposeObject(e)})),this.objects.clear()}},xF=class extends bF{constructor(e){super(),this.flatShading=e}disposeObject(e){e.dispose()}createObject(e,t,i){let n=SO(e,t,this.flatShading,i);return n.computeBoundingSphere(),n}},wF={markNeedsUpdateRendererDirty:()=>{}},_F=class extends iL{constructor(e){super(),this.shared=e}create(e){return new nL(e,this.shared)}},SF=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.data=e,this.geometryCache=new xF(!0),this.geometryCache2=new xF(!1),this.imageHolderCache=new _F(this),this.thisContext={scene:wF,shared:this},this.deletedMaterial=new ZL(nC.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new rL(wM.emptyImage,this),this.deletedVideo=new rL(XE.defaultVideo,this),this.materials={},this.images={},this.canvases={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.variables={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},t.images)for(let[i,n]of Object.entries(t.images))this.addImage(i,n);if(t.videos)for(let[i,n]of Object.entries(t.videos))this.addVideo(i,n);if(t.audios)for(let[i,n]of Object.entries(t.audios))this.addAudio(i,n);if(t.particles)for(let[i,n]of Object.entries(t.particles))this.addParticle(i,n);this.reset(e)}setRequestRender(e){this._requestRender=e}setEntityOpContext(e){this.entityOpContext=e}reset(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.resetLib(e.lib);for(let{id:i,data:n}of e.variables)this.addVariableHolder(i,n),t&&this.updateVariableHolder(i,n);for(let[i,n]of Object.entries(e.images))this.addImage(i,n);for(let[i,n]of Object.entries(e.videos))this.addVideo(i,n);for(let[i,n]of Object.entries(e.colors))this.addColor(i,n);for(let[i,n]of Object.entries(e.materials))this.addMaterial(i,n);for(let[i,n]of Object.entries(e.audios))this.addAudio(i,n);for(let[i,n]of Object.entries(e.particles))this.addParticle(i,n);for(let[i,n]of Object.entries(e.fonts))this.addFont(i,n)}addMaterial(e,t){if(this.materials[e]){let i=this.materials[e];i.reset(t,this.thisContext),i.dispose()}else{let i=new ZL(t,this.thisContext,e);this.materials[e]=i}}deleteMaterial(e){this.materials[e]&&(this.materials[e].nodeMaterialDispose(),delete this.materials[e])}getMaterial(e){return this.materials[e]}getMaterialOrDeletedPlaceholder(e){var t;return null!==(t=this.materials[e])&&void 0!==t?t:this.deletedMaterial}material(e){return"string"==typeof e?this.getMaterialOrDeletedPlaceholder(e):null==e?(console.error("material is undefined or null"),this.deletedMaterial):new KL(e,this.thisContext)}getMaterials(){return this.materials}addImage(e,t){return this.images[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[e].updateSrc(t.data),!0):(this.images[e]=new rL(t,this),!1)}deleteImage(e){let t=this.images[e];t&&(t.dispose(),delete this.images[e])}getDefaultImage(){return this.images.image_0}getImage(e){var t;return null!==(t=this.images[e])&&void 0!==t?t:this.deletedImage}image(e){return"string"==typeof e?this.getImage(e):this.imageHolderCache.load(e)}addCanvas(e,t){return this.canvases[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.canvases[e].updateSrc(t),!0):(this.canvases[e]=new rL(t,this),!1)}canvas(e){return this.canvases[e]}addVideo(e,t){return this.videos[e]?(this.videos[e].updateSrc(t.data),!0):(this.videos[e]=new rL(t,this),!1)}deleteVideo(e){let t=this.videos[e];t&&(t.dispose(),delete this.videos[e])}getVideo(e){var t;return null!==(t=this.videos[e])&&void 0!==t?t:this.deletedVideo}video(e){return"string"==typeof e?this.getVideo(e):this.imageHolderCache.load(e)}addColor(e,t){return this.colors[e]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in t?this.colors[e].setRGBA(t.r,t.g,t.b,t.a):this.colors[e].setRGBA(t.r,t.g,t.b,1),!0):(this.colors[e]=new LL(t.r,t.g,t.b,"a"in t?t.a:1),!1)}updateColor(e,t){if(this.colors[e]){var i,n,r,a;this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let s=this.colors[e];return this.colors[e].r=null!==(i=t.r)&&void 0!==i?i:s.r,this.colors[e].g=null!==(n=t.g)&&void 0!==n?n:s.g,this.colors[e].b=null!==(r=t.b)&&void 0!==r?r:s.b,this.colors[e].a=null!==(a=t.a)&&void 0!==a?a:s.a,!0}return!1}deleteColor(e){this.colors[e]&&delete this.colors[e]}getColor(e){return this.colors[e]}color(e){let t;if("string"!=typeof e)return new yI(e.r,e.g,e.b,"a"in e?e.a:1);{let i=this.getColor(e);i?t=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),t=new yI(0,0,0,0))}return t}addAudio(e,t){this.audios[e]=t}getAudio(e){let t=this.audios[e];if(t instanceof cF)return t;{let i=new cF({src:t.data});return this.audios[e]=i,i}}addParticle(e,t){this.particles[e]=t}getParticle(e){return this.particles[e]}deleteParticle(e){this.particles[e]&&delete this.particles[e]}deleteAudio(e){let t=this.audios[e];t&&(t instanceof cF&&t.dispose(),delete this.audios[e])}addFont(e,t){this.fonts[e]=new yF(t),this.fonts[e].loadingPromise.then((()=>this.requestRender()))}getFont(e){return this.fonts[e]}deleteFont(e){this.fonts[e]&&delete this.fonts[e]}dispose(){Object.keys(this.materials).forEach((e=>this.deleteMaterial(e))),this._requestRender=void 0,Object.values(this.audios).forEach((e=>{e instanceof cF&&e.dispose()})),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(e,t){return void 0===this.variables[e]?(this.variables[e]={value:t.value,locations:[]},"dynamicVariableType"in t&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0),!0):(this.variables[e].value=t.value,!1)}resetDynamicVariablePlayState(){for(let e in this.variables)void 0!==this.variables[e].dynamicVariablePlayState&&(this.variables[e].dynamicVariablePlayState="Playing",this.variables[e].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(e,t){this.updateVariable(e,t.value)}updateVariable(e,t){if(void 0===this.variables[e])return!1;this.variables[e].value=t;let i=t;for(;"string"==typeof i;)i=this.variables[i].value;let n=this.entityOpContext.scene;for(let r=this.variables[e].locations.length-1;r>=0;r--){let t=this.variables[e].locations[r];if("material"===t[0]){let e=t[1],r=i,a={scene:n,shared:this},s=t.slice(2);n.traverseMaterial((t=>{var i;let n=null!==(i=t.root)&&void 0!==i?i:t;n.uuid===e&&n.onVariableUpdate(s,r,a)}));let o=this.materials[e];o&&o.onVariableUpdate(s,r,a)}else{let a=n.find(t[0]);if(void 0===a){this.variables[e].locations.splice(r,1);continue}if("geometry"!==t[1]&&"particles"!==t[1]){for(let e=1;e<t.length-1;e++)a=a[t[e]];"rotation"===t[1]?a[t[t.length-1]]=i*Uo.DEG2RAD:a[t[t.length-1]]=i}if(a=n.find(t[0]),"ParticleEmitter"===a.type&&a.updateVariableState(i,t),AT.is(a))if("position"===t[1]||"rotation"===t[1]||"scale"===t[1])a.onVariableUpdate();else if("geometry"===t[1]){let e=a;a.component&&(e=a.component);let t=e.dataPatched;e.chooseGeoemtryCache(this).forceDelete(t.geometry),e.createGeometryDelayed(this.entityOpContext),e.onVariableUpdate(!0),e.instances.forEach((e=>{let t=e.dataPatched;e.chooseGeoemtryCache(this).forceDelete(t.geometry),e.createGeometryDelayed(this.entityOpContext),e.onVariableUpdate(!0)}))}}}return this.requestRender(),!0}deleteVariable(e){this.variables[e]&&delete this.variables[e]}getVariable(e,t){if(Array.isArray(e)){var i,n,r,a;if("mouse"===e[0])return null!==(i=null===(n=this.mouseProperty)||void 0===n?void 0:n[e[1]])&&void 0!==i?i:0;if("raycast"===e[0])return null!==(r=null===(a=this.raycastProperty)||void 0===a?void 0:a[e[1]])&&void 0!==r?r:0;let t=this.entityOpContext.scene.find(e[0]);if("width"===e[1]||"height"===e[1]||"depth"===e[1])return t.geometry.userData.parameters[e[1]];for(let i=1;i<e.length;i++)t=t[e[i]];return"rotation"===e[1]&&(t*=Uo.RAD2DEG),t}for(let o in this.variables){var s;if(void 0===t)break;let e=this.variables[o],i=null===(s=e.locations)||void 0===s?void 0:s.findIndex((e=>gS.equal(e,t)));void 0!==i&&-1!==i&&e.locations.splice(i,1)}if("string"==typeof e){let i=e,n=e;do{if(n=i,void 0===this.variables[i])break;let e=this.variables[i].value;t&&void 0!==this.variables[n]&&this.variables[n].locations.push(t),i=e}while("string"==typeof i);return i}return e}getVariables(){return this.variables}getDynamicVariablePlayState(e){var t;return null===(t=this.variables[e])||void 0===t?void 0:t.dynamicVariablePlayState}setDynamicVariablePlayState(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariablePlayState=t)}getDynamicVariableToggleIsForward(e){var t;return null===(t=this.variables[e])||void 0===t?void 0:t.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(e,t){void 0!==this.variables[e]&&(this.variables[e].dynamicVariableToggleIsForward=t)}resetLib(e){for(let[t,i]of Object.entries(e.images))this.addImage(t,i.asset);for(let[t,i]of Object.entries(e.audios))this.addAudio(t,i.asset);for(let[t,i]of Object.entries(e.particles))this.addParticle(t,i.asset);for(let[t,i]of Object.entries(e.colors))this.addColor(t,i.asset);for(let[t,i]of Object.entries(e.fonts))this.addFont(t,i.asset);for(let[t,i]of Object.entries(e.materials))this.addMaterial(t,i.asset);for(let[t,i]of Object.entries(e.videos))this.addVideo(t,i.asset);for(let[t,i]of Object.entries(e.variables))this.addVariableHolder(t,i.asset)}updateLibByOp(e,t){"images"===e.path[0]?1===e.path.length&&1===e.type?this.addImage(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?1===e.path.length&&1===e.type?this.addVideo(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?1===e.path.length&&1===e.type?this.addAudio(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"particles"===e.path[0]?1===e.path.length&&1===e.type?this.addParticle(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteParticle(e.id):"colors"===e.path[0]?1===e.path.length&&1===e.type?this.addColor(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteMaterial(e.id):"fonts"===e.path[0]?1===e.path.length&&1===e.type?this.addFont(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?1===e.path.length&&1===e.type?this.addVariableHolder(e.id,e.data.asset):1===e.path.length&&2===e.type&&this.deleteVariable(e.id):"components"===e.path[0]&&t.updateByLibOp(e,this)}updateByOp(e,t,i){this.data=t,"images"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.getImage(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addImage(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteImage(e.id):"videos"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.getVideo(e.path[1]).updateSrc(e.props.data):1===e.path.length&&1===e.type?this.addVideo(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteVideo(e.id):"audios"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.addAudio(e.path[1],t.audios[e.path[1]]):1===e.path.length&&1===e.type?this.addAudio(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteAudio(e.id):"particles"===e.path[0]?2===e.path.length&&0===e.type?e.props.data&&this.addParticle(e.path[1],t.particles[e.path[1]]):1===e.path.length&&1===e.type?this.addParticle(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteParticle(e.id):"colors"===e.path[0]?2===e.path.length&&0===e.type?this.updateColor(e.path[1],e.props):1===e.path.length&&1===e.type?this.addColor(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteColor(e.id):"materials"===e.path[0]?1===e.path.length&&1===e.type?this.addMaterial(e.id,e.data):1===e.path.length&&2===e.type?this.deleteMaterial(e.id):e.path.length>1&&this.getMaterial(e.path[1]).updateByOp(X_.drop(e,2),t.materials[e.path[1]],{shared:this,scene:i}):"fonts"===e.path[0]?2===e.path.length&&0===e.type?this.updateFont(e.path[1],e,i):1===e.path.length&&1===e.type?this.addFont(e.id,e.data):1===e.path.length&&2===e.type&&this.deleteFont(e.id):"variables"===e.path[0]?2===e.path.length&&0===e.type&&"value"in e.props?this.updateVariable(e.path[1],e.props.value):1===e.path.length&&4===e.type?this.addVariableHolder(e.id,e.data):1===e.path.length&&5===e.type&&this.deleteVariable(e.id):"lib"===e.path[0]&&this.updateLibByOp(X_.drop(e,1),i)}updateFont(e,t,i){if(t.props.url){let n=this.getFont(e),r={...this.data.fonts[e],url:t.props.url};n.update(r),n.loadingPromise.then((()=>this.requestRender())),i.updateFont(e,this)}}},AF=(new SF(JC.emptyData()),class extends cI{updateByPatchedOp(e,t,i){if(super.updateByPatchedOp(e,t,i),null!==function(e,t){let i=[];if(t.length!==e.length)return null;for(var n=0;n<e.length;){if("*"===t[n])i.push(e[n]);else if(e[n]!==t[n])return null;n+=1}return i}(e.path,["materials"])&&0===e.type&&Array.isArray(this.material))for(let[n,r]of Object.entries(e.props)){let e=i.shared.material(r);this.material[Number(n)]=e}else if(_S(e.path,["material"])&&this.material instanceof YL)"material"in t&&"string"!=typeof t.material&&this.material.updateByOp(X_.drop(e,1),t.material,i);else if(_S(e.path,["materials","*"])&&Array.isArray(this.material)){let n=e.path[1];if("materials"in t&&n<this.material.length){let r=t.materials[n];"string"!=typeof r&&this.material[n].updateByOp(X_.drop(e,2),r,i)}}}get needsAO(){return void 0!==this.material&&(Array.isArray(this.material)?this.material[0]:this.material).hasAO}updateState(e,t){var i,n;super.updateState(e,t),void 0!==e.castShadow&&(this.castShadow=e.castShadow),void 0!==e.receiveShadow&&(this.receiveShadow=e.receiveShadow);let r=this.dataPatched;if("NonParametricGeometry"!==(null===(i=e.geometry)||void 0===i?void 0:i.type)&&"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=t.shared.material(e.material).getFlavor(r.flatShading,r.side,r.wireframe),t.scene.markNeedsUpdateRendererDirty()),("NonParametricGeometry"===(null===(n=e.geometry)||void 0===n?void 0:n.type)||"materials"in e)&&("materials"in e&&void 0!==e.materials?(this.disposeMaterial(),this.material=e.materials.map((e=>t.shared.material(e).getFlavor(r.flatShading,r.side,r.wireframe))),t.scene.markNeedsUpdateRendererDirty()):"material"in e&&void 0!==e.material&&(this.disposeMaterial(),this.material=[t.shared.material(e.material).getFlavor(r.flatShading,r.side,r.wireframe)],t.scene.markNeedsUpdateRendererDirty())),void 0!==e.flatShading||void 0!==e.wireframe||void 0!==e.side)if(Array.isArray(this.material))for(let a=0;a<this.material.length;a++)this.material[a]=this.material[a].getFlavor(r.flatShading,r.side,r.wireframe);else this.material=this.material.getFlavor(r.flatShading,r.side,r.wireframe)}disposeMaterial(){this.material&&d_(this.material).forEach((e=>{e instanceof YL&&(e instanceof ZL||e.nodeMaterialDispose())}))}dispose(){this.disposeMaterial(),super.dispose()}}),EF=new gl,CF=new dl,MF=new dl,PF=new gl,TF=new ql,DF=class extends AF{constructor(e,t,i){super(e,t),this.data=t,this.isSkinnedMesh=!1,this.localGeometry=void 0,t.bindMode&&t.bindMatrix&&(this.bindMode=t.bindMode,this.bindMatrix=(new ql).fromArray(t.bindMatrix),this.bindMatrixInverse=new ql)}chooseGeoemtryCache(e){return e.geometryCache}markGeometryAsReachable(e){this.geometryCreateDeleyed instanceof Wc&&this.chooseGeoemtryCache(e).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(void 0!==this.localGeometry)return this.localGeometry;if(this.geometryCreateDeleyed instanceof SF){let e=this.geometryCreateDeleyed,t=this.chooseGeoemtryCache(e);this.geometryCreateDeleyed=t.get(this.dataPatched.geometry,e,this)}return this.geometryCreateDeleyed}set geometry(e){this.localGeometry=e}get is2DAndNoDepth(){let e=this.dataPatched.geometry;return hC.is2DParametricMesh(e.type)&&0===e.depth}get is2DType(){return hC.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return"NonParametricGeometry"===this.geometry.userData.type}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),_S(e.path,["geometry"])&&this.updateByPatchedOpGeometry(X_.drop(e,1),t.geometry,i)}removeInteractionGeometry(e){var t;null!==(t=this.localGeometry)&&void 0!==t&&t.dispose(),this.localGeometry=void 0}updateGeometryInteractions(e,t){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if("NonParametricGeometry"===i||"SubdivGeometry"===i){let i,n,r,a=e;if(void 0===this.localGeometry){let e={...this.data.geometry,...a};this.localGeometry=SO(e,t,this.data.flatShading,this)}a.scaleBaked?[i,n,r]=a.scaleBaked:({width:i,height:n,depth:r}=a);let s=this.localGeometry.userData;void 0!==s.sxPrev&&EO(this.localGeometry.attributes,i/s.sxPrev,n/s.syPrev,r/s.szPrev),s.sxPrev=i,s.syPrev=n,s.szPrev=r}else{var n;let i={...this.data.geometry,...e};null!==(n=this.localGeometry)&&void 0!==n&&n.dispose(),this.localGeometry=SO(i,t,this.data.flatShading,this)}}refreshAttachedCloners(e){for(let t of this.attachedSurfaceCloners)e.scene.addPendingUpdateCloner(t.object)}refreshAttachedPaths(e){for(let t of this.attachedPaths)e.scene.addPendingCommand((()=>t.updateShape()))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.refreshAttachedCloners(e),this.refreshAttachedPaths(e)}updateByPatchedOpGeometry(e,t,i){var n;let r=!1;0===e.type&&0===e.path.length&&Object.keys(e.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof OO&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,t)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(t,e.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||(null!==(n=i.scene)&&void 0!==n&&n.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(e,t){this.createGeometryDelayed(t)}updateState(e,t){void 0!==e.geometry&&this.updateGeometryOnStateUpdate(e.geometry,t),super.updateState(e,t)}updateGeometryGroupsIfNeeded(){var e,t;Array.isArray(this.material)&&0===this.geometry.groups.length&&this.geometry.addGroup(0,Math.max(null!==(e=null===(t=this.geometry.getIndex())||void 0===t?void 0:t.count)&&void 0!==e?e:0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(e,t){var i,n;let r=this.geometry.userData.parameters;this.is2DType?e.set(0,0,.5*r.depth):this.isNonParametric?(e.setScalar(0),this.geometry.boundingSphere&&e.copy(this.geometry.boundingSphere.center),t.set(r.width,r.height,null!==(i=r.depth)&&void 0!==i?i:0).multiplyScalar(.5)):e.setScalar(0),t.set(r.width,r.height,null!==(n=r.depth)&&void 0!==n?n:0).multiplyScalar(.5)}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(e,t){this.skeleton=e,this.isSkinnedMesh=!0,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(e){let t=new dl,i=this.geometry.attributes.skinWeight;for(let n=0,r=i.count;n<r;n++){t.fromBufferAttribute(i,n);let e=1/t.manhattanLength();e!==1/0?t.multiplyScalar(e):t.set(1,0,0,0),i.setXYZW(n,t.x,t.y,t.z,t.w)}}boneTransform(e,t){let i=this.skeleton;if(void 0===i)return;let n=this.geometry;CF.fromBufferAttribute(n.attributes.skinIndex,e),MF.fromBufferAttribute(n.attributes.skinWeight,e),EF.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let r=0;r<4;r++){let e=MF.getComponent(r);if(0!==e){let n=CF.getComponent(r);TF.multiplyMatrices(i.bones[n].matrixWorld,i.boneInverses[n]),t.addScaledVector(PF.copy(EF).applyMatrix4(TF),e)}}return t.applyMatrix4(this.bindMatrixInverse)}};function RF(e){if(Array.isArray(e.material)){for(let t of e.material)if(0===t.getLayersOfType("outline").length)return}else if(!(e.material instanceof YL)||0===e.material.getLayersOfType("outline").length)return;e instanceof DF&&e.is2DAndNoDepth?function(e){if(e.geometry.attributes.extrudeNormals||!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=new gl;for(let r=0;r<t.length;r+=3)n.set(t[r],t[r+1],t[r+2]).normalize(),i[r]=n.x,i[r+1]=n.y,i[r+2]=n.z;e.geometry.setAttribute("extrudeNormal",new Bc(i,3))}(e):function(e){if(e.geometry.attributes.extrudeNormal||!e.geometry.attributes.position||!e.geometry.attributes.normal)return;let t=new Map,i=e.geometry.attributes,n=i.position.array,r=i.normal.array,a=new Float32Array(n.length);for(let l=0;l<n.length;l+=3){var s;let e="".concat(n[l],"_").concat(n[l+1],"_").concat(n[l+2]),i=new gl(r[l],r[l+1],r[l+2]);t.has(e)?null===(s=t.get(e))||void 0===s||s.normals.push(i):t.set(e,{normals:[i],result:new gl})}t.forEach(((e,t)=>{for(let i of e.normals)e.result.add(i);e.result.divideScalar(e.normals.length)}));for(let l=0;l<n.length;l+=3){var o;let e="".concat(n[l],"_").concat(n[l+1],"_").concat(n[l+2]),i=null===(o=t.get(e))||void 0===o?void 0:o.result;i&&(a[l]=i.x,a[l+1]=i.y,a[l+2]=i.z)}e.geometry.setAttribute("extrudeNormal",new Bc(a,3))}(e)}function OF(e){if(!e.geometry.attributes.position)return;let t=e.geometry.attributes.position.array,i=new Float32Array(t.length),n=parseInt(e.uuid.replace(/\D/g,"")),r=[Uo.seededRandom(n),Uo.seededRandom(n+1e4),Uo.seededRandom(n+2e4)];for(let a=0;a<t.length;a++)i[a]=r[a%3];e.geometry.setAttribute("randomColor",new kc(i,3))}var IF=new bl,kF=new gl;function LF(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{"Mesh"===i.type&&"SubdivGeometry"===i.geometry.type&&(t=!0)})),t}var FF=class extends DF{constructor(e,t,i){super(e,t,i),this.data=t,this.hiddenMatrixOld=new ql,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(e){return this.dataPatched.flatShading?e.geometryCache:e.geometryCache2}get subdivPointerNew(){return void 0!==this.localGeometry?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return void 0!==this.localGeometry?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){var e;return null!==(e=this.data.geometry.phongAngle)&&void 0!==e?e:45}updateEntityBoxSize(e,t){var i;let n=this.geometry.userData.parameters;e.copy(this.originalGeometryNew.boundingSphere.center),t.set(n.width,n.height,null!==(i=n.depth)&&void 0!==i?i:0).multiplyScalar(.5)}createGeometryByControls(e){var t,i,n,r;if(!0===this.skipReactionUpdate)return;let a=null===(t=this.localGeometry)||void 0===t?void 0:t.uuid,{originalGeometry:s,subdividedGeometry:o,subdivPointer:l}=OO.build(e,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=l,void 0!==s&&(null!==(i=this.originalGeometry)&&void 0!==i&&i.dispose(),this.originalGeometry=s),void 0!==o&&(null!==(n=this.subdividedGeometry)&&void 0!==n&&n.dispose(),this.subdividedGeometry=null!==o&&void 0!==o?o:void 0),this.localGeometry=null!==(r=this.subdividedGeometry)&&void 0!==r?r:this.originalGeometry,RF(this),OF(this),this.calcBoundingBox(),a&&(this.localGeometry.uuid=a)}updateState(e,t){if(super.updateState(e,t),void 0!==e.flatShading){let i=this.material;this.material=Array.isArray(i)?i.map((e=>e.getFlavor(!1,e.side,e.wireframe))):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!e.flatShading,this.createGeometryDelayed(t)}}updateMesh(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];OO.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&OO.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,e&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){var e;this.originalGeometry.dispose(),this.originalGeometry=OO.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=OO.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=null!==(e=this.subdividedGeometry)&&void 0!==e?e:this.originalGeometry}raycast(e,t){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,cI.prototype.raycast.call(this,e,t),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let e=this.originalGeometry;null===e.boundingSphere&&(e.boundingSphere=new Bl,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=e.boundingSphere));let t=e.attributes.position,i=e.boundingSphere.center;IF.setFromBufferAttribute(t),IF.getCenter(i),e.boundingSphere.radius=i.distanceTo(IF.max),isNaN(e.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),IF.getSize(kF),this.hasNonUniformScale&&kF.divide(this.scale);let n={width:kF.x,height:kF.y,depth:kF.z};return this.geometry.userData.parameters=n,n}updateBoundingSphere(e){let t=this.originalGeometry;IF.min.set(e[0],e[2],e[4]),IF.max.set(e[1],e[3],e[5]),this.hasNonUniformScale&&(IF.min.applyMatrix4(this.shearScaleInv),IF.max.applyMatrix4(this.shearScaleInv)),null===t.boundingSphere&&(t.boundingSphere=new Bl);let i=t.boundingSphere.center;IF.getCenter(i),t.boundingSphere.radius=i.distanceTo(IF.max)}freeSubdivPointer(){var e,t;this.subdivPointer&&(OO.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,null!==(e=this.originalGeometry)&&void 0!==e&&e.dispose(),null===(t=this.subdividedGeometry)||void 0===t||t.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),this.localGeometry&&this.createGeometryByControls(t)}},BF={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},NF={polygon_center:0,edge:1,vertex:2},zF=(e,t)=>(i,n)=>t&&0!==i&&0!==e?e*n/100:0,UF=(e,t)=>{let i=Math.abs(t),n=-1*i;return(e- -1)*(i-n)/2+n};var jF=new gl,VF=new gl,GF=new gl,HF=new gl;function WF(e,t){let i=GF.fromArray(e),n=HF.fromArray(t);VF.copy(n).sub(i);let r=VF.length();return VF.normalize().multiplyScalar(.5*r),jF.copy(i).add(VF).toArray()}var qF=new Pc,XF=new gl,YF=new gl,QF=new gl;var KF=e=>.5*(1-Math.cos(e*Math.PI)),ZF=class{constructor(){this.perlin=new Array(4096)}noise(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==this.perlin){this.perlin=new Array(4096);for(let e=0;e<4096;e++)this.perlin[e]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),i<0&&(i=-i);let n,r,a,s,o,l=Math.floor(e),c=Math.floor(t),h=Math.floor(i),d=e-l,u=t-c,p=i-h,f=0,m=.5;for(let g=0;g<4;g++){let e=l+(c<<4)+(h<<8);n=KF(d),r=KF(u),a=this.perlin[4095&e],a+=n*(this.perlin[e+1&4095]-a),s=this.perlin[e+16&4095],s+=n*(this.perlin[e+16+1&4095]-s),a+=r*(s-a),e+=256,s=this.perlin[4095&e],s+=n*(this.perlin[e+1&4095]-s),o=this.perlin[e+16&4095],o+=n*(this.perlin[e+16+1&4095]-o),s+=r*(o-s),a+=KF(p)*(s-a),f+=a*m,m*=.5,l<<=1,d*=2,c<<=1,u*=2,h<<=1,p*=2,d>=1&&(l++,d--),u>=1&&(c++,u--),p>=1&&(h++,p--)}return f}noiseSeed(e){let t=(()=>{let e,t;return{setSeed(i){t=e=(null!==i&&void 0!==i?i:4294967296*Math.random())>>>0},getSeed:()=>e,rand:()=>(t=(1664525*t+1013904223)%4294967296,t/4294967296)}})();t.setSeed(e),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=t.rand()}},JF=new gl,$F=new ql,eB=new Wl;function tB(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{"Mesh"===i.type&&"TextGeometry"===i.geometry.type&&(t=!0)})),t}var iB,nB,rB,aB,sB=class extends DF{constructor(e,t,i){super(e,t,i),this.data=t}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){var e,t;let i=this.dataPatched;return null!==(e=null===(t=this.font)||void 0===t?void 0:t.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,i.geometry.height,this.fontScale,i.geometry.verticalAlign))&&void 0!==e?e:0}get fontScale(){let e=this.dataPatched;return this.font?e.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){var e,t;return(null!==(e=null===(t=this.font)||void 0===t?void 0:t.ascender)&&void 0!==e?e:1)*this.fontScale}get descender(){var e,t;return(null!==(e=null===(t=this.font)||void 0===t?void 0:t.descender)&&void 0!==e?e:1)*this.fontScale}get lineHeight(){let e=this.dataPatched;return e.geometry.fontSize*e.geometry.lineHeight}raycast(e,t){let{matrixWorld:i}=this;if(!isNaN(e.ray.origin.x)&&0!==this.scale.x&&0!==this.scale.y&&0!==this.scale.z&&($F.copy(i).invert(),eB.copy(e.ray).applyMatrix4($F),eB.intersectBox(this.singleBBox,JF))){let n=JF.applyMatrix4(i),r=e.ray.origin.distanceTo(n);t.push({distance:r,point:n.clone(),object:this})}}},oB=1e-4,lB=new gl,cB=new gl;bO.then((e=>{nB=[(iB=e).get_face_center,iB.get_edge_midpoint,iB.get_vertex_position],rB=[iB.get_face_normal,iB.get_edge_normal,iB.get_vertex_normal],aB=[iB.face_count,iB.edge_count,iB.vertex_count]}));var hB=new ql,dB=new ql,uB=new gl,pB=new gl,fB=new gl,mB=new gl,gB=new gl,vB=new gl,yB=new ZF,bB=class extends(ET(vc)){constructor(e,t){super(),this.parameters=t,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.object=e}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(e){if(null===this.parent)this.updateState(this.parameters,e);else for(let t of this.children)t instanceof MT&&t.expand()}invalidateTransform(e){this.matrixWorldNeedsUpdate=!0,this.traverse((t=>{t instanceof MT&&t.object===e&&(t.matrixWorldNeedsUpdate=!0)}))}onObjUpdateMatrix(){"toObject"!==this.parameters.type&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let e of this.children)e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD())}_updateCount(e){let t;if(t=void 0!==e?e:"grid"===this.parameters.type?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,"toObject"===this.parameters.type&&!this.parameters.toObject.object&&(t=0),"toObject"===this.parameters.type&&this.objectForSample){for(let t=0,i=this.children.length;t<i;++t)this.remove(this.children[0]);let e=this.children;if(e.length===t)return;if(e.length<t)for(let i=0,n=t-e.length;i<n;++i){let e=new MT(this.object);e.expand(),this.add(e)}else for(let i=0,n=e.length-t;i<n;++i)this.remove(e[i])}else{if(this.children.length===t)return;if(this.children.length<t)for(let e=0,i=t-this.children.length;e<i;++e){let e=new MT(this.object);e.expand(),this.add(e)}else for(let e=0,i=this.children.length-t;e<i;++e)this.remove(this.children[0])}}_updateRadial(e){var t;let i,n=e.radial,r=n.start*Uo.DEG2RAD,a=r-n.end*Uo.DEG2RAD,s=new ic(n.rotation[0],n.rotation[1],n.rotation[2]);switch(n.axis){case"z":i=new gl(0,0,1);break;case"y":i=new gl(0,1,0);break;default:i=new gl(1,0,0)}let o=null!==(t=e.randomnessObject)&&void 0!==t?t:IE.defaultData([1,1,1]).randomnessObject,l="perlin"===o.noiseType;yB.noiseSeed(o.seed);let c=mT((0,oT.default)(o.seed)),h=zF(o.strength,this.parameters.randomness);for(let[d,u]of this.children.entries()){let t=d*(o.freqScale/10)+o.movement,p=l?yB.noise(t):c(t,t),f=d+1;u.scale.x=n.scale[0]+h(f,UF(p,o.scale[0]))||oB,u.scale.y=n.scale[1]+h(f,UF(p,o.scale[1]))||oB,u.scale.z=n.scale[2]+h(f,UF(p,o.scale[2]))||oB,u.position.setScalar(0);let m=a/e.count*d-r;switch(n.axis){case"x":u.rotation.set(0,m,0);break;case"y":u.rotation.set(0,0,m);break;case"z":u.rotation.set(m,0,0)}u.translateOnAxis(i,n.radius),u.position.x+=n.position[0]+h(f,UF(p,o.position[0])),u.position.y+=n.position[1]+h(f,UF(p,o.position[1])),u.position.z+=n.position[2]+h(f,UF(p,o.position[2]));let g=h(f,UF(p,o.rotation[0])),v=h(f,UF(p,o.rotation[1])),y=h(f,UF(p,o.rotation[2]));!0===n.alignment?(u.rotation.x+=s.x+g,u.rotation.y+=s.y+v,u.rotation.z+=s.z+y):u.rotation.set(s.x+g,s.y+v,s.z+y)}}_updateLinear(e){var t;if("linear"!==e.type)throw new Error;let i=e.linear,n=new ic(i.rotation[0],i.rotation[1],i.rotation[2]),r=null!==(t=e.randomnessObject)&&void 0!==t?t:IE.defaultData([1,1,1]).randomnessObject,a="perlin"===r.noiseType;yB.noiseSeed(r.seed);let s=mT((0,oT.default)(r.seed)),o=zF(r.strength,this.parameters.randomness);for(let[l,c]of this.children.entries()){let e=l*(r.freqScale/10)+r.movement,t=a?yB.noise(e):s(e,e),h=l+1,d=o(h,UF(t,r.rotation[0])),u=o(h,UF(t,r.rotation[1])),p=o(h,UF(t,r.rotation[2]));c.scale.x=1+(i.scale[0]-1)*l+o(h,UF(t,r.scale[0]))||oB,c.scale.y=1+(i.scale[1]-1)*l+o(h,UF(t,r.scale[1]))||oB,c.scale.z=1+(i.scale[2]-1)*l+o(h,UF(t,r.scale[2]))||oB,c.rotation.x=n.x*l+d,c.rotation.y=n.y*l+u,c.rotation.z=n.z*l+p,c.position.x=i.position[0]*l+o(h,UF(t,r.position[0])),c.position.y=i.position[1]*l+o(h,UF(t,r.position[1])),c.position.z=i.position[2]*l+o(h,UF(t,r.position[2]))}}_updateGrid(e){var t;let i=0,n=e.grid,r=null!==(t=e.randomnessObject)&&void 0!==t?t:IE.defaultData([1,1,1]).randomnessObject,a=zF(r.strength,this.parameters.randomness),s="perlin"===r.noiseType;yB.noiseSeed(r.seed);let o=function(){let e=gT(arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random),t=new Float64Array(e).map((e=>fT[e%12*3])),i=new Float64Array(e).map((e=>fT[e%12*3+1])),n=new Float64Array(e).map((e=>fT[e%12*3+2]));return function(r,a,s){let o,l,c,h,d,u,p,f,m,g,v=(r+a+s)*hT,y=uT(r+v),b=uT(a+v),x=uT(s+v),w=(y+b+x)*dT,_=r-(y-w),S=a-(b-w),A=s-(x-w);_>=S?S>=A?(d=1,u=0,p=0,f=1,m=1,g=0):_>=A?(d=1,u=0,p=0,f=1,m=0,g=1):(d=0,u=0,p=1,f=1,m=0,g=1):S<A?(d=0,u=0,p=1,f=0,m=1,g=1):_<A?(d=0,u=1,p=0,f=0,m=1,g=1):(d=0,u=1,p=0,f=1,m=1,g=0);let E=_-d+dT,C=S-u+dT,M=A-p+dT,P=_-f+2*dT,T=S-m+2*dT,D=A-g+2*dT,R=_-1+.5,O=S-1+.5,I=A-1+.5,k=255&y,L=255&b,F=255&x,B=.6-_*_-S*S-A*A;if(B<0)o=0;else{let r=k+e[L+e[F]];B*=B,o=B*B*(t[r]*_+i[r]*S+n[r]*A)}let N=.6-E*E-C*C-M*M;if(N<0)l=0;else{let r=k+d+e[L+u+e[F+p]];N*=N,l=N*N*(t[r]*E+i[r]*C+n[r]*M)}let z=.6-P*P-T*T-D*D;if(z<0)c=0;else{let r=k+f+e[L+m+e[F+g]];z*=z,c=z*z*(t[r]*P+i[r]*T+n[r]*D)}let U=.6-R*R-O*O-I*I;if(U<0)h=0;else{let r=k+1+e[L+1+e[F+1]];U*=U,h=U*U*(t[r]*R+i[r]*O+n[r]*I)}return 32*(o+l+c+h)}}((0,oT.default)(r.seed));if(!0===n.useCenter){let e={x:n.count[0]%2===0?2:1,y:n.count[1]%2===0?2:1,z:n.count[2]%2===0?2:1},t=new gl(n.size[0]*(n.count[0]-e.x)*.5,n.size[1]*(n.count[1]-e.y)*.5,n.size[2]*(n.count[2]-e.z)*.5);for(let l=0;l<n.count[0];l++)for(let e=0;e<n.count[1];e++)for(let c=0;c<n.count[2];c++){let h=[(l+1)*(r.freqScale/10)+r.movement,(e+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement],d=s?yB.noise(...h):o(...h),u=this.children[i++];u.scale.x=1+a(i,UF(d,r.scale[0]))||oB,u.scale.y=1+a(i,UF(d,r.scale[1]))||oB,u.scale.z=1+a(i,UF(d,r.scale[2]))||oB;let p=a(i,UF(d,r.rotation[0])),f=a(i,UF(d,r.rotation[1])),m=a(i,UF(d,r.rotation[2]));u.rotation.set(p,f,m),u.position.x=n.size[0]*l-t.x+a(i,UF(d,r.position[0])),u.position.y=n.size[1]*e-t.y+a(i,UF(d,r.position[1])),u.position.z=n.size[2]*c-t.z+a(i,UF(d,r.position[2]))}}else for(let l=0;l<n.count[0];l++)for(let e=0;e<n.count[1];e++)for(let t=0;t<n.count[2];t++){let c=[(l+1)*(r.freqScale/10)+r.movement,(e+1)*(r.freqScale/10)+r.movement,(t+1)*(r.freqScale/10)+r.movement],h=s?yB.noise(...c):o(...c),d=this.children[i++];d.scale.x=1+a(i,UF(h,r.scale[0]))||oB,d.scale.y=1+a(i,UF(h,r.scale[1]))||oB,d.scale.z=1+a(i,UF(h,r.scale[2]))||oB;let u=a(i,UF(h,r.rotation[0])),p=a(i,UF(h,r.rotation[1])),f=a(i,UF(h,r.rotation[2]));d.rotation.set(u,p,f),d.position.x=n.size[0]*l+a(i,UF(h,r.position[0])),d.position.y=-n.size[1]*e+a(i,UF(h,r.position[1])),d.position.z=-n.size[2]*t+a(i,UF(h,r.position[2]))}}_updateToObject(e){var t,i;if("toObject"!==e.type)throw new Error;let{toObject:n}=e,r=new ic(n.rotation[0],n.rotation[1],n.rotation[2]),a=null!==(t=e.randomnessObject)&&void 0!==t?t:IE.defaultData([1,1,1]).randomnessObject,s="perlin"===a.noiseType;yB.noiseSeed(a.seed);let o=mT((0,oT.default)(a.seed)),l=zF(a.strength,this.parameters.randomness);if(!n.object){for(let[,e]of this.children.entries())e.position.set(0,0,0),e.scale.setScalar(1),e.rotation.set(0,0,0);return void(this.objectForSample=void 0)}if(!this.objectForSample)return;if(this.objectForSample instanceof sB){if(null===(i=this.objectForSample.font)||void 0===i||!i.isLoaded||void 0===this.objectForSample.geometry.attributes.position)return void(this._pendingMediaLoad=!0);this._pendingMediaLoad=!1}if(void 0===this.objectForSample.geometry&&this.objectForSample.isAncestorOf(this.object.uuid))return void console.warn('Oh no! The object "'.concat(this.object.name,'" (').concat(this.object.uuid,") seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead."));let c=this.getSubdivData(),h=[],d=e=>{let t=e.length;return[e.map((e=>e[0])).reduce(((e,t)=>e+t),0)/t,e.map((e=>e[1])).reduce(((e,t)=>e+t),0)/t,e.map((e=>e[2])).reduce(((e,t)=>e+t),0)/t]},u=e=>Math.round(1e6*e)/1e6;c.forEach((e=>{let t=c.filter((t=>u(e.pos[0])===u(t.pos[0])&&u(e.pos[1])===u(t.pos[1])&&u(e.pos[2])===u(t.pos[2])));t.length>1?h.push({pos:e.pos,norm:d(t.map((e=>e.norm)))}):h.push(e)}));let p=function(e){let t=[],i={};for(var n=0,r=e.length;n<r;n++){var a=JSON.stringify(e[n].pos.map((e=>Math.round(1e4*e)/1e4)));i[a]||(t.push(e[n]),i[a]=!0)}return t}(h);if(p.length>0){let e=Math.round(p.length*n.count/100);this._updateCount(e)}else{let e=this.objectForSample.geometry.getAttribute("position");if(!e||isNaN(e.count)||0===e.count)return void console.warn('Oh no! The object "'.concat(this.object.name,'" (').concat(this.object.uuid,') cannot be cloned on the surface of "').concat(this.objectForSample.name,'" (').concat(this.objectForSample.uuid,") because the latter does not have a valid geometry."))}this.objectForSample.updateMatrixWorld();let f=new bT(this.objectForSample).build(),m=BF[n.axis],g=this.children;f.setRandomGenerator((0,oT.default)(this.object.uuid+n.seed));for(let[v,y]of g.entries()){let e=v*(a.freqScale/10)+a.movement,t=s?yB.noise(e):o(e,e),i=v+1,c=l(i,UF(t,a.rotation[0])),h=l(i,UF(t,a.rotation[1])),d=l(i,UF(t,a.rotation[2]));"random"===n.spreadType?f.sample(fB,mB):(p.length&&(fB.fromArray(p[v].pos),mB.fromArray(p[v].norm)),this.objectForSample instanceof FF&&fB.applyMatrix4(hB.copy(this.objectForSample.matrixWorld).invert())),fB.applyMatrix4(this.object.hiddenMatrix.clone().invert()),y.position.copy(fB),uB.fromArray(m);let u="normal"===n.align?mB:this.object.getWorldDirection(vB),g=pB.fromArray(n.position);pB.x+=l(i,UF(t,a.position[0])),pB.y+=l(i,UF(t,a.position[1])),pB.z+=l(i,UF(t,a.position[2]));let b=Math.acos(u.dot(uB)),x=gB.crossVectors(uB,u).normalize(),w=dB.makeRotationAxis(x,b),_=u.clone().cross(this.object.up).normalize(),S=_.clone().cross(u).normalize(),A=(new ql).makeBasis(_,u,S),E=new gl(uB.y,uB.z,uB.x).normalize(),C=E.clone().cross(uB).normalize(),M=(new ql).makeBasis(E,uB,C).invert(),P=(new ql).multiplyMatrices(A,M);y.rotation.setFromRotationMatrix(P),g.applyMatrix4(w),y.position.add(g),y.rotation.x=y.rotation.x+r.x+c,y.rotation.y=y.rotation.y+r.y+h,y.rotation.z=y.rotation.z+r.z+d,y.scale.setScalar(1),y.scale.x=y.scale.x+n.scale[0]+l(i,UF(t,a.scale[0]))||oB,y.scale.y=y.scale.y+n.scale[1]+l(i,UF(t,a.scale[1]))||oB,y.scale.z=y.scale.z+n.scale[2]+l(i,UF(t,a.scale[2]))||oB,y.scale.multiply(this.object.scale),y.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let e=this.parameters.toObject.spreadType;if("random"===e)return[];if(this.objectForSample instanceof FF){let t=this.objectForSample,i=NF[e],n=aB[i],r=nB[i],a=rB[i],s=[],o=n(t.subdivPointerNew);for(let e=0;e<=o-1;e++){let i=r(t.subdivPointerNew,e),n=a(t.subdivPointerNew,e);lB.fromArray(i).applyMatrix4(t.matrixWorld),cB.fromArray(n),s.push({pos:lB.toArray(),norm:cB.toArray()})}return s}return(this.objectForSample.geometry.index?function(e){let t=[];for(let i=0;i<=e.index.count;i++)if(XF.fromArray(e.index.array,3*i),qF.setFromAttributeAndIndices(e.attributes.position,XF.x,XF.y,XF.z),qF.getNormal(YF),qF.getMidpoint(QF),!(isNaN(QF.x)||isNaN(QF.y)||isNaN(QF.z))){let{a:e,b:i,c:n}=qF,r=e.toArray(),a=i.toArray(),s=n.toArray(),o=e.distanceTo(i),l=i.distanceTo(n),c=n.distanceTo(e),h=WF(r,a),d=WF(a,s),u=WF(s,r),p=[o,l,c],f=Math.max(...p),m=p.filter((e=>Math.round(e)===Math.round(f))).length>1,g=[],v=qF.getMidpoint(QF).toArray();f===o&&!m&&(g=[d,u,u],v=h),f===l&&!m&&(g=[h,u,u],v=d),f===c&&!m&&(g=[h,d,d],v=u),m&&(g=[h,d,u]),t.push({vertices:[r,a,s],faceCenters:g,midpoint:v,norm:qF.getNormal(YF).toArray()})}return t}(this.objectForSample.geometry):function(e){let t=[],{position:i}=e.attributes;for(let n=0;n<i.count;n++){qF.setFromAttributeAndIndices(i,3*n,3*n+1,3*n+2),qF.getNormal(YF),qF.getMidpoint(QF);let e=qF.a.toArray(),r=qF.b.toArray(),a=qF.c.toArray();t.push({vertices:[e,r,a],faceCenters:[WF(e,r),WF(r,a),WF(a,e)],midpoint:QF.toArray(),norm:YF.toArray()})}return t}(this.objectForSample.geometry)).map(((t,i)=>"polygon_center"===e?{pos:t.midpoint,norm:t.norm}:"vertex"===e?[{pos:t.vertices[0],norm:t.norm},{pos:t.vertices[1],norm:t.norm},{pos:t.vertices[2],norm:t.norm}]:"edge"===e?[{pos:t.faceCenters[0],norm:t.norm},{pos:t.faceCenters[1],norm:t.norm},{pos:t.faceCenters[2],norm:t.norm}]:[])).flat()}updateState(e,t){var i;if(this.parameters=gw(e),"toObject"!==this.parameters.type)(null===this.parent||this.parent!==this.object)&&(this.removeFromParent(),null!==(i=this.object.parent)&&void 0!==i&&i.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(null===this.parent||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let e=t.find(this.parameters.toObject.object);this.objectForSample=e instanceof cI?e:void 0,this.matrix=new ql,this.hiddenMatrix=new ql,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,e&&e.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},xB=e=>{var t;return(t=class extends e{}).geometryHelper=new oh(30,30,30),t},wB=new Wl,_B=new Bl,SB=new ql,AB=function(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=t,s=e.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),_B.copy(a.boundingSphere),_B.applyMatrix4(s),!1===i.ray.intersectsSphere(_B)||(SB.copy(s).invert(),wB.copy(i.ray).applyMatrix4(SB),null!==a.boundingBox&&!1===wB.intersectsBox(a.boundingBox)))return;let o,l,c,h,d,u,p=a.index,f=a.attributes.position,m=a.drawRange;if(!1===r){for(d=Math.max(0,m.start),u=Math.min(p.count,m.start+m.count);d<u;d+=3)if(l=p.getX(d),c=p.getX(d+1),h=p.getX(d+2),o=g(e,i,wB,f,l,c,h),o)return o.faceIndex=Math.floor(d/3),void n.push(o)}else{let t=a.attributes.position,r=new gl,s=new gl,o=new gl,l=new gl,c=2,h=1/((e.scale.x+e.scale.y+e.scale.z)/3),d=h*h;for(let a=Math.max(0,m.start),u=Math.min(t.count,m.start+m.count)-1;a<u;a+=c){if(r.fromBufferAttribute(t,a),s.fromBufferAttribute(t,a+1),wB.distanceSqToSegment(r,s,l,o)>d)continue;l.applyMatrix4(e.matrixWorld);let c=i.ray.origin.distanceTo(l);c<i.near||c>i.far||n.push({distance:c,point:o.clone().applyMatrix4(e.matrixWorld),object:e})}}function g(e,t,i,n,r,a,s){let o=new gl,l=new gl,c=new gl,h=new gl,d=new gl;if(o.fromBufferAttribute(n,r),l.fromBufferAttribute(n,a),c.fromBufferAttribute(n,s),null===i.intersectTriangle(o,l,c,!1,h))return null;d.copy(h),d.applyMatrix4(e.matrixWorld);let u=t.ray.origin.distanceTo(d);return u<t.near||u>t.far?null:{faceIndex:1,distance:u,point:d.clone(),object:e}}},EB=new gl,CB=new ph,MB=class extends Op{constructor(e){let t=new Wc,i=new Sp({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],a={},s=new rl(15711266),o=new rl(15711266),l=new rl(2857471);function c(e,t,i){h(e,i),h(t,i)}function h(e,t){n.push(0,0,0),r.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(n.length/3-1)}c("n1","n2",s),c("n2","n4",s),c("n4","n3",s),c("n3","n1",s),c("f1","f2",s),c("f2","f4",s),c("f4","f3",s),c("f3","f1",s),c("n1","f1",s),c("n2","f2",s),c("n3","f3",s),c("n4","f4",s),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l),t.setAttribute("position",new Bc(n,3)),t.setAttribute("color",new Bc(r,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){let e=this.geometry,t=this.pointMap;CB.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=.8;PB("n1",t,e,CB,-1,-1,i),PB("n2",t,e,CB,1,-1,i),PB("n3",t,e,CB,-1,1,i),PB("n4",t,e,CB,1,1,i);let n=i;PB("f1",t,e,CB,-1,-1,n),PB("f2",t,e,CB,1,-1,n),PB("f3",t,e,CB,-1,1,n),PB("f4",t,e,CB,1,1,n);let r=n;PB("u1",t,e,CB,.35,1.1,r),PB("u2",t,e,CB,-.35,1.1,r),PB("u3",t,e,CB,0,1.55,r),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function PB(e,t,i,n,r,a,s){EB.set(r,a,s).unproject(n);let o=t[e];if(void 0!==o){let e=i.getAttribute("position");for(let t=0,i=o.length;t<i;t++)e.setXYZ(o[t],EB.x,EB.y,EB.z)}}var TB,DB=class extends(xB(MB)){constructor(e){super(e),this.object=e,this.object=e,this.name="CombinedCameraHelper: ".concat(e.uuid)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.updateTarget()}updateTarget(){let e=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(e)}raycast(e,t){AB(this.object,this.geometry,e,t,!0)}};(e=>{e.is=e=>"objectHelper"in e})(TB||(TB={}));var RB=(e,t)=>class extends(XT(e)){constructor(){super(...arguments),this.objectHelper=new t(this),this.gizmos={}}get geometryHelper(){return t.geometryHelper}raycast(e,t){this.objectHelper.raycast(e,t)}showGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof mg&&(t.visible=!0)}}updateEntityBoxSize(e,t){this.objectHelper.visible&&this.geometryHelper instanceof oh?(e.setScalar(0),t.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(e,t)}hideGizmos(){for(let e in this.gizmos){let t=this.gizmos[e];t instanceof mg&&(t.visible=!1)}}},OB=new gl,IB=new gl,kB=new ml,LB=new gl,FB=new gl,BB=new gl,NB=class extends(RB(ph,DB)){constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{...OC.defaultData,name:""};super(),this._cameraType="OrthographicCamera",this.targetOffset=OE.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(e,t),this.previousProjectionMatrix=new ql,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,n=this.height;this.orthoCamera=new zh(-.5*i,.5*i,.5*n,-.5*n,-5e4,1e4),this.perspCamera=new fh(45,i/n,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return"PerspectiveCamera"===this.cameraType}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(e){this.perspCamera.fov=e}get fov(){return this.perspCamera.fov}setNear(e,t){"PerspectiveCamera"===e?this.perspCamera.near=t:this.orthoCamera.near=t}setZoom(e,t){t>=0&&("PerspectiveCamera"===e?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}set cameraType(e){"PerspectiveCamera"===e?this.toPerspective():"OrthographicCamera"===e&&this.toOrthographic()}get near(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.near:this.orthoCamera.near}set near(e){"PerspectiveCamera"===this._cameraType?this.perspCamera.near=e:this.orthoCamera.near=e}get zoom(){return"PerspectiveCamera"===this._cameraType?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(e){e>=0&&("PerspectiveCamera"===this._cameraType?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}lookAt(e,t,i){"number"==typeof e&&(e=new gl(e,t,i)),super.lookAt(e),this.getWorldPosition(OB),this.targetOffset=OB.distanceTo(e)}getTarget(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new gl;return this.getWorldDirection(IB),this.getWorldPosition(OB),IB.multiplyScalar(this.targetOffset),e.copy(OB).add(IB),e}getDistanceToTarget(){let e=this.getTarget();return this.getWorldPosition(OB),OB.distanceTo(e)}updateUp(){this.getWorldQuaternion(kB),LB.set(0,0,1).applyQuaternion(kB),FB.copy(vc.DEFAULT_UP),this.isUpVectorFlipped&&FB.negate(),FB.applyQuaternion(kB),BB.copy(vc.DEFAULT_UP).projectOnPlane(LB),this.angleOffsetFromUp=BB.angleTo(FB),this.angleOffsetFromUp*=BB.cross(FB).dot(LB)>=0?1:-1}updateTransformState(e,t){let i=super.updateTransformState(e,t);return void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(e){let t=e.getWorldPosition(new gl),i=e.getWorldDirection(new gl).multiplyScalar(this.targetOffset);return{position:t.clone().add(i),target:t}}getViewToTarget(e){let t=this.getWorldDirection(new gl).multiplyScalar(this.targetOffset);return{position:e.clone().sub(t),target:e}}getViewToObject(e){let t=new gl;e.getWorldPosition(t);return this.getViewToTarget(t)}setViewplaneSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.aspect=e/t,i){let i=e>t?this.aspect:1,n=e>t?1:this.aspect;this.left=-395*i,this.right=395*i,this.top=1/n*395,this.bottom=1/n*-395}else this.left=.5*-e,this.right=.5*e,this.top=.5*t,this.bottom=.5*-t;this.updateProjectionMatrix()}copyViewPlaneSize(e){this.aspect=e.aspect,this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(e){this.perspCamera.setFocalLength(e),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(e,t,i,n,r,a){"PerspectiveCamera"===this._cameraType?this.perspCamera.setViewOffset(e,t,i,n,r,a):this.orthoCamera.setViewOffset(e,t,i,n,r,a)}clearViewOffset(){"PerspectiveCamera"===this._cameraType?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){"PerspectiveCamera"===this._cameraType?this.toPerspective():"OrthographicCamera"===this._cameraType&&this.toOrthographic()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(e,t){return super.copy(e,t),this.parent=e.parent,this.orthoCamera.copy(e.orthoCamera),this.perspCamera.copy(e.perspCamera),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.far=e.far,this.view=null===e.view?null:Object.assign({},e.view),this._cameraType=e._cameraType,this.aspect=e.aspect,this.fov=e.fov,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.targetOffset=e.targetOffset,this.updateProjectionMatrix(),this}toCameraState(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Kw(t,e)}updateCameraSubtype(e,t){let i="perspective"===e?"PerspectiveCamera":"OrthographicCamera";void 0!==t.zoom&&this.setZoom(i,t.zoom),void 0!==t.near&&this.setNear(i,t.near),void 0!==t.fov&&"PerspectiveCamera"===i&&(this.fov=t.fov)}updateState(e,t){this.updateCameraState(e,t)}updateCameraState(e,t){this.updateState_Entity(e,t),void 0!==e.far&&(this.far=e.far),void 0!==e.orthographic&&this.updateCameraSubtype("orthographic",e.orthographic),void 0!==e.perspective&&this.updateCameraSubtype("perspective",e.perspective),void 0!==e.type&&(this.cameraType=e.type),void 0!==e.up&&this.up.fromArray(e.up),void 0!==e.targetOffset&&(this.targetOffset=e.targetOffset),void 0!==e.isUpVectorFlipped&&(this.isUpVectorFlipped=e.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&0===e.type&&this.updateCameraSubtype(e.path[0],e.props)}toState(e){return{...super.toState(e),...this.toCameraState(e),type:this.cameraType}}},zB=new ql,UB=new ql;function jB(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{var n;"BooleanGeometry"===(null===(n=i.geometry)||void 0===n?void 0:n.type)&&(t=!0)})),t}var VB,GB=class extends AF{constructor(e,t,i){super(e,t),this.data=t,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new Wc,this.onAfterRender=(e,t,i,n,r,a)=>{super.onAfterRender(e,t,i,n,r,a),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){var e;return null!==(e=this.data.geometry.phongAngle)&&void 0!==e?e:45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),1===e.path.length&&"geometry"===e.path[0]&&0===e.type&&void 0!==e.props.operation&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(-1!==this.booleanMeshSetAddress&&!e)return;for(let a=0;a<this.children.length;a++){let i=this.children[a];i instanceof GB&&!0===i.dataPatched.visible&&i.recomputeBoolean(!0===e,t)}this.meshSetAddresses=[];for(let a=0;a<this.children.length;a++){var i;let r=this.children[a];if(r instanceof cI&&!0===r.dataPatched.visible&&(null===(i=r.geometry.attributes.position)||void 0===i?void 0:i.count)>0&&r.geometry.drawRange.count>0&&0!==r.booleanMeshSetAddress){zB.multiplyMatrices(r.hiddenMatrix,r.matrix);try{if(-1===r.booleanMeshSetAddress){var n;if((null!==(n=r.geometry.index)&&void 0!==n?n:r.geometry.getAttribute("position")).count/3<15e5&&(r.booleanMeshSetAddress=UO.getMeshSet(r.geometry,!0===e,t)),-1===r.booleanMeshSetAddress)return;UO.transformMeshSet(r.booleanMeshSetAddress,zB),r.booleanMatrixInvOld.copy(zB).invert(),r.booleanWasTransformed=!1}else r instanceof GB&&!0===r.needsTransformForDownstream?(UO.transformMeshSet(r.booleanMeshSetAddress,zB),r.needsTransformForDownstream=!1):!0===r.booleanWasTransformed&&(UO.transformMeshSet(r.booleanMeshSetAddress,UB.multiplyMatrices(zB,r.booleanMatrixInvOld)),r.booleanMatrixInvOld.copy(zB).invert(),r.booleanWasTransformed=!1)}catch(vE){console.error(vE),r.booleanMeshSetAddress=0,r.geometry.userData.booleanOperationDidFail=!0;continue}!1===UO.hasOpenEdges(r.booleanMeshSetAddress)||a===this.children.length-1&&2===this.booleanOp?(this.meshSetAddresses.push(r.booleanMeshSetAddress),r.geometry.userData.booleanOperationDidFail=!1):r.geometry.userData.booleanOperationDidFail="openEdges"}}if(0===this.meshSetAddresses.length)return this.geometry.setAttribute("position",new Bc([],0)),void this.geometry.setDrawRange(0,0);if(!0===e)return UO.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let r=this.geometry;r.dispose(),this.geometry=new Wc,this.geometry.userData=r.userData,this.geometry.boundingSphere=r.boundingSphere;try{this.booleanMeshSetAddress=UO.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(DE){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(DE)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,RF(this),OF(this)}dispose(){super.dispose(),this.geometry.dispose()}};(e=>{e.is=function(e){return AT.is(e)&&e instanceof fm}})(VB||(VB={}));var HB=(e,t)=>class extends(RB(e,t)){updateState_Light(e,t){this.updateState_Entity(e,t),void 0!==e.color&&(this.color=t.shared.color(e.color)),void 0!==e.intensity&&(this.intensity=e.intensity),void 0!==e.depth&&(this.shadow.camera.far=e.depth,this.shadow.needsUpdate=!0),void 0!==e.shadows&&(this.castShadow=e.shadows)}},WB=e=>e instanceof cI,qB=e=>null!==e&&e instanceof GB,XB=e=>TB.is(e),YB=class extends(xB(gg)){constructor(e){super(arguments.length>1&&void 0!==arguments[1]?arguments[1]:15),this.object=e,this.object.updateMatrixWorld(),this.name="EmptyObjectHelper: ".concat(e.uuid),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(e,t){AB(this.object,YB.geometryHelper,e,t)}update(){}},QB=class extends(RB(Ju,YB)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t),"buffer"in e&&1===Object.keys(e).length&&t.scene.reloadSplats()}},KB=class extends(RB(Ju,YB)){constructor(e,t,i){super(),this.super_Entity(e,t),this.context=i,this.objectHelper.update()}updateState(e,t){this.updateState_Entity(e,t)}},ZB=0,JB=1,$B="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",eN=class extends uh{constructor(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super({name:"BokehMaterial",defines:{PASS:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"2":"1"},uniforms:{kernel64:new Ym(null),kernel16:new Ym(null),inputBuffer:new Ym(null),cocBuffer:new Ym(null),texelSize:new Ym(new jo),scale:new Ym(1)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){\n#ifdef FOREGROUND\nvec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;\n#else\nfloat CoC=texture2D(cocBuffer,vUv).g*scale;\n#endif\nif(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{\n#ifdef FOREGROUND\nvec2 step=texelSize*max(CoC,CoCNearFar.g*scale);\n#else\nvec2 step=texelSize*CoC;\n#endif\nvec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}",vertexShader:$B}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set cocBuffer(e){this.uniforms.cocBuffer.value=e}setCoCBuffer(e){this.uniforms.cocBuffer.value=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(e){return this.uniforms.scale.value=e}setScale(e){this.uniforms.scale.value=e}generateKernel(){let e=new Float32Array(128),t=new Float32Array(32),i=0,n=0;for(let s=0;s<80;++s){let r=2.39996323*s,a=Math.sqrt(s)/Math.sqrt(80),o=a*Math.cos(r),l=a*Math.sin(r);s%5===0?(t[n++]=o,t[n++]=l):(e[i++]=o,e[i++]=l)}let r=[],a=[];for(let s=0;s<128;)r.push(new dl(e[s++],e[s++],e[s++],e[s++]));for(let s=0;s<32;)a.push(new dl(t[s++],t[s++],t[s++],t[s++]));this.uniforms.kernel64.value=r,this.uniforms.kernel16.value=a}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t)}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}};function tN(e,t,i){return e*(t-i)-t}function iN(e,t,i){return Math.min(Math.max((e+t)/(t-i),0),1)}var nN=class extends uh{constructor(e){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Ym(null),focusDistance:new Ym(0),focusRange:new Ym(0),cameraNear:new Ym(.3),cameraFar:new Ym(1e3)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <packing>\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}void main(){float depth=readDepth(vUv);\n#ifdef PERSPECTIVE_CAMERA\nfloat viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);\n#else\nfloat linearDepth=depth;\n#endif\nfloat signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}",vertexShader:$B}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(e)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:go;this.depthBuffer=e,this.depthPacking=t}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(e){this.uniforms.focusDistance.value=e}get worldFocusDistance(){return-tN(this.focusDistance,this.near,this.far)}set worldFocusDistance(e){this.focusDistance=iN(-e,this.near,this.far)}getFocusDistance(e){this.uniforms.focusDistance.value=e}setFocusDistance(e){this.uniforms.focusDistance.value=e}get focalLength(){return this.focusRange}set focalLength(e){this.focusRange=e}get focusRange(){return this.uniforms.focusRange.value}set focusRange(e){this.uniforms.focusRange.value=e}get worldFocusRange(){return-tN(this.focusRange,this.near,this.far)}set worldFocusRange(e){this.focusRange=iN(-e,this.near,this.far)}getFocalLength(e){return this.focusRange}setFocalLength(e){this.focusRange=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof fh?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},rN=class extends uh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo;super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Ym(null),texelSize:new Ym(new jo),halfTexelSize:new Ym(new jo),kernel:new Ym(0),scale:new Ym(1)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#include <dithering_pars_fragment>\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nvarying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;\n#include <encodings_fragment>\n#include <dithering_fragment>\n}",vertexShader:"uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.setTexelSize(e.x,e.y)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.inputBuffer=e}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}getScale(){return this.uniforms.scale.value}setScale(e){this.uniforms.scale.value=e}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(e){this.uniforms.kernel.value=e}setKernel(e){this.kernel=e}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},aN=class extends uh{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Ym(null),opacity:new Ym(1)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;\n#include <encodings_fragment>\n}",vertexShader:$B}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}getOpacity(e){return this.uniforms.opacity.value}setOpacity(e){this.uniforms.opacity.value=e}},sN={DEPTH:0,LUMA:1,COLOR:2},oN={DISABLED:0,DEPTH:1,CUSTOM:2},lN=class extends uh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sN.COLOR;super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:Yr.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Ym(null),depthBuffer:new Ym(null),predicationBuffer:new Ym(null),texelSize:new Ym(e)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\n#if EDGE_DETECTION_MODE == 1\n#include <common>\n#endif\n#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}\n#elif PREDICATION_MODE == 2\nuniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}\n#endif\n#if PREDICATION_MODE != 0\nvec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}\n#endif\n#if EDGE_DETECTION_MODE != 0\nuniform sampler2D inputBuffer;\n#endif\nvoid main(){\n#if EDGE_DETECTION_MODE == 0\nconst vec2 threshold=vec2(DEPTH_THRESHOLD);\n#elif PREDICATION_MODE != 0\nvec2 threshold=calculatePredicatedThreshold();\n#else\nconst vec2 threshold=vec2(EDGE_THRESHOLD);\n#endif\n#if EDGE_DETECTION_MODE == 0\nvec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 1\nfloat l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#elif EDGE_DETECTION_MODE == 2\nvec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);\n#endif\n}",vertexShader:"uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;\n#if EDGE_DETECTION_MODE != 0\nvarying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;\n#endif\nvoid main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);\n#if EDGE_DETECTION_MODE != 0\nvUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);\n#endif\ngl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1,this.edgeDetectionMode=t}set depthBuffer(e){this.uniforms.depthBuffer.value=e}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:go;this.depthBuffer=e,this.depthPacking=t}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(e){this.defines.EDGE_DETECTION_MODE=e.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(e){this.edgeDetectionMode=e}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(e){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=e.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(e){this.localContrastAdaptationFactor=e}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(e){this.defines.EDGE_THRESHOLD=e.toFixed("6"),this.defines.DEPTH_THRESHOLD=(.1*e).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(e){this.edgeDetectionThreshold=e}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(e){this.defines.PREDICATION_MODE=e.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(e){this.predicationMode=e}set predicationBuffer(e){this.uniforms.predicationBuffer.value=e}setPredicationBuffer(e){this.uniforms.predicationBuffer.value=e}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(e){this.defines.PREDICATION_THRESHOLD=e.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(e){this.predicationThreshold=e}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(e){this.defines.PREDICATION_SCALE=e.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(e){this.predicationScale=e}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(e){this.defines.PREDICATION_STRENGTH=e.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(e){this.predicationStrength=e}setSize(e,t){this.uniforms.texelSize.value.set(1/e,1/t)}},cN={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},hN=class extends uh{constructor(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];super({name:"EffectMaterial",defines:{THREE_REVISION:Yr.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Ym(null),depthBuffer:new Ym(null),resolution:new Ym(new jo),texelSize:new Ym(new jo),cameraNear:new Ym(.3),cameraFar:new Ym(1e3),aspect:new Ym(1),time:new Ym(0)},blending:la,depthWrite:!1,depthTest:!1,dithering:r}),this.toneMapped=!1,e&&this.setShaderParts(e),t&&this.setDefines(t),i&&this.setUniforms(i),this.adoptCameraSettings(n)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(e){this.uniforms.depthBuffer.value=e}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(e){this.defines.DEPTH_PACKING=e.toFixed(0),this.needsUpdate=!0}setDepthBuffer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:go;this.depthBuffer=e,this.depthPacking=t}setShaderParts(e){return this.fragmentShader="#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#define packFloatToRGBA(v) packDepthToRGBA(v)\n#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nuniform highp sampler2D depthBuffer;\n#else\nuniform mediump sampler2D depthBuffer;\n#endif\nuniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#if THREE_REVISION >= 137\nvec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}\n#endif\nfloat readDepth(const in vec2 uv){\n#if DEPTH_PACKING == 3201\nreturn unpackRGBAToDepth(texture2D(depthBuffer,uv));\n#else\nreturn texture2D(depthBuffer,uv).r;\n#endif\n}float getViewZ(const in float depth){\n#ifdef PERSPECTIVE_CAMERA\nreturn perspectiveDepthToViewZ(depth,cameraNear,cameraFar);\n#else\nreturn orthographicDepthToViewZ(depth,cameraNear,cameraFar);\n#endif\n}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;\n#ifdef ENCODE_OUTPUT\n#include <encodings_fragment>\n#endif\n#include <dithering_fragment>\n}".replace(cN.FRAGMENT_HEAD,e.get(cN.FRAGMENT_HEAD)).replace(cN.FRAGMENT_MAIN_UV,e.get(cN.FRAGMENT_MAIN_UV)).replace(cN.FRAGMENT_MAIN_IMAGE,e.get(cN.FRAGMENT_MAIN_IMAGE)),this.vertexShader="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}".replace(cN.VERTEX_HEAD,e.get(cN.VERTEX_HEAD)).replace(cN.VERTEX_MAIN_SUPPORT,e.get(cN.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(e){for(let t of e.entries())this.defines[t[0]]=t[1];return this.needsUpdate=!0,this}setUniforms(e){for(let t of e.entries())this.uniforms[t[0]]=t[1];return this}setExtensions(e){this.extensions={};for(let t of e)this.extensions[t]=!0;return this}get encodeOutput(){return void 0!==this.defines.ENCODE_OUTPUT}set encodeOutput(e){this.encodeOutput!==e&&(e?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(e){return this.encodeOutput}setOutputEncodingEnabled(e){this.encodeOutput=e}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}setDeltaTime(e){this.uniforms.time.value+=e}adoptCameraSettings(e){e&&(this.uniforms.cameraNear.value=e.near,this.uniforms.cameraFar.value=e.far,e instanceof fh?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(e,t){let i=this.uniforms;i.resolution.value.set(e,t),i.texelSize.value.set(1/e,1/t),i.aspect.value=e/t}static get Section(){return cN}},dN=class extends uh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super({name:"LuminanceMaterial",defines:{THREE_REVISION:Yr.replace(/\D+/g,"")},uniforms:{inputBuffer:new Ym(null),threshold:new Ym(0),smoothing:new Ym(1),range:new Ym(null)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#include <common>\n#if THREE_REVISION < 143\n#define luminance(v) linearToRelativeLuminance(v)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef RANGE\nuniform vec2 range;\n#elif defined(THRESHOLD)\nuniform float threshold;uniform float smoothing;\n#endif\nvarying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);\n#ifdef RANGE\nfloat low=step(range.x,l);float high=step(l,range.y);l*=low*high;\n#elif defined(THRESHOLD)\nl=smoothstep(threshold,threshold+smoothing,l);\n#endif\n#ifdef COLOR\ngl_FragColor=vec4(texel.rgb*l,l);\n#else\ngl_FragColor=vec4(l);\n#endif\n}",vertexShader:$B}),this.toneMapped=!1,this.colorOutput=e,this.luminanceRange=t}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get threshold(){return this.uniforms.threshold.value}set threshold(e){this.smoothing>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=e}getThreshold(){return this.threshold}setThreshold(e){this.threshold=e}get smoothing(){return this.uniforms.smoothing.value}set smoothing(e){this.threshold>0||e>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=e}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(e){this.smoothing=e}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(e){}get colorOutput(){return void 0!==this.defines.COLOR}set colorOutput(e){e?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(e){return this.colorOutput}setColorOutputEnabled(e){this.colorOutput=e}get useRange(){return null!==this.luminanceRange}set useRange(e){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(e){null!==e?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=e,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(e){this.luminanceRange=e}},uN=0,pN=1,fN=class extends uh{constructor(){super({name:"MaskMaterial",uniforms:{maskTexture:new Ym(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null),inputBuffer:new Ym(null),strength:new Ym(1)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\n#ifdef MASK_PRECISION_HIGH\nuniform mediump sampler2D maskTexture;\n#else\nuniform lowp sampler2D maskTexture;\n#endif\n#if MASK_FUNCTION != 0\nuniform float strength;\n#endif\nvarying vec2 vUv;void main(){\n#if COLOR_CHANNEL == 0\nfloat mask=texture2D(maskTexture,vUv).r;\n#elif COLOR_CHANNEL == 1\nfloat mask=texture2D(maskTexture,vUv).g;\n#elif COLOR_CHANNEL == 2\nfloat mask=texture2D(maskTexture,vUv).b;\n#else\nfloat mask=texture2D(maskTexture,vUv).a;\n#endif\n#if MASK_FUNCTION == 0\n#ifdef INVERTED\nmask=step(mask,0.0);\n#else\nmask=1.0-step(mask,0.0);\n#endif\n#else\nmask=clamp(mask*strength,0.0,1.0);\n#ifdef INVERTED\nmask=1.0-mask;\n#endif\n#endif\n#if MASK_FUNCTION == 2\ngl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);\n#else\ngl_FragColor=mask*texture2D(inputBuffer,vUv);\n#endif\n}",vertexShader:$B}),this.toneMapped=!1,this.setColorChannel(ZB),this.setMaskFunction(uN)}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}set maskTexture(e){this.uniforms.maskTexture.value=e,delete this.defines.MASK_PRECISION_HIGH,e.type!==os&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(e){this.maskTexture=e}set colorChannel(e){this.defines.COLOR_CHANNEL=e.toFixed(0),this.needsUpdate=!0}setColorChannel(e){this.colorChannel=e}set maskFunction(e){this.defines.MASK_FUNCTION=e.toFixed(0),this.needsUpdate=!0}setMaskFunction(e){this.maskFunction=e}get inverted(){return void 0!==this.defines.INVERTED}set inverted(e){this.inverted&&!e?delete this.defines.INVERTED:e&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(e){this.inverted=e}get strength(){return this.uniforms.strength.value}set strength(e){this.uniforms.strength.value=e}getStrength(){return this.strength}setStrength(e){this.strength=e}},mN=class extends uh{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new jo,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new jo;super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Ym(null),searchTexture:new Ym(null),areaTexture:new Ym(null),resolution:new Ym(t),texelSize:new Ym(e)},blending:la,depthWrite:!1,depthTest:!1,fragmentShader:"#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)\n#if __VERSION__ < 300\n#define round(v) floor(v + 0.5)\n#endif\n#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D inputBuffer;\n#else\nuniform lowp sampler2D inputBuffer;\n#endif\nuniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);\n#endif\n}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){\n#if !defined(DISABLE_CORNER_DETECTION)\nvec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);\n#endif\n}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){\n#if !defined(DISABLE_DIAG_DETECTION)\nweights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){\n#endif\nvec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);\n#if !defined(DISABLE_DIAG_DETECTION)\n}else{e.r=0.0;}\n#endif\n}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}",vertexShader:"uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}"}),this.toneMapped=!1}set inputBuffer(e){this.uniforms.inputBuffer.value=e}setInputBuffer(e){this.uniforms.inputBuffer.value=e}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(e){this.uniforms.searchTexture.value=e}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(e){this.uniforms.areaTexture.value=e}setLookupTextures(e,t){this.searchTexture=e,this.areaTexture=t}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(e){let t=Math.min(Math.max(e,0),112);this.defines.MAX_SEARCH_STEPS_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(e){this.orthogonalSearchSteps=e}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(e){let t=Math.min(Math.max(e,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=t.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=t.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(e){this.diagonalSearchSteps=e}get diagonalDetection(){return void 0===this.defines.DISABLE_DIAG_DETECTION}set diagonalDetection(e){e?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(e){this.diagonalDetection=e}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(e){let t=Math.min(Math.max(e,0),100);this.defines.CORNER_ROUNDING=t.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(t/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(e){this.cornerRounding=e}get cornerDetection(){return void 0===this.defines.DISABLE_CORNER_DETECTION}set cornerDetection(e){e?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(e){this.cornerDetection=e}setSize(e,t){let i=this.uniforms;i.texelSize.value.set(1/e,1/t),i.resolution.value.set(e,t)}},gN=new ph,vN=null;var yN=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Pass",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new op,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:gN;this.name=e,this.renderer=null,this.scene=t,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){let t=this.getFullscreenMaterial();null!==t&&(t.needsUpdate=!0),this.rtt=!e}}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return null!==this.screen?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;null!==t?t.material=e:(t=new ah(function(){if(null===vN){let e=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),t=new Float32Array([0,0,2,0,0,2]);void 0!==(vN=new Wc).setAttribute?(vN.setAttribute("position",new kc(e,3)),vN.setAttribute("uv",new kc(t,2))):(vN.addAttribute("position",new kc(e,3)),vN.addAttribute("uv",new kc(t,2)))}return vN}(),e),t.frustumCulled=!1,null===this.scene&&(this.scene=new op),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e){}render(e,t,i,n,r){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof op||t===this.renderer)continue;this[e].dispose()}}}},bN=class extends yN{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super("CopyPass"),this.fullscreenMaterial=new aN,this.needsSwap=!1,this.renderTarget=e,void 0===e&&(this.renderTarget=new ul(1,1,{minFilter:rs,magFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=t}get resize(){return this.autoResize}set resize(e){this.autoResize=e}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(e){this.autoResize=e}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){this.autoResize&&this.renderTarget.setSize(e,t)}initialize(e,t,i){void 0!==i&&(this.renderTarget.texture.type=i,i!==os?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":e.outputEncoding===mo&&(this.renderTarget.texture.encoding=mo))}},xN=class extends yN{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(e,t,i,n,r){let a=e.state.buffers.stencil;a.setLocked(!1),a.setTest(!1)}},wN=new rl,_N=class extends yN{constructor(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super("ClearPass",null,null),this.needsSwap=!1,this.color=e,this.depth=t,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(e,t,i){this.color=e,this.depth=t,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(e){this.overrideClearColor=e}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(e){this.overrideClearAlpha=e}render(e,t,i,n,r){let a=this.overrideClearColor,s=this.overrideClearAlpha,o=e.getClearAlpha(),l=null!==a,c=s>=0;l?(wN.copy(e.getClearColor(wN)),e.setClearColor(a,c?s:o)):c&&e.setClearAlpha(s),e.setRenderTarget(this.renderToScreen?null:t),e.clear(this.color,this.depth,this.stencil),l?e.setClearColor(wN,o):c&&e.setClearAlpha(o)}},SN=-1,AN=class extends Co{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:SN,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:SN,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;super(),this.resizable=e,this.base=new jo(1,1),this.preferred=new jo(t,i),this.target=this.preferred,this.s=n}get width(){let e,{base:t,preferred:i,scale:n}=this;return e=i.width!==SN?i.width:i.height!==SN?Math.round(i.height*(t.width/Math.max(t.height,1))):Math.round(t.width*n),e}set width(e){this.preferredWidth=e}get height(){let e,{base:t,preferred:i,scale:n}=this;return e=i.height!==SN?i.height:i.width!==SN?Math.round(i.width/Math.max(t.width/Math.max(t.height,1),1)):Math.round(t.height*n),e}set height(e){this.preferredHeight=e}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(e){this.s!==e&&(this.s=e,this.preferred.setScalar(SN),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(e){this.scale=e}get baseWidth(){return this.base.width}set baseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(e){this.base.width!==e&&(this.base.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(e){this.base.height!==e&&(this.base.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(e){this.baseHeight=e}setBaseSize(e,t){(this.base.width!==e||this.base.height!==t)&&(this.base.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(e){this.preferred.width!==e&&(this.preferred.width=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(e){this.preferredWidth=e}get preferredHeight(){return this.preferred.height}set preferredHeight(e){this.preferred.height!==e&&(this.preferred.height=e,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(e){this.preferredHeight=e}setPreferredSize(e,t){(this.preferred.width!==e||this.preferred.height!==t)&&(this.preferred.set(e,t),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(e){this.base.set(e.getBaseWidth(),e.getBaseHeight()),this.preferred.set(e.getPreferredWidth(),e.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return SN}},EN=!1,CN=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(e),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case oa:t=this.materialsFlatShadedDoubleSide;break;case sa:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded}else switch(e.material.side){case oa:t=this.materialsDoubleSide;break;case sa:t=this.materialsBackSide;break;default:t=this.materials}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}setMaterial(e){if(this.disposeMaterials(),this.material=e,null!==e){let t=this.materials=[e.clone(),e.clone(),e.clone()];for(let i of t)i.uniforms=Object.assign({},e.uniforms),i.side=aa;t[2].skinning=!0,this.materialsBackSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.side=sa,i})),this.materialsDoubleSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.side=oa,i})),this.materialsFlatShaded=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i})),this.materialsFlatShadedBackSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=sa,i})),this.materialsFlatShadedDoubleSide=t.map((t=>{let i=t.clone();return i.uniforms=Object.assign({},e.uniforms),i.flatShading=!0,i.side=oa,i}))}}render(e,t,i){let n=e.shadowMap.enabled;if(e.shadowMap.enabled=!1,EN){let n=this.originalMaterials;this.meshCount=0,t.traverse(this.replaceMaterial),e.render(t,i);for(let e of n)e[0].material=e[1];this.meshCount!==n.size&&n.clear()}else{let n=t.overrideMaterial;t.overrideMaterial=this.material,e.render(t,i),t.overrideMaterial=n}e.shadowMap.enabled=n}disposeMaterials(){if(null!==this.material){let e=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let t of e)t.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return EN}static set workaroundEnabled(e){EN=e}},MN=class extends yN{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;super("RenderPass",e,t),this.needsSwap=!1,this.clearPass=new _N,this.overrideMaterialManager=null===i?null:new CN(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(e){super.renderToScreen=e,this.clearPass.renderToScreen=e}get overrideMaterial(){let e=this.overrideMaterialManager;return null!==e?e.material:null}set overrideMaterial(e){let t=this.overrideMaterialManager;null!==e?null!==t?t.setMaterial(e):this.overrideMaterialManager=new CN(e):null!==t&&(t.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(e){this.overrideMaterial=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getSelection(){return this.selection}setSelection(e){this.selection=e}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(e){this.ignoreBackground=e}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(e){this.skipShadowMapUpdate=e}getClearPass(){return this.clearPass}render(e,t,i,n,r){let a=this.scene,s=this.camera,o=this.selection,l=s.layers.mask,c=a.background,h=e.shadowMap.autoUpdate,d=this.renderToScreen?null:t;null!==o&&s.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(e.shadowMap.autoUpdate=!1),(this.ignoreBackground||null!==this.clearPass.overrideClearColor)&&(a.background=null),this.clearPass.enabled&&this.clearPass.render(e,t),e.setRenderTarget(d),null!==this.overrideMaterialManager?this.overrideMaterialManager.render(e,a,s):e.render(a,s),s.layers.mask=l,a.background=c,e.shadowMap.autoUpdate=h}},PN=class extends yN{constructor(e,t){let{resolutionScale:i=1,width:n=AN.AUTO_SIZE,height:r=AN.AUTO_SIZE,renderTarget:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super("DepthPass"),this.needsSwap=!1,this.renderPass=new MN(e,t,new Gu({depthPacking:vo}));let s=this.renderPass;s.skipShadowMapUpdate=!0,s.ignoreBackground=!0;let o=s.getClearPass();o.overrideClearColor=new rl(16777215),o.overrideClearAlpha=1,this.renderTarget=a,void 0===this.renderTarget&&(this.renderTarget=new ul(1,1,{minFilter:ts,magFilter:ts,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new AN(this,n,r,i);l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let a=this.renderToScreen?null:this.renderTarget;this.renderPass.render(e,a)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}},TN=(new Float32Array([255/256/256**3,255/256/65536,255/256/256,255/256]),{SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18}),DN=new Map([[TN.SKIP,null],[TN.ADD,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}"],[TN.ALPHA,"vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}"],[TN.AVERAGE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}"],[TN.COLOR_BURN,"float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[TN.COLOR_DODGE,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[TN.DARKEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}"],[TN.DIFFERENCE,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}"],[TN.EXCLUSION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}"],[TN.LIGHTEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}"],[TN.MULTIPLY,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}"],[TN.DIVIDE,"float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[TN.NEGATION,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}"],[TN.NORMAL,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}"],[TN.OVERLAY,"float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[TN.REFLECT,"float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[TN.SCREEN,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}"],[TN.SOFT_LIGHT,"float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}"],[TN.SUBTRACT,"vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}"]]),RN=class extends Co{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;super(),this.f=e,this.opacity=new Ym(t)}getOpacity(){return this.opacity.value}setOpacity(e){this.opacity.value=e}get blendFunction(){return this.f}set blendFunction(e){this.f=e,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(e){this.blendFunction=e}getShaderCode(){return DN.get(this.blendFunction)}},ON={NONE:0,DEPTH:1,CONVOLUTION:2},IN=class extends Co{constructor(e,t){let{attributes:i=ON.NONE,blendFunction:n=TN.SCREEN,defines:r=new Map,uniforms:a=new Map,extensions:s=null,vertexShader:o=null}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.name=e,this.renderer=null,this.attributes=i,this.fragmentShader=t,this.vertexShader=o,this.defines=r,this.uniforms=a,this.extensions=s,this.blendMode=new RN(n),this.blendMode.addEventListener("change",(e=>this.setChanged()))}getName(){return this.name}setRenderer(e){this.renderer=e}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(e){this.attributes=e,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(e){this.fragmentShader=e,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(e){this.vertexShader=e,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(e){}update(e,t,i){}setSize(e,t){}initialize(e,t,i){}dispose(){for(let e of Object.keys(this)){let t=this[e];if(null!==t&&"object"==typeof t&&"function"==typeof t.dispose){if(t instanceof op||t===this.renderer)continue;this[e].dispose()}}}};function kN(e,t,i){for(let n of t){let t="$1"+e+n.charAt(0).toUpperCase()+n.slice(1),r=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(let e of i.entries())null!==e[1]&&i.set(e[0],e[1].replace(r,t))}}function LN(e,t,i,n,r,a,s){let o=new Map([["fragment",t.getFragmentShader()],["vertex",t.getVertexShader()]]),l=void 0!==o.get("fragment")&&/mainImage/.test(o.get("fragment")),c=void 0!==o.get("fragment")&&/mainUv/.test(o.get("fragment")),h=[],d=[],u=!1,p=!1;if(void 0===o.get("fragment"))console.error("Missing fragment shader",t);else if(c&&0!==(s&ON.CONVOLUTION))console.error("Effects that transform UV coordinates are incompatible with convolution effects",t);else if(l||c){let f=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,m=hN.Section;if(c){let t="\t".concat(e,"MainUv(UV);\n");i.set(m.FRAGMENT_MAIN_UV,i.get(m.FRAGMENT_MAIN_UV)+t),u=!0}if(null!==o.get("vertex")&&/mainSupport/.test(o.get("vertex"))){let t="\t".concat(e,"MainSupport(");t+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?"vUv);\n":");\n",i.set(m.VERTEX_MAIN_SUPPORT,i.get(m.VERTEX_MAIN_SUPPORT)+t),h=h.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map((e=>e[1]))),d=d.concat(h).concat([...o.get("vertex").matchAll(f)].map((e=>e[1])))}d=d.concat([...o.get("fragment").matchAll(f)].map((e=>e[1]))),d=d.concat([...t.defines.keys()].map((e=>e.replace(/\([\w\s,]*\)/g,"")))),d=d.concat([...t.uniforms.keys()]),t.uniforms.forEach(((t,i)=>a.set(e+i.charAt(0).toUpperCase()+i.slice(1),t))),t.defines.forEach(((t,i)=>r.set(e+i.charAt(0).toUpperCase()+i.slice(1),t))),kN(e,d,r),kN(e,d,o);let g=t.blendMode;if(n.set(g.blendFunction,g),l){let t=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,n="".concat(e,"MainImage(color0, UV, ");0!==(s&ON.DEPTH)&&t.test(o.get("fragment"))&&(n+="depth, ",p=!0),n+="color1);\n\t";let r=e+"BlendOpacity";a.set(r,g.opacity),n+="color0 = blend".concat(g.blendFunction,"(color0, color1, ").concat(r,");\n\n\t"),i.set(m.FRAGMENT_MAIN_IMAGE,i.get(m.FRAGMENT_MAIN_IMAGE)+n),n="uniform float ".concat(r,";\n\n"),i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+n)}i.set(m.FRAGMENT_HEAD,i.get(m.FRAGMENT_HEAD)+o.get("fragment")+"\n"),null!==o.get("vertex")&&i.set(m.VERTEX_HEAD,i.get(m.VERTEX_HEAD)+o.get("vertex")+"\n")}else console.error("The fragment shader contains neither a mainImage nor a mainUv function",t);return{varyings:h,transformedUv:u,readDepth:p}}var FN=class extends yN{constructor(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];super("EffectPass"),this.fullscreenMaterial=new hN(null,null,null,e),this.effects=i.sort(((e,t)=>t.attributes-e.attributes)),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(e){this.fullscreenMaterial.encodeOutput=e}get dithering(){return this.fullscreenMaterial.dithering}set dithering(e){let t=this.fullscreenMaterial;t.dithering=e,t.needsUpdate=!0}verifyResources(){let e=this.renderer.capabilities,t=Math.min(e.maxFragmentUniforms,e.maxVertexUniforms);this.uniformCount>t&&console.warn("The current rendering context doesn't support more than "+t+" uniforms, but "+this.uniformCount+" were defined"),t=e.maxVaryings,this.varyingCount>t&&console.warn("The current rendering context doesn't support more than "+t+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let e=hN.Section,t=new Map([[e.FRAGMENT_HEAD,""],[e.FRAGMENT_MAIN_UV,""],[e.FRAGMENT_MAIN_IMAGE,""],[e.VERTEX_HEAD,""],[e.VERTEX_MAIN_SUPPORT,""]]),i=new Map,n=new Map,r=new Map,a=new Set,s=0,o=0,l=0,c=!1,h=!1;for(let u of this.effects)if(u.blendMode.blendFunction===TN.SKIP)l|=u.getAttributes()&ON.DEPTH;else if(0!==(l&u.getAttributes()&ON.CONVOLUTION))console.error("Convolution effects cannot be merged",u);else{l|=u.getAttributes();let e=LN("e"+s++,u,t,i,n,r,l);if(o+=e.varyings.length,c=c||e.transformedUv,h=h||e.readDepth,null!==u.extensions)for(let t of u.extensions)a.add(t)}let d=/\bblend\b/g;for(let u of i.values()){let i=u.getShaderCode().replace(d,"blend".concat(u.blendFunction));t.set(e.FRAGMENT_HEAD,t.get(e.FRAGMENT_HEAD)+i+"\n")}if(0!==(l&ON.DEPTH)){if(h){let i="float depth = readDepth(UV);\n\n\t";t.set(e.FRAGMENT_MAIN_IMAGE,i+t.get(e.FRAGMENT_MAIN_IMAGE))}this.needsDepthTexture=null===this.getDepthTexture()}else this.needsDepthTexture=!1;if(c){let i="vec2 transformedUv = vUv;\n";t.set(e.FRAGMENT_MAIN_UV,i+t.get(e.FRAGMENT_MAIN_UV)),n.set("UV","transformedUv")}else n.set("UV","vUv");t.forEach(((e,t,i)=>i.set(t,e.trim().replace(/^#/,"\n#")))),this.uniformCount=r.size,this.varyingCount=o,this.skipRendering=0===s,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(t).setExtensions(a).setUniforms(r).setDefines(n)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:go;this.fullscreenMaterial.depthBuffer=e,this.fullscreenMaterial.depthPacking=t;for(let i of this.effects)i.setDepthTexture(e,t)}render(e,t,i,n,r){for(let a of this.effects)a.update(e,t,n);if(!this.skipRendering||this.renderToScreen){let r=this.fullscreenMaterial;r.inputBuffer=t.texture,r.time+=n,e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}}setSize(e,t){this.fullscreenMaterial.setSize(e,t);for(let i of this.effects)i.setSize(e,t)}initialize(e,t,i){this.renderer=e;for(let n of this.effects)n.initialize(e,t,i),n.addEventListener("change",(e=>this.handleEvent(e)));this.updateMaterial(),this.verifyResources(),void 0!==i&&i!==os&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let e of this.effects)e.dispose()}handleEvent(e){if("change"===e.type)this.recompile()}},BN=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],NN=class extends yN{constructor(){let{resolutionScale:e=.5,width:t=AN.AUTO_SIZE,height:i=AN.AUTO_SIZE,kernelSize:n=HN.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("KawaseBlurPass"),this.renderTargetA=new ul(1,1,{minFilter:rs,magFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let r=this.resolution=new AN(this,t,i,e);r.addEventListener("change",(e=>this.setSize(r.baseWidth,r.baseHeight))),this.blurMaterial=new rN,this.ditheredBlurMaterial=new rN,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=n}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get scale(){return this.blurMaterial.scale}set scale(e){this.blurMaterial.scale=e}getScale(){return this.blurMaterial.scale}setScale(e){this.blurMaterial.scale=e}getKernelSize(){return this.kernelSize}setKernelSize(e){this.kernelSize=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}render(e,t,i,n,r){let a,s,o=this.scene,l=this.camera,c=this.renderTargetA,h=this.renderTargetB,d=BN[this.kernelSize],u=this.blurMaterial,p=t;for(this.fullscreenMaterial=u,a=0,s=d.length-1;a<s;++a){let t=0===(1&a)?c:h;u.kernel=d[a],u.inputBuffer=p.texture,e.setRenderTarget(t),e.render(o,l),p=t}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=d[a],u.inputBuffer=p.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(o,l)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height;this.renderTargetA.setSize(n,r),this.renderTargetB.setSize(n,r),this.blurMaterial.setSize(n,r),this.ditheredBlurMaterial.setSize(n,r)}initialize(e,t,i){void 0!==i&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==os?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):e.outputEncoding===mo&&(this.renderTargetA.texture.encoding=mo,this.renderTargetB.texture.encoding=mo))}static get AUTO_SIZE(){return AN.AUTO_SIZE}},zN=class extends yN{constructor(){let{width:e=AN.AUTO_SIZE,height:t=AN.AUTO_SIZE,renderTarget:i,luminanceRange:n,colorOutput:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("LuminancePass"),this.fullscreenMaterial=new dN(r,n),this.needsSwap=!1,this.renderTarget=i,void 0===this.renderTarget&&(this.renderTarget=new ul(1,1,{minFilter:rs,magFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let a=this.resolution=new AN(this,e,t);a.addEventListener("change",(e=>this.setSize(a.baseWidth,a.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(e,t,i,n,r){this.fullscreenMaterial.inputBuffer=t.texture,e.setRenderTarget(this.renderToScreen?null:this.renderTarget),e.render(this.scene,this.camera)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height)}initialize(e,t,i){void 0!==i&&i!==os&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},UN=class extends yN{constructor(e,t){super("MaskPass",e,t),this.needsSwap=!1,this.clearPass=new _N(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(e){this.inverse=e}get clear(){return this.clearPass.enabled}set clear(e){this.clearPass.enabled=e}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(e){this.inverted=e}render(e,t,i,n,r){let a=e.getContext(),s=e.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,h=this.inverted?0:1,d=1-h;s.color.setMask(!1),s.depth.setMask(!1),s.color.setLocked(!0),s.depth.setLocked(!0),s.stencil.setTest(!0),s.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),s.stencil.setFunc(a.ALWAYS,h,4294967295),s.stencil.setClear(d),s.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(e,null):(c.render(e,t),c.render(e,i))),this.renderToScreen?(e.setRenderTarget(null),e.render(o,l)):(e.setRenderTarget(t),e.render(o,l),e.setRenderTarget(i),e.render(o,l)),s.color.setLocked(!1),s.depth.setLocked(!1),s.stencil.setLocked(!1),s.stencil.setFunc(a.EQUAL,1,4294967295),s.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),s.stencil.setLocked(!0)}},jN=class extends yN{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"inputBuffer";super("ShaderPass"),this.fullscreenMaterial=e,this.inputBufferUniform=null,this.setInput(t)}setInput(e){if(this.inputBufferUniform=null,null!==this.fullscreenMaterial){let t=this.fullscreenMaterial.uniforms;void 0!==t&&void 0!==t[e]&&(this.inputBufferUniform=t[e])}}render(e,t,i,n,r){null!==this.inputBufferUniform&&null!==t&&(this.inputBufferUniform.value=t.texture),e.setRenderTarget(this.renderToScreen?null:i),e.render(this.scene,this.camera)}initialize(e,t,i){void 0!==i&&i!==os&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},VN=.001,GN=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(e){return this.fixedDeltaEnabled=e,this}isAutoResetEnabled(e){return this.autoReset}setAutoResetEnabled(e){return typeof document<"u"&&void 0!==document.hidden&&(e?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=e),this}getDelta(){return this.delta*VN}getFixedDelta(){return this.fixedDelta*VN}setFixedDelta(e){return this.fixedDelta=1e3*e,this}getElapsed(){return this.elapsed*VN}getTimescale(){return this.timescale}setTimescale(e){return this.timescale=e,this}update(e){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=void 0!==e?e:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(e){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},HN={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},WN=class extends IN{constructor(){let{blendFunction:e=TN.SCREEN,luminanceThreshold:t=.9,luminanceSmoothing:i=.025,resolutionScale:n=.5,intensity:r=1,width:a=AN.AUTO_SIZE,height:s=AN.AUTO_SIZE,kernelSize:o=HN.LARGE}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BloomEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D map;\n#else\nuniform lowp sampler2D map;\n#endif\nuniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}",{blendFunction:e,uniforms:new Map([["map",new Ym(null)],["intensity",new Ym(r)]])}),this.renderTarget=new ul(1,1,{minFilter:rs,magFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new zN({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=t,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new NN({resolutionScale:n,width:a,height:s,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",(e=>this.setSize(l.baseWidth,l.baseHeight)))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(e){this.resolution.preferredWidth=e}get height(){return this.resolution.height}set height(e){this.resolution.preferredHeight=e}get dithering(){return this.blurPass.dithering}set dithering(e){this.blurPass.dithering=e}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(e){this.blurPass.kernelSize=e}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(e){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(e){this.uniforms.get("intensity").value=e}getIntensity(){return this.intensity}setIntensity(e){this.intensity=e}getResolutionScale(){return this.resolution.scale}setResolutionScale(e){this.resolution.scale=e}update(e,t,i){let n=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(e,t,n),this.blurPass.render(e,n,n)):this.blurPass.render(e,t,n)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(e,t,i){this.blurPass.initialize(e,t,i),void 0!==i&&(this.renderTarget.texture.type=i,e.outputEncoding===mo&&(this.renderTarget.texture.encoding=mo))}},qN=class extends IN{constructor(){let{blendFunction:e=TN.NORMAL,brightness:t=0,contrast:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("BrightnessContrastEffect","uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["brightness",new Ym(t)],["contrast",new Ym(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(e){this.uniforms.get("brightness").value=e}getBrightness(e){return this.brightness}setBrightness(e){this.brightness=e}get contrast(){return this.uniforms.get("contrast").value}set contrast(e){this.uniforms.get("contrast").value=e}getContrast(e){return this.contrast}setContrast(e){this.contrast=e}},XN=class extends IN{constructor(){super("ColorAverageEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",{blendFunction:arguments.length>0&&void 0!==arguments[0]?arguments[0]:TN.NORMAL})}},YN=class extends IN{constructor(){let{blendFunction:e=TN.NORMAL,offset:t=new jo(.001,5e-4)}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("ChromaticAberrationEffect","varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",{vertexShader:"uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",blendFunction:e,attributes:ON.CONVOLUTION,uniforms:new Map([["offset",new Ym(t)]])})}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}},QN=class extends IN{constructor(e){let{blendFunction:t=TN.NORMAL,worldFocusDistance:i,worldFocusRange:n,focusDistance:r=0,focalLength:a=.1,focusRange:s=a,bokehScale:o=1,width:l=AN.AUTO_SIZE,height:c=AN.AUTO_SIZE}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super("DepthOfFieldEffect","#ifdef FRAMEBUFFER_PRECISION_HIGH\nuniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;\n#else\nuniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;\n#endif\nuniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}",{blendFunction:t,attributes:ON.DEPTH,uniforms:new Map([["nearColorBuffer",new Ym(null)],["farColorBuffer",new Ym(null)],["nearCoCBuffer",new Ym(null)],["scale",new Ym(1)]])}),this.camera=e,this.renderTarget=new ul(1,1,{minFilter:rs,magFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new jN(new nN(e));let h=this.cocMaterial;h.focusDistance=r,h.focusRange=s,void 0!==i&&(h.worldFocusDistance=i),void 0!==n&&(h.worldFocusRange=n),this.blurPass=new NN({kernelSize:HN.MEDIUM,width:l,height:c});let d=this.blurPass.getResolution();d.addEventListener("change",(e=>this.setSize(d.getBaseWidth(),d.getBaseHeight()))),this.maskPass=new jN(new fN(this.renderTargetCoC.texture));let u=this.maskPass.fullscreenMaterial;u.maskFunction=pN,u.colorChannel=JB,this.bokehNearBasePass=new jN(new eN(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new jN(new eN(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new jN(new eN(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new jN(new eN(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(e){let t=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of t)i.fullscreenMaterial.setScale(e);this.maskPass.fullscreenMaterial.setStrength(e),this.uniforms.get("scale").value=e}getBokehScale(){return this.bokehScale}setBokehScale(e){this.bokehScale=e}getTarget(){return this.target}setTarget(e){this.target=e}calculateFocusDistance(e){let t=this.camera;return iN(-t.position.distanceTo(e),t.near,t.far)}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:go;this.circleOfConfusionMaterial.depthBuffer=e,this.circleOfConfusionMaterial.depthPacking=t}update(e,t,i){let n=this.renderTarget,r=this.renderTargetCoC,a=this.renderTargetCoCBlurred,s=this.renderTargetMasked;if(null!==this.target){let e=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=e}this.cocPass.render(e,null,r),this.blurPass.render(e,r,a),this.maskPass.render(e,t,s),this.bokehFarBasePass.render(e,s,n),this.bokehFarFillPass.render(e,n,this.renderTargetFar),this.bokehNearBasePass.render(e,t,n),this.bokehNearFillPass.render(e,n,this.renderTargetNear)}setSize(e,t){let i=this.resolution;i.setBaseSize(e,t);let n=i.width,r=i.height,a=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];a.push(this.renderTargetCoC,this.renderTargetMasked),a.forEach((i=>i.setSize(e,t))),a=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],a.forEach((e=>e.setSize(n,r))),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((e=>e.fullscreenMaterial.setSize(n,r)))}initialize(e,t,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach((n=>n.initialize(e,t,i))),this.blurPass.initialize(e,t,os),void 0!==i&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,e.outputEncoding===mo&&(this.renderTarget.texture.encoding=mo,this.renderTargetNear.texture.encoding=mo,this.renderTargetFar.texture.encoding=mo,this.renderTargetMasked.texture.encoding=mo))}},KN=(new gl,new ql,class extends IN{constructor(){let{blendFunction:e=TN.NORMAL,hue:t=0,saturation:i=0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("HueSaturationEffect","uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",{blendFunction:e,uniforms:new Map([["hue",new Ym(new gl)],["saturation",new Ym(i)]])}),this.hue=t}get saturation(){return this.uniforms.get("saturation").value}set saturation(e){this.uniforms.get("saturation").value=e}getSaturation(){return this.saturation}setSaturation(e){this.saturation=e}get hue(){let e=this.uniforms.get("hue").value;return Math.acos((3*e.x-1)/2)}set hue(e){let t=Math.sin(e),i=Math.cos(e);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3)}getHue(){return this.hue}setHue(e){this.hue=e}}),ZN=(new rl,class extends IN{constructor(){let{blendFunction:e=TN.SCREEN,premultiply:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("NoiseEffect","void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));\n#ifdef PREMULTIPLY\noutputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);\n#else\noutputColor=vec4(noise,inputColor.a);\n#endif\n}",{blendFunction:e}),this.premultiply=t}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(e){this.premultiply!==e&&(e?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(e){this.premultiply=e}}),JN=class extends IN{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;super("PixelationEffect","uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",{uniforms:new Map([["active",new Ym(!1)],["d",new Ym(new jo)]])}),this.resolution=new jo,this.d=0,this.granularity=e}get granularity(){return this.d}set granularity(e){let t=Math.floor(e);t%2>0&&(t+=1),this.d=t,this.uniforms.get("active").value=t>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(e){this.granularity=e}setSize(e,t){this.resolution.set(e,t),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}},$N=(Math.PI,new gl,new gl,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC"),ez="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",tz={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},iz=class extends IN{constructor(){let e,t,{preset:i=tz.MEDIUM,edgeDetectionMode:n=sN.COLOR,predicationMode:r=oN.DISABLED}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("SMAAEffect","uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",{vertexShader:"varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",blendFunction:TN.NORMAL,attributes:ON.CONVOLUTION|ON.DEPTH,uniforms:new Map([["weightMap",new Ym(null)]])}),arguments.length>1&&(e=arguments[0],t=arguments[1],arguments.length>2&&(i=arguments[2]),arguments.length>3&&(n=arguments[3])),this.renderTargetEdges=new ul(1,1,{minFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new _N(!0,!1,!1),this.clearPass.overrideClearColor=new rl(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new jN(new lN),this.edgeDetectionMaterial.edgeDetectionMode=n,this.edgeDetectionMaterial.predicationMode=r,this.weightsPass=new jN(new mN);let a=new sm;a.onLoad=()=>{let i=new hl(e);i.name="SMAA.Search",i.magFilter=ts,i.minFilter=ts,i.generateMipmaps=!1,i.needsUpdate=!0,i.flipY=!0,this.weightsMaterial.searchTexture=i;let n=new hl(t);n.name="SMAA.Area",n.magFilter=rs,n.minFilter=rs,n.generateMipmaps=!1,n.needsUpdate=!0,n.flipY=!1,this.weightsMaterial.areaTexture=n,this.dispatchEvent({type:"load"})},a.itemStart("search"),a.itemStart("area"),void 0!==e&&void 0!==t?(a.itemEnd("search"),a.itemEnd("area")):typeof Image<"u"&&(e=new Image,t=new Image,e.addEventListener("load",(()=>a.itemEnd("search"))),t.addEventListener("load",(()=>a.itemEnd("area"))),e.src=$N,t.src=ez),this.applyPreset(i)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(e){this.edgeDetectionMaterial.edgeDetectionThreshold=e}setOrthogonalSearchSteps(e){this.weightsMaterial.orthogonalSearchSteps=e}applyPreset(e){let t=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(e){case tz.LOW:t.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case tz.MEDIUM:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case tz.HIGH:t.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case tz.ULTRA:t.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0}}setDepthTexture(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:go;this.edgeDetectionMaterial.depthBuffer=e,this.edgeDetectionMaterial.depthPacking=t}update(e,t,i){this.clearPass.render(e,this.renderTargetEdges),this.edgeDetectionPass.render(e,t,this.renderTargetEdges),this.weightsPass.render(e,this.renderTargetEdges,this.renderTargetWeights)}setSize(e,t){this.edgeDetectionMaterial.setSize(e,t),this.weightsMaterial.setSize(e,t),this.renderTargetEdges.setSize(e,t),this.renderTargetWeights.setSize(e,t)}dispose(){let{searchTexture:e,areaTexture:t}=this.weightsMaterial;null!==e&&null!==t&&(e.dispose(),t.dispose()),super.dispose()}static get searchImageDataURL(){return $N}static get areaImageDataURL(){return ez}},nz={DEFAULT:0,ESKIL:1},rz=class extends IN{constructor(){let{blendFunction:e=TN.NORMAL,technique:t=nz.DEFAULT,eskil:i=!1,offset:n=.5,darkness:r=.5}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super("VignetteEffect","uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;\n#if VIGNETTE_TECHNIQUE == 0\nfloat d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));\n#else\nvec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));\n#endif\noutputColor=vec4(color,inputColor.a);}",{blendFunction:e,defines:new Map([["VIGNETTE_TECHNIQUE",t.toFixed(0)]]),uniforms:new Map([["offset",new Ym(n)],["darkness",new Ym(r)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(e){this.technique!==e&&(this.defines.set("VIGNETTE_TECHNIQUE",e.toFixed(0)),this.setChanged())}get eskil(){return this.technique===nz.ESKIL}set eskil(e){this.technique=e?nz.ESKIL:nz.DEFAULT}getTechnique(){return this.technique}setTechnique(e){this.technique=e}get offset(){return this.uniforms.get("offset").value}set offset(e){this.uniforms.get("offset").value=e}getOffset(){return this.offset}setOffset(e){this.offset=e}get darkness(){return this.uniforms.get("darkness").value}set darkness(e){this.uniforms.get("darkness").value=e}getDarkness(){return this.darkness}setDarkness(e){this.darkness=e}};new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1]),new Float32Array(2),new Float32Array(2),new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125]),new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4]),new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3]),new Map([[sz(0,0,0,0),new Float32Array([0,0,0,0])],[sz(0,0,0,1),new Float32Array([0,0,0,1])],[sz(0,0,1,0),new Float32Array([0,0,1,0])],[sz(0,0,1,1),new Float32Array([0,0,1,1])],[sz(0,1,0,0),new Float32Array([0,1,0,0])],[sz(0,1,0,1),new Float32Array([0,1,0,1])],[sz(0,1,1,0),new Float32Array([0,1,1,0])],[sz(0,1,1,1),new Float32Array([0,1,1,1])],[sz(1,0,0,0),new Float32Array([1,0,0,0])],[sz(1,0,0,1),new Float32Array([1,0,0,1])],[sz(1,0,1,0),new Float32Array([1,0,1,0])],[sz(1,0,1,1),new Float32Array([1,0,1,1])],[sz(1,1,0,0),new Float32Array([1,1,0,0])],[sz(1,1,0,1),new Float32Array([1,1,0,1])],[sz(1,1,1,0),new Float32Array([1,1,1,0])],[sz(1,1,1,1),new Float32Array([1,1,1,1])]]);function az(e,t,i){return e+(t-e)*i}function sz(e,t,i,n){let r=az(e,t,.75),a=az(i,n,.75);return az(r,a,.875)}var oz=class{constructor(e,t){this.enabled=!1,this.effect=new e(t),Object.defineProperty(this,"opacity",{enumerable:!0,set(e){this.effect.blendMode.opacity.value=e},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(e){this.effect.blendMode.setBlendFunction(Number(e))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=TN.NORMAL}},lz=class extends oz{constructor(){super(WN),this.blendFunction=TN.SCREEN}set intensity(e){this.effect.intensity=e}get intensity(){return this.effect.intensity}set luminanceThreshold(e){this.effect.luminanceMaterial.threshold=e}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(e){this.effect.luminanceMaterial.smoothing=e}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(e){this.effect.blurPass.scale=e}get blurScale(){return this.effect.blurPass.scale}set kernelSize(e){this.effect.blurPass.kernelSize=e}get kernelSize(){return this.effect.blurPass.kernelSize}},cz=class extends oz{constructor(){super(qN)}set contrast(e){this.effect.uniforms.get("contrast").value=e}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(e){this.effect.uniforms.get("brightness").value=e}get brightness(){return this.effect.uniforms.get("brightness").value}},hz=class extends oz{constructor(){super(YN),this.effect.offset=new jo(.01,.01)}set offset(e){this.effect.offset.set(e[0]/1e3,e[1]/1e3)}get offset(){return[1e3*this.effect.offset.x,1e3*this.effect.offset.y]}},dz=class extends oz{constructor(){super(XN)}},uz=class extends oz{constructor(){super(KN),this._hue=0}set hue(e){this._hue=e,this.effect.setHue(e)}get hue(){return this._hue}set saturation(e){this.effect.uniforms.get("saturation").value=e}get saturation(){return this.effect.uniforms.get("saturation").value}},pz=class extends oz{constructor(){super(ZN),this.blendFunction=TN.OVERLAY}},fz=class extends oz{constructor(){super(rz)}get eskil(){return this.effect.eskil}set eskil(e){this.effect.eskil=e}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(e){this.effect.uniforms.get("darkness").value=e}get offset(){return this.effect.uniforms.get("offset").value}set offset(e){this.effect.uniforms.get("offset").value=e}},mz=class extends oz{constructor(e){super(QN)}set focalLength(e){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=e/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(e){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?e/2e3:(e+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(e){this.effect.bokehScale=e}setCamera(e){let t=!1;(e.isPerspectiveCamera&&!1===this.isPerspectiveCamera||!e.isPerspectiveCamera&&!0===this.isPerspectiveCamera)&&(t=!0),e.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(e),this.isPerspectiveCamera=!1),t&&this.effect.setChanged()}},gz=class extends oz{constructor(){super(JN)}get granularity(){return this.effect.getGranularity()}set granularity(e){this.effect.setGranularity(e)}},vz=class extends uh{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new Ym(null)},blending:la,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}",fragmentShader:"#define GLSLIFY 1\nlayout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}"})}set inputBuffer(e){this.uniforms.inputBuffer.value=e}},yz=class extends yN{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new vz,this.resolutionVector=new jo,this.resolveMaterial=new uh({name:"TAAResolveMaterial",uniforms:{inputBuffer:new Ym(null),historyBuffer:new Ym(null),velocityBuffer:new Ym(null),depthBuffer:new Ym(null),resolution:new Ym(new jo)},blending:la,depthWrite:!1,depthTest:!1,vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\n#include <common>\nvarying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;\n#define USE_YCOCG\n#define USE_CATMULL_ROM\nconst float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){\n#ifdef USE_YCOCG\nvec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);\n#else\nreturn texture(tex,uv);\n#endif\n}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){\n#ifdef CHOOSE_LONGEST_MOTION_VECTOR\nfloat longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;\n#else\nfloat closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;\n#endif\n}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);\n#ifdef USE_CATMULL_ROM\nvec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);\n#else\nvec4 previousColor=sample_color(historyBuffer,previousPixelPos);\n#endif\n#ifdef USE_YCOCG\npreviousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);\n#endif\nvec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);\n#ifdef USE_YCOCG\nvec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;\n#endif\nvec4 previousColorClipped=clamp(previousColor,cmin,cmax);\n#ifdef LUMINANCE_DIFFERENCES\n#ifdef USE_YCOCG\nfloat lum0=currentColor.r;float lum1=previousColorClipped.r;\n#else\nfloat lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);\n#endif\nfloat unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));\n#else\nconst float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);\n#endif\n#ifdef USE_YCOCG\ngl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);\n#else\ngl_FragColor=result;\n#endif\n}"}),this.historyRenderTarget=new ul(1024,1024,{minFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new ul(1024,1024,{minFilter:rs,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(e,t){this.historyRenderTarget.setSize(e,t),this.resultRenderTarget.setSize(e,t)}render(e,t){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=t.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=t.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=t.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(t.width,t.height),e.setRenderTarget(this.resultRenderTarget),e.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(this.historyRenderTarget),e.render(this.scene,this.camera);let i=this.renderToScreen?null:t;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,e.setRenderTarget(i),e.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},bz=class extends yN{constructor(e,t,i){super("TransmissionPass",void 0,t),this.MRTCompatible=!0,this.depthPass=new PN(e,t,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new vz,this.splineScene=e,this.needsSwap=!1}updatePasses(e){this.passThroughMaterial=new vz,this.depthPass=new PN(this.splineScene,this.camera,{renderTarget:e.transmissionDepthTarget})}setCamera(e){this.camera=e}setScene(e){this.splineScene=e}render(e,t,i){let n=this.camera.layers.mask,r=e;r.setRenderTarget(r.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=t.texture[0],r.clear(),r.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(e,t,i),r.shadowMap.needsUpdate=!1,r.shadowMap.autoUpdate=!1;let a=this.renderToScreen?null:t;this.camera.layers.set(3),e.setRenderTarget(a),e.render(this.splineScene,this.camera),this.camera.layers.mask=n}},xz=new op,wz=new uh({transparent:!0,vertexShader:"\n        void main() {\n            gl_Position = vec4(0.0);\n        }\n    ",fragmentShader:"\n        layout(location = 1) out vec4 gVelocity;\n\n        void main() {\n            gl_FragColor = vec4(0.0);\n\t\t\tgVelocity = vec4(0.0);\n        }\n    "}),_z=class extends yN{constructor(e,t,i){super("OpaquePass",null!==t&&void 0!==t?t:xz,i),this.MRTCompatible=!0,this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.originalMaterials=new Map,this.MRTCompatible=e}setCamera(e){this.camera=e}setScene(e){this.scene=null!==e&&void 0!==e?e:xz}getScene(){return this.scene}render(e,t){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.clear(),this.scene.traverse((e=>{e.layers.isEnabled(3)&&e instanceof cI&&(this.originalMaterials.set(e.id,e.material),e.material=wz)})),e.shadowMap.needsUpdate=!0,e.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:t;e.setRenderTarget(i),this.clearColorOnly&&e.clear(!0,!1,!0),this.clear&&e.clear(),e.render(this.scene,this.camera),this.clearDepth&&e.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(((e,t)=>{let i=this.scene.getObjectById(t);i&&(i.material=e)}))}},Sz=class{constructor(e){let{depthBuffer:t=!0,stencilBuffer:i=!1,multisampling:n=0,frameBufferType:r=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.renderer=e,this.helperStartIndex=0,this.copyPass=new bN,this.depthTexture=null,this.timer=new GN,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(t,i,r,n,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(t,i,r,n,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(t,i,r,n,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(e)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(e){let t=this.inputBuffer,i=this.multisampling;i>0&&e>0?(this.inputBuffer.samples=e,this.outputBuffer.samples=e,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==e&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(t.depthBuffer,t.stencilBuffer,t.texture.type,e,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(e){if(this.renderer=e,null!==e){var t,i;let n=e.getSize(new jo),r=null!==(t=null===(i=e.getContext().getContextAttributes())||void 0===i?void 0:i.alpha)&&void 0!==t&&t,a=this.inputBuffer.texture[0].type;a===os&&e.outputEncoding===mo&&(this.inputBuffer.texture[0].encoding=mo,this.outputBuffer.texture[0].encoding=mo,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),e.autoClear=!1,this.setSize(n.width,n.height,!1);for(let t of this.passes)t.initialize(e,r,a)}}replaceRenderer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.renderer,n=i.domElement.parentNode;return this.setRenderer(e),t&&null!==n&&(n.removeChild(i.domElement),n.appendChild(e.domElement)),i}createDepthTexture(){let e=this.depthTexture=new tp(this._width,this._height);return this.inputBuffer.depthTexture=e,this.inputBuffer.stencilBuffer?(e.format=Ss,e.type=vs):e.type=us,e}deleteDepthTexture(){if(null!==this.depthTexture){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let e of this.passes)e.setDepthTexture(null)}}createBuffer(e,t,i,n,r,a){let s,o=this.renderer,l=null===o?new jo:o.getDrawingBufferSize(new jo),c={minFilter:rs,magFilter:rs,wrapS:$a,wrapT:$a,stencilBuffer:t,depthBuffer:e};return n>0?(s=new ul(l.width,l.height,c),s.samples=n):(r?(s=new fl(l.width,l.height,2,c),s.texture[1].type=fs):s=new ul(l.width,l.height,c),s.depthTexture=new tp(2048,2048),s.depthTexture.type=ps),i===os&&null!==o&&o.outputEncoding===mo&&(Array.isArray(s.texture)?s.texture.forEach((e=>e.encoding=mo)):s.texture.encoding=mo),Array.isArray(s.texture)?s.texture.forEach(((e,t)=>{e.name="EffectComposer.Buffer ".concat(r," ").concat(t),e.generateMipmaps=!1})):(s.texture.name="EffectComposer.Buffer ".concat(r),s.texture.generateMipmaps=!1),s.name=a,s}addPass(e,t){var i,n;let r,a=this.passes,s=this.renderer,o=s.getDrawingBufferSize(new jo),l=null!==(i=null===(n=s.getContext().getContextAttributes())||void 0===n?void 0:n.alpha)&&void 0!==i&&i;if(e.MRTCompatible&&(r=this.inputBuffer.texture[0].type),e.MRTCompatible||(r=this.inputBuffer.texture.type),e.setRenderer(s),e.setSize(o.width,o.height),e.initialize(s,l,r),this.autoRenderToScreen&&(a.length>0&&(a[a.length-1].renderToScreen=!1),e.renderToScreen&&(this.autoRenderToScreen=!1)),void 0!==t?a.splice(t,0,e):a.push(e),this.autoRenderToScreen&&(a[a.length-1].renderToScreen=!0),e.needsDepthTexture||null!==this.depthTexture)if(null===this.depthTexture){let t=this.createDepthTexture();for(e of a)e.setDepthTexture(t)}else e.setDepthTexture(this.depthTexture)}setHelperStartIndex(e){this.helperStartIndex=e}removePass(e){let t=this.passes,i=t.indexOf(e);if(-1!==i&&t.splice(i,1).length>0){if(null!==this.depthTexture){let i=(e,t)=>e||t.needsDepthTexture;t.reduce(i,!1)||e.getDepthTexture()===this.depthTexture&&e.setDepthTexture(null)}this.autoRenderToScreen&&i===t.length&&(e.renderToScreen=!1,t.length>0&&(t[t.length-1].renderToScreen=!0))}}removeAllPasses(){let e=this.passes;e.length>0&&(this.autoRenderToScreen&&(e[e.length-1].renderToScreen=!1),this.passes=[])}render(e){let t,i,n,r,a=this.renderer,s=this.copyPass,o=this.inputBuffer,l=this.outputBuffer,c=this.inputBufferSingle,h=this.outputBufferSingle,d=!1;void 0===e&&(e=this.timer.update().getDelta());for(let u of this.passes)u.enabled&&(u.MRTCompatible?u.render(a,o,l,e,d):u.render(a,c,h,e,d),u.needsSwap&&(d&&(s.renderToScreen=u.renderToScreen,t=a.getContext(),i=a.state.buffers.stencil,i.setFunc(t.NOTEQUAL,1,4294967295),s.render(a,o,l,e,d),i.setFunc(t.EQUAL,1,4294967295)),n=o,r=c,o=l,c=h,l=n,h=r),u instanceof UN?d=!0:u instanceof xN&&(d=!1))}setSize(e,t,i){let n=this.renderer;if(this._width=e,this._height=t,void 0===e||void 0===t){let i=n.getSize(new jo);e=i.width,t=i.height}n.setSize(e,t,i);let r=n.getDrawingBufferSize(new jo);this.inputBuffer.setSize(r.width,r.height),this.outputBuffer.setSize(r.width,r.height),this.inputBufferSingle.setSize(r.width,r.height),this.outputBufferSingle.setSize(r.width,r.height);for(let a of this.passes)a.setSize(r.width,r.height)}reset(){let e=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(e)}dispose(){for(let e of this.passes)e.dispose();this.passes=[],null!==this.inputBuffer&&this.inputBuffer.dispose(),null!==this.outputBuffer&&this.outputBuffer.dispose(),null!==this.inputBufferSingle&&this.inputBufferSingle.dispose(),null!==this.outputBufferSingle&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},Az=new uh({name:"CombineMaterial",uniforms:{inputBufferA:new Ym(null),inputBufferB:new Ym(null)},blending:la,depthWrite:!1,depthTest:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    gl_Position = vec4(position.xy, 1.0, 1.0);\n    vUv = position.xy * 0.5 + 0.5;\n}\n",fragmentShader:"\n    varying vec2 vUv;\n    uniform sampler2D inputBufferA;\n    uniform sampler2D inputBufferB;\n\n    // TODO: Why do we need these when postpro of framemode is enabled???\n    layout(location = 1) out vec4 gVelocity;\n\n    void main() {\n\tvec4 resA = texture2D(inputBufferA, vUv);\n\tvec4 resB = texture2D(inputBufferB, vUv);\n    float a = resA.a + resB.a * ( 1.0 - resA.a );\n\n\tvec4 res;\n\tres.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));\n\tres.a = resA.a + resB.a * (1.0 - resA.a);\n\tgl_FragColor = res;\n    gVelocity = vec4(0.0);\n    }\n"}),Ez=class extends yN{constructor(e){super("HelperPass",void 0,e),this.MRTCompatible=!1,this.fullscreenMaterial=Az,this.helperPass=new _z(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new _z(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let t=new iz({preset:tz.LOW,edgeDetectionMode:sN.COLOR});this.effectPass=new FN(this.camera,t),this.rt=new ul(10,10,{minFilter:rs,magFilter:rs,wrapS:$a,wrapT:$a,depthBuffer:!0})}setSize(e,t){this.rt.setSize(e,t),this.effectPass.setSize(e,t)}set sceneHelpers(e){this.helperPass.setScene(e)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(e){this.helperPassOnTop.setScene(e)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(e){this.helperPass.setCamera(e),this.helperPassOnTop.setCamera(e)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(e,t,i){this.rt.depthTexture=t.depthTexture;let n=e.getClearAlpha();e.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(e,this.rt),this.helperPassOnTop.render(e,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=t.texture,e.setClearAlpha(n),e.setRenderTarget(null),e.clear(),e.render(this.scene,this.camera)}},Cz=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Mz=new uh({vertexShader:"#define GLSLIFY 1\n#include <skinning_pars_vertex>\nout vec3 n;void main(){\n#include <beginnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <begin_vertex>\n#include <skinning_vertex>\nvec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}",fragmentShader:"#define GLSLIFY 1\nin vec3 n;void main(){gl_FragColor=vec4(n,1.0);}"}),Pz=new uh({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){\n#ifdef DEBUG\nfloat d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);\n#else\nvec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;\n#endif\n}",uniforms:{texture_ao_lrez:new Ym(null),texture_depth_lrez:new Ym(null),texture_depth_hrez:new Ym(null),near:new Ym(null),far:new Ym(null)}}),Tz=class extends yN{constructor(e,t){super("AmbientOcclusionPass",void 0,t),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,n=1024;this.gBuffer=new ul(i,n,{type:s_?fs:ps,depthTexture:new tp(i,n),minFilter:rs,magFilter:rs}),this.depthBufferHighRes=new ul(i,n,{depthTexture:new tp(i,n)}),this.aoBuffer=new ul(i,n,{minFilter:rs,magFilter:rs}),this.splineScene=e,this.splineCamera=t;let r=new Float32Array(2*Cz.length);for(let s=0;s<Cz.length;s++){let e=2*s;r[e+0]=Cz[s][0],r[e+1]=Cz[s][1]}this.blueNoiseInDiskTexture=new up(r,Cz.length,1,Cs,ps),this.blueNoiseInDiskTexture.wrapS=Ja,this.blueNoiseInDiskTexture.wrapT=Ja,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new uh({vertexShader:"#define GLSLIFY 1\nout vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}",fragmentShader:"#define GLSLIFY 1\nin vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}\n#define USE_GBUFFER_NORMALS\nvoid main(){vec3 view_space_p=get_view_position(v_uv);\n#ifdef USE_GBUFFER_NORMALS\nvec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;\n#else\nvec3 view_space_n=-rebuild_normal(v_uv,view_space_p);\n#endif\nfloat radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}",uniforms:{near:new Ym(null),far:new Ym(null),fov:new Ym(null),proj_info:new Ym(new dl),is_ortho:new Ym(!1),resolution:new Ym(new jo),radius_of_influence:new Ym(8),radius_in_screen_space:new Ym(1),exponent:new Ym(1),ao_color:new Ym(new gl),bias:new Ym(.5),texture_depth:new Ym(null),texture_normals:new Ym(null),texture_blue_noise:new Ym(null),texture_blue_noise_in_disk:new Ym(this.blueNoiseInDiskTexture),frame_index:new Ym(0),fog_enabled:new Ym(!1),fog_near:new Ym(1),fog_far:new Ym(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new ul(i,n,{minFilter:rs,magFilter:rs,wrapS:$a,wrapT:$a,depthBuffer:!1,type:ps});let a=new iz({preset:tz.ULTRA,edgeDetectionMode:sN.COLOR});this.effectPass=new FN(this.camera,a)}initialize(e,t,i){super.initialize(e,t,i),this.effectPass.initialize(e,t,i)}setBlueNoiseTexture(e){this.hbaoMaterial.uniforms.texture_blue_noise.value=e}setSize(e,t){this._width=e,this._height=t,this.depthBufferHighRes.setSize(e,t);let i=this._runHalfRes?.5:1,n=e*i,r=t*i;this.gBuffer.setSize(n,r),this.aoBuffer.setSize(n,r),this.hbaoMaterial.uniforms.resolution.value.set(n,r),this.aaBuffer.setSize(n,r),this.effectPass.setSize(n,r)}get runHalfRes(){return this._runHalfRes}set runHalfRes(e){this._runHalfRes=e,this.setSize(this._width,this._height)}setCamera(e){this.splineCamera=e}setScene(e){this.splineScene=e}setDepthTexture(e){this.depthBufferHighRes.depthTexture=e,Pz.uniforms.texture_depth_hrez.value=e,Pz.needsUpdate=!0}render(e,t,i){this.splineScene.overrideMaterial=Mz;let n=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),e.setRenderTarget(this.gBuffer),e.clear(),e.render(this.splineScene,this.splineCamera),e.setRenderTarget(this.depthBufferHighRes),e.clear(),e.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=n,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let e=this.splineCamera.perspCamera.projectionMatrix.elements,t=2/e[0],i=2/e[5],n=-(1-e[8])/e[0],r=-(1+e[9])/e[5];this.hbaoMaterial.uniforms.proj_info.value.set(t,i,n,r);let a=this.splineCamera.perspCamera.fov*(Math.PI/180),s=this.hbaoMaterial.uniforms.resolution.value.y/(2*Math.tan(.5*a)),o=.5*this.hbaoMaterial.uniforms.radius_of_influence.value*s;this.hbaoMaterial.uniforms.radius_in_screen_space.value=o,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let e=this.splineCamera.orthoCamera.projectionMatrix.elements,t=2/e[0],i=2/e[5],n=-(1+e[12])/e[0],r=-(1-e[13])/e[5];this.hbaoMaterial.uniforms.proj_info.value.set(t,i,n,r);let a=this.hbaoMaterial.uniforms.resolution.value.y/i*.5,s=this.hbaoMaterial.uniforms.radius_of_influence.value*a;this.hbaoMaterial.uniforms.radius_in_screen_space.value=s,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aoBuffer),e.clear(),e.render(this.scene,this.camera),this.fullscreenMaterial=Pz,Pz.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,Pz.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,Pz.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,e.setRenderTarget(e.aoRenderTarget),e.clear(),e.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,e.setRenderTarget(this.aaBuffer),e.clear(),e.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(e,this.aaBuffer,e.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Dz=class extends jN{constructor(){super(new uh({vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D tInput;\nuniform sampler2D tMap;\nuniform vec2 resolution;\nvarying vec2 vUv;\n\nuniform vec2 uResolution;\nuniform vec2 uCoords;\n\n// Draws a rectangle at center <st> with size <size>\nfloat rectangle(vec2 st, vec2 size) {\n    size = vec2(0.5) - size * 0.5;\n    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));\n    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));\n\n    return uv.x * uv.y;\n}\n\nuniform vec2 uSize;\nuniform float uScale;\nuniform float uDPR;\nuniform float uCurrent;\nuniform vec3 uSceneColor;\n\nvoid main() {\n    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n    screenUv *= 1.0 / uDPR;\n\n    vec2 center = vec2(0.5, -0.5);\n    vec2 outsideUv = screenUv;\n    outsideUv += center;\n    outsideUv -= uCoords.xy / uResolution.xy;\n    outsideUv = (outsideUv - 0.5) + 0.5;\n    outsideUv -= center;\n    vec2 s = (uSize / uResolution) * uScale;\n    float isOutside = 1.0 - rectangle(outsideUv, s);\n    \n    vec2 mid = vec2(0.5);\n    vec2 insideUv = (screenUv - mid + s * mid) / s;\n    vec4 background = texture2D(tInput, screenUv);\n    vec4 image = texture2D(tMap, insideUv);\n    gl_FragColor = mix(image, background, isOutside);\n}\n",uniforms:{tInput:new Ym(null),tMap:new Ym(null),uResolution:new Ym(new jo),uSize:new Ym(new jo),uCoords:new Ym(new jo),uScale:new Ym(1),uSceneColor:new Ym(new rl(16711680)),uDPR:new Ym(1),uCurrent:new Ym(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(e){this.uniforms.tMap.value=e}},Rz=[],Oz=class extends jN{constructor(){super(new uh({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D toScene;\nuniform sampler2D fromScene;\nuniform vec2 resolution;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nuniform float mixRatio;\nuniform sampler2D tMixTexture;\nuniform int useTexture;\nuniform float threshold;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( fromScene, screenUv );\n\tvec4 texel2 = texture2D( toScene, screenUv );\n\n\tif (useTexture==1) {\n\t\t\n\t\tvec4 transitionTexel = texture2D( tMixTexture, screenUv );\n\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t} else {\n\t\t\n\t\tgl_FragColor = mix( texel1, texel2, mixRatio );\n\t\t\n\t}\n}\n",uniforms:{toScene:new Ym(null),fromScene:new Ym(null),uResolution:new Ym(new jo),uDPR:new Ym(1),mixRatio:new Ym(0),threshold:new Ym(.1),useTexture:new Ym(0),tMixTexture:{value:Rz[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(e){this.uniforms.fromScene.value=e}},Iz=class extends jN{constructor(){super(new uh({vertexShader:"\nvoid main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"\nuniform sampler2D inputBuffer;\nuniform sampler2D blurredInputBuffer;\nuniform sampler2D overlay;\nuniform float blurIntensity;\n\nuniform vec2 uResolution;\nuniform float uDPR;\n\nvoid main() {\n\tvec2 screenUv = gl_FragCoord.xy / uResolution.xy;\n\tscreenUv *= 1.0 / uDPR;\n\n\tvec4 texel1 = texture2D( overlay, screenUv );\n\tvec4 texel2 = texture2D( inputBuffer, screenUv );\n\tvec4 texel3 = texture2D( blurredInputBuffer, screenUv );\n\n\tfloat blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;\n    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );\n}\n",uniforms:{inputBuffer:new Ym(null),blurredInputBuffer:new Ym(null),overlay:new Ym(null),uResolution:new Ym(new jo),uDPR:new Ym(1),blurIntensity:new Ym(0)}})),this._blurEnabled=!1,this.blurTarget=new ul(1,1,{minFilter:rs,magFilter:rs,wrapS:$a,wrapT:$a}),this.blurPass=new NN({width:window.innerWidth,height:window.innerHeight,kernelSize:HN.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(e){this.uniforms.overlay.value=e}setResolution(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.uniforms.uResolution.value.set(e,t),this.uniforms.uDPR.value=i,this.blurPass.setSize(e,t),this.blurTarget.setSize(e,t),this.blurPass.setSize(e,t)}get uiCanvas(){return this._uiCanvas}set uiCanvas(e){this._uiCanvas=e,e.texture&&(this.uniforms.overlay.value=e.texture);let t=e.frame;if(t){let e=t.data.backgroundBlur,i=e.radius;this._blurEnabled=e.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=i/3}}render(e,t,i,n,r){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(e,t,this.blurTarget,n,r)),super.render(e,t,i,n,r)}};function kz(e,t){return t&&t.enabled&&e.push(t.effect),e}var Lz=e=>Object.values(TN).includes(e)?e:TN.NORMAL,Fz=class extends Co{constructor(e){super(),this.postprocessingState=gC.defaultData,this._scene=new op,this._camera=new NB,this.effects=new Map,this.blueNoiseTexture=new up,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new Rm,this.renderer=e,this.debug=!1,this.effects.set("bloom",new lz),this.effects.set("chromaticAberration",new hz),this.effects.set("vignette",new fz),this.effects.set("noise",new pz),this.effects.set("colorAverage",new dz),this.effects.set("hueSaturation",new uz),this.effects.set("brightnessContrast",new cz),this.effects.set("depthOfField",new mz),this.effects.set("pixelation",new gz),this.effectComposer=new Sz(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new _z(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new bz(this.scene,this.camera,this.renderer),this.aoPass=new Tz(this.scene,this.camera),this.taaPass=new yz,this.taaPass.renderToScreen=!1,this.helperPass=new Ez(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new Dz,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new Iz,this.uiOverlayPass.enabled=!1,this.sceneTransitionPass=new Oz,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(e){void 0!==e?(this.stylesOverlayPass.texture=e,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(e){this.helperPass.sceneHelpers=e}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(e){this.helperPass.sceneHelpersOnTop=e}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(e){this._scene=e,this.opaquePass.setScene(e),this.transmissionPass.setScene(e),this.aoPass.setScene(e)}get camera(){return this._camera}set camera(e){let t=this._camera!==e;this._camera=e,this.opaquePass.setCamera(e),this.transmissionPass.setCamera(e),t&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(e),this.helperPass.setCamera(e),this.effects.get("depthOfField").setCamera(e)}updateRenderToScreen(){let e=!1;for(let t=this.effectComposer.passes.length-1;t>=0;t--){let i=this.effectComposer.passes[t];!0!==i.enabled||e||!this._renderToScreen?i.renderToScreen=!1:(i.renderToScreen=!0,e=!0)}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(e){this.blueNoiseTexture=new up(e,128,128),this.blueNoiseTexture.wrapS=Ja,this.blueNoiseTexture.wrapT=Ja,this.blueNoiseTexture.minFilter=ts,this.blueNoiseTexture.magFilter=ts,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(e,t,i,n,r,a,s,o){this.aoPass.enabled=e,this.aoPass.radius=t,this.aoPass.bias=i,this.aoPass.aoColor=n,this.aoPass.fogEnabled=r,this.aoPass.fogNear=a,this.aoPass.fogFar=s,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(e){this.transmissionPass.enabled=e,this.opaquePass.hasTransmissionPass=e}_initPasses(){var e,t;if(null!==(e=this.uvEffectPass)&&void 0!==e&&e.dispose(),null!==(t=this.effectPass)&&void 0!==t&&t.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){var i;let e=[this.effects.get("pixelation")].reduce(kz,[]);e.length>0&&(this.uvEffectPass=new FN(this.camera,...e),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let t=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce(kz,[]);if(t.length>0&&(this.effectPass=new FN(this.camera,...t),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),null!==(i=this.effects.get("depthOfField"))&&void 0!==i&&i.enabled&&void 0!==window)){let e=this.renderer.viewportWidth,t=this.renderer.viewportHeight;this.renderer.setSize(e-1,t-1),this.renderer.setSize(e,t)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass)}_initCopyPass(){if(this._savePass)return;let e=new jo;this.renderer.getDrawingBufferSize(e),this._rt=new ul(e.x,e.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Ja,wrapT:Ja}),this._rt.samples=0,this._savePass=new bN(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(e){this._rt=e,this._savePass=new bN(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(e){if(this._renderToScreen===e)return;let t=this.effectComposer;!t||(!0===e?t.removePass(this._savePass):t.addPass(this._savePass),this._renderToScreen=e,this.updateRenderToScreen())}set sceneTransitionFromTexture(e){e!==this.sceneTransitionPass.texture&&(null!==e?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=e)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(e){let{enabled:t,...i}=e,n=!1;t!==this.postprocessingState.enabled&&(n=!0);for(let r of Object.entries(i)){let e=r[1],t=this.effects.get(r[0]);if(t){t.enabled!==e.enabled&&(n=!0),t.enabled=e.enabled;for(let[i,n]of Object.entries(e))"blendFunction"===i?t.blendFunction=Lz(n):t[i]=n}}this.postprocessingState=e,n&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(e,t,i,n){e instanceof dl?(this.effectComposer.inputBuffer.scissor.set(e.x,e.y,e.z,e.w),this.effectComposer.outputBuffer.scissor.set(e.x,e.y,e.z,e.w)):(this.effectComposer.inputBuffer.scissor.set(e,t,i,n),this.effectComposer.outputBuffer.scissor.set(e,t,i,n));let r=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(r),this.effectComposer.outputBuffer.scissor.multiplyScalar(r),this.renderer.setScissor(e,t,i,n)}setScissorTest(e){this.effectComposer.inputBuffer.scissorTest=e,this.effectComposer.outputBuffer.scissorTest=e,this.renderer.setScissorTest(e)}setViewport(e,t,i,n){e instanceof dl?(this.effectComposer.inputBuffer.viewport.copy(e),this.effectComposer.outputBuffer.viewport.copy(e)):(this.effectComposer.inputBuffer.viewport.set(e,t,i,n),this.effectComposer.outputBuffer.viewport.set(e,t,i,n))}resize(e,t,i){if(this.effectComposer.setSize(e,t,i),this._rt){let i=this.renderer.getPixelRatio();this._rt.setSize(e*i,t*i)}}dispose(){var e,t;null!==(e=this.uvEffectPass)&&void 0!==e&&e.dispose(),null!==(t=this.effectPass)&&void 0!==t&&t.dispose(),this.effectComposer.dispose()}},Bz=Th.lights_fragment_begin,Nz=Th.shadowmask_pars_fragment,zz=null,Uz=new uh({vertexShader:"\nattribute vec3 randomColor;\nvarying vec3 vNormal;\nflat out vec3 vColor;\n#include <skinning_pars_vertex>\n\nvoid main()\n{\n#include <beginnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\nvec3 transformed = vec3(position);\n#include <skinning_vertex>\n\nvNormal = normal;\nvColor = randomColor;\ngl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));\n}\n",fragmentShader:"\nuniform float depthContrast;\nvarying vec3 vNormal;\nflat in vec3 vColor;\nvoid main()\n{\nvec3 normal = (normalize(vNormal)).rgb;\n\nfloat contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;\n\nvec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);\ngl_FragColor = vec4(resultColor, vColor.r);\ngl_FragColor = vec4(resultColor, vColor.r);\n}\n",uniforms:{depthContrast:{value:1}}}),jz=new hl,Vz=new jo,Gz=class extends ap{constructor(e){var t;super(e),t=this,this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new jo,this.pipeline=new Fz(this),this.dummyCamera=new NB,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.getContext(),a=0;e&&(a|=r.COLOR_BUFFER_BIT),i&&(a|=r.DEPTH_BUFFER_BIT),n&&(a|=r.STENCIL_BUFFER_BIT),r.clear(a),r.clearBufferfv(r.COLOR,1,[0,0,0,1])},this.autoClear=!1;let i=this.setPixelRatio.bind(this),n=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=ia,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(uE){console.warn(uE)}this.setPixelRatio=e=>{this._pixelRatio!==e&&(this._pixelRatio=e,i(e))},this.setSize=function(e,i){var r,a;let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];(t.viewportWidth!==e||t.viewportHeight!==i)&&(t.viewportWidth=e,t.viewportHeight=i,n(e,i,s),null!==(r=t.normalRenderTarget)&&void 0!==r&&r.setSize(e*t._pixelRatio,i*t._pixelRatio),t._resizeTransmission(e,i),null!==(a=t.transmissionDepthTarget)&&void 0!==a&&a.setSize(e*t._pixelRatio/2,i*t._pixelRatio/2),t.pipeline.resize(e,i,s))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){void 0===this.aoRenderTarget&&(this.aoRenderTarget=new ul(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:rs,magFilter:rs,wrapS:$a,wrapT:$a,depthBuffer:!1}))}_resizeTransmission(e,t){var i,n;null!==(i=this.transmissionRenderTarget)&&void 0!==i&&i.setSize(e*this._pixelRatio/(this.hdTransmission?1:2),t*this._pixelRatio/(this.hdTransmission?1:2)),null===(n=this.aoRenderTarget)||void 0===n||n.setSize(e*this._pixelRatio/1,t*this._pixelRatio/1)}get hdTransmission(){return 1===Hk.transmissionLod.value}set hdTransmission(e){Hk.transmissionLod.value=!0===e?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){void 0===this.transmissionRenderTarget&&(this.transmissionRenderTarget=new ul(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:ss,magFilter:rs,wrapS:$a,wrapT:$a,depthBuffer:!1}),this.transmissionDepthTarget=new ul(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:ts,magFilter:ts,depthBuffer:!1}))}createNormalRenderTarget(){void 0===this.normalRenderTarget&&(this.normalRenderTarget=new ul(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:ts,magFilter:ts,type:ps,depthTexture:new tp(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(e,t,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),t.traverseEntity((e=>{e.layers.isEnabled(8)&&(e.copyPreviousMatrix=!1)})),this.setRenderTarget(this.normalRenderTarget),this.clear(),Uz.uniforms.depthContrast.value=i instanceof NB?(i.far-i.near)/1e4:1,t.overrideMaterial=Uz,this.render(t,i),this.setClearColor(t.bgColor,t.bgColor.a),this.setRenderTarget(null),t.overrideMaterial=e.wireframeState?Uj:null,i.layers.enable(0),i.layers.enable(3),t.traverseEntity((e=>{e.layers.isEnabled(8)&&(e.copyPreviousMatrix=!0)})))}renderSplineSceneWithDummyCamera(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.dummyCamera.updateCameraState(t.dataPatched),this.dummyCamera.matrix.copy(t.matrixWorld);let n=t.height,r=t.width,a=this.viewportWidth/this.viewportHeight;r<n?r=n*a:n=r/a,this.dummyCamera.setViewplaneSize(r,n);for(let s=0;s<i;s++)this.renderSplineScene(e,this.dummyCamera)}renderSplineScene(e,t){var i;let{sceneHelpers:n,sceneHelpersOnTop:r,overrideTransmission:a,overrideNormal:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=e instanceof Vj?e.activePage:e,l=o.visible;o.visible=!0;let c=o.scene;this.xr.enabled&&(!1===this.isXRCopyPassSet&&null!==this.getRenderTarget()&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(t)),this.setClearColor(o.bgColor,o.bgColor.a),o.penumbraSizeArray.forEach(((e,t)=>{Hk.penumbraSize.value[t]=e})),Hk.pixelRatioNode.value=this.getPixelRatio(),0!==this.resolution.x&&0!==this.resolution.y?Hk.resolution.value.set(this.resolution.x,this.resolution.y):Hk.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),void 0!==s?(Hk.normalRenderTarget.value=s,Hk.normalRenderTargetDepth.value=jz):c.needsNormal()&&(this.createNormalRenderTarget(),Hk.normalRenderTarget.value=this.normalRenderTarget.texture,Hk.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(c,o,t));let h=o.data.ao,d=h.occlusion;if(d&&(this.createAORenderTarget(),Hk.aoRenderTarget.value=this.aoRenderTarget.texture),Hk.aoEnabled.value=d,this.pipeline.setAmbientOcclusionParams(h.occlusion,h.radius,h.bias,o.aoColor,null!==o.fog,o.backupFog.near,o.backupFog.far,h.aoFullRes&&!s_),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&null!==(i=o.uiCanvas)&&void 0!==i&&i.enabled&&o.uiCanvas.texture&&o.uiCanvas.texture.image.width>0){let e=this.getSize(Vz),t=this.getPixelRatio();(o.uiCanvas.width!==this.viewportWidth||o.uiCanvas.height!==this.viewportHeight||o.uiCanvas.dpr!==t)&&o.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},t),o.uiCanvas.render(),this.pipeline.uiOverlayPass.uiCanvas=o.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(e.x,e.y,t),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();let u=!1;if(void 0!==a)Hk.transmissionRenderTarget.value=a,Hk.transmissionRenderTargetDepth.value=jz,this.pipeline.setTransmissionPassEnabled(!1);else{let e=c.needsTransmission();e&&(void 0===this.transmissionRenderTarget&&(u=!0),this.createTransmissionRenderTarget(),Hk.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Hk.aspectRatio.value=function(e,t){return e>=t?new jo(t/e,1):new jo(1,e/t)}(this.viewportWidth,this.viewportHeight),Hk.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(e)}t.layers.enable(3),t.layers.enable(8),this.pipeline.sceneHelpers=n,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=o,this.pipeline.camera=t,u&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==o.postprocessing&&(this.pipeline.updatePostprocessing(o.postprocessing),!n&&!r&&this.pipeline.disableHelpers()),void 0!==this.clearAlphaOverride&&this.setClearAlpha(this.clearAlphaOverride),o.overrideMaterial=c.wireframeState?Uj:null,this.pipeline.render(),Hk.frameIndex.value=(Hk.frameIndex.value+1)%16,t instanceof NB&&t.copyHistory(),o.visible=l}renderFromSceneForSceneTransitionPass(e,t,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(e,t),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let n=this.pipeline.sceneTransitionPass.uniforms;n.uDPR.value=window.devicePixelRatio,n.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){var e,t,i,n,r;this._superDispose(),this.pipeline.dispose(),null!==(e=this.aoRenderTarget)&&void 0!==e&&e.dispose(),null!==(t=this.transmissionRenderTarget)&&void 0!==t&&t.dispose(),null!==(i=this.transmissionDepthTarget)&&void 0!==i&&i.dispose(),null!==(n=this.normalRenderTarget)&&void 0!==n&&n.dispose(),null===(r=this.normalRenderTarget)||void 0===r||null===(r=r.depthTexture)||void 0===r||r.dispose()}},Hz=class extends(xB(hg)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:10066329),this.object=e,this.added=!1,this.name="DirectionalLightHelper: ".concat(e.uuid)}raycast(e,t){AB(this.object,Hz.geometryHelper,e,t)}},Wz=class extends(xB(sg)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:15,arguments.length>2&&void 0!==arguments[2]?arguments[2]:6710886),this.object=e,this.name="PointLightHelper: ".concat(e.uuid)}raycast(e,t){AB(this.object,Wz.geometryHelper,e,t)}},qz=class extends(xB(ag)){constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:6710886),this.object=e,this.name="SpotLightHelper: ".concat(e.uuid)}raycast(e,t){AB(this.object,qz.geometryHelper,e,t)}update(){if(void 0!==this.object){let e=qz._vector,t=this.object.distance?this.object.distance:1e3,i=t*Math.tan(this.object.angle);this.cone.scale.set(i,i,t),e.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(e);let n=void 0!==this.color?this.color:this.light.color;if(this.cone.material instanceof Array)for(let r=0,a=this.cone.material.length;r<a;r++)this.cone.material[r].color.set(n);else this.cone.material.color.set(n)}}},Xz=qz;Xz._vector=new gl;var Yz,Qz=class extends(HB(Pm,Hz)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.top=1250,n.bottom=-1250,n.right=1250,n.left=-1250,n.near=-1e4,n.far=2500;let r=new pg(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof pg&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t);let i=void 0!==e.depth&&e.depth!==this.shadow.camera.far||void 0!==e.size&&e.size/2!==this.shadow.camera.right;void 0!==e.size&&function(e,t){e.shadow.camera.right=t/2,e.shadow.camera.left=-t/2,e.shadow.camera.top=t/2,e.shadow.camera.bottom=-t/2,e.shadow.needsUpdate=!0}(this,e.size),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),i&&this.update()}},Kz=new gl,Zz=new gl,Jz=new ml,$z=class extends(HB(wm,Xz)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=2*Uo.RAD2DEG*this.angle,n.aspect=1,n.near=100,n.far=2500;let r=new pg(this.shadow.camera);r.visible=!1,this.gizmos.shadowmap=r,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let e in this.gizmos){let t=this.gizmos[e];t instanceof pg&&t.update()}}updateMatrixWorld(e){super.updateMatrixWorld(e),Zz.setFromMatrixPosition(this.matrixWorld),Jz.setFromRotationMatrix(this.matrixWorld),Kz.copy(this.up).applyQuaternion(Jz).negate().multiplyScalar(this.distance),this.target.position.copy(Zz).add(Kz),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.angle&&(this.angle=e.angle),void 0!==e.penumbra&&(this.penumbra=e.penumbra),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.penumbraSize&&t.scene.markPenumbraSizeDirty(),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function eU(e,t){return[[e[0][0]*t[0][0]+e[0][1]*t[1][0],e[0][0]*t[0][1]+e[0][1]*t[1][1]],[e[1][0]*t[0][0]+e[1][1]*t[1][0],e[1][0]*t[0][1]+e[1][1]*t[1][1]]]}function tU(e){return[[e[0][0],e[1][0]],[e[0][1],e[1][1]]]}function iU(e){let[t,i,n]=function(e){let t=(e[0][0]+e[1][1])/2,i=(e[0][0]-e[1][1])/2,n=(e[1][0]+e[0][1])/2,r=(e[1][0]-e[0][1])/2,a=Math.sqrt(t*t+r*r),s=Math.sqrt(i*i+n*n),o=a+s,l=a-s,c=Math.atan2(n,i),h=Math.atan2(r,t),d=(h-c)/2,u=(h+c)/2,p=[[Math.cos(u),Math.sin(u)],[-Math.sin(u),Math.cos(u)]],f=[[o,0],[0,l]],m=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]];return p[0][0]*=-1,p[0][1]*=-1,m[0][0]*=-1,m[1][0]*=-1,[p,f,m]}(e),r=eU(t,tU(n)),a=eU(eU(n,i),tU(n));return{rotation:Math.atan2(r[1][0],r[0][0]),scale:[a[0][0],a[1][1]],shear:[a[0][1]/a[1][1],a[1][0]/a[0][0]]}}(e=>{function t(e){return[e[0],e[3],e[1],e[4],e[2],e[5]]}e.identity=function(){return[1,0,0,0,1,0,0,0,1]},e.copy=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.identity();for(let e=0,n=t.length;e<n;e++)i[e]=t[e];return i},e.create=function(t,i,n,r,a,s){return e.setAbcdef(e.identity(),t,i,n,r,a,s)},e.setAbcdef=function(e,t,i,n,r,a,s){return e[0]=t,e[1]=n,e[2]=a,e[3]=i,e[4]=r,e[5]=s,e},e.append=function(i,n){let[r,a,s,o,l,c]=t(i),[h,d,u,p,f,m]=t(n),g=h*r+d*s,v=h*a+d*o,y=u*r+p*s,b=u*a+p*o,x=f*r+m*s+l,w=f*a+m*o+c;return e.create(g,v,y,b,x,w)},e.prepend=function(i,n){let[r,a,s,o,l,c]=t(i),[h,d,u,p,f,m]=t(n),g=r,v=a,y=s,b=o;(1!==h||0!==d||0!==u||1!==p)&&(g=r*h+a*u,v=r*d+a*p,y=s*h+o*u,b=s*d+o*p);let x=l*h+c*u+f,w=l*d+c*p+m;return e.create(g,v,y,b,x,w)},e.getAbcdef=t,e.invert=function(t){let[i,n,r,a,s,o]=e.getAbcdef(t),l=i*a-n*r,c=a/l,h=-n/l,d=-r/l,u=i/l,p=(r*o-a*s)/l,f=-(i*o-n*s)/l;return e.create(c,h,d,u,p,f)},e.apply=function(t,i){let[n,r]=t,[a,s,o,l,c,h]=e.getAbcdef(i);return[a*n+o*r+c,s*n+l*r+h]},e.applyInverse=function(t,i){let[n,r,a,s,o,l]=e.getAbcdef(i),c=1/(n*s+a*-r),[h,d]=t;return[s*c*h+-a*c*d+(l*a-o*s)*c,n*c*d+-r*c*h+(-l*n+o*r)*c]},e.scale=function(t,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,[r,a,s,o,l,c]=e.getAbcdef(t);return e.setAbcdef(t,r*i,a*n,s*i,o*n,l*i,c*n),t},e.rotate=function(t,i){let n=Math.cos(i),r=Math.sin(i),[a,s,o,l,c,h]=e.getAbcdef(t);return e.setAbcdef(t,a*n-s*r,a*r+s*n,o*n-l*r,o*r+l*n,c*n-h*r,c*r+h*n),t},e.rotateAround=function(t,i,n){let[r,a]=n,s=e.translate(t,-r,-a);return s=e.rotate(s,i),s=e.translate(s,r,a),s},e.translate=function(t,i,n){let[r,a,s,o,l,c]=e.getAbcdef(t);return e.setAbcdef(t,r,a,s,o,l+i,c+n),t},e.setTranslate=function(t,i,n){let[r,a,s,o]=e.getAbcdef(t);return e.setAbcdef(t,r,a,s,o,i,n),t},e.setPosition=function(t,i,n){let[r,a,s,o]=e.getAbcdef(t);return e.setAbcdef(t,r,a,s,o,i,n),t},e.getScale=function(t){let[i,n,r,a]=e.getAbcdef(t);return[Math.sqrt(i*i+n*n),Math.sqrt(r*r+a*a)]},e.getPosition=function(t){let[,,,,i,n]=e.getAbcdef(t);return[i,n]},e.getRotation=function(t,i){return e.decompose(t,i).rotation},e.decompose=function(t,i){let[n,r,a,s,o,l]=e.getAbcdef(t),{rotation:c,scale:h,shear:d}=iU([[n,a],[r,s]]);return{position:[o+(i[0]*n+i[1]*a)-i[0],l+(i[0]*r+i[1]*s)-i[1]],scale:h,rotation:c,shear:d,pivot:i}},e.compose=function(t,i,n,r){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],[s,o]=t,[l,c]=r,[h,d,u,p]=function(e){let{rotation:t,scale:i,shear:n}=e,r=Math.cos(t),a=Math.sin(t),s=eU([[r,-a],[a,r]],[[i[0],n[0]*i[1]],[n[1]*i[0],i[1]]]);return[s[0][0],s[1][0],s[0][1],s[1][1]]}({rotation:n,scale:i,shear:a}),f=s-(l*h+c*u)+l,m=o-(l*d+c*p)+c;return e.create(h,d,u,p,f,m)}})(Yz||(Yz={}));var nU=Math.PI/180;Math.PI;var rU=class{constructor(e,t,i){var n;this.uuid=e,this.data=t,this.localMatrix=Yz.identity(),this.worldMatrix=Yz.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new fU,this._recursiveBBox=new fU,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=function(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}}}(),this.dpr=null!==(n=i.dpr)&&void 0!==n?n:1,this.dataPatched=t}project(e,t){let i=this.worldMatrix;return t&&(i=Yz.append(t.worldMatrix,i)),Yz.applyInverse(e,i)}intersects(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([e,t],i),n)}intersectsInLocalSpace(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{min:n,max:r}=i?this.recursiveBBox:this.singleBBox;return e>=n[0]&&e<=r[0]&&t>=n[1]&&t<=r[1]}applyTransforms(e){e.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Yz.compose(this.position,this.scale,function(e){return e*nU}(this.rotation),BM.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(e,t,i){let n=this.parent;t&&null!==n&&void 0!==n&&n.updateWorldMatrix(e,!0,!1),e&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Yz.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Yz.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return BM.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors((e=>{e.resetBBoxNeedsUpdateSelf()}))}updateTransformState(e){let t=!1;void 0!==e.position&&(t=!0,this.position=e.position),void 0!==e.rotation&&(t=!0,this.rotation=e.rotation),void 0!==e.scale&&(t=!0,this.scale=e.scale),void 0!==e.shear&&(t=!0,this.shear=e.shear),t&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(e,t,i){0===e.type&&void 0!==e.props.visible&&(this.visible=e.props.visible),this.data=t,this.data=t;let n=e,r=_S(e.path,["states","*"]);if(null!==r){if(0===e.type){let[t]=r;if((null===this||void 0===this?void 0:this.stateSelection)===t){let t={...e.props};if(delete t.name,Object.values(e.props).some((e=>void 0===e))){let i=this.data;if(void 0!==i){let n=gS.zoom(i,e.path.slice(2));if(n)for(let i in e.props)void 0===e.props[i]&&i in n&&(t[i]=n[i])}}n={...e,props:t,path:e.path.slice(2)}}}}else if(0===e.type){let t=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(void 0!==t){if(void 0!==e.props.name&&t.name){let{name:e,...i}=t;t=i}let i=gS.removeOverridden(e.path,e.props,t);n={...e,props:i}}}this.updateByPatchedOpBase(n,CM.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0!==this.data.states.length||i){for(let e of this.data.states)CM.toOps(this.data,e.data).forEach((e=>{let i=q_.replaceProps(e,this.data);this.dataPatched=this.data,this.updateByPatchedOp(i,this.data,t)}));if(null!==e){let i=this.data.states.data(e);i&&(this.dataPatched=CM.patch(this.data,i),CM.toOps(this.data,i).forEach((e=>{this.updateByPatchedOp(e,this.dataPatched,t)})))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=e}}updateState(e,t){void 0!==e.name&&(this.name=e.name),void 0!==e.visible&&(this.visible=e.visible),this.updateTransformState(e)}updateByPatchedOpBase(e,t,i){this.dataPatched=t,this.updateByPatchedOp(e,t,i)}updateByPatchedOp(e,t,i){0===e.path.length&&0===e.type&&this.updateState(e.props,i),this.requestRender()}traverseFrameAncestors(e){this.traverseAncestors((t=>{"frame2d"===t.data.type&&e(t)}))}traverseAncestors(e){let t=this.parent;for(;t;)e(t),t=t.parent}requestRender(){this.traverseFrameAncestors((e=>{e.requestRender()}))}clone(e){let t=new rU(this.uuid,this.data,e);return t.parent=void 0,t}addEventListener(e,t){this.emitter.on(e,t)}removeEventListener(e,t){this.emitter.off(e,t)}dispatchEvent(e){var t;this.emitter.emit(e.type,{...e,target:null!==(t=e.target)&&void 0!==t?t:this})}traverseSortNextHelper(){let e=this.parent;if(e){let t=e.children;if(t){let i=t.indexOf(this)+1;return t[i]?t[i]:e.traverseSortNextHelper()}}}sortNext(){let e=this.children;return e&&e.length>0&&e[0]?e[0]:this.traverseSortNextHelper()}isDescendantOf(e){e instanceof rU&&(e=e.uuid);let t=this;for(;t.parent;){if(t.parent.uuid===e)return!0;t=t.parent}return!1}},aU=class extends rU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.context=i,this.children=[]}add(e){e.parent&&e.parent instanceof aU&&e.parent.remove(e),this.children.push(e),e.parent=this}remove(e){let t=this.children.indexOf(e);t>=0&&(this.children.splice(t,1),e.parent=void 0)}traverse(e){let t=e(this);if(!0!==t)for(let i of this.children)i instanceof aU?i.traverse(e):t=e(i)}intersectsChildren(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];for(let s of this.children){let o=s instanceof sU;if(s instanceof aU&&!o&&a&&s.intersectsChildren(e,t,i,n,r,!1),s.intersects(e,t,i,o)&&(r.push(s),n))break}return r}updateWorldMatrix(e,t,i){if(super.updateWorldMatrix(e,t,i),i&&this.children)for(let n of this.children)n.updateWorldMatrix(e,!1,!0)}find(e){let t;return this.traverse((i=>{i.uuid===e&&(t=i)})),t}innerDrawChildren(e){for(let t=this.children.length-1;t>=0;t--)this.children[t].draw(e)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse((e=>{e.resetBBoxNeedsUpdateSelf()}))}clone(e){let t=new aU(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},sU=class extends aU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.updateState(t,i)}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.innerDrawChildren(e),e.restore())}clone(e){let t=new sU(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}};function oU(e,t){let[[i,n],[r,a]]=e,[[s,o],[l,c]]=t,h=(i-r)*(o-c)-(n-a)*(s-l);if(0===h)return!1;let d=((i-s)*(o-c)-(n-o)*(s-l))/h,u=-((i-r)*(n-o)-(n-a)*(i-s))/h;return d>=0&&d<=1&&u>=0&&u<=1}var lU,cU,hU,dU,uU=[[-1,1],[-1,-1],[1,-1],[1,1]],pU=(e,t,i)=>{let n=e.getCenter(),r=e.getHalfSize(),a=Yz.append(t,e.worldMatrix);0===r[0]&&0===r[1]?i.push(Yz.apply(n,a)):uU.forEach((e=>{let t=[e[0]*r[0]+n[0],e[1]*r[1]+n[1]];i.push(Yz.apply(t,a))}))},fU=class{constructor(){this.matrix=Yz.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(),this.makeEmpty(),Yz.copy(e.worldMatrix,this.matrix);let i=Yz.invert(e.worldMatrix);this.expandByObjectSize(e,i,t)}expandByObjectSize(e,t){let i=[];!0===(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e instanceof aU?e.traverse((e=>{e.visible&&pU(e,t,i)})):pU(e,t,i),this.setFromPoints(i)}getCenter(){let[e,t]=this.min,[i,n]=this.getHalfSize();return Yz.apply([e+i,t+n],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[.5*(this.max[0]-this.min[0]),.5*(this.max[1]-this.min[1])]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(e){this.makeEmpty();for(let t of e)this.expandByPoint(t)}expandByPoint(e){this.min=[Math.min(this.min[0],e[0]),Math.min(this.min[1],e[1])],this.max=[Math.max(this.max[0],e[0]),Math.max(this.max[1],e[1])]}computeVertices(){let[e,t]=this.getHalfSize(),i=this.getCenter(),[n,r,a,s]=Yz.getAbcdef(this.matrix),o=Yz.create(n,r,a,s,i[0],i[1]);this.vertices=uU.map((i=>{let[n,r]=i;return Yz.apply([n*e,r*t],o)}))}computeEdges(){this.edges=[];for(let e=0,t=this.vertices.length;e<t;++e)this.edges.push([this.vertices[e],this.vertices[(e+1)%t]])}project(e,t){let i=this.matrix;return t&&(i=Yz.append(t.worldMatrix,i)),Yz.applyInverse(e,i)}intersects(e,t,i){return this.intersectsInLocalSpace(...this.project([e,t],i))}intersectsInLocalSpace(e,t){let{min:i,max:n}=this;return e>=i[0]&&e<=n[0]&&t>=i[1]&&t<=n[1]}containsPoint(e){let[t,i]=e,[n,r]=this.min,[a,s]=this.max;return t>=n&&t<=a&&i>=r&&i<=s}intersectsBBox2D(e){for(let t=0,i=this.edges.length;t<i;t++){let i=this.edges[t];for(let t=0,n=e.edges.length;t<n;t++){if(oU(i,e.edges[t]))return!0}}for(let t=0,i=e.vertices.length;t<i;t++){let i=e.vertices[t];if(this.containsPoint(i))return!0}return!1}ensureMinMax(){let e=this.min,t=this.max;this.min=[Math.min(e[0],t[0]),Math.min(e[1],t[1])],this.max=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]}copy(e){this.min=[...e.min],this.max=[...e.max],Yz.copy(e.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let e=new fU;return e.copy(this),e}},mU=new Promise((e=>{lU=e})),gU=!1;function vU(){if(!gU)return cU||(cU=async function(){var e;let t=await __webpack_require__.e(160).then(__webpack_require__.bind(__webpack_require__,1160));lU(null!==(e=t.default)&&void 0!==e?e:t),gU=!0}(),cU)}function yU(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{("Mesh"===i.type&&"UIGeometry"===i.geometry.type||"Page"===i.type&&void 0!==i.uiFrame)&&(t=!0)})),t}var bU=Yz.identity(),xU=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.canvas=e,this._dpr=t,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=AE.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=AE.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=e.getBoundingClientRect();e.width=i.width*t,e.height=i.height*t}catch{console.log(e.width,t)}this._currentM3Transform=bU,this._currentTransform=new Float32Array(bU)}get dpr(){return this._dpr}set dpr(e){this._dpr=e,this._isSizeDirty=!0}async init(){var e,t;if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await async function(e){let t=await mU;hU||(dU||(dU=t({locateFile:()=>e})),hU=await dU)}(this.wasmURL),this._surface=hU.MakeWebGLCanvasSurface(this.canvas),this.ctx=null===(e=this._surface)||void 0===e?void 0:e.getCanvas(),this._paint=new hU.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(hU.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(hU.PaintStyle.Stroke),null===(t=this.ctx)||void 0===t||t.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(e){this._currentM3Transform=e,this._currentTransform.set(e)}async loadFont(e,t){let i=await(await fetch(e)).arrayBuffer();this.registerFont(i,t)}registerFont(e,t){if(this._fonts.has(t))return;let i=hU.FontMgr.FromData(e);if(!i)throw new Error("Invalid font data for "+t);this._fonts.set(t,i)}get width(){return this._width}get height(){return this._height}set strokeColor(e){this._paintStroke&&this._paintStroke.setColor(_U(e),hU.ColorSpace.DISPLAY_P3)}set fillColor(e){this._paintFill&&this._paintFill.setColor(_U(e),hU.ColorSpace.DISPLAY_P3)}set lineWidth(e){this._paintStroke&&this._paintStroke.setStrokeWidth("center"===this._strokeMode?e:2*e)}set strokeMode(e){this._strokeMode=e}set dropShadowBlur(e){this._dropShadowBlur=e}set dropShadowColor(e){this._dropShadowColor=e}set dropShadowOffsetX(e){this._dropShadowOffsetX=e}set dropShadowOffsetY(e){this._dropShadowOffsetY=e}set innerShadowBlur(e){this._innerShadowBlur=e}set innerShadowColor(e){this._innerShadowColor=e}set innerShadowOffsetX(e){this._innerShadowOffsetX=e}set innerShadowOffsetY(e){this._innerShadowOffsetY=e}set innerShadowSpread(e){this._innerShadowSpread=e}set layerBlur(e){this._layerBlur=e}set backgroundBlur(e){this._backgroundBlur=e}clear(){var e;null===(e=this.ctx)||void 0===e||e.clear(hU.TRANSPARENT)}save(){var e;null===(e=this.ctx)||void 0===e||e.save()}restore(){var e;null===(e=this.ctx)||void 0===e||e.restore()}beginPath(){var e;null!==(e=this._currentPath)&&void 0!==e&&e.delete(),this._currentPath=new hU.Path}closePath(){let e=this._currentPath;if(e){if(e.isEmpty())return;let t=e.getBounds();(t[3]-t[1]||t[2]-t[0])&&e.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(e,t,i,n){var r;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=hU.XYWHRect(e,t,i,n);if(0===a&&0===s&&0===l&&0===o)null===(r=this.ctx)||void 0===r||r.clipRect(c,hU.ClipOp.Intersect,!0);else{var h;let e=hU.RRectXY(c,a,a);e[4]=e[5]=a,e[6]=e[7]=s,e[8]=e[9]=o,e[10]=e[11]=l,null===(h=this.ctx)||void 0===h||h.clipRRect(e,hU.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let e=Yz.invert(this.currentTransform);this.ctx.concat(e);let t=Yz.translate(Yz.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(t),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.ctx&&this._currentPath){let u,p=!1;if(i&&this._hasDropShadow()){var n,r,a;let i,s=e.copy();s.setColor(_U(this._dropShadowColor)),this._dropShadowBlur>0&&(i=hU.MaskFilter.MakeBlur(hU.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(null!==(n=null===(r=this.camera)||void 0===r?void 0:r.scale)&&void 0!==n?n:1),!1),s.setMaskFilter(i)),this.ctx.save(),this.ctx.clipPath(this._currentPath,hU.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),t(s),this.ctx.restore(),s.delete(),null===(a=i)||void 0===a||a.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,hU.ClipOp.Intersect,!0);let t=hU.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,hU.TileMode.Clamp,null),i=e.copy();i.setImageFilter(t),i.setAlphaf(1);let n=this._currentPath.computeTightBounds();this.ctx.saveLayer(i,n,null,hU.SaveLayerInitWithPrevious),this.ctx.drawColor(e.getColor()),this.ctx.restore(),this.ctx.restore(),i.delete(),t.delete(),p=!0}if(this._layerBlur>0){var s,o;let i=e.copy();u=hU.MaskFilter.MakeBlur(hU.BlurStyle.Normal,this._layerBlur*this.dpr*(null!==(s=null===(o=this.camera)||void 0===o?void 0:o.scale)&&void 0!==s?s:1),!1),i.setMaskFilter(u),t(i),i.delete(),u.delete(),p=!0}if(p||t(e),i&&this._hasInnerShadow()){var l,c,h,d;let e,t=new hU.Paint;t.setAntiAlias(!0),t.setStyle(hU.PaintStyle.Fill),t.setColor(_U(this._innerShadowColor)),this._innerShadowBlur>0&&(e=hU.MaskFilter.MakeBlur(hU.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(null!==(l=null===(c=this.camera)||void 0===c?void 0:c.scale)&&void 0!==l?l:1),!1),t.setMaskFilter(e));let i=this._currentPath.computeTightBounds(),[n,r,a,s]=i,o=a-n,u=s-r;this.ctx.save(),this.ctx.clipPath(this._currentPath,hU.ClipOp.Intersect,!0),this.ctx.saveLayer(t,i,null,hU.SaveLayerInitWithPrevious),null!==(h=this.ctx)&&void 0!==h&&h.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(hU.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+o+Math.abs(2*this._innerShadowOffsetX),2e3+u+Math.abs(2*this._innerShadowOffsetY)),t),t.setBlendMode(hU.BlendMode.Clear),this.ctx.drawPath(this._currentPath,t),this.ctx.restore(),this.ctx.restore(),t.delete(),null===(d=e)||void 0===d||d.delete()}}}_paintInner(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.ctx&&this._currentPath&&e){let i=this.ctx,n=this._currentPath;this._applyEffectsToPaint(e,(e=>{let r=!1;!t&&"center"!==this._strokeMode&&(i.save(),i.clipPath(n,"outside"===this._strokeMode?hU.ClipOp.Difference:hU.ClipOp.Intersect,!0),r=!0),i.drawPath(n,e),r&&i.restore()}),t)}}_hasDropShadow(){var e;return(null===(e=this._dropShadowColor)||void 0===e?void 0:e.a)>0}_hasInnerShadow(){var e;return(null===(e=this._innerShadowColor)||void 0===e?void 0:e.a)>0}path(e){var t;null===(t=this._currentPath)||void 0===t||t.addPath(hU.Path.MakeFromSVGString(e))}ellipse(e,t,i,n,r,a,s,o){var l;if(!wU([e,t,i,n])||!this._currentPath)return;if(i<0||n<0)throw Error("radii cannot be negative");let c=hU.XYWHRect(e-i,t-n,2*i,2*n);null===(l=this._currentPath)||void 0===l||l.addOval(c)}rect(e,t,i,n){var r;let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=hU.XYWHRect(e,t,i,n);if(wU(c))if(0===a&&0===s&&0===l&&0===o)null===(r=this._currentPath)||void 0===r||r.addRect(c);else{var h;let e=hU.RRectXY(c,a,a);e[4]=e[5]=a,e[6]=e[7]=s,e[8]=e[9]=o,e[10]=e[11]=l,null===(h=this._currentPath)||void 0===h||h.addRRect(e)}}getHorizontalAlign(e){switch(e){case 2:return hU.TextAlign.Right;case 3:return hU.TextAlign.Center;case 4:return hU.TextAlign.Justify;default:return hU.TextAlign.Left}}drawTextInner(e,t,i,n,r,a){let[s,o,l,c]=n,h=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],d=0,{ctx:u}=this;if(!u)return d;let p=a.copy(),f=a.copy();return f.setAlphaf(0),this._applyEffectsToPaint(p,(n=>{t.pushPaintStyle(i,n,f),t.addText(e);let a=t.build();a.layout(l);let h=o;2===r?h+=(c-a.getHeight())/2:3===r&&(h+=c-a.getHeight()),u.drawParagraph(a,s,h),d=a.getHeight(),t.reset(),a.delete()}),h),p.delete(),f.delete(),d}drawText(e,t){let i=0,n=this._fonts.get(t.font),{ctx:r,_paintFill:a,_paintStroke:s}=this;if(n&&r){let r=new hU.TextStyle({fontFamilies:[t.font],fontSize:t.fontSize,heightMultiplier:t.lineHeight,letterSpacing:t.letterSpacing}),o=new hU.ParagraphStyle({textStyle:r,textAlign:this.getHorizontalAlign(t.horizontalAlign)}),l=hU.XYWHRect(t.x,t.y,t.width,t.height),c=hU.ParagraphBuilder.Make(o,n);a&&(i=this.drawTextInner(e,c,r,l,t.verticalAlign,a,!0)),s&&(i=this.drawTextInner(e,c,r,l,t.verticalAlign,s,!1)),c.delete()}return{height:i}}render(){var e;null===(e=this._surface)||void 0===e||e.flush()}moveTo(e,t){var i;null===(i=this._currentPath)||void 0===i||i.moveTo(e,t)}lineTo(e,t){var i;null===(i=this._currentPath)||void 0===i||i.lineTo(e,t)}bezierCurveTo(e,t,i,n,r,a){var s;null===(s=this._currentPath)||void 0===s||s.cubicTo(e,t,i,n,r,a)}quadraticCurveTo(e,t,i,n){var r;null===(r=this._currentPath)||void 0===r||r.quadTo(e,t,i,n)}setTransform(e){var t,i,n,r;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.ctx)return;let s=this.ctx.getTotalMatrix(),o=Yz.invert(s);if(o&&this.ctx.concat(o),null!==(t=this.ctx)&&void 0!==t&&t.scale(this.dpr,this.dpr),null!==(i=this.camera)&&void 0!==i&&i.enabled&&(null!==(n=this.ctx)&&void 0!==n&&n.concat(this.camera.worldMatrix),a)){var l;let e=Yz.getScale(this.camera.worldMatrix);null===(l=this.ctx)||void 0===l||l.scale(1/e[0],1/e[1])}null!==(r=this.ctx)&&void 0!==r&&r.concat(e),this.currentTransform=e}transform(e){var t;null===(t=this.ctx)||void 0===t||t.concat(e)}setSize(e,t){var i;!this._isSizeDirty&&e===this._width&&t===this._height||(this._isSizeDirty=!1,this._width=e,this._height=t,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.width=e*this.dpr,this.canvas.height=t*this.dpr,this._surface&&(this._surface=hU.MakeWebGLCanvasSurface(this.canvas),this.ctx=null===(i=this._surface)||void 0===i?void 0:i.getCanvas()))}};function wU(e){for(let t=0;t<e.length;t++)if(void 0!==e[t]&&!Number.isFinite(e[t]))return!1;return!0}function _U(e){let{r:t,g:i,b:n,a:r}=e;return hU.Color4f(t,i,n,r)}var SU,AU,EU,CU=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=AE.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(t)}update(e){void 0!==e.color&&(this.color=e.color),void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.blurRadius&&(this.blurRadius=e.blurRadius),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.spread&&(this.spread=e.spread)}},MU=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.radius=0,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.radius&&(this.radius=e.radius)}},PU=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=AE.transparent,this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color)}},TU=class{constructor(e,t,i){this.uuid=e,this.data=t,this.enabled=!1,this.color=AE.transparent,this.thickness=0,this.mode="inside",this.update(t)}update(e){void 0!==e.enabled&&(this.enabled=e.enabled),void 0!==e.color&&(this.color=e.color),void 0!==e.thickness&&(this.thickness=e.thickness),void 0!==e.mode&&(this.mode=e.mode)}},DU=class extends rU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.autoClose=!0,this.fill=new PU(e+"-fill",t.fill,i),this.stroke=new TU(e+"-stroke",t.stroke,i),this.dropShadow=new CU(e+"-dropShadow",t.dropShadow,i),this.innerShadow=new CU(e+"-innerShadow",t.innerShadow,i),this.backgroundBlur=new MU(e+"-backgroundBlur",t.backgroundBlur,i),this.layerBlur=new MU(e+"-layerBlur",t.layerBlur,i)}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:AE.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:AE.transparent,e.strokeMode=this.stroke.mode,e.lineWidth=this.stroke.thickness}applyFilters(e){this.layerBlur.enabled?e.layerBlur=5*this.layerBlur.radius:e.layerBlur=0,this.backgroundBlur.enabled?e.backgroundBlur=5*this.backgroundBlur.radius:e.backgroundBlur=0,this.dropShadow.enabled?(e.dropShadowBlur=5*this.dropShadow.blurRadius,e.dropShadowColor=this.dropShadow.color,e.dropShadowOffsetX=this.dropShadow.offset[0],e.dropShadowOffsetY=this.dropShadow.offset[1]):e.dropShadowColor=AE.transparent,this.innerShadow.enabled?(e.innerShadowSpread=this.innerShadow.spread,e.innerShadowBlur=5*this.innerShadow.blurRadius,e.innerShadowColor=this.innerShadow.color,e.innerShadowOffsetX=this.innerShadow.offset[0],e.innerShadowOffsetY=this.innerShadow.offset[1]):e.innerShadowColor=AE.transparent}innerDraw(e){}draw(e){!this.visible||(e.save(),this.applyTransforms(e),this.applyFilters(e),this.applyFillStroke(e),e.beginPath(),this.innerDraw(e),this.autoClose&&e.closePath(),this.fill.enabled&&e.fill(),this.stroke.enabled&&e.stroke(),e.restore())}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),0===e.type&&(_S(e.path,["fill"])?this.fill.update(e.props):_S(e.path,["stroke"])?this.stroke.update(e.props):_S(e.path,["dropShadow"])?this.dropShadow.update(e.props):_S(e.path,["innerShadow"])?this.innerShadow.update(e.props):_S(e.path,["layerBlur"])?this.layerBlur.update(e.props):_S(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}updateState(e,t){super.updateState(e,t),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur)}clone(e){let t=new DU(this.uuid,this.data,e);return t.parent=void 0,t}},RU=class extends DU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.updateState(t,i)}innerDraw(e){e.ellipse(.5*this.width,.5*this.height,.5*this.width,.5*this.height,0,0,2*Math.PI)}intersectsInLocalSpace(e,t){return function(e,t,i,n,r,a){let s=e-i,o=t-n;return s*s/(r*r)+o*o/(a*a)<=1}(e,t,.5*this.width,.5*this.height,.5*this.width,.5*this.height)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e)}clone(e){let t=new RU(this.uuid,this.data,e);return t.parent=void 0,t}},OU=class extends DU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(t,i)}innerDraw(e){e.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e)}clone(e){let t=new OU(this.uuid,this.data,e);return t.parent=void 0,t}},IU=class extends DU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(t,i)}get textHeight(){return this._textHeight}applyFillStroke(e){e.fillColor=this.fill.enabled?this.fill.color:AE.transparent,e.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:AE.transparent,e.strokeMode="center",e.lineWidth=this.stroke.thickness}innerDraw(e){var t,i,n;(null===(t=this._fontHolder)||void 0===t?void 0:t.arrayBuffer)&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&e.registerFont(this._fontHolder.arrayBuffer,this.data.font);let r=this.data.textTransform,a=this.data.text.textValue.toString(),s=2===r?a.toUpperCase():3===r?a.toLowerCase():a,{height:o}=e.drawText(s,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:null!==(i=this.data.lineHeight)&&void 0!==i?i:1,letterSpacing:null!==(n=this.data.letterSpacing)&&void 0!==n?n:0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=o}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(e,t){let{shared:i}=t;void 0!==e.font&&(this._fontHolder=i.getFont(e.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then((()=>{this.requestRender()})))}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateFontState(e,t)}clone(e){let t=new IU(this.uuid,this.data,e);return t.parent=void 0,t}},kU=class extends DU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(t,i)}computeExtremas(){0===this.curves.length&&this.computeCurves();let e=this.curves.map((e=>SU.extremas(e))),t=[1/0,1/0],i=[-1/0,-1/0];for(let n=0,r=e.length;n<r;n++){let r=e[n];r[0][0]<t[0]&&(t[0]=r[0][0]),r[0][1]<t[1]&&(t[1]=r[0][1]),r[1][0]>i[0]&&(i[0]=r[1][0]),r[1][1]>i[1]&&(i[1]=r[1][1])}return this.extremasBBox.min=[t[0],t[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,n=this.data.points.length;i<n;i++){let e=this.data.points[i].data,t=this.data.points[i-1].data,n={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(n)}let e=this.data.points[0].data,t=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:t.position,cp1:t.controlNext.position,cp2:e.controlPrevious.position,end:e.position};this.curves.push(i)}}getCenter(){let[e,t]=this.extremasBBox.min,[i,n]=this.getHalfSize();return[e+i,t+n]}getHalfSize(){let{min:e,max:t}=this.extremasBBox;return[.5*(t[0]-e[0]),.5*(t[1]-e[1])]}innerDraw(e){for(let n=0,r=this.data.points.length;n<r;n++){let t=this.data.points[n].data;if(0===n){let[i,n]=t.position;e.moveTo(i,n)}else{let i=this.data.points[n-1].data,[r,a]=i.controlNext.position,[s,o]=t.controlPrevious.position,[l,c]=t.position,h={start:i.position,cp1:i.controlNext.position,cp2:t.controlPrevious.position,end:t.position};SU.derive(h),e.bezierCurveTo(r,a,s,o,l,c)}}let t=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[n,r]=i.controlNext.position,[a,s]=t.controlPrevious.position,[o,l]=t.position;e.bezierCurveTo(n,r,a,s,o,l)}}updateState(e,t){super.updateState(e,t),this.computeExtremas()}clone(e){let t=new kU(this.uuid,this.data,e);return t.parent=void 0,t}};(e=>{function t(e,t,i){let n=e-2*t+i;if(0!==n){let r=-Math.sqrt(Math.abs(t*t-e*i)),a=-e+t;return[-(r+a)/n,-(-r+a)/n]}return t!==i&&0===n?[(2*t-i)/(2*(t-i))]:[]}e.derive=function(e){let t=e.start,i=e.cp1,n=e.cp2,r=e.end,a={start:[3*(i[0]-t[0]),3*(i[1]-t[1])],cp:[3*(n[0]-i[0]),3*(n[1]-i[1])],end:[3*(r[0]-n[0]),3*(r[1]-n[1])]};return e.derivative=a,a.derivative=AU.derive(a),a},e.droot=function(i){var n;let r=null!==(n=i.derivative)&&void 0!==n?n:e.derive(i),a=r.start,s=r.cp,o=r.end;return[t(a[0],s[0],o[0]),t(a[1],s[1],o[1])]},e.extremas=function(t){let[i,n]=e.droot(t),r=[t.start[0],t.end[0]],a=[t.start[1],t.end[1]];for(let s of i)r.push(e.compute(t,Math.min(1,Math.max(0,s)))[0]);for(let s of n)a.push(e.compute(t,Math.min(1,Math.max(0,s)))[1]);return r.sort(((e,t)=>e-t)),a.sort(((e,t)=>e-t)),[[r[0],a[0]],[r[r.length-1],a[a.length-1]]]},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let i=1-t,n=i*i,r=t*t,a=n*i,s=n*t*3,o=i*r*3,l=t*r;return[a*e.start[0]+s*e.cp1[0]+o*e.cp2[0]+l*e.end[0],a*e.start[1]+s*e.cp1[1]+o*e.cp2[1]+l*e.end[1]]}})(SU||(SU={})),(e=>{e.derive=function(e){let t=e.start,i=e.cp,n=e.end,r={start:[2*(i[0]-t[0]),2*(i[1]-t[1])],end:[2*(n[0]-i[0]),2*(n[1]-i[1])]};return r.derivative=EU.derive(r),e.derivative=r,r},e.droot=function(t){var i;let n=null!==(i=t.derivative)&&void 0!==i?i:e.derive(t),r=n.start,a=n.end;return[r[0]!==a[0]?r[0]/(r[0]-a[0]):0,r[1]!==a[1]?r[1]/(r[1]-a[1]):0]},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let i=1-t,n=i*i,r=i*t*2,a=t*t;return[n*e.start[0]+r*e.cp[0]+a*e.end[0],n*e.start[1]+r*e.cp[1]+a*e.end[1]]}})(AU||(AU={})),(e=>{e.derive=function(e){let t=e.start,i=e.end,n=[i[0]-t[0],i[1]-t[1]];return e.derivative=n,e.derivative},e.compute=function(e,t){if(0===t)return[...e.start];if(1===t)return[...e.end];let i=e.start,n=e.end;return[i[0]+(n[0]-i[0])*t,i[1]+(n[1]-i[1])*t]}})(EU||(EU={}));var LU=class extends aU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.width=0,this.height=0,this.clipped=!0,this.background=new OU(e+"-background",RM.defaultData,i),this.background.parent=this,this.updateState(t,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(e){this.background.cornerRadius=e}updateLocalMatrix(){var e;super.updateLocalMatrix(),null===(e=this.background)||void 0===e||e.updateLocalMatrix()}updateWorldMatrix(e,t,i){var n;super.updateWorldMatrix(e,t,i),null===(n=this.background)||void 0===n||n.updateWorldMatrix(e,t,i)}draw(e){if(!this.visible)return;e.save();let t=this.width,i=this.height;this.applyTransforms(e),this.background.width=t,this.background.height=i,this.background.draw(e),this.clipped&&e.clipRect(0,0,t,i,...this.cornerRadius),this.innerDrawChildren(e),e.restore()}getCenter(){return[.5*this.width,.5*this.height]}getHalfSize(){return[.5*this.width,.5*this.height]}updateCornerState(e){void 0!==e.cornerRadius&&(this.cornerRadius=e.cornerRadius)}updateSizeState(e){let t=!1;void 0!==e.width&&(this.width="number"==typeof e.width?e.width:this.width,t=!0),void 0!==e.height&&(this.height="number"==typeof e.height?e.height:this.height,t=!0),t&&this.updateWorldMatrix(!0,!1,!0)}updateState(e,t){super.updateState(e,t),this.updateSizeState(e),this.updateCornerState(e),void 0!==e.fill&&this.fill.update(e.fill),void 0!==e.stroke&&this.stroke.update(e.stroke),void 0!==e.dropShadow&&this.dropShadow.update(e.dropShadow),void 0!==e.innerShadow&&this.innerShadow.update(e.innerShadow),void 0!==e.layerBlur&&this.layerBlur.update(e.layerBlur),void 0!==e.backgroundBlur&&this.backgroundBlur.update(e.backgroundBlur),void 0!==e.clipped&&(this.clipped=e.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),0===e.type&&(_S(e.path,["fill"])?this.fill.update(e.props):_S(e.path,["stroke"])?this.stroke.update(e.props):_S(e.path,["dropShadow"])?this.dropShadow.update(e.props):_S(e.path,["innerShadow"])?this.innerShadow.update(e.props):_S(e.path,["layerBlur"])?this.layerBlur.update(e.props):_S(e.path,["backgroundBlur"])?this.backgroundBlur.update(e.props):this.resetBBoxNeedsUpdate())}clone(e){let t=new LU(this.uuid,this.data,e);t.parent=void 0;for(let i of this.children)t.add(i.clone(e));return t}},FU=Br(qr(),1),BU=class extends DU{constructor(e,t,i){super(e,t,i),this.uuid=e,this.data=t,this._pathBBox=new DOMRect,this.path="",this.updateState(t,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let e=document.createElementNS("http://www.w3.org/2000/svg","svg"),t=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(e),t.setAttribute("d",this.path),e.appendChild(t),this._pathBBox=t.getBBox(),e.remove()}innerDraw(e){e.path(this.path)}intersectsInLocalSpace(e,t){return e>=this._pathBBox.x&&e<=this._pathBBox.x+this._pathBBox.width&&t>=this._pathBBox.y&&t<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(e,t){super.updateState(e,t),void 0!==e.path&&(this.path=e.path,this.computeSVGBBox())}clone(e){let t=new BU(this.uuid,this.data,e);return t.parent=void 0,t}};var NU=class{constructor(e,t,i){this.uuid=e,this.data=t,this.group=new sU(NU.GROUP_ID,{...LM.defaultData},i),this.createChildrenObjects(t.objects,this.group,i)}createObject(e,t,i,n,r,a){let s=function(e,t,i){switch(t.type){case"ellipse2d":return new RU(e,t,i);case"rectangle2d":return new OU(e,t,i);case"text2d":return new IU(e,t,i);case"vector2d":return new kU(e,t,i);case"path2d":return new BU(e,t,i);case"frame2d":return new LU(e,t,i);default:return new sU(e,t,i)}}(e,t,a);s&&(n.add(s),n.children.splice(r,0,n.children.pop()),s.updateWorldMatrix(),i.length>0&&(s instanceof sU||s instanceof LU)&&this.createChildrenObjects(i,s,a))}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}draw(e){this.group.draw(e)}updateEntityByOp(e,t,i,n){let r=this.find(e);if(r)try{r.updateByOp(t,i,{shared:n})}catch(uE){console.error(uE)}}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this.group:this.find(e.parent);void 0!==i&&i instanceof aU&&(this.createObject(e.id,e.data,e.children,i,e.localIndex,t),i.requestRender())}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0!==t&&void 0!==t.parent&&t.parent instanceof aU){let e=t.parent;t.resetBBoxNeedsUpdate(),null!==e&&void 0!==e&&e.remove(t),null===e||void 0===e||e.requestRender()}}else if(0===e.path.length&&9===e.type){let t=this.find(e.id);if(void 0!==t){let i=t.parent,n=null===e.parent?this:this.find(e.parent);if(n instanceof aU||n===this){n.add(t);let r=e.localIndex;n.children.splice(r,0,n.children.pop()),t.updateWorldMatrix(!0,!1,!0),null!==i&&void 0!==i&&i.requestRender(),t.requestRender()}t.resetBBoxNeedsUpdate()}}}add(e){this.group.add(e)}remove(e){this.group.remove(e)}traverse(e){this.group.traverse((t=>{t!==this.group&&e(t)}))}intersectsChildren(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return this.group.intersectsChildren(e,t,i,n,r,!0)}find(e){return this.group.find(e)}get children(){return this.group.children}project(e,t){return this.group.project(e,t)}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this.group;){let e=n;n=n.parent;let t=n.children.indexOf(e);i.splice(0,0,t)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let e=this.getWithSortKey(i.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>u_(e.sortKey,t.sortKey))),t.map((e=>e.entity))}},zU=NU;function UU(e){let{constraints:t,newParentWidth:i,newParentHeight:n,initialParentWidth:r,initialParentHeight:a,objectInitialWidth:s,objectInitialHeight:o,objectInitialPosition:l}=e,{horizontalConstraint:c,verticalConstraint:h}=t,d=i-r,u=n-a,p=s,f=o,m=l[0],g=l[1];if(0!==c)if(1===c)m+=d;else if(3===c)m+=d/2;else if(2===c)p=Math.max(1,p+d);else if(4===c){let e=i/r;p*=e,m*=e}if(0!==h)if(1===h)g+=u;else if(3===h)g+=u/2;else if(2===h)f=Math.max(1,f+u);else if(4===h){let e=n/a;f*=e,g*=e}return{width:p,height:f,position:[m,g]}}zU.GROUP_ID="scene2d";Br(qr(),1);var jU=Yz.identity(),VU=class{constructor(e,t,i,n){this.uuid=e,this.width=t,this.height=i,this.context=n,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this.onFrameOverrideObjectEvent=e=>{var t;if(void 0!==(null===(t=e.target)||void 0===t?void 0:t.uuid)){var i;let t=null===(i=this.frameRoot)||void 0===i?void 0:i.find(e.target.uuid);t&&t.dispatchEvent({...e,target:t})}},this.scene2d=new zU(Uo.generateUUID(),NM.defaultData,{dpr:window.devicePixelRatio,shared:n.shared}),this.canvas=document.createElement("canvas"),this.renderer=new xU(this.canvas),n.shared.addCanvas(this.uuid,this.canvas),this.textureHolder=n.shared.canvas(this.uuid),this.promise=this.init()}async init(){this.renderer instanceof xU&&(this.renderer.wasmURL=qk.skiaWasmUrl),await this.renderer.init()}render(){var e,t;this.isFrameDirty&&(this.renderer.clear(),null!==(e=this.frameOverride)&&void 0!==e&&e.draw(this.renderer),this.renderer.render(),null!==(t=this.textureHolder)&&void 0!==t&&t.setNeedsUpdate(!0),this.isFrameDirty=!1)}updateEntity2DByOp(e,t,i,n){this.scene2d.updateEntityByOp(e,t,i,n),this.applySize()}updateTreeByOp(e,t){this.scene2d.updateTreeByOp(e,t),this.applySize()}applyOverrides(e){if(this.frameOverride&&this.frameRoot){var t,i;this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let n=null!==(t=null===e||void 0===e?void 0:e.width)&&void 0!==t?t:this.width,r=null!==(i=null===e||void 0===e?void 0:e.height)&&void 0!==i?i:this.height;this.frameOverride.width=n,this.frameOverride.height=r,this.frameOverride.localMatrix=jU,this.isScreenSpace&&(this.frameOverride.fill.color=AE.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:n,height:r},GU({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(e){var t,i,n,r;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.devicePixelRatio,s=null!==(t=null===e||void 0===e?void 0:e.width)&&void 0!==t?t:this.width,o=null!==(i=null===e||void 0===e?void 0:e.height)&&void 0!==i?i:this.height;this.dpr=a,this.width=s,this.height=o,this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(s,o)),this.renderer.setSize(s,o),null!==(n=this.textureHolder)&&void 0!==n&&n.dispose(),this.applyOverrides(e),null===(r=this.frameOverride)||void 0===r||r.requestRender()}applyFrame(e){var t,i,n;let r=this.context.scene.find2D(e);if(r&&r instanceof LU)return this.disposeFrameOverride(),this.frameRoot=r,this.frameOverride=r.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),null!==(t=this.textureHolder)&&void 0!==t&&t.dispose(),null!==(i=this.frame)&&void 0!==i&&i.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse((e=>{e.addEventListener("beginState",this.onFrameOverrideObjectEvent)})),this.frameOverride.traverse((e=>{e.addEventListener("completeState",this.onFrameOverrideObjectEvent)})),null!==(n=this.frame)&&void 0!==n&&n.requestRender(),r}get frame(){return this.frameOverride}get frameId(){var e;return null===(e=this.frame)||void 0===e?void 0:e.uuid}find(e){return this.scene2d.find(e)}get texture(){var e;return null===(e=this.textureHolder)||void 0===e?void 0:e.getTexture(1001)}disposeFrameOverride(){var e,t,i;null!==(e=this.frameOverride)&&void 0!==e&&e.removeEventListener("render",this.onRenderRequestedDownstream),null!==(t=this.frameOverride)&&void 0!==t&&t.traverse((e=>{e.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)})),null!==(i=this.frameOverride)&&void 0!==i&&i.traverse((e=>{e.removeEventListener("completeState",this.onFrameOverrideObjectEvent)})),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function GU(e){let{objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:a,initialParentHeight:s}=e;if(t instanceof LU&&i instanceof LU||t instanceof sU&&i instanceof sU)for(let o=0,l=t.children.length;o<l;o++){let e=t.children[o],l=i.children[o];e&&l&&e.uuid===l.uuid&&HU({objectOverride:e,objectRoot:l,newParentWidth:n,newParentHeight:r,initialParentWidth:a,initialParentHeight:s})}}function HU(e){let{objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:a,initialParentHeight:s}=e,[o,l]=function(e){if(qU(e))return[e.width,e.height];if(e instanceof BU){let[t,i]=e.getHalfSize();return[2*t,2*i]}if(e instanceof sU){let[t,i]=e.recursiveBBox.getHalfSize();return[2*t,2*i]}return[0,0]}(i),{width:c,height:h,position:d}=UU({constraints:t.data,newParentWidth:n,newParentHeight:r,initialParentWidth:a,initialParentHeight:s,objectInitialWidth:o,objectInitialHeight:l,objectInitialPosition:i.position});if(t.position=d,t.data={...t.data,position:d},t.states)for(let u in t.states)WU({stateId:u,objectOverride:t,objectRoot:i,newParentWidth:n,newParentHeight:r,initialParentWidth:a,initialParentHeight:s});if(qU(t)||t instanceof sU)qU(t)&&(t.width=c,t.height=h,t.data={...t.data,width:c,height:h}),GU({objectOverride:t,objectRoot:i,newParentWidth:c,newParentHeight:h,initialParentWidth:o,initialParentHeight:l});else if(t instanceof BU){let e=i,n=0!==o?c/o:1,r=0!==l?h/l:1;t.path=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(t<=0||i<=0)return e;let n=(0,FU.parseSVG)(e).map((e=>{let n={...e};return"x"in n&&(n.x=n.x*t),"y"in n&&(n.y=n.y*i),"x1"in n&&(n.x1=n.x1*t),"x2"in n&&(n.x2=n.x2*t),"y1"in n&&(n.y1=n.y1*i),"y2"in n&&(n.y2=n.y2*i),"rx"in n&&(n.rx=n.rx*t),"ry"in n&&(n.ry=n.ry*i),n}));return function(e){let t,i=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"];return e.map((e=>{let n=[];i.forEach((t=>{if(t in e){let i=1*e[t];n.length&&i>=0&&n.push(","),n.push(i)}}));let r=(t===e.code?n[0]<0?"":",":e.code)+n.join("");return t=e.code,r})).join("")}(n)}(e.path,n,r),t.data={...t.data,path:t.path}}}function WU(e){var t,i;let{stateId:n,objectOverride:r,objectRoot:a,newParentWidth:s,newParentHeight:o,initialParentWidth:l,initialParentHeight:c}=e,h=null===(t=r.states)||void 0===t?void 0:t[n],d=null===(i=a.states)||void 0===i?void 0:i[n];if(h&&d){let{width:e,height:t,position:i}=UU({constraints:r.data,newParentWidth:s,newParentHeight:o,initialParentWidth:l,initialParentHeight:c,objectInitialWidth:BM.isResizeable(d)?d.width:0,objectInitialHeight:BM.isResizeable(d)?d.height:0,objectInitialPosition:d.position});Object.assign(r.states[n],{position:i}),BM.isResizeable(h)&&Object.assign(r.states[n],{width:e,height:t})}}function qU(e){return e instanceof OU||e instanceof LU||e instanceof RU||e instanceof IU}var XU=class extends(XT(op)){constructor(e,t,i){super(),this.data=t,this.bgColor=new yI(1,1,1,1),this.fog=null,this.backupFog=new sp(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new rl,this.penumbraSizeArrayCache=null,this.super_Entity(e,t),this.personalCamera=new NB(LE,{...OC.defaultData,...t.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new mm(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),t.uiScene?this.uiScene=new zU((Array.isArray(e)?e[0]:e)+"-ui",t.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):t.uiFrame&&this.createUICanvas(t.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){var e;return null===(e=this.uiCanvas)||void 0===e?void 0:e.frame}createUICanvas(e,t){this.uiCanvas=new VU(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,t),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then((()=>{var t,i;null!==(t=this.uiCanvas)&&void 0!==t&&t.applyFrame(e),null===(i=this.uiCanvas)||void 0===i||i.applySize()}))}updateVisible(){}setBackgroundColor(e){this.bgColor=e,!0===this.fogUseBGColor&&(this.backupFog.color=e)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(e,t){void 0!==e.color&&(this.ambientLight.color=DL(e.color,t)),void 0!==e.intensity&&(this.ambientLight.intensity=e.intensity),void 0!==e.enabled&&(e.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(e){this.isActive=!0,e.fog=this.fog,this.traverseEntity((e=>{e instanceof GB&&e.recomputeBoolean()})),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity((e=>{if(e instanceof AF)if(Array.isArray(e.material))for(let t of e.material)t.needsUpdate=!0;else e.material.needsUpdate=!0,e.material.dispose()}))}updateShadow(e){void 0!==e.softShadowQuality&&this.isActive&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"medium";if(zz===e)return!1;zz=e;let t=(e=>{switch(e){case"low":return 8;case"medium":default:return 16;case"high":return 32}})(e);Th.shadowmap_pars_fragment=(e=>"\n\n// PCSS implementation based on:\n// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/\n// NOTE: This number affects how big the shadow blur can\n// possibly get. Bigger number == bigger blur, but less precise results\n\nconst float  gPenumbraFilterSize = 80.0;\nconst int   gPenumbraSamples = ".concat(e,";\nconst int gShadowSamples = ").concat(e,";\nconst float gShadowSamplesRpc = 1.0f / float(gShadowSamples);\n\n#ifdef USE_SHADOWMAP\n    #if NUM_DIR_LIGHT_SHADOWS > 0\n\n        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n        struct DirectionalLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_SPOT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n        struct SpotLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n        };\n\n        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n    #endif\n\n    #if NUM_POINT_LIGHT_SHADOWS > 0\n\n        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n        struct PointLightShadow {\n            float shadowBias;\n            float shadowNormalBias;\n            float shadowRadius;\n            vec2 shadowMapSize;\n            float shadowCameraNear;\n            float shadowCameraFar;\n        };\n\n        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n    #endif\n\n    /*\n    #if NUM_RECT_AREA_LIGHTS > 0\n\n        // TODO (abelnation): create uniforms for area light shadows\n\n    #endif\n    */\n\nfloat computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)\n{\n    float penumbra = 1.0;\n    float blockerDepthAvg = 0.0;\n    float blockerCount = 0.0;\n\n    #pragma unroll_loop_start\n    for(int i = 0; i < gPenumbraSamples; i ++)\n    {\n        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;\n        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );\n\n        if(depth < compare + 0.0001)\n        {\n            blockerDepthAvg += depth;\n            blockerCount++;\n        }\n    }\n    #pragma unroll_loop_end\n\n    if (blockerCount > 0.0)\n    {\n        blockerDepthAvg /= blockerCount;\n\n        // Compute penumbra\n        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);\n        penumbra *= penumbra;\n        penumbra *= 200.0 * penumbraSize[min(index, ",5," - 1)]; // Magic number that affects how quickly the penumbra grows\n\n        return clamp(penumbra, 0.00, 1.0);\n    }\n    return 0.0;\n}\n\nfloat vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)\n{\n    float shadow         = 0.0f;\n\n    // NOTE: When using TAA, we should use screen space interleaved gradient noise\n    vec2 halton = haltonSequence[frameIndex];\n    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n    float temporalAngle  = temporalOffset * PI2;\n\n    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);\n    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);\n    if (penumbra == -1.0) {\n        return 1.0;\n    }\n\n    #pragma unroll_loop_start\n    for (int i = 0; i < gShadowSamples; i++)\n    {\n        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n        // Overall blurring offset\n        vec2 offset = vogelSample * (shadowRadius * 2.);\n\n        // Penumbra offset\n        offset += vogelSample * (penumbra * texelScalar);\n\n        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );\n    }\n    #pragma unroll_loop_end\n\n    return shadow * gShadowSamplesRpc;\n}\n\n\n    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n    }\n\n    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n        return unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n    }\n\n    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n        float occlusion = 1.0;\n\n        vec2 distribution = texture2DDistribution( shadow, uv );\n\n        float hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n        if (hard_shadow != 1.0 ) {\n\n            float distance = compare - distribution.x ;\n            float variance = max( 0.00000, distribution.y * distribution.y );\n            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n        }\n        return occlusion;\n\n    }\n\n    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n        float shadow = 1.0;\n\n        shadowCoord.xyz /= shadowCoord.w;\n        shadowCoord.z += shadowBias;\n\n        // if ( something && something ) breaks ATI OpenGL shader compiler\n        // if ( all( something, something ) ) using this instead\n\n        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n        bool inFrustum = all( inFrustumVec );\n\n        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n        bool frustumTest = all( frustumTestVec );\n\n        if ( frustumTest ) {\n\n        #if defined( SHADOWMAP_TYPE_PCF )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n            float dx = texelSize.x;\n            float dy = texelSize.y;\n\n            vec2 uv = shadowCoord.xy;\n            vec2 f = fract( uv * shadowMapSize + 0.5 );\n            uv -= f * texelSize;\n\n            shadow = (\n                texture2DCompare( shadowMap, uv, shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n                     f.x ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n                     f.y ) +\n                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n                          f.x ),\n                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n                          f.x ),\n                     f.y )\n            ) * ( 1.0 / 9.0 );\n\n        #elif defined( SHADOWMAP_TYPE_VSM )\n\n            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #else // no percentage-closer filtering:\n\n            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n        #endif\n\n        }\n\n        return shadow;\n\n    }\n\n    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n    // vector suitable for 2D texture mapping. This code uses the following layout for the\n    // 2D texture:\n    //\n    // xzXZ\n    //  y Y\n    //\n    // Y - Positive y direction\n    // y - Negative y direction\n    // X - Positive x direction\n    // x - Negative x direction\n    // Z - Positive z direction\n    // z - Negative z direction\n    //\n    // Source and test bed:\n    // https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n    vec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n        // Number of texels to avoid at the edge of each square\n\n        vec3 absV = abs( v );\n\n        // Intersect unit cube\n\n        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n        absV *= scaleToCube;\n\n        // Apply scale to avoid seams\n\n        // two texels less per square (one texel will do for NEAREST)\n        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n        // Unwrap\n\n        // space: -1 ... 1 range for each square\n        //\n        // #X##         dim    := ( 4 , 2 )\n        //  # #         center := ( 1 , 1 )\n\n        vec2 planar = v.xy;\n\n        float almostATexel = 1.5 * texelSizeY;\n        float almostOne = 1.0 - almostATexel;\n\n        if ( absV.z >= almostOne ) {\n\n            if ( v.z > 0.0 )\n                planar.x = 4.0 - v.x;\n\n        } else if ( absV.x >= almostOne ) {\n\n            float signX = sign( v.x );\n            planar.x = v.z * signX + 2.0 * signX;\n\n        } else if ( absV.y >= almostOne ) {\n\n            float signY = sign( v.y );\n            planar.x = v.x + 2.0 * signY + 2.0;\n            planar.y = v.z * signY - 2.0;\n\n        }\n\n        // Transform to UV space\n\n        // scale := 0.5 / dim\n        // translate := ( center + 0.5 ) / dim\n        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n    }\n\n    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n        float shadow = 1.0;\n        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n        // for point lights, the uniform @vShadowCoord is re-purposed to hold\n        // the vector from the light to the world-space position of the fragment.\n        vec3 lightToPosition = shadowCoord.xyz;\n\n        // dp = normalized distance from light to fragment position\n        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n        compare += shadowBias;\n\n        // bd3D = base direction 3D\n        vec3 bd3D = normalize( lightToPosition );\n\n        vec2 halton = haltonSequence[frameIndex];\n        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);\n        float temporalAngle  = temporalOffset * PI2;\n\n        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )\n            for (int i = 0; i < gShadowSamples; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                // NOTE: Removed for now\n                // Penumbra offset\n                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * gShadowSamplesRpc;\n\n        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n            for (int i = 0; i < 16; i++) {\n                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;\n\n                // Overall blurring offset\n                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);\n\n                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );\n\n            }\n            return shadow * (1.0 / 16.0);\n        #else // no percentage-closer filtering\n\n            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );\n\n        #endif\n\n    }\n\n#endif\n"))(t);let i=Bz.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + ".concat(3,", spotShadowMap[ i ]")),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),Th.lights_fragment_begin=i;let n=Nz.slice();return n=n.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),Th.shadowmask_pars_fragment=n,!0}(e.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(e,t){if(e.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){this.scene.fog=this.fog}this.fogUseBGColor=e.useBackgroundColor,e.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=DL(e.color,t),this.backupFog.near=e.near,this.backupFog.far=e.far}updateAo(e,t){void 0!==e.aoColor&&(this.aoColor=DL(e.aoColor,t))}updateByOp(e,t,i,n){let r=this.data.uiFrame;super.updateByOp(e,t,i,n);let a=t;_S(e.path,["fog"])?this.updateFog(a.fog,i.shared):_S(e.path,["ao"])?this.updateAo(a.ao,i.shared):_S(e.path,["ambient"])?this.updateAmbientLight(a.ambient,i.shared):_S(e.path,["shadow"])?this.updateShadow(a.shadow):0===e.type&&0===e.path.length&&(void 0!==e.props.uiFrame||r!==a.uiFrame)&&this.updateUIFrame(e.props.uiFrame,i)}updateUIFrame(e,t){e?(this.uiCanvas||this.createUICanvas(e,t),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(e)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(e,t){this.updateState_Entity(e,t),void 0!==e.backgroundColor&&this.setBackgroundColor(DL(e.backgroundColor,t.shared)),void 0!==e.fog&&this.updateFog(e.fog,t.shared),void 0!==e.ambient&&this.updateAmbientLight(e.ambient,t.shared),void 0!==e.ao&&this.updateAo(e.ao,t.shared),void 0!==e.shadow&&this.updateShadow(e.shadow)}createFrame(e,t){}raycast(e,t){super.raycast(e,t)}switchActiveCamera(e){e&&e.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=e,e.objectHelper.visible=!1)}get playCamera(){var e,t;return null!==(e=null===(t=this.scene)||void 0===t?void 0:t.find(this.data.publish.playCamera))&&void 0!==e?e:this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return null===this.penumbraSizeArrayCache&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let e=0,t=0;this.traverseEntity((i=>{if(!i.visible)return!0;i instanceof Qz&&i.visible&&e<3&&(this.penumbraSizeArrayCache[e]=i.data.penumbraSize,e+=1),i instanceof $z&&i.visible&&e<2&&(this.penumbraSizeArrayCache[3+t]=i.data.penumbraSize,t+=1)}))}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let n=r.cloner;AT.is(r)&&(r.visible||(null===n||void 0===n?void 0:n.object.data.visible))&&((WB(r)||XB(r)&&this.scene.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),Aj(r,e,t,!0)),i(r))}};return i(this),t}updateEntity2DByOp(e,t,i,n){var r;null===(r=this.uiCanvas)||void 0===r||r.updateEntity2DByOp(e,t,i,n)}},YU=class extends(HB(Cm,Wz)){constructor(e,t,i){super(),this.super_Entity(e,t),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let n=this.shadow.camera;n.fov=90,n.aspect=1,n.near=100,n.far=2500;let r=new gl(-n.far+this.position.x,-n.far+this.position.y,-n.far+this.position.z),a=new gl(n.far+this.position.x,n.far+this.position.y,n.far+this.position.z),s=new bl(r,a),o=new mg(s,new rl(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let e in this.gizmos){let t=this.gizmos[e];if(t instanceof mg){let e=this.shadow.camera,i=new gl(-e.far+this.position.x,-e.far+this.position.y,-e.far+this.position.z),n=new gl(e.far+this.position.x,e.far+this.position.y,e.far+this.position.z);t.box.set(i,n),t.updateMatrixWorld(!0)}}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.objectHelper&&this.objectHelper.update()}updateState(e,t){this.updateState_Light(e,t),void 0!==e.distance&&(this.distance=e.distance),void 0!==e.decay&&(this.decay=e.decay),void 0!==e.shadowRadius&&(this.shadow.radius=e.shadowRadius),void 0!==e.shadowResolution&&(this.shadow.mapSize.set(e.shadowResolution,e.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},QU=class extends DF{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?sI(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},KU=class extends DF{constructor(e,t,i){super(e,t,i),this._shapeId=null,this._context=i}updateState(e,t){super.updateState(e,t),this.updateShape()}updateShape(){let e,t={...this.data.geometry.extrusion.shape};for(let r in t)"string"==typeof t[r]&&(t[r]=this._context.shared.getVariable(t[r],[this.uuid,"geometry","extrusion","shape",r]));if("Custom"===t.type){let n=t.shapeId;if(n!==this._shapeId&&this.detachShape(),n){var i;this._shapeId=n;let t=this._context.scene.find(n);null!==t&&void 0!==t&&t.data&&(t.attachedPaths.add(this),e=null===(i=t.geometry.userData)||void 0===i?void 0:i.shape),e||this._context.scene.addPendingCommand((()=>this.updateShape()))}}else{let i;switch(t.type){case"Rectangle":i=JR;break;case"Ellipse":i=vR;break;case"Polygon":i=XR;break;case"Star":i=eO;break;default:throw new Error("Unknown shape type: ".concat(t.type))}e=i.create({parameters:t}).userData.shape}let n=this.geometry;e&&n.inputs&&(n.inputs.shapeData=e,n.build(),this.attachedSurfaceCloners.forEach((e=>e.update())))}detachShape(){var e;null!==this._shapeId&&(null===(e=this._context.scene.find(this._shapeId))||void 0===e||e.attachedPaths.delete(this))}createGeometryDelayed(e){this.geometryCreateDeleyed=e.shared,this.updateShape(),this.refreshAttachedPaths(e)}updateTransformState(e,t){return super.updateTransformState(e,t)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.updateShape()}updateEntityBoxSize(e,t){let i=this.geometry.getAttribute("position");void 0!==i?sI(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,e,t):super.updateEntityBoxSize(e,t)}},ZU=class extends(RB(Ju,YB)){constructor(e,t,i){super(),"Instance"===t.type&&"string"==typeof e&&(t=this.transformAssignData(t,i)),this.super_Entity(e,t),this.objectHelper.update()}get isComponentRoot(){return"Component"===this.data.type&&"string"==typeof this.identity}get isInstanceRoot(){return"Instance"===this.data.type&&"string"==typeof this.identity}transformAssignData(e,t){let i=bM.getComponentData({scene:t.scene.data,shared:t.shared.data},e.component);if(i){let t,n;for(let r of LC.rootOverrideProps)void 0===e[r]?(void 0===t&&(t={...e}),t[r]=i.data[r]):(void 0===n&&(n={}),n[r]=e[r],void 0===t&&(t={...e}),t[r]=H_.apply(i.data[r],e[r]));return this.overrideData=n,t}return{...CC.defaultData,...e,...t_(CC.defaultData,LC.rootOverrideProps)}}updateByOp(e,t,i,n){var r;let a;if(this.isInstanceRoot&&!n)if(t=this.transformAssignData(t,i),0===e.type&&0===e.path.length&&this.component)for(let s of LC.rootOverrideProps)s in e.props&&void 0===e.props[s]&&(void 0===a&&(a={...e,props:{...e.props}}),a.props[s]=this.component.data[s]);else if(0===e.type&&e.path.length>0&&LC.rootOverrideProps.includes(e.path[0])){let i=e.path[0];void 0===a&&(a={...e,path:[],props:{[i]:t[i]}})}super.updateByOp(null!==(r=a)&&void 0!==r?r:e,t,i,n)}updateState(e,t){this.updateState_Entity(e,t)}expandInstanceChildren(e){let t=this.data;if(void 0===this.component){var i;let n=null!==(i=e.scene.find(t.component))&&void 0!==i?i:null,r=!1;if(n!==this.oldComponent){if(this.oldComponent){let t=0;for(let i of this.children){if(!AT.is(i))break;e.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),JU(i),t+=1}this.children.splice(0,t)}r=!0}if(n){let i={};ej(e,[this.uuid],t.overrides,this,n,n,0,r,i);for(let t of this.children)if(AT.is(t)){let n=t.data;"Empty"===n.type&&n.animations&&t.traverseEntity((t=>{let n=t.dataPatched;if(t instanceof DF&&n.bones&&n.boneInverses){let n=t.dataPatched;if(n.bones&&n.boneInverses){let r=n.bones.map((t=>e.scene.find(i[t]))),a=n.boneInverses.map((e=>(new ql).fromArray(e))),s=new mp(r,a);t.bind(s,t.bindMatrix)}}else t.matrixAutoUpdate=!0}))}}this.oldComponent=this.component}}};function JU(e){if(e.component){let t=e.component.instances.indexOf(e);t>=0&&e.component.instances.splice(t,1);for(let i of e.children)AT.is(i)&&JU(i)}}function $U(e,t,i,n){return e.component===t&&qw(e.identity,n)?e.overrideData===i?2:1:0}function ej(e,t,i,n,r,a,s,o,l){if(s>50)return!1;if(n.component!==r){if(n.component){let e=n.component.instances.indexOf(n);e>=0&&n.component.instances.splice(e,1)}r.instances.find((e=>e===n))||r.instances.push(n),n.component=r}r instanceof ZU&&r.isInstanceRoot&&r.expandInstanceChildren(e);let c=0;for(let d of r.children)if(AT.is(d)){let r=[...t,..."string"==typeof d.identity?[d.identity]:d.identity],u=kC.resolve(i,r,1);null==u||u instanceof Q_||(Object.setPrototypeOf(u,Q_.prototype),console.error("wrong prototype"));let p,f=null;if(!o){var h;let t=n.children[c];if(f=AT.is(t)?t:null,null!==f){let e=$U(f,d,u,r);p=e>=1?f.stateSelection:void 0,2!==e&&(f=null)}if(null===f&&(f=null!==(h=e.scene.findInstance(r))&&void 0!==h?h:null,null!==f)){let t=$U(f,d,u,r);if(p=t>=1?f.stateSelection:void 0,2!==t)f=null;else{let t=f.parent.children.indexOf(f);f.parent.children.splice(t,1),n.children.splice(c,0,f),f.parent===n?t<=c&&console.error("not possible"):(f.parent=n,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),e.pendingDeletes.delete(f))}}}if(null===f){let t=u?H_.apply(d.data,u):d.data;RE.is(t.type)&&(t={...t,type:"Empty"}),f=FT.createEntity(r,t,e),f.overrideData=u,n.add(f),n.children.splice(n.children.length-1,1),n.children.splice(c,0,f),f.updateState(f.data,e),p&&f.changeSelectedState(p,e),e.scene.registerInstanceAndSetUuid(f)}if(f.isBone){l[f.identity[f.identity.length-1]]=f.uuid}c+=1,ej(e,t,i,f,d,a,s+1,o,l)}if(!o){let t=c;for(;;){let t=n.children[c];if(!AT.is(t))break;e.pendingDeletes.add(t),c+=1}n.children.splice(t,c-t)}return!0}var tj=class extends(RB(dp,YB)){constructor(e,t){super(),this.super_Entity(e,t),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(e,t){this.updateState_Entity(e,t)}},ij=class extends DF{constructor(e,t,i){super(e,t,i),this.onBeforeRender=()=>{this.uiCanvas.render()},this.uiCanvas=new VU(e+"-canvas",t.geometry.width,t.geometry.height,i),this.uiCanvas.promise.then((()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)}))}updateByPatchedOpGeometry(e,t,i){super.updateByPatchedOpGeometry(e,t,i),0===e.type&&(void 0!==e.props.frame&&this.applyFrame(e.props.frame,i.shared),(void 0!==e.props.width||void 0!==e.props.height)&&this.applySize(e.props,i.shared))}applySize(e,t){var i,n;let r=null!==(i=null===e||void 0===e?void 0:e.width)&&void 0!==i?i:this.dataPatched.geometry.width,a=null!==(n=null===e||void 0===e?void 0:e.height)&&void 0!==n?n:this.dataPatched.geometry.height;this.uiCanvas.applySize({width:r,height:a}),this.applyGeometryParametersFromFrame(t)}applyFrame(e,t){this.uiCanvas.applyFrame(e),this.applyGeometryParametersFromFrame(t),this.applyMaterialParametersFromFrame({shared:t})}applyGeometryParametersFromFrame(e){var t;let i=this.frame;i&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:i.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:i.cornerRadius,cornerType:0})}),null!==(t=this.localGeometry)&&void 0!==t&&t.dispose(),this.localGeometry=SO(this.dataPatched.geometry,e,this.data.flatShading,this))}applyMaterialParametersFromFrame(e){let t=this.frame;if(t){let i=t.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,e,!0)}}updateEntity2DByOp(e,t,i,n){this.uiCanvas.updateEntity2DByOp(e,t,i,n),e===this.frameId&&0===t.type&&(void 0!==t.props.cornerRadius?this.applyGeometryParametersFromFrame(n):_S(t.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:n}))}get frame(){return this.uiCanvas.frame}get frameId(){var e;return null===(e=this.frame)||void 0===e?void 0:e.uuid}removeInteractionGeometry(e){super.removeInteractionGeometry(e),this.applySize({},e)}updateGeometryInteractions(e,t){super.updateGeometryInteractions(e,t),this.applySize({width:e.width,height:e.height},t)}},nj=class{constructor(e,t,i){this.variables=[],this.currentTextureIndex=0;let n=ps,r=new op,a=new ph;a.position.z=1;let s={passThruTexture:{value:null}},o=h("uniform sampler2D passThruTexture;\n\nvoid main() {\n\n\tvec2 uv = gl_FragCoord.xy / resolution.xy;\n\n\tgl_FragColor = texture2D( passThruTexture, uv );\n\n}\n",s),l=new ah(new Ph(2,2),o);function c(i){i.defines.resolution="vec2( "+e.toFixed(1)+", "+t.toFixed(1)+" )"}function h(e,t){let i=new uh({uniforms:t=t||{},vertexShader:"void main()\t{\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:e});return c(i),i}r.add(l),this.setDataType=function(e){return n=e,this},this.addVariable=function(e,t,i){let n={name:e,initialValueTexture:i,material:this.createShaderMaterial(t),dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:ts,magFilter:ts};return this.variables.push(n),n},this.setVariableDependencies=function(e,t){e.dependencies=t},this.init=function(){if(!1===i.capabilities.isWebGL2&&!1===i.extensions.has("OES_texture_float"))return"No OES_texture_float support for float textures.";if(0===i.capabilities.maxVertexTextures)return"No support for vertex shader textures.";for(let i=0;i<this.variables.length;i++){let n=this.variables[i];n.renderTargets[0]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),n.renderTargets[1]=this.createRenderTarget(e,t,n.wrapS,n.wrapT,n.minFilter,n.magFilter),this.renderTexture(n.initialValueTexture,n.renderTargets[0]),this.renderTexture(n.initialValueTexture,n.renderTargets[1]);let r=n.material,a=r.uniforms;if(null!==n.dependencies)for(let e=0;e<n.dependencies.length;e++){let t=n.dependencies[e];if(t.name!==n.name){let e=!1;for(let i=0;i<this.variables.length;i++)if(t.name===this.variables[i].name){e=!0;break}if(!e)return"Variable dependency not found. Variable="+n.name+", dependency="+t.name}a[t.name]={value:null},r.fragmentShader="\nuniform sampler2D "+t.name+";\n"+r.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let e=this.currentTextureIndex,t=0===this.currentTextureIndex?1:0;for(let i=0,n=this.variables.length;i<n;i++){let n=this.variables[i];if(null!==n.dependencies){let t=n.material.uniforms;for(let i=0,r=n.dependencies.length;i<r;i++){let r=n.dependencies[i];t[r.name].value=r.renderTargets[e].texture}}this.doRenderTarget(n.material,n.renderTargets[t])}this.currentTextureIndex=t},this.getCurrentRenderTarget=function(e){return e.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(e){return e.renderTargets[0===this.currentTextureIndex?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let e=this.variables;for(let t=0;t<e.length;t++){let i=e[t];i.initialValueTexture&&i.initialValueTexture.dispose();let n=i.renderTargets;for(let e=0;e<n.length;e++)n[e].dispose()}},this.addResolutionDefine=c,this.createShaderMaterial=h,this.createRenderTarget=function(i,r,a,s,o,l){return new ul(i=i||e,r=r||t,{wrapS:a=a||$a,wrapT:s=s||$a,minFilter:o=o||ts,magFilter:l=l||ts,format:bs,type:n,depthBuffer:!1})},this.createTexture=function(){let i=new Float32Array(e*t*4),n=new up(i,e,t,bs,ps);return n.needsUpdate=!0,n},this.renderTexture=function(e,t){s.passThruTexture.value=e,this.doRenderTarget(o,t),s.passThruTexture.value=null},this.doRenderTarget=function(e,t){let n=i.getRenderTarget(),s=i.xr.enabled,c=i.shadowMap.autoUpdate,h=i.outputEncoding,d=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=fo,i.toneMapping=ja,l.material=e,i.setRenderTarget(t),i.render(r,a),l.material=o,i.xr.enabled=s,i.shadowMap.autoUpdate=c,i.outputEncoding=h,i.toneMapping=d,i.setRenderTarget(n)}}},rj=new Pc,aj=new gl,sj=class{constructor(e){let t=e.geometry;if(!t.isBufferGeometry||3!==t.attributes.position.itemSize)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,i=new Float32Array(e.count/3);for(let r=0;r<e.count;r+=3){let n=1;t&&(n=t.getX(r)+t.getX(r+1)+t.getX(r+2)),rj.a.fromBufferAttribute(e,r),rj.b.fromBufferAttribute(e,r+1),rj.c.fromBufferAttribute(e,r+2),n*=rj.getArea(),i[r/3]=n}this.distribution=new Float32Array(e.count/3);let n=0;for(let r=0;r<i.length;r++)n+=i[r],this.distribution[r]=n;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,i){let n=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*n);return this.sampleFace(r,e,t,i)}binarySearch(e){let t=this.distribution,i=0,n=t.length-1,r=-1;for(;i<=n;){let a=Math.ceil((i+n)/2);if(0===a||t[a-1]<=e&&t[a]>e){r=a;break}e<t[a]?n=a-1:i=a+1}return r}sampleFace(e,t,i,n){let r=this.randomFunction(),a=this.randomFunction();return r+a>1&&(r=1-r,a=1-a),rj.a.fromBufferAttribute(this.positionAttribute,3*e),rj.b.fromBufferAttribute(this.positionAttribute,3*e+1),rj.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(rj.a,r).addScaledVector(rj.b,a).addScaledVector(rj.c,1-(r+a)),void 0!==i&&rj.getNormal(i),void 0!==n&&void 0!==this.colorAttribute&&(rj.a.fromBufferAttribute(this.colorAttribute,3*e),rj.b.fromBufferAttribute(this.colorAttribute,3*e+1),rj.c.fromBufferAttribute(this.colorAttribute,3*e+2),aj.set(0,0,0).addScaledVector(rj.a,r).addScaledVector(rj.b,a).addScaledVector(rj.c,1-(r+a)),n.r=aj.x,n.g=aj.y,n.b=aj.z),this}};function oj(e,t){let i=e,n=new Float32Array(4*t*t);for(let a=0;a<t*t;a++)n[4*a]=i[3*a],n[4*a+1]=i[3*a+1],n[4*a+2]=i[3*a+2],n[4*a+3]=0;let r=new up(n,t,t,bs,ps);return r.needsUpdate=!0,r}var lj="\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform sampler2D uDirections;     \nuniform vec3 uDirectionsAxis;\nuniform vec4 uWorldQuaternion;\nuniform vec3 uGravity;        \nuniform float uNoiseStrength;     // Variation of the noise\nuniform float uNoiseScale;        // Scale of the noise\nuniform float uNoiseSeed;         // Seed of the noise\nuniform float particleSize;\nuniform float uSpeed;     // update speed of the particles\nuniform float uRandomMassFactor;\n\n// COLLIDER\nuniform vec3 uColliderPos;                // Collider Position\nuniform vec3 uColliderSize;               // Collider Dimension\nuniform vec4 uColliderQuaternion;         // Collider Rotation\nuniform vec4 uColliderQuaternionInvert;   // Collider Rotation\nuniform float uBounce;                    // Bounce factor\nuniform float uForceDamping;\nuniform float uForceIntensity;\n\n\n\n\n    vec3 mod289(vec3 x) {\n      return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 mod289(vec4 x) {\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\n    }\n    \n    vec4 permute(vec4 x) {\n        return mod289(((x*34.0)+1.0)*x);\n    }\n    \n    vec4 taylorInvSqrt(vec4 r)\n    {\n    return 1.79284291400159 - 0.85373472095314 * r;\n    }\n    \n    vec3 fade(vec3 t) {\n  return t*t*t*(t*(t*6.0-15.0)+10.0);\n}\n\n    float snoise(vec3 v)\n    {\n    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n    vec3 i  = floor(v + dot(v, C.yyy) );\n    vec3 x0 =   v - i + dot(i, C.xxx) ;\n    vec3 g = step(x0.yzx, x0.xyz);\n    vec3 l = 1.0 - g;\n    vec3 i1 = min( g.xyz, l.zxy );\n    vec3 i2 = max( g.xyz, l.zxy );\n    vec3 x1 = x0 - i1 + C.xxx;\n    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n    \n    // Permutations\n    i = mod289(i);\n    vec4 p = permute( permute( permute(\n                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n    \n    // Gradients: 7x7 points over a square, mapped onto an octahedron.\n    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n    float n_ = 0.142857142857; // 1.0/7.0\n    vec3  ns = n_ * D.wyz - D.xzx;\n    \n    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n    \n    vec4 x_ = floor(j * ns.z);\n    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n    \n    vec4 x = x_ *ns.x + ns.yyyy;\n    vec4 y = y_ *ns.x + ns.yyyy;\n    vec4 h = 1.0 - abs(x) - abs(y);\n    \n    vec4 b0 = vec4( x.xy, y.xy );\n    vec4 b1 = vec4( x.zw, y.zw );\n    \n    vec4 s0 = floor(b0)*2.0 + 1.0;\n    vec4 s1 = floor(b1)*2.0 + 1.0;\n    vec4 sh = -step(h, vec4(0.0));\n    \n    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n    \n    vec3 p0 = vec3(a0.xy,h.x);\n    vec3 p1 = vec3(a0.zw,h.y);\n    vec3 p2 = vec3(a1.xy,h.z);\n    vec3 p3 = vec3(a1.zw,h.w);\n    \n    //Normalise gradients\n    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n    p0 *= norm.x;\n    p1 *= norm.y;\n    p2 *= norm.z;\n    p3 *= norm.w;\n    \n    // Mix final noise value\n    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n    m = m * m;\n    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                  dot(p2,x2), dot(p3,x3) ) );\n    }\n    \n    vec3 snoiseVec3( vec3 x ){\n    \n      float s  = snoise(vec3( x ));\n      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n      vec3 c = vec3( s , s1 , s2 );\n      return c;\n    \n    }\n    \n      \n    vec3 curlNoise( vec3 p, float seed){\n      p += seed;\n      const float e = .1;\n      vec3 dx = vec3( e   , 0.0 , 0.0 );\n      vec3 dy = vec3( 0.0 , e   , 0.0 );\n      vec3 dz = vec3( 0.0 , 0.0 , e   );\n    \n      vec3 p_x0 = snoiseVec3( p - dx );\n      vec3 p_x1 = snoiseVec3( p + dx );\n      vec3 p_y0 = snoiseVec3( p - dy );\n      vec3 p_y1 = snoiseVec3( p + dy );\n      vec3 p_z0 = snoiseVec3( p - dz );\n      vec3 p_z1 = snoiseVec3( p + dz );\n    \n      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n    \n      const float divisor = 1.0 / ( 2.0 * e );\n      return normalize( vec3( x , y , z ) * divisor );\n    \n    }\n\n\n// Classic Perlin noise\nfloat cnoise(vec3 P)\n{\n  vec3 Pi0 = floor(P); // Integer part for indexing\n  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1\n  Pi0 = mod289(Pi0);\n  Pi1 = mod289(Pi1);\n  vec3 Pf0 = fract(P); // Fractional part for interpolation\n  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0\n  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);\n  vec4 iy = vec4(Pi0.yy, Pi1.yy);\n  vec4 iz0 = Pi0.zzzz;\n  vec4 iz1 = Pi1.zzzz;\n\n  vec4 ixy = permute(permute(ix) + iy);\n  vec4 ixy0 = permute(ixy + iz0);\n  vec4 ixy1 = permute(ixy + iz1);\n\n  vec4 gx0 = ixy0 * (1.0 / 7.0);\n  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;\n  gx0 = fract(gx0);\n  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);\n  vec4 sz0 = step(gz0, vec4(0.0));\n  gx0 -= sz0 * (step(0.0, gx0) - 0.5);\n  gy0 -= sz0 * (step(0.0, gy0) - 0.5);\n\n  vec4 gx1 = ixy1 * (1.0 / 7.0);\n  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;\n  gx1 = fract(gx1);\n  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);\n  vec4 sz1 = step(gz1, vec4(0.0));\n  gx1 -= sz1 * (step(0.0, gx1) - 0.5);\n  gy1 -= sz1 * (step(0.0, gy1) - 0.5);\n\n  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);\n  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);\n  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);\n  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);\n  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);\n  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);\n  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);\n  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);\n\n  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));\n  g000 *= norm0.x;\n  g010 *= norm0.y;\n  g100 *= norm0.z;\n  g110 *= norm0.w;\n  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));\n  g001 *= norm1.x;\n  g011 *= norm1.y;\n  g101 *= norm1.z;\n  g111 *= norm1.w;\n\n  float n000 = dot(g000, Pf0);\n  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));\n  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));\n  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));\n  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));\n  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));\n  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));\n  float n111 = dot(g111, Pf1);\n\n  vec3 fade_xyz = fade(Pf0);\n  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);\n  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);\n  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); \n  return 2.2 * n_xyz;\n}\n\n\nvec3 fbm_vec3(vec3 p, float frequency, float offset)\n{\n  return vec3(\n    cnoise((p+vec3(offset))*frequency),\n    cnoise((p+vec3(offset+20.0))*frequency),\n    cnoise((p+vec3(offset-30.0))*frequency)\n  );\n}\n\n"+"\nfloat rand(vec2 co){\n    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n } \nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n  \n  return acceleration;\n}\n\nvec4 conjugate(vec4 q) {\n  return vec4(q.w, -q.x, -q.y, -q.z);\n}\n\n// Function to compute the normal of the ellipsoid at a given point\nvec3 ellipsoidNormal(vec3 p, vec3 radii) {\n  return normalize(p / (radii * radii));\n}\n\nfloat friction = .3;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    vec3 directions = texture2D( uDirections, vUv ).xyz;    \n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float mass = rand(originalPosition.xy) * 0.5 + 0.5;\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active\n    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision\n\n    // Randomness Mass\n    mass = (1.0 - (uRandomMassFactor * mass));\n    \n    if (isActive == 1.0) {\n      // **************************************************************\n      // FORCES NOISES\n      // **************************************************************\n      #ifdef USE_CURL_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {\n          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;\n        }\n      #endif\n      // **************************************************************\n      #ifdef USE_SIMPLEX_NOISE\n        if (uNoiseScale > 0.0 ) {\n          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {\n          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);\n        }\n      #endif\n      // ************************************************************** \n      #ifdef USE_FBM_NOISE\n        if (uNoiseScale > 0.0 ) {\n          float offset = 0.0;\n          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), offset);\n          velocity *= uSpeed;\n        }\n        // Variation of the noise Over Time\n        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      \n          float offset = 0.0;\n          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;\n        }\n      #endif\n\n      // COLLIDER\n      ".concat("\n  #ifdef USE_COLLIDER\n    float restitution = max(uBounce * 2., .01); // Energy Loss\n    // SPHERE COLLIDER\n    // **************************************************************\n    #ifdef USE_SPHERE_COLLIDER       \n      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n      vec3 radii = uColliderSize;\n      // Adjust position relative to collider\n      vec3 relPos = position - uColliderPos;\n      // Apply rotation of the collider to the relative position\n      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n      // Scale relative position by radii (for ellipsoid collision detection)\n      vec3 scaledPos = relPos / radii;\n      // Calculate ellipsoidal distance\n      float dist = length(scaledPos); // Distance in terms of ellipsoid\n      \n      // Check for collision\n      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {\n          // Compute the normal at the collision point, accounting for particle size\n        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          \n        // Compute the normal at the collision point\n        vec3 normal = ellipsoidNormal(adjustedPos, radii);\n        // Rotate the normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);\n        // Reflect the velocity vector off the normal\n        velocity = reflect(velocity, normal) * restitution;\n\n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif\n\n    // BOX COLLIDER or PLANE COLLIDER \n    // **************************************************************\n    #ifdef USE_BOX_COLLIDER\n      // Box dimensions and repulsion variables\n      vec3 boxHalfSize = uColliderSize / 2.0;\n      // Convert world position to box's local space\n      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n      // Collision detection\n      vec3 localDistance = abs(localPos) - boxHalfSize;\n      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    \n\n      // Collision Detected\n      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      \n        // Find the nearest face normal for bounce direction\n        vec3 normal;\n        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {\n            normal = vec3(sign(localPos.x), 0.0, 0.0);\n        } else if (localDistance.y > localDistance.z) {\n            normal = vec3(0.0, sign(localPos.y), 0.0);\n        } else {\n            normal = vec3(0.0, 0.0, sign(localPos.z));\n        }            \n        // Rotate normal back to world space\n        normal = applyQuaternionToVector(uColliderQuaternion, normal);      \n        // Reflect velocity and apply repulsion force\n        velocity = reflect(velocity, normal) * restitution;\n        \n        collisionFlag = 1.0;\n      } else {\n        collisionFlag = 0.0;\n      }\n    #endif      \n  #endif      \n  // END COLLIDER    \n","\n      // ATTRACTION\n      ").concat("\n  #ifdef USE_ATTRACTOR\n\n      #ifdef USE_SPHERE_COLLIDER      \n        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)\n        vec3 radii = uColliderSize;\n        // Adjust position relative to collider\n        vec3 relPos = position - uColliderPos;\n        // Apply rotation of the collider to the relative position\n        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n        // Scale relative position by radii (for ellipsoid collision detection)\n        vec3 scaledPos = relPos / radii;\n        // Calculate ellipsoidal distance\n        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid\n        float insideCheck = 1.0;\n\n      #endif\n\n\n      #ifdef USE_BOX_COLLIDER\n        // Box dimensions\n        vec3 boxHalfSize = uColliderSize / 2.0;\n        // Convert world position to box's local space\n        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n        vec3 localDistance = abs(localPos) - boxHalfSize;\n        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n        float insideCheck = particleSize;\n      #endif      \n  \n      // Apply vortex force inside the Helper\n      #ifdef USE_FORCE_LOCAL_SPACE\n        if (distToSurface <= insideCheck ) {    \n            // Define parameters for the attractor field\n            #ifdef USE_SPHERE_COLLIDER      \n              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed\n            #endif\n\n            #ifdef USE_BOX_COLLIDER\n              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed\n              #endif\n\n            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)\n          \n            // Use the same radii calculation code as for the collider\n            vec3 attractorRadii = uColliderSize;\n            // Adjust position relative to attractor center\n            vec3 relPos = position - uColliderPos;\n            // Apply rotation of the collider to the relative position\n            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            \n            // Scale relative position by radii (for ellipsoid attraction)\n            vec3 scaledPos = relPos / attractorRadii;\n\n            // Calculate ellipsoidal distance as attractor radius\n            float attractorRadius = length(scaledPos);\n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * attractorStrength;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= attractorDamping;\n        }\n      #else \n            // Calculate the distance from the attractor center\n            vec3 relativePosition = position - uColliderPos;\n            // Calculate the force vector towards the attractor center\n            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;\n            // Apply the attractor force to the particle\n            velocity -= attractorForce;\n            // Attenuate the particle's velocity\n            velocity *= uForceDamping;\n      #endif    \n  #endif      \n","  \n      // VORTEX\n      ").concat("\n  #ifdef USE_VORTEX\n    // Box dimensions\n    vec3 boxHalfSize = uColliderSize / 2.0;\n    // Convert world position to box's local space\n    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      \n    vec3 localDistance = abs(localPos) - boxHalfSize;\n    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));\n\n    // Apply vortex force inside the box\n    if (distToSurface <= particleSize) {\n      float vortexStrength = uForceIntensity;\n      vec3 localTopCenter = vec3(0.0, 0., 0.0);\n\n      // Transform the local top center to the world space\n      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);\n      // Calculate the vector from particle to vortex center\n      vec3 vortexVector = vortexCenter - position;\n\n      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector\n      // Note: important to add a tiny z component to the up vector to avoid instability\n      vec3 upVector = vec3(0.0, 1.0, 0.01);\n      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));\n      rotationAxis = normalize(rotationAxis);\n\n      // Add rotational component to velocity\n      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; \n\n      vec3 rotationVelocity = rotationAxis * rotationSpeed;\n      // velocity += rotationVelocity * 0.005 ;\n      velocity = rotationVelocity * 0.005 ;\n\n      // Calculate vortex force\n      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;\n      // Apply the vortex force to the particle\n      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);\n      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);\n    }\n  #endif      \n","\n    } \n    // End isActive\n\n    // SPAWN BIRTH \n    // **************************************************************\n    // if (isSpawning == 1.)\n    #ifdef USE_NORMALS\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);\n    #else\n      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    \n    #endif\n    \n    // if (collisionFlag == 0.0)\n    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);\n\n    gl_FragColor = vec4(velocity, collisionFlag);\n}\n"),cj="\n\n  // Linear Fade In\n  float linearFadeIn(float t) {\n    return t;\n  }\n\n\n  // linear fade out\n  float linearFadeOut(float t) {\n    return 1.0 - t;\n  }\n  \n  float linearInOut(float t) {\n    return t < 0.5 ? t :  (1.0 - t);  \n  }\n\n    // lerp\n    float lerp(float a, float b, float t) {\n      return a + (b - a) * t;\n    }\n\n  // Ease In Out Quart\n  float exponentialInOut(float t) {\n    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :\n    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :\n    1.0;\n   }\n\n  // constant\n  float constant(float t) {\n    return 1.0;\n  } \n",hj="\n  uniform sampler2D uPosition;\n  uniform float uSize;\n  uniform float uSizeEnd;\n  uniform vec3 uWorldOffset;\n  uniform vec4 uWorldQuaternion;\n  // Billboard Behavior - Currently at Zero, but we can change that\n  uniform float uRotation;\n  uniform float uRotationEnd;\n  uniform vec2 center;\n\n  // Randomness\n  uniform float uRandScaleFactor;\n  uniform float uRandRotationFactor;\n\n  attribute vec2 ref;\n\n  varying float v_LifeLeft;    // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  ".concat("\n\nfloat rand(vec3 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n  vec3 acceleration = force / mass;\n    \n  return acceleration;\n}\n","\n  ").concat(cj,"\n"),dj="\n  uniform vec4 uColor;                // start color\n  uniform vec4 uColor2;               // end color\n  uniform sampler2D uTexture;         // texture\n  varying float v_LifeLeft;   // normalized lifetime 1 to 0\n  varying vec2 vUv;\n  varying vec2 vRef;\n\n  float random(vec2 co) {\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n  }\n  "+cj+"  \n  ".concat("\nvec3 rgb2xyz (in vec3 rgb) {\n    float r = rgb.r;\n\tfloat g = rgb.g;\n\tfloat b = rgb.b;\n\n\tr = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);\n\tg = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);\n\tb = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);\n\n\tfloat x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);\n\tfloat y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);\n\tfloat z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);\n    \n    vec3 xyz = vec3(\n        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,\n        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,\n        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0\n    );\n    return(xyz);\n}\n\nvec3 xyz2lab (in vec3 xyz) {\n\tfloat x = xyz.x / 95.047;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 108.883;\n\n\tx = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);\n\ty = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);\n\tz = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);\n\n    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));\n    return(lab);\n}\n\nvec3 rgb2lab(in vec3 rgb) {\n    vec3 xyz = rgb2xyz(rgb);\n    vec3 lab = xyz2lab(xyz);\n    return(lab);\n}\n\nvec3 xyz2rgb (in vec3 xyz) {\n\tfloat x = xyz.x / 100.0;\n\tfloat y = xyz.y / 100.0;\n\tfloat z = xyz.z / 100.0;\n\t\n    \n\tfloat r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);\n\tfloat g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);\n\tfloat b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);\n\n\tr = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;\n\tg = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;\n\tb = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;\n\n\tr = min(max(0.0, r), 1.0);\n\tg = min(max(0.0, g), 1.0);\n\tb = min(max(0.0, b), 1.0);\n\n\treturn(vec3(r, g, b));\n}\n\nvec3 lab2xyz (in vec3 lab) {\n    float l = lab.x;\n\tfloat a = lab.y;\n\tfloat b = lab.z;\n\n  \tfloat y = (l + 16.0) / 116.0;\n\tfloat x = a / 500.0 + y;\n\tfloat z = y - b / 200.0;\n\n\tfloat y2 = pow(y, 3.0);\n\tfloat x2 = pow(x, 3.0);\n\tfloat z2 = pow(z, 3.0);\n\n  \ty = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;\n\tx = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;\n\tz = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;\n\n\tx *= 95.047;\n\ty *= 100.0;\n\tz *= 108.883;\n\n\treturn(vec3(x, y, z));\n}\nvec3 lab2rgb (in vec3 lab) {\n    vec3 xyz = lab2xyz(lab);\n    vec3 rgb = xyz2rgb(xyz);\n    return(rgb);\n}\n\n","\n\n"),uj=class extends uh{constructor(e,t){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(e,t),this.context=t}reset(){}init(e,t){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=e.ease,this.easeSize=e.easeSize,this.layers=[],dI.startContext(dI.globalContext),this.lightLayer=new HL(0,"",{...iC.defaultData("light","phong"),visible:!1},new Xk,{},t.shared),dI.endContext(dI.globalContext),this.build()}updateState(e){void 0!==e.coloring&&(this.isColoringRandom="random"===e.coloring),void 0!==e.color&&(e.color instanceof Array?this.uniforms.uColor.value=e.color:this.uniforms.uColor.value=this.context.shared.color(e.color)),void 0!==e.color2&&(e.color2 instanceof Array?this.uniforms.uColor2.value=e.color2:this.uniforms.uColor2.value=this.context.shared.color(e.color2)),void 0!==e.size&&(this.uniforms.uSize.value=e.size[0],this.uniforms.uSizeEnd.value=e.size[1],e.size[0]!==e.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),void 0!==e.ease&&(this.easeOpacity=e.ease,this.build()),void 0!==e.easeSize&&(this.easeSize=e.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(e){this.build(),e.defines=this.defines,e.uniforms=this.uniforms,e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader}build(){let e=new ek;return e.needsJitter=this.needsJitter,e.addFragmentParsCode("\nlayout(location = 1) out vec4 gVelocity;\n"),e.buildShader("vertex",this.fragment),e.buildShader("fragment",this.fragment),e.addFragmentFinalCode("\n    // Discard fully transparent pixels \n    if (gl_FragColor.a <= 0.0) discard;\n\n    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);\n"),this.isColoringRandom&&e.define("USE_RANDOM_COLORING"),this.useSizeEnd&&e.define("USE_SIZE_END"),e.addVertexParsCode(hj),e.addFragmentParsCode(dj),e.addVertexFinalCode((e=>{let{easeSize:t="linearFadeOut"}=e;return"\n  vUv = uv;  \n  vRef = ref;\n  // Normalized LifeTime 1 to 0\n  float lifeLeft = texture2D(uPosition, ref).w;\n  v_LifeLeft = lifeLeft;\n  // Position From DataTexture Simulation\n  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;\n  // Apply World Quaternion\n  pos = applyQuaternionToVector(uWorldQuaternion, pos);  \n            \n  #ifdef  USE_SIZE_END\n    // Scaled Over Time\n    float t = 1. - lifeLeft;\n    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd\n    vec3 scaledPosition = position * vec3(currentSize);\n  #else\n    // Change Size Behavior over LifeTime\n    float easeSize = ".concat(t,"(1. - lifeLeft);\n    // Scaled Over Time\n    vec3 scaledPosition = position * vec3(uSize * easeSize);\n  #endif\n\n  // Billboard Behavior\n  vec2 scale;\n  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    \n  // Randomness \n  float randRef = rand(ref);\n  scale *= (1.0 - (uRandScaleFactor * randRef));\n  // Rotation\n  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);\n  float originalRotation = (1.0 - uRotation) * 2.0 * PI;\n  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;\n  // OverTime\n  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);\n\n  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;\n  vec2 rotatedPosition;\n  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;\n  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;\n  \n  mat4 instanceMatrix = mat4(\n    vec4(1.0, 0.0, 0.0, 0.0),\n    vec4(0.0, 1.0, 0.0, 0.0),\n    vec4(0.0, 0.0, 1.0, 0.0),\n    vec4(pos.x, pos.y, pos.z, 1.0)\n  );  \n\n  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n  mvPosition.xy += rotatedPosition;\n  gl_Position = projectionMatrix  * mvPosition;   \n")})({easeSize:this.easeSize})),e.addFragmentFinalCode((e=>{let{easeOpacity:t="linearFadeOut"}=e;return"  \n  // if Particle is dead, hide it\n  if (v_LifeLeft <= 0.005 ) {\n    discard;\n  }\n\n  #ifdef USE_RANDOM_COLORING\n    float randVal = random(vRef); // Generate a random value based on the reference\n    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors\n  #else\n    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);\n  #endif\n\n  // Opacity over Life Time\n  float finalAlpha = ".concat(t,"(1. - v_LifeLeft);  \n  vec4 textureColor = texture2D(uTexture, vUv).rgba; \n  finalColor = textureColor.rgb * color.rgb;\n  finalAlpha = color.a * textureColor.a * finalAlpha;\n  \n  gl_FragColor = vec4(finalColor, finalAlpha);     \n\n")})({easeOpacity:this.easeOpacity})),this.vertexShader=e.getCode("vertex"),this.fragmentShader=e.getCode("fragment"),this.defines=e.defines,this.uniforms={...e.uniforms,...this.uniforms},this.extensions=e.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach((e=>e.dispose())),super.dispose()}},pj=class{constructor(e,t,i,n){var r;this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=e,this.type=i,this.textureSize=function(e){let t=Math.ceil(Math.sqrt(e));return Math.max(t,1)}(t);this.targetMesh="Mesh"===(null===n||void 0===n?void 0:n.type)&&n?n:this.getMesh(i,1);let{positions:a,dataTexture:s,dataTextureNormals:o}=this.createPositions(this.textureSize,null!==(r=this.targetMesh)&&void 0!==r?r:this.getMesh(i,1));this.positionsTexture=s,this.positionsAttribute=a,this.directionsTexture=o}createPositions(e,t){let{positions:i,normals:n}=function(e,t){let i=new ah(e.geometry,e.material),n=[],r=[],a=new gl,s=new gl;null!==i.geometry.index&&(i.geometry=i.geometry.toNonIndexed());let o=new sj(i).build();for(let l=0;l<t;l++)o.sample(a,s),n.push(a.x,a.y,a.z),r.push(s.x,s.y,s.z);return{positions:new Float32Array(n),normals:new Float32Array(r)}}(t,e*e);return{dataTexture:oj(i,e),positions:i,dataTextureNormals:oj(n,e)}}getMesh(e,t){let i=null;switch(e){case"SphereEmitterShape":i=new Ff(.5*t,32,32);break;case"TorusEmitterShape":i=new Bf(.5*t,.3,15,40);break;case"ConeEmitterShape":i=new nf(t,t,15);break;case"BoxEmitterShape":i=new oh(t,t,t);break;case"PlaneEmitterShape":i=new Ph(t,t),i.rotateX(-Math.PI/2);break;default:i=new Ff(t,32,32)}return new ah(i,new Rc({color:16711680}))}applyToShader(e,t){this.size=(new gl).fromArray(t.size),e.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function fj(e){let t={...e},i=jE.defaultData;t.forceFieldObjectId&&(t.colliderEntityId=t.forceFieldObjectId);let n={...i.shape,...t.shape},r={...i.renderMaterial,...t.renderMaterial};return{...i,...t,shape:n,renderMaterial:r}}var mj=class extends vc{constructor(e,t){var i,n,r,a;super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new pm,this.currentWorldPosition=new gl,this.systemQuaternion=new ml,this.worldGravity=new gl(0,0,0),this.directionAxis=new gl(0,0,0),this.colliderV3=new gl(0,0,0),this.colliderQuaternion=new ml(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=e,this.system=t,this.shared=t.context.shared;let s=t.data;this.material=new uj(s.renderMaterial,t.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:s.renderMaterial.color},uColor2:{value:s.renderMaterial.color2},uPosition:{value:new gl(0,0,0)},uEmissionData:{value:new gl(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new gl(0,0,0)},uWorldQuaternion:{value:new dl(0,0,0,1)},uRandScaleFactor:{value:null!==(i=s.randomScale)&&void 0!==i?i:0},uRandRotationFactor:{value:null!==(n=s.randomRotation)&&void 0!==n?n:0},uRotation:{value:null!==(r=s.renderMaterial.spriteRotation[0])&&void 0!==r?r:0},uRotationEnd:{value:null!==(a=s.renderMaterial.spriteRotation[1])&&void 0!==a?a:0}},this.setTexture(this.material.uniforms,s.renderMaterial.texture),this.init(s)}setTexture(e,t){let i=t.data;if("string"==typeof t){let i=this.shared.image(t),n=new hl(i.img);return n.needsUpdate=!0,void(e.uTexture.value=n)}if("string"!=typeof i){let t=new Image;t.onload=()=>{let i=new hl(t);i.needsUpdate=!0,e.uTexture.value=i};let n=new Blob([i],{type:"image/*"}),r=URL.createObjectURL(n);t.src=r}}updateGeometryAttributes(e,t){var i;let n=function(e){let t=new Float32Array(e*e*2);for(let i=0;i<e;i++)for(let n=0;n<e;n++){let r=i*e+n;t[2*r+0]=i/(e-1),t[2*r+1]=n/(e-1)}return t}(t);null===(i=this.emitterShape)||void 0===i||!i.positionsAttribute||e.geometry.setAttribute("ref",new gp(n,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let e=this.system;e.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),e.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(e,t){var i;if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset)return void this.reset();this.applyWorldSpace(),this.globalTime=e,this.positionSimRT.material.uniforms.uTime.value=e,this.emissionRateSimRT.material.uniforms.uTime.value=e;let n=1e3/t,r=this.targetFPS/n,a=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=a,this.previousRatio=a;let s=this.isEmitting?this.GoEmitSomeParticles(e,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=null===(i=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT))||void 0===i?void 0:i.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let e=this.system.colliderEntities[0];if(!e)return;e.getWorldPosition(this.colliderV3),0===this.colliderV3.y&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let t=e.data.size;this.colliderV3.fromArray(t),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),e.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(e){!this.velocitySimRT||!this.positionSimRT||(e.renderMaterial&&this.updateMaterialState(e.renderMaterial),this.updateParticleState(e))}updateVariableState(e,t){if(!this.velocitySimRT||!this.positionSimRT)return;"size"===t[2]&&this.material.updateState({size:[e,this.material.uniforms.uSizeEnd.value]}),"sizeEnd"===t[2]&&this.material.updateState({size:[this.material.uniforms.uSize.value,e]});let i=(e,t)=>{let i=[...this.system.data.shape.size];i[e]=t,this.updateParticleState({shape:{...this.system.data.shape,size:i}})};"shape_size_0"===t[2]&&i(0,e),"shape_size_1"===t[2]&&i(1,e),"shape_size_2"===t[2]&&i(2,e),"speed"===t[2]&&(this.velocitySimRT.material.uniforms.uSpeed.value=e/10),"gravity"===t[2]&&this.worldGravity.set(0,e/100,0),"noiseStrength"===t[2]&&(this.noiseStrength=e,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),"noiseScale"===t[2]&&(this.noiseScale=e,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),"direction_x"===t[2]&&(this.directionAxis=this.getDirectionAxis([Number(e),this.system.data.direction[1],this.system.data.direction[2]])),"direction_y"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(e),this.system.data.direction[2]])),"direction_z"===t[2]&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(e)]))}updateMaterialState(e){this.material.updateState({...e,size:e.size?[Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),e.texture&&(this.setTexture(this.material.uniforms,e.texture),this.material.needsUpdate=!0)}updateParticleState(e){if(this.positionSimRT&&this.velocitySimRT){var t,i;if(this.shouldReInitGPUCompute(e)&&this.init(fj(this.system.data)),void 0!==e.life&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=e.life),void 0!==e.speed&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10),void 0!==e.collisionBounce&&(this.velocitySimRT.material.uniforms.uBounce.value=e.collisionBounce),void 0!==e.noiseStrength&&(this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),void 0!==e.noiseScale&&(this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),void 0!==e.noiseSeed&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=e.noiseSeed),void 0!==e.randomMass&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=e.randomMass),void 0!==(null===(t=e.renderMaterial)||void 0===t?void 0:t.size)){let t=this.shared.getVariable(e.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(t)}if(void 0!==(null===(i=e.renderMaterial)||void 0===i?void 0:i.spriteRotation)&&(this.material.uniforms.uRotation.value=e.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=e.renderMaterial.spriteRotation[1]),void 0!==e.shape){var n,r;let t=null!==(n=e.shape.size)&&void 0!==n?n:this.system.data.shape.size,i=[Number(this.shared.getVariable(t[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t[2],[this.uuid,"particles","shape_size_2"]))],a={...fj(this.system.data).shape,size:i};null===(r=this.emitterShape)||void 0===r||r.applyToShader(this.positionSimRT.material.uniforms,a)}if(void 0!==e.gravity&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),void 0!==e.direction){let t=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(t),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}void 0!==e.randomRotation&&(this.material.uniforms.uRandRotationFactor.value=e.randomRotation),void 0!==e.randomScale&&(this.material.uniforms.uRandScaleFactor.value=e.randomScale)}}updateForceFieldParameters(e){!this.velocitySimRT||(void 0!==e.forceIntensity&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=e.forceIntensity),void 0!==e.forceDambing&&(this.velocitySimRT.material.uniforms.uForceDamping.value=e.forceDambing))}getDirectionAxis(e){let t=[Number(e[0])*Uo.DEG2RAD,Number(e[1])*Uo.DEG2RAD,Number(e[2])*Uo.DEG2RAD],i=new ic(t[0],t[1],t[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(e){let{birthRatePerSec:t,rootObjectType:i,colliderEntityId:n,shape:r,emitTimeDuration:a,emitTimeCycle:s,life:o,directionMode:l,noiseType:c}=e;return void 0!==t||void 0!==i||n||null===n||void 0!==s||void 0!==r||void 0!==o||void 0!==a||void 0!==l||void 0!==c}init(e){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:e.birthRatePerSec,particleMaxLifeTime:e.life,loopDuration:"infinity"===e.emitTimeCycle?0:e.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to ".concat(1e5,".")),this.particlesAmount=1e5),this.emitterShape=this.createShape(e.shape,this.particlesAmount);let t=setInterval((()=>{if(this.emitterShape){if(isNaN(this.emitterShape.positionsTexture.source.data.data[0]))return void this.init(e);clearInterval(t)}}),100);if(!this.emitterShape)return;let i=new nj(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),n=this.updateSimulationDefinition(e),r=i.addVariable("uCurrentPosition",n+"\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\nuniform sampler2D uOriginalPosition;\nuniform float uTime;\nuniform float uSpeed;     // update speed of the particles\nuniform vec3 uWorldOffset;    \nuniform vec4 uWorldQuaternion;\nuniform float uMaxLifeTime;\nuniform vec3 uEmitterSize;\nuniform float uFPSRatio;     // 1  for 60 FPS\n\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy,\n        vec2(12.9898,78.233)))*\n        43758.5453123);\n}\nvec3 applyQuaternionToVector( vec4 q, vec3 v ){\n    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );\n}\n\nvec3 applyForce(vec3 force, float mass) {\n    vec3 acceleration = force / mass;\n    \n    return acceleration;\n  }\n  \n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;\n    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0\n    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted\n    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);\n    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;\n    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided\n    float lifeTime = uMaxLifeTime;\n\n    // Calculate the position adjustment based on collision\n    //     if (collisionFlag > .5) {  \n    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0\n    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise\n    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);\n\n    // Update position based on collision or normal movement\n    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);\n    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);\n\n    // EMISSION RATE - BIRTH\n    // if (isSpawning == 1.0) {\n    // Better Approach to avoid If statement\n    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;\n    originalPosition = mix(originalPosition, newPosition, isSpawning);\n    position = mix(position, originalPosition, isSpawning);;\n    timeStart = mix(timeStart, uTime, isSpawning);\n\n    // Calculate timeLeft for life normalization\n    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);\n    float life_Normalize = timeLeft / lifeTime;\n\n    // Use isActive to blend between the calculated color and black\n    vec4 activeColor = vec4(position, life_Normalize);\n    // if (isActive == 1.0) {\n    gl_FragColor = mix(vec4(0.0), activeColor, isActive);\n\n}\n",this.emitterShape.positionsTexture),a=i.addVariable("uCurrentVelocity",n+lj,this.emitterShape.directionsTexture),s=i.addVariable("uCurrentEmissionRate","\n// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU\n// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU\n\nuniform sampler2D uIndex; // Texture with corresponding index\nuniform float uLastIndexEmitted; // Last emitted index\nuniform float uParticlesToEmit; // Number of particles to emit on that frame\nuniform float uTime;\n\nvoid main() {\n    vec2 vUv = gl_FragCoord.xy / resolution.xy;\n    float particleIndex = texture(uIndex, vUv).x;\n    float timeLeft = texture2D( uCurrentPosition, vUv ).w;\n    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active\n    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;\n\n\n    // ********** Detect Colision to Create a flag and use it in position **********\n    // We are doing this here, so\n\n    // ********** Emit Particles **********\n    // X = isSpawning 0.0 or 1.0\n    // Y = isActive 0.0 or 1.0\n    // Check if the vertex index is between the first value and the last value\n    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {\n    //     // Emit a particle by writing 1 to the red channel of the color output\n    //     // r: 1. == emit the particle\n    //     // g: 1. == particle is now active\n    //     timeStart = uTime;\n    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);\n    // } else {\n    //     // The Particle is either already emitted or not in the range of the particles to emit\n    //     // Do not emit a particle by writing 0 to the red channel of the color output        \n    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);\n    // }\n    // Determine if the particle is within the emission range\n    float emitLowerBound = step(uLastIndexEmitted, particleIndex);\n    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);\n    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise\n\n    // Set timeStart and color\n    timeStart = mix(timeStart, uTime, emitParticle);\n    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);\n\n\n}\n",function(e){let t=new Float32Array(4*e*e);for(let n=0;n<e*e;n++)t[4*n]=0,t[4*n+1]=0,t[4*n+2]=0,t[4*n+3]=0;let i=new up(t,e,e,bs,ps);return i.needsUpdate=!0,i}(this.emitterShape.textureSize));i.setVariableDependencies(r,[r,a,s]),i.setVariableDependencies(a,[r,a,s]),i.setVariableDependencies(s,[r,a,s]);let o=function(e){let{size:t}=e,i=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)i[4*r]=r,i[4*r+1]=0,i[4*r+2]=0,i[4*r+3]=0;let n=new up(i,t,t,bs,ps);return n.needsUpdate=!0,n}({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new gl(0,0,0)},uWorldQuaternion:{value:new dl(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:e.life},uEmitterSize:{value:new gl(Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};r.material.uniforms=l;let c=this.getDirectionFromVariable(e.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(e.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(e.noiseScale,[this.uuid,"particles","noiseScale"]));let h=e.colliderEntityId&&this.system.getColliderData(e.colliderEntityId),d={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new dl(0,0,0,1)},uColliderPos:{value:new gl(0,0,0)},uColliderSize:{value:new gl(0,0,0)},uForceIntensity:{value:h?h.forceIntensity:0},uForceDamping:{value:h?h.forceDambing:0},uColliderQuaternion:{value:new dl(0,0,0,1)},uColliderQuaternionInvert:{value:new dl(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:e.noiseSeed},uRandomMassFactor:{value:e.randomMass},uBounce:{value:e.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(e.speed,[this.uuid,"particles","speed"]))/10}};a.material.uniforms=d;let u={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};s.material.uniforms=u;let p=[Number(this.shared.getVariable(e.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.shape.size[2],[this.uuid,"particles","shape_size_2"]))],f={...fj(this.system.data).shape,size:p};this.emitterShape.applyToShader(r.material.uniforms,f),i.init(),this.gpuCompute=i,this.positionSimRT=r,this.velocitySimRT=a,this.emissionRateSimRT=s,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(e){return[Number(this.shared.getVariable(e[0],[this.uuid,"particles","direction_x"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","direction_y"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","direction_z"]))]}updateSimulationDefinition(e){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,e.colliderEntityId&&this.system.colliderEntities.length>0){let t=this.system.getColliderData(e.colliderEntityId);switch(null===t||void 0===t?void 0:t.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0}let i=null===t||void 0===t?void 0:t.colliderType;"sphere"===i&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),"box"===i&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),"helper"===(null===t||void 0===t?void 0:t.forceRange)&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}"normals"===e.directionMode&&(this.simFeaturesDefinition.USE_NORMALS=!0),"curl"===e.noiseType&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),"simplex"===e.noiseType&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),"fbm"===e.noiseType&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let t="";for(let[i,n]of Object.entries(this.simFeaturesDefinition))n&&(t+="#define ".concat(i,"\n"));return t}createShape(e,t){this.emitterShape&&this.emitterShape.dispose();let i=new gl(Number(this.shared.getVariable(e.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e.size[2],[this.uuid,"particles","shape_size_2"])));if("MeshEmitterShape"===e.type){let n=null;return this.system.context.scene.traverseEntity((t=>{t.uuid===e.fromMeshId&&(n=t)})),n?new pj(i,t,e.type,n):new pj(i,t,"SphereEmitterShape")}return new pj(i,t,e.type)}createPrimaryEmitter(e){let t,i=e*e;return t=new _p(new Ph(1,1,1),this.material,i),this.updateGeometryAttributes(t,e),this.material.needsUpdate=!0,t.onBeforeRender=()=>{this.applyWorldSpace()},t}getMaxParticlesAmount(e){let{birthRatePerSecond:t,particleMaxLifeTime:i,loopDuration:n=0}=e;return Math.ceil(t*(i+n))}dispose(){var e,t;!this.gpuCompute||(null!==(e=this.rootObject)&&void 0!==e&&null!==(e=e.parent)&&void 0!==e&&e.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),null===(t=this.emitterShape)||void 0===t||t.dispose())}GoEmitSomeParticles(e,t){let i=e-this.lastEmitTime,n=1/t;if(i>=n){let t=Math.max(1,Math.floor(i/n));return this.lastEmitTime=e,this.emittedParticlesAmount+t>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=t,t}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(fj(this.system.data))}startEmitting(e){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=e}stopEmitting(){this.isEmitting=!1}},gj=class extends cI{constructor(e,t,i){super(e,t),this.type="ParticleSystem",this.geometry=new Wc,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.stopLoop=!1,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=e=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(e))},this.context=i,this.data={...t,...fj(t)},this.geometry.setAttribute("position",new Bc([],3)),this.material=new Rc({colorWrite:!1}),this.frustumCulled=!1}init(e){this.renderer=e,this.emitter=new mj(e,this),this.add(this.emitter),this.updateParticleState(this.data)}update(e){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=e,this.stopped||(this.currentLoopTime+=e);let t="one_time"===this.data.emitTimeCycle;if(("loop"===this.data.emitTimeCycle||t)&&this.currentLoopTime>1e3*this.data.emitTimeDuration&&(this.stopped||(this.stop(),t||this.start("start"===this.data.emitTimeLoopDelayStart?0:1e3*this.data.emitTimeDelay))),this.emitter&&this.started){let t=this.actualTime/1e3;this.emitter.update(t,e)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(e){return this.colliderEntities.some((t=>t.identity===e))}getColliderData(e){let t=this.colliderEntities.find((t=>t.identity===e));return t?t.data:null}updateByPatchedOp(e,t,i){super.updateByPatchedOp(e,t,i),_S(e.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...X_.drop(e,1).props}}),_S(e.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...X_.drop(e,1).props}})}updateState(e,t){super.updateState(e,t),this.updateParticleState(e)}updateParticleState(e){if(this.emitter){if(void 0!==e.colliderEntityId&&null!==e.colliderEntityId){let t=this.context.scene.find(e.colliderEntityId);this.colliderEntities=t?[t]:[]}null===e.colliderEntityId&&(this.colliderEntities=[]),this.emitter.updateState(e),e.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(e){!this.emitter||(this.emitter.updateForceFieldParameters(e),this.stop(),this.start())}start(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.currentLoopTime=0,t?setTimeout((()=>{this.stopLoop||this.start(0)}),t):(this.started=!0,this.stopped=!1,this.stopLoop=!1,this.isFrozen=!1,null===(e=this.emitter)||void 0===e||e.startEmitting(this.actualTime/1e3))}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stopped=!0,this.currentLoopTime=0,null!==(e=this.emitter)&&void 0!==e&&e.stopEmitting(),t&&(this.stopLoop=!0)}reset(){var e;this.started=!1,this.stopped=!1,null===(e=this.emitter)||void 0===e||e.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};var vj=function(){try{let e=window.location.href;if(e.includes("reducesubdiv=")){let t=e.indexOf("reducesubdiv=")+13;return parseInt(e.slice(t,t+1))}}catch{}}();function yj(e,t,i){return console.assert(void 0!==t.type),"Mesh"===t.type?function(e,t,i){var n,r;let a;return void 0!==vj&&(null!==(n=null===t||void 0===t||null===(r=t.geometry)||void 0===r?void 0:r.subdivisions)&&void 0!==n?n:0)>vj&&(console.log("reducing subdivisions",t.name,t.geometry.subdivisions),t.geometry.subdivisions=vj),"TextGeometry"===t.geometry.type?new sB(e,t,i):(a="SubdivGeometry"===t.geometry.type?new FF(e,t,i):"PathGeometry"===t.geometry.type?new KU(e,t,i):"VectorGeometry"===t.geometry.type?new QU(e,t,i):"BooleanGeometry"===t.geometry.type?new GB(e,t,i):"UIGeometry"===t.geometry.type?new ij(e,t,i):new DF(e,t,i),a)}(e,t,i):"Empty"===t.type?new QB(e,t):"Particle"===t.type?new gj(e,t,i):"ParticleCollider"===t.type?new KB(e,t,i):"Splat"===t.type?new QB(e,t):"Bone"===t.type?new tj(e,t):"Page"===t.type?new XU(e,t,i):"PointLight"===t.type?new YU(e,t,i):"SpotLight"===t.type?new $z(e,t,i):"DirectionalLight"===t.type?new Qz(e,t,i):"Component"===t.type||"Instance"===t.type?new ZU(e,t,i):RE.is(t.type)?new NB(e,t):(console.error(t),new QB(e,t))}function bj(e,t){let i=!1,n=t.getLayersOfType("transmission"),r=t.getLayersOfType("outline");return r.length>0&&(e.layers.set(8),n.length>0&&e.layers.enable(3),i=!0,OF(e),RF(e)),0===n.length&&0===r.length&&e.layers.set(0),e instanceof AF&&e.needsAO&&e.layers.enable(5),i}function xj(e,t){if(!t.layers)return!1;let i=!1,n=t.getLayersOfType("transmission").filter((e=>e.data.visible)),r=t.getLayersOfType("outline").filter((e=>e.data.visible));return n.length>0&&(e.layers.set(3),r.length>0&&e.layers.enable(8),i=!0),0===n.length&&0===r.length&&e.layers.set(0),e.needsAO&&e.layers.enable(5),i}FT.createEntity=yj,FT.changeEntityProptotype=function(e,t,i){let n=yj(e.identity,t,i),r=e.children,a=e.attachedPaths,s=e.parent,o=e.component,l=e.instances,c=e.overrideData,h=e.uuid,d=e.stateSelection;e.dispose();for(let u of Object.keys(e))delete e[u];Object.setPrototypeOf(e,Object.getPrototypeOf(n));for(let u of Object.keys(n))e[u]=n[u];e.children=[...e.children,...r],e.attachedPaths=a,e.parent=s,e.component=o,e.instances=l,e.uuid=h,e.overrideData=c,e.updateState(e.data,i),d&&e.changeSelectedState(d,i),e.resetBBoxNeedsUpdate()},FT.Cloner=bB;var wj=new Qm,_j=new ql,Sj=new Wl;function Aj(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.cloner;if(r)for(let a of r.children){let r=_j.copy(a.matrixWorld).invert(),s=Sj.copy(t.ray).applyMatrix4(r),o=e.matrixWorld;s.applyMatrix4(o);let l=wj;l.set(s.origin,s.direction),l.near=t.near,l.far=t.far;let c=l.intersectObject(e,!1);c.length>0&&i.push({...c[0],object:n?a:e})}}var Ej=class{constructor(){this._constraints=new Map}setConstraint(e,t){null===t?this._constraints.delete(e):this._constraints.set(e,t)}removeDependencies(e){this._constraints.delete(e)}applyConstraints(e){let t=new Set;this._constraints.forEach(((i,n)=>{let r=[n,i],a=i;for(;this._constraints.has(a);)a=this._constraints.get(a),t.has(a)||r.push(a);for(let s=r.length-2;s>=0;s--)if(!t.has(r[s])){let i=e.find(r[s]);i?i.applyPathSnapping(e):console.warn("missing entity ".concat(r[s])),t.add(r[s])}}))}findDependency(e,t){let i=e;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===t)return!0;return!1}},Cj=class{};function Mj(e){let t,i,n,r,a,s,o,l,c,h,d,u,p,f,m,g;function v(e,t,s){let o=new Float32Array(h,a,3*i);n=0;let l=new Uint32Array(h,r,i);for(let i=0;i<s.length-1;i++){let r=t[i],a=e[i].elements,c=r.filter((e=>e.enabled&&"Include"===e.mode)).map((e=>"Box"===e.type?b(e):w(e))),h=r.filter((e=>e.enabled&&"Exclude"===e.mode)).map((e=>"Box"===e.type?b(e):w(e)));for(let e=s[i];e<s[i+1];e++){let t=p[3*e],i=p[3*e+1],r=p[3*e+2];if((0===c.length||y(t,i,r,c))&&(0===h.length||!y(t,i,r,h))){let s=1/(a[3]*t+a[7]*i+a[11]*r+a[15]);o[3*n]=(a[0]*t+a[4]*i+a[8]*r+a[12])*s,o[3*n+1]=(a[1]*t+a[5]*i+a[9]*r+a[13])*s,o[3*n+2]=(a[2]*t+a[6]*i+a[10]*r+a[14])*s,l[n]=e,n++}}}}function y(e,t,i,n,r){return n["Intersect"===r?"every":"some"]((n=>{let r=function(e,t,i,n,r){let a=e-r[0],s=t-r[1],o=i-r[2],l=1/(n[3]*a+n[7]*s+n[11]*o+n[15]);return{x:(n[0]*a+n[4]*s+n[8]*o+n[12])*l+r[0],y:(n[1]*a+n[5]*s+n[9]*o+n[13])*l+r[1],z:(n[2]*a+n[6]*s+n[10]*o+n[14])*l+r[2]}}(e,t,i,n.invRotationMatrix,n.cropCenter);return Array.isArray(n)?function(e,t,i,n){return e>=n[0]&&e<=n[3]&&t>=n[1]&&t<=n[4]&&i>=n[2]&&i<=n[5]}(r.x,r.y,r.z,n):function(e,t,i,n){let r=(e-n.cropCenter[0])*n.invRadiusX,a=(t-n.cropCenter[1])*n.invRadiusY,s=(i-n.cropCenter[2])*n.invRadiusZ;return r*r+a*a+s*s<=1}(r.x,r.y,r.z,n)}))}function b(e){let t=e.cropSize[0]/2,i=e.cropSize[1]/2,n=e.cropSize[2]/2,r=[e.cropCenter[0]-t,e.cropCenter[1]-i,e.cropCenter[2]-n,e.cropCenter[0]+t,e.cropCenter[1]+i,e.cropCenter[2]+n],a=x(e.cropRotation);return Object.assign(r,{invRotationMatrix:a,cropCenter:e.cropCenter})}function x(e){let t=[],i=e[0]*Math.PI/180,n=e[1]*Math.PI/180,r=e[2]*Math.PI/180,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r),d=a*c,u=a*h,p=s*c,f=s*h;return t[0]=o*c,t[1]=-o*h,t[2]=l,t[4]=u+p*l,t[5]=d-f*l,t[6]=-s*o,t[8]=f-d*l,t[9]=p+u*l,t[10]=a*o,t[12]=0,t[13]=0,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,t}function w(e){let t=2/e.cropSize[0],i=2/e.cropSize[1],n=2/e.cropSize[2],r=x(e.cropRotation);return{invRadiusX:t,invRadiusY:i,invRadiusZ:n,cropCenter:e.cropCenter,invRotationMatrix:r}}e.onmessage=x=>{if(x.data.getCroppedIndexes){let t=new Uint32Array(function(e,t){let i=[],n=t.filter((e=>e.enabled&&"Include"===e.mode)).map((e=>"Box"===e.type?b(e):w(e))),r=t.filter((e=>e.enabled&&"Exclude"===e.mode)).map((e=>"Box"===e.type?b(e):w(e))),a=e.length;for(let s=0;s<a;s+=3){let t=e[s],a=e[s+1],o=e[s+2];(0===n.length||y(t,a,o,n))&&(0===r.length||!y(t,a,o,r))||i.push(s/3)}return i}(new Float32Array(x.data.positions),x.data.crops)).buffer;e.postMessage({outOfBoundsIndexes:t},[t])}else if(x.data.positions)d=x.data.positions,p=new Float32Array(d),m=x.data.meshMatrixWorlds,g=x.data.cropsArray,f=x.data.meshIndexIntervals,v(m,g,f),e.postMessage({sortSetupComplete:!0});else if(x.data.sort||x.data.newMatrixWorlds||x.data.newCropsArray)(x.data.newMatrixWorlds||x.data.newCropsArray)&&(g=x.data.newCropsArray||g,m=x.data.newMatrixWorlds||m,v(m,g,f)),function(d){let p,f=new Float64Array(h,s,16);for(let e=0;e<16;e++)f[e]=d[e];if(n>1){t.exports.sortIndexes(r,a,c,s,o,l,u.DepthMapRange,n);let e=new Uint32Array(n);p=e.buffer,e.set(new Uint32Array(h,l,n))}else if(1===n){let e=new Uint32Array(n);e[0]=new Uint32Array(h,r,i)[0],p=e.buffer}else p=new ArrayBuffer(0);e.postMessage({sortDone:!0,indexesBuffer:p},[p])}(x.data.sort.view,x.data.sort.cameraPosition);else if(x.data.init){u=x.data.init.Constants,i=x.data.init.splatCount;let n=u.BytesPerInt,d=3*u.BytesPerFloat,p=new Uint8Array(x.data.init.sorterWasmBytes),f=i*(n+d)+(i*u.BytesPerInt*2+u.DepthMapRange*u.BytesPerInt*2)+32*u.MemoryPageSize,m=Math.floor(f/u.MemoryPageSize)+1,g={module:{},env:{memory:new WebAssembly.Memory({initial:2*m,maximum:3*m,shared:!0})}};WebAssembly.compile(p).then((e=>WebAssembly.instantiate(e,g))).then((p=>{t=p,r=0,a=i*n,s=a+i*d,c=s+16*u.BytesPerFloat*2,o=c+i*u.BytesPerInt,l=o+u.DepthMapRange*u.BytesPerInt,h=g.env.memory.buffer,e.postMessage({sortSetupPhase1Complete:!0})}))}}}Nr(Cj,"DepthMapRange",65536),Nr(Cj,"MemoryPageSize",65536),Nr(Cj,"BytesPerFloat",4),Nr(Cj,"BytesPerInt",4);var Pj=function(){let e=new Float32Array(1),t=new Int32Array(e.buffer);return function(i){return e[0]=i,t[0]}}(),Tj=function(e,t,i,n){return e+(t<<8)+(i<<16)+(n<<24)},Dj=new jo;function Rj(e){let t=!1;return e.scene.objects.traverse(((e,i)=>{if(!1===i.visible)return!0;"Splat"===i.type&&(t=!0)})),t}var Oj,Ij,kj,Lj=class extends ah{constructor(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;super(i,n),this.splatCount=t,this.meshIndexIntervals=s,this.meshMatrixWorlds=o,this.splatBuffers=e,this.geometry=i,this.material=n,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=r,this.devicePixelRatio=a,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,s=Lj.buildGeomtery(t),o=Lj.buildMaterial(r);return new Lj(e,t,s,o,i,n,r,a)}static buildMaterial(e){let t={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:e},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new jo},viewport:{type:"v2",value:new jo},basisViewport:{type:"v2",value:new jo},debugColor:{type:"v3",value:new rl},covariancesTextureSize:{type:"v2",value:new jo(1024,1024)},centersColorsTextureSize:{type:"v2",value:new jo(1024,1024)},orthoZoom:{type:"f",value:-1}};return new uh({uniforms:t,vertexShader:"\n            precision highp float;\n            #include <common>\n\n            attribute uint splatIndex;\n\n            uniform highp sampler2D covariancesTexture;\n            uniform highp usampler2D centersColorsTexture;\n            uniform vec2 focal;\n            uniform vec2 viewport;\n            uniform vec2 basisViewport;\n            uniform vec2 covariancesTextureSize;\n            uniform vec2 centersColorsTextureSize;\n\t\t\t\t\t\tuniform highp sampler2D meshMatrixWorldsTexture;\n\t\t\t\t\t\tuniform uint meshIndexIntervals[257];\n\t\t\t\t\t\tuniform float orthoZoom;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\n            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\n            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));\n            const uvec4 shift4 = uvec4(0, 8, 16, 24);\n            vec4 uintToRGBAVec (uint u) {\n               uvec4 urgba = mask4 & u;\n               urgba = urgba >> shift4;\n               vec4 rgba = vec4(urgba) * encodeNorm4;\n               return rgba;\n            }\n\n            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {\n                vec2 samplerUV = vec2(0.0, 0.0);\n                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;\n                samplerUV.y = float(floor(d)) / dimensions.y;\n                samplerUV.x = fract(d);\n                return samplerUV;\n            }\n\n            void main () {\n                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));\n                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));\n                vColor = uintToRGBAVec(sampledCenterColor.r);\n\n                vPosition = position.xy * 2.0;\n\n\t\t\t\t\t\t\t\tuint meshIndex;\n\t\t\t\t\t\t\t\tfor (int i = 1; i < 257; i++) {\n\t\t\t\t\t\t\t\t\tif (splatIndex < meshIndexIntervals[i]) {\n\t\t\t\t\t\t\t\t\t\tmeshIndex = uint(i - 1);\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfloat strideMulmeshIndex = float(4u*meshIndex);\n\t\t\t\t\t\t\t\tfloat meshMatrixWorldsTextureLength = float(256*4);\n\n\t\t\t\t\t\t\t\tmat4 modelMat = mat4(\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),\n\t\t\t\t\t\t\t\t\ttexture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tmat4 modelViewMat = viewMatrix * modelMat;\n\t\t\t\t\t\t\t\tvec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); \n                vec4 clipCenter = projectionMatrix * viewCenter;\n\n                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;\n                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;\n\n                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);\n                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);\n\n                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix\n                mat3 Vrk = mat3(\n                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,\n                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,\n                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z\n                );\n                float s = 1.0 / (viewCenter.z * viewCenter.z);\n\n                mat3 W = transpose(mat3(modelViewMat));\n                mat3 T = orthoZoom > 0.0 ? W : W * mat3(\n\t\t\t\t\t\t\t\t\tfocal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,\n\t\t\t\t\t\t\t\t\t0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,\n\t\t\t\t\t\t\t\t\t0., 0., 0.\n\t\t\t\t\t\t\t\t);\n                mat3 cov2Dm = transpose(T) * Vrk * T;\n                cov2Dm[0][0] += 0.3;\n                cov2Dm[1][1] += 0.3;\n\n                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because\n                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],\n                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't\n                // need cov2Dm[1][0] because it is a symetric matrix.\n                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);\n\n                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;\n\n                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix\n                // so that we can determine the 2D basis for the splat. This is done using the method described\n                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html\n                //\n                // This is a different approach than in the original work at INRIA. In that work they compute the\n                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle\n                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance\n                // matrix (called 'conic') to determine fragment opacity.\n                float a = cov2Dv.x;\n                float d = cov2Dv.z;\n                float b = cov2Dv.y;\n                float D = a * d - b * b;\n                float trace = a + d;\n                float traceOver2 = 0.5 * trace;\n                float term2 = sqrt(trace * trace / 4.0 - D);\n                float eigenValue1 = traceOver2 + term2;\n\t\t\t\t\t\t\t\tfloat eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value\n\n                const float maxSplatSize = 1024.0;\n                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));\n                // since the eigen vectors are orthogonal, we derive the second one from the first\n                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);\n                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);\n                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);\n\n                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;\n\n\t\t\t\t\t\t\t\tif (orthoZoom > 0.0) {\n\t\t\t\t\t\t\t\t\tndcOffset *= orthoZoom;\n\t\t\t\t\t\t\t\t}\n\n                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);\n            }",fragmentShader:"\n            precision highp float;\n            #include <common>\n\n            uniform vec3 debugColor;\n\n            varying vec4 vColor;\n            varying vec2 vUv;\n\n            varying vec2 vPosition;\n\t\t\t\t\t\tlayout(location = 1) out vec4 gVelocity; \n\n            void main () {\n                // compute the negative squared distance from the center of the splat to the\n                // current fragment in the splat's local space.\n                float A = -dot(vPosition, vPosition);\n                if (A < -4.0) discard;\n                vec3 color = vColor.rgb;\n                A = exp(A) * vColor.a;\n                gl_FragColor = vec4(color.rgb, A);\n\t\t\t\t\t\t\t\tgVelocity = vec4(0.0); // so it is ignored by TAA\n            }",transparent:!0,alphaTest:1,blending:ca,depthTest:!0,depthWrite:!1,side:oa})}static buildGeomtery(e){let t=new Wc;t.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),n=new kc(i,3);t.setAttribute("position",n),n.setXYZ(0,-1,-1,0),n.setXYZ(1,-1,1,0),n.setXYZ(2,1,1,0),n.setXYZ(3,1,-1,0),n.needsUpdate=!0;let r=(new Tm).copy(t),a=new Uint32Array(e),s=new gp(a,1,!1);return s.setUsage(35048),r.setAttribute("splatIndex",s),r.instanceCount=e,r}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach((e=>e.buildPreComputedBuffers())),this.covariances=new Float32Array(6*this.splatCount),this.colors=new Uint8Array(4*this.splatCount),this.centers=new Float32Array(3*this.splatCount);let e=0,t=0,i=0;for(let n of this.splatBuffers){let r=n.nsplats;this.colors.subarray(e,e+4*r).set(n.colorsA),e+=4*r,this.centers.subarray(t,t+3*r).set(n.decoded.xyz.denormDequant().data),t+=3*r,this.covariances.subarray(i,i+6*r).set(new Float32Array(n.precomputedCovarianceBufferData)),i+=6*r}}allocateAndStoreLocalSplatDataInTextures(){let e=this.splatCount,t=new jo(4096,1024);for(;t.x*t.y*2<6*e;)t.y*=2;let i,n,r=new jo(4096,1024);for(;r.x*r.y*4<4*e;)r.y*=2;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(t.x*t.y*2);for(let e=0;e<this.covariances.length;e++)n[e]=yg.toHalfFloat(this.covariances[e]);i=new up(n,t.x,t.y,Cs,fs)}else n=new Float32Array(t.x*t.y*2),n.set(this.covariances),i=new up(n,t.x,t.y,Cs,ps);i.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=i,this.material.uniforms.covariancesTextureSize.value.copy(t);let a=new Uint32Array(r.x*r.y*4);for(let c=0;c<e;c++){let e=4*c,t=3*c,i=4*c;a[i]=Tj(this.colors[e],this.colors[e+1],this.colors[e+2],this.colors[e+3]),a[i+1]=Pj(this.centers[t]),a[i+2]=Pj(this.centers[t+1]),a[i+3]=Pj(this.centers[t+2])}let s=new up(a,r.x,r.y,Ps,us);s.internalFormat="RGBA32UI",s.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=s,this.material.uniforms.centersColorsTextureSize.value.copy(r);let o=new Float32Array(4096);for(let c=0;c<this.meshMatrixWorlds.length;c++)o.set(this.meshMatrixWorlds[c].elements,16*c);let l=new up(o,1024,1,bs,ps);l.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=l,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:i,size:t},centerColors:{data:a,texture:s,size:r},meshMatrixWorlds:{data:o,texture:l}}}updateIndexes(e){let t=this.geometry;t.attributes.splatIndex.set(e),t.attributes.splatIndex.needsUpdate=!0,t.instanceCount=e.length}updateUniforms(e,t,i,n){this.splatCount>0&&(Dj.set(e.x*this.devicePixelRatio,e.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(Dj),this.material.uniforms.basisViewport.value.set(2/Dj.x,2/Dj.y),this.material.uniforms.focal.value.set(t,i),this.material.uniforms.orthoZoom.value=n,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},Fj=new Promise((e=>{Oj=e})),Bj=!1;function Nj(){if(!Bj)return Ij||(Ij=async function(){let e=await __webpack_require__.e(23).then(__webpack_require__.bind(__webpack_require__,5023));Oj(e),Bj=!0}(),Ij)}Fj.then((e=>kj=e));var zj=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Nr(this,"updateView",function(){let e=new ql,t=[],i=new gl(0,0,-1),n=new gl(0,0,-1),r=new gl,a=new gl;return function(){let s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0,l=this.updateMatrixWorldsInWorkerIfNeeded(),c=this.cropsChanged();if(!s){n.set(0,0,-1).applyQuaternion(o.quaternion);let e=!1,t=!1;if(n.dot(i)<=.95&&(e=!0),a.copy(o.position).sub(r).length()>=1&&(t=!0),!e&&!t&&!l&&!c&&!this.needsInitialRender)return}this.needsInitialRender=!1,r.copy(o.position),i.copy(n),e.copy(o.matrixWorld).invert(),e.premultiply(this.dummyPerspectiveMatrix),t[0]=o.position.x,t[1]=o.position.y,t[2]=o.position.z;let h={sort:{view:e.elements,cameraPosition:t,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...l?{newMatrixWorlds:this.meshMatrixWorlds}:{},...c?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}}()),this.scene=e.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=(new ql).makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(e,t){let i=new jo;null!==this.splatMesh&&this.splatMesh.getSplatCount()>0&&(e.getSize(i),this.cameraFocalLengthX=t.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=t.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,t.isPerspectiveCamera?-1:t.zoom*this.devicePixelRatio))}loadSplat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.activePage=this.scene.activePage,e.position&&(e.position=(new gl).fromArray(e.position)),e.orientation&&(e.orientation=(new ml).fromArray(e.orientation)),e.halfPrecisionCovariances=!!e.halfPrecisionCovariances;let t=[];if(this.splatEntries=t,this.activePage.traverseVisibleEntity((e=>{"Splat"===e.data.type&&t.push(e)})),this.splatMesh&&this.splatMesh.dispose(),0===t.length)return this.splatMesh=null,!1;this.meshMatrixWorlds=t.map((e=>e.matrixWorld)),this.meshMatrixWorldsOld=t.map((e=>e.matrixWorld.clone())),this.cropsArray=t.map((e=>e.data.crops.map((e=>e.data))));let i=t.map((e=>new kj.GSplineBuffer(new Uint8Array(e.data.buffer).buffer))),n=0,r=[0];for(let a of i)n+=a.getSplatCount(),r.push(n);return this.setupSplatMesh(i,n,e.position,e.orientation,e.halfPrecisionCovariances,this.devicePixelRatio,r,this.meshMatrixWorlds),this.setupSortWorker(n),!0}updateMatrixWorldsInWorkerIfNeeded(){let e=this.splatDataTextures.meshMatrixWorlds.data;for(let t=0;t<this.meshMatrixWorlds.length;t++)e.set(this.meshMatrixWorlds[t].elements,16*t);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,!this.meshMatrixWorlds.every(((e,t)=>e.equals(this.meshMatrixWorldsOld[t])))&&(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map((e=>e.clone())),!0)}cropsChanged(){let e=!1;return this.splatEntries.forEach(((t,i)=>{var n;t.data.crops.forEach(((t,n)=>{void 0===this.cropsArray[i][n]?(e=!0,this.cropsArray[i][n]=t.data):Object.entries(t.data).forEach((t=>{var r;let[a,s]=t;(Array.isArray(s)&&s.some(((e,t)=>e!==this.cropsArray[i][n][a][t]))||s!==(null===(r=this.cropsArray[i][n])||void 0===r?void 0:r[a]))&&(e=!0,this.cropsArray[i][n][a]=s)}))})),t.data.crops.length!==(null===(n=this.cropsArray[i])||void 0===n?void 0:n.length)&&(this.cropsArray[i].length=t.data.crops.length,e=!0)})),e}setupSplatMesh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new gl,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ml,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6?arguments[6]:void 0,o=arguments.length>7?arguments[7]:void 0;this.splatMesh=Lj.buildMesh(e,t,r,a,s,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(n),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=t,this.splatMesh.onBeforeRender=(e,t,i)=>this.update(e,i)}setupSortWorker(e){this.sortWorker=function(e){let t=new Worker(URL.createObjectURL(new Blob(["(",Mj.toString(),")(self)"],{type:"application/javascript"}))),i=atob("AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL"),n=new Uint8Array(i.length);for(let r=0;r<i.length;r++)n[r]=i.charCodeAt(r);return t.postMessage({init:{sorterWasmBytes:n.buffer,splatCount:e,Constants:{BytesPerFloat:Cj.BytesPerFloat,BytesPerInt:Cj.BytesPerInt,DepthMapRange:Cj.DepthMapRange,MemoryPageSize:Cj.MemoryPageSize}}}),t}(e),this.sortWorker.onmessage=e=>{var t;e.data.sortDone?(this.sortRunning=!1,null!==(t=this.splatMesh)&&void 0!==t&&t.updateIndexes(new Uint32Array(e.data.indexesBuffer)),this.lastSortTime=e.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):e.data.sortCanceled?this.sortRunning=!1:e.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):e.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(e,t){null!==this.splatMesh&&(this.updateSplatMeshUniforms(e,t),this.updateView(!1,t))}getSplatMesh(){return this.splatMesh}},Uj=new Rc;Uj.wireframe=!0;var jj=new gl,Vj=class extends op{constructor(e,t){super(),this.data=e,this.sharedAssets=t,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new Ej,this.invisibleObjects=new QB("jflkdsafjasdifjaslk",{...MC.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(e,t),this.matrixAutoUpdate=!1,this.errorPage=new XU("fdasfa",{...FC.defaultData,name:""},{shared:t,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof AF)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)xj(e,e.material[i])&&(t=!0);else xj(e,e.material)&&(t=!0)})),t}(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=function(e){let t=!1;return e.traverseEntity((e=>{if(e instanceof AF)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)bj(e,e.material[i])&&(t=!0);else bj(e,e.material)&&(t=!0)})),t}(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(e){let t=e.identity.join("-"),i=this.entityIdentityToEntity[t];i&&(e.uuid=i.uuid),this.entityIdentityToEntity[t]=e,this.entityByUuid[e.uuid]=e}markPenumbraSizeDirty(){for(let e of this.children)e instanceof XU&&(e.penumbraSizeArrayCache=null)}findInstance(e){return this.entityIdentityToEntity[e.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(e){let t=this.find(e);if(void 0===t)return;let i=[],n=t;for(;n!==this;){let e=n;n=n.parent;let t=n.children.indexOf(e);i.splice(0,0,t)}return{entity:t,sortKey:i}}getAllSorted(e){let t=[];for(let i of e){let e=this.getWithSortKey(i.id);void 0!==e&&t.push(e)}return t.sort(((e,t)=>u_(e.sortKey,t.sortKey))),t.map((e=>e.entity))}nonExistOrDescendantOf(e,t){let i=this.find(e);if(void 0===i)return!0;for(;i;){if(i.uuid===t)return!0;i=i.parent}return!1}find(e){if(this.activePage&&this.activePage.personalCamera.parent){if("f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera"===e)return this.activePage.personalCamera;if(e===LE)return this.activePage.personalCamera}if(""===e||void 0===e)return;let t=this.entityByUuid[e];return void 0===t?this.getObjectByProperty("uuid",e):t}find2D(e){for(let t of this.children)if(t instanceof XU&&t.uiScene){let i=t.uiScene.find(e);if(i)return i}}findScene2DfromObject2D(e){for(let t of this.children)if(t instanceof XU&&t.uiScene&&t.uiScene.find(e))return t.uiScene}find2DInUIObjects(e){let t;return this.traverseEntity((i=>{void 0===t&&i instanceof ij&&(t=i.uiCanvas.find(e))})),t}traverse2D(e){for(let t of this.children)t instanceof XU&&t.uiScene&&t.uiScene.traverse(e)}debugEnsureEntity(e){let t=this.find(e);t?Array.isArray(t.identity)&&void 0===this.findInstance(t.identity)&&console.error("not found instance"):console.error("not found")}addPendingExpandCloner(e){this.toExpandCloner.add(e)}addPendingUpdateCloner(e){this.toUpdateCloner.add(e)}markToExpandCloner(e){this.toExpandCloner.add(e),e.traverseEntityAncestors((e=>{this.toExpandCloner.add(e)}))}doPendingExpandCloner(){this.toExpandCloner.forEach((e=>{e.expandCloner(this)})),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach((e=>{var t;null===(t=e.cloner)||void 0===t||t.update()})),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(e){this.pendingCommands.push(e)}applyPendingCommands(){this.pendingCommands.forEach((e=>e())),this.pendingCommands.length=0}updateByLibOp(e,t){1===e.path.length&&"components"===e.path[0]&&1===e.type&&this.createChildrenObjects([{...e.data.asset,id:e.id}],this.invisibleObjects,t)}updateTreeByOp(e,t){if(0===e.path.length&&7===e.type){let i=null===e.parent?this:this.find(e.parent);if(void 0===i)throw new Error("unexpected");let n=this.createObject(e.id,e.data,e.children,i,e.localIndex,t);n.updateVisible(this),n.resetBBoxNeedsUpdate(),WB(n)&&qB(n.parent)&&(n.invalidateUpstreamBooleanData(),n.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(n),this.markToExpandCloner(n),this.markPenumbraSizeDirty(),n.updatePathSnapping()}else if(0===e.path.length&&8===e.type){let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");this.markToExpandCloner(t),t.resetBBoxNeedsUpdate(),this.unregisterObject(t);let i=t.parent;this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(t),this.markPenumbraSizeDirty(),t.parent.remove(t),qB(t.parent)&&(t.parent.invalidateUpstreamBooleanData(),t.parent.invalidateDownstreamBooleanData().recomputeBoolean()),WB(t)&&(t.freeBooleanPointer(),i instanceof GB&&i.invalidateDownstreamBooleanData().recomputeBoolean()),t instanceof KU&&t.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(t),this.pathConstraints.removeDependencies(t.uuid),t.updatePathSnapping()}else if(0===e.path.length&&9===e.type){var i;let t=this.find(e.id);if(void 0===t)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(t);let n=t.parent;this.markNeedsRecomputeInstancesForAncessors(n),null!==(i=t.cloner)&&void 0!==i&&i.resetOnMove(),this.markToExpandCloner(t);let r=null===e.parent?this:this.find(e.parent);if(void 0===r)throw new Error("unexpected");r.add(t),this.markNeedsRecomputeInstancesForAncessors(r),this.markToExpandCloner(t),t.invalidateClonerTransform(t),t.updateVisible(this),t.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let a=e.localIndex;r.children.splice(a,0,r.children.pop()),WB(t)&&(t.invalidateUpstreamBooleanData(),qB(t.parent)?t.parent.invalidateDownstreamBooleanData().recomputeBoolean():n instanceof GB&&n.invalidateDownstreamBooleanData().recomputeBoolean()),t.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){var e;return null!==(e=this.find(this.data.publish.playPage))&&void 0!==e?e:this.errorPage}updatePage(e){var t;this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let i of this.children)i instanceof XU&&(i.visible=i.uuid===e,i.visible&&(this.activePage=i,this.activePage.onActive(this)));this.activePage!==(null===(t=this.splatViewer)||void 0===t?void 0:t.activePage)&&this.reloadSplats()}updateEntityByOp(e,t,i,n){if(0===t.type){if(("overrides"in t.props||"component"in t.props)&&this.markNeedsRecomputeInstances(),"visible"in t.props&&this.markPenumbraSizeDirty(),t.path.includes("overrides")&&"states"in t.props){let{rest:e}=t.props;t={...t,props:e},this.markNeedsRecomputeInstances()}"pathSnapping"===t.path[0]&&void 0!==t.props.pathId&&this.pathConstraints.setConstraint(e,t.props.pathId)}let r=this.find(e);if(r)try{(function(e,t,i,n){e.updateByOp(t,i,n,!1)})(r,t,i,{scene:this,shared:n}),r instanceof DF&&r.updateGeometryGroupsIfNeeded()}catch(vE){console.error(vE)}}updateEntity2DByOp(e,t,i,n,r){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];e.updateEntityByOp(t,i,n,r),this.traverseEntity((e=>{var s;(e instanceof ij||e instanceof XU)&&(a.includes(null!==(s=e.frameId)&&void 0!==s?s:"")||e.frameId===t)&&e.updateEntity2DByOp(t,i,n,r)}))}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(e){this.activePage.switchActiveCamera(e)}isInvisibleObjects(e){return e===this.invisibleObjects||e.hasAnccestor(this.invisibleObjects)}init(e,t){let i=Object.entries(t.data.lib.components).map(((e,t)=>({data:e[1].asset.data,children:e[1].asset.children,id:e[0],fi:t})));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:t}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,t),this.createChildrenObjects(e.objects,this,t),this.updatePage(e.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(t,!0),this.traverseEntity((e=>{e instanceof NB&&e.updateUp()})),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(e){e.traverseEntity((e=>{("Component"===e.data.type||"Instance"===e.data.type)&&this.markNeedsRecomputeInstances()}))}markNeedsRecomputeInstancesForAncessors(e){AT.is(e)&&("Component"===e.data.type&&this.markNeedsRecomputeInstances(),e.traverseAncestors((e=>{AT.is(e)&&"Component"===e.data.type&&this.markNeedsRecomputeInstances()})))}relativeizeInner(e,t,i,n,r,a,s){if(e){let o=n.find(e);o&&o!==n&&r.forInstancesRec((n=>{n.data=xS(n.data,(r=>{let o=r.events.data(s.id),l=n.goUp(a);if(l){let n=[...d_(l.identity),e].join("-"),r=this.entityIdentityToEntity[n];if(r){let e=r.uuid;gS.zoom(o,t)[i]=e}else console.warn("cannot find instance")}})).data}))}}rewriteActions(e,t,i,n,r,a){e.forEach((e=>{"Transition"===e.data.type||"Animation"===e.data.type?this.relativeizeInner(e.data.object,[...t,e.id],"object",i,n,r,a):"Conditional"===e.data.type&&(this.rewriteActions(e.data.ifActions,[...t,e.id,"ifActions"],i,n,r,a),this.rewriteActions(e.data.elseActions,[...t,e.id,"elseActions"],i,n,r,a))}))}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity((e=>{if(e instanceof ZU&&"string"==typeof e.identity&&"Component"===e.data.type)return e.traverseEntity(((t,i)=>{t.data.events.forEach((n=>{if("GameControl"===n.data.type){let r=!1;if(t.forInstancesRec((e=>{e.data=xS(e.data,(t=>{e.isInstanceRoot||(t.events.delete(n.id),r=!0)})).data})),!1===r)for(let a of $C.list)this.rewriteActions(n.data.gameActions[a],["gameActions",a],e,t,i,n)}else"Conditional"===n.data.type?("Distance"===n.data.condition.type?(this.relativeizeInner(n.data.condition.fromObject,["condition"],"fromObject",e,t,i,n),this.relativeizeInner(n.data.condition.toObject,["condition"],"toObject",e,t,i,n)):"State"===n.data.condition.type?this.relativeizeInner(n.data.condition.object,["condition"],"object",e,t,i,n):"Comparison"===n.data.condition.type&&("Property"===n.data.condition.lOperand.type&&this.relativeizeInner(n.data.condition.lOperand.value[0],["condition","lOperand","value"],0,e,t,i,n),"Property"===n.data.condition.rOperand.type&&this.relativeizeInner(n.data.condition.rOperand.value[0],["condition","rOperand","value"],0,e,t,i,n)),this.rewriteActions(n.data.inActions,["inActions"],e,t,i,n),this.rewriteActions(n.data.outActions,["outActions"],e,t,i,n)):"actions"in n.data&&this.rewriteActions(n.data.actions,["actions"],e,t,i,n)}))})),!0}))}expandInstances(e,t,i){let n=new Set;this.traverseEntity((r=>{if(r instanceof ZU&&r.isInstanceRoot)return r.expandInstanceChildren({scene:this,shared:e,pendingDeletes:n}),t||r.resetBBoxNeedsUpdate(),i&&r.traverseEntity((e=>{i.addClip(e)})),!0}));for(let r of n)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(r),JU(r)}recomputeInstances(e,t){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity((e=>{e instanceof ZU&&e.isInstanceRoot&&(e.component=void 0)})),this.expandInstances(e,!1,t))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(e){e.traverseEntity((e=>{let t="string"==typeof e.identity?e.identity:e.identity.join("-");this.entityIdentityToEntity[t]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[t]),e.dispose()}))}clearScene(){for(let e of this.children)AT.is(e)&&e.disposeRecursively();this.children.length=0}resetAfterClear(e,t){this.init(e,t)}raycast(e){return this.raycast1(e,!1)}raycast1(e,t){let i=[],n=r=>{for(let a of r.children){let r=a.cloner;if(AT.is(a)&&!a.raycastLock&&(a.visible||null!==r&&void 0!==r&&r.object.data.visible))if(!0===t&&a.isInstanceRoot){let t=[];if(e.intersectObject(a,!0,t),t.length){let e=t[0];e.object=a,e.point.applyMatrix4(e.object.matrixWorld);let n=a.matrixWorld.clone().invert();e.point.applyMatrix4(n),i.push(e)}}else(WB(a)||XB(a)&&this.enableHelpers&&a.objectHelper.visible)&&(e.intersectObject(a,!1,i),Aj(a,e,i)),n(a)}};return n(this.activePage),i}raycastWithClones(e){let t=[],i=n=>{for(let r of n.children){let n=r.cloner;AT.is(r)&&(r.visible||(null===n||void 0===n?void 0:n.object.data.visible))&&((WB(r)||XB(r)&&this.enableHelpers&&r.objectHelper.visible)&&(e.intersectObject(r,!1,t),Aj(r,e,t,!0)),i(r))}};return i(this),t}forEachEntity(e){for(let t of this.children)AT.is(t)&&e(t)}traverseConcreteEntity(e){for(let t of this.children)AT.is(t)&&t.isConcreteEntity&&t.traverseEntity(e)}traverseEntity(e){for(let t of this.children)AT.is(t)&&t.traverseEntity(e)}updateFont(e,t){this.traverseEntity((i=>{if(i instanceof DF&&"Mesh"===i.data.type&&"TextGeometry"===i.data.geometry.type&&i.data.geometry.font===e){let n=i.geometry,r=i.data.geometry;n.updateFont(e,t).then((()=>{n.update(r);let e=i.invalidateDownstreamBooleanData();qB(e)&&e.recomputeBoolean()}))}}))}traverseObject(e){for(let t of this.children)vT.is(t)&&t.traverseObject(e)}traverseVisibleEntity(e){for(let t of this.children)AT.is(t)&&t.visible&&t.traverseVisibleEntity(e)}dispose(){this.clearScene()}createChildrenObjects(e,t,i){let n=0;for(let r of e)this.createObject(r.id,r.data,r.children,t,n,i),n+=1}registerObjectCreatedInLegacy(e){this.entityByUuid[e.uuid]=e}unregisterObject(e){delete this.entityByUuid[e.uuid];for(let t of e.children)this.unregisterObject(t)}createObject(e,t,i,n,r,a){var s;let o={scene:this,shared:a},l=yj(e,t,o);return l&&(this.entityByUuid[e]=l,n.add(l),n.children.splice(r,0,n.children.pop()),i.length>0&&(l.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,l,a)),l.updateState(t,o),l instanceof DF&&l.updateGeometryGroupsIfNeeded(),l.updateVisible(this),l.cloner&&this.toExpandCloner.add(l),null!==(s=t.pathSnapping)&&void 0!==s&&s.pathId&&this.pathConstraints.setConstraint(e,t.pathSnapping.pathId)),"Empty"===t.type&&t.animations&&l.traverseEntity((e=>{let t=e.dataPatched;if(e instanceof DF&&t.bones&&t.boneInverses){let i=t.bones.map((e=>this.find(e))),n=t.boneInverses.map((e=>(new ql).fromArray(e))),r=new mp(i,n);e.bind(r,e.bindMatrix)}else e.matrixAutoUpdate=!0})),l}getCenter(e){let t=[];for(let n=0,r=e.length;n<r;++n){let{id:i,recursive:r}=e[n],a=this.find(i),s=r?a.recursiveBBox:a.singleBBox;t.push(...s.vertices)}let i=new bl;return i.setFromPoints(t),i.getCenter(jj),jj}copyMatrixWorld(e,t){if(null===e)return void t.identity();let i=this.find(e);i?t.copy(i.matrixWorld):t.identity()}copyParentMatrixWorld(e,t){var i;if(null===e)return void t.identity();let n=null===(i=this.find(e))||void 0===i?void 0:i.parent;n?t.copy(n.matrixWorld):t.identity()}traverseMaterial(e){this.traverseEntity((t=>{if(t instanceof cI)if(Array.isArray(t.material))for(let i=0;i<t.material.length;i++)t.material[i]instanceof YL&&e(t.material[i]);else t.material instanceof YL&&e(t.material)}))}updateViewPlaneSize(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.traverseConcreteEntity((n=>{n instanceof NB&&n.setViewplaneSize(e,t,i)}))}initializeSplatViewer(){this.splatViewer=new zj({scene:this}),this.reloadSplats()}reloadSplats(){var e;null===(e=this.splatViewer)||void 0===e||e.loadSplat()}},Gj=(e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)},Hj=e=>e*(Math.PI/180),Wj=e=>e*(180/Math.PI),qj=new Map,Xj=e=>{qj.has(e)&&clearTimeout(qj.get(e)),qj.set(e,setTimeout(e,100))},Yj=(e,t,i)=>{let n,r=t.split(/[ ,]+/g);for(let a=0;a<r.length;a+=1)n=r[a],e.addEventListener?e.addEventListener(n,i,!1):e.attachEvent&&e.attachEvent(n,i)},Qj=(e,t,i)=>{let n,r=t.split(/[ ,]+/g);for(let a=0;a<r.length;a+=1)n=r[a],e.removeEventListener?e.removeEventListener(n,i):e.detachEvent&&e.detachEvent(n,i)},Kj=e=>(e.preventDefault(),e.type.match(/^touch/)?e.changedTouches:e),Zj=()=>{if(typeof window>"u")return;return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},Jj=(e,t)=>{t.top||t.right||t.bottom||t.left?(e.style.top=t.top,e.style.right=t.right,e.style.bottom=t.bottom,e.style.left=t.left):(e.style.left=t.x+"px",e.style.top=t.y+"px")},$j=(e,t,i)=>{let n=eV(e);for(let r in n)if(n.hasOwnProperty(r))if("string"==typeof t)n[r]=t+" "+i;else{let e="";for(let n=0,r=t.length;n<r;n+=1)e+=t[n]+" "+i+", ";n[r]=e.slice(0,-2)}return n},eV=e=>{let t={};return t[e]="",["webkit","Moz","o"].forEach((function(i){t[i+e.charAt(0).toUpperCase()+e.slice(1)]=""})),t},tV=(e,t)=>{for(let i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},iV=(e,t)=>{if(e.length)for(let i=0,n=e.length;i<n;i+=1)t(e[i]);else t(e)};typeof window<"u"&&(nV="ontouchstart"in window,rV=!!window.PointerEvent,aV=!!window.MSPointerEvent);var nV,rV,aV,sV,oV={start:"mousedown",move:"mousemove",end:"mouseup"},lV={};function cV(){}rV?sV={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:aV?sV={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:nV?(sV={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},lV=oV):sV=oV,cV.prototype.on=function(e,t){var i,n=this,r=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var a=0;a<r.length;a+=1)i=r[a],n._handlers_[i]=n._handlers_[i]||[],n._handlers_[i].push(t);return n},cV.prototype.off=function(e,t){var i=this;return i._handlers_=i._handlers_||{},void 0===e?i._handlers_={}:void 0===t?i._handlers_[e]=null:i._handlers_[e]&&i._handlers_[e].indexOf(t)>=0&&i._handlers_[e].splice(i._handlers_[e].indexOf(t),1),i},cV.prototype.trigger=function(e,t){var i,n=this,r=e.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var a=0;a<r.length;a+=1)i=r[a],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach((function(e){e.call(n,{type:i,target:n},t)}))},cV.prototype.config=function(e){var t=this;t.options=t.defaults||{},e&&(t.options=((e,t)=>{let i={};for(let n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)?i[n]=t[n]:e.hasOwnProperty(n)&&(i[n]=e[n]);return i})(t.options,e))},cV.prototype.bindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[t]=function(){"function"==typeof i["on"+t]?i["on"+t].apply(i,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},Yj(e,sV[t],i._domHandlers_[t]),lV[t]&&Yj(e,lV[t],i._domHandlers_[t]),i},cV.prototype.unbindEvt=function(e,t){var i=this;return i._domHandlers_=i._domHandlers_||{},Qj(e,sV[t],i._domHandlers_[t]),lV[t]&&Qj(e,lV[t],i._domHandlers_[t]),delete i._domHandlers_[t],this};var hV=cV;function dV(e,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=e,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=dV.id,dV.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}dV.prototype=new hV,dV.constructor=dV,dV.id=0,dV.prototype.buildEl=function(e){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},dV.prototype.stylize=function(){if(this.options.dataOnly)return this;var e=this.options.fadeTime+"ms",t=((e,t)=>{let i=eV(e);for(let n in i)i.hasOwnProperty(n)&&(i[n]=t);return i})("borderRadius","50%"),i=$j("transition","opacity",e),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},tV(n.el,i),"circle"===this.options.shape&&tV(n.back,t),tV(n.front,t),this.applyStyles(n),this},dV.prototype.applyStyles=function(e){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var i in e[t])this.ui[t].style[i]=e[t][i];return this},dV.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},dV.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},dV.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},dV.prototype.show=function(e){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof e&&e.call(this)}),t.options.fadeTime)),t},dV.prototype.hide=function(e){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var i="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=i,"function"==typeof e&&e.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){let i=t.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:t.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:t.instance.frontPosition.y,t.setPosition(e,n)}return t},dV.prototype.setPosition=function(e,t){var i=this;i.frontPosition={x:t.x,y:t.y};var n=i.options.fadeTime+"ms",r={};r.front=$j("transition",["top","left"],n);var a={front:{}};a.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(r),i.applyStyles(a),i.restTimeout=setTimeout((function(){"function"==typeof e&&e.call(i),i.restCallback()}),i.options.fadeTime)},dV.prototype.restCallback=function(){var e=this,t={};t.front=$j("transition","none",""),e.applyStyles(t),e.trigger("rested",e.instance)},dV.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},dV.prototype.computeDirection=function(e){var t,i,n,r=e.angle.radian,a=Math.PI/4,s=Math.PI/2;if(r>a&&r<3*a&&!e.lockX?t="up":r>-a&&r<=a&&!e.lockY?t="left":r>3*-a&&r<=-a&&!e.lockX?t="down":e.lockY||(t="right"),e.lockY||(i=r>-s&&r<s?"left":"right"),e.lockX||(n=r>0?"up":"down"),e.force>this.options.threshold){var o,l={};for(o in this.direction)this.direction.hasOwnProperty(o)&&(l[o]=this.direction[o]);var c={};for(o in this.direction={x:i,y:n,angle:t},e.direction=this.direction,l)l[o]===this.direction[o]&&(c[o]=!0);if(c.x&&c.y&&c.angle)return e;(!c.x||!c.y)&&this.trigger("plain",e),c.x||this.trigger("plain:"+i,e),c.y||this.trigger("plain:"+n,e),c.angle||this.trigger("dir dir:"+t,e)}else this.resetDirection();return e};var uV=dV;function pV(e,t){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=e,i.id=pV.id,pV.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(t),("static"===i.options.mode||"semi"===i.options.mode)&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let n=getComputedStyle(i.options.zone.parentElement);return n&&"flex"===n.display&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}pV.prototype=new hV,pV.constructor=pV,pV.id=0,pV.prototype.prepareNipples=function(){var e=this,t=e.nipples;t.on=e.on.bind(e),t.off=e.off.bind(e),t.options=e.options,t.destroy=e.destroy.bind(e),t.ids=e.ids,t.id=e.id,t.processOnMove=e.processOnMove.bind(e),t.processOnEnd=e.processOnEnd.bind(e),t.get=function(e){if(void 0===e)return t[0];for(var i=0,n=t.length;i<n;i+=1)if(t[i].identifier===e)return t[i];return!1}},pV.prototype.bindings=function(){var e=this;e.bindEvt(e.options.zone,"start"),e.options.zone.style.touchAction="none",e.options.zone.style.msTouchAction="none"},pV.prototype.begin=function(){var e=this,t=e.options;if("static"===t.mode){var i=e.createNipple(t.position,e.manager.getIdentifier());i.add(),e.idles.push(i)}},pV.prototype.createNipple=function(e,t){var i=this,n=i.manager.scroll,r={},a=i.options,s=i.parentIsFlex?n.x:n.x+i.box.left,o=i.parentIsFlex?n.y:n.y+i.box.top;if(e.x&&e.y)r={x:e.x-s,y:e.y-o};else if(e.top||e.right||e.bottom||e.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=e.top,l.style.right=e.right,l.style.bottom=e.bottom,l.style.left=e.left,l.style.position="absolute",a.zone.appendChild(l);var c=l.getBoundingClientRect();a.zone.removeChild(l),r=e,e={x:c.left+n.x,y:c.top+n.y}}var h=new uV(i,{color:a.color,size:a.size,threshold:a.threshold,fadeTime:a.fadeTime,dataOnly:a.dataOnly,restJoystick:a.restJoystick,restOpacity:a.restOpacity,mode:a.mode,identifier:t,position:e,zone:a.zone,frontPosition:{x:0,y:0},shape:a.shape});return a.dataOnly||(Jj(h.ui.el,r),Jj(h.ui.front,h.frontPosition)),i.nipples.push(h),i.trigger("added "+h.identifier+":added",h),i.manager.trigger("added "+h.identifier+":added",h),i.bindNipple(h),h},pV.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},pV.prototype.bindNipple=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},pV.prototype.pressureFn=function(e,t,i){var n=this,r=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval(function(){var i=e.force||e.pressure||e.webkitForce||0;i!==r&&(t.trigger("pressure",i),n.trigger("pressure "+t.identifier+":pressure",i),r=i)}.bind(n),100)},pV.prototype.onstart=function(e){var t=this,i=t.options,n=e;e=Kj(e),t.updateBox();return iV(e,(function(r){t.actives.length<i.maxNumberOfNipples?t.processOnStart(r):n.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(i){if(Object.values(n.touches).findIndex((function(e){return e.identifier===i}))<0){var r=[e[0]];r.identifier=i,t.processOnEnd(r)}})),t.actives.length<i.maxNumberOfNipples&&t.processOnStart(r))})),t.manager.bindDocument(),!1},pV.prototype.processOnStart=function(e){var t,i=this,n=i.options,r=i.manager.getIdentifier(e),a=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},o=i.getOrCreate(r,s);o.identifier!==r&&i.manager.removeIdentifier(o.identifier),o.identifier=r;var l=function(t){t.trigger("start",t),i.trigger("start "+t.id+":start",t),t.show(),a>0&&i.pressureFn(e,t,t.identifier),i.processOnMove(e)};if((t=i.idles.indexOf(o))>=0&&i.idles.splice(t,1),i.actives.push(o),i.ids.push(o.identifier),"semi"!==n.mode)l(o);else{if(!(Gj(s,o.position)<=n.catchDistance))return o.destroy(),void i.processOnStart(e);l(o)}return o},pV.prototype.getOrCreate=function(e,t){var i,n=this,r=n.options;return/(semi|static)/.test(r.mode)?(i=n.idles[0])?(n.idles.splice(0,1),i):"semi"===r.mode?n.createNipple(t,e):(console.warn("Coudln't find the needed nipple."),!1):i=n.createNipple(t,e)},pV.prototype.processOnMove=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),a=t.manager.scroll;if((e=>isNaN(e.buttons)?0!==e.pressure:0!==e.buttons)(e)){if(!r)return console.error("Found zombie joystick with ID "+n),void t.manager.removeIdentifier(n);if(i.dynamicPage){var s=r.el.getBoundingClientRect();r.position={x:a.x+s.left,y:a.y+s.top}}r.identifier=n;var o=r.options.size/2,l={x:e.pageX,y:e.pageY};i.lockX&&(l.y=r.position.y),i.lockY&&(l.x=r.position.x);var c,h,d=Gj(l,r.position),u=((e,t)=>{let i=t.x-e.x,n=t.y-e.y;return Wj(Math.atan2(n,i))})(l,r.position),p=Hj(u),f=d/o,m={distance:d,position:l};if("circle"===r.options.shape?(c=Math.min(d,o),h=((e,t,i)=>{let n={x:0,y:0};return i=Hj(i),n.x=e.x-t*Math.cos(i),n.y=e.y-t*Math.sin(i),n})(r.position,c,u)):(h=((e,t,i)=>({x:Math.min(Math.max(e.x,t.x-i),t.x+i),y:Math.min(Math.max(e.y,t.y-i),t.y+i)}))(l,r.position,o),c=Gj(h,r.position)),i.follow){if(d>o){let e=l.x-h.x,i=l.y-h.y;r.position.x+=e,r.position.y+=i,r.el.style.top=r.position.y-(t.box.top+a.y)+"px",r.el.style.left=r.position.x-(t.box.left+a.x)+"px",d=Gj(l,r.position)}}else l=h,d=c;var g=l.x-r.position.x,v=l.y-r.position.y;r.frontPosition={x:g,y:v},i.dataOnly||Jj(r.ui.front,r.frontPosition);var y={identifier:r.identifier,position:l,force:f,pressure:e.force||e.pressure||e.webkitForce||0,distance:d,angle:{radian:p,degree:u},vector:{x:g/o,y:-v/o},raw:m,instance:r,lockX:i.lockX,lockY:i.lockY};(y=r.computeDirection(y)).angle={radian:Hj(180-u),degree:180-u},r.trigger("move",y),t.trigger("move "+r.id+":move",y)}else this.processOnEnd(e)},pV.prototype.processOnEnd=function(e){var t=this,i=t.options,n=t.manager.getIdentifier(e),r=t.nipples.get(n),a=t.manager.removeIdentifier(r.identifier);!r||(i.dataOnly||r.hide((function(){"dynamic"===i.mode&&(r.trigger("removed",r),t.trigger("removed "+r.id+":removed",r),t.manager.trigger("removed "+r.id+":removed",r),r.destroy())})),clearInterval(t.pressureIntervals[r.identifier]),r.resetDirection(),r.trigger("end",r),t.trigger("end "+r.id+":end",r),t.ids.indexOf(r.identifier)>=0&&t.ids.splice(t.ids.indexOf(r.identifier),1),t.actives.indexOf(r)>=0&&t.actives.splice(t.actives.indexOf(r),1),/(semi|static)/.test(i.mode)?t.idles.push(r):t.nipples.indexOf(r)>=0&&t.nipples.splice(t.nipples.indexOf(r),1),t.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(t.manager.ids[a.id]=a.identifier))},pV.prototype.onDestroyed=function(e,t){var i=this;i.nipples.indexOf(t)>=0&&i.nipples.splice(i.nipples.indexOf(t),1),i.actives.indexOf(t)>=0&&i.actives.splice(i.actives.indexOf(t),1),i.idles.indexOf(t)>=0&&i.idles.splice(i.idles.indexOf(t),1),i.ids.indexOf(t.identifier)>=0&&i.ids.splice(i.ids.indexOf(t.identifier),1),i.manager.removeIdentifier(t.identifier),i.manager.unbindDocument()},pV.prototype.destroy=function(){var e=this;for(var t in e.unbindEvt(e.options.zone,"start"),e.nipples.forEach((function(e){e.destroy()})),e.pressureIntervals)e.pressureIntervals.hasOwnProperty(t)&&clearInterval(e.pressureIntervals[t]);e.trigger("destroyed",e.nipples),e.manager.unbindDocument(),e.off()};var fV=pV;function mV(e){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=Zj(),t.config(e),t.prepareCollections();var i=function(){var e;t.collections.forEach((function(i){i.forEach((function(i){e=i.el.getBoundingClientRect(),i.position={x:t.scroll.x+e.left,y:t.scroll.y+e.top}}))}))};if(typeof window>"u")return t.collections;Yj(window,"resize",(function(){Xj(i)}));var n=function(){t.scroll=Zj()};return Yj(window,"scroll",(function(){Xj(n)})),t.collections}mV.prototype=new hV,mV.constructor=mV,mV.prototype.prepareCollections=function(){var e=this;e.collections.create=e.create.bind(e),e.collections.on=e.on.bind(e),e.collections.off=e.off.bind(e),e.collections.destroy=e.destroy.bind(e),e.collections.get=function(t){var i;return e.collections.every((function(e){return!(i=e.get(t))})),i}},mV.prototype.create=function(e){return this.createCollection(e)},mV.prototype.createCollection=function(e){var t=this,i=new fV(t,e);return t.bindCollection(i),t.collections.push(i),i},mV.prototype.bindCollection=function(e){var t,i=this,n=function(e,n){t=e.type+" "+n.id+":"+e.type,i.trigger(t,n)};e.on("destroyed",i.onDestroyed.bind(i)),e.on("shown hidden rested dir plain",n),e.on("dir:up dir:right dir:down dir:left",n),e.on("plain:up plain:right plain:down plain:left",n)},mV.prototype.bindDocument=function(){var e=this;e.binded||(e.bindEvt(document,"move").bindEvt(document,"end"),e.binded=!0)},mV.prototype.unbindDocument=function(e){var t=this;(!Object.keys(t.ids).length||!0===e)&&(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},mV.prototype.getIdentifier=function(e){var t;return e?void 0===(t=void 0===e.identifier?e.pointerId:e.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},mV.prototype.removeIdentifier=function(e){var t={};for(var i in this.ids)if(this.ids[i]===e){t.id=i,t.identifier=this.ids[i],delete this.ids[i];break}return t},mV.prototype.onmove=function(e){return this.onAny("move",e),!1},mV.prototype.onend=function(e){return this.onAny("end",e),!1},mV.prototype.oncancel=function(e){return this.onAny("end",e),!1},mV.prototype.onAny=function(e,t){var i,n=this,r="processOn"+e.charAt(0).toUpperCase()+e.slice(1);t=Kj(t);var a=function(e,t,i){i.ids.indexOf(t)>=0&&(i[r](e),e._found_=!0)};return iV(t,(function(e){i=n.getIdentifier(e),iV(n.collections,a.bind(null,e,i)),e._found_||n.removeIdentifier(i)})),!1},mV.prototype.destroy=function(){var e=this;e.unbindDocument(!0),e.ids={},e.index=0,e.collections.forEach((function(e){e.destroy()})),e.off()},mV.prototype.onDestroyed=function(e,t){var i=this;if(i.collections.indexOf(t)<0)return!1;i.collections.splice(i.collections.indexOf(t),1)};var gV=new mV,vV=function(e){return gV.create(e)},yV=new Map,bV=new Map,xV=class{constructor(e,t,i,n){this.data=t;let{audio:r,volume:a,delay:s,loop:o}=t;if(!r)throw new Error("Missing property");let l="string"==typeof r?n.getAudio(r).src:r.data;this.audioPlayer=new cF({src:l,volume:a,delay:s,loop:o}),bV.has(i.uuid)?bV.get(i.uuid).push(this):bV.set(i.uuid,[this]),yV.set(e,this)}playByToggle(){"stop"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):"pause"===this.data.toggle?"playing"===this.audioPlayer.status?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},wV=class{constructor(e){this.data=e}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(e){let t=yV.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.audioPlayer[this.data.interaction](),this.disposeDelay()}),this.data.delay)):t.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(e){let t=bV.get(e);null===t||void 0===t||!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((e=>e.audioPlayer[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):t.forEach((e=>e.audioPlayer[this.data.interaction]())))}pauseAllAudios(){let e=[...bV.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((e=>{e.forEach((e=>{e.audioPlayer[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):e.forEach((e=>{e.forEach((e=>{e.audioPlayer[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},_V=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new xV(e,t,i,n);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new wV(t)}}dispatchBasic(){if(!1===EH(this.shared,this.condition))return!1;this.interaction instanceof xV?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===EH(this.shared,this.condition))return!1;this.interaction instanceof xV?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(e){if(!1===EH(this.shared,this.condition))return!1;this.interaction instanceof xV&&("start"===e?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},SV=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.delay=0,this.emission=e.emission,void 0!==e.delay&&(this.delay=e.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.start(0),this.clearDelay()}),e):this.particleSystem.start()}stop(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.stop(0),this.clearDelay()}),e):this.particleSystem.stop()}freeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.freeze(0),this.clearDelay()}),e):this.particleSystem.froze()}unFreeze(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.unFreeze(0),this.clearDelay()}),e):this.particleSystem.unFroze()}reset(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e?this.delayTimerId=window.setTimeout((()=>{this.reset(0),this.clearDelay()}),e):this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze()}}dispatchBasic(){if(!1===EH(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchConditional(){if(!1===EH(this.shared,this.condition)||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay)}}dispatchGameControl(e){if(!1===EH(this.shared,this.condition)||!this.particleSystem)return!1;"start"===e?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},AV=(e,t)=>t.some((t=>t instanceof RegExp?t.test(e):t===e));function EV(e,t){if(t={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...t},e=e.trim(),/^data:/i.test(e))return((e,t)=>{let{stripHash:i}=t,n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!n)throw new Error("Invalid URL: ".concat(e));let{type:r,data:a,hash:s}=n.groups,o=r.split(";");s=i?"":s;let l=!1;"base64"===o[o.length-1]&&(o.pop(),l=!0);let c=(o.shift()||"").toLowerCase(),h=[...o.map((e=>{let[t,i=""]=e.split("=").map((e=>e.trim()));return"charset"===t&&(i=i.toLowerCase(),"us-ascii"===i)?"":"".concat(t).concat(i?"=".concat(i):"")})).filter(Boolean)];return l&&h.push("base64"),(h.length>0||c&&"text/plain"!==c)&&h.unshift(c),"data:".concat(h.join(";"),",").concat(l?a.trim():a).concat(s?"#".concat(s):"")})(e,t);if(/^view-source:/i.test(e))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=e.startsWith("//");!i&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));let n=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===n.protocol&&(n.protocol="http:"),t.forceHttps&&"http:"===n.protocol&&(n.protocol="https:"),t.stripAuthentication&&(n.username="",n.password=""),t.stripHash?n.hash="":t.stripTextFragment&&(n.hash=n.hash.replace(/#?:~:text.*?$/i,"")),n.pathname){let e=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,t=0,i="";for(;;){let r=e.exec(n.pathname);if(!r)break;let a=r[0],s=r.index;i+=n.pathname.slice(t,s).replace(/\/{2,}/g,"/"),i+=a,t=s+a.length}i+=n.pathname.slice(t,n.pathname.length).replace(/\/{2,}/g,"/"),n.pathname=i}if(n.pathname)try{n.pathname=decodeURI(n.pathname)}catch{}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let e=n.pathname.split("/"),i=e[e.length-1];AV(i,t.removeDirectoryIndex)&&(e=e.slice(0,-1),n.pathname=e.slice(1).join("/")+"/")}if(n.hostname&&(n.hostname=n.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(n.hostname)&&(n.hostname=n.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(let a of[...n.searchParams.keys()])AV(a,t.removeQueryParameters)&&n.searchParams.delete(a);if(!0===t.removeQueryParameters&&(n.search=""),t.sortQueryParameters){n.searchParams.sort();try{n.search=decodeURIComponent(n.search)}catch{}}t.removeTrailingSlash&&(n.pathname=n.pathname.replace(/\/$/,""));let r=e;return e=n.toString(),!t.removeSingleSlash&&"/"===n.pathname&&!r.endsWith("/")&&""===n.hash&&(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===n.pathname)&&""===n.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),i&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}var CV=class{constructor(e,t,i,n){let{url:r,context:a}=e;if(this.controlsManager=t,this.shared=i,this.condition=n,!r)throw new Error("Missing property");this.url=r.startsWith("mailto:")?r:EV(r,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=null!==a&&void 0!==a?a:"tab"}dispatch(){var e;if(!1===EH(this.shared,this.condition))return!1;s_?window.location.assign(this.url):("tab"===this.context?window.open(this.url,"_blank"):"window"===this.context?window.open(this.url,"_blank","width=".concat(window.innerWidth,", height=").concat(window.innerHeight)):window.open(this.url,"_parent"),null!==(e=this.controlsManager.orbitControls)&&void 0!==e&&e.onPointerUp(f_[0]),f_.splice(0,f_.length))}},MV=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=e=>{var t;this.timeoutIdQueue.shift();let i=this.page.scene.find(e);if(void 0===i)return;let n=this.controlsManager.sharedGameControlGlobals.rapierWorld,r=!n||(null===(t=i.dataPatched.physics)||void 0===t?void 0:t.fusedBody);if(i.cloner){for(let e of i.cloner.children){var a;r?(e.playModeVisible=!1,e.rigidBody&&"positioned"===(null===(a=i.dataPatched.physics)||void 0===a?void 0:a.rigidBody)&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),n.removeRigidBody(e.rigidBody),e.rigidBody=void 0),e.bvhGeometry&&(e.bvhGeometry=void 0)):void 0===this.clone||this.clone===e?(e.playModeVisible=!1,e.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),n.removeRigidBody(e.rigidBody),e.rigidBody=void 0)):void 0===e.playModeVisible&&(e.playModeVisible=!0)}(r||void 0===this.clone||!1===this.clone)&&(i.visible=!1,i.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(i.rigidBody.collider(0).handle),n.removeRigidBody(i.rigidBody),i.rigidBody=void 0),i.bvhGeometry&&(i.bvhGeometry=void 0))}else i.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(i.rigidBody.collider(0).handle),n.removeRigidBody(i.rigidBody),i.rigidBody=void 0),i.bvhGeometry&&(i.bvhGeometry=void 0),i.visible=!1;this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=void 0===n?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.bvhGeometry)):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.rigidBody)),i.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...e.objects]}dispatch(e){if(!1===EH(this.shared,this.condition))return!1;this.clone=e,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()}dispatchFromStart(){if(!1===EH(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))}dispose(){this.timeoutIdQueue.forEach((e=>window.clearTimeout(e)))}},PV=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.shared=i,this.eventManager=n,this.condition=r,this.shared=i}dispatch(){var e;if(!1===EH(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout((()=>{var e;this.shared.reset(this.shared.data,!0),oH(this.page,this.shared,!0),this.eventManager.reset(),null!==(e=this.eventManager.controlsManager.gameControl)&&void 0!==e&&e.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId}),1e3*(null!==(e=this.data.delay)&&void 0!==e?e:0))}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},TV={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},DV={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},RV=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],OV={CSS:{},springs:{}};function IV(e,t,i){return Math.min(Math.max(e,t),i)}function kV(e,t){return e.indexOf(t)>-1}function LV(e,t){return e.apply(null,t)}var FV={arr:function(e){return Array.isArray(e)},obj:function(e){return kV(Object.prototype.toString.call(e),"Object")},pth:function(e){return FV.obj(e)&&e.hasOwnProperty("totalLength")},svg:function(e){return e instanceof SVGElement},inp:function(e){return e instanceof HTMLInputElement},dom:function(e){return!("isNode"in e)&&(e.nodeType||FV.svg(e))},str:function(e){return"string"==typeof e},fnc:function(e){return"function"==typeof e},und:function(e){return typeof e>"u"},hex:function(e){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)},rgb:function(e){return/^rgb/.test(e)},hsl:function(e){return/^hsl/.test(e)},col:function(e){return FV.hex(e)||FV.rgb(e)||FV.hsl(e)},key:function(e){return!TV.hasOwnProperty(e)&&!DV.hasOwnProperty(e)&&"targets"!==e&&"keyframes"!==e}};function BV(e){var t=/\(([^)]+)\)/.exec(e);return t?t[1].split(",").map((function(e){return parseFloat(e)})):[]}function NV(e,t){var i=BV(e),n=IV(FV.und(i[0])?1:i[0],.1,100),r=IV(FV.und(i[1])?100:i[1],.1,100),a=IV(FV.und(i[2])?10:i[2],.1,100),s=IV(FV.und(i[3])?0:i[3],.1,100),o=Math.sqrt(r/n),l=a/(2*Math.sqrt(r*n)),c=l<1?o*Math.sqrt(1-l*l):0,h=1,d=l<1?(l*o-s)/c:-s+o;function u(e){var i=t?t*e/1e3:e;return i=l<1?Math.exp(-i*l*o)*(h*Math.cos(c*i)+d*Math.sin(c*i)):(h+d*i)*Math.exp(-i*o),0===e||1===e?e:1-i}return t?u:function(){var t=OV.springs[e];if(t)return t;for(var i=1/6,n=0,r=0;;)if(1===u(n+=i)){if(++r>=16)break}else r=0;var a=n*i*1e3;return OV.springs[e]=a,a}}function zV(e){return void 0===e&&(e=10),function(t){return Math.ceil(IV(t,1e-6,1)*e)*(1/e)}}var UV=function(){var e=.1;function t(e,t){return 1-3*t+3*e}function i(e,t){return 3*t-6*e}function n(e){return 3*e}function r(e,r,a){return((t(r,a)*e+i(r,a))*e+n(r))*e}function a(e,r,a){return 3*t(r,a)*e*e+2*i(r,a)*e+n(r)}return function(t,i,n,s){if(0<=t&&t<=1&&0<=n&&n<=1){var o=new Float32Array(11);if(t!==i||n!==s)for(var l=0;l<11;++l)o[l]=r(l*e,t,n);return function(e){return t===i&&n===s||0===e||1===e?e:r(c(e),i,s)}}function c(i){for(var s=0,l=1;10!==l&&o[l]<=i;++l)s+=e;--l;var c=s+(i-o[l])/(o[l+1]-o[l])*e,h=a(c,t,n);return h>=.001?function(e,t,i,n){for(var s=0;s<4;++s){var o=a(t,i,n);if(0===o)return t;t-=(r(t,i,n)-e)/o}return t}(i,c,t,n):0===h?c:function(e,t,i,n,a){var s,o,l=0;do{(s=r(o=t+(i-t)/2,n,a)-e)>0?i=o:t=o}while(Math.abs(s)>1e-7&&++l<10);return o}(i,s,s+e,t,n)}}}(),jV=function(){var e={linear:function(){return function(e){return e}}},t={Sine:function(){return function(e){return 1-Math.cos(e*Math.PI/2)}},Circ:function(){return function(e){return 1-Math.sqrt(1-e*e)}},Back:function(){return function(e){return e*e*(3*e-2)}},Bounce:function(){return function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}},Elastic:function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5);var i=IV(e,1,10),n=IV(t,.1,2);return function(e){return 0===e||1===e?e:-i*Math.pow(2,10*(e-1))*Math.sin((e-1-n/(2*Math.PI)*Math.asin(1/i))*(2*Math.PI)/n)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach((function(e,i){t[e]=function(){return function(e){return Math.pow(e,i+2)}}})),Object.keys(t).forEach((function(i){var n=t[i];e["easeIn"+i]=n,e["easeOut"+i]=function(e,t){return function(i){return 1-n(e,t)(1-i)}},e["easeInOut"+i]=function(e,t){return function(i){return i<.5?n(e,t)(2*i)/2:1-n(e,t)(-2*i+2)/2}}})),e}();function VV(e,t){if(FV.fnc(e))return e;var i=e.split("(")[0],n=jV[i],r=BV(e);switch(i){case"spring":return NV(e,t);case"cubicBezier":return LV(UV,r);case"steps":return LV(zV,r);default:return LV(n,r)}}function GV(e){try{return document.querySelectorAll(e)}catch{return}}function HV(e,t){for(var i=e.length,n=arguments.length>=2?arguments[1]:void 0,r=[],a=0;a<i;a++)if(a in e){var s=e[a];t.call(n,s,a,e)&&r.push(s)}return r}function WV(e){return e.reduce((function(e,t){return e.concat(FV.arr(t)?WV(t):t)}),[])}function qV(e){return FV.arr(e)?e:(FV.str(e)&&(e=GV(e)||e),e instanceof NodeList||e instanceof HTMLCollection?[].slice.call(e):[e])}function XV(e,t){return e.some((function(e){return e===t}))}function YV(e){var t={};for(var i in e)t[i]=e[i];return t}function QV(e,t){var i=YV(e);for(var n in e)i[n]=t.hasOwnProperty(n)?t[n]:e[n];return i}function KV(e,t){var i=YV(e);for(var n in t)i[n]=FV.und(e[n])?t[n]:e[n];return i}function ZV(e){return FV.rgb(e)?function(e){var t=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(e);return t?"rgba("+t[1]+",1)":e}(e):FV.hex(e)?function(e){var t=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,i,n){return t+t+i+i+n+n})),i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return"rgba("+parseInt(i[1],16)+","+parseInt(i[2],16)+","+parseInt(i[3],16)+",1)"}(e):FV.hsl(e)?function(e){var t,i,n,r=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(e)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(e),a=parseInt(r[1],10)/360,s=parseInt(r[2],10)/100,o=parseInt(r[3],10)/100,l=r[4]||1;function c(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}if(0==s)t=i=n=o;else{var h=o<.5?o*(1+s):o+s-o*s,d=2*o-h;t=c(d,h,a+1/3),i=c(d,h,a),n=c(d,h,a-1/3)}return"rgba("+255*t+","+255*i+","+255*n+","+l+")"}(e):void 0}function JV(e){var t=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(e);if(t)return t[1]}function $V(e,t){return FV.fnc(e)?e(t.target,t.id,t.total):e}function eG(e,t){return e.getAttribute(t)}function tG(e,t,i){if(XV([i,"deg","rad","turn"],JV(t)))return t;var n=OV.CSS[t+i];if(!FV.und(n))return n;var r=document.createElement(e.tagName),a=e.parentNode&&e.parentNode!==document?e.parentNode:document.body;a.appendChild(r),r.style.position="absolute",r.style.width=100+i;var s=100/r.offsetWidth;a.removeChild(r);var o=s*parseFloat(t);return OV.CSS[t+i]=o,o}function iG(e,t,i){if(t in e.style){var n=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),r=e.style[t]||getComputedStyle(e).getPropertyValue(n)||"0";return i?tG(e,r,i):r}}function nG(e,t){return FV.dom(e)&&!FV.inp(e)&&(eG(e,t)||FV.svg(e)&&e[t])?"attribute":FV.dom(e)&&XV(RV,t)?"transform":FV.dom(e)&&"transform"!==t&&iG(e,t)?"css":null!=e[t]?"object":void 0}function rG(e){if(FV.dom(e)){for(var t,i=e.style.transform||"",n=/(\w+)\(([^)]*)\)/g,r=new Map;t=n.exec(i);)r.set(t[1],t[2]);return r}}function aG(e,t,i,n){var r=kV(t,"scale")?1:0+function(e){return kV(e,"translate")||"perspective"===e?"px":kV(e,"rotate")||kV(e,"skew")?"deg":void 0}(t),a=rG(e).get(t)||r;return i&&(i.transforms.list.set(t,a),i.transforms.last=t),n?tG(e,a,n):a}function sG(e,t,i,n){switch(nG(e,t)){case"transform":return aG(e,t,n,i);case"css":return iG(e,t,i);case"attribute":return eG(e,t);default:return e[t]||0}}function oG(e,t){var i=/^(\*=|\+=|-=)/.exec(e);if(!i)return e;var n=JV(e)||0,r=parseFloat(t),a=parseFloat(e.replace(i[0],""));switch(i[0][0]){case"+":return r+a+n;case"-":return r-a+n;case"*":return r*a+n}}function lG(e,t){if(FV.col(e))return ZV(e);if(/\s/g.test(e))return e;var i=JV(e),n=i?e.substr(0,e.length-i.length):e;return t?n+t:n}function cG(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function hG(e){for(var t,i=e.points,n=0,r=0;r<i.numberOfItems;r++){var a=i.getItem(r);r>0&&(n+=cG(t,a)),t=a}return n}function dG(e){if(e.getTotalLength)return e.getTotalLength();switch(e.tagName.toLowerCase()){case"circle":return function(e){return 2*Math.PI*eG(e,"r")}(e);case"rect":return function(e){return 2*eG(e,"width")+2*eG(e,"height")}(e);case"line":return function(e){return cG({x:eG(e,"x1"),y:eG(e,"y1")},{x:eG(e,"x2"),y:eG(e,"y2")})}(e);case"polyline":return hG(e);case"polygon":return function(e){var t=e.points;return hG(e)+cG(t.getItem(t.numberOfItems-1),t.getItem(0))}(e)}}function uG(e,t){var i=t||{},n=i.el||function(e){for(var t=e.parentNode;FV.svg(t)&&FV.svg(t.parentNode);)t=t.parentNode;return t}(e),r=n.getBoundingClientRect(),a=eG(n,"viewBox"),s=r.width,o=r.height,l=i.viewBox||(a?a.split(" "):[0,0,s,o]);return{el:n,viewBox:l,x:l[0]/1,y:l[1]/1,w:s/l[2],h:o/l[3]}}function pG(e,t){function i(i){void 0===i&&(i=0);var n=t+i>=1?t+i:0;return e.el.getPointAtLength(n)}var n=uG(e.el,e.svg),r=i(),a=i(-1),s=i(1);switch(e.property){case"x":return(r.x-n.x)*n.w;case"y":return(r.y-n.y)*n.h;case"angle":return 180*Math.atan2(s.y-a.y,s.x-a.x)/Math.PI}}function fG(e,t){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,n=lG(FV.pth(e)?e.totalLength:e,t)+"";return{original:n,numbers:n.match(i)?n.match(i).map(Number):[0],strings:FV.str(e)||t?n.split(i):[]}}function mG(e){return HV(e?WV(FV.arr(e)?e.map(qV):qV(e)):[],(function(e,t,i){return i.indexOf(e)===t}))}function gG(e){var t=mG(e);return t.map((function(e,i){return{target:e,id:i,total:t.length,transforms:{list:rG(e)}}}))}function vG(e,t){var i=YV(t);if(/^spring/.test(i.easing)&&(i.duration=NV(i.easing)),FV.arr(e)){var n=e.length;2===n&&!FV.obj(e[0])?e={value:e}:FV.fnc(t.duration)||(i.duration=t.duration/n)}var r=FV.arr(e)?e:[e];return r.map((function(e,i){var n=FV.obj(e)&&!FV.pth(e)?e:{value:e};return FV.und(n.delay)&&(n.delay=i?0:t.delay),FV.und(n.endDelay)&&(n.endDelay=i===r.length-1?t.endDelay:0),n})).map((function(e){return KV(e,i)}))}function yG(e,t){var i=[],n=t.keyframes;for(var r in n&&(t=KV(function(e){for(var t=HV(WV(e.map((function(e){return Object.keys(e)}))),(function(e){return FV.key(e)})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),i={},n=function(n){var r=t[n];i[r]=e.map((function(e){var t={};for(var i in e)FV.key(i)?i==r&&(t.value=e[i]):t[i]=e[i];return t}))},r=0;r<t.length;r++)n(r);return i}(n),t)),t)FV.key(r)&&i.push({name:r,tweens:vG(t[r],e)});return i}function bG(e,t){var i;return e.tweens.map((function(n){var r=function(e,t){var i={};for(var n in e){var r=$V(e[n],t);FV.arr(r)&&(r=r.map((function(e){return $V(e,t)})),1===r.length&&(r=r[0])),i[n]=r}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}(n,t),a=r.value,s=FV.arr(a)?a[1]:a,o=JV(s),l=sG(t.target,e.name,o,t),c=i?i.to.original:l,h=FV.arr(a)?a[0]:c,d=JV(h)||JV(l),u=o||d;return FV.und(s)&&(s=c),r.from=fG(h,u),r.to=fG(oG(s,h),u),r.start=i?i.end:0,r.end=r.start+r.delay+r.duration+r.endDelay,r.easing=VV(r.easing,r.duration),r.isPath=FV.pth(a),r.isColor=FV.col(r.from.original),r.isColor&&(r.round=1),i=r,r}))}var xG={css:function(e,t,i){return e.style[t]=i},attribute:function(e,t,i){return e.setAttribute(t,i)},object:function(e,t,i){return e[t]=i},transform:function(e,t,i,n,r){if(n.list.set(t,i),t===n.last||r){var a="";n.list.forEach((function(e,t){a+=t+"("+e+") "})),e.style.transform=a}}};function wG(e,t){gG(e).forEach((function(e){for(var i in t){var n=$V(t[i],e),r=e.target,a=JV(n),s=sG(r,i,a,e),o=oG(lG(n,a||JV(s)),s),l=nG(r,i);xG[l](r,i,o,e.transforms,!0)}}))}function _G(e,t){return HV(WV(e.map((function(e){return t.map((function(t){return function(e,t){var i=nG(e.target,t.name);if(i){var n=bG(t,e),r=n[n.length-1];return{type:i,property:t.name,animatable:e,tweens:n,duration:r.end,delay:n[0].delay,endDelay:r.endDelay}}}(e,t)}))}))),(function(e){return!FV.und(e)}))}function SG(e,t){var i=e.length,n=function(e){return e.timelineOffset?e.timelineOffset:0},r={};return r.duration=i?Math.max.apply(Math,e.map((function(e){var t,i,r,a;let s=null!==(t=e.startOnceDelay)&&void 0!==t?t:0,o=null!==(i=e.pingPongDelayCorrection)&&void 0!==i?i:0,l=null!==(r=e.pingPongEndDelayCorrection)&&void 0!==r?r:0;return n(e)+s+o+l+e.duration*(null!==(a=e.loop)&&void 0!==a?a:1)}))):t.duration,r.delay=i?Math.min.apply(Math,e.map((function(e){var t,i;let r=null!==(t=e.startOnceDelay)&&void 0!==t?t:0,a=null!==(i=e.pingPongDelayCorrection)&&void 0!==i?i:0;return n(e)+r+a+e.delay}))):t.delay,r.endDelay=i?r.duration-Math.max.apply(Math,e.map((function(e){var t,i,r,a;let s=null!==(t=e.startOnceDelay)&&void 0!==t?t:0,o=null!==(i=e.pingPongDelayCorrection)&&void 0!==i?i:0,l=null!==(r=e.pingPongEndDelayCorrection)&&void 0!==r?r:0;return n(e)+s+o+e.duration*(null!==(a=e.loop)&&void 0!==a?a:1)-e.endDelay-l}))):t.endDelay,r}var AG=0;var EG,CG=[],MG=[],PG=function(){function e(){EG=requestAnimationFrame(t)}function t(t){var i=CG.length;if(i){for(var n=0;n<i;){var r=CG[n];r.paused?(CG.splice(n,1),i-=1):(r.tick(t),n++)}e()}else EG=cancelAnimationFrame(EG)}return e}();function TG(e){void 0===e&&(e={});var t,i,n=0,r=0,a=0,s=0,o=null;function l(e){var t=window.Promise&&new Promise((function(e){return o=e}));return e.finished=t,t}var c=function(e){var t=QV(TV,e),i=QV(DV,e),n=yG(i,e),r=gG(e.targets),a=_G(r,n),s=SG(a,i),o=AG;return AG++,KV(t,{id:o,children:[],animatables:r,animations:a,duration:s.duration,delay:s.delay,endDelay:s.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}(e);l(c);function h(){var e=c.direction;"alternate"!==e&&(c.direction="normal"!==e?"normal":"reverse"),c.reversed=!c.reversed,i.forEach((function(e){(1===e.loop||e.loop%2===0)&&(e.reversed=c.reversed)}))}function d(e){return c.reversed?c.duration-e:e}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t&&(c.reversed?t.seek(t.duration*t.loop-(e-t.timelineOffset-t.pingPongDelayCorrection),i):t.seek(e-t.timelineOffset-t.startOnceDelay-t.pingPongDelayCorrection,i))}function p(e){var t=0,i=c.animations,n=i.length;for("alternate"!==c.direction&&"alternate"===(null===(r=c.parent)||void 0===r?void 0:r.direction)?!1===(null===(a=c.parent)||void 0===a?void 0:a.rewind)&&!0===c.reversePlayback&&!1===c.rewind&&(e=null!==(s=c.parent)&&void 0!==s&&s.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-e:c.duration+c.delay-c.endDelay-e):g(!1,null===(o=c.parent)||void 0===o?void 0:o.rewind,c.rewind,null===(l=c.parent)||void 0===l?void 0:l.reversePlayback,c.reversePlayback)&&(e=null!==(h=c.parent)&&void 0!==h&&h.reversed&&"alternate"===c.direction?c.duration-c.delay+c.endDelay-e:c.duration+c.delay-c.endDelay-e);t<n;){var r,a,s,o,l,h,d,u=i[t],p=u.animatable,f=u.tweens,m=f.length-1,v=f[m];let n;m&&(v=HV(f,(function(t){return e<t.end}))[0]||v),n=null!==(d=c.parent)&&void 0!==d&&d.reversed&&"alternate"===c.direction?IV(e-v.start-v.endDelay,0,v.duration)/v.duration:IV(e-v.start-v.delay,0,v.duration)/v.duration;for(var y=isNaN(n)?1:v.easing(n),b=v.to.strings,x=v.round,w=[],_=v.to.numbers.length,S=void 0,A=0;A<_;A++){var E,C,M,P=void 0;let e,t;"alternate"!==c.direction?!1===(null===(E=c.parent)||void 0===E?void 0:E.rewind)&&!0===c.reversePlayback&&!1===c.rewind?(e=v.to.numbers[A],t=v.from.numbers[A]||0):(t=v.to.numbers[A],e=v.from.numbers[A]||0):g(!0,null===(C=c.parent)||void 0===C?void 0:C.rewind,c.rewind,null===(M=c.parent)||void 0===M?void 0:M.reversePlayback,c.reversePlayback)?(e=v.to.numbers[A],t=v.from.numbers[A]||0):(t=v.to.numbers[A],e=v.from.numbers[A]||0),P=v.isPath?pG(v.value,y*t):e+y*(t-e),x&&(v.isColor&&A>2||(P=Math.round(P*x)/x)),w.push(P)}var T=b.length;if(T){S=b[0];for(var D=0;D<T;D++){b[D];var R=b[D+1],O=w[D];isNaN(O)||(S+=R?O+R:O+" ")}}else S=w[0];xG[u.type](p.target,u.property,S,p.transforms),u.currentValue=S,t++}}function f(e){c[e]&&!c.passThrough&&c[e](c)}let m={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function g(e,t,i,n,r){return m[e<<4|t<<3|i<<2|n<<1|r]}function v(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var a=c.duration;let m=c.delay,g=a-c.endDelay;(null===(t=c.parent)||void 0===t?void 0:t.reversed)&&"alternate"===c.direction&&(m=c.endDelay,g=a-c.delay);var v=d(e);if(c.progress=IV(v/a*100,0,100),r||(c.reversePlayback=v<c.currentTime),s&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(c.reversed)for(var n=s;n--;)u(e,i[n],t);else for(var r=0;r<s;r++)u(e,i[r],t)}(v,r),!c.began&&c.currentTime>=0&&(c.began=!0,f("begin")),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,f("loopBegin")),(c.reversed||v>=0)&&v<=m&&0!==c.currentTime&&(p(0),f("change")),(v>=g&&c.currentTime!==a+c.pingPongDelayCorrection||!a)&&(p(a),f("change")),v>m&&v<g?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,f("changeBegin")),p(v),f("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,f("change"),s&&f("timelineChangeComplete")):c.began&&v>g&&f("changeComplete"),c.currentTime=IV(v,0,a+c.pingPongDelayCorrection),c.began&&f("update"),e>=a)if(c.remaining&&!0!==c.remaining&&c.remaining--,c.remaining){n+=s?c.duration/TG.speed:c.duration;for(let e of i)e.setStartTime(0),e.remaining=e.loop;f("loopComplete"),c.loopBegan=!1,"alternate"===c.direction?h():s&&(c.direction="normal",c.reversed=!1,i.forEach((function(e){return e.reversed=!1})))}else c.paused=!0,c.completed||(c.completed=!0,f("loopComplete"),f("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)))}return c.reset=function(){var e=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversePlayback=!1,c.reversed="reverse"===e,c.remaining=c.loop,i=c.children;for(var t=s=i.length;t--;)c.children[t].reset();p(c.reversed?c.duration:0)},c.setStartTime=function(e){n=e},c.set=function(e,t){return wG(e,t),c},c.tick=function(e){a=e,n||(n=a),v((a+(r-n))*TG.speed)},c.seek=function(e){v(e-n,arguments.length>1&&void 0!==arguments[1]&&arguments[1])},c.pause=function(e){c.paused=!0,s&&(t=null!==e&&void 0!==e?e:performance.now())},c.play=function(e){!c.paused||(c.completed&&c.reset(),c.paused=!1,CG.push(c),s&&void 0!==t&&(n+=(null!==e&&void 0!==e?e:performance.now())-t),EG||PG())},c.reverse=function(){h(),c.completed=!c.reversed,n=0,r=d(c.currentTime)*(1/TG.speed)},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function DG(e,t){for(var i=t.length;i--;)XV(e,t[i].animatable.target)&&t.splice(i,1)}typeof document<"u"&&document.addEventListener("visibilitychange",(function(e){document.hidden?(CG.forEach((function(t){return t.pause(e.timeStamp)})),MG=CG.slice(0),TG.running=CG=[]):MG.forEach((function(t){return t.play(e.timeStamp)}))})),TG.version="3.2.0",TG.speed=1,TG.running=CG,TG.remove=function(e){for(var t=mG(e),i=CG.length;i--;){var n=CG[i],r=n.animations,a=n.children;DG(t,r);for(var s=a.length;s--;){var o=a[s],l=o.animations;DG(t,l),!l.length&&!o.children.length&&a.splice(s,1)}!r.length&&!a.length&&n.pause()}},TG.get=sG,TG.set=wG,TG.convertPx=tG,TG.path=function(e,t){var i=FV.str(e)?GV(e)[0]:e,n=t||100;return function(e){return{property:e,el:i,svg:uG(i),totalLength:dG(i)*(n/100)}}},TG.setDashoffset=function(e){var t=dG(e);return e.setAttribute("stroke-dasharray",t),t},TG.stagger=function(e,t){void 0===t&&(t={});var i=t.direction||"normal",n=t.easing?VV(t.easing):null,r=t.grid,a=t.axis,s=t.from||0,o="first"===s,l="center"===s,c="last"===s,h=FV.arr(e),d=parseFloat(h?e[0]:e),u=h?parseFloat(e[1]):0,p=JV(h?e[1]:e)||0,f=t.start||0+(h?d:0),m=[],g=0;return function(e,t,v){if(o&&(s=0),l&&(s=(v-1)/2),c&&(s=v-1),!m.length){for(var y=0;y<v;y++){if(r){var b=l?(r[0]-1)/2:s%r[0],x=l?(r[1]-1)/2:Math.floor(s/r[0]),w=b-y%r[0],_=x-Math.floor(y/r[0]),S=Math.sqrt(w*w+_*_);"x"===a&&(S=-w),"y"===a&&(S=-_),m.push(S)}else m.push(Math.abs(s-y));g=Math.max.apply(Math,m)}n&&(m=m.map((function(e){return n(e/g)*g}))),"reverse"===i&&(m=m.map((function(e){return a?e<0?-1*e:-e:Math.abs(g-e)})))}return f+(h?(u-d)/g:d)*(Math.round(100*m[t])/100)+p}},TG.timeline=function(e){void 0===e&&(e={});var t=TG(e);return t.duration=0,t.add=function(i,n){var r=CG.indexOf(t),a=t.children;function s(e){e.passThrough=!0}r>-1&&CG.splice(r,1);for(var o=0;o<a.length;o++)s(a[o]);var l=KV(i,QV(DV,e));l.targets=l.targets||e.targets;var c=t.duration;l.autoplay=!1,l.timelineOffset=FV.und(n)?c:oG(n,c),s(t);var h=TG(l);s(h),a.push(h),h.parent=t;var d=SG(a,e);return t.delay=d.delay,t.endDelay=d.endDelay,t.duration=d.duration,!0===h.loop&&(t.duration=1/0),t.seek(0),t.reset(),t.autoplay&&t.play(),t},t},TG.easing=VV,TG.penner=jV,TG.random=function(e,t){return Math.floor(Math.random()*(t-e+1))+e};var RG=TG,OG=new gl,IG=new gl,kG=new ml;function LG(e,t,i,n,r,a){var s,o;let l=void 0!==i[e]?i[e]:void 0,c=n[e];if(null==c)return;let h=null!=l?"string"==typeof l?Number(null!==(s=r.getVariable(l))&&void 0!==s?s:0):l:t[e],d="string"==typeof c?Number(null!==(o=r.getVariable(c))&&void 0!==o?o:0):c;return h!==d?{update:i=>{let n=Uo.lerp(h,d,i);t[e]=a?Math.trunc(n):n},start:()=>{t[e]=h},end:()=>{t[e]=d}}:void 0}function FG(e,t,i,n,r,a){let s=i[e]?i[e]:void 0,o=n[e];if(!o)return;let l=t[e],c=[...null!==s&&void 0!==s?s:l].map((e=>{var t;return"string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e})),h=[...o].map((e=>{var t;return"string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e}));return c.length!==h.length||qw(c,h)?void 0:{update:i=>{c.forEach(((n,r)=>{let s=Uo.lerp(n,h[r],i);t[e][r]=a?Math.trunc(s):s}))},start:()=>{Object.assign(t[e],c)},end:()=>{Object.assign(t[e],h)}}}function BG(e,t,i){return t.forEach(((t,n)=>{var r;e.setComponent(n,"string"==typeof t?Number(null!==(r=i.getVariable(t))&&void 0!==r?r:0):t)})),e}function NG(e,t,i,n,r){let a=i[e]?i[e]:void 0,s=n[e];if(!s)return;let o=t[e],l=a?BG(new gl,a,r):o.clone(),c=BG(new gl,s,r);return l.equals(c)?void 0:{update:e=>{o.lerpVectors(l,c,e)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function zG(e,t,i){return t.forEach(((t,n)=>{var r;e.setComponent(n,"string"==typeof t?Number(null!==(r=i.getVariable(t))&&void 0!==r?r:0):t)})),e}function UG(e,t,i,n,r){let a=i[e]?i[e]:void 0,s=n[e];if(!s)return;let o=t[e],l=!(o instanceof jo),c=o instanceof jo?o:(new jo).fromArray(o),h=a?zG(new jo,a,r):c.clone(),d=zG(new jo,s,r);return h.equals(d)?void 0:{update:i=>{c.lerpVectors(h,d,i),l&&(t[e]=c.toArray())},start:()=>{c.copy(h),l&&(t[e]=c.toArray())},end:()=>{c.copy(d),l&&(t[e]=c.toArray())}}}function jG(e,t,i,n,r){let a=i[e]?i[e]:void 0,s=n[e];if(!s)return;let o=t[e],l=new yI(o.r,o.g,o.b,o.a),c=a?"string"==typeof a?r.getColor(a).clone():new yI(a.r,a.g,a.b,a.a):l.clone(),h="string"==typeof s?r.getColor(s).clone():new yI(s.r,s.g,s.b,s.a);return c.equals(h)?void 0:{update:i=>{l.lerpColors(c,h,i);let n=Uo.lerp(c.a,h.a,i);l.a=n,t[e]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(h)}}}function VG(e,t,i,n,r){return"number"==typeof t[e]?LG(e,t,null!==i&&void 0!==i?i:{},n,r):Array.isArray(t[e])?FG(e,t,null!==i&&void 0!==i?i:{},n,r):void 0}function GG(e,t,i,n){let r=[];if(!("geometry"in i))return r;let a=e.geometry.userData.parameters,s="geometry"in t?t.geometry:{},o=i.geometry;if(e instanceof FF){let t=function(e,t,i,n){var r;if(void 0===i.scaleBaked)return;let a=(null!==(r=t.scaleBaked)&&void 0!==r?r:e.data.geometry.scaleBaked).map((e=>{var t;return"string"==typeof e?Number(null!==(t=n.getVariable(e))&&void 0!==t?t:0):e})),s=i.scaleBaked.map((e=>{var t;return"string"==typeof e?Number(null!==(t=n.getVariable(e))&&void 0!==t?t:0):e}));if(gE.isEqual(a,s))return;let o=[];return o.push({update:t=>{e.updateGeometryInteractions({scaleBaked:[Uo.lerp(a[0],s[0],t),Uo.lerp(a[1],s[1],t),Uo.lerp(a[2],s[2],t)]},n),e.invalidateDownstreamBooleanData()},start:()=>{e.updateGeometryInteractions({scaleBaked:a},n),e.invalidateDownstreamBooleanData()},end:()=>{e.updateGeometryInteractions({scaleBaked:s},n),e.invalidateDownstreamBooleanData()}}),o}(e,s,o,n);t&&r.push(...t)}else{let t={};if(Object.assign(t,t_(a,tM)),tM.forEach((e=>{let i=VG(e,t,s,o,n);i&&r.push(i)})),e instanceof KU){Object.assign(t,{extrusion:{...a.extrusion}});let e=function(e,t,i,n){var r;if(!i.extrusion)return;let a=e.extrusion,s=null!==(r=t.extrusion)&&void 0!==r?r:{},o=i.extrusion,l=[];return fC.forEach((e=>{let t=VG(e,a,s,o,n);t&&l.push(t)})),l}(t,s,o,n);e&&r.push(...e)}r.length&&r.push({update:i=>{e.updateGeometryInteractions(t,n),e.updateGeometryGroupsIfNeeded()},start:i=>{e.updateGeometryInteractions(t,n),e.updateGeometryGroupsIfNeeded()},end:i=>{e.updateGeometryInteractions(t,n),e.updateGeometryGroupsIfNeeded()}})}return r}function HG(e,t,i,n){let r=[];if(void 0!==i.intensity){let a=LG("intensity",e,t,i,n);a&&r.push(a)}if(void 0!==i.color){let a=function(e,t,i,n,r){let a=i[e]?i[e]:void 0,s=n[e];if(!s)return;let o=t[e],l=a?"string"==typeof a?r.getColor(a).clone():(new rl).setRGB(a.r,a.g,a.b):o.clone(),c="string"==typeof s?r.getColor(s).clone():(new rl).setRGB(s.r,s.g,s.b);if(l.equals(c))return;let h=o.clone();return t[e]=h,{update:e=>{h.lerpColors(l,c,e)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}("color",e,t,i,n);a&&r.push(a)}return r}function WG(e,t,i,n){let r=[],a=XL(i,n)||!!t.layers&&XL(t,n);r.push(function(e,t){return{update:()=>{e.transparent=t}}}(e,a));for(let c of e.layers){var s,o,l;let e=null===(s=t.layers)||void 0===s?void 0:s.data(c.uuid),a=i.layers.data(c.uuid);if(!a||"light"!==c.type&&(null!==(o=c.visible)&&void 0!==o&&!o||null!==(l=a.visible)&&void 0!==l&&!l))continue;let h=c.getNames().filter((e=>!sC.some((t=>e.includes(t)))));for(let t of h)try{let i,s=c.getValue(t);if("colors"===t)i=JG(c,e,a,t);else if(Array.isArray(s))"steps"===t&&(i=ZG(c,e,a,t));else if("number"==typeof s)i=qG(c,e,a,t,n);else{if("boolean"==typeof s)continue;s instanceof jo?i=XG(c,e,a,t):s instanceof gl?i=YG(c,e,a,t,n):s instanceof yI?i=KG(c,e,a,t,n):s instanceof rl?i=QG(c,e,a,t,n):"isTexture"in s&&(i=$G(c,e,a,t))}i&&(Array.isArray(i)?r.push(...i):r.push(i))}catch(SE){console.error("lerpMaterial: unexpected material layer for ".concat(t),SE)}}return r}function qG(e,t,i,n,r){var a,s;if(!e.hasValue(n)||!(n in i))return;let o=t?t[n]:e.getValue(n),l=i[n],c="string"==typeof o?Number(null!==(a=r.getVariable(o))&&void 0!==a?a:0):o,h="string"==typeof l?Number(null!==(s=r.getVariable(l))&&void 0!==s?s:0):l;return c!==h?{update:t=>{e.setValue(n,Uo.lerp(c,h,t))},start:()=>{e.setValue(n,c)},end:()=>{e.setValue(n,h)}}:void 0}function XG(e,t,i,n){if(!e.hasValue(n)||!(n in i))return;let r=e.getValue(n),a=t?(new jo).fromArray(t[n]):r.clone(),s=(new jo).fromArray(i[n]);return a.equals(s)?void 0:{update:e=>{r.lerpVectors(a,s,e)},start:()=>{r.copy(a)},end:()=>{r.copy(s)}}}function YG(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let a=e.getValue(n),s=t?t[n]:void 0,o=i[n],l=s?BG(new gl,s,r):a.clone(),c=BG(new gl,o,r);return l.equals(c)?void 0:{update:e=>{a.lerpVectors(l,c,e)},start:()=>{a.copy(l)},end:()=>{a.copy(c)}}}function QG(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let a=t?t[n]:void 0,s=i[n],o=e.getValue(n),l=a?"string"==typeof a?r.getColor(a).clone():(new rl).setRGB(a.r,a.g,a.b):o.clone(),c="string"==typeof s?r.getColor(s).clone():(new rl).setRGB(s.r,s.g,s.b);if(l.equals(c))return;let h=o.clone();return{update:t=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,t)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function KG(e,t,i,n,r){if(!e.hasValue(n)||!(n in i))return;let a=t?t[n]:void 0,s=i[n],o=e.getValue(n),l=a?"string"==typeof a?r.getColor(a).clone():(new rl).setRGB(a.r,a.g,a.b):o.clone(),c="string"==typeof s?r.getColor(s).clone():new yI(s.r,s.g,s.b,s.a);if(l.equals(c))return;let h=o.clone();return{update:t=>{e.getValue(n)!==h&&e.setValue(n,h),h.lerpColors(l,c,t)},start:()=>{h.copy(l)},end:()=>{h.copy(c)}}}function ZG(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(!e.hasValue(n)||!(n in i))return;let r=[],a=e.getValue(n),s=t?t[n]:a,o=i[n];for(let l=0;l<a.length;++l){let e=s[l],t=o[l];e!==t&&r.push({update:i=>{a[l]=Uo.lerp(e,t,i)},start:()=>{a[l]=e},end:()=>{a[l]=t}})}return r.length?r:void 0}function JG(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"colors";if(!e.hasValue(n)||!(n in i))return;let r=[],a=e.getValue(n),s=t?t[n]:a.map((e=>e.toArray())),o=i[n];for(let l=0;l<a.length;++l){let e=[...s[l]],t=[...o[l]];yE.isEqual(e,t)||r.push({update:i=>{a[l].fromArray(yE.lerp(e,t,i))},start:()=>{a[l].fromArray(e)},end:()=>{a[l].fromArray(t)}})}return r.length?r:void 0}function $G(e,t,i){var n,r,a,s,o,l;let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"texture";if(!e.hasValue(c)||!(c in i))return;let h=e.getNode("rotation"),d=null!==(n=null===t||void 0===t||null===(r=t[c])||void 0===r?void 0:r.rotation)&&void 0!==n?n:0,u=null!==(a=null===(s=i[c])||void 0===s?void 0:s.rotation)&&void 0!==a?a:0;if(h&&d!==u)return{update:e=>{h.value=Uo.lerp(d,u,e)*Uo.DEG2RAD},start:()=>{h.value=d*Uo.DEG2RAD},end:()=>{h.value=u*Uo.DEG2RAD}};let p=e.getNode("mat");if(!p)return;let f=t?t[c]:p,m=i[c],g=[...f.repeat],v=[...f.offset],y=[...m.repeat],b=[...m.offset],x=null!==(o=f.rotation)&&void 0!==o?o:0,w=null!==(l=m.rotation)&&void 0!==l?l:0;return mE.isEqual(g,y)&&mE.isEqual(v,b)&&x===w?void 0:{update:e=>{p.repeat=mE.lerp(g,y,e),p.offset=mE.lerp(v,b,e),p.rotation=Uo.lerp(x,w,e),p.updateMatrix()},start:()=>{p.repeat=[...g],p.offset=[...v],p.rotation=x,p.updateMatrix()},end:()=>{p.repeat=[...y],p.offset=[...b],p.rotation=w,p.updateMatrix()}}}var eH=new gl,tH=new ic;function iH(e,t,i,n,r){var a,s,o,l,c,h,d,u,p,f,m,g,v,y,b,x,w,_;let S,A,E,C,M,P,T,D,R=[];if(e instanceof rU?(S=UG("position",e,t,i,r),S&&R.push(S),E=LG("rotation",e,t,i,r),E&&R.push(E),C=UG("shear",e,t,i,r),C&&R.push(C)):(D={slide:null!==(a=null!==(s=null!==(o=null===(l=t.pathSnapping)||void 0===l?void 0:l.slide)&&void 0!==o?o:null===(c=e.updatedPathSnapping)||void 0===c?void 0:c.slide)&&void 0!==s?s:null===(h=e.dataPatched.pathSnapping)||void 0===h?void 0:h.slide)&&void 0!==a?a:0,offset:null!==(d=null!==(u=null!==(p=null===(f=t.pathSnapping)||void 0===f?void 0:f.offset)&&void 0!==p?p:null===(m=e.updatedPathSnapping)||void 0===m?void 0:m.offset)&&void 0!==u?u:null===(g=e.dataPatched.pathSnapping)||void 0===g?void 0:g.offset)&&void 0!==d?d:0},P=LG("slide",D,null!==(v=null!==(y=t.pathSnapping)&&void 0!==y?y:e.updatedPathSnapping)&&void 0!==v?v:e.dataPatched.pathSnapping,null!==(b=i.pathSnapping)&&void 0!==b?b:e.dataPatched.pathSnapping,r),P&&R.push(P),T=LG("offset",D,null!==(x=null!==(w=t.pathSnapping)&&void 0!==w?w:e.updatedPathSnapping)&&void 0!==x?x:e.dataPatched.pathSnapping,null!==(_=i.pathSnapping)&&void 0!==_?_:e.dataPatched.pathSnapping,r),T&&R.push(T),!P&&!T&&(S=NG("position",e,t,i,r),S&&R.push(S),A=NG("scale",e,t,i,r),A&&R.push(A),E=function(e,t,i,n,r){var a;let s=null!==t&&void 0!==t&&t.rotation?t.rotation.map((e=>{var t;return("string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e)*Uo.DEG2RAD})):void 0,o=null===(a=i.rotation)||void 0===a?void 0:a.map((e=>{var t;return("string"==typeof e?Number(null!==(t=r.getVariable(e))&&void 0!==t?t:0):e)*Uo.DEG2RAD}));if(!o)return;let l=s?(new gl).fromArray(s):(new gl).setFromEuler(e.rotation),c=(new gl).fromArray(o);if(l.equals(c))return;let h=eH.subVectors(c,l);if(n&&h.toArray().every((e=>Math.abs(e)<2*Math.PI))){let t=(new ml).setFromEuler(tH.setFromVector3(l)),i=(new ml).setFromEuler(tH.setFromVector3(c));return{update:n=>{!function(e,t,i,n){if(0===n)return i.copy(e);if(1===n)return i.copy(t);let r=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(r>=1)return i.copy(e);let a=1-r*r;if(a<=Number.EPSILON){let r=1-n;return i.w=r*e.w+n*t.w,i.x=r*e.x+n*t.x,i.y=r*e.y+n*t.y,i.z=r*e.z+n*t.z,i.normalize(),i}let s=Math.sqrt(a),o=Math.atan2(s,r),l=Math.sin((1-n)*o)/s,c=Math.sin(n*o)/s;i.w=e.w*l+t.w*c,i.x=e.x*l+t.x*c,i.y=e.y*l+t.y*c,i.z=e.z*l+t.z*c}(t,i,e.quaternion,n)},start:()=>{e.rotation.setFromVector3(l)},end:()=>{e.rotation.setFromVector3(c)}}}return{update:t=>{eH.lerpVectors(l,c,t),e.rotation.setFromVector3(eH)},start:()=>{e.rotation.setFromVector3(l)},end:()=>{e.rotation.setFromVector3(c)}}}(e,t,i,n,r),E&&R.push(E),M=function(e,t,i,n){let r=i[e]?i[e]:void 0,a=n[e];if(!a)return;let s=t[e],o=r?(new ql).fromArray(r):s.clone(),l=new gl,c=new ml,h=new gl;o.decompose(l,c,h);let d=(new ql).fromArray(a),u=new gl,p=new ml,f=new gl;return d.decompose(u,p,f),o.equals(d)?void 0:{update:e=>{kG.slerpQuaternions(c,p,e),OG.lerpVectors(l,u,e),IG.lerpVectors(h,f,e),s.compose(OG,kG,IG)},start:()=>{s.compose(l,c,h)},end:()=>{s.compose(u,p,f)}}}("hiddenMatrix",e,t,i),M&&R.push(M))),S||A||E||M||P||T){let i=e instanceof rU?()=>{e.updateWorldMatrix(!0)}:()=>{var i;e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),null!==(i=e.parent)&&void 0!==i&&i.matrixWorldFusedFalse&&(e.matrixWorld.multiplyMatrices(e.parent.matrixWorldFusedFalse,e.matrix),e.matrixWorldNeedsUpdate=!1),WB(e)&&qB(e.parent)&&e.invalidateDownstreamBooleanData(!0),e.updatePathSnapping(Object.assign({},t.pathSnapping,D))};R.push({update:i,start:i,end:i})}return R}function nH(e,t,i,n){let r=[];if(!("cloner"in i)||!e.cloner)return r;let a=e.cloner,s="cloner"in t?t.cloner:{},o=i.cloner;KE.forEach((e=>{let t;t="count"===e?LG("count",a.parameters,s,o,n,!0):VG(e,a.parameters,null!==s&&void 0!==s?s:{},o,n),t&&r.push(t)}));let l=function(e,t,i,n){if("radial"!==e.parameters.type)return;let r=t.radial,a=i.radial;if(!a)return;let s=e.parameters.radial,o=[];return ZE.forEach((e=>{let t=VG(e,s,null!==r&&void 0!==r?r:{},a,n);t&&o.push(t)})),o}(a,s,o,n);(null===l||void 0===l?void 0:l.length)&&r.push(...l);let c=function(e,t,i,n){if("linear"!==e.parameters.type)return;let r=t.linear,a=i.linear;if(!a)return;let s=[],o=e.parameters.linear;return JE.forEach((e=>{let t=VG(e,o,null!==r&&void 0!==r?r:{},a,n);t&&s.push(t)})),s}(a,s,o,n);(null===c||void 0===c?void 0:c.length)&&r.push(...c);let h=function(e,t,i,n){if("grid"!==e.parameters.type)return;let r=t.grid,a=i.grid;if(!a)return;let s=[],o=e.parameters.grid;return $E.forEach((e=>{let t;t="count"===e?FG(e,o,null!==r&&void 0!==r?r:{},a,n,!0):VG(e,o,null!==r&&void 0!==r?r:{},a,n),t&&s.push(t)})),s}(a,s,o,n);(null===h||void 0===h?void 0:h.length)&&r.push(...h);let d=function(e,t,i,n){if("toObject"!==e.parameters.type)return;let r=t.toObject,a=i.toObject;if(!a)return;let s=[],o=e.parameters.toObject;return eC.forEach((e=>{let t;t="count"===e?LG(e,o,null!==r&&void 0!==r?r:{},a,n,!0):VG(e,o,null!==r&&void 0!==r?r:{},a,n),t&&s.push(t)})),s}(a,s,o,n);(null===d||void 0===d?void 0:d.length)&&r.push(...d);let u=function(e,t,i,n){if(!e.parameters.randomness)return;let r=t.randomnessObject,a=i.randomnessObject;if(!a)return;let s=[],o=e.parameters.randomnessObject;return tC.forEach((e=>{let t=VG(e,o,null!==r&&void 0!==r?r:{},a,n);t&&s.push(t)})),s}(a,s,o,n);return null!==u&&void 0!==u&&u.length&&r.push(...u),r.length&&r.push({update:()=>{a.update()}}),r}function rH(e,t,i,n,r){let a,s,o,l,c,h,d,u,p,f,m,g,v,y,b,x=[];if("width"in e&&(a=LG("width",e,t,i,r),a&&x.push(a)),"height"in e&&(s=LG("height",e,t,i,r),s&&x.push(s)),e instanceof DU||e instanceof LU){let n={...t.fill},a={...i.fill};void 0!==n.enabled&&n.enabled!==a.enabled&&(x.push(function(e,t){return{update:()=>{e instanceof DU&&(e.fill.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),a.enabled||Object.assign(a,{enabled:!0,color:{...a.color,a:0}})),o=jG("color",e.fill,n,a,r),o&&x.push(o)}if(e instanceof DU){let n={...t.stroke},a={...i.stroke};(n.enabled||a.enabled)&&(x.push(function(e,t){return{update:()=>{e instanceof DU&&(e.stroke.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),a.enabled||Object.assign(a,{enabled:!0,color:{...a.color,a:0}})),l=jG("color",e.stroke,n,a,r),l&&x.push(l),c=LG("thickness",e.stroke,n,a,r),c&&x.push(c)}if(e instanceof DU){let n={...t.dropShadow},a={...i.dropShadow};(n.enabled||a.enabled)&&(x.push(function(e,t){return{update:()=>{e instanceof DU&&(e.dropShadow.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),a.enabled||Object.assign(a,{enabled:!0,color:{...a.color,a:0}})),h=jG("color",e.dropShadow,n,a,r),h&&x.push(h),d=LG("blurRadius",e.dropShadow,n,a,r),d&&x.push(d),p=LG("spread",e.dropShadow,n,a,r),p&&x.push(p),u=UG("offset",e.dropShadow,n,a,r),u&&x.push(u)}if(e instanceof DU){let n={...t.innerShadow},a={...i.innerShadow};(n.enabled||a.enabled)&&(x.push(function(e,t){return{update:()=>{e instanceof DU&&(e.innerShadow.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,color:{...n.color,a:0}}),a.enabled||Object.assign(a,{enabled:!0,color:{...a.color,a:0}})),f=jG("color",e.innerShadow,n,a,r),f&&x.push(f),m=LG("blurRadius",e.innerShadow,n,a,r),m&&x.push(m),v=LG("spread",e.innerShadow,n,a,r),v&&x.push(v),g=UG("offset",e.innerShadow,n,a,r),g&&x.push(g)}if(e instanceof DU||e instanceof LU){let n={...t.backgroundBlur},a={...i.backgroundBlur};(n.enabled||a.enabled)&&(x.push(function(e,t){return{update:()=>{e instanceof DU&&(e.backgroundBlur.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,radius:0}),a.enabled||Object.assign(a,{enabled:!0,radius:0})),y=LG("radius",e.backgroundBlur,n,a,r),y&&x.push(y)}if(e instanceof DU){let n={...t.layerBlur},a={...i.layerBlur};(n.enabled||a.enabled)&&(x.push(function(e,t){return{update:()=>{e instanceof DU&&(e.layerBlur.enabled=t)}}}(e,!0)),n.enabled||Object.assign(n,{enabled:!0,radius:0}),a.enabled||Object.assign(a,{enabled:!0,radius:0})),b=LG("radius",e.layerBlur,n,a,r),b&&x.push(b)}if(e instanceof LU||e instanceof OU){let n=FG("cornerRadius",e,t,i,r);n&&x.push(n)}return x}function aH(e,t,i,n,r){let a=[];return e.data.visible&&a.push(...iH(e,t,i,r,n)),e instanceof rU?a.push(...rH(e,t,i,0,n)):(e.data.visible&&a.push(...nH(e,t,i,n)),WB(e)?(e instanceof DF&&e.data.visible&&a.push(...GG(e,t,i,n)),e.data.visible&&a.push(...function(e,t,i,n){let r=[];if(Array.isArray(e.material)){if(!("materials"in i)||!i.materials)return r;let a="materials"in t&&t.materials?t.materials:[],s=i.materials;e.material.forEach(((e,t)=>{var i;if(!s[t])return;let o=null!==(i=a[t])&&void 0!==i?i:{},l=s[t];"string"==typeof o||"string"==typeof l||r.push(...WG(e,o,l,n))}))}else{if(!("material"in i)||!i.material)return r;let a="material"in t&&t.material?t.material:{},s=i.material;if("string"==typeof a||"string"==typeof s)return r;r.push(...WG(e.material,a,s,n))}return r}(e,t,i,n))):(e=>VB.is(e))(e)?e.data.visible&&a.push(...HG(e,t,i,n)):(e=>e instanceof NB)(e)&&a.push(...function(e,t,i,n){var r,a,s,o;let l=[],c="OrthographicCamera"===e.cameraType?null===(r=t.orthographic)||void 0===r?void 0:r.zoom:null===(a=t.perspective)||void 0===a?void 0:a.zoom,h="OrthographicCamera"===e.cameraType?null===(s=i.orthographic)||void 0===s?void 0:s.zoom:null===(o=i.perspective)||void 0===o?void 0:o.zoom;if(void 0!==h){let t=null!==c&&void 0!==c?c:e.zoom,i=h;t!==i&&l.push({update:n=>{e.zoom=Uo.lerp(t,i,n),e.updateProjectionMatrix()},start:()=>{e.zoom=t,e.updateProjectionMatrix()},end:()=>{e.zoom=i,e.updateProjectionMatrix()}})}if(void 0!==i.targetOffset){let r=LG("targetOffset",e,t,i,n);r&&l.push(r)}return l}(e,t,i,n))),a.length?{update:e=>{a.forEach((t=>t.update(e)))},start:e=>{a.forEach((t=>{var i;return null===(i=t.start)||void 0===i?void 0:i.call(t,e)}))},end:e=>{a.forEach((t=>{var i;return null===(i=t.end)||void 0===i?void 0:i.call(t,e)}))}}:void 0}var sH=new gl;function oH(e,t){var i;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[],a=i=>{let n=i.data;delete i.states,i.currentState=null,i.reversibleToState=null,i.currentTransitionEvent=null;for(let e of n.states){let t={...e.data};i.states||(i.states={}),i.states[e.id]=CM.patch(n,t)}cH(e.scene,i,null,t,void 0!==n.events.find((e=>"Follow"===e.data.type||"LookAt"===e.data.type))),lH(e)};e.scene.traverse2D(a),e.traverseChildren((i=>{var s,o,l,c,h,d;if(n&&(null!==(s=i.rigidBody)&&void 0!==s&&s.setTranslation(i.position0,!0),null!==(o=i.rigidBody)&&void 0!==o&&o.setRotation(i.rotation0,!0),null!==(l=i.rigidBody)&&void 0!==l&&l.setLinvel(sH,!0),null!==(c=i.rigidBody)&&void 0!==c&&c.setAngvel(sH,!0)),!AT.is(i))return;let u=i.uuid,p=i.data;if(delete i.states,i.uuid===LE)return;let f=!1;r.some((t=>{var i;return null===(i=e.scene.find(u))||void 0===i?void 0:i.isDescendantOf(t)}))?f=!0:!0===(null===(h=p.physics)||void 0===h?void 0:h.fusedBody)&&"dynamic"===p.physics.rigidBody&&r.push(u),i.data=p,i.currentState=null,i.reversibleToState=null,i.currentTransitionEvent=null;for(let t of p.states){let n={...t.data};!0===e.data.globalPhysics.usePhysics&&p.physics&&("dynamic"===p.physics.rigidBody||f)&&(void 0!==t.data.position&&delete n.position,void 0!==t.data.rotation&&delete n.rotation,void 0!==t.data.hiddenMatrix&&delete n.hiddenMatrix),i.states||(i.states={}),i.states[t.id]=NC.patch(p,n)}cH(e.scene,i,null,t,void 0!==p.events.find((e=>"Follow"===e.data.type||"LookAt"===e.data.type))),lH(e),i instanceof ij&&i.frame&&(i.frame.traverse((e=>a(e))),null===(d=i.uiCanvas)||void 0===d||d.applySize())})),e.frame&&(e.frame.traverse((e=>a(e))),null===(i=e.uiCanvas)||void 0===i||i.applySize())}function lH(e){e.traverseEntity((t=>{for(let i of t.data.events){let t=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":t.push(...i.data.actions);break;case"GameControl":for(let e of Object.values(i.data.gameActions))t.push(...e);break;case"DragDrop":t.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":t.push(...i.data.inActions,...i.data.outActions)}for(let i of t)if("Create"===i.data.type&&"Yes"===i.data.hideBase){let t=e.scene.find(i.data.object);t&&(t.visible=!1)}}}))}function cH(e,t,i,n){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t instanceof DF&&t.removeInteractionGeometry(n),t instanceof rU?t.changeSelectedState(i,{shared:n},r):t.changeSelectedState(i,{scene:e,shared:n},r),t instanceof DF&&t.updateGeometryGroupsIfNeeded(),t instanceof NB&&t.updateCameraState(t.dataPatched,{scene:e,shared:n}),!(t instanceof rU)){if(t.cloner)for(let e of t.cloner.children)e.playModeVisible=void 0;t.updateVisible()}}function hH(e){let t;if(5===e.easing){let{control1:i,control2:n}=e;t="cubicBezier(\n\t\t\t".concat(i[0],", ").concat(i[1],", ").concat(n[0],", ").concat(n[1],"\n\t\t)")}else if(6===e.easing){let{mass:i,stiffness:n,damping:r,velocity:a}=e;t="spring( ".concat(i,", ").concat(n,", ").concat(r,", ").concat(a," )")}else{let i;switch(e.easing){case 0:default:i=TE.linear;break;case 1:i=TE.ease;break;case 2:i=TE.easeIn;break;case 3:i=TE.easeOut;break;case 4:i=TE.easeInOut}let[n,r,a,s]=i;t="cubicBezier( ".concat(n,", ").concat(r,", ").concat(a,", ").concat(s," )")}return{duration:Math.max(e.duration,1e-4),easing:t}}function dH(e){let t={delay:0,loop:-1===e.repeat||e.repeat+1};if(0===e.repeat)t.direction="normal",t.rewind=!1;else switch(e.direction){case"pingpong":t.direction="alternate",t.rewind=!1;break;case"pingpong-rewind":t.direction="alternate",t.rewind=!0;break;default:t.direction="normal",t.rewind=!1}switch(t.delay=0,t.endDelay=0,t.startOnceDelay=0,t.pingPongDelayCorrection=0,t.pingPongEndDelayCorrection=0,e.delayDirection){case"start-once":t.startOnceDelay=e.delay;break;case"start":t.delay=e.delay;break;case"end":t.endDelay=e.delay;break;case"start-end":case void 0:t.delay=e.delay,t.endDelay=e.delay}return"alternate"===t.direction&&(t.delay/=2,t.endDelay/=2,"start"===e.delayDirection?(t.pingPongDelayCorrection=t.delay,"number"==typeof t.loop&&t.loop%2===0&&(t.pingPongEndDelayCorrection=t.delay)):"end"===e.delayDirection?"number"==typeof t.loop&&t.loop%2!==0&&(t.pingPongEndDelayCorrection=t.endDelay):"start-end"===e.delayDirection&&(t.pingPongDelayCorrection=t.delay,t.pingPongEndDelayCorrection=t.endDelay)),t}var uH={type:"beginState"},pH={type:"completeState",isfromEntity:!1},fH=class{constructor(e,t,i,n,r,a){if(this.object=e,this.data=n,this.sharedAssets=r,this.allowSlerp=a,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),0===this.targets.t||1===this.targets.t?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let e=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=e,this.object.dispatchEvent({type:"beginState",state:e}),this.object instanceof rU||this.object.traverseEntity((e=>{e!==this.object&&e instanceof NB&&e.dispatchEvent(uH)}))},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let e=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=e,this.object.dispatchEvent({type:"completeState",state:e}),this.object instanceof rU||this.object.traverseEntity((e=>{e!==this.object&&e instanceof NB&&e.dispatchEvent(pH)}))},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=aH(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},void 0===t){let e=gH(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!e)throw new Error("Missing property");this.from=e}else{let e=gH(this.object,t);if(!e)throw new Error("Missing property");this.from=e}if(void 0===i)throw new Error("Missing property");{let e=gH(this.object,i);if(!e)throw new Error("Missing property");this.to=e}this.useCurrentState=void 0===t||void 0===i,this.params={targets:this.targets,t:1,autoplay:!1,...dH(n),...hH(n),change:this.onChange},this.callback=aH(this.object,void 0===t?{}:this.from.data,void 0===i?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},mH=class extends Co{constructor(e,t,i,n){var r,a,s;if(super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.onTimelineChangeComplete=()=>{var e;"normal"!==this.data.tweens[0].data.direction&&(this.toggleIsForward=!this.toggleIsForward),!1!==this.timelineNeedsRebuild&&(null!==(e=this.timeline)&&void 0!==e&&e.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let o=null!==(r=null!==(a=this.page.scene.find(e.object))&&void 0!==a?a:null===(s=this.page.uiCanvas)||void 0===s?void 0:s.find(e.object))&&void 0!==r?r:this.page.scene.find2DInUIObjects(e.object);if(!o)throw new Error("Missing property");if(!o.states)throw new Error("Missing property");if(this.object=o,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay="start-once"===e.tweens[0].data.delayDirection?e.tweens[0].data.delay:0,this.init()}get playing(){var e;return!1===(null===(e=this.timeline)||void 0===e?void 0:e.paused)}get changeBegan(){var e;return null!==(e=this.tweens.some((e=>e.changeBegan)))&&void 0!==e&&e}init(){this.initialCurrentState=gH(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return"Toggle"===this.data.runMode?this.initialCurrentState:this.object.currentState}buildTimeline(){var e;let{isForward:t=!0,needsRebuild:i=!1,isRebuild:n=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var r;let e=dH(this.data.tweens[0].data);n&&"number"==typeof e.loop&&e.loop--,null!==(r=this.timeline)&&void 0!==r&&r.pause(),this.timeline=RG.timeline({autoplay:!1,...e,...!0===e.loop||e.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let c=this.tweens.findIndex((e=>null===e||void 0===e?void 0:e.changeBegan));if(!0===i&&(this.timelineNeedsRebuild=!0),t){let t=-1===c?0:c;for(let i=t;i<this.data.tweens.length-1;i++){var a,s;let n,r=this.data.tweens[i],o=this.data.tweens[i+1];i!==t||!0!==this.object.wasMovedByUser&&!0!==(null===(a=this.object.previousAction)||void 0===a?void 0:a.changeBegan)?n=void 0===r.data.state?this.currentState:r.data.state:(n=void 0,this.object instanceof NB&&(this.object.wasMovedByUser=!1));let l=new fH(this.object,n,void 0===o.data.state?this.currentState:o.data.state,o.data,this.shared,null!==(s=this.data.allowSlerp)&&void 0!==s&&s);-1!==c&&i===t&&Object.assign(l.params,{startOnceDelay:0}),this.tweens[i]=l,this.timeline.add(l.params,this.timeline.duration+(i===t?e.delay:0))}this.timeline.duration+=e.endDelay}else{let t=-1===c?this.data.tweens.length-1:c+1;for(let i=t;i>0;i--){var o,l;let n,r=this.data.tweens[i],a=this.data.tweens[i-1];i!==t||!0!==this.object.wasMovedByUser&&!0!==(null===(o=this.object.previousAction)||void 0===o?void 0:o.changeBegan)?n=void 0===r.data.state?this.currentState:r.data.state:(n=void 0,this.object instanceof NB&&(this.object.wasMovedByUser=!1));let s=new fH(this.object,n,void 0===a.data.state?this.currentState:a.data.state,r.data,this.shared,null!==(l=this.data.allowSlerp)&&void 0!==l&&l);-1!==c&&i===t&&Object.assign(s.params,{startOnceDelay:0}),this.tweens[i-1]=s,this.timeline.add(s.params,this.timeline.duration+(i===t?e.endDelay:0))}this.timeline.duration+=e.delay}}catch(DE){DE instanceof Error&&console.error(DE.message)}!0===(null===(e=this.object.previousAction)||void 0===e?void 0:e.playing)&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(!1===EH(this.shared,this.condition)||this.playing)return!1;clearTimeout(this.timeoutId);let e=dH(this.data.tweens[0].data).pingPongDelayCorrection;this.timeoutId=window.setTimeout((()=>{try{this.buildTimeline(),this.timeline.play()}catch(W_){W_ instanceof Error&&console.error(W_.message)}}),this.startOnceDelay+e)}pause(){var e;null!==(e=this.timeline)&&void 0!==e&&e.pause(),clearTimeout(this.timeoutId),this.tweens=Array(this.data.tweens.length-1),delete this.timeoutId}stop(){this.pause();let e=void 0===this.data.tweens[0].data.state?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof rU?this.object.changeSelectedState(e,{shared:this.shared}):this.object.changeSelectedState(e,{scene:this.page.scene,shared:this.shared}),this.object.currentState=e}seek(e){var t;void 0===this.timeline&&this.buildTimeline(),null===(t=this.timeline)||void 0===t||t.seek(e*this.timeline.duration,!0)}toggle(e){var t;if(!1===EH(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward,this.playing?(null!==(t=this.timeline)&&void 0!==t&&t.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):this.timeoutId=window.setTimeout((()=>{var e;null!==(e=this.timeline)&&void 0!==e&&e.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function gH(e,t){var i;let n,r;if("string"==typeof t?(n=t,r=null===(i=e.states)||void 0===i?void 0:i[n]):null===t&&(n=null,r=e.data),void 0!==n&&void 0!==r)return{id:n,data:r}}var vH={type:"beginState"},yH={type:"completeState",isfromEntity:!1},bH={type:"requestRender"},xH=class extends Co{constructor(e,t,i,n){super(),this.data=e,this.page=t,this.shared=i,this.condition=n,this.toggleIsForward=!1,this.posStart=new gl,this.posEnd=new gl,this.qStart=new ml,this.qEnd=new ml,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let t={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=RG({targets:t,t:1,...hH(this.data),update:()=>{0===t.t&&("Toggle"!==this.data.runMode||this.toggleIsForward?(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)):(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)),this.page.activeCamera.dispatchEvent(vH));let i=this.page.activeCamera;i.position.lerpVectors(this.posStart,this.posEnd,t.t),i.quaternion.slerpQuaternions(this.qStart,this.qEnd,t.t),i.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*t.t,i.wasMovedBySwitchCameraAction=!0,i.updateMatrix(),i.updateMatrixWorld(),i.updateProjectionMatrix(),i.dispatchEvent(bH),1===t.t&&i.dispatchEvent(yH)}})}switchCamera(e){let t=this.page.activeCamera,i=this.page.scene.find(e);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),t.dispatchEvent({type:"cameraChange",camera:i})}play(){if(!1===EH(this.shared,this.condition))return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{var e;delete this.timeoutId,this.data.animate?(this.buildAnimation(),null===(e=this.animation)||void 0===e||e.play()):this.switchCamera(this.data.targetCamera)}),1e3*this.data.delay)}catch{}}pause(){var e;null!==(e=this.animation)&&void 0!==e&&e.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(e){if(!1===EH(this.shared,this.condition))return!1;clearTimeout(this.timeoutId),this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward;try{var t,i;this.playing?(null!==(t=this.animation)&&void 0!==t&&t.pause(),this.buildAnimation(!0),null===(i=this.animation)||void 0===i||i.play()):this.timeoutId=window.setTimeout((()=>{var e,t;delete this.timeoutId,this.data.animate?(null!==(e=this.animation)&&void 0!==e&&e.pause(),this.buildAnimation(),null===(t=this.animation)||void 0===t||t.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(yH),this.page.activeCamera.dispatchEvent(bH))}),1e3*this.data.delay)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},wH=class extends Co{constructor(e,t,i,n,r){var a,s,o,l;super(),this.data=e,this.page=t,this.animationControls=i,this.shared=n,this.condition=r,this.startOnceDelay=0,this.toggleIsForward=!1;let c=e.object,h=t.scene.find(e.object);h&&Array.isArray(h.identity)&&(c=h.identity[0]),this.data={...e,object:c};let d=this.animationControls.clipIdToAction[e.clipId+"/"+c];this.duration=null!==(a=null===d||void 0===d||null===(s=d.getClip())||void 0===s?void 0:s.duration)&&void 0!==a?a:1;let u=null!==(o=null===d||void 0===d||null===(l=d.getClip())||void 0===l||null===(l=l.tracks[0])||void 0===l?void 0:l.times.length)&&void 0!==o?o:1/0;this.leftFrameTime=this.data.crop[0]/u*this.duration,this.rightFrameTime=this.data.crop[1]/u*this.duration,this.startOnceDelay=e.delay}get playing(){var e,t;return null!==(e=null===(t=this.threeAnimAction)||void 0===t?void 0:t.isRunning())&&void 0!==e&&e}play(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===EH(this.shared,this.condition))return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{var t;if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let i=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach((t=>{let[n,r]=t,a=n.split("/")[1];this.threeAnimAction!==r&&a===i&&r.isRunning()&&(e?r.fadeOut(.2):r.stop())})),e&&(null===(t=this.threeAnimAction)||void 0===t||t.fadeIn(.2))}),this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){var e;null===(e=this.threeAnimAction)||void 0===e||e.fadeOut(.2)}seek(e){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Uo.clamp(this.threeAnimAction.time+1/60*e,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===EH(this.shared,this.condition))return!1;this.toggleIsForward=null!==e&&void 0!==e?e:!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout((()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){var e;this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach((e=>{let[n,r]=e,a=n.split("/")[1];this.threeAnimAction!==r&&a===i&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())})),t&&(null===(e=this.threeAnimAction)||void 0===e||e.fadeIn(.2))}}),this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){var e;let t=null===(e=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object])||void 0===e?void 0:e.getClip();t&&(t.duration=this.duration),this.pause()}},_H=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.eventManager=i,this.shared=n,this.condition=r,this.timeOutId=-1,this.scene=t.scene}dispatch(){if(!1===EH(this.shared,this.condition))return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout((()=>{this.play()}),1e3*this.data.delay))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every((e=>e.uuid!==this.data.target)))return;"fade"===this.data.transition&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,1e3*this.data.duration),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let e=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity((e=>{"ParticleSystem"===e.type&&(e.sleep(),e.wakeUp(),e.data.autoPlay?e.start():e.stop())})),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(e),oH(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},SH=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=EH(this.shared,this.condition)}dispatch(){if(!1===this.evaluatedCondition)return!1;let e=this.shared.getVariable(this.data.variableId),t=cO(this.data.expression,this.shared,XC.typeOfVariable(e));void 0!==t&&this.shared.updateVariable(this.data.variableId,"string"==typeof t?{textValue:t}:t)}dispose(){}},AH=class{constructor(e,t,i,n){this.data=e,this.page=t,this.shared=i,this.condition=n,this.timeoutId=null}dispatchInner(){if(!1===EH(this.shared,this.condition))return!1;let e=this.shared.getDynamicVariablePlayState(this.data.variableId);if("PlayPause"===this.data.mode)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"===e?"Paused":"Playing");else if("Play"===this.data.mode&&"Playing"!==e)void 0===this.shared.getDynamicVariableToggleIsForward(this.data.variableId)&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if("Stop"===this.data.mode&&"Stopped"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if("Pause"===this.data.mode&&"Paused"!==e)this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if("Restart"===this.data.mode)this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if("Toggle"===this.data.mode){let t=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);"Playing"===e?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,void 0!==t&&!t):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!t),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let e=this.data.delay,t=this.shared.getDynamicVariablePlayState(this.data.variableId);"PlayPause"===this.data.mode&&"Playing"===t&&(e=this.data.pauseDelay),0!==e?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout((()=>{this.timeoutId=null,this.dispatchInner()}),e)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}};function EH(e,t){if(void 0===t)return!0;if(0===t.expression.length)return!1;let i=cO(t.expression,e,"boolean");return t.negate?!i:!!i}function CH(e,t,i,n,r,a){let s={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[]},o=t=>l=>{let{id:c,data:h}=l;try{"Audio"===h.type?fE[e.type].includes("Audio")&&s.Audio.push(new _V(c,h,a,n,t)):"Video"!==h.type||a instanceof rU?"Particles"===h.type?fE[e.type].includes("Particles")&&s.Particles.push(new SV(h,i,n,t)):"Link"===h.type?fE[e.type].includes("Link")&&s.Link.push(new CV(h,r.controlsManager,n,t)):"Create"===h.type?fE[e.type].includes("Create")&&s.Create.push(new NH(h,i,r.controlsManager,n,t)):"Destroy"===h.type?fE[e.type].includes("Destroy")&&s.Destroy.push(new MV(h,i,r.controlsManager,n,t)):"Reset"===h.type?fE[e.type].includes("Reset")&&s.Reset.push(new PV(h,i,n,r,t)):"Transition"===h.type?fE[e.type].includes("Transition")&&s.Transition.push(new mH(h,i,n,t)):"SwitchCamera"===h.type?fE[e.type].includes("SwitchCamera")&&s.SwitchCamera.push(new xH(h,i,n,t)):"SceneTransition"===h.type?fE[e.type].includes("SceneTransition")&&s.SceneTransition.push(new _H(h,i,r,n,t)):"Animation"===h.type?fE[e.type].includes("Animation")&&s.Animation.push(new wH(h,i,r.animationControls,n,t)):"SetVariable"===h.type?fE[e.type].includes("SetVariable")&&s.SetVariable.push(new SH(h,i,n,t)):"DynamicVariablePlay"===h.type?fE[e.type].includes("DynamicVariablePlay")&&s.DynamicVariablePlay.push(new AH(h,i,n,t)):"Conditional"===h.type&&fE[e.type].includes("Conditional")&&(h.ifActions.forEach(o({expression:h.condition,negate:!1})),h.elseActions.forEach(o({expression:h.condition,negate:!0}))):fE[e.type].includes("Video")&&s.Video.push(new OH(c,h,a,n,t))}catch(SE){}};return t.forEach(o()),s}function MH(e){Object.values(e).forEach((e=>{e.forEach((e=>{(e instanceof _V||e instanceof OH||e instanceof SV||e instanceof wH||e instanceof mH||e instanceof NH||e instanceof MV||e instanceof xH||e instanceof _H||e instanceof PV||e instanceof SH||e instanceof AH)&&e.dispose()}))}))}var PH=new Map,TH=new Map,DH=class{constructor(e,t,i){this.data=t,this.delay=0,this.status="stopped";let{layerId:n,loop:r,volume:a,delay:s}=t;if(this.object=i,void 0===n)throw new Error("Missing property");let o=function(e,t){let i;if("material"in e){let n=e.material;i=Array.isArray(n)?e.material[0].layers.find((e=>e.uuid===t)):e.material.layers.find((e=>e.uuid===t))}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}(i,n);o&&(this.videoElement=o,this.videoElement.loop=r===1/0,s_&&(this.videoElement.autoplay=!0),void 0!==a&&(this.videoElement.volume=a)),void 0!==s&&(this.delay=s),TH.has(i.uuid)?TH.get(i.uuid).push(this):TH.set(i.uuid,[this]),PH.set(e,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(e){if(!this.videoElement)return;let t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);e?(this.mute(),this.delay+=150):t?(this.mute(),window.setTimeout((()=>{this.unMute()}),100)):this.unMute(),this.delayTimerId=window.setTimeout((()=>{if(!this.videoElement)return;let e=this.videoElement.play();void 0!==e&&e.then((e=>{})).catch((e=>{this.play()})),this.clearDelay()}),this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}playByToggle(){"stop"===this.data.toggle?"playing"===this.status?this.stop():(this.stop(),this.play()):"pause"===this.data.toggle?"playing"===this.status?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},RH=class{constructor(e){this.data=e}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(e){let t=PH.get(e);!t||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t[this.data.interaction](),this.disposeDelay()}),this.data.delay)):t[this.data.interaction]())}pauseAllVideosFromObject(e){let t=TH.get(e);null===t||void 0===t||!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{t.forEach((e=>e[this.data.interaction]())),this.disposeDelay()}),this.data.delay)):t.forEach((e=>e[this.data.interaction]())))}pauseAllVideos(){let e=[...TH.values()];!e.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout((()=>{e.forEach((e=>{e.forEach((e=>{e[this.data.interaction]()}))})),this.disposeDelay()}),this.data.delay)):e.forEach((e=>{e.forEach((e=>{e[this.data.interaction]()}))})))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},OH=class{constructor(e,t,i,n,r){if(this.data=t,this.shared=n,this.condition=r,"play"===t.interaction)this.interaction=new DH(e,t,i);else{if("pause"!==t.interaction&&"stop"!==t.interaction)throw new Error("Missing property");this.interaction=new RH(t)}}dispatchBasic(){if(!1===EH(this.shared,this.condition))return!1;this.interaction instanceof DH?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(!1===EH(this.shared,this.condition))return!1;this.interaction instanceof DH?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},IH=(()=>{let e,t,i,n;function r(i){var r;!e&&!kH()&&(null===(r=t)||void 0===r?void 0:r.sharedGameControlGlobals.createdObjects.length)>0&&(e=requestAnimationFrame(a)),i&&(t=i,n=i.requestRender)}function a(r){let s=i?r-i:0,o=t.sharedGameControlGlobals.createdObjects,l=t.sharedGameControlGlobals.nCreatedPerAction,c=o.length,h=0;for(;h<c;){let e=o[h];void 0===e.userData.createdTime&&(e.userData.createdTime=r),void 0===e.userData.lifetime&&void 0===e.userData.quantity||e.userData.lifetime&&r-e.userData.createdTime<e.userData.lifetime||e.userData.quantity&&l[e.userData.actionId]<=e.userData.quantity?(e.userData.velocity&&(e.position.addScaledVector(e.userData.velocity,s/1e3),e.updateMatrix(),n()),h++):(l[e.userData.actionId]>e.userData.quantity&&l[e.userData.actionId]--,o.splice(h,1),e.removeFromParent(),t.sharedGameControlGlobals.rapierWorld&&e.rigidBody?(t.sharedGameControlGlobals.colliderToEntity.delete(e.rigidBody.collider(0).handle),t.sharedGameControlGlobals.rapierWorld.removeRigidBody(e.rigidBody)):(e.bvhGeometry=void 0,t.sharedGameControlGlobals.entitiesWithTransformAnim=t.sharedGameControlGlobals.entitiesWithTransformAnim.filter((e=>void 0!==e.bvhGeometry))),c--,n())}e=h>0?requestAnimationFrame(a):void 0,i=h>0?r:void 0}return typeof document<"u"&&document.addEventListener("visibilitychange",(function(){kH()?e&&(cancelAnimationFrame(e),e=void 0,i=void 0):r()})),r})();function kH(){return!!document&&document.hidden}var LH=new ml,FH=new gl,BH=new gl,NH=class{constructor(e,t,i,n,r){this.data=e,this.page=t,this.controlsManager=i,this.shared=n,this.condition=r,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Uo.generateUUID(),this.dispatch=()=>{if(!1===EH(this.shared,this.condition))return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay)):this.dispatchInner()},this.dispatchFromStart=()=>{if(!1===EH(this.shared,this.condition))return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,1e3*this.data.delay))},this.dispatchThrottled=i_(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{null===this.intervalId&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let e=new MT(this.object);if(e.playModeVisible=!0,e.expand(),"world"!==this.data.coordinateSystem){let t=this.data.coordinateSystem,i=this.page.scene.find(t);i&&(i.updateMatrixWorldSVD(),e.hiddenMatrix.copy(i.matrixWorldRigid))}e.scale.copy(this.object.scale),e.position.fromArray(this.data.position),e.rotation.fromArray(this.data.rotation),e.updateMatrix(),this.page.add(e);let t=this.controlsManager.sharedGameControlGlobals;t.createdObjects.push(e),void 0===t.nCreatedPerAction[this.uniqueId]?t.nCreatedPerAction[this.uniqueId]=1:t.nCreatedPerAction[this.uniqueId]++,e.updateWorldMatrix(!0,!0),e.traverseObject(this.traverseObjectCB),IH(),this.controlsManager.requestRender()},this.traverseObjectCB=e=>{var t,i,n;let r;if(e.hasNonUniformScale&&e.updateMatrixWorldSVD(),this.controlsManager.sharedGameControlGlobals.rapierWorld){var a;if(e instanceof bB){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;r=e.object}else if(e instanceof MT)r=e.object;else if(r=e,null!==(a=r.dataPatched.cloner)&&void 0!==a&&a.hideBase)return!0}else{if(e instanceof bB)return;r=e instanceof MT?e.object:e}"Time"===this.data.destroy?e.userData.lifetime=1e3*this.data.lifetime:"Quantity"===this.data.destroy&&(e.userData.quantity=this.data.destroyAfterQuantity,e.userData.actionId=this.uniqueId);let s=(new gl).fromArray(this.data.velocity),o=r.dataPatched;if(!("visibility"===o.physics.enabled?!o.visible:!o.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(e,r,{fromCreate:!0,dynamic:this.data.dynamic}),"Collision"===this.data.destroy&&(null!==(t=e.rigidBody)&&void 0!==t&&t.collider(0).setActiveEvents(1),e.userData.hasCollisionDestroy=!0),e.matrixWorld.decompose(FH,LH,BH),s.applyQuaternion(LH),this.data.velocity.some((e=>0!==e))&&this.data.dynamic&&(null===(i=e.rigidBody)||void 0===i||i.setLinvel(s.divideScalar(this.controlsManager.pixelsPerMeter),!0))):("geometry"in e.object&&this.controlsManager.addBoundsTree(e),this.data.velocity.some((e=>0!==e))&&this.data.dynamic&&(e.userData.velocity=s)),!0===(null===(n=r.dataPatched.physics)||void 0===n?void 0:n.fusedBody)))return!0};let a=this.page.scene.find(this.data.object);if(!a)throw new Error("Missing Property");if(this.object=a,"world"!==this.data.coordinateSystem&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");IH(i)}dispose(){null!==this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach((e=>window.clearTimeout(e))),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},zH=.02,UH=(new gl,new gl),jH=new gl,VH=new gl,GH=new gl,HH=new gl,WH=new gl,qH=new ql,XH=new ql,YH=new ql,QH=(new ql,new ml),KH=new ml,ZH=new ic(0,0,0,"YXZ"),JH=new gl(1,0,0),$H=new gl(0,1,0),eW=new gl(0,0,1),tW=new gl(1,1,1),iW=(new Bl,new ng),nW=new bl,rW={type:"requestRender"},aW={type:"updateMatrix"},sW=Math.PI/6,oW=class extends Co{constructor(e,t,i,n,r,a,s,o,l){var c,h,d,u,p,f,m,g,v,y,b,x,w,_,S,A,E,C,M;super(),this.object=e,this.domElement=t,this.data=i,this.gloabalPhysics=n,this.controlsManager=r,this.cameraFollow=a,this.camera=s,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new ql,this.target0=new gl,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=200,this.euler0=new ic(0,0,0,"YXZ"),this.position0Cam=new gl,this.quat0Cam=new ml,this.scale0Cam=new gl,this.hiddenMatrix0Cam=new ql,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new ng(new gl(0,-40,0),new gl(0,40,0)),matrix:new ql,position:new gl,rotation:new ml},this.euler=new ic(0,0,0,"YXZ"),this.eulerDelta=new gl,this.lastPosition=new gl,this.lastCameraQuaternion=new ml,this.lastCameraPosition=new gl,this.PI_2=Math.PI/2,this.prevMouse=new jo,this.velocityTarget=new gl,this.velocity=new gl,this.directionXZ=new gl,this.rotVelocityStick=new gl,this.rotVelocityTarget=new gl,this.rotVelocity=new gl,this.rotDirection=new gl,this.nonColliderRotOffset=new ql,this.nonColliderPosOffset=new ql,this.firstPointerId=-1,this.rot=new gl,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new ql,this.objectToTarget=new gl,this.objectToTarget0=new gl,this.objectToCamXZ=new gl,this.objectToCamXZ0=new gl,this.targetToCamera=new gl,this.targetToCamera0=new gl,this.cameraPolarAxis0=new gl,this.targetPos=new gl,this.targetQuat=new ml,this.lerpFactorPos=(new gl).setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new ml,this.objXZQuatInv=new ml,this.objXZRotMat=new ql,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new gl,this.pushedVelocity=new gl,this.groundYRotation=0,this.objectRealQuat=new ml,this.colliderWorldQuat=new ml,this.groundNormal=new gl,this.groundTilt=new ml,this.groundTiltInv=new ml,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new gl,this.quaternion=new ml,this.scale=new gl,this.initialAction=!0,this.onPointerDown=e=>{e.target!==this.domElement||-1!==this.firstPointerId||(this.firstPointerId=e.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),"keys"!==this.rotBy&&!l_&&!c_&&this.domElement.requestPointerLock(),this.prevMouse.set(e.clientX,e.clientY))},this.onPointerUp=e=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),"mouse"===e.pointerType&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=e=>{if(e.pointerId!==this.firstPointerId)return;let t=e.clientX-this.prevMouse.x,i=e.clientY-this.prevMouse.y;this.prevMouse.set(e.clientX,e.clientY),"mouse"===e.pointerType&&"keys"!==this.rotBy&&(c_&&h_<15.5&&!l_?(this.eulerDelta.y=-t*this.mouseOrbitSensitivity,this.eulerDelta.x=-i*this.mouseOrbitSensitivity):(this.eulerDelta.y=-e.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-e.movementY*this.mouseOrbitSensitivity)),"mouse"!==e.pointerType&&"drag"===this.rotByTouch&&(this.eulerDelta.y=-t*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-i*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=e=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?oW.isLocked=!0:oW.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{var e;if(null!==(e=document)&&void 0!==e&&e.hidden)for(let t in this.movementState)this.movementState[t]=0},this.onKeyDown=e=>{!(e.target instanceof HTMLInputElement)&&("ArrowLeft"===e.code||"ArrowUp"===e.code||"ArrowRight"===e.code||"ArrowDown"===e.code||"Space"===e.code)&&e.preventDefault();for(let t of this.keyAssignments)if(e.key.toUpperCase()===t[1]||e.key===t[1]){this.movementState[t[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=e=>{for(let t of this.keyAssignments)if(e.key.toUpperCase()===t[1]||e.key===t[1]||e.code.slice(3,e.code.length).toUpperCase()===t[1]){this.movementState[t[0]]=0;break}},this.copyVRGamePadValues=(e,t)=>{for(let i=2;i<4;i++){let n=e.axes[i];0===t?2===i?this.movementState.movePosX=n:this.movementState.movePosZ=n:(e.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,2===i?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(n)>=.3&&(this.vrEulerYOffset+=n<0?1:-1),this.movementState.rotPosY=n):"fly"===this.moveMode&&(this.movementState.moveNegY=n))}},this.sharedGameControlGlobals=r.sharedGameControlGlobals,e===s&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let P=this.euler0.clone(),T=P.y;if(this.objectRealQuat.copy(this.quaternion),P.y=0,this.quaternion.setFromEuler(P),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),P.set(0,T,0),this.quaternion.setFromEuler(P),this.rot.setFromEuler(P),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||!0===this.cameraFollow)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),!0===this.cameraFollow){var D;this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(null===(D=this.camera)||void 0===D?void 0:D.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let e,t,i=new gl(0,0,-1).applyQuaternion(this.camera.quaternion),n=(new gl).subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(n),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ),Math.abs(i.y)<1e-6?(n.y=0,i.y=0,t=n.projectOnVector(i)):t=n.y/i.y>0?i.multiplyScalar(n.y/i.y):i.multiplyScalar(n.length()),this.targetToCamera0.copy(t).negate(),e=this.camera.position.clone().add(t),this.objectToTarget0.subVectors(e,this.position);let r=(new ic).setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-r.x,r.x=0,r.z=0,r.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(r)}if(this.object instanceof NB&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=null!==(c=i.rotByTouch)&&void 0!==c?c:"joystick",this.rotBy=null!==(h=i.rotBy)&&void 0!==h?h:"keys",this.rotationMode=null!==(d=i.rotationMode)&&void 0!==d?d:"normal",this.moveMode=null!==(u=i.moveMode)&&void 0!==u?u:"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=1*(null!==(p=i.speedTranslate)&&void 0!==p?p:250),this.speedOrbit=.025*(null!==(f=i.speedRotate)&&void 0!==f?f:100),this.mouseOrbitSensitivity=16e-6*(null!==(m=i.speedRotate)&&void 0!==m?m:100),this.keyAssignments=i.keyAssignments.map((e=>{let t=[e[0],e[1]];return"\u25b2"===t[1]?t[1]="ArrowUp":"\u25c0"===t[1]?t[1]="ArrowLeft":"\u25bc"===t[1]?t[1]="ArrowDown":"\u25b6"===t[1]?t[1]="ArrowRight":"\u21e7"===t[1]?t[1]="Shift":"\u21b5"===t[1]?t[1]="Enter":"Space"===t[1]?t[1]=" ":"\u2318"===t[1]?t[1]="Meta":"Ctrl"===t[1]?t[1]="Control":"Esc"===t[1]&&(t[1]="Escape"),t})),"mouse"===i.rotBy){let e;e=this.keyAssignments.findIndex((e=>"rotNegX"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotPosX"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotPosY"===e[0])),-1!==e&&(this.keyAssignments[e][1]=""),e=this.keyAssignments.findIndex((e=>"rotNegY"===e[0])),-1!==e&&(this.keyAssignments[e][1]="")}this.lerpFactorPosStart=1-.02**(1/(60*(null!==(g=i.delayPos[0])&&void 0!==g?g:.3))),this.lerpFactorPosEnd=1-.02**(1/(60*(null!==(v=i.delayPos[1])&&void 0!==v?v:.3))),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/(60*(null!==(y=i.delayRot[0])&&void 0!==y?y:.3))),this.lerpFactorRotEnd=1-.02**(1/(60*(null!==(b=i.delayRot[1])&&void 0!==b?b:.3))),this.lerpFactorPosCamera=1-.02**(1/(60*(null!==(x=i.delayPosCamera)&&void 0!==x?x:.3))),this.lerpFactorRotCamera=1-.02**(1/(60*(null!==(w=i.delayRotCamera)&&void 0!==w?w:.3))),this.gravity=12*(null!==(_=this.gloabalPhysics.gravity)&&void 0!==_?_:xC.defaultData.gravity),this.usePhysics=null!==(S=this.gloabalPhysics.usePhysics)&&void 0!==S?S:xC.defaultData.usePhysics,this.jumpPower=20*i.jumpPower,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=null!==(A=i.alignToGround)&&void 0!==A&&A,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=null!==(E=i.orientWith)&&void 0!==E?E:eM.defaultDataThirdPerson.orientWith,this.slopeThresh=65*Math.PI/180,"capsule"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*zH/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height):"sphere"===i.collider.type?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*zH/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*.3/this.pixelsPerMeter,this.colliderHeight=2*i.collider.radius):(this.offset=i.collider.height*zH/this.pixelsPerMeter,this.stepThresh=.3*i.collider.height/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let R=(new gl).fromArray(i.collider.position),O=(new ml).setFromEuler((new ic).fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(R).multiply(this.scale),this.collider.rotation.copy(O),this.collider.matrix.compose(R,O,tW),void 0!==i.cameraXAxis&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=null!==(C=i.forwardDirection)&&void 0!==C?C:"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=null!==(M=i.runMultiplier)&&void 0!==M?M:2;let I=2*i.navmesh.destinationHelperRadius;if(I>0){let e=new V_;e.push({fi:0,data:{...iC.defaultData("light","phong"),alpha:0},id:"layer1"}),e.push({fi:0,data:{...iC.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let t=new KL({layers:e},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new ah(YT.create({parameters:{width:I,height:I/10,hollow:.7}}),t),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),e){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=(new ic).setFromQuaternion(this.quaternion,"YXZ"),t=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,t,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof NB?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();!0===this.cameraFollow&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){var e;this.deactivate(),(null===(e=this.navMeshPathDest)||void 0===e?void 0:e.parent)&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let e=this.data,t=this.sharedAssets;void 0!==e.gameActions&&(this.actions={},$C.list.forEach((i=>{this.actions[i]=CH({...e,disabled:!1,type:"GameControl"},e.gameActions[i],this.page,t,this.controlsManager.eventManager,this.object)}))),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),MH(this.actions.idle),MH(this.actions.move),MH(this.actions.run),MH(this.actions.jump)}dispatchStartEvent(e){void 0!==this.actions[e]&&(this.actionState[e]||(this.actionState[e]=!0,this.actions[e].Transition.forEach((e=>{e.play()})),this.actions[e].Animation.forEach((e=>{e.play(!1===this.initialAction)})),this.actions[e].Create.forEach((e=>{e.dispatchStart()})),this.actions[e].Audio.forEach((e=>{e.dispatchGameControl("start")})),this.actions[e].Particles.forEach((e=>{e.dispatchGameControl("start")}))))}dispatchStopEvent(e){void 0!==this.actions[e]&&(!this.actionState[e]||(this.actionState[e]=!1,this.actions[e].Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})})),this.actions[e].Create.forEach((e=>{e.dispatchStop()})),this.actions[e].Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.actions[e].Particles.forEach((e=>{e.dispatchGameControl("stop")}))))}get colliderWorldPosition(){return GH.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(e,t,i){var n;if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:e)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let a=60*r,s=!1;if(this.usePhysics&&this.collisionEnabled){var o;let e=HH.set(0,(0===this.velocity.y?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/120,1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),t=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,e,null===(o=this.object.rigidBody)||void 0===o?void 0:o.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(t){var l;this.onObject=!0,this.groundNormal.set(t.normal2.x,t.normal2.y,t.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),0===(null===(l=t.collider.parent())||void 0===l?void 0:l.bodyType())&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let e=t.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(t.rigidBody===e&&t.userData.isFollowingObj!==this.object.uuid){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(GH,KH,HH),this.groundVelocity.subVectors(GH,t.prevT),this.object.getWorldPosition(HH).add(this.collider.position).sub(GH),this.groundYRotation=ZH.setFromQuaternion(KH).y-t.prevR.y,WH.copy(HH).applyAxisAngle($H,this.groundYRotation),this.groundVelocity.add(WH.sub(HH)).divideScalar(r);break}}else this.onObject=!1}if("walk"===this.moveMode&&this.collisionEnabled&&(1===this.movementState.jump&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*a),"fly"===this.moveMode&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,"+z"===this.forwardDir&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let e=this.navMeshPathDest.material;if("walk"===this.moveMode&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let t=GH.subVectors(this.path[1],this.position),i=HH.subVectors(this.path[1],this.path[0]);t.dot(i)<0?this.path.shift():(this.directionXZ.x=i.x,this.directionXZ.z=i.z),e.opacity=e.userData.opacity0}else e.opacity-=.05*e.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,("walk"===this.moveMode?this.velocityTarget.x+this.velocityTarget.z===0:0===this.velocityTarget.manhattanLength())?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),"walk"===this.moveMode&&(this.lerpFactorPos.y=1),!1===this.didHit&&0===this.pushedVelocity.manhattanLength()||!1===this.usePhysics?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**a),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**a),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**a)):this.velocity.copy(this.velocityTarget),("walk"===this.moveMode?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),this.onObject&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let c=VH.copy(this.velocity);if("none"!==this.orientMode&&!1===this.isFirstPerson){let e=HH.copy(c);e.y=0,c.set(0,c.y,e.length()*("+z"===this.forwardDir?1:-1))}if(this.directionXZ.manhattanLength()>0&&"none"!==this.orientMode&&!1===this.isFirstPerson)if("camera"===this.orientWith&&this.path.length<=1){let e=GH;this.camera.getWorldDirection(e);let t=WH.copy($H).multiplyScalar(e.dot($H));e.sub(t);let i=HH.copy(this.directionXZ);i.x*=-1,this.rot.y=e.angleTo(i)*(e.cross(i).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*("+z"===this.forwardDir?1:-1);if(ZH.setFromVector3(this.rot),"walk"===this.moveMode&&(ZH.x=0),c.applyEuler(ZH),s&&(KH.setFromUnitVectors($H,this.groundNormal),c.applyQuaternion(KH)),i){let e=ZH.set(0,this.vrEulerYOffset*sW,0);i.applyEuler(e),c.x+=i.x,c.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(!0===this.usePhysics){let e=HH;this.pushedVelocity.set(0,0,0);for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){let i=WH.setFromMatrixPosition(t.matrixWorld).sub(t.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),n=t.rigidBody.collider(0).castCollider(i,this.object.rigidBody.collider(0),GH.copy(c).divideScalar(this.pixelsPerMeter),r,!1);i.multiplyScalar(this.pixelsPerMeter);let a=AT.is(t)?t:t.object;if(null!==n&&this.lastHitObj!==a){let e;t instanceof MT&&(e=t);let i=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(i)for(let t of i)"character"===t.data.target&&(t.dispatch(e),a.dispatchEvent(RX));this.lastHitObj=a}if(null!==n){this.pushedVelocity.copy(i),e.copy(n.normal1).applyQuaternion(t.quaternion);break}}if(0!==this.pushedVelocity.manhattanLength()){let t=e.dot(c);t<0&&c.addScaledVector(e,-t),c.add(this.pushedVelocity)}else c.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),"normal"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)||"steer"===this.rotationMode&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||"walk"===this.moveMode)?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,"normal"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)||"steer"===this.rotationMode&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),0===this.rotVelocityTarget.manhattanLength()?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**a):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**a),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,0===this.rotVelocityTarget.y&&0===this.directionXZ.manhattanLength()?this.rotationAccumWhenOrientWithCamera=0:(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),!1===this.isFirstPerson&&"none"!==this.orientMode&&this.directionXZ.manhattanLength()>0){if("radial"===this.orientMode){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle($H,this.euler.y-this.euler0.y);let e=HH.copy(this.objectToCamXZ).normalize(),t=WH.copy(c).multiplyScalar(r);t.y=0;let i=t.sub(GH.copy(e).multiplyScalar(t.dot(e))).cross(e).y;this.euler.y-=Math.atan2(i,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,0!==this.rotVelocityTarget.y&&(!1===this.cameraFollow||"Locked"===this.cameraYAxis)&&(this.euler.y=this.rot.y);if(!0===this.cameraFollow&&("walk"===this.moveMode?"Limit"===this.cameraXAxis?this.euler.x=Uo.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Uo.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):"Limit"===this.cameraXAxis&&(this.euler.x=Uo.clamp(this.euler.x,-this.PI_2,this.PI_2))),"fly"===this.moveMode?this.rot.x=this.euler.x:this.isFirstPerson&&(t?(ZH.copy(t),ZH.y=0):(ZH.copy(this.euler),ZH.y=0),this.nonColliderRotOffset.makeRotationFromEuler(ZH)),t&&("walk"===this.moveMode?(this.rot.y=t.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(t),this.rot.y+=this.vrEulerYOffset*sW),QH.setFromAxisAngle(JH,this.rot.x),KH.setFromAxisAngle($H,this.rot.y),KH.multiply(QH),QH.setFromAxisAngle(eW,this.rot.z),KH.multiply(QH),this.quaternion.copy(KH),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){var h,d;let e=HH.copy(c).multiplyScalar(r/this.pixelsPerMeter),t=null;this.didHit=!1;let i=new gl;for(let n=0;n<5;n++){var u;let r=e.length(),a=WH.copy(e).normalize();if(t=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(i),this.colliderWorldQuat,a,null===(u=this.object.rigidBody)||void 0===u?void 0:u.collider(0).shape,r,!1,24,void 0,void 0,this.object.rigidBody),null===t){0===n&&0!==this.directionXZ.manhattanLength()&&(this.lastHitObj=null),i.add(e);break}{this.didHit=!0;let s=this.sharedGameControlGlobals.colliderToEntity.get(t.collider.handle);if(s!==this.lastHitObj&&0===n){this.lastHitObj=s;let e=this.sharedGameControlGlobals.entityToCollisionEvents[null===s||void 0===s?void 0:s.uuid];if(e)for(let i of e)if("character"===i.data.target){var p;let e,n=(null===(p=this.sharedGameControlGlobals.rapierWorld)||void 0===p?void 0:p.getCollider(t.collider.handle))._parent;if(s.cloner)for(let t of s.cloner.children)if(t.rigidBody===n){e=t;break}i.dispatch(e),s.dispatchEvent(RX)}}let o=UH.set(t.normal2.x,t.normal2.y,t.normal2.z).applyQuaternion(this.colliderWorldQuat),l=jH.copy(a).multiplyScalar(t.toi).dot(o),c=t.toi;if(0===c&&(this.position.y+=this.offset*this.pixelsPerMeter),l>this.offset&&(c=t.toi*(l-this.offset)/l,i.addScaledVector(a,c)),e.copy(a).multiplyScalar(r-c),Math.acos(-o.y)>this.slopeThresh){var f;let n=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(i),r=WH.copy(t.witness2).applyQuaternion(this.colliderWorldQuat);r.y=0;let a=n.add(r);a.y+=this.stepThresh;let s=this.sharedGameControlGlobals.rapierWorld.castShape(a,this.colliderWorldQuat,e,null===(f=this.object.rigidBody)||void 0===f?void 0:f.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);null!==s&&0===s.toi&&(o.y=0,o.normalize())}e.addScaledVector(o,-e.dot(o))}}this.position.addScaledVector(i,this.pixelsPerMeter),null!==(h=this.object.rigidBody)&&void 0!==h&&h.setTranslation(GH.copy(this.position).divideScalar(this.pixelsPerMeter),!0),null===(d=this.object.rigidBody)||void 0===d||d.setRotation(QH.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let e=this.onObject?1:5,t=c.multiplyScalar(r/e);for(let i=0;i<e;i++)this.position.add(t),this.collisionAdjustment(r/e)}else this.position.addScaledVector(c,r);if("walk"===this.moveMode&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),!0===this.cameraFollow){this.updateFollowArms();let e=this.objectToTarget.add(this.position),t=this.targetToCamera.add(e);qH.lookAt(t,e,$H).setPosition(t),qH.decompose(this.targetPos,this.targetQuat,GH),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**a),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**a),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),"Limit"===this.cameraYAxis&&"cartesian"===this.orientMode&&(this.euler.y=Uo.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Uo.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(aW),(!(this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(void 0===this.camera||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate))||"fly"!==this.moveMode&&!0!==this.onObject&&!1!==this.collisionEnabled||!(null===this.navMeshPathDest||this.navMeshPathDest.material.opacity<-.04*(null===(n=this.navMeshPathDest)||void 0===n||null===(n=n.material)||void 0===n?void 0:n.userData.opacity0)))&&(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(rW),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let e,t=QH.setFromAxisAngle($H,"Limit"===this.cameraYAxis&&"radial"!==this.orientMode?Uo.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&this.objectToTarget.applyQuaternion(t),e="Limit"===this.cameraXAxis?Uo.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):Uo.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=GH.copy(this.cameraPolarAxis0);("Locked"!==this.cameraYAxis||"radial"===this.orientMode)&&i.applyQuaternion(t);let n=KH.setFromAxisAngle(i,e);"Locked"!==this.cameraYAxis&&this.targetToCamera.applyQuaternion(t),"Locked"!==this.cameraXAxis&&this.targetToCamera.applyQuaternion(n)}groundTiltAdjustment(e){180*$H.angleTo(e)/Math.PI<15||180*$H.angleTo(e)/Math.PI>85?QH.identity():QH.setFromUnitVectors($H,e),this.groundTilt.slerp(QH,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(e){var t;let i=jH.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let n=qH.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(GH,QH,HH).compose(GH,QH,tW);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach((e=>{if(e===this.object||e.isDescendantOf(this.object))return;nW.makeEmpty(),e.updateMatrixWorldSVD();let t=e.matrixWorldRigid,r=XH.copy(t).invert(),a=YH.copy(XH).multiply(n);iW.copy(this.collider.segment),iW.start.applyMatrix4(a),iW.end.applyMatrix4(a);let s=UH.copy(this.position).applyMatrix4(r);nW.expandByPoint(iW.start),nW.expandByPoint(iW.end),nW.min.addScalar(-this.collider.radius),nW.max.addScalar(this.collider.radius),e.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder:e=>e.distanceToPoint(iW.end),intersectsBounds:e=>e.intersectsBox(nW),intersectsTriangle:e=>{let n=GH,r=HH,a=e.closestPointToSegment(iW,n,r);if(a<this.collider.radius){let e=this.collider.radius-a,o=r.sub(n).normalize(),l=WH.copy(s);l.addScaledVector(o,e);let c=l.applyMatrix4(t).sub(this.position);i.add(c),iW.start.addScaledVector(o,e),iW.end.addScaledVector(o,e)}}})})),nW.makeEmpty(),iW.copy(this.collider.segment),iW.start.applyMatrix4(n),iW.end.applyMatrix4(n),nW.expandByPoint(iW.start),nW.expandByPoint(iW.end),nW.min.addScalar(-this.collider.radius),nW.max.addScalar(this.collider.radius),null!==(t=this.sharedGameControlGlobals.staticMeshBVH)&&void 0!==t&&t.shapecast({traverseBoundsOrder:e=>e.distanceToPoint(iW.end),intersectsBounds:e=>e.intersectsBox(nW),intersectsTriangle:e=>{let t=GH,n=HH,r=e.closestPointToSegment(iW,t,n);if(r<this.collider.radius){let e=this.collider.radius-r,a=n.sub(t).normalize();this.alignToGround&&this.groundTiltAdjustment(a),i.addScaledVector(a,e),iW.start.addScaledVector(a,e),iW.end.addScaledVector(a,e)}}}),this.onObject=Math.abs(i.y)>Math.abs(e*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,i.length()-1e-5);i.normalize().multiplyScalar(r),this.position.add(i)}},lW=oW;lW.isLocked=!1;var cW=Br(Ur());function hW(e,t){let i=new Wc;if(!e.getAttribute("position"))return i.setAttribute("position",new Bc([],3)),i.setIndex([]),i;let{positions:n,triIndices:r}=kO(e.getAttribute("position"),e.getIndex());return i.setAttribute("position",new Bc(n,3)),i.setIndex(r),t&&i.applyMatrix4(t),i}var dW=new ql,uW=new ql,pW=[[0,0,0],[0,0,0],[0,0,0]];function fW(e){let t=e.elements;pW[0][0]=t[0],pW[0][1]=t[4],pW[0][2]=t[8],pW[1][0]=t[1],pW[1][1]=t[5],pW[1][2]=t[9],pW[2][0]=t[2],pW[2][1]=t[6],pW[2][2]=t[10];let{u:i,v:n}=(0,cW.SVD)(pW),r=dW.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),a=uW.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1);return r.multiply(a.transpose())}var mW=class extends Qm{constructor(){super(),this.layers.enable(3),this.layers.enable(8)}setFromCamera(e,t){t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):t.isPerspectiveCamera?(this.ray.origin.set(e.x,e.y,-1).unproject(t),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return e.forEach((e=>{e.visible&&this.intersectObject(e,t,i)})),i}createRaycastLineHelper(){let e=new Sp({color:65280,linewidth:10}),t=new gl(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new gl(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),n=this.camera.far-this.camera.near,r=(new gl).addVectors(t,i.multiplyScalar(n)),a=new Wc;return a.setFromPoints([t,r]),new Tp(a,e)}},gW=e=>e instanceof QB||e instanceof ZU;function vW(e,t){return e.distance-t.distance}function yW(e,t,i){if(VT(t)&&t.visible){WB(t)&&t.raycast(e,i);for(let n of t.children)yW(e,n,i)}}function bW(e,t,i){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])&&!i.some((t=>void 0!==_W(e,t))))return[];let n=[];return t.children.forEach((t=>yW(e,t,n))),n.sort(vW),n}function xW(e){let t=[];if(e.length){let i=e[0].object;VT(i)&&t.push(i);let n=i.parent;for(;n;)gW(n)&&t.push(n),n=n.parent}return t}function wW(e,t,i,n){let r=e.frame;if(r){let e=t[0]*r.width,a=(1-t[1])*r.height;for(let t of i){let i=t===r.uuid?r:r.find(t);if(null!==i&&void 0!==i&&i.intersects(e,a))return n(i),!0}}return!1}function _W(e,t){if(WB(t)){if(t.visible){let i=[];return t.raycast(e,i),i.length?i[0]:void 0}}else if(gW(t))return SW(e,t)}function SW(e,t){if(VT(t)&&t.visible){if(WB(t)){let i=[];if(t.raycast(e,i),i.length)return i[0]}for(let i of t.children){let t=SW(e,i);if(t)return t}}}var AW=class{constructor(e,t,i,n,r,a,s,o){this.renderer=e,this.publish=t,this.scene=i,this.getCamera=n,this.sharedAssets=r,this.requestRender=a,this.isExport=s,this.frame=o,this.raycaster=new mW,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents="window"===t.mouseEventTarget,this.domElement=e.domElement,this.eventElement=this._useWindowEvents?window:e.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(e){this._useWindowEvents=e,this.eventElement=e?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(e){this._domRect=e}get domRect(){return this._domRect}updateRaycaster(e){var t;let{pageX:i,pageY:n}=(null===(t=e.touches)||void 0===t?void 0:t.length)>0?e.touches[0]:e;this.pointerWorld=function(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width*2-1,y:-(t-(i.top+window.scrollY))/i.height*2+1}}(i,n,this._domRect),this.pointerScreen=function(e,t,i){return{x:(e-(i.left+window.scrollX))/i.width,y:1-(t-(i.top+window.scrollY))/i.height}}(i,n,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},EW=class{constructor(e){this.eventContext=e,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},CW=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],MW=e=>{var t;return null===(t=CW.find((t=>{let[i,n]=t;return n===e})))||void 0===t?void 0:t[0]},PW=e=>{var t;return null===(t=CW.find((t=>{let[i]=t;return i===e})))||void 0===t?void 0:t[1]},TW=(e,t)=>{let i=MW(e);if(i){let e=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(e,"target",{writable:!1,value:t}),e}},DW=class extends EW{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=e=>{var t;if(!e.eventName||!e.target||"Scroll"===e.eventName)return;let i=null===(t=this.splineEvents[MW(e.eventName)])||void 0===t?void 0:t[e.target.uuid];if(!i)return;"Scroll"===e.eventName&&void 0!==e.deltaY&&Object.assign(i,{deltaY:e.deltaY});let{domElement:n}=this.eventContext;n.dispatchEvent(i)}}connect(){let{page:e}=this.eventContext;e.traverseEntity((e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.events.length)for(let[n,r]of CW)if(e.data.events.some((e=>e.data.type===r&&!e.data.disabled))){var i;this.objectsPerEvents.has(n)?null===(i=this.objectsPerEvents.get(n))||void 0===i||i.push(e):this.objectsPerEvents.set(n,[e]);let t={id:e.uuid,name:e.name},a=TW(r,t),s=this.splineEvents[n];s?s[e.uuid]=a:this.splineEvents[n]={[e.uuid]:a}}})),this.objectsPerEvents.forEach((e=>{e.forEach((e=>{e.addEventListener("beginEvent",this.onBeginEvent)}))}))}disconnect(){this.objectsPerEvents.forEach((e=>{e.forEach((e=>{e.removeEventListener("beginEvent",this.onBeginEvent)}))}))}},RW=class{constructor(e,t,i,n,r,a){if(this.id=e,this.data=t,this.object=i,this.entered=!1,this.alreadyPlayedNonTogglingActions=new Set,("KeyDown"===t.type||"KeyUp"===t.type||"KeyPress"===t.type)&&!t.key)throw new Error("Missing property");this.actions=CH(t,t.actions,n,r,a,i)}disconnect(){MH(this.actions)}dispatchHeld(e){this.actions.Create.forEach((t=>{e&&t.dispatchThrottled.cancel(),t.dispatchThrottled()}))}dispatch(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):"Once"===e.data.runMode&&this.alreadyPlayedNonTogglingActions.add(e)})),"MousePress"===this.data.type||"KeyPress"===this.data.type?this.entered||(this.entered=!0,this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent())),this.actions.Create.forEach((e=>e.dispatchStart()))):(this.actions.Transition.some((e=>e.playing&&"Toggle"!==e.data.runMode))||this.actions.Transition.forEach((e=>{!1===this.alreadyPlayedNonTogglingActions.has(e)&&("Toggle"===e.data.runMode?e.toggle():e.play())})),this.actions.SwitchCamera.some((e=>e.playing&&"Toggle"!==e.data.runMode))||this.actions.SwitchCamera.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Animation.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()}))),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),!1===e&&this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent())),this.actions.Create.forEach((e=>e.dispatchStop())))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}},OW=class extends EW{constructor(e,t,i){super(e),this.eventManager=t,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=e=>{if(!0===this.useForRaycastProperty&&null===this.sceneInterects){this.eventContext.updateRaycaster(e);let{raycaster:t,page:i}=this.eventContext,n=bW(t,i,[],!0);this.sceneInterects=n,n.length&&(this.eventContext.sharedAssets.raycastProperty={x:n[0].point.x,y:n[0].point.y,z:n[0].point.z,objX:n[0].object.matrixWorld.elements[12],objY:n[0].object.matrixWorld.elements[13],objZ:n[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=e=>{(e.target===this.eventContext.domElement||"SPLINE-VIEWER"===e.target.tagName)&&this.canvasMouseEvents.forEach((t=>{("MouseDown"===t.data.type||"MousePress"===t.data.type)&&(this.onCanvasRaycast(e),t.dispatch())}))},this.onCanvasMouseUp=e=>{(e.target===this.eventContext.domElement||"SPLINE-VIEWER"===e.target.tagName)&&this.canvasMouseEvents.forEach((t=>{"MouseUp"===t.data.type?(this.onCanvasRaycast(e),t.dispatch()):"MousePress"===t.data.type&&t.dispatchRelease()}))},this.onMouseDown=e=>{f_.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseEvent("MouseDown"))},this.onMouseUp=e=>{f_.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=e=>{f_.length>1||(this.eventContext.updateRaycaster(e),this.handleMousePressEvent())},this.onMousePressRelease=e=>{f_.length>1||(this.eventContext.updateRaycaster(e),this.handleMousePressEvent(!0))},this.onKeyDown=e=>{this.heldKeys[e.key]||(this.handleKeyEvent(e,"KeyDown"),this.handleKeyEventHeld(e,"KeyDown",!0)),this.heldKeys[e.key]=!0},this.onKeyUp=e=>{this.handleKeyEvent(e,"KeyUp"),this.handleKeyEventHeld(e,"KeyUp",!0)},this.onKeyPressDown=e=>{this.heldKeysPress[e.key]?this.handleKeyEventHeld(e,"KeyPress"):(this.handleKeyEvent(e,"KeyPress"),this.handleKeyEventHeld(e,"KeyPress",!0)),this.heldKeysPress[e.key]=!0},this.onKeyPressUp=e=>{this.handleKeyEvent(e,"KeyPress",!0)},this.releaseHeldKey=e=>{delete this.heldKeys[e.key]},this.releaseHeldKeyPress=e=>{delete this.heldKeysPress[e.key]},this._onUserEvent=e=>{var t,i;let{eventName:n,target:r,reverse:a}=e;if(!n||!r)return;let s=PW(n);s&&("MouseDown"===s||"MouseUp"===s||"MousePress"===s?(r.dispatchEvent({type:"beginEvent",eventName:s}),null===(t=this.eventsPerObjects[s])||void 0===t||null===(t=t[r.uuid])||void 0===t||t.forEach((e=>{e.dispatchUserEvent(a)}))):("KeyDown"===s||"KeyUp"===s||"KeyPress"===s)&&(r.dispatchEvent({type:"beginEvent",eventName:s}),null===(i=this.eventsPerObjects[s])||void 0===i||null===(i=i[r.uuid])||void 0===i||i.forEach((e=>{e.dispatchUserEvent()}))))}}connect(){var e,t,i,n,r,a;let{page:s,sharedAssets:o,domElement:l}=this.eventContext,c=(e,t)=>{var i;if(null===(i=e.data)||void 0===i||!i.events.length)return;let n=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let a of n){var r;let i=this.eventsPerObjects[a];e.data.events.filter((e=>{let{data:t}=e;return t.type===a&&!0!==t.disabled})).forEach((t=>{let{id:n,data:r}=t;try{let t=new RW(n,r,e,s,o,this.eventManager);t.actions.Video.length&&(this.hasVideoAction=!0),"MouseDown"!==r.type&&"MouseUp"!==r.type&&"MousePress"!==r.type||"Canvas"!==r.mode&&"Window"!==r.mode?i[e.uuid]?i[e.uuid].some((e=>e.id===t.id))||i[e.uuid].push(t):i[e.uuid]=[t]:this.canvasMouseEvents.push(t)}catch(a){}})),(null===(r=i[e.uuid])||void 0===r?void 0:r.length)&&this.objectsPerTypes[a].push(e instanceof rU&&("MouseDown"===a||"MouseUp"===a||"MousePress"===a)?t:e)}};s.traverseEntity((e=>{var t;(e instanceof ij||e instanceof XU)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((t=>{c(t,e)})),c(e)})),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),l.addEventListener("pointerdown",this.onCanvasMouseDown),l.addEventListener("pointerup",this.onCanvasMouseUp),(null!==(e=this.objectsPerTypes.MouseDown)&&void 0!==e&&e.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),l.addEventListener("pointerdown",this.onMouseDown)),null!==(t=this.objectsPerTypes.MouseUp)&&void 0!==t&&t.length&&(this.domEventsNeeded.add("pointerup"),l.addEventListener("pointerup",this.onMouseUp)),null!==(i=this.objectsPerTypes.MousePress)&&void 0!==i&&i.length&&(this.domEventsNeeded.add("pointerdown"),l.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),l.addEventListener("pointerup",this.onMousePressRelease)),null!==(n=this.objectsPerTypes.KeyDown)&&void 0!==n&&n.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),null!==(r=this.objectsPerTypes.KeyUp)&&void 0!==r&&r.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),null!==(a=this.objectsPerTypes.KeyPress)&&void 0!==a&&a.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach((e=>{let[t,i]=e;i.forEach((e=>{e.addEventListener("userEvent",this._onUserEvent)}))}))}disconnect(){let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},e.removeEventListener("pointerdown",this.onCanvasMouseDown),e.removeEventListener("pointerup",this.onCanvasMouseUp),e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerdown",this.onMousePressDown),e.removeEventListener("pointerup",this.onMouseUp),e.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach((e=>{Object.values(e).forEach((e=>{e.forEach((e=>{e.disconnect()}))}))})),this.canvasMouseEvents.forEach((e=>{e.disconnect()})),Object.entries(this.objectsPerTypes).forEach((e=>{let[t,i]=e;i.forEach((e=>{e.removeEventListener("userEvent",this._onUserEvent)}))}))}handleMouseEvent(e){let{stopRaycast:t,raycaster:i,page:n,pointerScreen:r}=this.eventContext,a=this.objectsPerTypes[e],s=a.filter((e=>!(e instanceof rU)));if((a.length||this.useForRaycastProperty)&&(!n.uiCanvas||!wW(n,[r.x,r.y],Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})))){if(t||this.useForRaycastProperty){let r;if(null===this.sceneInterects?r=bW(i,n,s,this.useForRaycastProperty):(r=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&r.length&&(this.eventContext.sharedAssets.raycastProperty={x:r[0].point.x,y:r[0].point.y,z:r[0].point.z,objX:r[0].object.matrixWorld.elements[12],objY:r[0].object.matrixWorld.elements[13],objZ:r[0].object.matrixWorld.elements[14]}),t){var o,l,c,h;let t=[null!==(o=null===(l=r[0])||void 0===l||null===(l=l.uv)||void 0===l?void 0:l.x)&&void 0!==o?o:0,null!==(c=null===(h=r[0])||void 0===h||null===(h=h.uv)||void 0===h?void 0:h.y)&&void 0!==c?c:0];xW(r).forEach((i=>{i instanceof ij&&wW(i,t,Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})),this.eventsPerObjects[e][i.uuid]&&this.handleObjectMouseEventDispatch(i,e)}))}}t||s.forEach((t=>{var n,r,a,s;let o=_W(i,t);o&&(this.handleObjectMouseEventDispatch(t,e),t instanceof ij&&wW(t,[null!==(n=null===o||void 0===o||null===(r=o.uv)||void 0===r?void 0:r.x)&&void 0!==n?n:0,null!==(a=null===o||void 0===o||null===(s=o.uv)||void 0===s?void 0:s.y)&&void 0!==a?a:0],Object.keys(this.eventsPerObjects[e]),(t=>{this.handleObjectMouseEventDispatch(t,e)})))}))}}handleMousePressEvent(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t="MousePress",i=this.objectsPerTypes[t],n=i.filter((e=>!(e instanceof rU))),r=[];if(i.length){if(!e){let{stopRaycast:e,raycaster:i,page:a,pointerScreen:s}=this.eventContext,o=!1;if(a.uiCanvas&&(o=wW(a,[s.x,s.y],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)}))),e&&!o){let e=bW(i,a,n);r=xW(e),e.forEach((e=>{var i,n,a,s;e.object instanceof ij&&wW(e.object,[null!==(i=null===e||void 0===e||null===(n=e.uv)||void 0===n?void 0:n.x)&&void 0!==i?i:0,null!==(a=null===e||void 0===e||null===(s=e.uv)||void 0===s?void 0:s.y)&&void 0!==a?a:0],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)}))}))}else n.forEach((e=>{var n,a,s,o;let l=_W(i,e);l&&(r.push(e),e instanceof ij&&wW(e,[null!==(n=null===l||void 0===l||null===(a=l.uv)||void 0===a?void 0:a.x)&&void 0!==n?n:0,null!==(s=null===l||void 0===l||null===(o=l.uv)||void 0===o?void 0:o.y)&&void 0!==s?s:0],Object.keys(this.eventsPerObjects[t]),(e=>{r.push(e)})))}))}this._prevObjects.length&&this._prevObjects.forEach((e=>{r.includes(e)||this.handleObjectMouseEventDispatchRelease(e,t)})),r.length&&r.forEach((e=>{this.handleObjectMouseEventDispatch(e,t)})),this._prevObjects=r}}handleObjectMouseEventDispatch(e,t){var i;e.dispatchEvent({type:"beginEvent",eventName:t}),null===(i=this.eventsPerObjects[t])||void 0===i||null===(i=i[e.uuid])||void 0===i||i.forEach((e=>{e.dispatch()}))}handleObjectMouseEventDispatchRelease(e,t){var i;e.dispatchEvent({type:"beginEvent",eventName:t}),null===(i=this.eventsPerObjects[t])||void 0===i||null===(i=i[e.uuid])||void 0===i||i.forEach((e=>{e.dispatchRelease()}))}handleKeyEvent(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((n=>{let r=this.eventsPerObjects[t][n.uuid];r.some((t=>{let{data:i}=t;return"key"in i&&i.key===e.key}))&&n.dispatchEvent({type:"beginEvent",eventName:t}),r.forEach((t=>{"key"in t.data&&t.data.key===e.key&&(i?t.dispatchRelease():t.dispatch(!0))}))}))}handleKeyEventHeld(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.objectsPerTypes[t].forEach((n=>{this.eventsPerObjects[t][n.uuid].forEach((t=>{"key"in t.data&&t.data.key===e.key&&t.dispatchHeld(i)}))}))}},IW=new gl,kW=new gl,LW=class{constructor(e,t,i,n,r){this.actionsIn=CH(e,e.inActions,i,n,r,t),this.actionsOut=CH(e,e.outActions,i,n,r,t)}disconnect(){MH(this.actionsIn),MH(this.actionsOut)}},FW=class extends LW{constructor(e,t,i,n,r,a){super(t,i,n,r,a),this.id=e,this.data=t,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let n of this.objects)if(!n.visible)return;let e=IW.setFromMatrixPosition(this.objects[0].matrixWorld),t=kW.setFromMatrixPosition(this.objects[1].matrixWorld),i=e.distanceTo(t)<=this.distance?"in":"out";if(this.stage!==i){this.stage=i;let e="in"===i?this.actionsIn:this.actionsOut;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Link.forEach((e=>e.dispatch())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch()))}};let{distance:s,fromObject:o,toObject:l}=t.condition;this.distance=s;for(let c of[o,l]){if(!c)throw new Error("Missing property");let e=n.find(c);if(!e)throw new Error("Missing property");this.objects.push(e)}}connect(){window.setTimeout((()=>{this.objects.forEach((e=>{e.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})),this.onUpdateMatrixWorld()}),0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach((e=>{e.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}))}},BW=class extends LW{constructor(e,t,i,n,r,a){var s,o;super(t,i,n,r,a),this.id=e,this.data=t,this.object=i,this.onBegin=e=>{let{target:t,state:i}=e;this.toState!==i&&(this.actionsOut.Audio.forEach((e=>e.dispatchConditional())),this.actionsOut.Particles.forEach((e=>e.dispatchConditional())),this.actionsOut.Video.forEach((e=>e.dispatchConditional())),this.actionsOut.Link.forEach((e=>e.dispatch())),this.actionsOut.Create.forEach((e=>e.dispatch())),this.actionsOut.Destroy.forEach((e=>e.dispatch())),this.actionsOut.Reset.forEach((e=>e.dispatch())),this.actionsIn.Transition.forEach((e=>e.pause())),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach((e=>e.play())),this.actionsOut.Animation.forEach((e=>e.play())),this.actionsIn.SwitchCamera.forEach((e=>e.pause())),this.actionsOut.SwitchCamera.forEach((e=>e.play())),this.actionsOut.SceneTransition.forEach((e=>e.dispatch())),this.actionsOut.SetVariable.forEach((e=>e.checkConditions())),this.actionsOut.SetVariable.forEach((e=>e.dispatch())),this.actionsOut.DynamicVariablePlay.forEach((e=>e.dispatch())))},this.onComplete=e=>{let{target:t,state:i}=e;this.toState===i&&(this.actionsIn.Audio.forEach((e=>e.dispatchConditional())),this.actionsIn.Particles.forEach((e=>e.dispatchConditional())),this.actionsIn.Video.forEach((e=>e.dispatchConditional())),this.actionsIn.Link.forEach((e=>e.dispatch())),this.actionsIn.Create.forEach((e=>e.dispatch())),this.actionsIn.Destroy.forEach((e=>e.dispatch())),this.actionsIn.Reset.forEach((e=>e.dispatch())),this.actionsOut.Transition.forEach((e=>e.pause())),this.actionsOut.Transition.forEach((e=>e.pause())),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach((e=>e.play())),this.actionsIn.Animation.forEach((e=>e.play())),this.actionsOut.SwitchCamera.forEach((e=>e.pause())),this.actionsIn.SwitchCamera.forEach((e=>e.play())),this.actionsIn.SceneTransition.forEach((e=>e.dispatch())),this.actionsIn.SetVariable.forEach((e=>e.checkConditions())),this.actionsIn.SetVariable.forEach((e=>e.dispatch())),this.actionsIn.DynamicVariablePlay.forEach((e=>e.dispatch())))};let{condition:l}=t;if(!l.object)throw new Error("Missing property");let c=null!==(s=n.find(l.object))&&void 0!==s?s:n.scene.find2D(l.object);if(!c)throw new Error("Missing property");if(this.toObject=c,l.state&&(null===(o=this.toObject.states)||void 0===o||!o[l.state]))throw new Error("Missing property");this.toState=l.state}connect(){$y(this.actionsOut).forEach((e=>{var t;(null===(t=this.actionsOut[e])||void 0===t?void 0:t.length)&&this.toObject.addEventListener("beginState",this.onBegin)})),$y(this.actionsIn).forEach((e=>{var t;(null===(t=this.actionsIn[e])||void 0===t?void 0:t.length)&&this.toObject.addEventListener("completeState",this.onComplete)}))}disconnect(){super.disconnect(),$y(this.actionsOut).forEach((e=>{var t;(null===(t=this.actionsIn[e])||void 0===t?void 0:t.length)&&this.toObject.removeEventListener("beginState",this.onBegin)})),$y(this.actionsIn).forEach((e=>{var t;(null===(t=this.actionsIn[e])||void 0===t?void 0:t.length)&&this.toObject.removeEventListener("completeState",this.onComplete)}))}},NW=class extends EW{constructor(e,t){super(e),this.eventManager=t,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:e,sharedAssets:t}=this.eventContext;e.traverseEntity((i=>{var n;if(null!==(n=i.data)&&void 0!==n&&n.events.length)for(let{id:r,data:a}of i.data.events)if(!a.disabled&&"Conditional"===a.type)try{let n;"Comparison"===a.condition.type||("Distance"===a.condition.type?n=new FW(r,a,i,e,t,this.eventManager):"State"===a.condition.type&&(n=new BW(r,a,i,e,t,this.eventManager))),n&&(this.eventsPerConditions[a.condition.type].push(n),(n.actionsIn.Video.length||n.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch(vE){}})),Object.values(this.eventsPerConditions).forEach((e=>e.forEach((e=>e.connect()))))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach((e=>e.forEach((e=>e.disconnect()))))}},zW=new gl,UW=new gl,jW=new gl,VW=new _h,GW=new gl,HW=new gl,WW=new gl,qW=new ml,XW=new ic,YW=new ql,QW=new Vo,KW=new gl,ZW=new gl,JW=.2;function $W(e,t){!t||(t[0]<t[1]&&(e.x=Math.min(Math.max(e.x,t[0]),t[1])),t[2]<t[3]&&(e.y=Math.min(Math.max(e.y,t[2]),t[3])),t[4]<t[5]&&(e.z=Math.min(Math.max(e.z,t[4]),t[5])))}var eq=function(){let e=new ql;return(t,i,n)=>{let r=t.obj;e.copy(r.hiddenMatrix),null!==r.parent&&e.premultiply(r.parent.matrixWorld),e.invert(),r.position.copy(i),"global"===t.reference&&$W(r.position,t.limits),r.position.applyMatrix4(e),"parent"===t.reference?$W(r.position,t.limits):"local"===t.reference&&(qW.copy(t.quat0).invert(),r.position.sub(t.position0),r.position.applyQuaternion(qW),$W(r.position,t.limits),qW.invert(),r.position.applyQuaternion(qW),r.position.add(t.position0)),e.multiply(null!==n&&void 0!==n?n:r.matrixWorld).decompose(GW,r.quaternion,HW),r.updateMatrix(),r.hasNonUniformScale&&(r.updateMatrixWorld(),r.updateMatrixWorldSVD()),r instanceof cI&&qB(r.parent)&&r.invalidateDownstreamBooleanData(!0)}}(),tq=class{constructor(e,t,i,n,r,a,s){this.object=e,this.id=t,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=0===this.data.resetSpeed?1:8/this.data.resetSpeed+1,this.snapDampingFactor=0===this.data.snapSpeed?1:8/this.data.snapSpeed+1,this.actionsDrag=CH(i,i.dragDropActions.drag,n,r,a,this.object),this.actionsDrop=CH(i,i.dragDropActions.drop,n,r,a,this.object);let o=[];this.data.objects.forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&(o.push(t),s[t.uuid]&&s[t.uuid].forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&o.push(t)})))})),this.data.dropDestinations.forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&(this.dropDestIds.push(t.uuid),s[t.uuid]&&s[t.uuid].forEach((e=>{let t=n.find(e);!t||!1!==t.data.visible&&this.dropDestIds.push(t.uuid)})))})),this.dragItems=o.map((e=>("locked"===this.data.planeMode&&(e.userData.lockedPlane=!0),e.userData.worldPosition0=(new gl).setFromMatrixPosition(e.matrixWorld),{obj:e,fromPosition:(new gl).setFromMatrixPosition(e.matrixWorld),pointStart:new gl,pointEnd:new gl,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:(new gl).copy(e.position),quat0:(new ml).copy(e.quaternion),snapped:!1,orientationMatrix:new ql,limits:this.data.limits,reference:this.data.referenceFrame})))}get activeDragItem(){return null!==this.activeIdx?this.dragItems[this.activeIdx]:null}dispose(){MH(this.actionsDrag),MH(this.actionsDrop),this.dragItems.forEach((e=>{e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart),e.obj.recursiveBBoxNeedsUpdate=!0,e.obj.userData.lockedPlane=void 0,e.obj.position.copy(e.position0),e.obj.quaternion.copy(e.quat0),e.obj.updateMatrix()}))}},iq=class extends EW{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=e=>{if(f_.length>1)return;this.eventContext.updateRaycaster(e);let{raycaster:t,page:i}=this.eventContext,n=i.raycastWithClones(t);if(this.lastDropDestination=null,0!==n.length){for(let e of this.events){let t=0;for(let{obj:i,pointEnd:a,pointStart:s}of e.dragItems){if(i===n[0].object||i===n[0].object.object||AT.is(i)&&i.isAncestorOf(n[0].object.uuid)){var r;if(e.activeIdx=t,e.activeDragItem.reset=!1,e.activeDragItem.currentDampingFactor=e.data.dampingFactor,e.activeDragItem.snapped=!1,"hand"===e.data.cursor&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){e.activeDragItem.obj.rigidBody&&e.activeDragItem.obj.rigidBody.setBodyType(2,!0);let t=e.activeDragItem.obj;i.hasNonUniformScale&&i.updateMatrixWorldSVD(),(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(GW,qW,HW),XW.setFromQuaternion(qW),void 0===t.prevR?(t.prevR=XW.clone(),t.prevT=GW.clone()):(t.prevR.copy(XW),t.prevT.copy(GW)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(e.activeDragItem.obj)}return this.calcPlaneIntersectPos(i,s,e.data.plane,e.data.referenceFrame),a.copy(s),(this.eventManager.controlsManager.usePhysics&&"dynamic"===(null===(r=i.data.physics)||void 0===r?void 0:r.rigidBody)||!1===e.data.drop||!1===e.data.resetOnSnapFail)&&e.activeDragItem.fromPosition.setFromMatrixPosition(e.activeDragItem.obj.matrixWorld),this.activeEvent=e,void(this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1))}t++}}this.activeEvent=null}else this.activeEvent=null},this.onPointerMove=e=>{if(f_.length>1)return;this.eventContext.updateRaycaster(e);let{raycaster:t,page:i}=this.eventContext,n=i.raycastWithClones(t);if(0!==f_.length){if(this.activeEvent&&this.activeEvent.activeDragItem){let e,t=this.activeEvent.activeDragItem;if(t.snapped=!1,this.activeEvent.data.drop&&(e=n.filter((e=>t.obj!==e.object&&!t.obj.isAncestorOf(e.object.uuid)&&!(e.object instanceof QB)&&("all"===this.activeEvent.data.dropOn||this.activeEvent.dropDestIds.some((t=>t===e.object.uuid||i.scene.find(t).isAncestorOf(e.object.uuid))))))[0]),e){let i=WW.copy(e.face.normal).applyMatrix3(QW.getNormalMatrix(e.object.matrixWorld));if("center"===this.activeEvent.data.snapTo)t.fromPosition.setFromMatrixPosition(e.object.matrixWorld);else if("surface"===this.activeEvent.data.snapTo){if(t.fromPosition.copy(e.point),"bbox"===this.activeEvent.data.snapSurfaceMode){GW.copy(i).applyMatrix3(QW.setFromMatrix4(t.obj.matrixWorld).transpose());let e=t.obj;GW.x>JW?HW.x=-e.recursiveBBox.min.x:GW.x<-JW&&(HW.x=-e.recursiveBBox.max.x),GW.y>JW?HW.y=-e.recursiveBBox.min.y:GW.y<-JW&&(HW.y=-e.recursiveBBox.max.y),GW.z>JW?HW.z=-e.recursiveBBox.min.z:GW.z<-JW&&(HW.z=-e.recursiveBBox.max.z),HW.applyMatrix3(QW.invert())}else HW.copy(i).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);t.fromPosition.add(HW)}this.activeEvent.data.autoOrient&&(GW.set(0,1,0).cross(i),GW.length()<1e-4&&GW.set(-1,0,0).cross(i),HW.crossVectors(WW,GW),t.orientationMatrix.makeBasis(GW,HW,i)),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.currentDampingFactor=this.activeEvent.snapDampingFactor,t.snapped=!0,this.lastDropDestination!==e.object&&(this.lastDropDestination=e.object,this.activeEvent.actionsDrop.Transition.forEach((e=>{e.play()})),this.activeEvent.actionsDrop.Animation.forEach((e=>{e.play()})),this.activeEvent.actionsDrop.Audio.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Particles.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrop.Create.forEach((e=>{e.dispatchThrottled()})))}else t.orientationMatrix.makeRotationFromQuaternion(t.quat0),this.lastDropDestination=null,t.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(t.obj,t.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrop.Animation.forEach((e=>{e.stop()})),this.activeEvent.actionsDrop.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.Particles.forEach((e=>{e.dispatchGameControl("stop")}));this.activeEvent.actionsDrag.Create.forEach((e=>{e.dispatchThrottled()})),this.activeEvent.actionsDrag.SetVariable.forEach((e=>e.checkConditions())),this.activeEvent.actionsDrag.SetVariable.forEach((e=>e.dispatch())),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach((e=>e.dispatch())),!1===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach((e=>{e.play()})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.play()})),this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("start")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("start")}))),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout((()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.stop()})))}),500),this.updateDragItem(t),t.obj.dispatchEvent({type:"requestRender"})}}else{let e=!1;for(let t of this.events){for(let{obj:i}of t.dragItems){var r,a,s;if(i===(null===(r=n[0])||void 0===r?void 0:r.object)||i===(null===(a=n[0])||void 0===a||null===(a=a.object)||void 0===a?void 0:a.object)||AT.is(i)&&i.isAncestorOf(null===(s=n[0])||void 0===s?void 0:s.object.uuid)){switch(e=!0,t.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move")}break}}if(e)break}e||this.setCursor("default")}},this.onPointerUp=e=>{if(this.activeEvent&&this.activeEvent.activeDragItem){var t;"hand"===this.activeEvent.data.cursor&&this.setCursor("grab");let e="dynamic"===(null===(t=this.activeEvent.activeDragItem.obj.data.physics)||void 0===t?void 0:t.rigidBody);!1===this.activeEvent.activeDragItem.snapped&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(!1===this.eventManager.controlsManager.usePhysics||!e)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&e&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),!0===this.activeEvent.wasDragEventTriggered&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach((e=>{e.stop(),null!==e.object.currentState&&e.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})})),this.activeEvent.actionsDrag.Animation.forEach((e=>{e.stop()})),this.activeEvent.actionsDrag.Audio.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrag.Particles.forEach((e=>{e.dispatchGameControl("stop")})),this.activeEvent.actionsDrop.SetVariable.forEach((e=>e.checkConditions())),this.activeEvent.actionsDrop.SetVariable.forEach((e=>e.dispatch())),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach((e=>e.dispatch()))),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let e={};if(this.eventContext.page.traverseEntity((t=>{t.component&&(e[t.component.uuid]?e[t.component.uuid].push(t.uuid):e[t.component.uuid]=[t.uuid])})),this.eventContext.page.traverseEntity((t=>{var i;null===(i=t.data)||void 0===i||i.events.filter((e=>"DragDrop"===e.data.type&&!e.data.disabled)).forEach((i=>{this.events.push(new tq(t,i.id,i.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,e))}))})),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let t=this.eventContext.domElement;t.addEventListener("pointerdown",this.onPointerDown),t.addEventListener("pointermove",this.onPointerMove),t.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let e=this.eventContext.domElement;e.removeEventListener("pointerdown",this.onPointerDown),e.removeEventListener("pointermove",this.onPointerMove),e.removeEventListener("pointerup",this.onPointerUp),this.events.forEach((e=>e.dispose()))}setCursor(e){this.eventContext.domElement.style.cursor=e}onAnimationFrameDamping(){for(let e of this.events)for(let t of e.dragItems)t.paused||this.updateDragItem(t,!0)}calcPlaneIntersectPos(e,t,i,n){let{getCamera:r,raycaster:a}=this.eventContext;r().getWorldDirection(UW),UW.negate();let s=qW.identity();switch("parent"===n?YW.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix).decompose(GW,s,HW):"local"===n&&e.matrixWorld.decompose(GW,s,HW),i){case"x":GW.set(1,0,0).applyQuaternion(s),KW.copy(UW).cross(GW),ZW.copy(GW).cross(KW);break;case"y":GW.set(0,1,0).applyQuaternion(s),KW.copy(UW).cross(GW),ZW.copy(GW).cross(KW);break;case"z":GW.set(0,0,1).applyQuaternion(s),KW.copy(UW).cross(GW),ZW.copy(GW).cross(KW);break;case"xy":ZW.set(0,0,1).applyQuaternion(s);break;case"yz":ZW.set(1,0,0).applyQuaternion(s);break;case"xz":ZW.set(0,1,0).applyQuaternion(s);break;case"adaptive":UW.angleTo(HW.set(0,1,0))>Math.PI/6?(GW.crossVectors(HW.set(0,1,0),UW),ZW.crossVectors(GW,HW)):ZW.set(0,1,0);break;default:ZW.copy(UW)}jW.setFromMatrixPosition(e.matrixWorld);let o=e.userData.lockedPlane?e.userData.worldPosition0:jW;if(VW.setFromNormalAndCoplanarPoint(ZW,o),a.ray.intersectPlane(VW,t)&&("x"===i||"y"===i||"z"===i)){let e=HW.subVectors(t,o).dot(GW);t.copy(o).addScaledVector(GW,e)}}updateDragItem(e){var t,i;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];jW.setFromMatrixPosition(e.obj.matrixWorld),"current"===e.reset?zW.subVectors(e.fromPosition,jW).divideScalar(e.currentDampingFactor):"original"===e.reset?(zW.subVectors(e.obj.userData.worldPosition0,jW).divideScalar(e.currentDampingFactor),e.fromPosition.copy(e.obj.userData.worldPosition0),e.pointStart.copy(e.fromPosition),e.pointEnd.copy(e.pointStart)):zW.subVectors(e.pointEnd,e.pointStart).add(e.fromPosition).sub(jW).divideScalar(e.currentDampingFactor),e.paused=!(e.currentDampingFactor>1)||zW.length()<.01,(this.activeEvent&&1===this.activeEvent.data.dampingFactor||n)&&eq(e,zW.add(jW),null!==(t=this.activeEvent)&&void 0!==t&&t.data.drop&&null!==(i=this.activeEvent)&&void 0!==i&&i.data.autoOrient?e.orientationMatrix:null),e.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},nq=new gl,rq=new gl,aq=new gl,sq=new gl,oq=new _h,lq={type:"requestRender"},cq=function(){let e=new gl,t=new gl;return(i,n,r)=>r>0?(e.subVectors(i,n),e.length()<=r?i:t.copy(n).add(e.normalize().multiplyScalar(r))):n}(),hq=function(){let e=new ql;return(t,i)=>{t.position.copy(i),null!==t.parent&&(e.copy(t.parent.matrixWorld).invert(),t.position.applyMatrix4(e)),e.copy(t.hiddenMatrix).invert(),t.position.applyMatrix4(e),t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t instanceof cI&&qB(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),dq=class{constructor(e,t,i,n,r,a){this.data=e,this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new gl,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...rE.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=n.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=CH(e,e.actions,n,r,a,i)}},uq=class extends EW{constructor(e,t){super(e),this.eventManager=t,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=e=>{if(!(f_.length>1)){this.eventContext.updateRaycaster(e);for(let e of this.events)void 0===e.target&&this.updateSingleEvent(e)}},this.onMouseEnter=e=>{for(let t of this.events)void 0===t.target&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)void 0===t.target&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity((t=>{var i,n;let r=null===(i=t.data)||void 0===i?void 0:i.events.find((e=>"Follow"===e.data.type&&!e.data.disabled));r&&(!e.data.globalPhysics.usePhysics||"dynamic"!==(null===(n=t.dataPatched.physics)||void 0===n?void 0:n.rigidBody))&&this.events.push(new dq(r.data,r.id,t,e,this.eventContext.sharedAssets,this.eventManager))})),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),l_&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events)if(void 0!==n.target){let e=n.target,t=this.onTargetChange(n);this.pairOfEventListeners.push([e,t]),e.addEventListener("requestRender",t)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),l_&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let i of this.events)i.paused=!0,i.isReset=!1,MH(i.actions)}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e,!0)}updateSingleEvent(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.events.forEach((e=>{e.actions.Create.forEach((e=>{e.dispatchThrottled()}))}));let{plane:n,limitDistance:r,limitDistanceEnabled:a}=e.data;if(e.object.getWorldPosition(aq),e.isReset)sq.copy(e.worldPosition0);else if(e.target)e.target.getWorldPosition(sq);else{let{getCamera:e,raycaster:t}=this.eventContext;if("custom"===n?(e().getWorldDirection(rq),rq.negate(),nq.copy(rq)):"xy"===n?nq.set(0,0,1):"xz"===n?nq.set(0,1,0):"yz"===n&&nq.set(1,0,0),oq.setFromNormalAndCoplanarPoint(nq,aq),!t.ray.intersectPlane(oq,sq))return}if(!e.isReset)if(sq.distanceTo(e.worldPosition0)>r&&a&&e.target){if(e.snapComplete=!1,e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;sq.copy(e.worldPosition0),e.currentDampingFactor=e.resetDampingFactor}else if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout((()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)}),1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;!1===e.data.enabledTranslation[0]&&(sq.x=aq.x),!1===e.data.enabledTranslation[1]&&(sq.y=aq.y),!1===e.data.enabledTranslation[2]&&(sq.z=aq.z);let s=cq(aq,sq,e.wasOutside?0:e.data.maxDelta);if(e.currentDampingFactor>1){let t=nq.subVectors(s,aq).divideScalar(e.currentDampingFactor);aq.add(t),i&&hq(e.object,aq),e.paused=t.length()<.01}else hq(e.object,s),e.paused=!0;null!==(t=e.object)&&void 0!==t&&t.dispatchEvent({type:"beginEvent",eventName:"Follow"}),e.object.dispatchEvent(lq)}},pq=new gl,fq=new gl,mq=new ql,gq=new ml,vq=new ml,yq=new gl,bq=new gl,xq=new gl,wq=new gl,_q=new _h,Sq={type:"requestRender"},Aq={type:"changeRotation"},Eq=function(){let e=new ql;return function(t,i){null!==t.parent?e.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix):e.copy(t.hiddenMatrix),i.premultiply(fW(e).invert()),t.rotation.setFromRotationMatrix(i),t.updateMatrix(),t instanceof cI&&qB(t.parent)&&t.invalidateDownstreamBooleanData(!0)}}(),Cq=class{constructor(e,t,i,n){this.id=t,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new ml,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...aE.defaultData,...e,...void 0===e.resetOnPointerLeave&&{resetOnPointerLeave:!1}},void 0===e.target||"cursor"===e.target||(this.target=n.find(e.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},Mq=class extends EW{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=e=>{if(!(f_.length>1)){this._lastMouseEvent=e,this.eventContext.updateRaycaster(e);for(let e of this.events)void 0===e.target&&this.updateSingleEvent(e)}},this.onMouseEnter=e=>{for(let t of this.events)void 0===t.target&&(t.isReset=!1,t.currentDampingFactor=t.data.dampingFactor)},this.onMouseLeave=e=>{for(let t of this.events)void 0===t.target&&(t.data.resetOnPointerLeave&&(t.isReset=!0,t.currentDampingFactor=t.resetDampingFactor),this.updateSingleEvent(t))},this.onScroll=e=>{if(this._lastMouseEvent){let e=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(e)}},this.onTargetChange=e=>()=>{this.updateSingleEvent(e)},this.createUserEventListener=e=>t=>{let{eventName:i,target:n}=t;if(!i||!n)return;let r=PW(i);r&&"LookAt"===r&&this.updateSingleEvent(e)}}connect(){let{page:e}=this.eventContext;if(e.traverseEntity((t=>{var i,n;let r=null===(i=t.data)||void 0===i?void 0:i.events.find((e=>"LookAt"===e.data.type&&!e.data.disabled));r&&(!e.data.globalPhysics.usePhysics||"dynamic"!==(null===(n=t.dataPatched.physics)||void 0===n?void 0:n.rigidBody))&&this.events.push(new Cq(r.data,r.id,t,e))})),!this.events.length)return;let{domElement:t,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),l_&&(this.domEventsNeeded.add("pointerdown"),t.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(t.addEventListener("pointerenter",this.onMouseEnter),t.addEventListener("pointerleave",this.onMouseLeave));for(let n of this.events){if(void 0!==n.target){let e=this.onTargetChange(n),t=n.target;this.pairOfEventListeners.push([t,e]),t.addEventListener("requestRender",e)}let e=this.createUserEventListener(n),t=n.object;this.pairOfUserEventListeners.push([t,e]),t.addEventListener("userEvent",e)}}disconnect(){if(!this.events.length)return;let{domElement:e,eventElement:t}=this.eventContext;this.domEventsNeeded.clear(),l_&&e.removeEventListener("pointerdown",this.onMouseMove),t.removeEventListener("pointermove",this.onMouseMove),e.removeEventListener("pointerenter",this.onMouseEnter),e.removeEventListener("pointerleave",this.onMouseLeave),t.removeEventListener("scroll",this.onScroll);for(let[i,n]of this.pairOfEventListeners)i.removeEventListener("requestRender",n);for(let[i,n]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",n);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let e of this.events)e.paused||this.updateSingleEvent(e)}updateSingleEvent(e){var t;let{tilt:i,axis:n,distance:r,plane:a,limitDistance:s,enabledRotation:o,limitDistanceEnabled:l}=e.data,{getCamera:c,raycaster:h}=this.eventContext,{object:d,target:u}=e;if(d.getWorldPosition(yq),!e.isReset)if(e.target)e.target.getWorldPosition(bq);else{if("custom"===a?(c().getWorldDirection(fq),fq.negate(),_q.setFromNormalAndCoplanarPoint(fq,yq)):("xy"===a?pq.set(0,0,1):"xz"===a?pq.set(0,1,0):"yz"===a&&pq.set(1,0,0),_q.setFromNormalAndCoplanarPoint(pq,yq)),!h.ray.intersectPlane(_q,bq))return;r>0&&("custom"===a||void 0===a)&&bq.addScaledVector(fq,r)}if(e.isReset||(u?"target"===i?xq.copy(u.up).applyMatrix4(mq.extractRotation(u.matrixWorld)).normalize():o.some((e=>!1===e))?("x"===n?(wq.set(0,0,1),!1===o[2]&&wq.set(0,1,0)):"y"===n?(wq.set(1,0,0),!1===o[0]&&wq.set(0,0,1)):(wq.set(0,1,0),!1===o[1]&&wq.set(1,0,0)),xq.copy(wq).applyQuaternion(e.worldQuaternion0).normalize()):xq.set(0,1,0):"custom"===a?xq.set(0,1,0):xq.copy(pq)),e.isReset)vq.copy(e.worldQuaternion0);else if(yq.distanceTo(bq)>s&&l&&u){if(e.data.snapDelay&&(e.delayFinished=!1,typeof window<"u"&&null!==e.timeoutId&&(window.clearTimeout(e.timeoutId),e.timeoutId=null)),e.wasOutside=!0,!e.data.resetAfterDistanceLimit)return;vq.copy(e.worldQuaternion0),e.currentDampingFactor=e.resetDampingFactor}else{if(e.wasOutside&&(e.data.snapDelay&&typeof window<"u"&&(e.timeoutId=window.setTimeout((()=>{e.delayFinished=!0,e.paused=!1,this.updateSingleEvent(e)}),1e3*e.data.snapDelay)),e.currentDampingFactor=e.data.dampingFactor,e.wasOutside=!1),!1===e.delayFinished)return;(function(e,t,i,n,r,a){let s=e.elements;Dq.subVectors(t,i),0===Dq.lengthSq()&&(Dq.z=1),Dq.normalize(),Tq.crossVectors(n,Dq),0===Tq.lengthSq()&&(1===Math.abs(n.z)?Dq.x+=1e-4:Dq.z+=1e-4,Dq.normalize(),Tq.crossVectors(n,Dq)),Tq.normalize(),Pq.crossVectors(Dq,Tq),"x"===r?1===a.z?[Tq,Pq,Dq]=[Dq,Tq,Pq]:(Tq.negate(),[Tq,Dq]=[Dq,Tq]):"y"===r?1===a.x?[Tq,Pq,Dq]=[Pq,Dq,Tq]:(Tq.negate(),[Pq,Dq]=[Dq,Pq]):1===a.x&&(Tq.negate(),[Tq,Pq]=[Pq,Tq]),s[0]=Tq.x,s[4]=Pq.x,s[8]=Dq.x,s[1]=Tq.y,s[5]=Pq.y,s[9]=Dq.y,s[2]=Tq.z,s[6]=Pq.z,s[10]=Dq.z})(mq,bq,yq,xq,n,wq),vq.setFromRotationMatrix(mq),gq.setFromUnitVectors(wq.applyQuaternion(vq),xq),o.some((e=>!1===e))&&"target"!==i&&vq.premultiply(gq).normalize()}e.currentDampingFactor>1?(d.updateWorldMatrix(!0,!1),gq.setFromRotationMatrix(fW(d.matrixWorld)),gq.slerp(vq,1/e.currentDampingFactor),Eq(d,mq.makeRotationFromQuaternion(gq)),e.paused=8*(1-gq.dot(vq))<1e-6):(Eq(d,mq.makeRotationFromQuaternion(vq)),e.paused=!0),null!==(t=e.object)&&void 0!==t&&t.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),d.dispatchEvent(Sq),d.dispatchEvent(Aq)}},Pq=new gl,Tq=new gl,Dq=new gl;var Rq=class{constructor(e,t,i,n,r,a){this.id=e,this.data=t,this.object=i,this.entered=!1,this.actions=CH(t,t.actions,n,r,a,i)}disconnect(){MH(this.actions)}dispatchEnter(){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.entered||(this.entered=!0,this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.play())),this.actions.Create.forEach((e=>e.dispatchStart())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent())),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())))}dispatchLeave(){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.entered&&(this.entered=!1,this.actions.Create.forEach((e=>e.dispatchStop())),this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent())))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Particles.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.Create.forEach((e=>e.dispatch())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}},Oq=class extends EW{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=e=>{f_.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseHoverEvent())},this.onMouseUp=e=>{f_.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=e=>{f_.length>1||(this.eventContext.updateRaycaster(e),this.handleMouseHoverEvent())},this.onUserEvent=e=>{var t;let{eventName:i,target:n,reverse:r}=e;if(!i||!n)return;let a=PW(i);a&&"MouseHover"===a&&(n.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(t=this.eventsPerObjects[n.uuid])||void 0===t||t.forEach((e=>e.dispatchUserEvent(r))))}}connect(){let{page:e,sharedAssets:t}=this.eventContext,i=(i,n)=>{var r;if(i.visible&&null!==(r=i.data)&&void 0!==r&&r.events.length){var a;for(let{id:n,data:r}of i.data.events)if(!r.disabled&&"MouseHover"===r.type)try{let a=new Rq(n,r,i,e,t,this.eventManager);this.eventsPerObjects[i.uuid]?this.eventsPerObjects[i.uuid].push(a):this.eventsPerObjects[i.uuid]=[a]}catch(s){}(null===(a=this.eventsPerObjects[i.uuid])||void 0===a?void 0:a.length)&&this.objects.push(i instanceof rU?n:i)}};if(e.traverseEntity((e=>{var t;(e instanceof ij||e instanceof XU)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((t=>{i(t,e)})),i(e)})),!this.objects.length)return;let{domElement:n}=this.eventContext;this.domEventsNeeded.clear(),l_&&(this.domEventsNeeded.add("pointerdown"),n.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),n.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),n.addEventListener("pointermove",this.onMouseMove),this.objects.forEach((e=>{e.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if(!this.objects.length)return;let{domElement:e}=this.eventContext;this.domEventsNeeded.clear(),l_&&(e.removeEventListener("pointerdown",this.onMouseDown),e.removeEventListener("pointerup",this.onMouseUp)),e.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach((e=>{e.forEach((e=>{e.disconnect()}))})),this.objects.forEach((e=>{e.removeEventListener("userEvent",this.onUserEvent)}))}handleMouseHoverEvent(){let e=[];if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){let{stopRaycast:t,raycaster:i,page:n,pointerScreen:r}=this.eventContext,a=!1;if(n.uiCanvas&&(a=wW(n,[r.x,r.y],Object.keys(this.eventsPerObjects),(t=>{e.push(t)}))),t&&!a){let t=bW(i,n,this.objects);e=xW(t),t.forEach((t=>{var i,n,r,a;t.object instanceof ij&&wW(t.object,[null!==(i=null===t||void 0===t||null===(n=t.uv)||void 0===n?void 0:n.x)&&void 0!==i?i:0,null!==(r=null===t||void 0===t||null===(a=t.uv)||void 0===a?void 0:a.y)&&void 0!==r?r:0],Object.keys(this.eventsPerObjects),(t=>{e.push(t)}))}))}else this.objects.forEach((t=>{var n,r,a,s;let o=_W(i,t);o&&(e.push(t),t instanceof ij&&wW(t,[null!==(n=null===o||void 0===o||null===(r=o.uv)||void 0===r?void 0:r.x)&&void 0!==n?n:0,null!==(a=null===o||void 0===o||null===(s=o.uv)||void 0===s?void 0:s.y)&&void 0!==a?a:0],Object.keys(this.eventsPerObjects),(t=>{e.push(t)})))}))}this._prevObjects.length&&this._prevObjects.forEach((t=>{var i;e.includes(t)||(t.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(i=this.eventsPerObjects[t.uuid])||void 0===i||i.forEach((e=>e.dispatchLeave())))})),e.length&&e.forEach((e=>{var t;e.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),null===(t=this.eventsPerObjects[e.uuid])||void 0===t||t.forEach((e=>e.dispatchEnter()))})),this._prevObjects=e}},Iq=class{constructor(e,t,i,n,r,a){this.id=e,this.data=t,this.object=i,this.scrollCounter=0,this.actions=CH(t,t.actions,n,r,a,i)}connect(){this.scrollCounter=0}disconnect(){MH(this.actions)}dispatch(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}));let t=e>0?1:-1;this.scrollCounter+=t,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach((e=>e.seek(i))),this.actions.Animation.forEach((e=>e.seek(t))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>{e.playFromCurrent()})),this.actions.Animation.forEach((e=>{e.playFromCurrent()}))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}},kq=class{constructor(e,t,i,n,r,a,s){this.id=e,this.data=t,this.object=i,this.domElement=a,this.eventManager=s,this.scrollStart=0,this.scrollEnd=0,this.actions=CH(t,t.actions,n,r,s,i)}getStickyParentElement(){let e=this.domElement;for(;e;){if("sticky"===window.getComputedStyle(e).position)return e;e=e.parentElement}return null}computeScrollBounds(){var e,t;let i=this.getStickyParentElement(),n=null===i||void 0===i?void 0:i.parentElement,r=this.domElement.getBoundingClientRect(),a={top:r.top,bottom:r.bottom,left:r.left,right:r.right,width:r.width,height:r.height};if(n){let e=n.getBoundingClientRect(),t=window.getComputedStyle(i),l=parseFloat(t.marginTop)+parseFloat(t.marginBottom),c=parseFloat(t.top),h=parseFloat(t.bottom),d=e.height-l;if(isNaN(c)){if(!isNaN(h)){var s,o;let t=null!==(s=document.body.clientHeight)&&void 0!==s?s:window.innerHeight,i=window.innerWidth-(null!==(o=document.documentElement.clientWidth)&&void 0!==o?o:window.innerWidth);r.bottom===t-h?(a.top+=e.top-r.height+h+i,a.bottom+=e.top-r.height+h+i):r.bottom<t-h&&(a.top-=d-r.height,a.bottom-=d-r.height)}}else r.top===c?(a.top+=e.top-c,a.bottom+=e.top-c):r.top<0&&(a.top-=d-r.height,a.bottom-=d-r.height)}let l=document.body,c=document.documentElement,h=window.pageYOffset||c.scrollTop||l.scrollTop,d=c.clientTop||l.clientTop||0,u=Math.round(a.top+h-d);if("enter"===this.data.startFrom){let e=window.innerHeight,t=a.height,i=this.data.enterAnchor,n="top"===i?e:"bottom"===i?e-t:e-.5*t;this.scrollStart=u-n}else this.scrollStart=0;this.scrollStart+=null!==(e=this.data.startOffset)&&void 0!==e?e:0,this.scrollEnd=this.scrollStart+(null!==(t=this.data.endAfter)&&void 0!==t?t:400),this.box=a,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){MH(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return void 0===this.box||0===this.box.width&&0===this.box.height&&0===this.box.top&&0===this.box.bottom}computeScroll(e){let{x:t,y:i}=e;this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}));let n=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(i-this.scrollStart)/n));this.actions.Transition.forEach((e=>e.seek(r))),this.actions.Animation.forEach((e=>e.seek(r))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}dispatch(e){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(e)}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>{e.playFromCurrent()})),this.actions.Animation.forEach((e=>{e.playFromCurrent()}))),this.actions.Create.forEach((e=>e.dispatchThrottled())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}},Lq=class extends EW{constructor(e,t){super(e),this.managers=t,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.handleResize()))}))},this.onScroll=e=>{if(!this.isInview)return;let t={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach((e=>{let[i,n]=e;i.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:t}),n.forEach((e=>e.dispatch(t)))}))},this.onWheel=e=>{!this.isInview||e.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach((t=>{let[i,n]=t;i.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:e.deltaY}),n.forEach((t=>t.dispatch(e.deltaY)))}))},this.onUserEvent=e=>{var t;let{eventName:i,target:n,reverse:r}=e;if(!i||!n)return;let a=PW(i);a&&"Scroll"===a&&(n.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),null===(t=this.wheelEventsPerObject.get(n))||void 0===t||t.forEach((e=>{e.dispatchUserEvent(r)})))}}connect(){let{page:e,sharedAssets:t,domElement:i,isExport:n}=this.eventContext,r=r=>{var a;if(null!==(a=r.data)&&void 0!==a&&a.events.length)for(let{id:l,data:c}of r.data.events)if(!c.disabled&&"Scroll"===c.type)if("load"!==c.trigger&&n){var s;let n=new kq(l,c,r,e,t,i,this.managers);this.scrollEventsPerObject.has(r)?null===(s=this.scrollEventsPerObject.get(r))||void 0===s||s.push(n):this.scrollEventsPerObject.set(r,[n])}else{var o;let i=new Iq(l,c,r,e,t,this.managers);this.wheelEventsPerObject.has(r)?null===(o=this.wheelEventsPerObject.get(r))||void 0===o||o.push(i):this.wheelEventsPerObject.set(r,[i])}};e.traverseEntity((e=>{var t;(e instanceof ij||e instanceof XU)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((e=>{r(e)})),r(e)})),this.intersectionObserver=new IntersectionObserver((e=>{let t=e[0];t&&(this.isInview=t.isIntersecting)}),{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.connect())),t.addEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.connect())),t.addEventListener("userEvent",this.onUserEvent)})),[...this.wheelEventsPerObject.values()].some((e=>e.length))&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some((e=>e.length))&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.disconnect())),t.removeEventListener("userEvent",this.onUserEvent)})),[...this.scrollEventsPerObject.entries()].forEach((e=>{let[t,i]=e;i.forEach((e=>e.disconnect())),t.removeEventListener("userEvent",this.onUserEvent)}))}},Fq=class{constructor(e,t,i,n,r,a){this.id=e,this.data=t,this.object=i,this.actions=CH(t,t.actions,n,r,a,i)}disconnect(){MH(this.actions)}dispatch(){this.actions.Transition.forEach((e=>{e.play()})),this.actions.Animation.forEach((e=>{e.play()})),this.actions.SwitchCamera.forEach((e=>{e.play()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.Create.forEach((e=>{e.dispatchFromStart()})),this.actions.Destroy.forEach((e=>{e.dispatchFromStart()}))}dispatchAfter(e){this.actions.Audio.forEach((t=>{var i;(null!==(i=t.interaction.data.triggerAfter)&&void 0!==i?i:"any")===e&&(t.interaction instanceof xV?t.interaction.audioPlayer.play():t.interaction instanceof wV&&t.interaction.dispatch())})),this.actions.Video.forEach((t=>{var i;let n=null!==(i=t.interaction.data.triggerAfter)&&void 0!==i?i:"autoplay";n===e&&(t.interaction instanceof DH?t.interaction.play("autoplay"===n):t.interaction instanceof RH&&t.interaction.dispatch())})),this.actions.Particles.forEach((t=>{var i;(null!==(i=t.data.triggerAfter)&&void 0!==i?i:"any")===e&&t.dispatchBasic()}))}dispatchUserEvent(e){this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),e?(this.actions.Transition.forEach((e=>e.reverseFromCurrent())),this.actions.Animation.forEach((e=>e.reverseFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.reverseFromCurrent()))):(this.actions.Transition.forEach((e=>e.playFromCurrent())),this.actions.Animation.forEach((e=>e.playFromCurrent())),this.actions.SwitchCamera.forEach((e=>e.playFromCurrent()))),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch()})),this.actions.Audio.forEach((e=>{e.interaction instanceof xV?e.interaction.audioPlayer.play():e.interaction instanceof wV&&e.interaction.dispatch()})),this.actions.Video.forEach((e=>{e.interaction instanceof DH?e.interaction.play():e.interaction instanceof RH&&e.interaction.dispatch()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()}))}},Bq=class extends EW{constructor(e,t){super(e),this.eventManager=t,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("mouseDown")}))}))},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("keyDown")}))}))},this.onAny=()=>{let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("any")}))}))},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.actions.Audio.forEach((e=>{e.interaction instanceof xV&&e.interaction.audioPlayer.play()})),e.actions.Video.forEach((e=>{var t;let i=null!==(t=e.interaction.data.triggerAfter)&&void 0!==t?t:"autoplay";e.interaction instanceof DH&&e.interaction.play("autoplay"===i)})),e.actions.Particles.forEach((e=>{e.dispatchBasic()}))}))}))},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>{e.dispatchAfter("autoplay")}))}))},this.onUserEvent=e=>{var t,i;let{eventName:n,target:r,reverse:a}=e;if(!n||!r)return;let s=PW(n);s&&"Start"===s&&(r instanceof rU||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),null!==(t=this.eventsPerObject.get(r))&&void 0!==t&&t.forEach((e=>{e.dispatchUserEvent(a)})),null===(i=this.eventsAfterPerObject.get(r))||void 0===i||i.forEach((e=>{e.dispatchUserEvent(a)})))}}connect(){let{sharedAssets:e,page:t}=this.eventContext,i=i=>{var n;if(null!==(n=i.data)&&void 0!==n&&n.events.length)for(let{id:l,data:c}of i.data.events){var r,a,s,o;if(c.disabled||"Start"!==c.type)continue;let n=new Fq(l,c,i,t,e,this.eventManager);(n.actions.Transition.length||n.actions.Animation.length||n.actions.SwitchCamera.length||n.actions.Create.length||n.actions.Destroy.length||n.actions.SceneTransition.length||n.actions.Reset.length||n.actions.SetVariable.length||n.actions.DynamicVariablePlay.length)&&(this.eventsPerObject.has(i)?null===(r=this.eventsPerObject.get(i))||void 0===r||r.push(n):this.eventsPerObject.set(i,[n])),n.actions.Audio.length&&(this.eventsAfterPerObject.has(i)?null===(a=this.eventsAfterPerObject.get(i))||void 0===a||a.push(n):this.eventsAfterPerObject.set(i,[n])),n.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(i)?null===(s=this.eventsAfterPerObject.get(i))||void 0===s||s.push(n):this.eventsAfterPerObject.set(i,[n])),n.actions.Particles.length&&(this.eventsAfterPerObject.has(i)?null===(o=this.eventsAfterPerObject.get(i))||void 0===o||o.push(n):this.eventsAfterPerObject.set(i,[n]))}};if(t.traverseEntity((e=>{var t;(e instanceof ij||e instanceof XU)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((e=>{i(e)})),i(e)})),[...this.eventsAfterPerObject.values()].some((e=>e.length))){if(0===this.eventManager.activateCount){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.addEventListener("pointerdown",this.onMouseDown,{once:!0}),i.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),i.addEventListener("pointerdown",this.onAny),i.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.addEventListener("userEvent",this.onUserEvent)}))}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach((e=>{let[t,i]=e;t.dispatchEvent({type:"beginEvent",eventName:"Start"}),i.forEach((e=>e.dispatch())),t.addEventListener("userEvent",this.onUserEvent)}))}disconnect(){if([...this.eventsAfterPerObject.values()].some((e=>e.length))){let{domElement:e,isExport:t}=this.eventContext,i=t?document:e;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach((e=>{let[t,i]=e;t.removeEventListener("userEvent",this.onUserEvent),i.forEach((e=>e.disconnect()))}))}[...this.eventsPerObject.entries()].forEach((e=>{let[t,i]=e;t.removeEventListener("userEvent",this.onUserEvent),i.forEach((e=>e.disconnect()))})),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},Nq=class{constructor(e,t,i,n,r,a){this.id=e,this.data=t,this.object=i,this.initialDisabled=!1,this.alreadyPlayedNonTogglingActions=new Set,this.actions=CH(t,t.actions,n,r,a,i),this.target=t.target}disconnect(){MH(this.actions)}dispatch(e){this.initialDisabled||(this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):"Once"===e.data.runMode&&this.alreadyPlayedNonTogglingActions.add(e)})),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach((e=>{!1===this.alreadyPlayedNonTogglingActions.has(e)&&("Toggle"===e.data.runMode?e.toggle():e.play())})),this.actions.Animation.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((t=>{t.dispatch(null!==e&&void 0!==e&&e)})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})))}},zq=class extends EW{constructor(e,t,i,n,r){super(e),this.sharedVariables=t,this.eventManager=i,this.needsMouse=n,this.needsRaycast=r,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=e=>{let t=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let i=new Date,n=[],r=[];for(let c=0;c<this.propertiesToWatch.length;c++){let{objectId:e,property:t,prevValue:i}=this.propertiesToWatch[c],n=this.eventContext.scene.find(e),a=pE.propertyPaths[t];if("width"===a[0]||"height"===a[0]||"depth"===a[0])n=n.geometry.userData.parameters[a[0]];else for(let r=0;r<a.length;r++)n=n[a[r]];null===i?this.propertiesToWatch[c].prevValue=n instanceof gl?n.clone():n:(n instanceof gl?!n.equals(i):i!==n)&&(r.push({objId:e,property:t}),n instanceof gl?this.propertiesToWatch[c].prevValue.copy(n):this.propertiesToWatch[c].prevValue=n)}for(let c=0;c<this.variablesToWatch.length;c++){let{id:e,prevValue:i}=this.variablesToWatch[c],r=t.getVariable(e);r!==i&&(n.push(e),this.variablesToWatch[c].prevValue=r)}for(let c=0;c<this.dynamicVars.length;c++){let{id:r,expectedTime:o,last:l,data:h,timerSeconds:d,startValue:u}=this.dynamicVars[c],p=1e3;if("timer"!==h.dynamicVariableType&&"stopwatch"!==h.dynamicVariableType||"number3decimal"!==h.format?"counter"===h.dynamicVariableType?p=h.updateInterval:"random"===h.dynamicVariableType&&(p=h.isStatic?1/0:h.updateInterval):p=1,-1!==o){if("Stopped"!==t.getDynamicVariablePlayState(r)&&"Restarted"!==t.getDynamicVariablePlayState(r)||(this.dynamicVars[c].last=e,this.dynamicVars[c].expectedTime=e+p,"counter"===h.dynamicVariableType&&t.getVariable(r)!==u&&(t.updateVariable(r,u),this.eventManager.requestRender()),("timer"===h.dynamicVariableType||"stopwatch"===h.dynamicVariableType)&&this.dynamicVars[c].timerSeconds!==u&&(this.dynamicVars[c].timerSeconds=u,t.updateVariable(r,JC.getFormattedTimerTime(u,h)),this.eventManager.requestRender()),"Restarted"===t.getDynamicVariablePlayState(r)&&t.setDynamicVariablePlayState(r,"Playing"),"Stopped"!==t.getDynamicVariablePlayState(r))){if("Paused"===t.getDynamicVariablePlayState(r)){void 0===this.dynamicVars[c].deltaToExpectedTime&&(this.dynamicVars[c].deltaToExpectedTime=Math.max(this.dynamicVars[c].expectedTime-e,0)),this.dynamicVars[c].last=e-(p-this.dynamicVars[c].deltaToExpectedTime),this.dynamicVars[c].expectedTime=e+this.dynamicVars[c].deltaToExpectedTime;continue}if(this.dynamicVars[c].deltaToExpectedTime=void 0,e>=o)if(this.dynamicVars[c].last=e,this.dynamicVars[c].expectedTime+=p,"random"===h.dynamicVariableType){let e=h.min+Math.random()*(h.max-h.min),i=h.decimals;e=Math.round(e*Math.pow(10,i))/Math.pow(10,i),t.updateVariable(r,e),n.push(r),this.eventManager.requestRender()}else if("counter"===h.dynamicVariableType){var a;let e=t.getVariable(r),i=null===(a=t.getDynamicVariableToggleIsForward(r))||void 0===a||a,s=t.getVariable(r)+h.increment*(i?1:-1);h.hasEnd&&(s=h.increment>0?Uo.clamp(s,u,h.endValue):Uo.clamp(s,h.endValue,u),s===u&&t.setDynamicVariableToggleIsForward(r,void 0),h.repeat?s===h.endValue&&(s=u):(s===u||s===h.endValue)&&t.setDynamicVariablePlayState(r,"Paused")),s!==e&&(n.push(r),t.updateVariable(r,s),this.eventManager.requestRender())}else if("time"===h.dynamicVariableType){let e=t.getVariable(r),a=RL(i,h);if("object"==typeof e&&"textValue"in e&&"object"==typeof a&&"textValue"in a){if(Array.isArray(e.textValue)&&Array.isArray(a.textValue)){if(e.textValue.every(((e,t)=>e===a.textValue[t])))continue}else if(e.textValue===a.textValue)continue}else if(e===a)continue;t.updateVariable(r,a),n.push(r),this.eventManager.requestRender()}else{var s;let i=XC.isTextValue(h.endValue)?jq(h.endValue.textValue):h.endValue,a=null===(s=t.getDynamicVariableToggleIsForward(r))||void 0===s||s,o=d+(e-l)/1e3*("timer"===h.dynamicVariableType?-1:1)*(a?1:-1);o=Math.max(o,0),h.hasEnd&&(o="stopwatch"===h.dynamicVariableType?Uo.clamp(o,u,i):Uo.clamp(o,i,u),o===u&&t.setDynamicVariableToggleIsForward(r,void 0),h.repeat?Math.abs(o-i)<("number3decimal"===h.format?1e-4:.1)&&(o=u):(Math.abs(o-u)<("number3decimal"===h.format?1e-4:.1)||Math.abs(o-i)<("number3decimal"===h.format?1e-4:.1))&&t.setDynamicVariablePlayState(r,"Paused")),o!==d&&(n.push(r),this.dynamicVars[c].timerSeconds=o,t.updateVariable(r,JC.getFormattedTimerTime(o,h)),this.eventManager.requestRender())}}}else this.dynamicVars[c].last=e,this.dynamicVars[c].expectedTime=e+p}let o=!1;t.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=t.mouseProperty,o=!0);let l=!1;t.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=t.raycastProperty,l=!0),this.events.forEach((e=>{(n.includes(e.data.variableId)||r.find((t=>t.objId===e.data.objectId&&t.property===e.data.property))||"mouseProperty"===e.data.variableId&&o||"raycastProperty"===e.data.variableId&&l)&&(e.dispatch(),this.eventManager.requestRender())}))},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let e=Date.now()-this.pauseTime;for(let t=0;t<this.dynamicVars.length;t++)this.dynamicVars[t].last+=e,this.dynamicVars[t].expectedTime+=e}connect(){this.eventContext.page.traverseEntity((e=>{var t;null===(t=e.data)||void 0===t||t.events.filter((e=>"VariableChange"===e.data.type&&!e.data.disabled)).forEach((t=>{this.events.push(new Uq(t.id,t.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))}))})),this.propertiesToWatch=this.events.filter((e=>"objectProperty"===e.data.variableId&&null!==e.data.objectId)).map((e=>({objectId:e.data.objectId,property:e.data.property,prevValue:null})));let e=this.eventContext.sharedAssets;this.sharedVariables.forEach((t=>{let i,{id:n,data:r}=t;if("dynamicVariableType"in r)if("timer"===r.dynamicVariableType||"stopwatch"===r.dynamicVariableType){let e;if(XC.isTextValue(r.value)&&Array.isArray(r.value.textValue)){let t=r.value.textValue;e=3===t.length?t[2]+60*t[1]+3600*t[0]:t[1]+60*t[0]}else e=r.value;i=e,this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:r,timerSeconds:e,startValue:i})}else"time"===r.dynamicVariableType&&e.updateVariable(n,RL(new Date,r)),"counter"===r.dynamicVariableType&&(i=XC.isTextValue(r.value)?jq(r.value.textValue):r.value),this.dynamicVars.push({id:n,last:-1,expectedTime:-1,data:r,startValue:i});else this.events.find((e=>e.data.variableId===n))&&this.variablesToWatch.push({id:n,prevValue:e.getVariable(n)})})),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach((e=>e.dispose()))}},Uq=class{constructor(e,t,i,n,r,a){this.id=e,this.data=t,this.object=i,this.actions=CH(t,t.actions,n,r,a,i)}dispatch(){let e=this.actions;e.Audio.forEach((e=>e.dispatchConditional())),e.Particles.forEach((e=>e.dispatchConditional())),e.Video.forEach((e=>e.dispatchConditional())),e.Create.forEach((e=>e.dispatch())),e.Destroy.forEach((e=>e.dispatch())),e.Reset.forEach((e=>e.dispatch())),e.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()})),e.Transition.forEach((e=>e.play())),e.Animation.forEach((e=>e.play())),e.SwitchCamera.forEach((e=>e.play())),e.SceneTransition.forEach((e=>e.dispatch())),e.SetVariable.forEach((e=>e.checkConditions())),e.SetVariable.forEach((e=>e.dispatch())),e.DynamicVariablePlay.forEach((e=>e.dispatch()))}dispose(){MH(this.actions)}};function jq(e){return 3===e.length?e[2]+60*e[1]+3600*e[0]:e[1]+60*e[0]}var Vq,Gq,Hq,Wq="\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport('".concat("https://unpkg.com/@splinetool/runtime@1.2.5/build/","' + 'navmesh.js'),\n\t\tfetch('").concat("https://unpkg.com/@splinetool/navmesh-wasm@1.2.5/build/","' + 'navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n"),qq={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1};C_.then((e=>{Vq=e,Gq=new e.Vec3,Hq=new e.Vec3}));var Xq=new gl,Yq=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.usePhysics=e,this.isExport=t,this.onPointerDown=e=>{if(1!==f_.length)return;let{raycaster:t,page:i}=this.eventContext;this.eventContext.updateRaycaster(e);let n=i.raycastWithClones(t);if(0!==n.length){if(this.gameControl){let e=Xq.copy(this.gameControl.colliderWorldPosition);e.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(e,n[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(e,t)=>i=>{var n,r,a,s,o,l;let c;if(i instanceof bB){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;c=i.object}else if(i instanceof MT)c=i.object;else if(c=i,!1===(null===(n=c.dataPatched.cloner)||void 0===n?void 0:n.disabled)&&null!==(r=c.dataPatched.cloner)&&void 0!==r&&r.hideBase&&!0!==(null===(a=c.dataPatched.physics)||void 0===a?void 0:a.fusedBody))return!0;if(t&&!c.userData.navmesh)return;let h=c.dataPatched;if(!h.visible&&!0!==(null===(s=h.physics)||void 0===s?void 0:s.enabled))return!0;i.updateMatrixWorldSVD();let d=IX(h),u=c.userData.hasDestroy,p=c.userData.hasDrag,f=!1,m=!1;for(let e of h.events)!0!==e.data.disabled&&("GameControl"===e.data.type?f=!0:"Follow"===e.data.type&&(m=!0));if(f||d||m||u||p)return!0;var g;if(this.usePhysics&&"dynamic"===(null===(o=h.physics)||void 0===o?void 0:o.rigidBody)){if(this.usePhysics&&null!==(g=h.physics)&&void 0!==g&&g.fusedBody)return!0}else if("geometry"in i&&i.geometry&&e.push(hW(i.geometry,i.matrixWorld)),this.usePhysics&&null!==(l=h.physics)&&void 0!==l&&l.fusedBody)return i.traverseObject(((t,i)=>{var n,r;if(0===i)return;let a;if(t instanceof bB){if(!t.objectForSample)return!0===t.object.dataPatched.physics.fusedBody&&"dynamic"===t.object.dataPatched.physics.rigidBody||void 0;if(t.objectForSample.dataPatched.physics.fusedBody)return;a=t.object}else if(t instanceof MT)a=t.object;else if(a=t,null!==(n=t.dataPatched.cloner)&&void 0!==n&&n.hideBase)return!0;let s=a.dataPatched;if(!s.visible&&!0!==(null===(r=s.physics)||void 0===r?void 0:r.enabled))return!0;"geometry"in t&&t.geometry&&e.push(hW(t.geometry,t.matrixWorld))})),!0},this.traverseNoPhysics=(e,t)=>i=>{let n;if(i instanceof bB)return;n=i instanceof MT?i.object:i;let r=n.dataPatched;if("visibility"===r.physics.enabled?!r.visible:!r.physics.enabled)return!0;if(t&&!n.userData.navmesh)return;let a=i.geometry,s=!0===n.userData.hasDestroy,o=!0===n.userData.hasDrag;if(IX(r)||s||o||n.dataPatched.events.some((e=>!0!==e.data.disabled&&"GameControl"===e.data.type)))return!0;a&&e.push(hW(a,i.matrixWorld))},this.navmeshWasm=Vq,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(t?Wq:"\n(async function() {\n\tconst [wasmImport, wasmBinary] = await Promise.all([\n\t\timport(self.location.origin + '/_libraries/navmesh.js'),\n\t\tfetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),\n\t]);\n\tconst wasmModule = wasmImport.default;\n\tself.module = await wasmModule({ wasmBinary });\n\tpostMessage('ready');\n})();\n")+"\n\nonmessage = function(messageEvent) {\n\tconst meshData = messageEvent.data;\n\tconst positions = meshData[0];\n\tconst offset = meshData[1];\n\tconst indices = meshData[2];\n\tconst indicesLength = meshData[3];\n\tconst parameters = meshData[4];\n\n\tconst module = self.module;\n\tconst rc = new module.rcConfig();\n\trc.cs = parameters.cs;\n\trc.ch = parameters.ch;\n\trc.borderSize = parameters.borderSize ? parameters.borderSize : 0;\n\trc.tileSize = parameters.tileSize ? parameters.tileSize : 0;\n\trc.walkableSlopeAngle = parameters.walkableSlopeAngle;\n\trc.walkableHeight = parameters.walkableHeight;\n\trc.walkableClimb = parameters.walkableClimb;\n\trc.walkableRadius = parameters.walkableRadius;\n\trc.maxEdgeLen = parameters.maxEdgeLen;\n\trc.maxSimplificationError = parameters.maxSimplificationError;\n\trc.minRegionArea = parameters.minRegionArea;\n\trc.mergeRegionArea = parameters.mergeRegionArea;\n\trc.maxVertsPerPoly = parameters.maxVertsPerPoly;\n\trc.detailSampleDist = parameters.detailSampleDist;\n\trc.detailSampleMaxError = parameters.detailSampleMaxError;\n\n\tif (!self.navMesh) {\n\t\tself.navMesh = new module.NavMesh();\n\t}\n\tself.navMesh.build(positions, offset, indices, indicesLength, rc);\n\n\tconst navmeshData = navMesh.getNavmeshData();\n\tconst arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);\n\tconst ret = new Uint8Array(navmeshData.size);\n\tret.set(arrView);\n\tnavMesh.freeNavmeshData(navmeshData);\n\n\tpostMessage(ret);\n}\n"])),this._worker=new Worker(this._workerURL)}init(e,t,i){this.gameControl=t,this.eventContext=i,this.setDefaultQueryExtent((new gl).setScalar(e.ch*e.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,e,(e=>{this.buildFromNavmeshData(e.data)}))},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(e,t,i){t.objects.forEach((t=>{var i;let n=e.scene.find(t);n.traverseEntity((e=>{e.userData.navmesh=!0})),null===(i=n.cloner)||void 0===i||i.traverseObject((e=>{e.userData.navmesh=!0}))}));let n=[],r=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(n,"custom"===t.zones);if(e.traverseChildren(r),t.objects.forEach((t=>{var i;let n=e.scene.find(t);n.traverseEntity((e=>{e.userData.navmesh=void 0})),null===(i=n.cloner)||void 0===i||i.traverseObject((e=>{e.userData.navmesh=void 0}))})),0===n.length)return!1;let a=GM(n),{positions:s,triIndices:o}=kO(a.getAttribute("position"),a.getIndex());return this._worker.postMessage([s,s.length/3,o,o.length,{...qq,...t}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let e,t,i=this.navMesh.getDebugNavMesh(),n=i.getTriangleCount(),r=new Uint32Array(3*n),a=new Float32Array(3*n*3);for(e=0;e<3*n;e++)r[e]=e;for(e=0;e<n;e++)for(t=0;t<3;t++){let n=i.getTriangle(e).getPoint(t);a[9*e+3*t+0]=n.x,a[9*e+3*t+1]=n.y,a[9*e+3*t+2]=n.z}let s=new Wc;return s.setIndex(new kc(r,1)),s.setAttribute("position",new kc(a,3)),s}getClosestPoint(e){return Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,this.navMesh.getClosestPoint(Gq)}getClosestPointToRef(e,t){Gq.x=e.x,Gq.y=e.y,Gq.z=e.z;let i=this.navMesh.getClosestPoint(Gq);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){return Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,this.navMesh.getRandomPointAround(Gq,t)}getRandomPointAroundToRef(e,t,i){Gq.x=e.x,Gq.y=e.y,Gq.z=e.z;let n=this.navMesh.getRandomPointAround(Gq,t);i.set(n.x,n.y,n.z)}moveAlong(e,t){return Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,Hq.x=t.x,Hq.y=t.y,Hq.z=t.z,this.navMesh.moveAlong(Gq,Hq)}moveAlongToRef(e,t,i){return Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,Hq.x=t.x,Hq.y=t.y,Hq.z=t.z,this.navMesh.moveAlong(Gq,Hq)}computePath(e,t){let i=this.getClosestPoint(t);if(Hq.x=i.x,Hq.y=i.y,Hq.z=i.z,Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2)+Math.pow(t.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(e);let n=this.navMesh.computePath(Gq,Hq),r=n.getPointCount(),a=[];for(let s=0;s<r;s++){let e=n.getPoint(s);a.push(new gl(e.x,e.y,e.z))}return a}createCrowd(e,t){return new Qq(this,e,t)}setDefaultQueryExtent(e){Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,this.navMesh.setDefaultQueryExtent(Gq)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(t),n=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,t);n.set(e);let r=new this.navmeshWasm.NavmeshData;r.dataPointer=n.byteOffset,r.size=e.length,this.navMesh.buildFromNavmeshData(r),this.navmeshWasm._free(n.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){var e;this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),null===(e=this.eventContext)||void 0===e||e.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(e,t,i){return Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,this.navMesh.addCylinderObstacle(Gq,t,i)}addBoxObstacle(e,t,i){return Gq.x=e.x,Gq.y=e.y,Gq.z=e.z,Hq.x=t.x,Hq.y=t.y,Hq.z=t.z,this.navMesh.addBoxObstacle(Gq,Hq,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return void 0!==this.navmeshWasm}},Qq=class{constructor(e,t,i){this.navmeshWasmWrapper=e,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(t,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(e,t){}addAgent(e,t,i){let n=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;n.radius=t.radius,n.height=t.height,n.maxAcceleration=t.maxAcceleration,n.maxSpeed=t.maxSpeed,n.collisionQueryRange=t.collisionQueryRange,n.pathOptimizationRange=t.pathOptimizationRange,n.separationWeight=t.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let r=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z),n);return this.transforms.push(i),this.agents.push(r),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new gl(0,0,0)),r}getAgentPosition(e){return this.crowd.getAgentPosition(e)}getAgentPositionToRef(e,t){let i=this.crowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){return this.crowd.getAgentVelocity(e)}getAgentVelocityToRef(e,t){let i=this.crowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){return this.crowd.getAgentNextTargetPath(e)}getAgentNextTargetPathToRef(e,t){let i=this.crowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.crowd.getAgentState(e)}overOffmeshConnection(e){return this.crowd.overOffmeshConnection(e)}agentGoto(e,t){this.crowd.agentGoto(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.crowd.agentTeleport(e,new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.crowd.getAgentParameters(e);void 0!==t.radius&&(i.radius=t.radius),void 0!==t.height&&(i.height=t.height),void 0!==t.maxAcceleration&&(i.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(i.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(i.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(i.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(i.separationWeight=t.separationWeight),this.crowd.setAgentParameters(e,i)}removeAgent(e){this.crowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.navmeshWasmWrapper.navMesh.update(),e<=.001)return;let t=1/60;{let i=Math.floor(e/t);i>10&&(i=10),i<1&&(i=1);let n=e/i;for(let e=0;e<i;e++)this.crowd.update(n)}for(let i=0;i<this.agents.length;i++){let e=this.agents[i],t=this.getAgentPosition(e);if(this.transforms[i].copy(t),this._agentDestinationArmed[i]){let n=t.x-this._agentDestination[i].x,r=t.z-this._agentDestination[i].z,a=this.reachRadii[i],s=this._agentDestination[i].y-this.reachRadii[i],o=this._agentDestination[i].y+this.reachRadii[i],l=n*n+r*r;t.y>s&&t.y<o&&l<a*a&&(this.onReachTarget(e,this._agentDestination[i]),this._agentDestinationArmed[i]=!1)}}}setDefaultQueryExtent(e){let t=new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z);this.crowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(e){let t=this.crowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t,i=this.crowd.getCorners(e),n=i.getPointCount(),r=[];for(t=0;t<n;t++){let e=i.getPoint(t);r.push(new gl(e.x,e.y,e.z))}return r}dispose(){this.crowd.destroy()}};function Kq(e){let t=!1;return e.scene.objects.forEach((i=>{"Page"===i.data.type&&!t&&i.data.publish.gameControlObject&&HC.traverseModuleInstances(e,i.id,((e,i,n)=>{for(let r of n)"GameControl"===r.data.type&&r.data.navmesh.enabled&&(t=!0)}))})),t}var Zq={type:"change"},Jq={type:"changeZoom"},$q={type:"changePan"},eX={type:"start"},tX={type:"end",changed:!0},iX={type:"end",changed:!1},nX=new ml,rX=new jo,aX=2*Math.PI,sX=new gl,oX=new jo,lX=new gl,cX=new ml,hX=new ql,dX={type:"requestRender"},uX=class extends Co{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isPlayMode:!1,isExport:!1};super(),this.object=e,this.domElement=t,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Jr,Kr],this.offset=new gl,this.eye=new gl,this.lastPosition=new gl,this.lastQuaternion=new ml,this.current=new jo,this.overShoot=new jo,this.overRatio=new jo,this.spherical=new Jm,this.sphericalDelta=new Jm,this.panOffset=new gl,this.panLeftV=new gl,this.panUpV=new gl,this.panV=new gl,this.rotateStart=new jo,this.rotateEnd=new jo,this.rotateDelta=new jo,this.panStart=new jo,this.panEnd=new jo,this.panDelta=new jo,this.dollyStart=new jo,this.dollyEnd=new jo,this.dollyDelta=new jo,this.rotationRangeFactor=new jo,this.panRangeFactor=new jo,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=e=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=e.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(lX,cX,sX),this.offset.copy(lX).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&-1===this.state&&this.rotateLeft((!0===this.autoRotateClockwise?1:-1)*this.getAutoRotationAngle()),0!==this.rotationLimitsMode&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),2!==this.rotationLimitsMode&&(this.spherical.phi+=this.sphericalDelta.phi),(1!==this.rotationLimitsMode||!0===this.autoRotate)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),0!==this.panLimitsMode&&(this.target.applyQuaternion(nX.copy(cX).invert()),this.panOffset.applyQuaternion(nX),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(cX),this.panOffset.applyQuaternion(cX)),2===this.panLimitsMode&&(this.panOffset.y=0),1===this.panLimitsMode&&(this.panOffset.x=0),-1!==this.state||this.gesture?(this.target.add(this.panOffset),this.panOffset.set(0,0,0)):(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)),this.offset.setFromSpherical(this.spherical),lX.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(hX.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(hX));let e=this.spherical.phi%aX;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(vc.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),e>0&&e>Math.PI||e<0&&e>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),-1===this.state||!0===this.enableDamping){let e=1===this.hoverRotatePanMode?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-e,this.sphericalDelta.phi*=1-e}else this.sphericalDelta.set(0,0,0);return this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>.01||8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-8?(this.dispatchEvent(Zq),this.object.dispatchEvent(dX),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0):(this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),!1)},this.onPointerDown=e=>{!1!==this.enabled&&("touch"===e.pointerType||"pen"===e.pointerType&&l_?this.onPointerDownTouch(e):this.onPointerDownMouse(e),-1!==this.state&&(this.isPointerDown=!0,this.dispatchEvent(eX),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&l_||this.domElement.setPointerCapture(e.pointerId)))},this.onPointerLeave=e=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(1===this.hoverRotatePanMode?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,sX.subVectors(this.position0,this.target0),this.spherical.setFromVector3(sX),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):2===this.hoverRotatePanMode&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=e},this.onPointerEnter=e=>{this.resetHoverEffectOnPointerLeave||void 0===this.pointerLeaveEvent?oX.set(e.clientX-this.domElement.clientWidth/2,e.clientY-this.domElement.clientHeight/2):oX.set(e.clientX-this.pointerLeaveEvent.clientX,e.clientY-this.pointerLeaveEvent.clientY),1===this.hoverRotatePanMode?(this.rotateDelta.copy(oX).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(rX,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(e.clientX,e.clientY)):2===this.hoverRotatePanMode&&(this.panDelta.copy(oX).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(e.clientX,e.clientY)),this.update()},this.onPointerMove=e=>{!1!==this.enabled&&(this.checkRaycastLock()||("touch"===e.pointerType||"pen"===e.pointerType&&l_?this.onPointerMoveTouch(e):this.onPointerMoveMouse(e),e.stopPropagation()))},this.onPointerUp=e=>{this.isPointerDown=!1,0===f_.length&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),f_.length>1&&e.preventDefault(),this.hasChange?this.dispatchEvent(tX):this.dispatchEvent(iX),this.state=-1,e&&(e.stopPropagation(),"touch"===e.pointerType||"pen"===e.pointerType&&l_||this.domElement.releasePointerCapture(e.pointerId))},this.onPointerDownMouse=e=>{let t;switch(t=this.useKeyEvents?this.mouseButtons[e.button]:this.mouseButtonsPlay[e.button],t){case 0:if(!0!==e.altKey||e.shiftKey||p_(e)){if(" "===this.key){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}break;case 4:if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2;break;case 3:if(p_(e)||e.shiftKey){if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}break;case 5:if(p_(e)||e.shiftKey){if(!1===this.enableRotate)return;this.handleMouseDownRotate(e),this.state=0}else{if(!1===this.enablePan)return;this.handleMouseDownPan(e),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=e=>{switch(this.state){case 0:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(e);break;case 1:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e);break;case 2:if(!1===this.enablePan)return;this.handleMouseMovePan(e)}this.object.wasMovedByUser=!0},this.onPointerDownTouch=e=>{switch(f_.length>1&&e.preventDefault(),this.touches[f_.length-1]){case Qr:if(!1===this.enableRotate)return void(this.state=-1);this.handleTouchStartRotate(),this.state=3;break;case Kr:if(!1===this.enablePan)return void(this.state=-1);this.handleTouchStartPan(),this.state=4;break;case Zr:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(),this.state=5;break;case Jr:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=e=>{switch(f_.length>1&&e.preventDefault(),this.state){case 3:if(!1===this.enableRotate)return;this.handleTouchMoveRotate(e),this.update();break;case 4:if(!1===this.enablePan)return;this.handleTouchMovePan(e),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(e),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this.handleTouchMoveDollyRotate(e),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=Gw((()=>this.dispatchEvent(tX)),33),this.onMouseWheel=e=>{!1===this.enabled||!1===this.enableZoom&&!1===this.enablePan||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&e.preventDefault(),this.dispatchEvent(eX),this.handleMouseWheel(e),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=e=>{if(e.preventDefault(),!1!==this.enabled&&!this.checkRaycastLock()&&!s_)if("gesturechange"===e.type){if(!1===this.enableZoom||!1===this.isTouchZoom)return;this.dispatchEvent(eX),e.scale>this.prevScale?this.dollyIn(this.getZoomScale()):e.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=e.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent(tX)},this.onContextMenu=e=>{e.preventDefault()},this.onTouchEnd=e=>{e.preventDefault()},this.onKeyDown=e=>{!1!==this.enabled&&(this.key=e.key," "===e.key&&this.dispatchEvent(eX))},this.onKeyUp=e=>{!1!==this.enabled&&(this.key=void 0,-1!==this.state&&"Alt"===e.key&&this.onPointerUp(f_[0])," "===e.key&&this.dispatchEvent(tX))},this.onPointerHover=e=>{"mouse"!==e.pointerType||!1===this.enabled||-1!==this.state||2===this.hoverRotatePanMode&&this.isPanOverShoot||1===this.hoverRotatePanMode&&this.isRotateOverShoot||(this.isPointerDown=!0,2===this.hoverRotatePanMode?this.handleMouseMovePan(e,this.hoverRotatePanStrength):1===this.hoverRotatePanMode&&this.handleMouseMoveRotate(e,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=e=>{e.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.addEventListenersToCamera()}dispatchEvent(e){"start"===e.type?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(e)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(e){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=e,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(e,t){var i,n;this.setEnableDampingSpeed(e.enableDamping),this.enablePan=e.enablePan,this.enableZoom=e.enableZoom,this.enableRotate=e.enableRotate,this.rotationLimitsMode=e.rotationLimitsMode,this.thetaIsFree=e.rotationHorizontalOffset.min===e.rotationHorizontalOffset.max&&e.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=e.rotationVerticalOffset.min===e.rotationVerticalOffset.max&&e.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=e.panLimitsMode,this.panSoftLimit=e.panSoftLimit,this.rotationSoftLimit=e.rotationSoftLimit,this.hoverRotatePanMode=e.hoverRotatePanMode,this.hoverRotateDamping=null!==(i=e.hoverRotateDamping)&&void 0!==i?i:this.dampingFactor,this.useWindowEvents="window"===t,0!==this.hoverRotatePanMode&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let r=e.hoverRotatePanStrength/100;this.hoverRotatePanStrength=r**2,this.zoomLimitsEnabled=e.zoomLimitsEnabled,this.minZoom=e.zoomLimits.min,this.maxZoom=Math.max(e.zoomLimits.min,e.zoomLimits.max),this.minDistance=1e3/e.zoomLimits.max,this.maxDistance=Math.max(this.minDistance,1e3/e.zoomLimits.min),this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed,this.autoRotateClockwise=e.autoRotateClockwise;let a=this.object.getTarget().applyQuaternion(nX.copy(this.object.quaternion).invert());this.minV=-e.panVerticalOffset.min+a.y,this.maxV=e.panVerticalOffset.max+a.y,this.minH=-e.panHorizontalOffset.min+a.x,this.maxH=e.panHorizontalOffset.max+a.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=pX(this.spherical.phi-e.rotationVerticalOffset.min),this.maxPhi=pX(this.spherical.phi+e.rotationVerticalOffset.max),this.minTheta=pX(pX(this.spherical.theta)-e.rotationHorizontalOffset.min),this.maxTheta=pX(pX(this.spherical.theta)+e.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,1===e.orbitTouches&&(this.touches[0]=Qr),1===e.panTouches&&(this.touches[0]=Kr),2===e.orbitTouches&&(this.touches[1]=Jr),2===e.panTouches&&(this.touches[1]=Zr),3===e.orbitTouches&&(this.touches[2]=Qr),3===e.panTouches&&(this.touches[2]=Kr),this.isTouchZoom=e.isTouchZoom,this.resetHoverEffectOnPointerLeave=null!==(n=e.resetHoverEffectOnPointerLeave)&&void 0!==n&&n}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),0!==this.hoverRotatePanMode&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(e,t,i,n,r,a,s,o){let l,c,h;this.overShoot.set(0,0),e instanceof gl?(l=e.x,c=e.y,this.current.set(this.target.x,this.target.y),h=!0):(l=e.theta,c=e.phi,this.current.set(pX(this.spherical.theta),pX(this.spherical.phi)),h=!1),0===i&&(this.current.x+=l,this.current.y+=c),(3===t||2===t)&&(!h&&this.isThetaFlipped?this.current.x>n&&this.current.x<0?this.overShoot.x=n-this.current.x:this.current.x<r&&this.current.x>0&&(this.overShoot.x=r-this.current.x):this.current.x>n?this.overShoot.x=n-this.current.x:this.current.x<r&&(this.overShoot.x=r-this.current.x)),(3===t||1===t)&&(this.current.y>a?this.overShoot.y=a-this.current.y:this.current.y<s&&(this.overShoot.y=s-this.current.y)),h||(this.overShoot.x=pX(this.overShoot.x),this.overShoot.y=pX(this.overShoot.y)),0!==i?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),1===i&&(this.overRatio.x=fX(Math.abs(this.overRatio.x)),this.overRatio.y=fX(Math.abs(this.overRatio.y))),this.isPointerDown||1===i?2===i&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):2===i&&(!h&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||h&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=.05*this.overShoot.x),this.phiIsFree||(c=.05*this.overShoot.y),h?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):h?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),e instanceof gl?(e.x=l,e.y=c):(this.thetaIsFree||(e.theta=l),this.phiIsFree||(e.phi=c))}setEnableDampingSpeed(e){this.enableDamping=e,this.rotateSpeed=!0===e?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(e){this.sphericalDelta.theta-=e}rotateUp(e){this.sphericalDelta.phi-=e}panLeft(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}panUp(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}pan(e,t){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let n=this.object.position;this.panV.copy(n).sub(this.target);let r=this.panV.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/i.clientHeight,this.object.matrixWorld),this.panUp(2*t*r/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(e*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent($q)}dollyOut(e){this.object.isPerspectiveCamera?this.scale/=e:this.object.isOrthographicCamera&&(this.object.zoom*=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Jq)}dollyIn(e){this.object.isPerspectiveCamera?this.scale*=e:this.object.isOrthographicCamera&&(this.object.zoom/=e,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Jq)}zoomOut(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(eX),this.dollyOut(e),this.dispatchEvent(tX)}zoomIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getZoomScale();this.dispatchEvent(eX),this.dollyIn(e),this.dispatchEvent(tX)}handleMouseDownRotate(e){this.rotateStart.set(e.clientX,e.clientY)}handleMouseDownDolly(e){this.dollyStart.set(e.clientX,e.clientY)}handleMouseDownPan(e){this.panStart.set(e.clientX,e.clientY)}handleMouseMoveRotate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==e.movementX?this.rotateDelta.set(e.movementX,e.movementY):(this.rotateEnd.set(e.clientX,e.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*t).rotateAround(rX,-this.object.angleOffsetFromUp);let i=this.domElement,n=this.useWindowEvents?window.innerHeight:i.clientHeight,r=2*Math.PI*this.rotateDelta.x/n,a=2*Math.PI*this.rotateDelta.y/n;this.rotateLeft(r),this.rotateUp(a),this.update()}handleMouseMoveDolly(e){this.dollyEnd.set(e.clientX,e.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;void 0!==e.movementX?this.panDelta.set(e.movementX,e.movementY):(this.panEnd.set(e.clientX,e.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*t),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(e){if(!1===o_&&!1===p_(e)&&!0===function(e){return 0===e.wheelDeltaY||0===e.deltaY?!(a_&&e.shiftKey&&Math.abs(e.wheelDeltaX)>=120)&&(e.wheelDeltaX?e.wheelDeltaX===-3*e.deltaX||e.wheelDeltaX===-3*window.devicePixelRatio*e.deltaX:0===e.deltaMode):e.wheelDeltaY?e.wheelDeltaY===-3*e.deltaY||e.wheelDeltaY===-3*window.devicePixelRatio*e.deltaY:0===e.deltaMode}(e)){if(!1===this.enablePan)return;this.gesture?(this.panDelta.set(-e.deltaX,-e.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),e.altKey?this.pan(0,this.panDelta.y):e.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout((()=>{this.gesture=!1,this.isPointerDown=!1}),30)}else{if(!1===this.enableZoom)return;0===e.deltaY?e.deltaX<0?this.dollyIn(this.getZoomScale()):e.deltaX>0&&this.dollyOut(this.getZoomScale()):e.deltaY<0?this.dollyIn(this.getZoomScale()):e.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(2===f_.length){let e=.5*(f_[0].pageX+f_[1].pageX),t=.5*(f_[0].pageY+f_[1].pageY);this.rotateStart.set(e,t)}else this.rotateStart.set(f_[0].pageX,f_[0].pageY)}handleTouchStartPan(){if(2===f_.length){let e=.5*(f_[0].pageX+f_[1].pageX),t=.5*(f_[0].pageY+f_[1].pageY);this.panStart.set(e,t)}else this.panStart.set(f_[0].pageX,f_[0].pageY)}handleTouchStartDolly(){let e=f_[0].pageX-f_[1].pageX,t=f_[0].pageY-f_[1].pageY,i=Math.sqrt(e*e+t*t);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(e){if(2===f_.length){let t=w_(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this.rotateEnd.set(i,n)}else{if(e.pointerId!==f_[0].pointerId)return;this.rotateEnd.set(e.pageX,e.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let t=this.domElement;t&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/t.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/t.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(e){if(2===f_.length){let t=w_(e),i=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this.panEnd.set(i,n)}else{if(e.pointerId!==f_[0].pointerId)return;this.panEnd.set(e.pageX,e.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(e){let t=w_(e),i=e.pageX-t.x,n=e.pageY-t.y,r=Math.sqrt(i*i+n*n);this.dollyEnd.set(0,r),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enablePan&&this.handleTouchMovePan(e)}handleTouchMoveDollyRotate(e){this.enableZoom&&!0===this.isTouchZoom&&this.handleTouchMoveDolly(e),this.enableRotate&&this.handleTouchMoveRotate(e)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{var e;let t=null===(e=this.options)||void 0===e?void 0:e.showCameraLock;return t&&t(),!0}}return!1}};function pX(e){let t=2*Math.PI;for(;e<=-Math.PI;)e+=t;for(;e>Math.PI;)e-=t;return e}function fX(e){return 1-Math.pow(1-e,4)}var mX,gX=class{constructor(e,t,i,n,r,a){this.id=e,this.data=t,this.object=i,this.page=n,this.currentIntersectedObjects=[],this.alreadyPlayedNonTogglingActions=new Set,this.actions=CH(t,t.actions,n,r,a,i),this.target=t.target,this.triggeringObjects=[];for(let s of t.triggeringObjects){let e=n.scene.find(s);e&&this.triggeringObjects.push(e)}}isValidTriggeringObject(e){return"all"===this.target||this.triggeringObjects.some((t=>t===e||t.isAncestorOf(e.uuid)||e.isAncestorOf(t.uuid)))}disconnect(){MH(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this?(e.object.currentTransitionEvent=this,e.init()):"Once"===e.data.runMode&&this.alreadyPlayedNonTogglingActions.add(e)})),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach((e=>{!1===this.alreadyPlayedNonTogglingActions.has(e)&&("Toggle"===e.data.runMode?e.toggle():e.play())})),this.actions.SwitchCamera.forEach((e=>{"Toggle"===e.data.runMode?e.toggle():e.play()})),this.actions.Link.forEach((e=>{e.dispatch()})),this.actions.Reset.forEach((e=>{e.dispatch()})),this.actions.Create.forEach((e=>{e.dispatch()})),this.actions.Destroy.forEach((e=>{e.dispatch(!1)})),this.actions.Audio.forEach((e=>{e.dispatchBasic()})),this.actions.Particles.forEach((e=>{e.dispatchBasic()})),this.actions.Video.forEach((e=>{e.dispatchBasic()})),this.actions.SceneTransition.forEach((e=>{e.dispatch()})),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch())))}};D_.then((e=>mX=e));var vX=new gl,yX=new ml,bX=new gl,xX=new ic(0,0,0,"YXZ"),wX=new ic(0,0,0,"XYZ"),_X=new gl,SX=new gl,AX=new gl(1,1,1),EX=new ml,CX=new ql,MX=new ql,PX={type:"updateMatrix"},TX=new ml,DX=new Bl,RX={type:"beginEvent",eventName:"Collision"},OX={type:"beginEvent",eventName:"Trigger"};var IX=e=>e.states.some((e=>void 0!==e.data.position||void 0!==e.data.rotation||void 0!==e.data.hiddenMatrix||void 0!==e.data.cloner||void 0!==e.data.pathSnapping)),kX=class{constructor(e){this.eventContext=e,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.processRigidBody=e=>{if(e.bodyType()!==mX.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[t,i,n]=this.rigidBodyToMesh.get(e.handle);if(vX.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),yX.copy(e.rotation()),t.matrixWorld.compose(vX,yX,i),t.hasNonUniformScale&&t.matrixWorld.multiply(t.shearScale),t.dispatchEvent(PX),n){let e=t.cloner;if(e&&void 0===e.objectForSample){e.matrixWorld.copy(t.matrixWorld);for(let t of e.children)t.updateMatrixWorld(!0)}for(let i of t.children)i.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,t,i)=>{var n,r;if(!1===i)return;let a,s;if(this.sensorToTriggerEvent[e]?(a=this.sensorToTriggerEvent[e],s=this.sharedGameControlGlobals.colliderToEntity.get(t)):this.sensorToTriggerEvent[t]&&(a=this.sensorToTriggerEvent[t],s=this.sharedGameControlGlobals.colliderToEntity.get(e)),a&&s&&a.isValidTriggeringObject(s))a.dispatch();else{for(let i=this.sharedGameControlGlobals.createdObjects.length-1;i>=0;i--){var o,l;let n=this.sharedGameControlGlobals.createdObjects[i];if(n.userData.hasCollisionDestroy&&((null===(o=n.rigidBody)||void 0===o?void 0:o.collider(0).handle)===e||(null===(l=n.rigidBody)||void 0===l?void 0:l.collider(0).handle)===t)){this.sharedGameControlGlobals.createdObjects.splice(i,1),n.removeFromParent(),requestAnimationFrame((()=>{var e;return null===(e=this.sharedGameControlGlobals.rapierWorld)||void 0===e?void 0:e.removeRigidBody(n.rigidBody)}));break}}if(void 0!==(null===(n=this.gameControl)||void 0===n?void 0:n.object)&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let e=this.sharedGameControlGlobals.colliderToEntity.get(t),i=this.sharedGameControlGlobals.entityToCollisionEvents[e.uuid];if(void 0===i)return;for(let n of i)"character"===n.data.target&&this.dispatchCollisionEvent(n,e,t)}else if(void 0!==(null===(r=this.gameControl)||void 0===r?void 0:r.object)&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(t)){let t=this.sharedGameControlGlobals.colliderToEntity.get(e),i=this.sharedGameControlGlobals.entityToCollisionEvents[t.uuid];if(void 0===i)return;for(let n of i)"character"===n.data.target&&this.dispatchCollisionEvent(n,t,e)}else{let i=this.sharedGameControlGlobals.colliderToEntity.get(e),n=this.sharedGameControlGlobals.entityToCollisionEvents[i.uuid];if(void 0!==n)for(let t of n)"scene"===t.data.target&&this.dispatchCollisionEvent(t,i,e);let r=this.sharedGameControlGlobals.colliderToEntity.get(t),a=this.sharedGameControlGlobals.entityToCollisionEvents[null===r||void 0===r?void 0:r.uuid];if(void 0!==a)for(let e of a)"scene"===e.data.target&&this.dispatchCollisionEvent(e,r,t)}}},this.isExport=e.isExport,this.sharedAssets=e.sharedAssets,this.renderer=e.renderer,this.requestRender=e.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=200,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(e){e.forEach((e=>{e.addEventListener("connected",(e=>{"gamepad"in e.data&&"axes"in e.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(e.data.gamepad)}))}))}markIsDestroyTarget(){this.page.traverseVisibleEntity((e=>{let t=e.dataPatched;for(let n of t.events){var i;if(!0===n.data.disabled)continue;let e=null===(i=n.data.actions)||void 0===i||null===(i=i.find((e=>"Destroy"===e.data.type)))||void 0===i?void 0:i.data;if(e)for(let t of e.objects){let e=this.page.scene.find(t);e&&(e.userData.hasDestroy=!0)}}}))}markIsDragObject(){this.page.traverseVisibleEntity((e=>{let t=e.dataPatched;for(let i of t.events)if(!0!==i.data.disabled&&"DragDrop"===i.data.type)for(let e of i.data.objects){let t=this.page.scene.find(e);t&&(t.userData.hasDrag=!0)}}))}initBVH(){let e=[];if(this.page.traverseChildren((t=>{var i,n;let r;if(t instanceof bB||t instanceof KB||t instanceof gj)return;r=t instanceof MT?t.object:t;let a=r.dataPatched;if("visibility"===(null===(i=a.physics)||void 0===i?void 0:i.enabled)?!a.visible:null===(n=a.physics)||void 0===n||!n.enabled)return!0;let s=t.geometry,o=!0===r.userData.hasDestroy,l=!0===r.userData.hasDrag;if(IX(a)||o||l||r.dataPatched.events.some((e=>!0!==e.data.disabled&&"GameControl"===e.data.type)))return t.updateMatrixWorldSVD(),this.addBoundsTree(t),!0;s&&e.push(hW(s,t.matrixWorld))})),e.length>0){let t=GM(e,!1);this.sharedGameControlGlobals.staticMeshBVH=new sT(t)}}addRigidBody(e,t,i){let n=[],r="geometry"in e?e.geometry:void 0,a=t.dataPatched;if(void 0!==(null===r||void 0===r?void 0:r.getAttribute("position"))&&n.push(hW(r,e.shearScale)),a.physics.fusedBody){let t=this.gatherChildrenGeom(e,n);e.traverseObject(t),e.children.forEach((e=>e.updateMatrixWorld(!0)));let i=e.cloner;i&&void 0===i.objectForSample&&"dynamic"===a.physics.rigidBody&&(i.traverseObject(t),i.children.forEach((e=>e.updateMatrixWorld(!0))))}if(n.length>0){let o,l=!i.fromCreate&&"dynamic"===a.physics.rigidBody||i.fromCreate&&i.dynamic;l?(o=mX.RigidBodyDesc.dynamic(),o.setLinearDamping(a.physics.damping).setAngularDamping(a.physics.damping).setAdditionalMass(1e-9).setGravityScale(a.physics.gravityScale).enabledRotations(...a.physics.enabledRotation).enabledTranslations(...a.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(o=mX.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e)):o=mX.RigidBodyDesc.fixed();let c=GM(n);(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(vX,yX,bX),e.position0=vX.clone().divideScalar(this.pixelsPerMeter),e.rotation0=yX.clone(),vX.divideScalar(this.pixelsPerMeter),o.setTranslation(vX.x,vX.y,vX.z).setRotation(yX),r?null===c||void 0===c||c.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):null===c||void 0===c||c.scale(bX.x/this.pixelsPerMeter,bX.y/this.pixelsPerMeter,bX.z/this.pixelsPerMeter);let h=this.sharedGameControlGlobals.rapierWorld.createRigidBody(o);l&&this.rigidBodyToMesh.set(h.handle,[e,bX.clone(),a.physics.fusedBody]);let d=!(void 0===a.geometry||"SubdivGeometry"===a.geometry.type||"NonParametricGeometry"===a.geometry.type||"BooleanGeometry"===a.geometry.type||"VectorGeometry"===a.geometry.type||"StarGeometry"===a.geometry.type||"RectangleGeometry"===a.geometry.type||"EllipseGeometry"===a.geometry.type||"TriangleGeometry"===a.geometry.type||"TorusGeometry"===a.geometry.type||"HelixGeometry"===a.geometry.type);try{this.addCollider(h,a.physics,c,t,d)}catch{try{this.addCollider(h,a.physics,c,t,!1)}catch(s){console.error(s)}}e.rigidBody=h}}addBoundsTree(e){var t,i;let n=[];if(void 0!==(null===(t=e.geometry)||void 0===t?void 0:t.getAttribute("position"))&&(null===(i=e.geometry)||void 0===i?void 0:i.getAttribute("position").count)>0&&n.push(hW(e.geometry,e.shearScale)),e.traverseObject(this.gatherChildrenGeom(e,n)),e.children.forEach((e=>e.updateMatrixWorld(!0))),n.length>0){let t=GM(n,!1);e.bvhGeometry=t,t.getAttribute("position").count>0&&(e.bvhGeometry.boundsTree=new sT(t),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(e))}}addCollider(e,t,i,n){var r,a;let s,o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(0===(null===i||void 0===i?void 0:i.getAttribute("position").count)||0===(null===i||void 0===i||null===(r=i.getIndex())||void 0===r?void 0:r.count))return;i&&(s="trimesh"===t.colliderType?mX.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):mX.ColliderDesc.convexMesh(i.getAttribute("position").array,o?i.getIndex().array:void 0)),s.setFrictionCombineRule(mX.CoefficientCombineRule.Average).setRestitutionCombineRule(mX.CoefficientCombineRule.Average).setDensity(t.density).setFriction(t.friction).setRestitution(t.restitution);let l=this.sharedGameControlGlobals.rapierWorld.createCollider(s,e);this.sharedGameControlGlobals.colliderToEntity.set(l.handle,n),(null===(a=this.sharedGameControlGlobals.entityToCollisionEvents[n.uuid])||void 0===a?void 0:a.some((e=>"scene"===e.target)))&&l.setActiveEvents(mX.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(e,t){return(i,n)=>{var r;if(0===n)return;let a;if(i instanceof bB){if(!i.objectForSample)return!0===i.object.dataPatched.physics.fusedBody&&"dynamic"===i.object.dataPatched.physics.rigidBody||void 0;if(i.objectForSample.dataPatched.physics.fusedBody)return;a=i.object}else if(i instanceof MT)a=i.object;else if(a=i,null!==(r=a.dataPatched.cloner)&&void 0!==r&&r.hideBase)return!0;let s=a.dataPatched;if("visibility"===s.physics.enabled?!s.visible:!s.physics.enabled)return!0;1===n?e.hasNonUniformScale?i.matrixWorld.multiplyMatrices(e.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let o=i.geometry;void 0!==(null===o||void 0===o?void 0:o.getAttribute("position"))&&t.push(hW(o,i.matrixWorld))}}activate(e){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=e,this.usePhysics=this.page.data.globalPhysics.usePhysics;let t=this.page.playCamera,i=!1,n=5,r=8,a=9,s="drag",o=this.page.data.publish.gameControlObject,l=null!==o?this.page.find(o):null,c=null;if(l)for(let f of l.data.events){if(f.data.disabled||"GameControl"!==f.data.type)continue;let e=l;for(;this.usePhysics&&null!==(null===(h=e=e.parent)||void 0===h?void 0:h.parent);){var h,d;null===(d=e.data.physics)||void 0===d||d.fusedBody}f.data.collisionEnabled&&(this.needsCollisionDetection=!0),null===c&&(c=f.data)}if(this.page.traverseEntity((e=>{for(let t of e.dataPatched.events)if(!1===t.data.disabled&&"Trigger"===t.data.type)return this.needsCollisionDetection=!0,!0})),l&&c&&(!0===l.data.visible||!0===l.data.physics.enabled)){i=i||c.camera===t.uuid||l.uuid===t.uuid;let e=new lW(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==t.uuid&&c.camera===t.uuid,t,this.page,this.sharedAssets);this.gameControl=e,n=c.joystickPosLoc,r=c.joystickRotLoc,a=c.jumpTouchButtonLoc,s=c.rotByTouch,l_&&c.touchControl&&(this.joystickToGameControls[n]="pos","walk"===c.moveMode&&(this.joystickToGameControls[a]="jmp"),"joystick"===s&&(this.joystickToGameControls[r]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let e=this.gameControl.data;if(!this.navigationMeshWrapper){let t;this.navigationMeshWrapper=new Yq(this.usePhysics,this.isExport),t="sphere"===e.collider.type?2*e.collider.radius:e.collider.height,t=Math.floor(t/e.navmesh.ch-1),this.navigationMeshWrapper.init({...e.navmesh,walkableHeight:t},this.gameControl,this.eventContext)}}if(!1===i){let{enableRotate:e,enablePan:i,enableZoom:n,autoRotate:r,hoverRotatePanMode:a}=this.eventManager.publish.orbitControls;(e||i||n||r||0!==a)&&(this.orbitControls=new uX(t,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),p=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach(((e,t)=>{let i=document.body.appendChild(document.createElement("div")),[n,r,a]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[t],s=(u-5*n)/4+n,o={},l="jmp"===e,c=l?0:n;t<10?(t<5?o.top=c/2:o.bottom=c/2,o.left=c/2+t%5*s):10===t?(o.left=c/2,o.top=p/2):(o.right=c/2,o.top=p/2),o.top?o.top-=r[1]:o.bottom+=r[1],o.left?o.left+=r[0]:o.right-=r[0];for(let u in o)o[u]+="px";if(l){let e=i.appendChild(document.createElement("div"));Object.assign(e.style,o,{position:"absolute",width:n+"px",height:n+"px",backgroundColor:"rgba(255,255,255,".concat("show"===a?.4:0,")"),zIndex:"9999",borderRadius:n+"px",border:"show"===a?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let r=n/16*16*.4;return"show"===a&&(e.innerHTML='\n\t\t\t\t\t\t<svg width="'.concat(r,'" height="').concat(.4*n,'" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t\t\t\t<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t')),e.addEventListener("pointerdown",(()=>{this.gameControl.movementState.jump=1,this.requestRender()})),e.addEventListener("touchend",(e=>e.preventDefault())),void(this.joysticks[t]=[void 0,i])}let h={zone:i,mode:"static",position:o,size:n};"hide"===a&&(h.restOpacity=0);let d=vV(h);d.on("move",((t,i)=>{let n=this.gameControl;"pos"===e?i.force<.2?n.moveForce=0:(n.movementState.movePosZ=Math.sin(-i.angle.radian),n.movementState.movePosX=Math.cos(-i.angle.radian),i.force>1.2?n.movementState.run=1:n.movementState.run=0,i.force<.3?n.moveForce=(i.force-.2)/.1:n.moveForce=1):"rot"===e&&(i.force<.2?n.rotForce=0:(n.movementState.rotPosX=i.vector.y,n.movementState.rotPosY=-i.vector.x,i.force<.3?n.rotForce=(i.force-.2)/.1:n.rotForce=1)),this.requestRender()})),d.on("end",((t,i)=>{let n=this.gameControl;"pos"===e?(n.movementState.movePosZ=0,n.movementState.movePosX=0,n.moveForce=1):"rot"===e&&(n.movementState.rotPosX=0,n.movementState.rotPosY=0,n.rotForce=1)})),this.joysticks[t]=[d,i]})),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout((()=>{this.collisionEvents.forEach((e=>e.initialDisabled=!1))}),80)}initPhysics(){var e;null!==(e=this.sharedGameControlGlobals.rapierWorld)&&void 0!==e&&e.free(),this.sharedGameControlGlobals.rapierWorld=new mX.World(new mX.Vector3(0,this.gravity,0)),this.events=new mX.EventQueue(!0);let t=[],i=[];if(this.page.traverseChildren((e=>{var n;let r;if(e instanceof bB){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;r=e.object}else if(e instanceof MT)r=e.object;else{var a,s,o;if(e instanceof gj||e instanceof KB)return;if(r=e,!1===(null===(a=r.dataPatched.cloner)||void 0===a?void 0:a.disabled)&&null!==(s=r.dataPatched.cloner)&&void 0!==s&&s.hideBase&&!0!==(null===(o=r.dataPatched.physics)||void 0===o?void 0:o.fusedBody))return!0}let l,c=r.dataPatched;for(let t of c.events)!0!==t.data.disabled&&"GameControl"===t.data.type&&(l=t.data);if(!c.physics||("visibility"===c.physics.enabled?!c.visible:!c.physics.enabled))return!0;e.updateMatrixWorldSVD();let h=IX(c),d=!1,u=r.userData.hasDestroy,p=r.userData.hasDrag,f=!1;for(let t of c.events)if(!0!==t.data.disabled)if("Collision"===t.data.type){d=!0;let e=new Nq(t.id,t.data,r,this.page,this.sharedAssets,this.eventManager);e.initialDisabled=!0,this.collisionEvents.push(e),this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid].every((e=>e.id!==t.id))?this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid].push(e):this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]=[e]}else if("Follow"===t.data.type){f=!0;let i=t.data.target;e.traverseVisible((e=>{e.userData.isFollowingObj=i}))}"dynamic"===c.physics.rigidBody&&!1===c.physics.fusedBody&&(e.matrixWorldFusedFalse=e.matrixWorld.clone());let m=e.geometry;if(void 0!==l){let t=mX.RigidBodyDesc.kinematicPositionBased();(e.hasNonUniformScale?e.matrixWorldRigid:e.matrixWorld).decompose(vX,yX,bX),e.position0=vX.clone().divideScalar(this.pixelsPerMeter),e.rotation0=yX.clone(),vX.divideScalar(this.pixelsPerMeter),t.setTranslation(vX.x,vX.y,vX.z).setRotation(yX);let i,n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(t);e.rigidBody=n,i="sphere"===l.collider.type?mX.ColliderDesc.ball(l.collider.radius/this.pixelsPerMeter):"capsule"===l.collider.type?mX.ColliderDesc.capsule((l.collider.height/2-l.collider.radius)/this.pixelsPerMeter,l.collider.radius/this.pixelsPerMeter):mX.ColliderDesc.cuboid(l.collider.width/this.pixelsPerMeter/2,l.collider.height/this.pixelsPerMeter/2,l.collider.depth/this.pixelsPerMeter/2),i.setFrictionCombineRule(mX.CoefficientCombineRule.Average).setRestitutionCombineRule(mX.CoefficientCombineRule.Average).setDensity(c.physics.density).setFriction(c.physics.friction).setRestitution(c.physics.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(i,n);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),vX.fromArray(l.collider.position).multiply(bX.setFromMatrixScale(r.matrixWorld)).divideScalar(this.pixelsPerMeter),a.setTranslationWrtParent(vX);let s=(new ml).setFromEuler((new ic).setFromVector3((new gl).fromArray(l.collider.rotation)));a.setRotationWrtParent(s),a.setActiveEvents(mX.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(r,!0)}else"dynamic"===c.physics.rigidBody||h||f||u||p||d?(this.addRigidBody(e,r,{hasFollow:f,hasTransformAnim:h,hasDrag:p}),this.generateSensorColliderDescs(r,c.physics.fusedBody)):(m&&t.push(hW(m,e.matrixWorld)),c.physics.fusedBody&&e.traverseObject(((e,i)=>{if(0===i)return;let n;if(e instanceof bB){if(!e.objectForSample)return!0===e.object.dataPatched.physics.fusedBody&&"dynamic"===e.object.dataPatched.physics.rigidBody||void 0;if(e.objectForSample.dataPatched.physics.fusedBody)return;n=e.object}else{var r;if(e instanceof gj||e instanceof KB)return;if(e instanceof MT)n=e.object;else if(n=e,null!==(r=n.dataPatched.cloner)&&void 0!==r&&r.hideBase)return!0}let a=n.dataPatched;if("visibility"===a.physics.enabled?!a.visible:!a.physics.enabled)return!0;let s=e.geometry;void 0!==(null===s||void 0===s?void 0:s.getAttribute("position"))&&t.push(hW(s,e.matrixWorld))})),this.generateSensorColliderDescs(r,c.physics.fusedBody,i));return!(!0!==(null===(n=c.physics)||void 0===n?void 0:n.fusedBody)&&!l)||void 0})),0===t.length)return;let n=GM(t);n.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=mX.RigidBodyDesc.fixed(),a=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=mX.ColliderDesc.trimesh(n.getAttribute("position").array,n.getIndex().array).setFrictionCombineRule(mX.CoefficientCombineRule.Multiply).setRestitutionCombineRule(mX.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,a);for(let[o,l]of i){let e=this.sharedGameControlGlobals.rapierWorld.createCollider(o,a);this.sensorToTriggerEvent[e.handle]=l}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity((e=>{for(let t of e.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let i=new gX(t.id,t.data,e,this.page,this.sharedAssets,this.eventManager),n=(new ql).compose(_X.fromArray(t.data.position),EX.setFromEuler(wX.fromArray(t.data.rotation)),AX);if("box"===t.data.triggerZone){let r=new bl;r.min.fromArray(t.data.size).multiplyScalar(-.5),r.max.fromArray(t.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([r,n,e,i])}else this.sharedGameControlGlobals.triggers.push([t.data.radius,n,e,i])}})),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach((e=>e.disconnect())),this.sharedGameControlGlobals.triggers.forEach((e=>e[3].disconnect())),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){var e,t,i,n;this.isEnabled=!1,this.page.traverse((e=>{let t=e;t.matrixWorldFusedFalse&&(t.matrixWorldFusedFalse=void 0),t.rigidBody&&(t.rigidBody=void 0),t.position0&&(t.position0=void 0),t.rotation0&&(t.rotation0=void 0)})),null!==(e=this.sharedGameControlGlobals.rapierWorld)&&void 0!==e&&e.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),null!==(t=this.gameControl)&&void 0!==t&&t.reset(),null!==(i=this.gameControl)&&void 0!==i&&i.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach((e=>{let[t,i]=e;null!==t&&void 0!==t&&t.destroy(),i.remove()})),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),null!==(n=this.navigationMeshWrapper)&&void 0!==n&&n.dispose(),this.navigationMeshWrapper=void 0;for(let e of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))e.forEach((e=>e.disconnect()));this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(e,t,i){if(!this.isEnabled)return!0;let n=!0;if(void 0!==this.orbitControls&&this.orbitControls.needsUpdate&&(n=!this.orbitControls.update()),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,n=!1):2===this.initializationCounter&&this.gameControl&&(n=!this.gameControl.update(e,t,i)&&n),!1===this.usePhysics&&this.checkTrigger(),this.usePhysics){let t=.016666666666666666;if(0===e)n=this.stepPhysics()&&n;else{let i=e/1e3;i<t&&i>.55*t&&(i=t),this.accumulator+=i;let r=performance.now(),a=0,s=6;for(;this.accumulator>=t&&a<s&&(n=this.stepPhysics()&&n,this.accumulator-=t,a++,!(performance.now()-r>1e3*t)););this.accumulator=this.accumulator%t}}return n}stepPhysics(){var e;for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(vX,yX,bX),xX.setFromQuaternion(yX);let e=t;void 0===e.prevR?(e.prevR=xX.clone(),e.prevT=vX.clone()):(e.prevR.copy(xX),e.prevT.copy(vX)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(vX.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(yX))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),null!==(e=this.events)&&void 0!==e&&e.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(e,t,i){var n;let r,a=(null===(n=this.sharedGameControlGlobals.rapierWorld)||void 0===n?void 0:n.getCollider(i))._parent;if(t.cloner)for(let s of t.cloner.children)if(s.rigidBody===a){r=s;break}e.dispatch(r),t.dispatchEvent(RX)}updateUseWindowEvents(e){var t;null===(t=this.orbitControls)||void 0===t||t.updateUseWindowEvents(e)}generateSensorColliderDescs(e,t,i){let n=MX.copy(e.matrixWorld).invert();e.traverseEntity(((r,a)=>{if(!1===t&&1===a)return!0;for(let t of r.dataPatched.events)if("Trigger"===t.data.type&&!0!==t.data.disabled){let a,s=new gX(t.id,t.data,r,this.page,this.sharedAssets,this.eventManager);if(a="box"===t.data.triggerZone?mX.ColliderDesc.cuboid(...t.data.size.map((e=>e/(2*this.pixelsPerMeter)))):mX.ColliderDesc.ball(t.data.radius/this.pixelsPerMeter),a.setDensity(0).setSensor(!0).setActiveEvents(mX.ActiveEvents.COLLISION_EVENTS),_X.fromArray(t.data.position),EX.setFromEuler(wX.fromArray(t.data.rotation)),CX.compose(_X,EX,AX).premultiply(r.matrixWorld),i?(CX.decompose(_X,EX,SX),a.setActiveCollisionTypes(mX.ActiveCollisionTypes.KINEMATIC_FIXED|mX.ActiveCollisionTypes.DYNAMIC_FIXED)):(CX.premultiply(n).decompose(_X,EX,SX),e.rigidBody.bodyType()===mX.RigidBodyType.Dynamic||(e.rigidBody.bodyType()===mX.RigidBodyType.Fixed?a.setActiveCollisionTypes(mX.ActiveCollisionTypes.KINEMATIC_FIXED|mX.ActiveCollisionTypes.DYNAMIC_FIXED):a.setActiveCollisionTypes(mX.ActiveCollisionTypes.KINEMATIC_KINEMATIC|mX.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),_X.divideScalar(this.pixelsPerMeter),a.setTranslation(_X.x,_X.y,_X.z),a.setRotation(EX),i)i.push([a,s]);else{let t=this.sharedGameControlGlobals.rapierWorld.createCollider(a,e.rigidBody);this.sensorToTriggerEvent[t.handle]=s}}}))}checkTrigger(){let e;for(let t=0;t<this.sharedGameControlGlobals.triggers.length;t++){let[i,n,r,a]=this.sharedGameControlGlobals.triggers[t];for(let t=0;t<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;t++){let s=this.sharedGameControlGlobals.entitiesWithTransformAnim[t];if(r===s||!1===a.isValidTriggeringObject(AT.is(s)?s:s.object))continue;let o=MX.copy(r.matrixWorld).decompose(_X,TX,SX).compose(_X,TX,AX).multiply(n),l=CX.copy(s.matrixWorld).invert().multiply(o);i instanceof bl?e=s.bvhGeometry.boundsTree.intersectsBox(i,l):(DX.radius=i,DX.center.setFromMatrixPosition(l),e=s.bvhGeometry.boundsTree.intersectsSphere(DX)),e?-1===a.currentIntersectedObjects.indexOf(s)&&(a.currentIntersectedObjects.push(s),a.dispatch(),r.dispatchEvent(OX)):a.currentIntersectedObjects=a.currentIntersectedObjects.filter((e=>e!==s))}}}};function LX(e){var t;let i=this._clip.duration,n=null!==(t=this._clip.start)&&void 0!==t?t:0,r=this.loop,a=this.time+e,s=this._loopCount,o=r===ao;if(0===e)return-1===s?a:o&&1===(1&s)?i-(a-n):a;if(2200===r){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(a>=i)a=i;else{if(!(a<0)){this.time=a;break e}a=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),a>=i||a<n){let t=Math.floor((a-n)/(i-n));a-=(i-n)*t,s+=Math.abs(t);let r=this.repetitions-s;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,o||(a=e>0?i:n,1===this.repetitions&&(a=i)),this.time=a,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===r){let t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=a,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:t})}}else this.time=a;if(o&&1===(1&s))return i-(a-n)}return a}var FX,BX=!1,NX=class{constructor(e,t,i,n){this.scene=e,this.requestRender=t,this.updateDisplayProgress=i,this.animationInspectorState=n,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=e=>{"Empty"===e.data.type&&e.data.animations&&e.data.animations.forEach(((t,i)=>{let n=t[0]+"/";if(Array.isArray(e.identity)?n+=e.identity[0]:n+=e.uuid,this.clipIdToAction[n])return;let r=nm.parse(JSON.parse(t[2]));e.animations[i]=r;let a=this.mixer.clipAction(r,e);!1===BX&&(Object.getPrototypeOf(a)._updateTime=LX,BX=!0),a.clampWhenFinished=!0,this.clipIdToAction[n]=a}))},this.mixer=new Xm(e),this.scene.traverseEntity(this.addClip)}deleteClip(e,t){let i=this.scene.find(t);if(!i)return;let n=i.animations.find((t=>t.uuid===e));if(!n)return;let r=this.clipIdToAction[e];!r||(r.stop(),this.mixer.uncacheClip(n),delete this.clipIdToAction[e],i.animations=i.animations.filter((t=>t.uuid!==e)))}get isPlaying(){return Object.values(this.clipIdToAction).some((e=>e.isRunning()))}playFromInspector(e){this.mixer.stopAllAction();let t=this.clipIdToAction[e];!t||(t.play(),this.activeClip=t.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach((e=>{e.repetitions=1/0,e.loop=2201})),this.mixer.stopAllAction(),this.requestRender()}play(e){let t=e.clipId+"/"+e.object,i=this.clipIdToAction[t];if(i)return e&&(e.repeat>=0&&(i.repetitions=e.repeat+1),"pingpong"===e.direction&&0!==e.repeat&&(i.loop=ao)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(e){let t=this.clipIdToAction[e];!t||(t.play(),t.paused=!1,this.requestRender())}pauseFromInspector(e){let t=this.clipIdToAction[e];!t||(t.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(e){var t;if(this.needsUpdate)this.needsUpdate=!1;else if(!1===this.isPlaying||null!==(t=this.animationInspectorState)&&void 0!==t&&t.isScrubbing)return;this.mixer.update(e/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*this.maxFrames%this.maxFrames)),this.requestRender()}get maxFrames(){var e,t;return null!==(e=null===(t=this.activeClip)||void 0===t||null===(t=t.tracks[0])||void 0===t?void 0:t.times.length)&&void 0!==e?e:0}setProgressFromInspector(e,t){if(!this.clipIdToAction[t])return;this.activeClip!==this.clipIdToAction[t].getClip()&&this.playFromInspector(t);let i=this.clipIdToAction[t].paused;this.clipIdToAction[t].paused=!1,this.mixer.setTime(Math.min(this.maxFrames?e/this.maxFrames:0,.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[t].paused=!0)}},zX=new WeakMap,UX=class extends lm{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,n){let r=new dm(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(e=>{this.decodeDracoFile(e,t).catch(n)}),i,n)}decodeDracoFile(e,t,i,n){let r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(e,r).then(t)}decodeGeometry(e,t){let i=JSON.stringify(t);if(zX.has(e)){let t=zX.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n,r=this.workerNextTaskID++,a=e.byteLength,s=this._getWorker(r,a).then((i=>(n=i,new Promise(((i,a)=>{n._callbacks[r]={resolve:i,reject:a},n.postMessage({type:"decode",id:r,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{n&&r&&this._releaseTask(n,r)})),zX.set(e,{key:i,promise:s}),s}_createGeometry(e){let t=new Wc;e.index&&t.setIndex(new kc(e.index.array,1));for(let i=0;i<e.attributes.length;i++){let n=e.attributes[i],r=n.name,a=n.array,s=n.itemSize;t.setAttribute(r,new kc(a,s))}return t}_loadLibrary(e,t){let i=new dm(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{i.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{let i=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let n=jX.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let i=t.data;switch(i.type){case"decode":e._callbacks[i.id].resolve(i);break;case"error":e._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}};function jX(){let e,t;function i(e,t,i,n,r,a){let s=a.num_components(),o=i.num_points()*s,l=o*r.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,r),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(i,a,c,l,h);let d=new r(e.HEAPF32.buffer,h,o).slice();return e._free(h),{name:n,array:d,itemSize:s}}onmessage=function(n){let r=n.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":let n=r.buffer,a=r.taskConfig;t.then((e=>{let t=e.draco,s=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(n),n.byteLength);try{let e=function(e,t,n,r){let a,s,o=r.attributeIDs,l=r.attributeTypes,c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,s=t.DecodeBufferToMesh(n,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,s=t.DecodeBufferToPointCloud(n,a)}if(!s.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());let h={index:null,attributes:[]};for(let d in o){let n,s,c=self[l[d]];if(r.useUniqueIDs)s=o[d],n=t.GetAttributeByUniqueId(a,s);else{if(s=t.GetAttributeId(a,e[o[d]]),-1===s)continue;n=t.GetAttribute(a,s)}h.attributes.push(i(e,t,a,d,c,n))}return c===e.TRIANGULAR_MESH&&(h.index=function(e,t,i){let n=3*i.num_faces(),r=4*n,a=e._malloc(r);t.GetTrianglesUInt32Array(i,r,a);let s=new Uint32Array(e.HEAPF32.buffer,a,n).slice();return e._free(a),{array:s,itemSize:1}}(e,t,a)),e.destroy(a),h}(t,s,o,a),n=e.attributes.map((e=>e.array.buffer));e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:e},n)}catch(l){console.error(l),self.postMessage({type:"error",id:r.id,error:l.message})}finally{t.destroy(o),t.destroy(s)}}))}}}async function VX(e){if(FX){let t,i={attributeIDs:FX.defaultAttributeIDs,attributeTypes:FX.defaultAttributeTypes,useUniqueIDs:!1};try{t=await FX.decodeGeometry(new Int8Array(e).buffer,i)}catch(W_){console.error(W_)}if(t)return{index:t.index?{array:t.index.array}:void 0,attributes:Object.entries(t.attributes).map((e=>{let[t,i]=e;return{name:t,itemSize:i.itemSize,array:i.array}}))}}return null}var GX=class{constructor(e,t,i,n,r,a,s,o){this.eventId=e,this.id=t,this.data=i,this.dataEvent=n,this.object=r,this.stage=!1,this.actions=CH(n,i.actions,a,s,o,r)}disconnect(){MH(this.actions)}dispatchIn(){this.actions.Audio.forEach((e=>e.dispatchBasic())),this.actions.Particles.forEach((e=>e.dispatchBasic())),this.actions.Video.forEach((e=>e.dispatchBasic())),this.actions.Create.forEach((e=>e.dispatch())),this.actions.Destroy.forEach((e=>e.dispatch())),this.actions.Reset.forEach((e=>e.dispatch())),this.actions.Link.forEach((e=>e.dispatch())),this.actions.Transition.forEach((e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())})),this.actions.Transition.forEach((e=>e.toggle())),this.actions.Animation.forEach((e=>e.play())),this.actions.SwitchCamera.forEach((e=>e.play())),this.actions.SceneTransition.forEach((e=>e.dispatch())),this.actions.SetVariable.forEach((e=>e.checkConditions())),this.actions.SetVariable.forEach((e=>e.dispatch())),this.actions.DynamicVariablePlay.forEach((e=>e.dispatch()))}dispatchOut(){this.actions.Transition.forEach((e=>{e.toggle()}))}},HX=class extends EW{constructor(e,t){super(e),this.eventManager=t,this.breakpoints=[],this.resize=(e,t)=>{this.breakpoints.forEach((i=>{let n,r=dE.deviceToSize(i.data.size),a="horizontal"===i.dataEvent.orientation?e:t;switch(i.data.operator){case"<":n=a<r[0];break;case">":n=a>r[0];break;case"<>":n=a>r[0]&&a<r[1]}i.stage!==n&&(i.stage=n,i.stage?i.dispatchIn():i.dispatchOut())}))},this.onResizeObserver=new ResizeObserver((e=>{for(let t of e){let{width:e,height:i}=t.contentRect;this.resize(e,i)}}))}connect(){let{page:e,sharedAssets:t,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let n=i=>{var n;if(i.visible&&null!==(n=i.data)&&void 0!==n&&n.events.length)for(let{data:r,id:a}of i.data.events)r.disabled||"Resize"===r.type&&r.breakpoints.forEach((n=>{let{data:s,id:o}=n;try{let n=new GX(a,o,s,r,i,e,t,this.eventManager);this.breakpoints.push(n)}catch(SE){}}))};e.traverseEntity((e=>{var t;(e instanceof ij||e instanceof XU)&&null!==(t=e.frame)&&void 0!==t&&t.traverse((e=>{n(e)})),n(e)}))}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach((e=>{e.disconnect()})),this.breakpoints=[]}},WX=class{constructor(e,t,i,n,r){this.publish=e,this.controlsManager=t,this.animationControls=i,this.eventContext=n,this.sharedVariables=r,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=e=>{let t=window.parent!==window,i=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(e.touches.length>1||this.preventTouchScroll||!1===t&&!1===i)&&e.preventDefault()},this.onMouseWheelPreventScroll=e=>{this.preventScroll&&e.preventDefault()},this.onMouseMove=e=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(e),pressed:e.buttons>0}},this.onMouseDown=e=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(e),pressed:!0}},this.onMouseUp=e=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(e),pressed:!1}},this.getMousePosition=e=>{var t;let{domRect:i}=this.eventContext,{pageX:n,pageY:r}=(null===(t=e.touches)||void 0===t?void 0:t.length)>0?e.touches[0]:e;return{x:n-(i.left+window.scrollX),y:r-(i.top+window.scrollY)}},this.stopRaycast=e.stopRaycast,this.preventScroll=e.preventScroll,this.preventTouchScroll=e.preventTouchScroll,this.hideCursor=e.hideCursor,this.requestRender=n.requestRender}activate(){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new DW(this.eventContext),VariableChange:new zq(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),Conditional:new NW(this.eventContext,this),Start:new Bq(this.eventContext,this),Basic:new OW(this.eventContext,this,this.needsRaycast),MouseHover:new Oq(this.eventContext,this),Scroll:new Lq(this.eventContext,this),Follow:new uq(this.eventContext,this),DragDrop:new iq(this.eventContext,this),LookAt:new Mq(this.eventContext),Resize:new HX(this.eventContext,this)};let{page:e,domElement:t}=this.eventContext;this.hideCursor&&(t.style.cursor="none"),e.traverseEntity((e=>{e.addEventListener("requestRender",this.requestRender)})),Object.values(this.handlers).forEach((e=>e.connect())),t.addEventListener("wheel",this.onMouseWheelPreventScroll),t.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++}deactivate(){var e;if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:t,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach((e=>e.disconnect())),null!==(e=this.controlsManager.gameControl)&&void 0!==e&&e.disposeActions(),this.controlsManager.disconnectEvents(),t.traverseEntity((e=>{e.removeEventListener("requestRender",this.requestRender),e.destroyedInAction=!1})),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(),this.activate(),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(e){let t=this.isEnabled;t&&this.deactivate(),this.eventContext.useWindowEvents=e,t&&this.activate()}initializeActionsDependentStates(){let e=this.eventContext.sharedAssets;e.resetDynamicVariablePlayState();let t=i=>{if("Conditional"===i.data.type&&(i.data.ifActions.forEach(t),i.data.elseActions.forEach(t)),"Conditional"===i.data.type||"SetVariable"===i.data.type)for(let e of"Conditional"===i.data.type?i.data.condition:i.data.expression)"id"in e&&Array.isArray(e.id)&&("mouse"===e.id[0]&&(this.needsMouse=!0),"raycast"===e.id[0]&&(this.needsRaycast=!0));"DynamicVariablePlay"===i.data.type&&""!==i.data.variableId&&("Play"===i.data.mode||"PlayPause"===i.data.mode||"Toggle"===i.data.mode)&&e.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity((e=>{var i;if(null!==(i=e.data)&&void 0!==i&&i.events.length)for(let n of e.data.events)if("VariableChange"===n.data.type&&("mouseProperty"===n.data.variableId&&(this.needsMouse=!0),"raycastProperty"===n.data.variableId&&(this.needsRaycast=!0)),"Conditional"===n.data.type)for(let e of["inActions","outActions"])n.data[e].forEach(t);else if("DragDrop"===n.data.type)for(let e of["drag","drop"])n.data.dragDropActions[e].forEach(t);else if("GameControl"===n.data.type)for(let e of["idle","move","jump","run"])n.data.gameActions[e].forEach(t);else if("Resize"===n.data.type)for(let e of n.data.breakpoints)e.data.actions.forEach(t);else"LookAt"===n.data.type||n.data.actions.forEach(t)}))}},qX=class{constructor(e,t,i,n,r){this._aspect=1,this.enableResponsive=!1,this._renderer=e,this._camera=t,this._frameSize=(new jo).copy(i),this._editorSize=(new jo).copy(n),this._aspect=t.aspect,this._fov=null!==r&&void 0!==r?r:t.fov}set frameSize(e){this._frameSize.copy(e)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||"PerspectiveCamera"!==this._camera.cameraType)return;let e=this._frameSize.x,t=this._frameSize.y,i=this._editorSize.y;this._aspect=e/t,t<=i&&(this._camera.zoom*=i/t),this._renderer.setViewport(0,0,e,t)}updateCamera(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._camera)if("PerspectiveCamera"===this._camera.cameraType){let t=this._frameSize.y,i=this._editorSize.y,n=this._fov;if(e&&t>i){let e=function(e,t,i,n,r){return(e-t)/(i-t)*(r-n)+n}(t,1080,2160,1,15)/100;n*=t/i,n*=1-e}this._camera.aspect=this._aspect,this._camera.fov=n,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(e){this._camera=e,this._aspect=e.aspect,this._fov=e.fov}revert(){let e=window.innerWidth,t=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,e,t),this._renderer.setSize(e,t)),this._camera&&(this._camera.aspect=e/t,this._camera.fov=this._fov,this._camera.setViewplaneSize(e,t,this.enableResponsive),this._camera.updateProjectionMatrix())}};var XX=class{get sharedAssets(){return this.shared}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.shared=new SF(e.shared,t),this.scene=new Vj(e.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(e,t){this.scene.clearScene(),this.sharedAssets.reset(e.shared),this.scene.resetAfterClear(e.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let e of this.scene.children)e instanceof XU&&!e.uiScene&&e.personalCamera.updateState(e.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity((e=>{e instanceof DF&&e.markGeometryAsReachable(this.shared)})),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},YX=class{constructor(e){let{x:t=10,y:i=10}=e;this._startTime=0;let n=document.getElementById("spe-perfs");n?this.element=n:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left="".concat(t,"px"),this.element.style.top="".concat(i,"px")}dispose(){var e;null===(e=this.element.parentElement)||void 0===e||e.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let e=performance.now()-this._startTime;this.element.innerHTML=e.toFixed(3)+" ms"}};function QX(e){let t;if(e.index)for(let i=0;i<e.index.array.length;i+=3)t=e.index.array[i],e.index.array[i]=e.index.array[i+2],e.index.array[i+2]=t}function KX(e){return e instanceof FF?"SubdivObject":"NonParametricGeometry"===e.geometry.type?"NonParametric":"Mesh"}function ZX(e,t){let i=function(e,t){let i={};return e.traverseEntity((e=>{if(!e.visible||!(e instanceof cI)||"Mesh"!==e.type||Array.isArray(e.material)||e.states&&Object.keys(e.states).length)return;let n=e.parent;for(;n;){if(n instanceof cI&&e.states&&Object.keys(e.states).length)return;n=n.parent}let r=e.material.uuid,a=t.shared.materials[r];if(a){if(!nC.isMergable(a))return}else{var s;let i=null===(s=t.scene.objects.get(e.uuid))||void 0===s?void 0:s.data;if(i&&"material"in i&&"string"!=typeof i.material){if(!nC.isMergable(i.material))return;r=nC.getHash(i.material)}}i[r]||(i[r]={});let o=i[r][KX(e)];if(o){if(o.push(e),e.cloner)for(let t of e.cloner.children)o.push(t)}else if(i[r][KX(e)]=[e],e.cloner)for(let t of e.cloner.children)i[r][KX(e)].push(t)})),i}(t,e),n=function(e){let t=0;return Object.values(e).forEach((e=>{Object.values(e).forEach((e=>{let i=e.length;i>t&&(t=i)}))})),t}(i),r=new Array(n),a=0,s=new Array(n),o=0,l=new Array(n),c=0,h=new Array(n),d=0;for(let[u,p]of Object.entries(i))for(let e of Object.values(p)){if(o=0,c=0,e.forEach((e=>{e instanceof cI&&(s[o++]=e.geometry.clone(),l[c++]=e)})),c<2)continue;for(let e=0;e<c;e++)l[e].updateWorldMatrix(!0,!1),s[e].applyMatrix4(l[e].matrixWorld),l[e].matrixWorld.determinant()<0&&QX(s[e]);let n=GM(s.slice(0,o),!1);if(n){let e;if("SubdivObject"===u)console.warn("Turning subdiv object into mesh"),e=new ah(n,l[0].material);else e=new ah(n,l[0].material);e.castShadow=l[0].castShadow,e.receiveShadow=l[0].receiveShadow,t.add(e);let s=e=>{d=0;for(let t of e)t.children&&s(t.children),t instanceof cI&&(Array.isArray(t.material)||i[t.material.uuid]&&i[t.material.uuid][KX(t)]&&i[t.material.uuid][KX(t)].length>1||(h[d++]=t));for(let i=0;i<d;i++)t.attach(h[i])};for(let t=0;t<c;t++){let e=l[t];s(e.children),r[a++]=e}}}for(let u=0;u<a;u++)r[u].removeFromParent()}var JX=Br(Xr(),1),$X=new jo;var eY,tY=class{constructor(e){let{renderOnDemand:t,renderMode:i="auto"}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=e=>{var t,i,n,r,a,s,o,l,c,h,d,u;if(this.time=e,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,null!==(t=this._perfs)&&void 0!==t&&t.start(),this._renderer)if(this._isPaused||!("manual"===this.renderMode&&!this._renderRequested||"auto"===this.renderMode&&this._skipRender)){if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)),this._eventManager&&(null!==(i=this._eventManager.handlers)&&void 0!==i&&i.Start.hasVideoAction||null!==(n=this._eventManager.handlers)&&void 0!==n&&n.Basic.hasVideoAction||null!==(r=this._eventManager.handlers)&&void 0!==r&&r.Conditional.hasVideoAction)&&(this._skipRender=!1),null!==(a=this._animationControls)&&void 0!==a&&a.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,null!==(s=this._scene)&&void 0!==s&&s.traverseVisibleEntity((e=>{"ParticleSystem"===e.type&&(e.update(this.dt),this._skipRender=!1)})),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),null!==(o=this._eventManager)&&void 0!==o&&o.isEnabled&&((null===(l=this._eventManager.handlers)||void 0===l?void 0:l.Follow).onAnimationFrameDamping(),(null===(c=this._eventManager.handlers)||void 0===c?void 0:c.LookAt).onAnimationFrameDamping(),(null===(h=this._eventManager.handlers)||void 0===h?void 0:h.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let e=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=e,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),null===(d=this._perfs)||void 0===d||d.end()}else{var p;null===(p=this._perfs)||void 0===p||p.end()}else null===(u=this._perfs)||void 0===u||u.end()},this._resize=()=>{if(this._renderer){var e,t,i,n,r,a,s,o;if(1===this._viewportMode&&this._frameView&&(this._frameView.frameSize=$X.set(this._viewportWidth,this._viewportHeight)),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._camera=null===(e=this._scene)||void 0===e?void 0:e.activeCamera,null!==(t=this._scene)&&void 0!==t&&t.updateViewPlaneSize(null!==(i=null===(n=this._frameView)||void 0===n||null===(n=n.frameSize)||void 0===n?void 0:n.x)&&void 0!==i?i:this._viewportWidth,null!==(r=null===(a=this._frameView)||void 0===a||null===(a=a.frameSize)||void 0===a?void 0:a.y)&&void 0!==r?r:this._viewportHeight,null!==(s=null===(o=this._frameView)||void 0===o?void 0:o.enableResponsive)&&void 0!==s&&s),this._camera){var l,c,h,d,u;let e=null!==(l=Object.values(null!==(c=null===(h=this._data)||void 0===h?void 0:h.frames)&&void 0!==c?c:{})[0].preset)&&void 0!==l?l:"fullscreen";null!==(d=this._frameView)&&void 0!==d&&d.setCamera(this._camera),null!==(u=this._frameView)&&void 0!==u&&u.updateCamera("fullscreen"!==e),"PerspectiveCamera"===this._camera.cameraType&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=Gw(this._resize,10),this._onScroll=e=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=e,this.renderMode=t?"auto":i,this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new YX({x:10,y:10})),function(e){e.addEventListener("pointerdown",y_,!0),e.addEventListener("pointerdown",x_,!0),e.addEventListener("pointermove",x_,!0),e.addEventListener("pointerup",b_,!0),e.addEventListener("pointercancel",b_,!0),e.addEventListener("pointerleave",b_,!0),window.addEventListener("keydown",__,!0),window.addEventListener("keyup",S_,!0)}(e)}async load(e,t,i){(function(e){let t="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";e.endsWith(".spline")?console.warn(t+" The .spline files are only meant to be used by the Editor."):e.endsWith(".splinecode")||console.warn(t)})(e),this.disposed=!1;let n=await(await fetch(e,i)).arrayBuffer();await this.start(n,{variables:t})}async start(e){var t,i,n,r,a;let{interactive:s=!0,variables:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.disposed)return;let l=await async function(e,t){let[i,n]=bS(jA.deserialize(new Uint8Array(e)));return VM(i),t&&t(i),n.result().data}(e);this._data=l;let c=function(e){let t=[];return e.scene.objects.traverse(((e,i)=>{"Mesh"===i.type&&"NonParametricGeometry"===i.geometry.type&&void 0!==i.geometry.data.draco&&t.push(i)})),t}(l);l.version&&(0,JX.default)(l.version,"1.2.5")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),await Promise.all([c.length&&(FX||(FX=new UX).setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload(),FX.decoderPending),jB(l)&&qO(),LF(l)&&wO(),HC.physicsEnabled(l.scene.objects)&&R_(),tB(l)&&fF(),Rj(l)&&Nj(),sF(l)&&aF(),yU(l)&&vU(),Kq(l)&&M_()].filter(Boolean)),c.length&&await async function(e){for(let t of e){let e=await VX(t.geometry.data.draco);if(e){let i=t.geometry.data;e.index&&(i.index={array:e.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};e.attributes.forEach((e=>{let{name:t,array:i,itemSize:r}=e;n[t]={array:i,itemSize:r,type:"Float32Array",normalized:!1}})),i.attributes=n,i.draco=void 0}}}(c),null!==(t=this._eventManager)&&void 0!==t&&t.deactivate(),null!==(i=this._controls)&&void 0!==i&&i.deactivate(),null===(n=this._scene)||void 0===n||n.dispose();let h=new XX(l);if(h.resetPersonalCameraFromDocumentData(),this._scene=h.scene,this._sharedAssetsManager=h.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let e=performance.now();ZX(l,h.scene);let t=performance.now();console.log("Merged geometries in ",t-e," ms")}jB(l)&&this._scene.traverse((e=>{qB(e)&&e.recomputeBoolean()})),this._sharedAssetsManager.setRequestRender((()=>{var e;this._requestRenderAutoMode(),null===(e=this._scene)||void 0===e||e.traverse((e=>{e instanceof bB&&e.pendingMediaLoad&&e.update()}))})),null===(r=this._scene)||void 0===r||r.traverse((e=>{"ParticleSystem"===e.type&&(e.wakeUp(),e.data.autoPlay?e.start():e.stop())}));let d=Object.keys(l.shared.fonts).map((e=>this._sharedAssetsManager.getFont(e).loadingPromise));if(Promise.all(d).then((()=>{h.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()})),tB(l)&&function(e){if(HC.physicsEnabled(e.scene.objects))return!0;let t=!1;return e.scene.objects.traverse(((e,i)=>{if(i.events)if(Array.isArray(i.events)){for(let n of i.events)if(!0!==n.data.disabled&&"GameControl"===n.data.type&&n.data.collisionEnabled){t=!0;break}}else for(let n of Object.values(i.events))if(!0!==n.disabled&&"GameControl"===n.type&&n.collisionEnabled){t=!0;break}})),t}(l)&&await Promise.all(d),yU(l)){let e=[];this._scene.traverseEntity((t=>{(t instanceof ij||t instanceof XU)&&t.uiCanvas&&e.push(t.uiCanvas)})),await Promise.all(e.map((e=>e.promise)))}this._scene.rewriteEventsBeforeGoToPlayMode(),oH(this._scene.activePage,this._sharedAssetsManager),this._renderer||(this._renderer=new Gz({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=!0===l.scene.publish.hdTransmission,this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode)),Rj(l)&&this._scene.initializeSplatViewer(),void 0!==l.scene.blueNoiseTextureData&&this._renderer.pipeline.updateBlueNoiseTexture(l.scene.blueNoiseTextureData);let u=Object.values(l.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):("fullscreen"===u.preset?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=u.size[0],this._viewportHeight=u.size[1],this.canvas.style.width="".concat(this._viewportWidth,"px"),this.canvas.style.height="".concat(this._viewportHeight,"px")),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new qX(this._renderer,this._camera,new jo(this._viewportWidth,this._viewportHeight),new jo(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=null!==(a=u.allowResponsive)&&void 0!==a&&a&&"fullscreen"===u.preset),s){let e=new AW(this._renderer,this.data.scene.publish,this._scene,(()=>this._scene.activeCamera),this._sharedAssetsManager,this._requestRenderAutoMode,!0,u);this._scene.updateMatrixWorld(!0),this._controls=new kX(e),this._animationControls=new NX(this._scene,this._requestRenderAutoMode),this._eventManager=new WX(l.scene.publish,this._controls,this._animationControls,e,l.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),void 0!==o&&this.setVariables(o),0===this.dt&&(this.render(performance.now()),setTimeout((()=>{var e;null===(e=this._renderer)||void 0===e||e.setAnimationLoop(this.render)}),0)),this._resizeObserverTimeout=setTimeout((()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver((()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()})),this._resizeObserver.observe(this.canvas.parentElement))}),300),document.addEventListener("scroll",this._onScroll)}setVariables(e){if(void 0!==this._data){let t=Object.entries(e);for(let[e,i]of t)this.setVariable(e,i)}}setVariable(e,t){let i=this._getVariableByName(e);if(i&&!("dynamicVariableType"in i.data)){var n;let e=t;"number"==typeof i.data.value?e="number"==typeof t?t:"boolean"==typeof t?!0===t?1:0:parseFloat(t):"boolean"==typeof i.data.value?e="number"==typeof t?!!t:"boolean"==typeof t?t:"false"!==t.toLocaleLowerCase()&&!!t:"string"!=typeof i.data.value&&void 0!==i.data.value.textValue&&(e=t.toString());let r="string"==typeof e?{textValue:e}:e;null!==(n=this._sharedAssetsManager)&&void 0!==n&&n.updateVariable(i.id,r),this.requestRender(),this._requestRenderAutoMode()}else void 0===i?console.warn("No variable named ".concat(e," was found in your Spline file. Make sure to create it from Spline editor.")):"dynamicVariableType"in i.data&&console.warn("Dynamic variables like ".concat(e," cannot be updated from code."))}getVariables(){let e={};return this._data&&this._data.shared.variables.forEach((t=>{void 0===e[t.data.name]&&(e[t.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(t.id)))})),e}getVariable(e){let t=this._getVariableByName(e);if(t){let e=this._sharedAssetsManager.getVariable(t.id);return this._getVariableValue(e)}}_getVariableValue(e){return"string"!=typeof e&&XC.isTextValue(e)?XC.getDisplayedValue(e):e}_getVariableByName(e){if(this._data){if(this._variablesCache.has(e))return this._variablesCache.get(e);let t=this._data.shared.variables.find((t=>t.data.name===e));return t&&this._variablesCache.set(e,t),t}}findObjectById(e){var t;let i=null===(t=this._scene)||void 0===t?void 0:t.getObjectByProperty("uuid",e);return this._createProxyObject(i)}findObjectByName(e){var t;let i=null===(t=this._scene)||void 0===t?void 0:t.getObjectByName(e);return this._createProxyObject(i)}getAllObjects(){var e;let t=[];return null!==(e=this._scene)&&void 0!==e&&e.traverseEntity((e=>{if(e.uuid!==LE&&!this._scene.isInvisibleObjects(e)&&!(e instanceof XU)){let i=this._createProxyObject(e);i&&t.push(i)}})),t}getSplineEvents(){var e;return(null===(e=this._eventManager)||void 0===e||null===(e=e.handlers)||void 0===e?void 0:e.Spline).splineEvents}emitEvent(e,t){var i;null===(i=this.findObjectById(t)||this.findObjectByName(t))||void 0===i||i.emitEvent(e)}emitEventReverse(e,t){var i;null===(i=this.findObjectById(t)||this.findObjectByName(t))||void 0===i||i.emitEventReverse(e)}addEventListener(e,t){this.canvas.addEventListener(e,t)}removeEventListener(e,t){this.canvas.removeEventListener(e,t)}setZoom(e){var t,i;(null===(t=this._controls)||void 0===t?void 0:t.orbitControls)instanceof uX&&(null===(i=this._controls)||void 0===i||i.orbitControls.zoomOut(e))}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(e,t){this._viewportWidth=e,this._viewportHeight=t,this._viewportMode=2,this._resize()}setBackgroundColor(e){var t;let{r:i,g:n,b:r,a:a}={r:0,g:0,b:0,a:1},s=new yI(i,n,r,a);try{s.setStyle(e)}catch{console.error("This is not a valid css color",e)}null!==(t=this._scene)&&void 0!==t&&t.activePage.setBackgroundColor(s),this._requestRenderAutoMode()}dispose(){var e,t,i,n,r,a,s;this.disposed=!0,null!==(e=this._eventManager)&&void 0!==e&&e.deactivate(),null!==(t=this._scene)&&void 0!==t&&t.dispose(),null!==(i=this._sharedAssetsManager)&&void 0!==i&&i.dispose(),this._proxyObjectCache.forEach((e=>{tv.unsubscribe(e)})),this._variablesCache.clear(),null!==(n=this._renderer)&&void 0!==n&&n.setAnimationLoop(null),null!==(r=this._renderer)&&void 0!==r&&r.dispose(),this._renderer=void 0,null!==(a=this._sharedAssetsManager)&&void 0!==a&&a.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),void 0!==this._resizeObserverTimeout&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),null!==(s=this._controls)&&void 0!==s&&s.deactivate(),this.dt=0,function(e){e.removeEventListener("pointerdown",y_,!0),e.removeEventListener("pointerdown",x_,!0),e.removeEventListener("pointermove",x_,!0),e.removeEventListener("pointerup",b_,!0),e.removeEventListener("pointercancel",b_,!0),e.removeEventListener("pointerleave",b_,!0),window.removeEventListener("keydown",__,!0),window.removeEventListener("keyup",S_,!0)}(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){var e,t,i;this._isPaused||(null!==(e=this._renderer)&&void 0!==e&&e.setAnimationLoop(null),this._isPaused=!0,null!==(t=this._eventManager)&&void 0!==t&&t.pause(),(null===(i=this._controls)||void 0===i?void 0:i.orbitControls)&&(this._controls.orbitControls.enabled=!1))}play(){var e,t,i;!this._isPaused||(this._isPaused=!1,null!==(e=this._eventManager)&&void 0!==e&&e.resume(),null!==(t=this._controls)&&void 0!==t&&t.orbitControls&&(this._controls.orbitControls.enabled=!0),null===(i=this._renderer)||void 0===i||i.setAnimationLoop(this.render))}setGlobalEvents(e){var t;null===(t=this._eventManager)||void 0===t||t.updateUseWindowEvents(e)}get data(){return this._data}_createProxyObject(e){var t;if(null==e)return;if(this._proxyObjectCache.has(e.uuid))return this._proxyObjectCache.get(e.uuid);let i;e.traverseAncestors((e=>{e instanceof XU&&(i=e.name)}));let n={name:e.name,uuid:e.uuid,visible:e.visible,intensity:e.intensity,position:e.position,rotation:e.rotation,scale:e.scale,type:e.data.type,page:i,parentUuid:e.parent instanceof XU||e instanceof Vj||null===(t=e.parent)||void 0===t?void 0:t.uuid,emitEvent(t){e.dispatchEvent({type:"userEvent",eventName:t})},emitEventReverse(t){e.dispatchEvent({type:"userEvent",eventName:t,reverse:!0})}},r=tv(n,((t,i)=>{var n;"object"!=typeof e[t]&&null!==(n=Object.getOwnPropertyDescriptor(e,t))&&void 0!==n&&n.writable&&(e[t]=i),this._requestRenderAutoMode(),e.updateMatrix()}));return this._proxyObjectCache.set(e.uuid,r),r}setUIWasmUrl(e){qk.skiaWasmUrl=e}},iY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nY={},rY={get exports(){return nY},set exports(e){nY=e}},aY={};!function(e){e.exports=function(){if(eY)return aY;eY=1;var e=t,i=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(e,t,n){var o,l={},c=null,h=null;for(o in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)r.call(t,o)&&!s.hasOwnProperty(o)&&(l[o]=t[o]);if(e&&e.defaultProps)for(o in t=e.defaultProps)void 0===l[o]&&(l[o]=t[o]);return{$$typeof:i,type:e,key:c,ref:h,props:l,_owner:a.current}}return aY.Fragment=n,aY.jsx=o,aY.jsxs=o,aY}()}(rY);const sY=nY.jsx;var oY=NaN,lY="[object Symbol]",cY=/^\s+|\s+$/g,hY=/^[-+]0x[0-9a-f]+$/i,dY=/^0b[01]+$/i,uY=/^0o[0-7]+$/i,pY=parseInt,fY="object"==typeof iY&&iY&&iY.Object===Object&&iY,mY="object"==typeof self&&self&&self.Object===Object&&self,gY=fY||mY||Function("return this")(),vY=Object.prototype.toString,yY=Math.max,bY=Math.min,xY=function(){return gY.Date.now()};function wY(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function _Y(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&vY.call(e)==lY}(e))return oY;if(wY(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=wY(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(cY,"");var i=dY.test(e);return i||uY.test(e)?pY(e.slice(2),i?2:8):hY.test(e)?oY:+e}var SY=function(e,t,i){var n,r,a,s,o,l,c=0,h=!1,d=!1,u=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var i=n,a=r;return n=r=void 0,c=t,s=e.apply(a,i)}function f(e){var i=e-l;return void 0===l||i>=t||i<0||d&&e-c>=a}function m(){var e=xY();if(f(e))return g(e);o=setTimeout(m,function(e){var i=t-(e-l);return d?bY(i,a-(e-c)):i}(e))}function g(e){return o=void 0,u&&n?p(e):(n=r=void 0,s)}function v(){var e=xY(),i=f(e);if(n=arguments,r=this,l=e,i){if(void 0===o)return function(e){return c=e,o=setTimeout(m,t),h?p(e):s}(l);if(d)return o=setTimeout(m,t),p(l)}return void 0===o&&(o=setTimeout(m,t)),s}return t=_Y(t)||0,wY(i)&&(h=!!i.leading,a=(d="maxWait"in i)?yY(_Y(i.maxWait)||0,t):a,u="trailing"in i?!!i.trailing:u),v.cancel=function(){void 0!==o&&clearTimeout(o),c=0,n=l=r=o=void 0},v.flush=function(){return void 0===o?s:g(xY())},v};function AY(e){return t=>{e.forEach((e=>{"function"==typeof e?e(t):null!=e&&(e.current=t)}))}}const EY=[],CY={width:"100%",height:"100%"},MY=(0,t.forwardRef)((function(e,i){let{className:n,children:r,debounceTime:a=300,ignoreDimensions:s=EY,parentSizeStyles:o,enableDebounceLeadingCall:l=!0,resizeObserverPolyfill:c,...h}=e;const d=(0,t.useRef)(null),u=(0,t.useRef)(0),[p,f]=(0,t.useState)({width:0,height:0,top:0,left:0}),m=(0,t.useMemo)((()=>{const e=Array.isArray(s)?s:[s];return SY((t=>{f((i=>Object.keys(i).filter((e=>i[e]!==t[e])).every((t=>e.includes(t)))?i:t))}),a,{leading:l})}),[a,l,s]);return(0,t.useEffect)((()=>{const e=new(c||window.ResizeObserver)((e=>{e.forEach((e=>{var t;const{left:i,top:n,width:r,height:a}=null!==(t=null==e?void 0:e.contentRect)&&void 0!==t?t:{};u.current=window.requestAnimationFrame((()=>{m({width:r,height:a,top:n,left:i})}))}))}));return d.current&&e.observe(d.current),()=>{window.cancelAnimationFrame(u.current),e.disconnect(),m.cancel()}}),[m,c]),sY("div",{style:{...CY,...o},ref:AY([i,d]),className:n,...h,children:r({...p,ref:d.current,resize:m})})})),PY=(0,t.forwardRef)(((e,i)=>{let{scene:n,style:r,onMouseDown:a,onMouseUp:s,onMouseHover:o,onKeyDown:l,onKeyUp:c,onStart:h,onLookAt:d,onFollow:u,onWheel:p,onLoad:f,renderOnDemand:m=!0,...g}=e;const v=(0,t.useRef)(null),[y,b]=(0,t.useState)(!0);return(0,t.useEffect)((()=>{let e;b(!0);const t=[{name:"mouseDown",cb:a},{name:"mouseUp",cb:s},{name:"mouseHover",cb:o},{name:"keyDown",cb:l},{name:"keyUp",cb:c},{name:"start",cb:h},{name:"lookAt",cb:d},{name:"follow",cb:u},{name:"scroll",cb:p}];if(v.current){async function i(){await e.load(n);for(let i of t)i.cb&&e.addEventListener(i.name,i.cb);b(!1),null==f||f(e)}e=new tY(v.current,{renderOnDemand:m}),i()}return()=>{for(let i of t)i.cb&&e.removeEventListener(i.name,i.cb);e.dispose()}}),[n]),sY(MY,{ref:i,parentSizeStyles:r,debounceTime:50,...g,children:()=>sY("canvas",{ref:v,style:{display:y?"none":"block"}})})}));function TY(){return(0,Pe.jsx)(Ne,{children:(0,Pe.jsx)(PY,{scene:"https://prod.spline.design/YzEy5lMIH75ywh5S/scene.splinecode"})})}const DY=()=>((0,t.useEffect)((()=>{(async()=>{const e=await fetch("/"),t=await e.json();e.ok&&(console.log("initialized"),console.log(t)),e.ok||console.error()})()}),[]),(0,Pe.jsxs)(Ne,{children:[(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsx)(Ve,{className:"landing-page-col",children:(0,Pe.jsx)(Ne,{fluid:!0,className:"nameTagSize",children:(0,Pe.jsxs)("h1",{id:"my-name-tag-hello",children:[(0,Pe.jsx)("b",{children:"HELLO"}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("p",{id:"my-name-tag",children:"MY NAME IS"}),(0,Pe.jsx)("span",{children:(0,Pe.jsx)("h3",{id:"my-name",children:"Nadia Ayad"})})]})})})," ",(0,Pe.jsxs)(Ve,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("img",{id:"sup",alt:"sup?",src:"data:image/png;base64,UklGRv4XAABXRUJQVlA4WAoAAAAQAAAAPAEAswAAQUxQSD8XAAABoIZt2/KmeSMVXGuw4u5bcXd3d3d3h2IbZQoMK3NkgrvrNnS4DC9uw62a5D2ONvme+3m+DPIzIiRKkly3zSyqlEoU+0SBxL2AD1AfXPl17qJ8NgUOvaVd7X00/Afc08mKi/DFsPe8qd113Op7UfusNlA3X4tKh7Sh7qX1qQhd5tKEFvhS1H2pSbnq+lBs04Ce5fOdGIeg/83gM5H2ETS22nymMQRC/2b3lfC7gY1Vfr7SaI+h1/p/+CZrei8x/3dw7Mj4gQtItiToi3W9ggw3wXGt8AeMEpt1imLDlTeohgscL+q+7wget2usOeRd6dTu6qe8QstBtGOK7T2GpdYfCVrruiaQZW6C9tQBi1cQ8kKjOprvfUWmvhe0m06IX/bAMcQlXqy8QiNg9KvO7yUq/2E0acsIk4/2B5d6hSPtH6Nxbcn1PiBvRiOs7Y9rQ80QDuPuaFrb0igvUC8G+t00//87jf5yPWjoSYFT1FU5qGQ1RgPa7w2uoP2y5uh01f81Eft0spIaefySu5rijfBaatmuAd3/vp/5s7K75ml3sf8tBVd6uG930rgxXdMqJkK5bw5k8/jfJzSkA6b/SL87zJG4IOx/SbFlDu2p0W5vugPQQyBFP+6q1vpuaY9I5LCGNEKZreGaq4Toj/53FNhoHDQ8TJVMHQ2wkF1TW5vobt/TAu6GpNkNEVvDbNK80GzFLypoui9RpseYyKkDWxezy9A0jsqrhyXzPcJx3m3c5piRgTEh7sYEbMRW42rKZM3TEvq7jc08rI22JBhMsEPTyvM/gIXMDk9TStn+g6YSYwbY+9+lLprdY2zQiF43MZnCLi2i6+Mym4OtyzVN6dG88kz84ig6pAT/GlJRmDxnaQsne16ExZD5riibueOAFtKb6GLyWFpf1JAuDuDVpjdQTElmIUZ7PGWjaZLKetoUqSFtCzE5Gysm165mNlkan2ZEnZ9lZjCe4pBS1vsYn+KGH0Uqav4GHmEilr7qa+o68kgL6kFUDkHvej/z/onKhN/uLgJnmKqoMTbhdNWARhtNpHca0hoz/3K2FpVzdxOLCB9FOzVXr6PgwOwIZV8f9RXILRzrfuQOM/pSKr3R2F8OtplGbqcW1tVRWdikmxMnYv/TvlaMYWRmxIJm2l2M6nb6HYCR3yv20Gcqm/hmccUtq8ij8T2DNWLdhQSW/cciIHKRn7EabHQlhcs2F7hPiwqsLa4/CphEb22Gzg5Ih9PHYTRdlbKVGbuD8U+OhdDvOE3ORRqRJD7gDP1uaNQCjSopOrspZIxDMjkSj5AXs8NAahma3NUjGdNrD+7FPu4EME0L6VsWAafol+KGacXHnBg42IyxBqBb/rkvNV/x3xeFrpdxXNHAKFL+Bv8c6+gLFSHFfmbO+jXrZQzP+0gvT3OARUqlG3hJwuXcUYemszaksaFB6cY+hv+yBenT3xXiqeJpPP2S34hU9zVHj8aK/yHgGU2MNeXq1V6dqPnalJtijzGU25t6xBPU9mUZySelkJhZusCbrKfLQK7zNi9MeEQDlnvM5LBJtzRbsaMtxhcrwZi5ilKG2bGg7XerGtNAijqKpw504iazcYMQ+zm4LJ8o1QCWG/i6DVfxF61tWQ0TqNqYw4pWjo3ocj/ZavjFvxFiFBPLGUZ4o1QPzVbiik8Esd6l+c/wIhb69D/N1EWj+6sc9V1AbnyT26Dt+wzv0bVC/KSY6kiHQjbDl5siC2ETq9j4ErCZ8Jv92+1lZsyuZEbRPRWidHMdYLxe04BuQvzDxU4/ExoYGjVAi+jetGAhIgAm0E5H1GNeicrmQRGKI+inPAm+a5LFgyCHDO/YcfAgum3PeGm+p2UUv7KSzLhM8ydgml/LE5yn7mDPeyOJsqe0wuQ3E/xa1nt6J39pGRXikvo5GbmEidSMkDzasDQCTKNx5sQynItf4d5eJvTb34n3bIBPu0uF3BmLcpPObnP1LWn2OONv9LGW0/Mv87IpoJGsOaa0A2H3YkIKUJGoHp5zAXvDXjV3Iz/I8UkUn7MpSk9eY6OmyOb/tjXkLlonaE7iC0CHa2CCzIIurjGMu609VjB0TXWz/yxGp6bkA16x9SdpeElDsr4jOb+VtxbfnBjKYhRw+RiF4oCJ8RqRR8if5S0dYXISmOAv+yNVMlHYvMuSm+IJn64knxkbtZBOY6sCUTxX0MFKP2cDlo4BiqFPYhD6e9j0BW1QR4b5AWC99XQOpWpj9igLmWYIZ5OWnEDXjcnvJJ9U/koFdjqoWbo2JqtCBZi7TXGU/QZAtGerZizJq5KKoR5YmHg/Qvk/gCJvpQ5TNBXruUXbCdeRRjVyj0S+fsqLgb8vCTIMcK54lcncz2k2e5o0F/gSWNWqUtexhFRd9RPCRCD2jxTYF0nypTFVNOaQCLz9QCsbQjjwnG6pWOrMaLwIBb7PCxlZGeDtWEjbf7DW0GUgrdnAx3af4o6FlSp3GWXLCs/nZVFvQ50Hx2h+VoYSMPM4K9w/EMC6sGBV7gJCESBxcsuEJpZKvLLHLEObArue0Ry9mZedZCzNE5vsy2EDLDuRNDWvgbF7vJCTF6hUZtKWrHyqk8w3JvUz8n6gnMiqv7OyqHHfULmWPIBllXlkcjJC1pyvkWQN78Fd4SEINL3vUdRiAvUmPSC+ly/YmcmQcbdZAc+4QGMbz2gtGzpc4Kwa7RE/9yAvqx5+BgNyxbdTjFcMwYFWBV6lfCUSibRm1YMvVzZkKhDiMtlJ0dzAJtS5PpGV5wluEmBpCrPE36gaJsNp399BOkAZMF96WQLjCbYgnWH2mVYBHn9Q5CFuU2jtvpiLd18vJEFz6k0pHgoQ8IqcOgTtNCW01Shk2hMN66qRu3mJZjSPLZQLbqGexNAy/agccyePgz3c3C/SllwC41fSDwolvtKnFIdh41P1xbcrxPb05DOagzyOEuwlrQq7Bn3CVszCaywXt9wc2VLeXoA2pPXdCavmy6Umra2Oa1Tzre6UoXFkYfGAYBJQYroFPZyY+yQrPGEyBuoLmCtA2jgy30EFVkDKgqNauzSo39zdPwsQyXbhkE4TIF26+bAU+4rUiqMCN3h0gZzgI0pAZJnwBdVEfYriBrNvL2ItmC3b6e4rfQck5OXKLfegLGXOy2iSmqMsh1hsg7zt+AAQXvxSlXlARlnFVJl9GtJGm8ciSl6UTGKRzTzMtMxHNKJXLXg7KjZzSApJuc+c5I0mQA6S2dSliaP4SrHVBLuPl7gFSsBa0RsATdpEoI8UbMuKcwYr3LR/xxmDoZBguBLQv2RTHnnEAxAaspXpF41okJvbQ7OXwWGZZ559HrgJOw/vkCMXzqEUfiS7riT4hvyhwQT1gFBYQK2eISF28WT6AdMzGMY/1piuClffROxdHRVH3RJhXLmRMvlNCeqT5rcmsN7htxtCiwhStzgdoFQ2YLp1l4m3ngQqhmqABYnv07Cu8lt4TILaAsIESBXHOGQPijQf2kRGqmVgx85JmtUwPxkTpVgKAf2ymEqstfSxB1DN0i+Woo0S0C6Kc24wguGaSkSW+TRP0kNF91f+IH7GzxtnbsWTbZoDW7SnceZWnmvoSIlgSS9qoQQjyadOEGXWRboGJDSWaFJTsWaZ2gYweve2KrZqPNCQjnA6AEJPgUQhiaLzGNw53YoikuxLswkN+26ShxZluUezEORnot4lcYLNDo39sr6caG4nxg2lVCNg0RbQHTKNTVFIU6qihJSZ/oY+Vgq4De5bsWv6Bum4474r0gHGo4ySVMAqeI9lBvIDtJTgR+Y/qLOgf25CirKfUo01rQhsj4c2ROpUpOr3wAoYY5uy9Vuom60SEgbPZYD3GbqyUkykS/Ji2gRcgFSAfzKCnQaLD1JCygpmqZ2zGTWpiS7SxJW5oHr0ORF/kPyszcnMCd2wIkYp6rqsSMl+iCQlilGVUTFZhoLluROFGDM1iQiyIjwCC3L+ivTM36SI4jZXTVFi+guovPWm+Y9dhi2nBPUxmAh+NwBPQHVJMAqFDbpxg1xkuk4Auu9hH8kYskQgRx9NT94wILgJAt79Uu4jAhb/rDFtz4b7Vh6f8GJbK2Nh+YUBXv5/bSMfJ9SlduUQIzfBHJWs4zQ5mF3GPZkrIXAvd3oNNrTiAUrZpym1xY5WVtf7Q4v41dW6GHdv8RAlpodAXmEKxSnAe7QYxwLPUnOo9rdeBxiT7x+NaQXsLIX/vKmjjcwwmHGq0C2KXiSjKfbIcdiY/EA94VJX2r0km/ZmciLjlFj2OZQH+tyJjTu1lJhSx1OMlIDM/UVzm5kT0otAZw5j6Olxuy9wbArpB8SHwhRb73J7SIIlnPvYcM1NpaS0j5ygJvzDGQ+78GJvCzE2IzWrRZ71kAGg65fLQSS+QfKt8JjVb/zAGsl6jeliBA7Tm07MiMCd0o60JHMovhPjiPF2TuNkw9Nx8AT8nNgBCj4flxrlUevDudm32EicbJehDJ1WFcBCVtUrklSiuGeRwjBlt8azJ+6+1i+m4NvvUxl//jVYweQr46znj7D5+Y9qMMOTLxmZnivx8GAL2bjN/iQlcfB+tvginsaU3hrJqdb15lcIf6B8OfzLt09JxMabHsqEdec/qwDk1pFFbPd9vBD9jDsBZGS7YhwiiHSk91G4SqNb2FdnMqF3o7wANckaFk0LrL9Fcn/J3zYhuhMbGMEWWsFD4gKjnNh4WJ9P+gSKKAHSJFH3oYW2i6oqJGUUoYTLqFXejNdzFoy2QHKSo9p3QWdpnr/iag+dnBUQ2baZh/0wbiuCQabzZUllxmsXdG8I3Q3JLF3/hu7hLcBlBGlnKTZAcrk54HZQ/CiSGPV8ja+hhLBfM+S+H2pcDOn35OfurXqDjbe9meSnG+gF6M3eDhnmQurQHy0swSGNZ2bqeQ1lyutEhTJXC3cTFDipMa3JwDOWzKldEiCCYgVgGPnpP1FZk129GD8GnnmpmMJKmfHv8cEwn9CPzgj2bTQN/GXXSrKYJZ+U8E8gOAHwKZl6nu6WdqrDr6PuC1HmvP4AmodtNN2h2KoNlkTjWO8qSTJT/I1vLDRVNKbRMJ3c51nsMIsSw3pVanEYpeXjtrDdGtNSTvvIJYpbFj4/sXdq2l9inIcTHA53N7WgElQzsTOkMtGf/4nAPWUdD8Y5J3PjzKR7JUX7FYyfA8hBKBK+kt8cl1vyrpNFSbKfqvdzNB3o2VQCKg/u8vmvCu4Z0x1LAjOOv4u5D8jrqjQZOrmtkm+npFai+pgIP/xYZAA2XIpEylm2a0gJPaR6JV+lYlOc71SFw42w0dXsRrY1m3HILUZy/phNCWuZnEeH9SkVEnmUR4K/9gsbyAzSvHZs0rj4GaALGtarQ6t+iY7+aft5g7l44BMlrTBjJ8OVl5uhB/rpY2RO5anxCKzpZcAoIu9KPOSfKvGlFtPtrugvkXPptrONrK9pHQpUEsoBZhfPhYtsNHblZ3OI787XkeLNtEAlr4AnwtWFXzWtVTIHatmjwClWEKI/adwc4SvxGrqyb0RwLgtRZqg9sV/WzicE6eL9XMmoA3bpHkMpoYxxWnN6igWeBtAavUWAV1/lUuZoNzW7BFQL6WWbpmRU7AZ2j0IFUToR1JnLKIpQhOFsrg1PpwTF2VBcQvLZTKUwZJQF294T2wigHskhLh0FtuEW53ExqrLA8iQUSVwQyl7s14BmKBn5LdCIEtsmw9x9oEszqS5gpOURysMdUe2yKzNlu2NGG2UodELafKlZ0zcBGs34oeEqJgXJbnuJ1fXxd7NHdqlfKliZLLJR1RkuZWzhZxrQigAhk6tAu0bi65FkI+NwR34eWckctkSmNkp5i9ZpslgndenjNKDDoUImf3QC+g/l2W9ewswkkmexSbSuHvIW0sdRVUw5tXVAzmIpIZPTrIY2+JPJnQr0PcHsTk2gfAKJykVCalmk9qW6RGPxrtB421LIZMtnGtClDNzjjGbzeCLBUupjVPMS1htzTCmzh2uy1I/vheQW11IWd6Ld0FAWMRK0o5jkHaSNpRqtzR/6d6nOu5bIGGEMckTdfF4BQIJgF5Xk8A7ak8VZYbWJh0ZMBSmbk2gSihKGTabNys3hH5E46CwVBdq8gjVk35e0qr3AcptThS5IT8DgQ1Zmune5HB1Avia7LLyB1O8oP0RexcBmjr9yytj8heaeGDCVxFmKwQmCuiCNKIZ6A43JuN8EhYP19JftRbBuornpx3zZK0YESDrq6b7WG/iaIJ8plqdaoTEtzyKySJ7l1mGm0GZ1lCKHTKr2mdULOG3MU7NyGn0TsfGsrxJQzkfMOZ3+Ge3BZ4QhbjtHgFDBsaT5ZHYas8U062s+1Ji25lJKvJSQlJn5Q/RCGf/ylkKpSh55Yj4tNOVdmqaQneCIjUwl073LKVWno31MZ1mUtzJ5Af+3VKHbfOYTNDDRfss49LCRmGb8r/s1xdfkmUZAvhSMhdNKdSvuoBZTm+lcIMivzFTZfzWo/eyjoyaTZpKT4YAmtQQjL9yHz916GWEW6NZQZ4AyVYFRDg1qc34e6V8xu36KAfFPO4Fe8jJKqjFvtNm0pLK6ymxVvAJ3U/xcQPCJdZ82awHNi5wIg4h0eCDDoX1KsNVsvkJ2/pv8l9PjNSjHiiIMyhHEAO1gQL77oE0xv9mjYjGwfu1nMsfIowS8QAX3aVSurXUsIORJKdugox9oRXI792dxGEh9gHLmEpBIHj7jDbJ0vqdhXeiHJsnWGjNQAdoI3D81aO4bU4NDaXITkrkU1tTt4yUp8TQzYjWsd79Ut3DbDB6klWmMeEqGr8FEsjaAg388wU5zaQKcUOIlyrHSqXHd+rqylfNDneDBRU1dtPVXQqn1VrAF8zg1ifxNZThJYj+L8hKV3Kw5evRj13B0lUnsppIl05h2Pisjq1KGx0LK/Eom/09aRysrb1GlvZqn679NaJrH3ZXxu2MQteCpb79DyFF1ueAdI3sk9xpoPdlUlmCudEOb8hKVXePUbL28tCv6G88v5MkgO6cxAmmmflAOPObLVYVJUTIxaSoLNKY7X1f3lmJqnnmxWk4J85ibIIu/AixNHGOBUlw/s1taKPc8LsBMJmhYSTuyK+9Q8LQXQrhW5VFc1YXc/r9LuTt6j4x4wj90azFlemUzqaYZOmH1mj6IHnucAuwtowTUDEoXOX4slMwAw1p/OXHHZqJJeK4RDBVX3qPsI08yOV5byPx2WLLNua1rYaObKq6uxD2ovahq3BfHOV55l3INY/zFpTZyblmt15qrSyVF5inFG7upQdwalANllPepROR+rJ+ri6hPUe4hj7hv0igBah/V3pRL9P8N4mJj5aUKKDdg6f5bSQZO+pbIItKGZ/uT86dvZZbWclp7WTDX+znJ/d425eVKF5ynQESJ8DSmmGyfBVcZxmYVa5mnWadMVsbpT4yTElPSqPebSv4D/YDGgi5JaRfJE4v5udP2qzzWgMSFweq9J2ubK1R0FF1Y1uwNFO+GWrziMVhn3g2d8GsB9V6UvcNeh2eb6rbuqaSNLp5ErJNedKEz+Kv3pzK3iPxx1bJZzdMqEzTHsJdimE35Wkp1xYPEuRmV96r0uhu7Aj5Mo4LTbXVb5c2PxmLrU5bDgurDpPlaJyz35kuaK9rh5vD6f6Cwz5kcorxXIUuTPLwPi/K5FDDOKN9Z2ueiyXVtpD98LApRzVCOoj4V5ehk1T6LL8V6DXRu+1JsRgqL6X0ohmlAi3wo0j1HipGNfagxCzrjLMR3IugdMjb6UC/zNaJhvhOhLxASK/hOoz/0cjfIZ8J6COthsflMo3giNKb7dL9BO+v7TNiPQeN5bt8pH/YOGscCfaYxSEP6wWfCsgkbxXymkfE6wmMfKrYuAbxne7jyodSD3OvXQvlWWmTcstjVpnws7Aa9m0/GBSrfS+kvuHeoRqVXPpnyP9P67WeZlK+m4t8MMW7PVgBWUDggmAAAABAQAJ0BKj0BtAA+kUihTSWkIyIgKACwEglpbuF2sRtACewD32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ99snIe+2TkPfbJyHvtk5D32ych77ZOQ3gAP7/vBFosAAAAAAAAAAA"}),(0,Pe.jsx)("p",{id:"my-spiel",children:"I am a full stack web developer with an interest in data science."})]})]}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(Ue,{children:(0,Pe.jsx)(wn,{})}),(0,Pe.jsx)(TY,{}),(0,Pe.jsx)(Tr,{})]})),RY=__webpack_require__.p+"static/media/heart.31bf59748b533506b7df.png";class OY extends t.Component{render(){return(0,Pe.jsxs)(Ne,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsxs)(Ue,{children:[(0,Pe.jsxs)("small",{children:["Explore my website!",(0,Pe.jsx)("br",{})," Made with ",(0,Pe.jsx)("img",{id:"heart",src:RY,alt:"love"})," for you."]})," "]})]})}}const IY=OY,kY=__webpack_require__.p+"static/media/monster.48da9873ccb7af1a2ea7.png",LY=()=>(0,Pe.jsxs)(Ne,{className:"not-found",children:[(0,Pe.jsxs)(Ve,{children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("h1",{children:"Whomp, whomp."}),(0,Pe.jsx)("h2",{children:" This page cannot be found."}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(Se,{to:"/home",children:" Back to Home"}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]}),(0,Pe.jsxs)(Ve,{children:[(0,Pe.jsx)("img",{id:"monster",src:kY,alt:"not-found monster"})," ",(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{})]})]});const FY=function(){return(0,Pe.jsxs)("div",{className:"App",children:[(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)("br",{}),(0,Pe.jsx)(xe,{children:(0,Pe.jsxs)(fe,{children:[(0,Pe.jsx)(ue,{index:!0,element:(0,Pe.jsx)(DY,{})}),(0,Pe.jsx)(ue,{path:"home",element:(0,Pe.jsx)(DY,{})}),(0,Pe.jsx)(ue,{path:"portfolio",element:(0,Pe.jsx)(DY,{})}),(0,Pe.jsx)(ue,{path:"reviews",element:(0,Pe.jsx)(vn,{})}),(0,Pe.jsx)(ue,{path:"repos",element:(0,Pe.jsx)(xn,{})}),(0,Pe.jsx)(ue,{path:"about",element:(0,Pe.jsx)(Di,{})}),(0,Pe.jsx)(ue,{path:"hire",element:(0,Pe.jsx)(Ii,{})}),(0,Pe.jsx)(ue,{path:"*",element:(0,Pe.jsx)(LY,{})})]})}),(0,Pe.jsx)("footer",{children:(0,Pe.jsx)(IY,{})})]})},BY=e=>{e&&e instanceof Function&&__webpack_require__.e(453).then(__webpack_require__.bind(__webpack_require__,6453)).then((t=>{let{getCLS:i,getFID:n,getFCP:r,getLCP:a,getTTFB:s}=t;i(e),n(e),r(e),a(e),s(e)}))};n.createRoot(document.getElementById("root")).render((0,Pe.jsx)(t.StrictMode,{children:(0,Pe.jsx)(FY,{})})),BY()})()})();
//# sourceMappingURL=main.b5b95b72.js.map